{"version":3,"file":"default~app.6310f9af5345c722b930.js","sources":["webpack:///d:/Code/Go/src/github.com/bkzy/grafana/packages/grafana-data/src/dataframe/CircularDataFrame.ts","webpack:///d:/Code/Go/src/github.com/bkzy/grafana/packages/grafana-data/src/dataframe/DataFrameView.ts","webpack:///d:/Code/Go/src/github.com/bkzy/grafana/packages/grafana-data/src/dataframe/FieldCache.ts","webpack:///d:/Code/Go/src/github.com/bkzy/grafana/packages/grafana-data/src/dataframe/MutableDataFrame.ts","webpack:///d:/Code/Go/src/github.com/bkzy/grafana/packages/grafana-data/src/dataframe/dimensions.ts","webpack:///d:/Code/Go/src/github.com/bkzy/grafana/packages/grafana-data/src/dataframe/index.ts","webpack:///d:/Code/Go/src/github.com/bkzy/grafana/packages/grafana-data/src/dataframe/processDataFrame.ts","webpack:///d:/Code/Go/src/github.com/bkzy/grafana/packages/grafana-data/src/datetime/datemath.ts","webpack:///d:/Code/Go/src/github.com/bkzy/grafana/packages/grafana-data/src/datetime/formats.ts","webpack:///d:/Code/Go/src/github.com/bkzy/grafana/packages/grafana-data/src/datetime/index.ts","webpack:///d:/Code/Go/src/github.com/bkzy/grafana/packages/grafana-data/src/datetime/moment_wrapper.ts","webpack:///d:/Code/Go/src/github.com/bkzy/grafana/packages/grafana-data/src/datetime/rangeutil.ts","webpack:///d:/Code/Go/src/github.com/bkzy/grafana/packages/grafana-data/src/datetime/timezones.ts","webpack:///d:/Code/Go/src/github.com/bkzy/grafana/packages/grafana-data/src/field/displayProcessor.ts","webpack:///d:/Code/Go/src/github.com/bkzy/grafana/packages/grafana-data/src/field/fieldDisplay.ts","webpack:///d:/Code/Go/src/github.com/bkzy/grafana/packages/grafana-data/src/field/fieldOverrides.ts","webpack:///d:/Code/Go/src/github.com/bkzy/grafana/packages/grafana-data/src/field/index.ts","webpack:///d:/Code/Go/src/github.com/bkzy/grafana/packages/grafana-data/src/field/scale.ts","webpack:///d:/Code/Go/src/github.com/bkzy/grafana/packages/grafana-data/src/index.ts","webpack:///d:/Code/Go/src/github.com/bkzy/grafana/packages/grafana-data/src/text/index.ts","webpack:///d:/Code/Go/src/github.com/bkzy/grafana/packages/grafana-data/src/text/markdown.ts","webpack:///d:/Code/Go/src/github.com/bkzy/grafana/packages/grafana-data/src/text/string.ts","webpack:///d:/Code/Go/src/github.com/bkzy/grafana/packages/grafana-data/src/text/text.ts","webpack:///d:/Code/Go/src/github.com/bkzy/grafana/packages/grafana-data/src/transformations/fieldReducer.ts","webpack:///d:/Code/Go/src/github.com/bkzy/grafana/packages/grafana-data/src/transformations/index.ts","webpack:///d:/Code/Go/src/github.com/bkzy/grafana/packages/grafana-data/src/transformations/matchers.ts","webpack:///d:/Code/Go/src/github.com/bkzy/grafana/packages/grafana-data/src/transformations/matchers/fieldTypeMatcher.ts","webpack:///d:/Code/Go/src/github.com/bkzy/grafana/packages/grafana-data/src/transformations/matchers/ids.ts","webpack:///d:/Code/Go/src/github.com/bkzy/grafana/packages/grafana-data/src/transformations/matchers/nameMatcher.ts","webpack:///d:/Code/Go/src/github.com/bkzy/grafana/packages/grafana-data/src/transformations/matchers/predicates.ts","webpack:///d:/Code/Go/src/github.com/bkzy/grafana/packages/grafana-data/src/transformations/matchers/refIdMatcher.ts","webpack:///d:/Code/Go/src/github.com/bkzy/grafana/packages/grafana-data/src/transformations/transformers.ts","webpack:///d:/Code/Go/src/github.com/bkzy/grafana/packages/grafana-data/src/transformations/transformers/append.ts","webpack:///d:/Code/Go/src/github.com/bkzy/grafana/packages/grafana-data/src/transformations/transformers/filter.ts","webpack:///d:/Code/Go/src/github.com/bkzy/grafana/packages/grafana-data/src/transformations/transformers/filterByName.ts","webpack:///d:/Code/Go/src/github.com/bkzy/grafana/packages/grafana-data/src/transformations/transformers/filterByRefId.ts","webpack:///d:/Code/Go/src/github.com/bkzy/grafana/packages/grafana-data/src/transformations/transformers/ids.ts","webpack:///d:/Code/Go/src/github.com/bkzy/grafana/packages/grafana-data/src/transformations/transformers/noop.ts","webpack:///d:/Code/Go/src/github.com/bkzy/grafana/packages/grafana-data/src/transformations/transformers/reduce.ts","webpack:///d:/Code/Go/src/github.com/bkzy/grafana/packages/grafana-data/src/types/app.ts","webpack:///d:/Code/Go/src/github.com/bkzy/grafana/packages/grafana-data/src/types/appEvents.ts","webpack:///d:/Code/Go/src/github.com/bkzy/grafana/packages/grafana-data/src/types/data.ts","webpack:///d:/Code/Go/src/github.com/bkzy/grafana/packages/grafana-data/src/types/dataFrame.ts","webpack:///d:/Code/Go/src/github.com/bkzy/grafana/packages/grafana-data/src/types/datasource.ts","webpack:///d:/Code/Go/src/github.com/bkzy/grafana/packages/grafana-data/src/types/fieldColor.ts","webpack:///d:/Code/Go/src/github.com/bkzy/grafana/packages/grafana-data/src/types/index.ts","webpack:///d:/Code/Go/src/github.com/bkzy/grafana/packages/grafana-data/src/types/logs.ts","webpack:///d:/Code/Go/src/github.com/bkzy/grafana/packages/grafana-data/src/types/orgs.ts","webpack:///d:/Code/Go/src/github.com/bkzy/grafana/packages/grafana-data/src/types/panel.ts","webpack:///d:/Code/Go/src/github.com/bkzy/grafana/packages/grafana-data/src/types/panelEvents.ts","webpack:///d:/Code/Go/src/github.com/bkzy/grafana/packages/grafana-data/src/types/plugin.ts","webpack:///d:/Code/Go/src/github.com/bkzy/grafana/packages/grafana-data/src/types/theme.ts","webpack:///d:/Code/Go/src/github.com/bkzy/grafana/packages/grafana-data/src/types/thresholds.ts","webpack:///d:/Code/Go/src/github.com/bkzy/grafana/packages/grafana-data/src/types/time.ts","webpack:///d:/Code/Go/src/github.com/bkzy/grafana/packages/grafana-data/src/types/utils.ts","webpack:///d:/Code/Go/src/github.com/bkzy/grafana/packages/grafana-data/src/types/valueMapping.ts","webpack:///d:/Code/Go/src/github.com/bkzy/grafana/packages/grafana-data/src/utils/Registry.ts","webpack:///d:/Code/Go/src/github.com/bkzy/grafana/packages/grafana-data/src/utils/csv.ts","webpack:///d:/Code/Go/src/github.com/bkzy/grafana/packages/grafana-data/src/utils/datasource.ts","webpack:///d:/Code/Go/src/github.com/bkzy/grafana/packages/grafana-data/src/utils/deprecationWarning.ts","webpack:///d:/Code/Go/src/github.com/bkzy/grafana/packages/grafana-data/src/utils/fieldParser.ts","webpack:///d:/Code/Go/src/github.com/bkzy/grafana/packages/grafana-data/src/utils/flotPairs.ts","webpack:///d:/Code/Go/src/github.com/bkzy/grafana/packages/grafana-data/src/utils/index.ts","webpack:///d:/Code/Go/src/github.com/bkzy/grafana/packages/grafana-data/src/utils/labels.ts","webpack:///d:/Code/Go/src/github.com/bkzy/grafana/packages/grafana-data/src/utils/logs.ts","webpack:///d:/Code/Go/src/github.com/bkzy/grafana/packages/grafana-data/src/utils/namedColorsPalette.ts","webpack:///d:/Code/Go/src/github.com/bkzy/grafana/packages/grafana-data/src/utils/object.ts","webpack:///d:/Code/Go/src/github.com/bkzy/grafana/packages/grafana-data/src/utils/series.ts","webpack:///d:/Code/Go/src/github.com/bkzy/grafana/packages/grafana-data/src/utils/valueMappings.ts","webpack:///d:/Code/Go/src/github.com/bkzy/grafana/packages/grafana-data/src/valueFormats/arithmeticFormatters.ts","webpack:///d:/Code/Go/src/github.com/bkzy/grafana/packages/grafana-data/src/valueFormats/categories.ts","webpack:///d:/Code/Go/src/github.com/bkzy/grafana/packages/grafana-data/src/valueFormats/dateTimeFormatters.ts","webpack:///d:/Code/Go/src/github.com/bkzy/grafana/packages/grafana-data/src/valueFormats/index.ts","webpack:///d:/Code/Go/src/github.com/bkzy/grafana/packages/grafana-data/src/valueFormats/symbolFormatters.ts","webpack:///d:/Code/Go/src/github.com/bkzy/grafana/packages/grafana-data/src/valueFormats/valueFormats.ts","webpack:///d:/Code/Go/src/github.com/bkzy/grafana/packages/grafana-data/src/vector/AppendedVectors.ts","webpack:///d:/Code/Go/src/github.com/bkzy/grafana/packages/grafana-data/src/vector/ArrayVector.ts","webpack:///d:/Code/Go/src/github.com/bkzy/grafana/packages/grafana-data/src/vector/CircularVector.ts","webpack:///d:/Code/Go/src/github.com/bkzy/grafana/packages/grafana-data/src/vector/ConstantVector.ts","webpack:///d:/Code/Go/src/github.com/bkzy/grafana/packages/grafana-data/src/vector/ScaledVector.ts","webpack:///d:/Code/Go/src/github.com/bkzy/grafana/packages/grafana-data/src/vector/SortedVector.ts","webpack:///d:/Code/Go/src/github.com/bkzy/grafana/packages/grafana-data/src/vector/index.ts","webpack:///d:/Code/Go/src/github.com/bkzy/grafana/packages/grafana-data/src/vector/vectorToArray.ts","webpack:///d:/Code/Go/src/github.com/bkzy/grafana/packages/grafana-e2e/src/flows/addDashboard.ts","webpack:///d:/Code/Go/src/github.com/bkzy/grafana/packages/grafana-e2e/src/flows/addDataSource.ts","webpack:///d:/Code/Go/src/github.com/bkzy/grafana/packages/grafana-e2e/src/flows/assertSuccessNotification.ts","webpack:///d:/Code/Go/src/github.com/bkzy/grafana/packages/grafana-e2e/src/flows/deleteDashboard.ts","webpack:///d:/Code/Go/src/github.com/bkzy/grafana/packages/grafana-e2e/src/flows/deleteDataSource.ts","webpack:///d:/Code/Go/src/github.com/bkzy/grafana/packages/grafana-e2e/src/flows/index.ts","webpack:///d:/Code/Go/src/github.com/bkzy/grafana/packages/grafana-e2e/src/flows/login.ts","webpack:///d:/Code/Go/src/github.com/bkzy/grafana/packages/grafana-e2e/src/flows/openDashboard.ts","webpack:///d:/Code/Go/src/github.com/bkzy/grafana/packages/grafana-e2e/src/flows/saveDashboard.ts","webpack:///d:/Code/Go/src/github.com/bkzy/grafana/packages/grafana-e2e/src/flows/saveNewDashboard.ts","webpack:///d:/Code/Go/src/github.com/bkzy/grafana/packages/grafana-e2e/src/index.ts","webpack:///d:/Code/Go/src/github.com/bkzy/grafana/packages/grafana-e2e/src/noTypeCheck.ts","webpack:///d:/Code/Go/src/github.com/bkzy/grafana/packages/grafana-e2e/src/pages/addDashboard.ts","webpack:///d:/Code/Go/src/github.com/bkzy/grafana/packages/grafana-e2e/src/pages/addDataSource.ts","webpack:///d:/Code/Go/src/github.com/bkzy/grafana/packages/grafana-e2e/src/pages/confirmModal.ts","webpack:///d:/Code/Go/src/github.com/bkzy/grafana/packages/grafana-e2e/src/pages/dashboard.ts","webpack:///d:/Code/Go/src/github.com/bkzy/grafana/packages/grafana-e2e/src/pages/dashboardSettings.ts","webpack:///d:/Code/Go/src/github.com/bkzy/grafana/packages/grafana-e2e/src/pages/dashboards.ts","webpack:///d:/Code/Go/src/github.com/bkzy/grafana/packages/grafana-e2e/src/pages/datasource.ts","webpack:///d:/Code/Go/src/github.com/bkzy/grafana/packages/grafana-e2e/src/pages/datasources.ts","webpack:///d:/Code/Go/src/github.com/bkzy/grafana/packages/grafana-e2e/src/pages/editPanel.ts","webpack:///d:/Code/Go/src/github.com/bkzy/grafana/packages/grafana-e2e/src/pages/graph/index.ts","webpack:///d:/Code/Go/src/github.com/bkzy/grafana/packages/grafana-e2e/src/pages/graph/visualizationTab.ts","webpack:///d:/Code/Go/src/github.com/bkzy/grafana/packages/grafana-e2e/src/pages/index.ts","webpack:///d:/Code/Go/src/github.com/bkzy/grafana/packages/grafana-e2e/src/pages/login.ts","webpack:///d:/Code/Go/src/github.com/bkzy/grafana/packages/grafana-e2e/src/pages/panel.ts","webpack:///d:/Code/Go/src/github.com/bkzy/grafana/packages/grafana-e2e/src/pages/saveDashboardAsModal.ts","webpack:///d:/Code/Go/src/github.com/bkzy/grafana/packages/grafana-e2e/src/pages/saveDashboardModal.ts","webpack:///d:/Code/Go/src/github.com/bkzy/grafana/packages/grafana-e2e/src/pages/sharePanelModal.ts","webpack:///d:/Code/Go/src/github.com/bkzy/grafana/packages/grafana-e2e/src/pages/testdata/index.ts","webpack:///d:/Code/Go/src/github.com/bkzy/grafana/packages/grafana-e2e/src/pages/testdata/queryTab.ts","webpack:///d:/Code/Go/src/github.com/bkzy/grafana/packages/grafana-e2e/src/pages/variables.ts","webpack:///d:/Code/Go/src/github.com/bkzy/grafana/packages/grafana-e2e/src/support/index.ts","webpack:///d:/Code/Go/src/github.com/bkzy/grafana/packages/grafana-e2e/src/support/scenario.ts","webpack:///d:/Code/Go/src/github.com/bkzy/grafana/packages/grafana-e2e/src/support/scenarioContext.ts","webpack:///d:/Code/Go/src/github.com/bkzy/grafana/packages/grafana-e2e/src/support/selector.ts","webpack:///d:/Code/Go/src/github.com/bkzy/grafana/packages/grafana-e2e/src/support/types.ts","webpack:///d:/Code/Go/src/github.com/bkzy/grafana/packages/grafana-e2e/src/support/url.ts","webpack:///d:/Code/Go/src/github.com/bkzy/grafana/packages/grafana-runtime/src/config.ts","webpack:///d:/Code/Go/src/github.com/bkzy/grafana/packages/grafana-runtime/src/index.ts","webpack:///d:/Code/Go/src/github.com/bkzy/grafana/packages/grafana-runtime/src/services/AngularLoader.ts","webpack:///d:/Code/Go/src/github.com/bkzy/grafana/packages/grafana-runtime/src/services/EchoSrv.ts","webpack:///d:/Code/Go/src/github.com/bkzy/grafana/packages/grafana-runtime/src/services/LocationSrv.ts","webpack:///d:/Code/Go/src/github.com/bkzy/grafana/packages/grafana-runtime/src/services/backendSrv.ts","webpack:///d:/Code/Go/src/github.com/bkzy/grafana/packages/grafana-runtime/src/services/dataSourceSrv.ts","webpack:///d:/Code/Go/src/github.com/bkzy/grafana/packages/grafana-runtime/src/services/index.ts","webpack:///d:/Code/Go/src/github.com/bkzy/grafana/packages/grafana-runtime/src/types/index.ts","webpack:///d:/Code/Go/src/github.com/bkzy/grafana/packages/grafana-runtime/src/utils/DataSourceWithBackend.ts","webpack:///d:/Code/Go/src/github.com/bkzy/grafana/packages/grafana-runtime/src/utils/analytics.ts","webpack:///d:/Code/Go/src/github.com/bkzy/grafana/packages/grafana-runtime/src/utils/plugin.ts","webpack:///d:/Code/Go/src/github.com/bkzy/grafana/packages/grafana-ui/src/components/Alert/Alert.tsx","webpack:///d:/Code/Go/src/github.com/bkzy/grafana/packages/grafana-ui/src/components/AlphaNotice/AlphaNotice.tsx","webpack:///d:/Code/Go/src/github.com/bkzy/grafana/packages/grafana-ui/src/components/BarGauge/BarGauge.tsx","webpack:///d:/Code/Go/src/github.com/bkzy/grafana/packages/grafana-ui/src/components/BigValue/BigValue.tsx","webpack:///d:/Code/Go/src/github.com/bkzy/grafana/packages/grafana-ui/src/components/BigValue/BigValueLayout.tsx","webpack:///d:/Code/Go/src/github.com/bkzy/grafana/packages/grafana-ui/src/components/Button/Button.tsx","webpack:///d:/Code/Go/src/github.com/bkzy/grafana/packages/grafana-ui/src/components/Button/ButtonContent.tsx","webpack:///d:/Code/Go/src/github.com/bkzy/grafana/packages/grafana-ui/src/components/Button/styles.ts","webpack:///d:/Code/Go/src/github.com/bkzy/grafana/packages/grafana-ui/src/components/ButtonCascader/ButtonCascader.tsx","webpack:///d:/Code/Go/src/github.com/bkzy/grafana/packages/grafana-ui/src/components/CallToActionCard/CallToActionCard.tsx","webpack:///d:/Code/Go/src/github.com/bkzy/grafana/packages/grafana-ui/src/components/Cascader/Cascader.tsx","webpack:///d:/Code/Go/src/github.com/bkzy/grafana/packages/grafana-ui/src/components/Chart/Tooltip.tsx","webpack:///d:/Code/Go/src/github.com/bkzy/grafana/packages/grafana-ui/src/components/Chart/TooltipContainer.tsx","webpack:///d:/Code/Go/src/github.com/bkzy/grafana/packages/grafana-ui/src/components/Chart/index.tsx","webpack:///d:/Code/Go/src/github.com/bkzy/grafana/packages/grafana-ui/src/components/ClickOutsideWrapper/ClickOutsideWrapper.tsx","webpack:///d:/Code/Go/src/github.com/bkzy/grafana/packages/grafana-ui/src/components/Collapse/Collapse.tsx","webpack:///d:/Code/Go/src/github.com/bkzy/grafana/packages/grafana-ui/src/components/ColorPicker/ColorInput.tsx","webpack:///d:/Code/Go/src/github.com/bkzy/grafana/packages/grafana-ui/src/components/ColorPicker/ColorPicker.tsx","webpack:///d:/Code/Go/src/github.com/bkzy/grafana/packages/grafana-ui/src/components/ColorPicker/ColorPickerPopover.tsx","webpack:///d:/Code/Go/src/github.com/bkzy/grafana/packages/grafana-ui/src/components/ColorPicker/ColorPickerTrigger.tsx","webpack:///d:/Code/Go/src/github.com/bkzy/grafana/packages/grafana-ui/src/components/ColorPicker/NamedColorsGroup.tsx","webpack:///d:/Code/Go/src/github.com/bkzy/grafana/packages/grafana-ui/src/components/ColorPicker/NamedColorsPalette.tsx","webpack:///d:/Code/Go/src/github.com/bkzy/grafana/packages/grafana-ui/src/components/ColorPicker/SeriesColorPickerPopover.tsx","webpack:///d:/Code/Go/src/github.com/bkzy/grafana/packages/grafana-ui/src/components/ColorPicker/SpectrumPalette.tsx","webpack:///d:/Code/Go/src/github.com/bkzy/grafana/packages/grafana-ui/src/components/ColorPicker/SpectrumPalettePointer.tsx","webpack:///d:/Code/Go/src/github.com/bkzy/grafana/packages/grafana-ui/src/components/ColorPicker/warnAboutColorPickerPropsDeprecation.ts","webpack:///d:/Code/Go/src/github.com/bkzy/grafana/packages/grafana-ui/src/components/ConfirmButton/ConfirmButton.tsx","webpack:///d:/Code/Go/src/github.com/bkzy/grafana/packages/grafana-ui/src/components/ConfirmButton/DeleteButton.tsx","webpack:///d:/Code/Go/src/github.com/bkzy/grafana/packages/grafana-ui/src/components/ConfirmModal/ConfirmModal.tsx","webpack:///d:/Code/Go/src/github.com/bkzy/grafana/packages/grafana-ui/src/components/ContextMenu/ContextMenu.tsx","webpack:///d:/Code/Go/src/github.com/bkzy/grafana/packages/grafana-ui/src/components/ContextMenu/WithContextMenu.tsx","webpack:///d:/Code/Go/src/github.com/bkzy/grafana/packages/grafana-ui/src/components/CustomScrollbar/CustomScrollbar.tsx","webpack:///d:/Code/Go/src/github.com/bkzy/grafana/packages/grafana-ui/src/components/DataLinks/DataLinkEditor.tsx","webpack:///d:/Code/Go/src/github.com/bkzy/grafana/packages/grafana-ui/src/components/DataLinks/DataLinkInput.tsx","webpack:///d:/Code/Go/src/github.com/bkzy/grafana/packages/grafana-ui/src/components/DataLinks/DataLinkSuggestions.tsx","webpack:///d:/Code/Go/src/github.com/bkzy/grafana/packages/grafana-ui/src/components/DataLinks/DataLinksContextMenu.tsx","webpack:///d:/Code/Go/src/github.com/bkzy/grafana/packages/grafana-ui/src/components/DataLinks/DataLinksEditor.tsx","webpack:///d:/Code/Go/src/github.com/bkzy/grafana/packages/grafana-ui/src/components/DataLinks/SelectionReference.ts","webpack:///d:/Code/Go/src/github.com/bkzy/grafana/packages/grafana-ui/src/components/DataSourceSettings/BasicAuthSettings.tsx","webpack:///d:/Code/Go/src/github.com/bkzy/grafana/packages/grafana-ui/src/components/DataSourceSettings/CertificationKey.tsx","webpack:///d:/Code/Go/src/github.com/bkzy/grafana/packages/grafana-ui/src/components/DataSourceSettings/DataSourceHttpSettings.tsx","webpack:///d:/Code/Go/src/github.com/bkzy/grafana/packages/grafana-ui/src/components/DataSourceSettings/HttpProxySettings.tsx","webpack:///d:/Code/Go/src/github.com/bkzy/grafana/packages/grafana-ui/src/components/DataSourceSettings/TLSAuthSettings.tsx","webpack:///d:/Code/Go/src/github.com/bkzy/grafana/packages/grafana-ui/src/components/Drawer/Drawer.tsx","webpack:///d:/Code/Go/src/github.com/bkzy/grafana/packages/grafana-ui/src/components/EmptySearchResult/EmptySearchResult.tsx","webpack:///d:/Code/Go/src/github.com/bkzy/grafana/packages/grafana-ui/src/components/ErrorBoundary/ErrorBoundary.tsx","webpack:///d:/Code/Go/src/github.com/bkzy/grafana/packages/grafana-ui/src/components/ErrorBoundary/ErrorWithStack.tsx","webpack:///d:/Code/Go/src/github.com/bkzy/grafana/packages/grafana-ui/src/components/FormField/FormField.tsx","webpack:///d:/Code/Go/src/github.com/bkzy/grafana/packages/grafana-ui/src/components/FormLabel/FormLabel.tsx","webpack:///d:/Code/Go/src/github.com/bkzy/grafana/packages/grafana-ui/src/components/FormattedValueDisplay/FormattedValueDisplay.tsx","webpack:///d:/Code/Go/src/github.com/bkzy/grafana/packages/grafana-ui/src/components/Forms/Button.tsx","webpack:///d:/Code/Go/src/github.com/bkzy/grafana/packages/grafana-ui/src/components/Forms/Checkbox.tsx","webpack:///d:/Code/Go/src/github.com/bkzy/grafana/packages/grafana-ui/src/components/Forms/Field.tsx","webpack:///d:/Code/Go/src/github.com/bkzy/grafana/packages/grafana-ui/src/components/Forms/FieldValidationMessage.tsx","webpack:///d:/Code/Go/src/github.com/bkzy/grafana/packages/grafana-ui/src/components/Forms/Form.tsx","webpack:///d:/Code/Go/src/github.com/bkzy/grafana/packages/grafana-ui/src/components/Forms/Input/Input.tsx","webpack:///d:/Code/Go/src/github.com/bkzy/grafana/packages/grafana-ui/src/components/Forms/Label.tsx","webpack:///d:/Code/Go/src/github.com/bkzy/grafana/packages/grafana-ui/src/components/Forms/Legend.tsx","webpack:///d:/Code/Go/src/github.com/bkzy/grafana/packages/grafana-ui/src/components/Forms/Select/DropdownIndicator.tsx","webpack:///d:/Code/Go/src/github.com/bkzy/grafana/packages/grafana-ui/src/components/Forms/Select/IndicatorsContainer.tsx","webpack:///d:/Code/Go/src/github.com/bkzy/grafana/packages/grafana-ui/src/components/Forms/Select/InputControl.tsx","webpack:///d:/Code/Go/src/github.com/bkzy/grafana/packages/grafana-ui/src/components/Forms/Select/MultiValue.tsx","webpack:///d:/Code/Go/src/github.com/bkzy/grafana/packages/grafana-ui/src/components/Forms/Select/Select.tsx","webpack:///d:/Code/Go/src/github.com/bkzy/grafana/packages/grafana-ui/src/components/Forms/Select/SelectBase.tsx","webpack:///d:/Code/Go/src/github.com/bkzy/grafana/packages/grafana-ui/src/components/Forms/Select/SelectMenu.tsx","webpack:///d:/Code/Go/src/github.com/bkzy/grafana/packages/grafana-ui/src/components/Forms/Select/SelectOptionGroup.tsx","webpack:///d:/Code/Go/src/github.com/bkzy/grafana/packages/grafana-ui/src/components/Forms/Select/SingleValue.tsx","webpack:///d:/Code/Go/src/github.com/bkzy/grafana/packages/grafana-ui/src/components/Forms/Select/ValueContainer.tsx","webpack:///d:/Code/Go/src/github.com/bkzy/grafana/packages/grafana-ui/src/components/Forms/Select/getSelectStyles.ts","webpack:///d:/Code/Go/src/github.com/bkzy/grafana/packages/grafana-ui/src/components/Forms/Select/resetSelectStyles.ts","webpack:///d:/Code/Go/src/github.com/bkzy/grafana/packages/grafana-ui/src/components/Forms/Switch.tsx","webpack:///d:/Code/Go/src/github.com/bkzy/grafana/packages/grafana-ui/src/components/Forms/commonStyles.ts","webpack:///d:/Code/Go/src/github.com/bkzy/grafana/packages/grafana-ui/src/components/Forms/getFormStyles.ts","webpack:///d:/Code/Go/src/github.com/bkzy/grafana/packages/grafana-ui/src/components/Forms/index.ts","webpack:///d:/Code/Go/src/github.com/bkzy/grafana/packages/grafana-ui/src/components/Gauge/Gauge.tsx","webpack:///d:/Code/Go/src/github.com/bkzy/grafana/packages/grafana-ui/src/components/Graph/Graph.tsx","webpack:///d:/Code/Go/src/github.com/bkzy/grafana/packages/grafana-ui/src/components/Graph/GraphContextMenu.tsx","webpack:///d:/Code/Go/src/github.com/bkzy/grafana/packages/grafana-ui/src/components/Graph/GraphLegend.tsx","webpack:///d:/Code/Go/src/github.com/bkzy/grafana/packages/grafana-ui/src/components/Graph/GraphLegendItem.tsx","webpack:///d:/Code/Go/src/github.com/bkzy/grafana/packages/grafana-ui/src/components/Graph/GraphSeriesToggler.tsx","webpack:///d:/Code/Go/src/github.com/bkzy/grafana/packages/grafana-ui/src/components/Graph/GraphTooltip/GraphTooltip.tsx","webpack:///d:/Code/Go/src/github.com/bkzy/grafana/packages/grafana-ui/src/components/Graph/GraphTooltip/MultiModeGraphTooltip.tsx","webpack:///d:/Code/Go/src/github.com/bkzy/grafana/packages/grafana-ui/src/components/Graph/GraphTooltip/SeriesTable.tsx","webpack:///d:/Code/Go/src/github.com/bkzy/grafana/packages/grafana-ui/src/components/Graph/GraphTooltip/SingleModeGraphTooltip.tsx","webpack:///d:/Code/Go/src/github.com/bkzy/grafana/packages/grafana-ui/src/components/Graph/GraphWithLegend.tsx","webpack:///d:/Code/Go/src/github.com/bkzy/grafana/packages/grafana-ui/src/components/Graph/utils.ts","webpack:///d:/Code/Go/src/github.com/bkzy/grafana/packages/grafana-ui/src/components/Icon/Icon.tsx","webpack:///d:/Code/Go/src/github.com/bkzy/grafana/packages/grafana-ui/src/components/Input/Input.tsx","webpack:///d:/Code/Go/src/github.com/bkzy/grafana/packages/grafana-ui/src/components/JSONFormatter/JSONFormatter.tsx","webpack:///d:/Code/Go/src/github.com/bkzy/grafana/packages/grafana-ui/src/components/JSONFormatter/json_explorer/helpers.ts","webpack:///d:/Code/Go/src/github.com/bkzy/grafana/packages/grafana-ui/src/components/JSONFormatter/json_explorer/json_explorer.ts","webpack:///d:/Code/Go/src/github.com/bkzy/grafana/packages/grafana-ui/src/components/Legend/Legend.tsx","webpack:///d:/Code/Go/src/github.com/bkzy/grafana/packages/grafana-ui/src/components/Legend/LegendList.tsx","webpack:///d:/Code/Go/src/github.com/bkzy/grafana/packages/grafana-ui/src/components/Legend/LegendSeriesIcon.tsx","webpack:///d:/Code/Go/src/github.com/bkzy/grafana/packages/grafana-ui/src/components/Legend/LegendStatsList.tsx","webpack:///d:/Code/Go/src/github.com/bkzy/grafana/packages/grafana-ui/src/components/Legend/LegendTable.tsx","webpack:///d:/Code/Go/src/github.com/bkzy/grafana/packages/grafana-ui/src/components/Legend/SeriesIcon.tsx","webpack:///d:/Code/Go/src/github.com/bkzy/grafana/packages/grafana-ui/src/components/List/AbstractList.tsx","webpack:///d:/Code/Go/src/github.com/bkzy/grafana/packages/grafana-ui/src/components/List/InlineList.tsx","webpack:///d:/Code/Go/src/github.com/bkzy/grafana/packages/grafana-ui/src/components/List/List.tsx","webpack:///d:/Code/Go/src/github.com/bkzy/grafana/packages/grafana-ui/src/components/LoadingPlaceholder/LoadingPlaceholder.tsx","webpack:///d:/Code/Go/src/github.com/bkzy/grafana/packages/grafana-ui/src/components/Logs/LogDetails.tsx","webpack:///d:/Code/Go/src/github.com/bkzy/grafana/packages/grafana-ui/src/components/Logs/LogDetailsRow.tsx","webpack:///d:/Code/Go/src/github.com/bkzy/grafana/packages/grafana-ui/src/components/Logs/LogLabelStats.tsx","webpack:///d:/Code/Go/src/github.com/bkzy/grafana/packages/grafana-ui/src/components/Logs/LogLabelStatsRow.tsx","webpack:///d:/Code/Go/src/github.com/bkzy/grafana/packages/grafana-ui/src/components/Logs/LogLabels.tsx","webpack:///d:/Code/Go/src/github.com/bkzy/grafana/packages/grafana-ui/src/components/Logs/LogMessageAnsi.tsx","webpack:///d:/Code/Go/src/github.com/bkzy/grafana/packages/grafana-ui/src/components/Logs/LogRow.tsx","webpack:///d:/Code/Go/src/github.com/bkzy/grafana/packages/grafana-ui/src/components/Logs/LogRowContext.tsx","webpack:///d:/Code/Go/src/github.com/bkzy/grafana/packages/grafana-ui/src/components/Logs/LogRowContextProvider.tsx","webpack:///d:/Code/Go/src/github.com/bkzy/grafana/packages/grafana-ui/src/components/Logs/LogRowMessage.tsx","webpack:///d:/Code/Go/src/github.com/bkzy/grafana/packages/grafana-ui/src/components/Logs/LogRows.tsx","webpack:///d:/Code/Go/src/github.com/bkzy/grafana/packages/grafana-ui/src/components/Logs/getLogRowStyles.ts","webpack:///d:/Code/Go/src/github.com/bkzy/grafana/packages/grafana-ui/src/components/Modal/Modal.tsx","webpack:///d:/Code/Go/src/github.com/bkzy/grafana/packages/grafana-ui/src/components/PanelOptionsGrid/PanelOptionsGrid.tsx","webpack:///d:/Code/Go/src/github.com/bkzy/grafana/packages/grafana-ui/src/components/PanelOptionsGroup/PanelOptionsGroup.tsx","webpack:///d:/Code/Go/src/github.com/bkzy/grafana/packages/grafana-ui/src/components/PieChart/PieChart.tsx","webpack:///d:/Code/Go/src/github.com/bkzy/grafana/packages/grafana-ui/src/components/Portal/Portal.tsx","webpack:///d:/Code/Go/src/github.com/bkzy/grafana/packages/grafana-ui/src/components/QueryField/QueryField.tsx","webpack:///d:/Code/Go/src/github.com/bkzy/grafana/packages/grafana-ui/src/components/RefreshPicker/RefreshPicker.tsx","webpack:///d:/Code/Go/src/github.com/bkzy/grafana/packages/grafana-ui/src/components/SecretFormFied/SecretFormField.tsx","webpack:///d:/Code/Go/src/github.com/bkzy/grafana/packages/grafana-ui/src/components/Segment/Segment.tsx","webpack:///d:/Code/Go/src/github.com/bkzy/grafana/packages/grafana-ui/src/components/Segment/SegmentAsync.tsx","webpack:///d:/Code/Go/src/github.com/bkzy/grafana/packages/grafana-ui/src/components/Segment/SegmentInput.tsx","webpack:///d:/Code/Go/src/github.com/bkzy/grafana/packages/grafana-ui/src/components/Segment/SegmentSelect.tsx","webpack:///d:/Code/Go/src/github.com/bkzy/grafana/packages/grafana-ui/src/components/Segment/index.ts","webpack:///d:/Code/Go/src/github.com/bkzy/grafana/packages/grafana-ui/src/components/Segment/useExpandableLabel.tsx","webpack:///d:/Code/Go/src/github.com/bkzy/grafana/packages/grafana-ui/src/components/Select/ButtonSelect.tsx","webpack:///d:/Code/Go/src/github.com/bkzy/grafana/packages/grafana-ui/src/components/Select/IndicatorsContainer.tsx","webpack:///d:/Code/Go/src/github.com/bkzy/grafana/packages/grafana-ui/src/components/Select/NoOptionsMessage.tsx","webpack:///d:/Code/Go/src/github.com/bkzy/grafana/packages/grafana-ui/src/components/Select/Select.tsx","webpack:///d:/Code/Go/src/github.com/bkzy/grafana/packages/grafana-ui/src/components/Select/SelectOption.tsx","webpack:///d:/Code/Go/src/github.com/bkzy/grafana/packages/grafana-ui/src/components/SetInterval/SetInterval.tsx","webpack:///d:/Code/Go/src/github.com/bkzy/grafana/packages/grafana-ui/src/components/SingleStatShared/FieldDisplayEditor.tsx","webpack:///d:/Code/Go/src/github.com/bkzy/grafana/packages/grafana-ui/src/components/SingleStatShared/FieldPropertiesEditor.tsx","webpack:///d:/Code/Go/src/github.com/bkzy/grafana/packages/grafana-ui/src/components/SingleStatShared/SingleStatBaseOptions.ts","webpack:///d:/Code/Go/src/github.com/bkzy/grafana/packages/grafana-ui/src/components/SingleStatShared/index.ts","webpack:///d:/Code/Go/src/github.com/bkzy/grafana/packages/grafana-ui/src/components/Spinner/Spinner.tsx","webpack:///d:/Code/Go/src/github.com/bkzy/grafana/packages/grafana-ui/src/components/StatsPicker/StatsPicker.tsx","webpack:///d:/Code/Go/src/github.com/bkzy/grafana/packages/grafana-ui/src/components/Switch/Switch.tsx","webpack:///d:/Code/Go/src/github.com/bkzy/grafana/packages/grafana-ui/src/components/Table/BackgroundColorCell.tsx","webpack:///d:/Code/Go/src/github.com/bkzy/grafana/packages/grafana-ui/src/components/Table/BarGaugeCell.tsx","webpack:///d:/Code/Go/src/github.com/bkzy/grafana/packages/grafana-ui/src/components/Table/DefaultCell.tsx","webpack:///d:/Code/Go/src/github.com/bkzy/grafana/packages/grafana-ui/src/components/Table/Table.tsx","webpack:///d:/Code/Go/src/github.com/bkzy/grafana/packages/grafana-ui/src/components/Table/TableCell.tsx","webpack:///d:/Code/Go/src/github.com/bkzy/grafana/packages/grafana-ui/src/components/Table/styles.ts","webpack:///d:/Code/Go/src/github.com/bkzy/grafana/packages/grafana-ui/src/components/Table/types.ts","webpack:///d:/Code/Go/src/github.com/bkzy/grafana/packages/grafana-ui/src/components/Table/utils.ts","webpack:///d:/Code/Go/src/github.com/bkzy/grafana/packages/grafana-ui/src/components/TableInputCSV/TableInputCSV.tsx","webpack:///d:/Code/Go/src/github.com/bkzy/grafana/packages/grafana-ui/src/components/Tabs/Tab.tsx","webpack:///d:/Code/Go/src/github.com/bkzy/grafana/packages/grafana-ui/src/components/Tabs/TabContent.tsx","webpack:///d:/Code/Go/src/github.com/bkzy/grafana/packages/grafana-ui/src/components/Tabs/TabsBar.tsx","webpack:///d:/Code/Go/src/github.com/bkzy/grafana/packages/grafana-ui/src/components/TagsInput/TagItem.tsx","webpack:///d:/Code/Go/src/github.com/bkzy/grafana/packages/grafana-ui/src/components/TagsInput/TagsInput.tsx","webpack:///d:/Code/Go/src/github.com/bkzy/grafana/packages/grafana-ui/src/components/ThresholdsEditor/ThresholdsEditor.tsx","webpack:///d:/Code/Go/src/github.com/bkzy/grafana/packages/grafana-ui/src/components/TimePicker/TimeOfDayPicker.tsx","webpack:///d:/Code/Go/src/github.com/bkzy/grafana/packages/grafana-ui/src/components/TimePicker/TimePicker.tsx","webpack:///d:/Code/Go/src/github.com/bkzy/grafana/packages/grafana-ui/src/components/TimePicker/TimePickerContent/TimePickerCalendar.tsx","webpack:///d:/Code/Go/src/github.com/bkzy/grafana/packages/grafana-ui/src/components/TimePicker/TimePickerContent/TimePickerContent.tsx","webpack:///d:/Code/Go/src/github.com/bkzy/grafana/packages/grafana-ui/src/components/TimePicker/TimePickerContent/TimePickerTitle.tsx","webpack:///d:/Code/Go/src/github.com/bkzy/grafana/packages/grafana-ui/src/components/TimePicker/TimePickerContent/TimeRangeForm.tsx","webpack:///d:/Code/Go/src/github.com/bkzy/grafana/packages/grafana-ui/src/components/TimePicker/TimePickerContent/TimeRangeList.tsx","webpack:///d:/Code/Go/src/github.com/bkzy/grafana/packages/grafana-ui/src/components/TimePicker/TimePickerContent/TimeRangeOption.tsx","webpack:///d:/Code/Go/src/github.com/bkzy/grafana/packages/grafana-ui/src/components/TimePicker/TimePickerContent/colors.ts","webpack:///d:/Code/Go/src/github.com/bkzy/grafana/packages/grafana-ui/src/components/TimePicker/TimePickerContent/mapper.ts","webpack:///d:/Code/Go/src/github.com/bkzy/grafana/packages/grafana-ui/src/components/TimePicker/time.ts","webpack:///d:/Code/Go/src/github.com/bkzy/grafana/packages/grafana-ui/src/components/ToggleButtonGroup/ToggleButtonGroup.tsx","webpack:///d:/Code/Go/src/github.com/bkzy/grafana/packages/grafana-ui/src/components/Tooltip/Popover.tsx","webpack:///d:/Code/Go/src/github.com/bkzy/grafana/packages/grafana-ui/src/components/Tooltip/PopoverController.tsx","webpack:///d:/Code/Go/src/github.com/bkzy/grafana/packages/grafana-ui/src/components/Tooltip/Tooltip.tsx","webpack:///d:/Code/Go/src/github.com/bkzy/grafana/packages/grafana-ui/src/components/TransformersUI/FilterByNameTransformerEditor.tsx","webpack:///d:/Code/Go/src/github.com/bkzy/grafana/packages/grafana-ui/src/components/TransformersUI/FilterByRefIdTransformerEditor.tsx","webpack:///d:/Code/Go/src/github.com/bkzy/grafana/packages/grafana-ui/src/components/TransformersUI/ReduceTransformerEditor.tsx","webpack:///d:/Code/Go/src/github.com/bkzy/grafana/packages/grafana-ui/src/components/TransformersUI/TransformationRow.tsx","webpack:///d:/Code/Go/src/github.com/bkzy/grafana/packages/grafana-ui/src/components/TransformersUI/TransformationsEditor.tsx","webpack:///d:/Code/Go/src/github.com/bkzy/grafana/packages/grafana-ui/src/components/TransformersUI/transformers.ts","webpack:///d:/Code/Go/src/github.com/bkzy/grafana/packages/grafana-ui/src/components/Typeahead/Typeahead.tsx","webpack:///d:/Code/Go/src/github.com/bkzy/grafana/packages/grafana-ui/src/components/Typeahead/TypeaheadInfo.tsx","webpack:///d:/Code/Go/src/github.com/bkzy/grafana/packages/grafana-ui/src/components/Typeahead/TypeaheadItem.tsx","webpack:///d:/Code/Go/src/github.com/bkzy/grafana/packages/grafana-ui/src/components/UnitPicker/UnitPicker.tsx","webpack:///d:/Code/Go/src/github.com/bkzy/grafana/packages/grafana-ui/src/components/ValueMappingsEditor/MappingRow.tsx","webpack:///d:/Code/Go/src/github.com/bkzy/grafana/packages/grafana-ui/src/components/ValueMappingsEditor/ValueMappingsEditor.tsx","webpack:///d:/Code/Go/src/github.com/bkzy/grafana/packages/grafana-ui/src/components/VizRepeater/VizRepeater.tsx","webpack:///d:/Code/Go/src/github.com/bkzy/grafana/packages/grafana-ui/src/components/index.ts","webpack:///d:/Code/Go/src/github.com/bkzy/grafana/packages/grafana-ui/src/components/transitions/FadeTransition.tsx","webpack:///d:/Code/Go/src/github.com/bkzy/grafana/packages/grafana-ui/src/components/transitions/SlideOutTransition.tsx","webpack:///d:/Code/Go/src/github.com/bkzy/grafana/packages/grafana-ui/src/index.ts","webpack:///d:/Code/Go/src/github.com/bkzy/grafana/packages/grafana-ui/src/slate-plugins/braces.ts","webpack:///d:/Code/Go/src/github.com/bkzy/grafana/packages/grafana-ui/src/slate-plugins/clear.ts","webpack:///d:/Code/Go/src/github.com/bkzy/grafana/packages/grafana-ui/src/slate-plugins/clipboard.ts","webpack:///d:/Code/Go/src/github.com/bkzy/grafana/packages/grafana-ui/src/slate-plugins/indentation.ts","webpack:///d:/Code/Go/src/github.com/bkzy/grafana/packages/grafana-ui/src/slate-plugins/index.ts","webpack:///d:/Code/Go/src/github.com/bkzy/grafana/packages/grafana-ui/src/slate-plugins/newline.ts","webpack:///d:/Code/Go/src/github.com/bkzy/grafana/packages/grafana-ui/src/slate-plugins/runner.ts","webpack:///d:/Code/Go/src/github.com/bkzy/grafana/packages/grafana-ui/src/slate-plugins/selection_shortcuts.ts","webpack:///d:/Code/Go/src/github.com/bkzy/grafana/packages/grafana-ui/src/slate-plugins/slate-prism/TOKEN_MARK.ts","webpack:///d:/Code/Go/src/github.com/bkzy/grafana/packages/grafana-ui/src/slate-plugins/slate-prism/index.ts","webpack:///d:/Code/Go/src/github.com/bkzy/grafana/packages/grafana-ui/src/slate-plugins/slate-prism/options.tsx","webpack:///d:/Code/Go/src/github.com/bkzy/grafana/packages/grafana-ui/src/slate-plugins/suggestions.tsx","webpack:///d:/Code/Go/src/github.com/bkzy/grafana/packages/grafana-ui/src/themes/ThemeContext.tsx","webpack:///d:/Code/Go/src/github.com/bkzy/grafana/packages/grafana-ui/src/themes/dark.ts","webpack:///d:/Code/Go/src/github.com/bkzy/grafana/packages/grafana-ui/src/themes/default.ts","webpack:///d:/Code/Go/src/github.com/bkzy/grafana/packages/grafana-ui/src/themes/getTheme.ts","webpack:///d:/Code/Go/src/github.com/bkzy/grafana/packages/grafana-ui/src/themes/index.ts","webpack:///d:/Code/Go/src/github.com/bkzy/grafana/packages/grafana-ui/src/themes/light.ts","webpack:///d:/Code/Go/src/github.com/bkzy/grafana/packages/grafana-ui/src/themes/mixins.ts","webpack:///d:/Code/Go/src/github.com/bkzy/grafana/packages/grafana-ui/src/themes/selectThemeVariant.ts","webpack:///d:/Code/Go/src/github.com/bkzy/grafana/packages/grafana-ui/src/themes/stylesFactory.ts","webpack:///d:/Code/Go/src/github.com/bkzy/grafana/packages/grafana-ui/src/types/completion.ts","webpack:///d:/Code/Go/src/github.com/bkzy/grafana/packages/grafana-ui/src/types/index.ts","webpack:///d:/Code/Go/src/github.com/bkzy/grafana/packages/grafana-ui/src/utils/ansicolor.ts","webpack:///d:/Code/Go/src/github.com/bkzy/grafana/packages/grafana-ui/src/utils/colors.ts","webpack:///d:/Code/Go/src/github.com/bkzy/grafana/packages/grafana-ui/src/utils/dataLinks.ts","webpack:///d:/Code/Go/src/github.com/bkzy/grafana/packages/grafana-ui/src/utils/dom.ts","webpack:///d:/Code/Go/src/github.com/bkzy/grafana/packages/grafana-ui/src/utils/index.ts","webpack:///d:/Code/Go/src/github.com/bkzy/grafana/packages/grafana-ui/src/utils/measureText.ts","webpack:///d:/Code/Go/src/github.com/bkzy/grafana/packages/grafana-ui/src/utils/slate.ts","webpack:///d:/Code/Go/src/github.com/bkzy/grafana/packages/grafana-ui/src/utils/tags.ts","webpack:///d:/Code/Go/src/github.com/bkzy/grafana/packages/grafana-ui/src/utils/typeahead.ts","webpack:///d:/Code/Go/src/github.com/bkzy/grafana/packages/grafana-ui/src/utils/useClientRect.ts","webpack:///d:/Code/Go/src/github.com/bkzy/grafana/packages/grafana-ui/src/utils/useDelayedSwitch.ts","webpack:///d:/Code/Go/src/github.com/bkzy/grafana/packages/grafana-ui/src/utils/validate.ts","webpack:///./public/app/app.ts","webpack:///./public/app/core/actions/cleanUp.ts","webpack:///./public/app/core/actions/index.ts","webpack:///./public/app/core/angular_wrappers.ts","webpack:///./public/app/core/app_events.ts","webpack:///./public/app/core/components/Animations/SlideDown.tsx","webpack:///./public/app/core/components/AppNotifications/AppNotificationItem.tsx","webpack:///./public/app/core/components/AppNotifications/AppNotificationList.tsx","webpack:///./public/app/core/components/Branding/Branding.tsx","webpack:///./public/app/core/components/DynamicImports/ErrorLoadingChunk.tsx","webpack:///./public/app/core/components/DynamicImports/LoadingChunkPlaceHolder.tsx","webpack:///./public/app/core/components/DynamicImports/SafeDynamicImport.tsx","webpack:///./public/app/core/components/EmptyListCTA/EmptyListCTA.tsx","webpack:///./public/app/core/components/Footer/Footer.tsx","webpack:///./public/app/core/components/LayoutSelector/LayoutSelector.tsx","webpack:///./public/app/core/components/LocalStorageValueProvider/LocalStorageValueProvider.tsx","webpack:///./public/app/core/components/LocalStorageValueProvider/index.tsx","webpack:///./public/app/core/components/Login/ChangePassword.tsx","webpack:///./public/app/core/components/Login/LoginCtrl.tsx","webpack:///./public/app/core/components/Login/LoginForm.tsx","webpack:///./public/app/core/components/Login/LoginPage.tsx","webpack:///./public/app/core/components/Login/LoginServiceButtons.tsx","webpack:///./public/app/core/components/Login/UserSignup.tsx","webpack:///./public/app/core/components/OrgSwitcher.tsx","webpack:///./public/app/core/components/Page/Page.tsx","webpack:///./public/app/core/components/Page/PageContents.tsx","webpack:///./public/app/core/components/PageHeader/PageHeader.tsx","webpack:///./public/app/core/components/PageLoader/PageLoader.tsx","webpack:///./public/app/core/components/PermissionList/AddPermission.tsx","webpack:///./public/app/core/components/PermissionList/DisabledPermissionListItem.tsx","webpack:///./public/app/core/components/PermissionList/PermissionList.tsx","webpack:///./public/app/core/components/PermissionList/PermissionListItem.tsx","webpack:///./public/app/core/components/PermissionList/PermissionsInfo.tsx","webpack:///./public/app/core/components/Select/MetricSelect.tsx","webpack:///./public/app/core/components/Select/OrgPicker.tsx","webpack:///./public/app/core/components/Select/TeamPicker.tsx","webpack:///./public/app/core/components/Select/UserPicker.tsx","webpack:///./public/app/core/components/SharedPreferences/SharedPreferences.tsx","webpack:///./public/app/core/components/TagFilter/TagBadge.tsx","webpack:///./public/app/core/components/TagFilter/TagFilter.tsx","webpack:///./public/app/core/components/TagFilter/TagOption.tsx","webpack:///./public/app/core/components/TimePicker/TimePickerWithHistory.tsx","webpack:///./public/app/core/components/code_editor/code_editor.ts","webpack:///./public/app/core/components/colorpicker/spectrum_picker.ts","webpack:///./public/app/core/components/dashboard_selector.ts","webpack:///./public/app/core/components/form_dropdown/form_dropdown.ts","webpack:///./public/app/core/components/help/HelpModal.tsx","webpack:///./public/app/core/components/info_popover.ts","webpack:///./public/app/core/components/jsontree/jsontree.ts","webpack:///./public/app/core/components/layout_selector/layout_selector.ts","webpack:///./public/app/core/components/manage_dashboards/manage_dashboards.ts","webpack:///./public/app/core/components/query_part/query_part.ts","webpack:///./public/app/core/components/query_part/query_part_editor.ts","webpack:///./public/app/core/components/scroll/scroll.ts","webpack:///./public/app/core/components/search/SearchField.tsx","webpack:///./public/app/core/components/search/search.ts","webpack:///./public/app/core/components/search/search_results.ts","webpack:///./public/app/core/components/sidemenu/BottomNavLinks.tsx","webpack:///./public/app/core/components/sidemenu/BottomSection.tsx","webpack:///./public/app/core/components/sidemenu/DropDownChild.tsx","webpack:///./public/app/core/components/sidemenu/SideMenu.tsx","webpack:///./public/app/core/components/sidemenu/SideMenuDropDown.tsx","webpack:///./public/app/core/components/sidemenu/SignIn.tsx","webpack:///./public/app/core/components/sidemenu/TopSection.tsx","webpack:///./public/app/core/components/sidemenu/TopSectionItem.tsx","webpack:///./public/app/core/components/sql_part/sql_part_editor.ts","webpack:///./public/app/core/components/switch.ts","webpack:///./public/app/core/config.ts","webpack:///./public/app/core/constants.ts","webpack:///./public/app/core/controllers/all.ts","webpack:///./public/app/core/controllers/error_ctrl.ts","webpack:///./public/app/core/controllers/invited_ctrl.ts","webpack:///./public/app/core/controllers/json_editor_ctrl.ts","webpack:///./public/app/core/controllers/reset_password_ctrl.ts","webpack:///./public/app/core/controllers/signup_ctrl.ts","webpack:///./public/app/core/copy/appNotification.ts","webpack:///./public/app/core/core.ts","webpack:///./public/app/core/core_module.ts","webpack:///./public/app/core/directives/array_join.ts","webpack:///./public/app/core/directives/autofill_event_fix.ts","webpack:///./public/app/core/directives/diff-view.ts","webpack:///./public/app/core/directives/dropdown_typeahead.ts","webpack:///./public/app/core/directives/give_focus.ts","webpack:///./public/app/core/directives/metric_segment.ts","webpack:///./public/app/core/directives/misc.ts","webpack:///./public/app/core/directives/ng_model_on_blur.ts","webpack:///./public/app/core/directives/rebuild_on_change.ts","webpack:///./public/app/core/directives/tags.ts","webpack:///./public/app/core/directives/value_select_dropdown.ts","webpack:///./public/app/core/filters/filters.ts","webpack:///./public/app/core/hooks/useRefMounted.ts","webpack:///./public/app/core/jquery_extended.ts","webpack:///./public/app/core/live/live_srv.ts","webpack:///./public/app/core/logs_model.ts","webpack:///./public/app/core/middlewares/application.ts","webpack:///./public/app/core/nav_model_srv.ts","webpack:///./public/app/core/partials.ts","webpack:///./public/app/core/profiler.ts","webpack:///./public/app/core/reducers/appNotification.ts","webpack:///./public/app/core/reducers/application.ts","webpack:///./public/app/core/reducers/index.ts","webpack:///./public/app/core/reducers/location.ts","webpack:///./public/app/core/reducers/navModel.ts","webpack:///./public/app/core/reducers/root.ts","webpack:///./public/app/core/selectors/location.ts","webpack:///./public/app/core/selectors/navModel.ts","webpack:///./public/app/core/services/AngularLoader.ts","webpack:///./public/app/core/services/alert_srv.ts","webpack:///./public/app/core/services/all.ts","webpack:///./public/app/core/services/analytics.ts","webpack:///./public/app/core/services/backend_srv.ts","webpack:///./public/app/core/services/bridge_srv.ts","webpack:///./public/app/core/services/context_srv.ts","webpack:///./public/app/core/services/dynamic_directive_srv.ts","webpack:///./public/app/core/services/echo/Echo.ts","webpack:///./public/app/core/services/echo/EchoSrv.ts","webpack:///./public/app/core/services/echo/backends/PerformanceBackend.ts","webpack:///./public/app/core/services/impression_srv.ts","webpack:///./public/app/core/services/keybindingSrv.ts","webpack:///./public/app/core/services/ng_react.ts","webpack:///./public/app/core/services/popover_srv.ts","webpack:///./public/app/core/services/search_srv.ts","webpack:///./public/app/core/services/segment_srv.ts","webpack:///./public/app/core/services/timer.ts","webpack:///./public/app/core/services/util_srv.ts","webpack:///./public/app/core/store.ts","webpack:///./public/app/core/table_model.ts","webpack:///./public/app/core/time_series2.ts","webpack:///./public/app/core/utils/ConfigProvider.tsx","webpack:///./public/app/core/utils/UserProvider.tsx","webpack:///./public/app/core/utils/acl.ts","webpack:///./public/app/core/utils/browser.ts","webpack:///./public/app/core/utils/colors.ts","webpack:///./public/app/core/utils/connectWithReduxStore.tsx","webpack:///./public/app/core/utils/dag.ts","webpack:///./public/app/core/utils/emitter.ts","webpack:///./public/app/core/utils/errors.ts","webpack:///./public/app/core/utils/explore.ts","webpack:///./public/app/core/utils/factors.ts","webpack:///./public/app/core/utils/file_export.ts","webpack:///./public/app/core/utils/flatten.ts","webpack:///./public/app/core/utils/kbn.ts","webpack:///./public/app/core/utils/location_util.ts","webpack:///./public/app/core/utils/model_utils.ts","webpack:///./public/app/core/utils/outline.ts","webpack:///./public/app/core/utils/promiseToDigest.ts","webpack:///./public/app/core/utils/query.ts","webpack:///./public/app/core/utils/react2angular.ts","webpack:///./public/app/core/utils/scrollbar.ts","webpack:///./public/app/core/utils/sort_by_keys.ts","webpack:///./public/app/core/utils/text.ts","webpack:///./public/app/core/utils/ticks.ts","webpack:///./public/app/core/utils/timePicker.ts","webpack:///./public/app/core/utils/url.ts","webpack:///./public/app/features/admin/AdminEditOrgCtrl.ts","webpack:///./public/app/features/admin/AdminEditUserCtrl.ts","webpack:///./public/app/features/admin/AdminListOrgsCtrl.ts","webpack:///./public/app/features/admin/AdminListUsersCtrl.ts","webpack:///./public/app/features/admin/UserAdminPage.tsx","webpack:///./public/app/features/admin/UserLdapSyncInfo.tsx","webpack:///./public/app/features/admin/UserOrgs.tsx","webpack:///./public/app/features/admin/UserPermissions.tsx","webpack:///./public/app/features/admin/UserProfile.tsx","webpack:///./public/app/features/admin/UserSessions.tsx","webpack:///./public/app/features/admin/index.ts","webpack:///./public/app/features/admin/ldap/LdapConnectionStatus.tsx","webpack:///./public/app/features/admin/ldap/LdapPage.tsx","webpack:///./public/app/features/admin/ldap/LdapSyncInfo.tsx","webpack:///./public/app/features/admin/ldap/LdapUserGroups.tsx","webpack:///./public/app/features/admin/ldap/LdapUserInfo.tsx","webpack:///./public/app/features/admin/ldap/LdapUserMappingInfo.tsx","webpack:///./public/app/features/admin/ldap/LdapUserPermissions.tsx","webpack:///./public/app/features/admin/ldap/LdapUserTeams.tsx","webpack:///./public/app/features/admin/state/actions.ts","webpack:///./public/app/features/admin/state/reducers.ts","webpack:///./public/app/features/alerting/AlertTabCtrl.ts","webpack:///./public/app/features/alerting/NotificationsEditCtrl.ts","webpack:///./public/app/features/alerting/NotificationsListCtrl.ts","webpack:///./public/app/features/alerting/getAlertingValidationMessage.ts","webpack:///./public/app/features/alerting/state/ThresholdMapper.ts","webpack:///./public/app/features/alerting/state/alertDef.ts","webpack:///./public/app/features/alerting/state/reducers.ts","webpack:///./public/app/features/all.ts","webpack:///./public/app/features/annotations/all.ts","webpack:///./public/app/features/annotations/annotation_tooltip.ts","webpack:///./public/app/features/annotations/annotations_srv.ts","webpack:///./public/app/features/annotations/editor_ctrl.ts","webpack:///./public/app/features/annotations/event_editor.ts","webpack:///./public/app/features/annotations/event_manager.ts","webpack:///./public/app/features/annotations/events_processing.ts","webpack:///./public/app/features/api-keys/state/reducers.ts","webpack:///./public/app/features/dashboard/components/AdHocFilters/AdHocFiltersCtrl.ts","webpack:///./public/app/features/dashboard/components/AdHocFilters/index.ts","webpack:///./public/app/features/dashboard/components/DashExportModal/DashExportCtrl.ts","webpack:///./public/app/features/dashboard/components/DashExportModal/DashboardExporter.ts","webpack:///./public/app/features/dashboard/components/DashExportModal/index.ts","webpack:///./public/app/features/dashboard/components/DashLinks/DashLinksContainerCtrl.ts","webpack:///./public/app/features/dashboard/components/DashLinks/DashLinksEditorCtrl.ts","webpack:///./public/app/features/dashboard/components/DashLinks/index.ts","webpack:///./public/app/features/dashboard/components/DashNav/DashNav.tsx","webpack:///./public/app/features/dashboard/components/DashNav/DashNavButton.tsx","webpack:///./public/app/features/dashboard/components/DashNav/DashNavTimeControls.tsx","webpack:///./public/app/features/dashboard/components/DashNav/index.ts","webpack:///./public/app/features/dashboard/components/DashboardPermissions/DashboardPermissions.tsx","webpack:///./public/app/features/dashboard/components/DashboardSettings/DashboardSettings.tsx","webpack:///./public/app/features/dashboard/components/DashboardSettings/SettingsCtrl.ts","webpack:///./public/app/features/dashboard/components/DashboardSettings/TimePickerSettings.ts","webpack:///./public/app/features/dashboard/components/DashboardSettings/index.ts","webpack:///./public/app/features/dashboard/components/ExportDataModal/ExportDataModalCtrl.ts","webpack:///./public/app/features/dashboard/components/ExportDataModal/index.ts","webpack:///./public/app/features/dashboard/components/FolderPicker/FolderPickerCtrl.ts","webpack:///./public/app/features/dashboard/components/FolderPicker/index.ts","webpack:///./public/app/features/dashboard/components/RowOptions/RowOptionsCtrl.ts","webpack:///./public/app/features/dashboard/components/RowOptions/index.ts","webpack:///./public/app/features/dashboard/components/SaveModals/SaveDashboardAsModalCtrl.ts","webpack:///./public/app/features/dashboard/components/SaveModals/SaveDashboardModalCtrl.ts","webpack:///./public/app/features/dashboard/components/SaveModals/SaveProvisionedDashboardModalCtrl.ts","webpack:///./public/app/features/dashboard/components/SaveModals/index.ts","webpack:///./public/app/features/dashboard/components/ShareModal/ShareModalCtrl.ts","webpack:///./public/app/features/dashboard/components/ShareModal/ShareSnapshotCtrl.ts","webpack:///./public/app/features/dashboard/components/ShareModal/index.ts","webpack:///./public/app/features/dashboard/components/SubMenu/SubMenu.tsx","webpack:///./public/app/features/dashboard/components/SubMenu/SubMenuCtrl.ts","webpack:///./public/app/features/dashboard/components/SubMenu/index.ts","webpack:///./public/app/features/dashboard/components/UnsavedChangesModal/UnsavedChangesModalCtrl.ts","webpack:///./public/app/features/dashboard/components/UnsavedChangesModal/index.ts","webpack:///./public/app/features/dashboard/components/VersionHistory/HistoryListCtrl.ts","webpack:///./public/app/features/dashboard/components/VersionHistory/HistorySrv.ts","webpack:///./public/app/features/dashboard/components/VersionHistory/index.ts","webpack:///./public/app/features/dashboard/dashgrid/PanelPluginError.tsx","webpack:///./public/app/features/dashboard/index.ts","webpack:///./public/app/features/dashboard/panel_editor/QueryEditorRow.tsx","webpack:///./public/app/features/dashboard/panel_editor/state/reducers.ts","webpack:///./public/app/features/dashboard/services/ChangeTracker.ts","webpack:///./public/app/features/dashboard/services/DashboardLoaderSrv.ts","webpack:///./public/app/features/dashboard/services/DashboardSrv.ts","webpack:///./public/app/features/dashboard/services/TimeSrv.ts","webpack:///./public/app/features/dashboard/services/UnsavedChangesSrv.ts","webpack:///./public/app/features/dashboard/state/DashboardMigrator.ts","webpack:///./public/app/features/dashboard/state/DashboardModel.ts","webpack:///./public/app/features/dashboard/state/PanelModel.ts","webpack:///./public/app/features/dashboard/state/PanelQueryRunner.ts","webpack:///./public/app/features/dashboard/state/actions.ts","webpack:///./public/app/features/dashboard/state/analyticsProcessor.ts","webpack:///./public/app/features/dashboard/state/reducers.ts","webpack:///./public/app/features/dashboard/state/runRequest.ts","webpack:///./public/app/features/dashboard/utils/panel.ts","webpack:///./public/app/features/datasources/settings/HttpSettingsCtrl.ts","webpack:///./public/app/features/datasources/settings/TlsAuthSettingsCtrl.ts","webpack:///./public/app/features/datasources/state/reducers.ts","webpack:///./public/app/features/explore/state/actionTypes.ts","webpack:///./public/app/features/explore/state/reducers.ts","webpack:///./public/app/features/explore/utils/ResultProcessor.ts","webpack:///./public/app/features/expressions/ExpressionDatasource.ts","webpack:///./public/app/features/expressions/ExpressionQueryEditor.tsx","webpack:///./public/app/features/expressions/types.ts","webpack:///./public/app/features/folders/CreateFolderCtrl.ts","webpack:///./public/app/features/folders/FolderDashboardsCtrl.ts","webpack:///./public/app/features/folders/services/FolderPageLoader.ts","webpack:///./public/app/features/folders/state/reducers.ts","webpack:///./public/app/features/manage-dashboards/DashboardImportCtrl.ts","webpack:///./public/app/features/manage-dashboards/DashboardListCtrl.ts","webpack:///./public/app/features/manage-dashboards/SnapshotListCtrl.ts","webpack:///./public/app/features/manage-dashboards/components/MoveToFolderModal/MoveToFolderCtrl.ts","webpack:///./public/app/features/manage-dashboards/components/MoveToFolderModal/index.ts","webpack:///./public/app/features/manage-dashboards/components/UploadDashboard/index.ts","webpack:///./public/app/features/manage-dashboards/components/UploadDashboard/uploadDashboardDirective.ts","webpack:///./public/app/features/manage-dashboards/index.ts","webpack:///./public/app/features/manage-dashboards/services/ValidationSrv.ts","webpack:///./public/app/features/org/NewOrgCtrl.ts","webpack:///./public/app/features/org/SelectOrgCtrl.ts","webpack:///./public/app/features/org/UserInviteCtrl.ts","webpack:///./public/app/features/org/all.ts","webpack:///./public/app/features/org/state/reducers.ts","webpack:///./public/app/features/panel/all.ts","webpack:///./public/app/features/panel/metrics_panel_ctrl.ts","webpack:///./public/app/features/panel/panel_ctrl.ts","webpack:///./public/app/features/panel/panel_directive.ts","webpack:///./public/app/features/panel/panel_editor_tab.ts","webpack:///./public/app/features/panel/panel_header.ts","webpack:///./public/app/features/panel/panellinks/fieldDisplayValuesProxy.ts","webpack:///./public/app/features/panel/panellinks/linkSuppliers.ts","webpack:///./public/app/features/panel/panellinks/link_srv.ts","webpack:///./public/app/features/panel/panellinks/module.ts","webpack:///./public/app/features/panel/query_ctrl.ts","webpack:///./public/app/features/panel/query_editor_row.ts","webpack:///./public/app/features/panel/repeat_option.ts","webpack:///./public/app/features/playlist/all.ts","webpack:///./public/app/features/playlist/playlist_edit_ctrl.ts","webpack:///./public/app/features/playlist/playlist_routes.ts","webpack:///./public/app/features/playlist/playlist_search.ts","webpack:///./public/app/features/playlist/playlist_srv.ts","webpack:///./public/app/features/playlist/playlists_ctrl.ts","webpack:///./public/app/features/plugins/PluginSettingsCache.ts","webpack:///./public/app/features/plugins/all.ts","webpack:///./public/app/features/plugins/built_in_plugins.ts","webpack:///./public/app/features/plugins/datasource_srv.ts","webpack:///./public/app/features/plugins/plugin_component.ts","webpack:///./public/app/features/plugins/plugin_loader.ts","webpack:///./public/app/features/plugins/plugin_page_ctrl.ts","webpack:///./public/app/features/plugins/state/actions.ts","webpack:///./public/app/features/plugins/state/reducers.ts","webpack:///./public/app/features/plugins/variableQueryEditorLoader.tsx","webpack:///./public/app/features/profile/ProfileCtrl.ts","webpack:///./public/app/features/profile/ReactProfileWrapper.tsx","webpack:///./public/app/features/profile/UserOrganizations.tsx","webpack:///./public/app/features/profile/UserProfileEditForm.tsx","webpack:///./public/app/features/profile/UserTeams.tsx","webpack:///./public/app/features/profile/all.ts","webpack:///./public/app/features/profile/state/reducers.ts","webpack:///./public/app/features/teams/state/reducers.ts","webpack:///./public/app/features/templating/DefaultVariableQueryEditor.tsx","webpack:///./public/app/features/templating/TextBoxVariable.ts","webpack:///./public/app/features/templating/adhoc_variable.ts","webpack:///./public/app/features/templating/all.ts","webpack:///./public/app/features/templating/constant_variable.ts","webpack:///./public/app/features/templating/custom_variable.ts","webpack:///./public/app/features/templating/datasource_variable.ts","webpack:///./public/app/features/templating/editor_ctrl.ts","webpack:///./public/app/features/templating/interval_variable.ts","webpack:///./public/app/features/templating/query_variable.ts","webpack:///./public/app/features/templating/template_srv.ts","webpack:///./public/app/features/templating/variable.ts","webpack:///./public/app/features/templating/variable_srv.ts","webpack:///./public/app/features/users/state/reducers.ts","webpack:///./public/app/index.ts","webpack:///./public/app/plugins/datasource/cloudwatch/components/Alias.tsx","webpack:///./public/app/plugins/datasource/cloudwatch/components/AnnotationQueryEditor.tsx","webpack:///./public/app/plugins/datasource/cloudwatch/components/Dimensions.tsx","webpack:///./public/app/plugins/datasource/cloudwatch/components/Forms.tsx","webpack:///./public/app/plugins/datasource/cloudwatch/components/QueryFieldsEditor.tsx","webpack:///./public/app/plugins/datasource/cloudwatch/components/Stats.tsx","webpack:///./public/app/plugins/datasource/cloudwatch/components/index.ts","webpack:///./public/app/plugins/datasource/dashboard/DashboardQueryEditor.tsx","webpack:///./public/app/plugins/datasource/dashboard/index.ts","webpack:///./public/app/plugins/datasource/dashboard/runSharedRequest.ts","webpack:///./public/app/plugins/datasource/dashboard/types.ts","webpack:///./public/app/plugins/datasource/graphite/FunctionEditor.tsx","webpack:///./public/app/plugins/datasource/graphite/FunctionEditorControls.tsx","webpack:///./public/app/plugins/datasource/loki/components/AnnotationsQueryEditor.tsx","webpack:///./public/app/plugins/datasource/loki/components/LokiQueryFieldForm.tsx","webpack:///./public/app/plugins/datasource/loki/components/useLokiLabels.ts","webpack:///./public/app/plugins/datasource/loki/components/useLokiSyntax.ts","webpack:///./public/app/plugins/datasource/stackdriver/components/Aggregations.tsx","webpack:///./public/app/plugins/datasource/stackdriver/components/AliasBy.tsx","webpack:///./public/app/plugins/datasource/stackdriver/components/AlignmentPeriods.tsx","webpack:///./public/app/plugins/datasource/stackdriver/components/Alignments.tsx","webpack:///./public/app/plugins/datasource/stackdriver/components/AnnotationQueryEditor.tsx","webpack:///./public/app/plugins/datasource/stackdriver/components/AnnotationsHelp.tsx","webpack:///./public/app/plugins/datasource/stackdriver/components/Filters.tsx","webpack:///./public/app/plugins/datasource/stackdriver/components/GroupBys.tsx","webpack:///./public/app/plugins/datasource/stackdriver/components/Help.tsx","webpack:///./public/app/plugins/datasource/stackdriver/components/Metrics.tsx","webpack:///./public/app/plugins/datasource/stackdriver/components/Project.tsx","webpack:///./public/app/plugins/datasource/stackdriver/components/QueryEditor.tsx","webpack:///./public/app/plugins/datasource/stackdriver/components/SimpleSelect.tsx","webpack:///./public/app/plugins/datasource/stackdriver/components/index.ts","webpack:///./public/app/plugins/datasource/stackdriver/constants.ts","webpack:///./public/app/plugins/datasource/stackdriver/functions.ts","webpack:///./public/app/plugins/panel/alertlist/module.ts","webpack:///./public/app/plugins/panel/annolist/AnnoListEditor.tsx","webpack:///./public/app/plugins/panel/annolist/AnnoListPanel.tsx","webpack:///./public/app/plugins/panel/annolist/module.ts","webpack:///./public/app/plugins/panel/annolist/types.ts","webpack:///./public/app/plugins/panel/bargauge/BarGaugeMigrations.ts","webpack:///./public/app/plugins/panel/bargauge/BarGaugePanel.tsx","webpack:///./public/app/plugins/panel/bargauge/BarGaugePanelEditor.tsx","webpack:///./public/app/plugins/panel/bargauge/module.tsx","webpack:///./public/app/plugins/panel/bargauge/types.ts","webpack:///./public/app/plugins/panel/dashlist/module.ts","webpack:///./public/app/plugins/panel/gauge/GaugeMigrations.ts","webpack:///./public/app/plugins/panel/gauge/GaugePanel.tsx","webpack:///./public/app/plugins/panel/gauge/GaugePanelEditor.tsx","webpack:///./public/app/plugins/panel/gauge/module.tsx","webpack:///./public/app/plugins/panel/gauge/types.ts","webpack:///./public/app/plugins/panel/gettingstarted/GettingStarted.tsx","webpack:///./public/app/plugins/panel/gettingstarted/module.ts","webpack:///./public/app/plugins/panel/graph/GraphContextMenuCtrl.ts","webpack:///./public/app/plugins/panel/graph/Legend/Legend.tsx","webpack:///./public/app/plugins/panel/graph/Legend/LegendSeriesItem.tsx","webpack:///./public/app/plugins/panel/graph/align_yaxes.ts","webpack:///./public/app/plugins/panel/graph/axes_editor.ts","webpack:///./public/app/plugins/panel/graph/data_processor.ts","webpack:///./public/app/plugins/panel/graph/graph.ts","webpack:///./public/app/plugins/panel/graph/graph_tooltip.ts","webpack:///./public/app/plugins/panel/graph/histogram.ts","webpack:///./public/app/plugins/panel/graph/jquery.flot.events.ts","webpack:///./public/app/plugins/panel/graph/module.ts","webpack:///./public/app/plugins/panel/graph/series_overrides_ctrl.ts","webpack:///./public/app/plugins/panel/graph/template.ts","webpack:///./public/app/plugins/panel/graph/threshold_manager.ts","webpack:///./public/app/plugins/panel/graph/thresholds_form.ts","webpack:///./public/app/plugins/panel/graph/time_region_manager.ts","webpack:///./public/app/plugins/panel/graph/time_regions_form.ts","webpack:///./public/app/plugins/panel/graph2/GraphLegendEditor.tsx","webpack:///./public/app/plugins/panel/graph2/GraphPanel.tsx","webpack:///./public/app/plugins/panel/graph2/GraphPanelController.tsx","webpack:///./public/app/plugins/panel/graph2/GraphPanelEditor.tsx","webpack:///./public/app/plugins/panel/graph2/getGraphSeriesModel.ts","webpack:///./public/app/plugins/panel/graph2/module.tsx","webpack:///./public/app/plugins/panel/graph2/types.ts","webpack:///./public/app/plugins/panel/heatmap/axes_editor.ts","webpack:///./public/app/plugins/panel/heatmap/color_legend.ts","webpack:///./public/app/plugins/panel/heatmap/color_scale.ts","webpack:///./public/app/plugins/panel/heatmap/display_editor.ts","webpack:///./public/app/plugins/panel/heatmap/heatmap_ctrl.ts","webpack:///./public/app/plugins/panel/heatmap/heatmap_data_converter.ts","webpack:///./public/app/plugins/panel/heatmap/heatmap_tooltip.ts","webpack:///./public/app/plugins/panel/heatmap/module.ts","webpack:///./public/app/plugins/panel/heatmap/rendering.ts","webpack:///./public/app/plugins/panel/homelinks/module.tsx","webpack:///./public/app/plugins/panel/logs/LogsPanel.tsx","webpack:///./public/app/plugins/panel/logs/LogsPanelEditor.tsx","webpack:///./public/app/plugins/panel/logs/module.tsx","webpack:///./public/app/plugins/panel/logs/types.ts","webpack:///./public/app/plugins/panel/news/NewsPanel.tsx","webpack:///./public/app/plugins/panel/news/NewsPanelEditor.tsx","webpack:///./public/app/plugins/panel/news/module.tsx","webpack:///./public/app/plugins/panel/news/rss.ts","webpack:///./public/app/plugins/panel/news/types.ts","webpack:///./public/app/plugins/panel/news/utils.ts","webpack:///./public/app/plugins/panel/piechart/PieChartOptionsBox.tsx","webpack:///./public/app/plugins/panel/piechart/PieChartPanel.tsx","webpack:///./public/app/plugins/panel/piechart/PieChartPanelEditor.tsx","webpack:///./public/app/plugins/panel/piechart/module.tsx","webpack:///./public/app/plugins/panel/piechart/types.ts","webpack:///./public/app/plugins/panel/pluginlist/module.ts","webpack:///./public/app/plugins/panel/singlestat/module.ts","webpack:///./public/app/plugins/panel/stat/StatPanel.tsx","webpack:///./public/app/plugins/panel/stat/StatPanelEditor.tsx","webpack:///./public/app/plugins/panel/stat/module.tsx","webpack:///./public/app/plugins/panel/stat/types.ts","webpack:///./public/app/plugins/panel/table/column_options.ts","webpack:///./public/app/plugins/panel/table/editor.ts","webpack:///./public/app/plugins/panel/table/module.ts","webpack:///./public/app/plugins/panel/table/renderer.ts","webpack:///./public/app/plugins/panel/table/transformers.ts","webpack:///./public/app/plugins/panel/table2/TablePanel.tsx","webpack:///./public/app/plugins/panel/table2/TablePanelEditor.tsx","webpack:///./public/app/plugins/panel/table2/module.tsx","webpack:///./public/app/plugins/panel/table2/types.ts","webpack:///./public/app/plugins/panel/text/module.ts","webpack:///./public/app/plugins/panel/text2/TextPanel.tsx","webpack:///./public/app/plugins/panel/text2/TextPanelEditor.tsx","webpack:///./public/app/plugins/panel/text2/module.tsx","webpack:///./public/app/plugins/panel/text2/types.ts","webpack:///./public/app/plugins/sdk.ts","webpack:///./public/app/routes/GrafanaCtrl.ts","webpack:///./public/app/routes/ReactContainer.tsx","webpack:///./public/app/routes/dashboard_loaders.ts","webpack:///./public/app/routes/registry.ts","webpack:///./public/app/routes/routes.ts","webpack:///./public/app/store/configureStore.ts","webpack:///./public/app/store/store.ts","webpack:///./public/app/types/acl.ts","webpack:///./public/app/types/appNotifications.ts","webpack:///./public/app/types/dashboard.ts","webpack:///./public/app/types/events.ts","webpack:///./public/app/types/explore.ts","webpack:///./public/app/types/index.ts","webpack:///./public/app/types/search.ts","webpack:///./public/vendor/angular-other/angular-strap.js","webpack:///./public/vendor/bootstrap/bootstrap.js","webpack:///./public/vendor/flot/jquery.flot.crosshair.js","webpack:///./public/vendor/flot/jquery.flot.dashes.js","webpack:///./public/vendor/flot/jquery.flot.fillbelow.js","webpack:///./public/vendor/flot/jquery.flot.gauge.js","webpack:///./public/vendor/flot/jquery.flot.js","webpack:///./public/vendor/flot/jquery.flot.selection.js","webpack:///./public/vendor/flot/jquery.flot.stack.js","webpack:///./public/vendor/flot/jquery.flot.stackpercent.js","webpack:///./public/vendor/flot/jquery.flot.time.js","webpack:///./public/vendor/tagsinput/bootstrap-tagsinput.js"],"sourcesContent":["import { MutableDataFrame } from './MutableDataFrame';\nimport { CircularVector } from '../vector/CircularVector';\n\ninterface CircularOptions {\n  append?: 'head' | 'tail';\n  capacity?: number;\n}\n\n/**\n * This dataframe can have values constantly added, and will never\n * exceed the given capacity\n */\nexport class CircularDataFrame<T = any> extends MutableDataFrame<T> {\n  constructor(options: CircularOptions) {\n    super(undefined, (buffer?: any[]) => {\n      return new CircularVector({\n        ...options,\n        buffer,\n      });\n    });\n  }\n}\n","import { Vector } from '../types/vector';\r\nimport { DataFrame } from '../types/dataFrame';\r\n\r\n/**\r\n * This abstraction will present the contents of a DataFrame as if\r\n * it were a well typed javascript object Vector.\r\n *\r\n * NOTE: The contents of the object returned from `view.get(index)`\r\n * are optimized for use in a loop.  All calls return the same object\r\n * but the index has changed.\r\n *\r\n * For example, the three objects:\r\n *   const first = view.get(0);\r\n *   const second = view.get(1);\r\n *   const third = view.get(2);\r\n * will point to the contents at index 2\r\n *\r\n * If you need three different objects, consider something like:\r\n *   const first = { ... view.get(0) };\r\n *   const second = { ... view.get(1) };\r\n *   const third = { ... view.get(2) };\r\n */\r\nexport class DataFrameView<T = any> implements Vector<T> {\r\n  private index = 0;\r\n  private obj: T;\r\n\r\n  constructor(private data: DataFrame) {\r\n    const obj = ({} as unknown) as T;\r\n\r\n    for (let i = 0; i < data.fields.length; i++) {\r\n      const field = data.fields[i];\r\n      const getter = () => field.values.get(this.index);\r\n\r\n      if (!(obj as any).hasOwnProperty(field.name)) {\r\n        Object.defineProperty(obj, field.name, {\r\n          enumerable: true, // Shows up as enumerable property\r\n          get: getter,\r\n        });\r\n      }\r\n\r\n      Object.defineProperty(obj, i, {\r\n        enumerable: false, // Don't enumerate array index\r\n        get: getter,\r\n      });\r\n    }\r\n\r\n    this.obj = obj;\r\n  }\r\n\r\n  get dataFrame() {\r\n    return this.data;\r\n  }\r\n\r\n  get length() {\r\n    return this.data.length;\r\n  }\r\n\r\n  get(idx: number) {\r\n    this.index = idx;\r\n    return this.obj;\r\n  }\r\n\r\n  toArray(): T[] {\r\n    return new Array(this.data.length).fill(0).map((_, i) => ({ ...this.get(i) }));\r\n  }\r\n\r\n  toJSON(): T[] {\r\n    return this.toArray();\r\n  }\r\n\r\n  forEachRow(iterator: (row: T) => void) {\r\n    for (let i = 0; i < this.data.length; i++) {\r\n      iterator(this.get(i));\r\n    }\r\n  }\r\n\r\n  map<V>(iterator: (item: T, index: number) => V) {\r\n    const acc: V[] = [];\r\n    for (let i = 0; i < this.data.length; i++) {\r\n      acc.push(iterator(this.get(i), i));\r\n    }\r\n    return acc;\r\n  }\r\n}\r\n","import { Field, DataFrame, FieldType, guessFieldTypeForField } from '../index';\r\n\r\nexport interface FieldWithIndex extends Field {\r\n  index: number;\r\n}\r\n\r\nexport class FieldCache {\r\n  fields: FieldWithIndex[] = [];\r\n\r\n  private fieldByName: { [key: string]: FieldWithIndex } = {};\r\n  private fieldByType: { [key: string]: FieldWithIndex[] } = {};\r\n\r\n  constructor(data: DataFrame) {\r\n    this.fields = data.fields.map((field, idx) => ({\r\n      ...field,\r\n      index: idx,\r\n    }));\r\n\r\n    for (let i = 0; i < data.fields.length; i++) {\r\n      const field = data.fields[i];\r\n      // Make sure it has a type\r\n      if (field.type === FieldType.other) {\r\n        const t = guessFieldTypeForField(field);\r\n        if (t) {\r\n          field.type = t;\r\n        }\r\n      }\r\n      if (!this.fieldByType[field.type]) {\r\n        this.fieldByType[field.type] = [];\r\n      }\r\n      this.fieldByType[field.type].push({\r\n        ...field,\r\n        index: i,\r\n      });\r\n\r\n      if (this.fieldByName[field.name]) {\r\n        console.warn('Duplicate field names in DataFrame: ', field.name);\r\n      } else {\r\n        this.fieldByName[field.name] = { ...field, index: i };\r\n      }\r\n    }\r\n  }\r\n\r\n  getFields(type?: FieldType): FieldWithIndex[] {\r\n    if (!type) {\r\n      return [...this.fields]; // All fields\r\n    }\r\n    const fields = this.fieldByType[type];\r\n    if (fields) {\r\n      return [...fields];\r\n    }\r\n    return [];\r\n  }\r\n\r\n  hasFieldOfType(type: FieldType): boolean {\r\n    const types = this.fieldByType[type];\r\n    return types && types.length > 0;\r\n  }\r\n\r\n  getFirstFieldOfType(type: FieldType): FieldWithIndex | undefined {\r\n    const arr = this.fieldByType[type];\r\n    if (arr && arr.length > 0) {\r\n      return arr[0];\r\n    }\r\n    return undefined;\r\n  }\r\n\r\n  hasFieldNamed(name: string): boolean {\r\n    return !!this.fieldByName[name];\r\n  }\r\n\r\n  /**\r\n   * Returns the first field with the given name.\r\n   */\r\n  getFieldByName(name: string): FieldWithIndex | undefined {\r\n    return this.fieldByName[name];\r\n  }\r\n}\r\n","import { Field, DataFrame, DataFrameDTO, FieldDTO, FieldType } from '../types/dataFrame';\r\nimport { KeyValue, QueryResultMeta } from '../types/data';\r\nimport { guessFieldTypeFromValue, guessFieldTypeForField, toDataFrameDTO } from './processDataFrame';\r\nimport isArray from 'lodash/isArray';\r\nimport isString from 'lodash/isString';\r\nimport { makeFieldParser } from '../utils/fieldParser';\r\nimport { MutableVector, Vector } from '../types/vector';\r\nimport { ArrayVector } from '../vector/ArrayVector';\r\nimport { vectorToArray } from '../vector/vectorToArray';\r\n\r\nexport type MutableField<T = any> = Field<T, MutableVector<T>>;\r\n\r\ntype MutableVectorCreator = (buffer?: any[]) => MutableVector;\r\n\r\nexport const MISSING_VALUE: any = null;\r\n\r\nexport class MutableDataFrame<T = any> implements DataFrame, MutableVector<T> {\r\n  name?: string;\r\n  refId?: string;\r\n  meta?: QueryResultMeta;\r\n\r\n  fields: MutableField[] = [];\r\n  values: KeyValue<MutableVector> = {};\r\n\r\n  private first: Vector = new ArrayVector();\r\n  private creator: MutableVectorCreator;\r\n\r\n  constructor(source?: DataFrame | DataFrameDTO, creator?: MutableVectorCreator) {\r\n    // This creates the underlying storage buffers\r\n    this.creator = creator\r\n      ? creator\r\n      : (buffer?: any[]) => {\r\n          return new ArrayVector(buffer);\r\n        };\r\n\r\n    // Copy values from\r\n    if (source) {\r\n      const { name, refId, meta, fields } = source;\r\n      if (name) {\r\n        this.name = name;\r\n      }\r\n      if (refId) {\r\n        this.refId = refId;\r\n      }\r\n      if (meta) {\r\n        this.meta = meta;\r\n      }\r\n      if (fields) {\r\n        for (const f of fields) {\r\n          this.addField(f);\r\n        }\r\n      }\r\n    }\r\n\r\n    // Get Length to show up if you use spread\r\n    Object.defineProperty(this, 'length', {\r\n      enumerable: true,\r\n      get: () => {\r\n        return this.first.length;\r\n      },\r\n    });\r\n  }\r\n\r\n  // Defined for Vector interface\r\n  get length() {\r\n    return this.first.length;\r\n  }\r\n\r\n  addFieldFor(value: any, name?: string): MutableField {\r\n    return this.addField({\r\n      name: name || '', // Will be filled in\r\n      type: guessFieldTypeFromValue(value),\r\n    });\r\n  }\r\n\r\n  addField(f: Field | FieldDTO, startLength?: number): MutableField {\r\n    let buffer: any[] | undefined = undefined;\r\n\r\n    if (f.values) {\r\n      if (isArray(f.values)) {\r\n        buffer = f.values as any[];\r\n      } else {\r\n        buffer = (f.values as Vector).toArray();\r\n      }\r\n    }\r\n\r\n    let type = f.type;\r\n\r\n    if (!type && ('time' === f.name || 'Time' === f.name)) {\r\n      type = FieldType.time;\r\n    } else {\r\n      if (!type && buffer && buffer.length) {\r\n        type = guessFieldTypeFromValue(buffer[0]);\r\n      }\r\n      if (!type) {\r\n        type = FieldType.other;\r\n      }\r\n    }\r\n\r\n    // Make sure it has a name\r\n    let name = f.name;\r\n    if (!name) {\r\n      if (type === FieldType.time) {\r\n        name = this.values['Time'] ? `Time ${this.fields.length + 1}` : 'Time';\r\n      } else {\r\n        name = `Field ${this.fields.length + 1}`;\r\n      }\r\n    }\r\n\r\n    const field: MutableField = {\r\n      name,\r\n      type,\r\n      config: f.config || {},\r\n      values: this.creator(buffer),\r\n      labels: f.labels,\r\n    };\r\n\r\n    if (type === FieldType.other) {\r\n      type = guessFieldTypeForField(field);\r\n      if (type) {\r\n        field.type = type;\r\n      }\r\n    }\r\n\r\n    this.fields.push(field);\r\n    this.first = this.fields[0].values;\r\n\r\n    // The Field Already exists\r\n    if (this.values[name]) {\r\n      console.warn(`Duplicate field names found: ${name}, only the first will be accessible`);\r\n    } else {\r\n      this.values[name] = field.values;\r\n    }\r\n\r\n    // Make sure the field starts with a given length\r\n    if (startLength) {\r\n      while (field.values.length < startLength) {\r\n        field.values.add(MISSING_VALUE);\r\n      }\r\n    } else {\r\n      this.validate();\r\n    }\r\n\r\n    return field;\r\n  }\r\n\r\n  validate() {\r\n    // Make sure all arrays are the same length\r\n    const length = this.fields.reduce((v: number, f) => {\r\n      return Math.max(v, f.values.length);\r\n    }, 0);\r\n\r\n    // Add empty elements until everything mastches\r\n    for (const field of this.fields) {\r\n      while (field.values.length !== length) {\r\n        field.values.add(MISSING_VALUE);\r\n      }\r\n    }\r\n  }\r\n\r\n  private addMissingFieldsFor(value: any) {\r\n    for (const key of Object.keys(value)) {\r\n      if (!this.values[key]) {\r\n        this.addField({\r\n          name: key,\r\n          type: guessFieldTypeFromValue(value[key]),\r\n        });\r\n      }\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Reverse all values\r\n   */\r\n  reverse() {\r\n    for (const f of this.fields) {\r\n      f.values.reverse();\r\n    }\r\n  }\r\n\r\n  /**\r\n   * This will add each value to the corresponding column\r\n   */\r\n  appendRow(row: any[]) {\r\n    // Add any extra columns\r\n    for (let i = this.fields.length; i < row.length; i++) {\r\n      this.addField({\r\n        name: `Field ${i + 1}`,\r\n        type: guessFieldTypeFromValue(row[i]),\r\n      });\r\n    }\r\n\r\n    // The first line may change the field types\r\n    if (this.length < 1) {\r\n      for (let i = 0; i < this.fields.length; i++) {\r\n        const f = this.fields[i];\r\n        if (!f.type || f.type === FieldType.other) {\r\n          f.type = guessFieldTypeFromValue(row[i]);\r\n        }\r\n      }\r\n    }\r\n\r\n    for (let i = 0; i < this.fields.length; i++) {\r\n      const f = this.fields[i];\r\n      let v = row[i];\r\n      if (f.type !== FieldType.string && isString(v)) {\r\n        if (!f.parse) {\r\n          f.parse = makeFieldParser(v, f);\r\n        }\r\n        v = f.parse(v);\r\n      }\r\n      f.values.add(v);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Add all properties of the value as fields on the frame\r\n   */\r\n  add(value: T, addMissingFields?: boolean) {\r\n    if (addMissingFields) {\r\n      this.addMissingFieldsFor(value);\r\n    }\r\n\r\n    // Will add one value for every field\r\n    const obj = value as any;\r\n    for (const field of this.fields) {\r\n      let val = obj[field.name];\r\n\r\n      if (field.type !== FieldType.string && isString(val)) {\r\n        if (!field.parse) {\r\n          field.parse = makeFieldParser(val, field);\r\n        }\r\n        val = field.parse(val);\r\n      }\r\n\r\n      if (val === undefined) {\r\n        val = MISSING_VALUE;\r\n      }\r\n\r\n      field.values.add(val);\r\n    }\r\n  }\r\n\r\n  set(index: number, value: T, addMissingFields?: boolean) {\r\n    if (index > this.length) {\r\n      throw new Error('Unable ot set value beyond current length');\r\n    }\r\n\r\n    if (addMissingFields) {\r\n      this.addMissingFieldsFor(value);\r\n    }\r\n\r\n    const obj = (value as any) || {};\r\n    for (const field of this.fields) {\r\n      field.values.set(index, obj[field.name]);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Get an object with a property for each field in the DataFrame\r\n   */\r\n  get(idx: number): T {\r\n    const v: any = {};\r\n    for (const field of this.fields) {\r\n      v[field.name] = field.values.get(idx);\r\n    }\r\n    return v as T;\r\n  }\r\n\r\n  toArray(): T[] {\r\n    return vectorToArray(this);\r\n  }\r\n\r\n  /**\r\n   * The simplified JSON values used in JSON.stringify()\r\n   */\r\n  toJSON() {\r\n    return toDataFrameDTO(this);\r\n  }\r\n}\r\n","import { Field } from '../types/dataFrame';\r\nimport { KeyValue } from '../types/data';\r\n\r\nexport interface Dimension<T = any> {\r\n  // Name of the dimension\r\n  name: string;\r\n  // Colection of fields representing dimension\r\n  // I.e. in 2d graph we have two dimension- X and Y axes. Both dimensions can represent\r\n  // multiple fields being drawn on the graph.\r\n  // For instance y-axis dimension is a collection of series value fields,\r\n  // and x-axis dimension is a collection of corresponding time fields\r\n  columns: Array<Field<T>>;\r\n}\r\n\r\nexport type Dimensions = KeyValue<Dimension>;\r\n\r\nexport const createDimension = (name: string, columns: Field[]): Dimension => {\r\n  return {\r\n    name,\r\n    columns,\r\n  };\r\n};\r\n\r\nexport const getColumnsFromDimension = (dimension: Dimension) => {\r\n  return dimension.columns;\r\n};\r\nexport const getColumnFromDimension = (dimension: Dimension, column: number) => {\r\n  return dimension.columns[column];\r\n};\r\n\r\nexport const getValueFromDimension = (dimension: Dimension, column: number, row: number) => {\r\n  return dimension.columns[column].values.get(row);\r\n};\r\n\r\nexport const getAllValuesFromDimension = (dimension: Dimension, column: number, row: number) => {\r\n  return dimension.columns.map(c => c.values.get(row));\r\n};\r\n\r\nexport const getDimensionByName = (dimensions: Dimensions, name: string) => dimensions[name];\r\n","export * from './DataFrameView';\r\nexport * from './FieldCache';\r\nexport * from './CircularDataFrame';\r\nexport * from './MutableDataFrame';\r\nexport * from './processDataFrame';\r\nexport * from './dimensions';\r\n\r\n// Phantom JS :(\r\n//export * from './ArrowDataFrame';\r\n","// Libraries\r\nimport { isArray, isBoolean, isNumber, isString } from 'lodash';\r\n\r\n// Types\r\nimport {\r\n  DataFrame,\r\n  Field,\r\n  FieldConfig,\r\n  TimeSeries,\r\n  FieldType,\r\n  TableData,\r\n  Column,\r\n  GraphSeriesXY,\r\n  TimeSeriesValue,\r\n  FieldDTO,\r\n  DataFrameDTO,\r\n} from '../types/index';\r\nimport { isDateTime } from '../datetime/moment_wrapper';\r\nimport { deprecationWarning } from '../utils/deprecationWarning';\r\nimport { ArrayVector } from '../vector/ArrayVector';\r\nimport { MutableDataFrame } from './MutableDataFrame';\r\nimport { SortedVector } from '../vector/SortedVector';\r\n\r\nfunction convertTableToDataFrame(table: TableData): DataFrame {\r\n  const fields = table.columns.map(c => {\r\n    const { text, ...disp } = c;\r\n    return {\r\n      name: text, // rename 'text' to the 'name' field\r\n      config: (disp || {}) as FieldConfig,\r\n      values: new ArrayVector(),\r\n      type: FieldType.other,\r\n    };\r\n  });\r\n\r\n  if (!isArray(table.rows)) {\r\n    throw new Error(`Expected table rows to be array, got ${typeof table.rows}.`);\r\n  }\r\n\r\n  for (const row of table.rows) {\r\n    for (let i = 0; i < fields.length; i++) {\r\n      fields[i].values.buffer.push(row[i]);\r\n    }\r\n  }\r\n\r\n  for (const f of fields) {\r\n    const t = guessFieldTypeForField(f);\r\n    if (t) {\r\n      f.type = t;\r\n    }\r\n  }\r\n\r\n  return {\r\n    fields,\r\n    refId: table.refId,\r\n    meta: table.meta,\r\n    name: table.name,\r\n    length: table.rows.length,\r\n  };\r\n}\r\n\r\nfunction convertTimeSeriesToDataFrame(timeSeries: TimeSeries): DataFrame {\r\n  const times: number[] = [];\r\n  const values: TimeSeriesValue[] = [];\r\n  for (const point of timeSeries.datapoints) {\r\n    values.push(point[0]);\r\n    times.push(point[1] as number);\r\n  }\r\n\r\n  const fields = [\r\n    {\r\n      name: timeSeries.target || 'Value',\r\n      type: FieldType.number,\r\n      config: {\r\n        unit: timeSeries.unit,\r\n      },\r\n      values: new ArrayVector<TimeSeriesValue>(values),\r\n      labels: timeSeries.tags,\r\n    },\r\n    {\r\n      name: 'Time',\r\n      type: FieldType.time,\r\n      config: {},\r\n      values: new ArrayVector<number>(times),\r\n    },\r\n  ];\r\n\r\n  return {\r\n    name: timeSeries.target,\r\n    refId: timeSeries.refId,\r\n    meta: timeSeries.meta,\r\n    fields,\r\n    length: values.length,\r\n  };\r\n}\r\n\r\n/**\r\n * This is added temporarily while we convert the LogsModel\r\n * to DataFrame.  See: https://github.com/grafana/grafana/issues/18528\r\n */\r\nfunction convertGraphSeriesToDataFrame(graphSeries: GraphSeriesXY): DataFrame {\r\n  const x = new ArrayVector();\r\n  const y = new ArrayVector();\r\n\r\n  for (let i = 0; i < graphSeries.data.length; i++) {\r\n    const row = graphSeries.data[i];\r\n    x.buffer.push(row[1]);\r\n    y.buffer.push(row[0]);\r\n  }\r\n\r\n  return {\r\n    name: graphSeries.label,\r\n    fields: [\r\n      {\r\n        name: graphSeries.label || 'Value',\r\n        type: FieldType.number,\r\n        config: {},\r\n        values: x,\r\n      },\r\n      {\r\n        name: 'Time',\r\n        type: FieldType.time,\r\n        config: {\r\n          unit: 'dateTimeAsIso',\r\n        },\r\n        values: y,\r\n      },\r\n    ],\r\n    length: x.buffer.length,\r\n  };\r\n}\r\n\r\nfunction convertJSONDocumentDataToDataFrame(timeSeries: TimeSeries): DataFrame {\r\n  const fields = [\r\n    {\r\n      name: timeSeries.target,\r\n      type: FieldType.other,\r\n      labels: timeSeries.tags,\r\n      config: {\r\n        unit: timeSeries.unit,\r\n        filterable: (timeSeries as any).filterable,\r\n      },\r\n      values: new ArrayVector(),\r\n    },\r\n  ];\r\n\r\n  for (const point of timeSeries.datapoints) {\r\n    fields[0].values.buffer.push(point);\r\n  }\r\n\r\n  return {\r\n    name: timeSeries.target,\r\n    refId: timeSeries.target,\r\n    meta: { json: true },\r\n    fields,\r\n    length: timeSeries.datapoints.length,\r\n  };\r\n}\r\n\r\n// PapaParse Dynamic Typing regex:\r\n// https://github.com/mholt/PapaParse/blob/master/papaparse.js#L998\r\nconst NUMBER = /^\\s*(-?(\\d*\\.?\\d+|\\d+\\.?\\d*)(e[-+]?\\d+)?|NAN)\\s*$/i;\r\n\r\n/**\r\n * Given a value this will guess the best column type\r\n *\r\n * TODO: better Date/Time support!  Look for standard date strings?\r\n */\r\nexport function guessFieldTypeFromValue(v: any): FieldType {\r\n  if (isNumber(v)) {\r\n    return FieldType.number;\r\n  }\r\n\r\n  if (isString(v)) {\r\n    if (NUMBER.test(v)) {\r\n      return FieldType.number;\r\n    }\r\n\r\n    if (v === 'true' || v === 'TRUE' || v === 'True' || v === 'false' || v === 'FALSE' || v === 'False') {\r\n      return FieldType.boolean;\r\n    }\r\n\r\n    return FieldType.string;\r\n  }\r\n\r\n  if (isBoolean(v)) {\r\n    return FieldType.boolean;\r\n  }\r\n\r\n  if (v instanceof Date || isDateTime(v)) {\r\n    return FieldType.time;\r\n  }\r\n\r\n  return FieldType.other;\r\n}\r\n\r\n/**\r\n * Looks at the data to guess the column type.  This ignores any existing setting\r\n */\r\nexport function guessFieldTypeForField(field: Field): FieldType | undefined {\r\n  // 1. Use the column name to guess\r\n  if (field.name) {\r\n    const name = field.name.toLowerCase();\r\n    if (name === 'date' || name === 'time') {\r\n      return FieldType.time;\r\n    }\r\n  }\r\n\r\n  // 2. Check the first non-null value\r\n  for (let i = 0; i < field.values.length; i++) {\r\n    const v = field.values.get(i);\r\n    if (v !== null) {\r\n      return guessFieldTypeFromValue(v);\r\n    }\r\n  }\r\n\r\n  // Could not find anything\r\n  return undefined;\r\n}\r\n\r\n/**\r\n * @returns a copy of the series with the best guess for each field type\r\n * If the series already has field types defined, they will be used\r\n */\r\nexport const guessFieldTypes = (series: DataFrame): DataFrame => {\r\n  for (let i = 0; i < series.fields.length; i++) {\r\n    if (!series.fields[i].type) {\r\n      // Somethign is missing a type return a modified copy\r\n      return {\r\n        ...series,\r\n        fields: series.fields.map(field => {\r\n          if (field.type && field.type !== FieldType.other) {\r\n            return field;\r\n          }\r\n          // Calculate a reasonable schema value\r\n          return {\r\n            ...field,\r\n            type: guessFieldTypeForField(field) || FieldType.other,\r\n          };\r\n        }),\r\n      };\r\n    }\r\n  }\r\n  // No changes necessary\r\n  return series;\r\n};\r\n\r\nexport const isTableData = (data: any): data is DataFrame => data && data.hasOwnProperty('columns');\r\n\r\nexport const isDataFrame = (data: any): data is DataFrame => data && data.hasOwnProperty('fields');\r\n\r\nexport const toDataFrame = (data: any): DataFrame => {\r\n  if (data.hasOwnProperty('fields')) {\r\n    // @deprecated -- remove in 6.5\r\n    if (data.hasOwnProperty('rows')) {\r\n      const v = new MutableDataFrame(data as DataFrameDTO);\r\n      const rows = data.rows as any[][];\r\n      for (let i = 0; i < rows.length; i++) {\r\n        v.appendRow(rows[i]);\r\n      }\r\n      deprecationWarning('DataFrame', '.rows', 'columnar format');\r\n      return v;\r\n    }\r\n\r\n    // DataFrameDTO does not have length\r\n    if (data.hasOwnProperty('length')) {\r\n      return data as DataFrame;\r\n    }\r\n\r\n    // This will convert the array values into Vectors\r\n    return new MutableDataFrame(data as DataFrameDTO);\r\n  }\r\n\r\n  // Handle legacy docs/json type\r\n  if (data.hasOwnProperty('type') && data.type === 'docs') {\r\n    return convertJSONDocumentDataToDataFrame(data);\r\n  }\r\n\r\n  if (data.hasOwnProperty('datapoints')) {\r\n    return convertTimeSeriesToDataFrame(data);\r\n  }\r\n\r\n  if (data.hasOwnProperty('data')) {\r\n    return convertGraphSeriesToDataFrame(data);\r\n  }\r\n\r\n  if (data.hasOwnProperty('columns')) {\r\n    return convertTableToDataFrame(data);\r\n  }\r\n\r\n  console.warn('Can not convert', data);\r\n  throw new Error('Unsupported data format');\r\n};\r\n\r\nexport const toLegacyResponseData = (frame: DataFrame): TimeSeries | TableData => {\r\n  const { fields } = frame;\r\n\r\n  const rowCount = frame.length;\r\n  const rows: any[][] = [];\r\n\r\n  for (let i = 0; i < rowCount; i++) {\r\n    const row: any[] = [];\r\n    for (let j = 0; j < fields.length; j++) {\r\n      row.push(fields[j].values.get(i));\r\n    }\r\n    rows.push(row);\r\n  }\r\n\r\n  if (fields.length === 2) {\r\n    let type = fields[1].type;\r\n    if (!type) {\r\n      type = guessFieldTypeForField(fields[1]) || FieldType.other;\r\n    }\r\n    if (type === FieldType.time) {\r\n      return {\r\n        alias: fields[0].name || frame.name,\r\n        target: fields[0].name || frame.name,\r\n        datapoints: rows,\r\n        unit: fields[0].config ? fields[0].config.unit : undefined,\r\n        refId: frame.refId,\r\n        meta: frame.meta,\r\n      } as TimeSeries;\r\n    }\r\n  }\r\n\r\n  if (frame.meta && frame.meta.json) {\r\n    return {\r\n      alias: fields[0].name || frame.name,\r\n      target: fields[0].name || frame.name,\r\n      datapoints: fields[0].values.toArray(),\r\n      filterable: fields[0].config ? fields[0].config.filterable : undefined,\r\n      type: 'docs',\r\n    } as TimeSeries;\r\n  }\r\n\r\n  return {\r\n    columns: fields.map(f => {\r\n      const { name, config } = f;\r\n      if (config) {\r\n        // keep unit etc\r\n        const { ...column } = config;\r\n        (column as Column).text = name;\r\n        return column as Column;\r\n      }\r\n      return { text: name };\r\n    }),\r\n    type: 'table',\r\n    refId: frame.refId,\r\n    meta: frame.meta,\r\n    rows,\r\n  };\r\n};\r\n\r\nexport function sortDataFrame(data: DataFrame, sortIndex?: number, reverse = false): DataFrame {\r\n  const field = data.fields[sortIndex!];\r\n  if (!field) {\r\n    return data;\r\n  }\r\n\r\n  // Natural order\r\n  const index: number[] = [];\r\n  for (let i = 0; i < data.length; i++) {\r\n    index.push(i);\r\n  }\r\n  const values = field.values;\r\n\r\n  // Numeric Comparison\r\n  let compare = (a: number, b: number) => {\r\n    const vA = values.get(a);\r\n    const vB = values.get(b);\r\n    return vA - vB; // works for numbers!\r\n  };\r\n\r\n  // String Comparison\r\n  if (field.type === FieldType.string) {\r\n    compare = (a: number, b: number) => {\r\n      const vA: string = values.get(a);\r\n      const vB: string = values.get(b);\r\n      return vA.localeCompare(vB);\r\n    };\r\n  }\r\n\r\n  // Run the sort function\r\n  index.sort(compare);\r\n  if (reverse) {\r\n    index.reverse();\r\n  }\r\n\r\n  // Return a copy that maps sorted values\r\n  return {\r\n    ...data,\r\n    fields: data.fields.map(f => {\r\n      return {\r\n        ...f,\r\n        values: new SortedVector(f.values, index),\r\n      };\r\n    }),\r\n  };\r\n}\r\n\r\n/**\r\n * Returns a copy with all values reversed\r\n */\r\nexport function reverseDataFrame(data: DataFrame): DataFrame {\r\n  return {\r\n    ...data,\r\n    fields: data.fields.map(f => {\r\n      const copy = [...f.values.toArray()];\r\n      copy.reverse();\r\n      return {\r\n        ...f,\r\n        values: new ArrayVector(copy),\r\n      };\r\n    }),\r\n  };\r\n}\r\n\r\nexport const getTimeField = (series: DataFrame): { timeField?: Field; timeIndex?: number } => {\r\n  for (let i = 0; i < series.fields.length; i++) {\r\n    if (series.fields[i].type === FieldType.time) {\r\n      return {\r\n        timeField: series.fields[i],\r\n        timeIndex: i,\r\n      };\r\n    }\r\n  }\r\n  return {};\r\n};\r\n\r\n/**\r\n * Wrapper to get an array from each field value\r\n */\r\nexport function getDataFrameRow(data: DataFrame, row: number): any[] {\r\n  const values: any[] = [];\r\n  for (const field of data.fields) {\r\n    values.push(field.values.get(row));\r\n  }\r\n  return values;\r\n}\r\n\r\n/**\r\n * Returns a copy that does not include functions\r\n */\r\nexport function toDataFrameDTO(data: DataFrame): DataFrameDTO {\r\n  const fields: FieldDTO[] = data.fields.map(f => {\r\n    let values = f.values.toArray();\r\n    if (!Array.isArray(values)) {\r\n      // Apache arrow will pack objects into typed arrays\r\n      // Float64Array, etc\r\n      // TODO: Float64Array could be used directly\r\n      values = [];\r\n      for (let i = 0; i < f.values.length; i++) {\r\n        values.push(f.values.get(i));\r\n      }\r\n    }\r\n\r\n    return {\r\n      name: f.name,\r\n      type: f.type,\r\n      config: f.config,\r\n      values,\r\n      labels: f.labels,\r\n    };\r\n  });\r\n\r\n  return {\r\n    fields,\r\n    refId: data.refId,\r\n    meta: data.meta,\r\n    name: data.name,\r\n  };\r\n}\r\n","import includes from 'lodash/includes';\r\nimport isDate from 'lodash/isDate';\r\nimport { DateTime, dateTime, dateTimeForTimeZone, ISO_8601, isDateTime, DurationUnit } from './moment_wrapper';\r\nimport { TimeZone } from '../types/index';\r\n\r\nconst units: DurationUnit[] = ['y', 'M', 'w', 'd', 'h', 'm', 's'];\r\n\r\nexport function isMathString(text: string | DateTime | Date): boolean {\r\n  if (!text) {\r\n    return false;\r\n  }\r\n\r\n  if (typeof text === 'string' && (text.substring(0, 3) === 'now' || text.includes('||'))) {\r\n    return true;\r\n  } else {\r\n    return false;\r\n  }\r\n}\r\n\r\n/**\r\n * Parses different types input to a moment instance. There is a specific formatting language that can be used\r\n * if text arg is string. See unit tests for examples.\r\n * @param text\r\n * @param roundUp See parseDateMath function.\r\n * @param timezone Only string 'utc' is acceptable here, for anything else, local timezone is used.\r\n */\r\nexport function parse(text: string | DateTime | Date, roundUp?: boolean, timezone?: TimeZone): DateTime | undefined {\r\n  if (!text) {\r\n    return undefined;\r\n  }\r\n\r\n  if (typeof text !== 'string') {\r\n    if (isDateTime(text)) {\r\n      return text;\r\n    }\r\n    if (isDate(text)) {\r\n      return dateTime(text);\r\n    }\r\n    // We got some non string which is not a moment nor Date. TS should be able to check for that but not always.\r\n    return undefined;\r\n  } else {\r\n    let time;\r\n    let mathString = '';\r\n    let index;\r\n    let parseString;\r\n\r\n    if (text.substring(0, 3) === 'now') {\r\n      time = dateTimeForTimeZone(timezone);\r\n      mathString = text.substring('now'.length);\r\n    } else {\r\n      index = text.indexOf('||');\r\n      if (index === -1) {\r\n        parseString = text;\r\n        mathString = ''; // nothing else\r\n      } else {\r\n        parseString = text.substring(0, index);\r\n        mathString = text.substring(index + 2);\r\n      }\r\n      // We're going to just require ISO8601 timestamps, k?\r\n      time = dateTime(parseString, ISO_8601);\r\n    }\r\n\r\n    if (!mathString.length) {\r\n      return time;\r\n    }\r\n\r\n    return parseDateMath(mathString, time, roundUp);\r\n  }\r\n}\r\n\r\n/**\r\n * Checks if text is a valid date which in this context means that it is either a Moment instance or it can be parsed\r\n * by parse function. See parse function to see what is considered acceptable.\r\n * @param text\r\n */\r\nexport function isValid(text: string | DateTime): boolean {\r\n  const date = parse(text);\r\n  if (!date) {\r\n    return false;\r\n  }\r\n\r\n  if (isDateTime(date)) {\r\n    return date.isValid();\r\n  }\r\n\r\n  return false;\r\n}\r\n\r\n/**\r\n * Parses math part of the time string and shifts supplied time according to that math. See unit tests for examples.\r\n * @param mathString\r\n * @param time\r\n * @param roundUp If true it will round the time to endOf time unit, otherwise to startOf time unit.\r\n */\r\n// TODO: Had to revert Andrejs `time: moment.Moment` to `time: any`\r\nexport function parseDateMath(mathString: string, time: any, roundUp?: boolean): DateTime | undefined {\r\n  const strippedMathString = mathString.replace(/\\s/g, '');\r\n  const dateTime = time;\r\n  let i = 0;\r\n  const len = strippedMathString.length;\r\n\r\n  while (i < len) {\r\n    const c = strippedMathString.charAt(i++);\r\n    let type;\r\n    let num;\r\n    let unit;\r\n\r\n    if (c === '/') {\r\n      type = 0;\r\n    } else if (c === '+') {\r\n      type = 1;\r\n    } else if (c === '-') {\r\n      type = 2;\r\n    } else {\r\n      return undefined;\r\n    }\r\n\r\n    if (isNaN(parseInt(strippedMathString.charAt(i), 10))) {\r\n      num = 1;\r\n    } else if (strippedMathString.length === 2) {\r\n      num = strippedMathString.charAt(i);\r\n    } else {\r\n      const numFrom = i;\r\n      while (!isNaN(parseInt(strippedMathString.charAt(i), 10))) {\r\n        i++;\r\n        if (i > 10) {\r\n          return undefined;\r\n        }\r\n      }\r\n      num = parseInt(strippedMathString.substring(numFrom, i), 10);\r\n    }\r\n\r\n    if (type === 0) {\r\n      // rounding is only allowed on whole, single, units (eg M or 1M, not 0.5M or 2M)\r\n      if (num !== 1) {\r\n        return undefined;\r\n      }\r\n    }\r\n    unit = strippedMathString.charAt(i++);\r\n\r\n    if (!includes(units, unit)) {\r\n      return undefined;\r\n    } else {\r\n      if (type === 0) {\r\n        if (roundUp) {\r\n          dateTime.endOf(unit);\r\n        } else {\r\n          dateTime.startOf(unit);\r\n        }\r\n      } else if (type === 1) {\r\n        dateTime.add(num, unit);\r\n      } else if (type === 2) {\r\n        dateTime.subtract(num, unit);\r\n      }\r\n    }\r\n  }\r\n  return dateTime;\r\n}\r\n","export const DEFAULT_DATE_TIME_FORMAT = 'YYYY-MM-DD HH:mm:ss';\r\nexport const MS_DATE_TIME_FORMAT = 'YYYY-MM-DD HH:mm:ss.SSS';\r\n","// Names are too general to export globally\r\nimport * as dateMath from './datemath';\r\nimport * as rangeUtil from './rangeutil';\r\nexport * from './moment_wrapper';\r\nexport * from './timezones';\r\nexport * from './formats';\r\nexport { dateMath, rangeUtil };\r\n","import { TimeZone } from '../types/time';\r\n/* tslint:disable:import-blacklist ban ban-types */\r\nimport moment, { Moment, MomentInput, DurationInputArg1 } from 'moment';\r\nexport interface DateTimeBuiltinFormat {\r\n  __momentBuiltinFormatBrand: any;\r\n}\r\nexport const ISO_8601: DateTimeBuiltinFormat = moment.ISO_8601;\r\nexport type DateTimeInput = Date | string | number | Array<string | number> | DateTime; // null | undefined\r\nexport type FormatInput = string | DateTimeBuiltinFormat | undefined;\r\nexport type DurationInput = string | number | DateTimeDuration;\r\nexport type DurationUnit =\r\n  | 'year'\r\n  | 'years'\r\n  | 'y'\r\n  | 'month'\r\n  | 'months'\r\n  | 'M'\r\n  | 'week'\r\n  | 'weeks'\r\n  | 'w'\r\n  | 'day'\r\n  | 'days'\r\n  | 'd'\r\n  | 'hour'\r\n  | 'hours'\r\n  | 'h'\r\n  | 'minute'\r\n  | 'minutes'\r\n  | 'm'\r\n  | 'second'\r\n  | 'seconds'\r\n  | 's'\r\n  | 'millisecond'\r\n  | 'milliseconds'\r\n  | 'ms'\r\n  | 'quarter'\r\n  | 'quarters'\r\n  | 'Q';\r\n\r\nexport interface DateTimeLocale {\r\n  firstDayOfWeek: () => number;\r\n}\r\n\r\nexport interface DateTimeDuration {\r\n  asHours: () => number;\r\n  hours: () => number;\r\n  minutes: () => number;\r\n  seconds: () => number;\r\n  asSeconds: () => number;\r\n}\r\n\r\nexport interface DateTime extends Object {\r\n  add: (amount?: DateTimeInput, unit?: DurationUnit) => DateTime;\r\n  set: (unit: DurationUnit, amount: DateTimeInput) => void;\r\n  diff: (amount: DateTimeInput, unit?: DurationUnit, truncate?: boolean) => number;\r\n  endOf: (unitOfTime: DurationUnit) => DateTime;\r\n  format: (formatInput?: FormatInput) => string;\r\n  fromNow: (withoutSuffix?: boolean) => string;\r\n  from: (formaInput: DateTimeInput) => string;\r\n  isSame: (input?: DateTimeInput, granularity?: DurationUnit) => boolean;\r\n  isValid: () => boolean;\r\n  local: () => DateTime;\r\n  locale: (locale: string) => DateTime;\r\n  startOf: (unitOfTime: DurationUnit) => DateTime;\r\n  subtract: (amount?: DateTimeInput, unit?: DurationUnit) => DateTime;\r\n  toDate: () => Date;\r\n  toISOString: () => string;\r\n  isoWeekday: (day?: number | string) => number | string;\r\n  valueOf: () => number;\r\n  unix: () => number;\r\n  utc: () => DateTime;\r\n  utcOffset: () => number;\r\n  hour?: () => number;\r\n  minute?: () => number;\r\n}\r\n\r\nexport const setLocale = (language: string) => {\r\n  moment.locale(language);\r\n};\r\n\r\nexport const getLocaleData = (): DateTimeLocale => {\r\n  return moment.localeData();\r\n};\r\n\r\nexport const isDateTime = (value: any): value is DateTime => {\r\n  return moment.isMoment(value);\r\n};\r\n\r\nexport const toUtc = (input?: DateTimeInput, formatInput?: FormatInput): DateTime => {\r\n  return moment.utc(input as MomentInput, formatInput) as DateTime;\r\n};\r\n\r\nexport const toDuration = (input?: DurationInput, unit?: DurationUnit): DateTimeDuration => {\r\n  return moment.duration(input as DurationInputArg1, unit) as DateTimeDuration;\r\n};\r\n\r\nexport const dateTime = (input?: DateTimeInput, formatInput?: FormatInput): DateTime => {\r\n  return moment(input as MomentInput, formatInput) as DateTime;\r\n};\r\n\r\nexport const dateTimeAsMoment = (input?: DateTimeInput) => {\r\n  return dateTime(input) as Moment;\r\n};\r\n\r\nexport const dateTimeForTimeZone = (\r\n  timezone?: TimeZone,\r\n  input?: DateTimeInput,\r\n  formatInput?: FormatInput\r\n): DateTime => {\r\n  if (timezone === 'utc') {\r\n    return toUtc(input, formatInput);\r\n  }\r\n\r\n  return dateTime(input, formatInput);\r\n};\r\n","import each from 'lodash/each';\r\nimport groupBy from 'lodash/groupBy';\r\n\r\nimport { RawTimeRange } from '../types/time';\r\n\r\nimport * as dateMath from './datemath';\r\nimport { isDateTime, DateTime } from './moment_wrapper';\r\n\r\nconst spans: { [key: string]: { display: string; section?: number } } = {\r\n  s: { display: 'second' },\r\n  m: { display: 'minute' },\r\n  h: { display: 'hour' },\r\n  d: { display: 'day' },\r\n  w: { display: 'week' },\r\n  M: { display: 'month' },\r\n  y: { display: 'year' },\r\n};\r\n\r\nconst rangeOptions = [\r\n  { from: 'now/d', to: 'now/d', display: 'Today', section: 2 },\r\n  { from: 'now/d', to: 'now', display: 'Today so far', section: 2 },\r\n  { from: 'now/w', to: 'now/w', display: 'This week', section: 2 },\r\n  { from: 'now/w', to: 'now', display: 'This week so far', section: 2 },\r\n  { from: 'now/M', to: 'now/M', display: 'This month', section: 2 },\r\n  { from: 'now/M', to: 'now', display: 'This month so far', section: 2 },\r\n  { from: 'now/y', to: 'now/y', display: 'This year', section: 2 },\r\n  { from: 'now/y', to: 'now', display: 'This year so far', section: 2 },\r\n\r\n  { from: 'now-1d/d', to: 'now-1d/d', display: 'Yesterday', section: 1 },\r\n  {\r\n    from: 'now-2d/d',\r\n    to: 'now-2d/d',\r\n    display: 'Day before yesterday',\r\n    section: 1,\r\n  },\r\n  {\r\n    from: 'now-7d/d',\r\n    to: 'now-7d/d',\r\n    display: 'This day last week',\r\n    section: 1,\r\n  },\r\n  { from: 'now-1w/w', to: 'now-1w/w', display: 'Previous week', section: 1 },\r\n  { from: 'now-1M/M', to: 'now-1M/M', display: 'Previous month', section: 1 },\r\n  { from: 'now-1y/y', to: 'now-1y/y', display: 'Previous year', section: 1 },\r\n\r\n  { from: 'now-5m', to: 'now', display: 'Last 5 minutes', section: 3 },\r\n  { from: 'now-15m', to: 'now', display: 'Last 15 minutes', section: 3 },\r\n  { from: 'now-30m', to: 'now', display: 'Last 30 minutes', section: 3 },\r\n  { from: 'now-1h', to: 'now', display: 'Last 1 hour', section: 3 },\r\n  { from: 'now-3h', to: 'now', display: 'Last 3 hours', section: 3 },\r\n  { from: 'now-6h', to: 'now', display: 'Last 6 hours', section: 3 },\r\n  { from: 'now-12h', to: 'now', display: 'Last 12 hours', section: 3 },\r\n  { from: 'now-24h', to: 'now', display: 'Last 24 hours', section: 3 },\r\n  { from: 'now-2d', to: 'now', display: 'Last 2 days', section: 0 },\r\n  { from: 'now-7d', to: 'now', display: 'Last 7 days', section: 0 },\r\n  { from: 'now-30d', to: 'now', display: 'Last 30 days', section: 0 },\r\n  { from: 'now-90d', to: 'now', display: 'Last 90 days', section: 0 },\r\n  { from: 'now-6M', to: 'now', display: 'Last 6 months', section: 0 },\r\n  { from: 'now-1y', to: 'now', display: 'Last 1 year', section: 0 },\r\n  { from: 'now-2y', to: 'now', display: 'Last 2 years', section: 0 },\r\n  { from: 'now-5y', to: 'now', display: 'Last 5 years', section: 0 },\r\n];\r\n\r\nconst absoluteFormat = 'YYYY-MM-DD HH:mm:ss';\r\n\r\nconst rangeIndex: any = {};\r\neach(rangeOptions, (frame: any) => {\r\n  rangeIndex[frame.from + ' to ' + frame.to] = frame;\r\n});\r\n\r\nexport function getRelativeTimesList(timepickerSettings: any, currentDisplay: any) {\r\n  const groups = groupBy(rangeOptions, (option: any) => {\r\n    option.active = option.display === currentDisplay;\r\n    return option.section;\r\n  });\r\n\r\n  // _.each(timepickerSettings.time_options, (duration: string) => {\r\n  //   let info = describeTextRange(duration);\r\n  //   if (info.section) {\r\n  //     groups[info.section].push(info);\r\n  //   }\r\n  // });\r\n\r\n  return groups;\r\n}\r\n\r\nfunction formatDate(date: DateTime) {\r\n  return date.format(absoluteFormat);\r\n}\r\n\r\n// handles expressions like\r\n// 5m\r\n// 5m to now/d\r\n// now/d to now\r\n// now/d\r\n// if no to <expr> then to now is assumed\r\nexport function describeTextRange(expr: any) {\r\n  const isLast = expr.indexOf('+') !== 0;\r\n  if (expr.indexOf('now') === -1) {\r\n    expr = (isLast ? 'now-' : 'now') + expr;\r\n  }\r\n\r\n  let opt = rangeIndex[expr + ' to now'];\r\n  if (opt) {\r\n    return opt;\r\n  }\r\n\r\n  if (isLast) {\r\n    opt = { from: expr, to: 'now' };\r\n  } else {\r\n    opt = { from: 'now', to: expr };\r\n  }\r\n\r\n  const parts = /^now([-+])(\\d+)(\\w)/.exec(expr);\r\n  if (parts) {\r\n    const unit = parts[3];\r\n    const amount = parseInt(parts[2], 10);\r\n    const span = spans[unit];\r\n    if (span) {\r\n      opt.display = isLast ? 'Last ' : 'Next ';\r\n      opt.display += amount + ' ' + span.display;\r\n      opt.section = span.section;\r\n      if (amount > 1) {\r\n        opt.display += 's';\r\n      }\r\n    }\r\n  } else {\r\n    opt.display = opt.from + ' to ' + opt.to;\r\n    opt.invalid = true;\r\n  }\r\n\r\n  return opt;\r\n}\r\n\r\nexport function describeTimeRange(range: RawTimeRange): string {\r\n  const option = rangeIndex[range.from.toString() + ' to ' + range.to.toString()];\r\n  if (option) {\r\n    return option.display;\r\n  }\r\n\r\n  if (isDateTime(range.from) && isDateTime(range.to)) {\r\n    return formatDate(range.from) + ' to ' + formatDate(range.to);\r\n  }\r\n\r\n  if (isDateTime(range.from)) {\r\n    const toMoment = dateMath.parse(range.to, true);\r\n    return toMoment ? formatDate(range.from) + ' to ' + toMoment.fromNow() : '';\r\n  }\r\n\r\n  if (isDateTime(range.to)) {\r\n    const from = dateMath.parse(range.from, false);\r\n    return from ? from.fromNow() + ' to ' + formatDate(range.to) : '';\r\n  }\r\n\r\n  if (range.to.toString() === 'now') {\r\n    const res = describeTextRange(range.from);\r\n    return res.display;\r\n  }\r\n\r\n  return range.from.toString() + ' to ' + range.to.toString();\r\n}\r\n\r\nexport const isValidTimeSpan = (value: string) => {\r\n  if (value.indexOf('$') === 0 || value.indexOf('+$') === 0) {\r\n    return true;\r\n  }\r\n\r\n  const info = describeTextRange(value);\r\n  return info.invalid !== true;\r\n};\r\n","// List taken from https://stackoverflow.com/questions/38399465/how-to-get-list-of-all-timezones-in-javascript\r\n\r\nexport const getTimeZoneGroups = () => {\r\n  const europeZones = [\r\n    'Europe/Amsterdam',\r\n    'Europe/Andorra',\r\n    'Europe/Astrakhan',\r\n    'Europe/Athens',\r\n    'Europe/Belgrade',\r\n    'Europe/Berlin',\r\n    'Europe/Brussels',\r\n    'Europe/Bucharest',\r\n    'Europe/Budapest',\r\n    'Europe/Chisinau',\r\n    'Europe/Copenhagen',\r\n    'Europe/Dublin',\r\n    'Europe/Gibraltar',\r\n    'Europe/Helsinki',\r\n    'Europe/Istanbul',\r\n    'Europe/Kaliningrad',\r\n    'Europe/Kiev',\r\n    'Europe/Kirov',\r\n    'Europe/Lisbon',\r\n    'Europe/London',\r\n    'Europe/Luxembourg',\r\n    'Europe/Madrid',\r\n    'Europe/Malta',\r\n    'Europe/Minsk',\r\n    'Europe/Monaco',\r\n    'Europe/Moscow',\r\n    'Europe/Oslo',\r\n    'Europe/Paris',\r\n    'Europe/Prague',\r\n    'Europe/Riga',\r\n    'Europe/Rome',\r\n    'Europe/Samara',\r\n    'Europe/Saratov',\r\n    'Europe/Simferopol',\r\n    'Europe/Sofia',\r\n    'Europe/Stockholm',\r\n    'Europe/Tallinn',\r\n    'Europe/Tirane',\r\n    'Europe/Ulyanovsk',\r\n    'Europe/Uzhgorod',\r\n    'Europe/Vienna',\r\n    'Europe/Vilnius',\r\n    'Europe/Volgograd',\r\n    'Europe/Warsaw',\r\n    'Europe/Zaporozhye',\r\n    'Europe/Zurich',\r\n  ];\r\n\r\n  const africaZones = [\r\n    'Africa/Abidjan',\r\n    'Africa/Accra',\r\n    'Africa/Algiers',\r\n    'Africa/Bissau',\r\n    'Africa/Cairo',\r\n    'Africa/Casablanca',\r\n    'Africa/Ceuta',\r\n    'Africa/El_Aaiun',\r\n    'Africa/Johannesburg',\r\n    'Africa/Juba',\r\n    'Africa/Khartoum',\r\n    'Africa/Lagos',\r\n    'Africa/Maputo',\r\n    'Africa/Monrovia',\r\n    'Africa/Nairobi',\r\n    'Africa/Ndjamena',\r\n    'Africa/Sao_Tome',\r\n    'Africa/Tripoli',\r\n    'Africa/Tunis',\r\n    'Africa/Windhoek',\r\n  ];\r\n\r\n  const asiaZones = [\r\n    'Asia/Almaty',\r\n    'Asia/Amman',\r\n    'Asia/Anadyr',\r\n    'Asia/Aqtau',\r\n    'Asia/Aqtobe',\r\n    'Asia/Ashgabat',\r\n    'Asia/Atyrau',\r\n    'Asia/Baghdad',\r\n    'Asia/Baku',\r\n    'Asia/Bangkok',\r\n    'Asia/Barnaul',\r\n    'Asia/Beirut',\r\n    'Asia/Bishkek',\r\n    'Asia/Brunei',\r\n    'Asia/Chita',\r\n    'Asia/Choibalsan',\r\n    'Asia/Colombo',\r\n    'Asia/Damascus',\r\n    'Asia/Dhaka',\r\n    'Asia/Dili',\r\n    'Asia/Dubai',\r\n    'Asia/Dushanbe',\r\n    'Asia/Famagusta',\r\n    'Asia/Gaza',\r\n    'Asia/Hebron',\r\n    'Asia/Ho_Chi_Minh',\r\n    'Asia/Hong_Kong',\r\n    'Asia/Hovd',\r\n    'Asia/Irkutsk',\r\n    'Asia/Jakarta',\r\n    'Asia/Jayapura',\r\n    'Asia/Jerusalem',\r\n    'Asia/Kabul',\r\n    'Asia/Kamchatka',\r\n    'Asia/Karachi',\r\n    'Asia/Kathmandu',\r\n    'Asia/Khandyga',\r\n    'Asia/Kolkata',\r\n    'Asia/Krasnoyarsk',\r\n    'Asia/Kuala_Lumpur',\r\n    'Asia/Kuching',\r\n    'Asia/Macau',\r\n    'Asia/Magadan',\r\n    'Asia/Makassar',\r\n    'Asia/Manila',\r\n    'Asia/Nicosia',\r\n    'Asia/Novokuznetsk',\r\n    'Asia/Novosibirsk',\r\n    'Asia/Omsk',\r\n    'Asia/Oral',\r\n    'Asia/Pontianak',\r\n    'Asia/Pyongyang',\r\n    'Asia/Qatar',\r\n    'Asia/Qostanay',\r\n    'Asia/Qyzylorda',\r\n    'Asia/Riyadh',\r\n    'Asia/Sakhalin',\r\n    'Asia/Samarkand',\r\n    'Asia/Seoul',\r\n    'Asia/Shanghai',\r\n    'Asia/Singapore',\r\n    'Asia/Srednekolymsk',\r\n    'Asia/Taipei',\r\n    'Asia/Tashkent',\r\n    'Asia/Tbilisi',\r\n    'Asia/Tehran',\r\n    'Asia/Thimphu',\r\n    'Asia/Tokyo',\r\n    'Asia/Tomsk',\r\n    'Asia/Ulaanbaatar',\r\n    'Asia/Urumqi',\r\n    'Asia/Ust-Nera',\r\n    'Asia/Vladivostok',\r\n    'Asia/Yakutsk',\r\n    'Asia/Yangon',\r\n    'Asia/Yekaterinburg',\r\n    'Asia/Yerevan',\r\n  ];\r\n\r\n  const antarcticaZones = [\r\n    'Antarctica/Casey',\r\n    'Antarctica/Davis',\r\n    'Antarctica/DumontDUrville',\r\n    'Antarctica/Macquarie',\r\n    'Antarctica/Mawson',\r\n    'Antarctica/Palmer',\r\n    'Antarctica/Rothera',\r\n    'Antarctica/Syowa',\r\n    'Antarctica/Troll',\r\n    'Antarctica/Vostok',\r\n  ];\r\n\r\n  const americaZones = [\r\n    'America/Adak',\r\n    'America/Anchorage',\r\n    'America/Araguaina',\r\n    'America/Argentina/Buenos_Aires',\r\n    'America/Argentina/Catamarca',\r\n    'America/Argentina/Cordoba',\r\n    'America/Argentina/Jujuy',\r\n    'America/Argentina/La_Rioja',\r\n    'America/Argentina/Mendoza',\r\n    'America/Argentina/Rio_Gallegos',\r\n    'America/Argentina/Salta',\r\n    'America/Argentina/San_Juan',\r\n    'America/Argentina/San_Luis',\r\n    'America/Argentina/Tucuman',\r\n    'America/Argentina/Ushuaia',\r\n    'America/Asuncion',\r\n    'America/Atikokan',\r\n    'America/Bahia',\r\n    'America/Bahia_Banderas',\r\n    'America/Barbados',\r\n    'America/Belem',\r\n    'America/Belize',\r\n    'America/Blanc-Sablon',\r\n    'America/Boa_Vista',\r\n    'America/Bogota',\r\n    'America/Boise',\r\n    'America/Cambridge_Bay',\r\n    'America/Campo_Grande',\r\n    'America/Cancun',\r\n    'America/Caracas',\r\n    'America/Cayenne',\r\n    'America/Chicago',\r\n    'America/Chihuahua',\r\n    'America/Costa_Rica',\r\n    'America/Creston',\r\n    'America/Cuiaba',\r\n    'America/Curacao',\r\n    'America/Danmarkshavn',\r\n    'America/Dawson',\r\n    'America/Dawson_Creek',\r\n    'America/Denver',\r\n    'America/Detroit',\r\n    'America/Edmonton',\r\n    'America/Eirunepe',\r\n    'America/El_Salvador',\r\n    'America/Fort_Nelson',\r\n    'America/Fortaleza',\r\n    'America/Glace_Bay',\r\n    'America/Godthab',\r\n    'America/Goose_Bay',\r\n    'America/Grand_Turk',\r\n    'America/Guatemala',\r\n    'America/Guayaquil',\r\n    'America/Guyana',\r\n    'America/Halifax',\r\n    'America/Havana',\r\n    'America/Hermosillo',\r\n    'America/Indiana/Indianapolis',\r\n    'America/Indiana/Knox',\r\n    'America/Indiana/Marengo',\r\n    'America/Indiana/Petersburg',\r\n    'America/Indiana/Tell_City',\r\n    'America/Indiana/Vevay',\r\n    'America/Indiana/Vincennes',\r\n    'America/Indiana/Winamac',\r\n    'America/Inuvik',\r\n    'America/Iqaluit',\r\n    'America/Jamaica',\r\n    'America/Juneau',\r\n    'America/Kentucky/Louisville',\r\n    'America/Kentucky/Monticello',\r\n    'America/La_Paz',\r\n    'America/Lima',\r\n    'America/Los_Angeles',\r\n    'America/Maceio',\r\n    'America/Managua',\r\n    'America/Manaus',\r\n    'America/Martinique',\r\n    'America/Matamoros',\r\n    'America/Mazatlan',\r\n    'America/Menominee',\r\n    'America/Merida',\r\n    'America/Metlakatla',\r\n    'America/Mexico_City',\r\n    'America/Miquelon',\r\n    'America/Moncton',\r\n    'America/Monterrey',\r\n    'America/Montevideo',\r\n    'America/Nassau',\r\n    'America/New_York',\r\n    'America/Nipigon',\r\n    'America/Nome',\r\n    'America/Noronha',\r\n    'America/North_Dakota/Beulah',\r\n    'America/North_Dakota/Center',\r\n    'America/North_Dakota/New_Salem',\r\n    'America/Ojinaga',\r\n    'America/Panama',\r\n    'America/Pangnirtung',\r\n    'America/Paramaribo',\r\n    'America/Phoenix',\r\n    'America/Port-au-Prince',\r\n    'America/Port_of_Spain',\r\n    'America/Porto_Velho',\r\n    'America/Puerto_Rico',\r\n    'America/Punta_Arenas',\r\n    'America/Rainy_River',\r\n    'America/Rankin_Inlet',\r\n    'America/Recife',\r\n    'America/Regina',\r\n    'America/Resolute',\r\n    'America/Rio_Branco',\r\n    'America/Santarem',\r\n    'America/Santiago',\r\n    'America/Santo_Domingo',\r\n    'America/Sao_Paulo',\r\n    'America/Scoresbysund',\r\n    'America/Sitka',\r\n    'America/St_Johns',\r\n    'America/Swift_Current',\r\n    'America/Tegucigalpa',\r\n    'America/Thule',\r\n    'America/Thunder_Bay',\r\n    'America/Tijuana',\r\n    'America/Toronto',\r\n    'America/Vancouver',\r\n    'America/Whitehorse',\r\n    'America/Winnipeg',\r\n    'America/Yakutat',\r\n    'America/Yellowknife',\r\n  ];\r\n\r\n  const pacificZones = [\r\n    'Pacific/Apia',\r\n    'Pacific/Auckland',\r\n    'Pacific/Bougainville',\r\n    'Pacific/Chatham',\r\n    'Pacific/Chuuk',\r\n    'Pacific/Easter',\r\n    'Pacific/Efate',\r\n    'Pacific/Enderbury',\r\n    'Pacific/Fakaofo',\r\n    'Pacific/Fiji',\r\n    'Pacific/Funafuti',\r\n    'Pacific/Galapagos',\r\n    'Pacific/Gambier',\r\n    'Pacific/Guadalcanal',\r\n    'Pacific/Guam',\r\n    'Pacific/Honolulu',\r\n    'Pacific/Kiritimati',\r\n    'Pacific/Kosrae',\r\n    'Pacific/Kwajalein',\r\n    'Pacific/Majuro',\r\n    'Pacific/Marquesas',\r\n    'Pacific/Nauru',\r\n    'Pacific/Niue',\r\n    'Pacific/Norfolk',\r\n    'Pacific/Noumea',\r\n    'Pacific/Pago_Pago',\r\n    'Pacific/Palau',\r\n    'Pacific/Pitcairn',\r\n    'Pacific/Pohnpei',\r\n    'Pacific/Port_Moresby',\r\n    'Pacific/Rarotonga',\r\n    'Pacific/Tahiti',\r\n    'Pacific/Tarawa',\r\n    'Pacific/Tongatapu',\r\n    'Pacific/Wake',\r\n    'Pacific/Wallis',\r\n  ];\r\n\r\n  const australiaZones = [\r\n    'Australia/Adelaide',\r\n    'Australia/Brisbane',\r\n    'Australia/Broken_Hill',\r\n    'Australia/Currie',\r\n    'Australia/Darwin',\r\n    'Australia/Eucla',\r\n    'Australia/Hobart',\r\n    'Australia/Lindeman',\r\n    'Australia/Lord_Howe',\r\n    'Australia/Melbourne',\r\n    'Australia/Perth',\r\n    'Australia/Sydney',\r\n  ];\r\n\r\n  const atlanticZones = [\r\n    'Atlantic/Azores',\r\n    'Atlantic/Bermuda',\r\n    'Atlantic/Canary',\r\n    'Atlantic/Cape_Verde',\r\n    'Atlantic/Faroe',\r\n    'Atlantic/Madeira',\r\n    'Atlantic/Reykjavik',\r\n    'Atlantic/South_Georgia',\r\n    'Atlantic/Stanley',\r\n  ];\r\n\r\n  const indianZones = [\r\n    'Indian/Chagos',\r\n    'Indian/Christmas',\r\n    'Indian/Cocos',\r\n    'Indian/Kerguelen',\r\n    'Indian/Mahe',\r\n    'Indian/Maldives',\r\n    'Indian/Mauritius',\r\n    'Indian/Reunion',\r\n  ];\r\n\r\n  return [\r\n    { label: 'Africa', options: africaZones },\r\n    { label: 'America', options: americaZones },\r\n    { label: 'Antarctica', options: antarcticaZones },\r\n    { label: 'Asia', options: asiaZones },\r\n    { label: 'Atlantic', options: atlanticZones },\r\n    { label: 'Australia', options: australiaZones },\r\n    { label: 'Europe', options: europeZones },\r\n    { label: 'Indian', options: indianZones },\r\n    { label: 'Pacific', options: pacificZones },\r\n  ];\r\n};\r\n","// Libraries\r\nimport _ from 'lodash';\r\n\r\n// Types\r\nimport { Field, FieldType } from '../types/dataFrame';\r\nimport { GrafanaTheme } from '../types/theme';\r\nimport { DisplayProcessor, DisplayValue, DecimalCount, DecimalInfo } from '../types/displayValue';\r\nimport { getValueFormat } from '../valueFormats/valueFormats';\r\nimport { getMappedValue } from '../utils/valueMappings';\r\nimport { DEFAULT_DATE_TIME_FORMAT } from '../datetime';\r\nimport { KeyValue, TimeZone } from '../types';\r\nimport { getScaleCalculator } from './scale';\r\n\r\ninterface DisplayProcessorOptions {\r\n  field: Partial<Field>;\r\n\r\n  // Context\r\n  timeZone?: TimeZone;\r\n  theme?: GrafanaTheme; // Will pick 'dark' if not defined\r\n}\r\n\r\n// Reasonable units for time\r\nconst timeFormats: KeyValue<boolean> = {\r\n  dateTimeAsIso: true,\r\n  dateTimeAsUS: true,\r\n  dateTimeFromNow: true,\r\n};\r\n\r\nexport function getDisplayProcessor(options?: DisplayProcessorOptions): DisplayProcessor {\r\n  if (!options || _.isEmpty(options) || !options.field) {\r\n    return toStringProcessor;\r\n  }\r\n  const { field } = options;\r\n  const config = field.config ?? {};\r\n\r\n  if (field.type === FieldType.time) {\r\n    if (config.unit && timeFormats[config.unit]) {\r\n      // Currently selected unit is valid for time fields\r\n    } else if (config.unit && config.unit.startsWith('time:')) {\r\n      // Also OK\r\n    } else {\r\n      config.unit = `time:${DEFAULT_DATE_TIME_FORMAT}`;\r\n    }\r\n  }\r\n\r\n  const formatFunc = getValueFormat(config.unit || 'none');\r\n  const scaleFunc = getScaleCalculator(field as Field, options.theme);\r\n\r\n  return (value: any) => {\r\n    const { mappings } = config;\r\n\r\n    let text = _.toString(value);\r\n    let numeric = toNumber(value);\r\n    let prefix: string | undefined = undefined;\r\n    let suffix: string | undefined = undefined;\r\n\r\n    let shouldFormat = true;\r\n    if (mappings && mappings.length > 0) {\r\n      const mappedValue = getMappedValue(mappings, value);\r\n\r\n      if (mappedValue) {\r\n        text = mappedValue.text;\r\n        const v = toNumber(text);\r\n\r\n        if (!isNaN(v)) {\r\n          numeric = v;\r\n        }\r\n\r\n        shouldFormat = false;\r\n      }\r\n    }\r\n\r\n    if (!isNaN(numeric)) {\r\n      if (shouldFormat && !_.isBoolean(value)) {\r\n        const { decimals, scaledDecimals } = getDecimalsForValue(value, config.decimals);\r\n        const v = formatFunc(numeric, decimals, scaledDecimals, options.timeZone);\r\n        text = v.text;\r\n        suffix = v.suffix;\r\n        prefix = v.prefix;\r\n\r\n        // Check if the formatted text mapped to a different value\r\n        if (mappings && mappings.length > 0) {\r\n          const mappedValue = getMappedValue(mappings, text);\r\n          if (mappedValue) {\r\n            text = mappedValue.text;\r\n          }\r\n        }\r\n      }\r\n\r\n      // Return the value along with scale info\r\n      if (text) {\r\n        return { text, numeric, prefix, suffix, ...scaleFunc(numeric) };\r\n      }\r\n    }\r\n\r\n    if (!text) {\r\n      if (config.noValue) {\r\n        text = config.noValue;\r\n      } else {\r\n        text = ''; // No data?\r\n      }\r\n    }\r\n    return { text, numeric, prefix, suffix };\r\n  };\r\n}\r\n\r\n/** Will return any value as a number or NaN */\r\nfunction toNumber(value: any): number {\r\n  if (typeof value === 'number') {\r\n    return value;\r\n  }\r\n  if (value === '' || value === null || value === undefined || Array.isArray(value)) {\r\n    return NaN; // lodash calls them 0\r\n  }\r\n  if (typeof value === 'boolean') {\r\n    return value ? 1 : 0;\r\n  }\r\n  return _.toNumber(value);\r\n}\r\n\r\nfunction toStringProcessor(value: any): DisplayValue {\r\n  return { text: _.toString(value), numeric: toNumber(value) };\r\n}\r\n\r\nexport function getDecimalsForValue(value: number, decimalOverride?: DecimalCount): DecimalInfo {\r\n  if (_.isNumber(decimalOverride)) {\r\n    // It's important that scaledDecimals is null here\r\n    return { decimals: decimalOverride, scaledDecimals: null };\r\n  }\r\n\r\n  let dec = -Math.floor(Math.log(value) / Math.LN10) + 1;\r\n  const magn = Math.pow(10, -dec);\r\n  const norm = value / magn; // norm is between 1.0 and 10.0\r\n  let size;\r\n\r\n  if (norm < 1.5) {\r\n    size = 1;\r\n  } else if (norm < 3) {\r\n    size = 2;\r\n    // special case for 2.5, requires an extra decimal\r\n    if (norm > 2.25) {\r\n      size = 2.5;\r\n      ++dec;\r\n    }\r\n  } else if (norm < 7.5) {\r\n    size = 5;\r\n  } else {\r\n    size = 10;\r\n  }\r\n\r\n  size *= magn;\r\n\r\n  // reduce starting decimals if not needed\r\n  if (value % 1 === 0) {\r\n    dec = 0;\r\n  }\r\n\r\n  const decimals = Math.max(0, dec);\r\n  const scaledDecimals = decimals - Math.floor(Math.log(size) / Math.LN10) + 2;\r\n\r\n  return { decimals, scaledDecimals };\r\n}\r\n","import toString from 'lodash/toString';\r\nimport isEmpty from 'lodash/isEmpty';\r\n\r\nimport { getDisplayProcessor } from './displayProcessor';\r\nimport { getFlotPairs } from '../utils/flotPairs';\r\nimport {\r\n  FieldConfig,\r\n  DataFrame,\r\n  FieldType,\r\n  DisplayValue,\r\n  DisplayValueAlignmentFactors,\r\n  FieldConfigSource,\r\n  InterpolateFunction,\r\n} from '../types';\r\nimport { DataFrameView } from '../dataframe/DataFrameView';\r\nimport { GraphSeriesValue } from '../types/graph';\r\nimport { GrafanaTheme } from '../types/theme';\r\nimport { ReducerID, reduceField } from '../transformations/fieldReducer';\r\nimport { ScopedVars } from '../types/ScopedVars';\r\nimport { getTimeField } from '../dataframe/processDataFrame';\r\nimport { applyFieldOverrides } from './fieldOverrides';\r\n\r\nexport interface FieldDisplayOptions extends FieldConfigSource {\r\n  values?: boolean; // If true show each row value\r\n  limit?: number; // if showing all values limit\r\n  calcs: string[]; // when !values, pick one value for the whole field\r\n}\r\n\r\n// TODO: use built in variables, same as for data links?\r\nexport const VAR_SERIES_NAME = '__series.name';\r\nexport const VAR_FIELD_NAME = '__field.name';\r\nexport const VAR_CALC = '__calc';\r\nexport const VAR_CELL_PREFIX = '__cell_'; // consistent with existing table templates\r\n\r\nfunction getTitleTemplate(title: string | undefined, stats: string[], data?: DataFrame[]): string {\r\n  // If the title exists, use it as a template variable\r\n  if (title) {\r\n    return title;\r\n  }\r\n  if (!data || !data.length) {\r\n    return 'No Data';\r\n  }\r\n\r\n  let fieldCount = 0;\r\n  for (const field of data[0].fields) {\r\n    if (field.type === FieldType.number) {\r\n      fieldCount++;\r\n    }\r\n  }\r\n\r\n  const parts: string[] = [];\r\n  if (stats.length > 1) {\r\n    parts.push('${' + VAR_CALC + '}');\r\n  }\r\n  if (data.length > 1) {\r\n    parts.push('${' + VAR_SERIES_NAME + '}');\r\n  }\r\n  if (fieldCount > 1 || !parts.length) {\r\n    parts.push('${' + VAR_FIELD_NAME + '}');\r\n  }\r\n  return parts.join(' ');\r\n}\r\n\r\nexport interface FieldDisplay {\r\n  name: string; // The field name (title is in display)\r\n  field: FieldConfig;\r\n  display: DisplayValue;\r\n  sparkline?: GraphSeriesValue[][];\r\n\r\n  // Expose to the original values for delayed inspection (DataLinks etc)\r\n  view?: DataFrameView;\r\n  colIndex?: number; // The field column index\r\n  rowIndex?: number; // only filled in when the value is from a row (ie, not a reduction)\r\n}\r\n\r\nexport interface GetFieldDisplayValuesOptions {\r\n  data?: DataFrame[];\r\n  fieldOptions: FieldDisplayOptions;\r\n  replaceVariables: InterpolateFunction;\r\n  sparkline?: boolean; // Calculate the sparkline\r\n  theme: GrafanaTheme;\r\n  autoMinMax?: boolean;\r\n}\r\n\r\nexport const DEFAULT_FIELD_DISPLAY_VALUES_LIMIT = 25;\r\n\r\nexport const getFieldDisplayValues = (options: GetFieldDisplayValuesOptions): FieldDisplay[] => {\r\n  const { replaceVariables, fieldOptions } = options;\r\n  const calcs = fieldOptions.calcs.length ? fieldOptions.calcs : [ReducerID.last];\r\n\r\n  const values: FieldDisplay[] = [];\r\n\r\n  if (options.data) {\r\n    const data = applyFieldOverrides(options);\r\n\r\n    let hitLimit = false;\r\n    const limit = fieldOptions.limit ? fieldOptions.limit : DEFAULT_FIELD_DISPLAY_VALUES_LIMIT;\r\n    const defaultTitle = getTitleTemplate(fieldOptions.defaults.title, calcs, data);\r\n    const scopedVars: ScopedVars = {};\r\n\r\n    for (let s = 0; s < data.length && !hitLimit; s++) {\r\n      const series = data[s]; // Name is already set\r\n      scopedVars['__series'] = { text: 'Series', value: { name: series.name } };\r\n\r\n      const { timeField } = getTimeField(series);\r\n      const view = new DataFrameView(series);\r\n\r\n      for (let i = 0; i < series.fields.length && !hitLimit; i++) {\r\n        const field = series.fields[i];\r\n\r\n        // Show all number fields\r\n        if (field.type !== FieldType.number) {\r\n          continue;\r\n        }\r\n        const config = field.config; // already set by the prepare task\r\n\r\n        let name = field.name;\r\n        if (!name) {\r\n          name = `Field[${s}]`;\r\n        }\r\n\r\n        scopedVars['__field'] = { text: 'Field', value: { name } };\r\n\r\n        const display =\r\n          field.display ??\r\n          getDisplayProcessor({\r\n            field,\r\n            theme: options.theme,\r\n          });\r\n\r\n        const title = config.title ? config.title : defaultTitle;\r\n        // Show all rows\r\n        if (fieldOptions.values) {\r\n          const usesCellValues = title.indexOf(VAR_CELL_PREFIX) >= 0;\r\n\r\n          for (let j = 0; j < field.values.length; j++) {\r\n            // Add all the row variables\r\n            if (usesCellValues) {\r\n              for (let k = 0; k < series.fields.length; k++) {\r\n                const f = series.fields[k];\r\n                const v = f.values.get(j);\r\n                scopedVars[VAR_CELL_PREFIX + k] = {\r\n                  value: v,\r\n                  text: toString(v),\r\n                };\r\n              }\r\n            }\r\n\r\n            const displayValue = display(field.values.get(j));\r\n            displayValue.title = replaceVariables(title, scopedVars);\r\n            values.push({\r\n              name,\r\n              field: config,\r\n              display: displayValue,\r\n              view,\r\n              colIndex: i,\r\n              rowIndex: j,\r\n            });\r\n\r\n            if (values.length >= limit) {\r\n              hitLimit = true;\r\n              break;\r\n            }\r\n          }\r\n        } else {\r\n          const results = reduceField({\r\n            field,\r\n            reducers: calcs, // The stats to calculate\r\n          });\r\n          let sparkline: GraphSeriesValue[][] | undefined = undefined;\r\n\r\n          // Single sparkline for every reducer\r\n          if (options.sparkline && timeField) {\r\n            sparkline = getFlotPairs({\r\n              xField: timeField,\r\n              yField: series.fields[i],\r\n            });\r\n          }\r\n\r\n          for (const calc of calcs) {\r\n            scopedVars[VAR_CALC] = { value: calc, text: calc };\r\n            const displayValue = display(results[calc]);\r\n            displayValue.title = replaceVariables(title, scopedVars);\r\n            values.push({\r\n              name: calc,\r\n              field: config,\r\n              display: displayValue,\r\n              sparkline,\r\n              view,\r\n              colIndex: i,\r\n            });\r\n          }\r\n        }\r\n      }\r\n    }\r\n  }\r\n\r\n  if (values.length === 0) {\r\n    values.push(createNoValuesFieldDisplay(options));\r\n  } else if (values.length === 1 && !fieldOptions.defaults.title) {\r\n    // Don't show title for single item\r\n    values[0].display.title = undefined;\r\n  }\r\n\r\n  return values;\r\n};\r\n\r\nexport function getDisplayValueAlignmentFactors(values: FieldDisplay[]): DisplayValueAlignmentFactors {\r\n  const info: DisplayValueAlignmentFactors = {\r\n    title: '',\r\n    text: '',\r\n  };\r\n\r\n  let prefixLength = 0;\r\n  let suffixLength = 0;\r\n\r\n  for (let i = 0; i < values.length; i++) {\r\n    const v = values[i].display;\r\n\r\n    if (v.text && v.text.length > info.text.length) {\r\n      info.text = v.text;\r\n    }\r\n\r\n    if (v.title && v.title.length > info.title.length) {\r\n      info.title = v.title;\r\n    }\r\n\r\n    if (v.prefix && v.prefix.length > prefixLength) {\r\n      info.prefix = v.prefix;\r\n      prefixLength = v.prefix.length;\r\n    }\r\n\r\n    if (v.suffix && v.suffix.length > suffixLength) {\r\n      info.suffix = v.suffix;\r\n      suffixLength = v.suffix.length;\r\n    }\r\n  }\r\n  return info;\r\n}\r\n\r\nfunction createNoValuesFieldDisplay(options: GetFieldDisplayValuesOptions): FieldDisplay {\r\n  const displayName = 'No data';\r\n  const { fieldOptions } = options;\r\n  const { defaults } = fieldOptions;\r\n\r\n  const displayProcessor = getDisplayProcessor({\r\n    field: {\r\n      type: FieldType.other,\r\n      config: defaults,\r\n    },\r\n    theme: options.theme,\r\n  });\r\n\r\n  const display = displayProcessor(null);\r\n  const text = getDisplayText(display, displayName);\r\n\r\n  return {\r\n    name: displayName,\r\n    field: {\r\n      ...defaults,\r\n    },\r\n    display: {\r\n      text,\r\n      numeric: 0,\r\n    },\r\n  };\r\n}\r\n\r\nfunction getDisplayText(display: DisplayValue, fallback: string): string {\r\n  if (!display || isEmpty(display.text)) {\r\n    return fallback;\r\n  }\r\n  return display.text;\r\n}\r\n","import set from 'lodash/set';\r\nimport {\r\n  GrafanaTheme,\r\n  DynamicConfigValue,\r\n  FieldConfig,\r\n  InterpolateFunction,\r\n  DataFrame,\r\n  Field,\r\n  FieldType,\r\n  FieldConfigSource,\r\n  ThresholdsMode,\r\n  FieldColorMode,\r\n  ColorScheme,\r\n  TimeZone,\r\n} from '../types';\r\nimport { fieldMatchers, ReducerID, reduceField } from '../transformations';\r\nimport { FieldMatcher } from '../types/transformations';\r\nimport isNumber from 'lodash/isNumber';\r\nimport toNumber from 'lodash/toNumber';\r\nimport { getDisplayProcessor } from './displayProcessor';\r\nimport { guessFieldTypeForField } from '../dataframe';\r\n\r\ninterface OverrideProps {\r\n  match: FieldMatcher;\r\n  properties: DynamicConfigValue[];\r\n}\r\n\r\ninterface GlobalMinMax {\r\n  min: number;\r\n  max: number;\r\n}\r\n\r\nexport interface ApplyFieldOverrideOptions {\r\n  data?: DataFrame[];\r\n  fieldOptions: FieldConfigSource;\r\n  replaceVariables: InterpolateFunction;\r\n  theme: GrafanaTheme;\r\n  timeZone?: TimeZone;\r\n  autoMinMax?: boolean;\r\n}\r\n\r\nexport function findNumericFieldMinMax(data: DataFrame[]): GlobalMinMax {\r\n  let min = Number.MAX_VALUE;\r\n  let max = Number.MIN_VALUE;\r\n\r\n  const reducers = [ReducerID.min, ReducerID.max];\r\n  for (const frame of data) {\r\n    for (const field of frame.fields) {\r\n      if (field.type === FieldType.number) {\r\n        const stats = reduceField({ field, reducers });\r\n        if (stats[ReducerID.min] < min) {\r\n          min = stats[ReducerID.min];\r\n        }\r\n        if (stats[ReducerID.max] > max) {\r\n          max = stats[ReducerID.max];\r\n        }\r\n      }\r\n    }\r\n  }\r\n\r\n  return { min, max };\r\n}\r\n\r\n/**\r\n * Return a copy of the DataFrame with all rules applied\r\n */\r\nexport function applyFieldOverrides(options: ApplyFieldOverrideOptions): DataFrame[] {\r\n  if (!options.data) {\r\n    return [];\r\n  }\r\n\r\n  const source = options.fieldOptions;\r\n  if (!source) {\r\n    return options.data;\r\n  }\r\n\r\n  let range: GlobalMinMax | undefined = undefined;\r\n\r\n  // Prepare the Matchers\r\n  const override: OverrideProps[] = [];\r\n  if (source.overrides) {\r\n    for (const rule of source.overrides) {\r\n      const info = fieldMatchers.get(rule.matcher.id);\r\n      if (info) {\r\n        override.push({\r\n          match: info.get(rule.matcher.options),\r\n          properties: rule.properties,\r\n        });\r\n      }\r\n    }\r\n  }\r\n\r\n  return options.data.map((frame, index) => {\r\n    let name = frame.name;\r\n    if (!name) {\r\n      name = `Series[${index}]`;\r\n    }\r\n\r\n    const fields: Field[] = frame.fields.map(field => {\r\n      // Config is mutable within this scope\r\n      const config: FieldConfig = { ...field.config } || {};\r\n      if (field.type === FieldType.number) {\r\n        setFieldConfigDefaults(config, source.defaults);\r\n      }\r\n\r\n      // Find any matching rules and then override\r\n      for (const rule of override) {\r\n        if (rule.match(field)) {\r\n          for (const prop of rule.properties) {\r\n            setDynamicConfigValue(config, {\r\n              value: prop,\r\n              config,\r\n              field,\r\n              data: frame,\r\n              replaceVariables: options.replaceVariables,\r\n            });\r\n          }\r\n        }\r\n      }\r\n\r\n      // Try harder to set a real value that is not 'other'\r\n      let type = field.type;\r\n      if (!type || type === FieldType.other) {\r\n        const t = guessFieldTypeForField(field);\r\n        if (t) {\r\n          type = t;\r\n        }\r\n      }\r\n\r\n      // Some units have an implied range\r\n      if (config.unit === 'percent') {\r\n        if (!isNumber(config.min)) {\r\n          config.min = 0;\r\n        }\r\n        if (!isNumber(config.max)) {\r\n          config.max = 100;\r\n        }\r\n      } else if (config.unit === 'percentunit') {\r\n        if (!isNumber(config.min)) {\r\n          config.min = 0;\r\n        }\r\n        if (!isNumber(config.max)) {\r\n          config.max = 1;\r\n        }\r\n      }\r\n\r\n      // Set the Min/Max value automatically\r\n      if (options.autoMinMax && field.type === FieldType.number) {\r\n        if (!isNumber(config.min) || !isNumber(config.max)) {\r\n          if (!range) {\r\n            range = findNumericFieldMinMax(options.data!); // Global value\r\n          }\r\n          if (!isNumber(config.min)) {\r\n            config.min = range.min;\r\n          }\r\n          if (!isNumber(config.max)) {\r\n            config.max = range.max;\r\n          }\r\n        }\r\n      }\r\n\r\n      // Overwrite the configs\r\n      const f: Field = {\r\n        ...field,\r\n        config,\r\n        type,\r\n      };\r\n      // and set the display processor using it\r\n      f.display = getDisplayProcessor({\r\n        field: f,\r\n        theme: options.theme,\r\n        timeZone: options.timeZone,\r\n      });\r\n      return f;\r\n    });\r\n\r\n    return {\r\n      ...frame,\r\n      fields,\r\n      name,\r\n    };\r\n  });\r\n}\r\n\r\ninterface DynamicConfigValueOptions {\r\n  value: DynamicConfigValue;\r\n  config: FieldConfig;\r\n  field: Field;\r\n  data: DataFrame;\r\n  replaceVariables: InterpolateFunction;\r\n}\r\n\r\nconst numericFieldProps: any = {\r\n  decimals: true,\r\n  min: true,\r\n  max: true,\r\n};\r\n\r\nfunction prepareConfigValue(key: string, input: any, options?: DynamicConfigValueOptions): any {\r\n  if (options) {\r\n    // TODO template variables etc\r\n  }\r\n\r\n  if (numericFieldProps[key]) {\r\n    const num = toNumber(input);\r\n    if (isNaN(num)) {\r\n      return null;\r\n    }\r\n    return num;\r\n  } else if (input) {\r\n    // skips empty string\r\n    if (key === 'unit' && input === 'none') {\r\n      return null;\r\n    }\r\n  }\r\n  return input;\r\n}\r\n\r\nexport function setDynamicConfigValue(config: FieldConfig, options: DynamicConfigValueOptions) {\r\n  const { value } = options;\r\n  const v = prepareConfigValue(value.path, value.value, options);\r\n  set(config, value.path, v);\r\n}\r\n\r\n/**\r\n * For numeric values, only valid numbers will be applied\r\n * for units, 'none' will be skipped\r\n */\r\nexport function setFieldConfigDefaults(config: FieldConfig, props?: FieldConfig) {\r\n  if (props) {\r\n    const keys = Object.keys(props);\r\n    for (const key of keys) {\r\n      const val = prepareConfigValue(key, (props as any)[key]);\r\n      if (val === null || val === undefined) {\r\n        continue;\r\n      }\r\n      set(config, key, val);\r\n    }\r\n  }\r\n\r\n  validateFieldConfig(config);\r\n}\r\n\r\n/**\r\n * This checks that all options on FieldConfig make sense.  It mutates any value that needs\r\n * fixed.  In particular this makes sure that the first threshold value is -Infinity (not valid in JSON)\r\n */\r\nexport function validateFieldConfig(config: FieldConfig) {\r\n  const { thresholds } = config;\r\n  if (thresholds) {\r\n    if (!thresholds.mode) {\r\n      thresholds.mode = ThresholdsMode.Absolute;\r\n    }\r\n    if (!thresholds.steps) {\r\n      thresholds.steps = [];\r\n    } else if (thresholds.steps.length) {\r\n      // First value is always -Infinity\r\n      // JSON saves it as null\r\n      thresholds.steps[0].value = -Infinity;\r\n    }\r\n  }\r\n\r\n  if (!config.color) {\r\n    if (thresholds) {\r\n      config.color = {\r\n        mode: FieldColorMode.Thresholds,\r\n      };\r\n    }\r\n    // No Color settings\r\n  } else if (!config.color.mode) {\r\n    // Without a mode, skip color altogether\r\n    delete config.color;\r\n  } else {\r\n    const { color } = config;\r\n    if (color.mode === FieldColorMode.Scheme) {\r\n      if (!color.schemeName) {\r\n        color.schemeName = ColorScheme.BrBG;\r\n      }\r\n    } else {\r\n      delete color.schemeName;\r\n    }\r\n  }\r\n\r\n  // Verify that max > min (swap if necessary)\r\n  if (config.hasOwnProperty('min') && config.hasOwnProperty('max') && config.min! > config.max!) {\r\n    const tmp = config.max;\r\n    config.max = config.min;\r\n    config.min = tmp;\r\n  }\r\n}\r\n","export * from './fieldDisplay';\r\nexport * from './displayProcessor';\r\nexport * from './scale';\r\n\r\nexport { applyFieldOverrides, validateFieldConfig } from './fieldOverrides';\r\n","import { Field, Threshold, GrafanaTheme, GrafanaThemeType, ThresholdsMode, FieldColorMode } from '../types';\r\nimport { reduceField, ReducerID } from '../transformations';\r\nimport { getColorFromHexRgbOrName } from '../utils/namedColorsPalette';\r\nimport * as d3 from 'd3-scale-chromatic';\r\nimport isNumber from 'lodash/isNumber';\r\n\r\nexport interface ScaledValue {\r\n  percent?: number; // 0-1\r\n  threshold?: Threshold; // the selected step\r\n  color?: string; // Selected color (may be range based on threshold)\r\n}\r\n\r\nexport type ScaleCalculator = (value: number) => ScaledValue;\r\n\r\n/**\r\n * @param t Number in the range [0, 1].\r\n */\r\ntype colorInterpolator = (t: number) => string;\r\n\r\nexport function getScaleCalculator(field: Field, theme?: GrafanaTheme): ScaleCalculator {\r\n  const themeType = theme ? theme.type : GrafanaThemeType.Dark;\r\n  const config = field.config || {};\r\n  const { thresholds, color } = config;\r\n\r\n  const fixedColor =\r\n    color && color.mode === FieldColorMode.Fixed && color.fixedColor\r\n      ? getColorFromHexRgbOrName(color.fixedColor, themeType)\r\n      : undefined;\r\n\r\n  // Should we calculate the percentage\r\n  const percentThresholds = thresholds && thresholds.mode === ThresholdsMode.Percentage;\r\n  const useColorScheme = color && color.mode === FieldColorMode.Scheme;\r\n  if (percentThresholds || useColorScheme) {\r\n    // Calculate min/max if required\r\n    let min = config.min;\r\n    let max = config.max;\r\n    if (!isNumber(min) || !isNumber(max)) {\r\n      if (field.values && field.values.length) {\r\n        const stats = reduceField({ field, reducers: [ReducerID.min, ReducerID.max] });\r\n        if (!isNumber(min)) {\r\n          min = stats[ReducerID.min];\r\n        }\r\n        if (!isNumber(max)) {\r\n          max = stats[ReducerID.max];\r\n        }\r\n      } else {\r\n        min = 0;\r\n        max = 100;\r\n      }\r\n    }\r\n    const delta = max! - min!;\r\n\r\n    // Use a d3 color scale\r\n    let interpolator: colorInterpolator | undefined;\r\n    if (useColorScheme) {\r\n      interpolator = (d3 as any)[`interpolate${color!.schemeName}`] as colorInterpolator;\r\n    }\r\n\r\n    return (value: number) => {\r\n      const percent = (value - min!) / delta;\r\n      const threshold = thresholds\r\n        ? getActiveThreshold(percentThresholds ? percent * 100 : value, thresholds.steps)\r\n        : undefined; // 0-100\r\n      let color = fixedColor;\r\n      if (interpolator) {\r\n        color = interpolator(percent);\r\n      } else if (threshold) {\r\n        color = getColorFromHexRgbOrName(threshold!.color, themeType);\r\n      }\r\n\r\n      return {\r\n        percent,\r\n        threshold,\r\n        color,\r\n      };\r\n    };\r\n  }\r\n\r\n  if (thresholds) {\r\n    return (value: number) => {\r\n      const threshold = getActiveThreshold(value, thresholds.steps);\r\n      const color = fixedColor ?? (threshold ? getColorFromHexRgbOrName(threshold.color, themeType) : undefined);\r\n      return {\r\n        threshold,\r\n        color,\r\n      };\r\n    };\r\n  }\r\n\r\n  // Constant color\r\n  if (fixedColor) {\r\n    return (value: number) => {\r\n      return { color: fixedColor };\r\n    };\r\n  }\r\n\r\n  // NO-OP\r\n  return (value: number) => {\r\n    return {};\r\n  };\r\n}\r\n\r\nexport function getActiveThreshold(value: number, thresholds: Threshold[]): Threshold {\r\n  let active = thresholds[0];\r\n  for (const threshold of thresholds) {\r\n    if (value >= threshold.value) {\r\n      active = threshold;\r\n    } else {\r\n      break;\r\n    }\r\n  }\r\n  return active;\r\n}\r\n\r\n/**\r\n * Sorts the thresholds\r\n */\r\nexport function sortThresholds(thresholds: Threshold[]) {\r\n  return thresholds.sort((t1, t2) => {\r\n    return t1.value - t2.value;\r\n  });\r\n}\r\n","export * from './utils';\r\nexport * from './types';\r\nexport * from './vector';\r\nexport * from './dataframe';\r\nexport * from './transformations';\r\nexport * from './datetime';\r\nexport * from './text';\r\nexport * from './valueFormats';\r\nexport * from './field';\r\n","export * from './string';\r\nexport * from './markdown';\r\nexport * from './text';\r\n","import marked, { MarkedOptions } from 'marked';\r\n\r\nconst defaultMarkedOptions: MarkedOptions = {\r\n  renderer: new marked.Renderer(),\r\n  pedantic: false,\r\n  gfm: true,\r\n  tables: true,\r\n  sanitize: true,\r\n  smartLists: true,\r\n  smartypants: false,\r\n  xhtml: false,\r\n};\r\n\r\nexport function setMarkdownOptions(optionsOverride?: MarkedOptions) {\r\n  marked.setOptions({ ...defaultMarkedOptions, ...optionsOverride });\r\n}\r\n\r\nexport function renderMarkdown(str?: string): string {\r\n  return marked(str || '');\r\n}\r\n","const specialChars = ['(', '[', '{', '}', ']', ')', '|', '*', '+', '-', '.', '?', '<', '>', '#', '&', '^', '$'];\r\n\r\nexport const escapeStringForRegex = (value: string) => {\r\n  if (!value) {\r\n    return value;\r\n  }\r\n\r\n  return specialChars.reduce((escaped, currentChar) => escaped.replace(currentChar, '\\\\' + currentChar), value);\r\n};\r\n\r\nexport const unEscapeStringFromRegex = (value: string) => {\r\n  if (!value) {\r\n    return value;\r\n  }\r\n\r\n  return specialChars.reduce((escaped, currentChar) => escaped.replace('\\\\' + currentChar, currentChar), value);\r\n};\r\n\r\nexport function stringStartsAsRegEx(str: string): boolean {\r\n  if (!str) {\r\n    return false;\r\n  }\r\n\r\n  return str[0] === '/';\r\n}\r\n\r\nexport function stringToJsRegex(str: string): RegExp {\r\n  if (!stringStartsAsRegEx(str)) {\r\n    return new RegExp(`^${str}$`);\r\n  }\r\n\r\n  const match = str.match(new RegExp('^/(.*?)/(g?i?m?y?)$'));\r\n\r\n  if (!match) {\r\n    throw new Error(`'${str}' is not a valid regular expression.`);\r\n  }\r\n\r\n  return new RegExp(match[1], match[2]);\r\n}\r\n\r\nexport function stringToMs(str: string): number {\r\n  if (!str) {\r\n    return 0;\r\n  }\r\n\r\n  const nr = parseInt(str, 10);\r\n  const unit = str.substr(String(nr).length);\r\n  const s = 1000;\r\n  const m = s * 60;\r\n  const h = m * 60;\r\n  const d = h * 24;\r\n\r\n  switch (unit) {\r\n    case 's':\r\n      return nr * s;\r\n    case 'm':\r\n      return nr * m;\r\n    case 'h':\r\n      return nr * h;\r\n    case 'd':\r\n      return nr * d;\r\n    default:\r\n      if (!unit) {\r\n        return isNaN(nr) ? 0 : nr;\r\n      }\r\n      throw new Error('Not supported unit: ' + unit);\r\n  }\r\n}\r\n\r\nexport function toNumberString(value: number | undefined | null): string {\r\n  if (value !== null && value !== undefined && Number.isFinite(value as number)) {\r\n    return value.toString();\r\n  }\r\n  return '';\r\n}\r\n\r\nexport function toIntegerOrUndefined(value: string): number | undefined {\r\n  if (!value) {\r\n    return undefined;\r\n  }\r\n  const v = parseInt(value, 10);\r\n  return isNaN(v) ? undefined : v;\r\n}\r\n\r\nexport function toFloatOrUndefined(value: string): number | undefined {\r\n  if (!value) {\r\n    return undefined;\r\n  }\r\n  const v = parseFloat(value);\r\n  return isNaN(v) ? undefined : v;\r\n}\r\n","export interface TextMatch {\r\n  text: string;\r\n  start: number;\r\n  length: number;\r\n  end: number;\r\n}\r\n\r\n/**\r\n * Adapt findMatchesInText for react-highlight-words findChunks handler.\r\n * See https://github.com/bvaughn/react-highlight-words#props\r\n */\r\nexport function findHighlightChunksInText({\r\n  searchWords,\r\n  textToHighlight,\r\n}: {\r\n  searchWords: string[];\r\n  textToHighlight: string;\r\n}) {\r\n  return searchWords.reduce((acc: any, term: string) => [...acc, ...findMatchesInText(textToHighlight, term)], []);\r\n}\r\n\r\nconst cleanNeedle = (needle: string): string => {\r\n  return needle.replace(/[[{(][\\w,.-?:*+]+$/, '');\r\n};\r\n\r\n/**\r\n * Returns a list of substring regexp matches.\r\n */\r\nexport function findMatchesInText(haystack: string, needle: string): TextMatch[] {\r\n  // Empty search can send re.exec() into infinite loop, exit early\r\n  if (!haystack || !needle) {\r\n    return [];\r\n  }\r\n  const matches: TextMatch[] = [];\r\n  const { cleaned, flags } = parseFlags(cleanNeedle(needle));\r\n  let regexp: RegExp;\r\n  try {\r\n    regexp = new RegExp(`(?:${cleaned})`, flags);\r\n  } catch (error) {\r\n    return matches;\r\n  }\r\n  haystack.replace(regexp, (substring, ...rest) => {\r\n    if (substring) {\r\n      const offset = rest[rest.length - 2];\r\n      matches.push({\r\n        text: substring,\r\n        start: offset,\r\n        length: substring.length,\r\n        end: offset + substring.length,\r\n      });\r\n    }\r\n    return '';\r\n  });\r\n  return matches;\r\n}\r\n\r\nconst CLEAR_FLAG = '-';\r\nconst FLAGS_REGEXP = /\\(\\?([ims-]+)\\)/g;\r\n\r\n/**\r\n * Converts any mode modifers in the text to the Javascript equivalent flag\r\n */\r\nexport function parseFlags(text: string): { cleaned: string; flags: string } {\r\n  const flags: Set<string> = new Set(['g']);\r\n\r\n  const cleaned = text.replace(FLAGS_REGEXP, (str, group) => {\r\n    const clearAll = group.startsWith(CLEAR_FLAG);\r\n\r\n    for (let i = 0; i < group.length; ++i) {\r\n      const flag = group.charAt(i);\r\n      if (clearAll || group.charAt(i - 1) === CLEAR_FLAG) {\r\n        flags.delete(flag);\r\n      } else if (flag !== CLEAR_FLAG) {\r\n        flags.add(flag);\r\n      }\r\n    }\r\n    return ''; // Remove flag from text\r\n  });\r\n\r\n  return {\r\n    cleaned: cleaned,\r\n    flags: Array.from(flags).join(''),\r\n  };\r\n}\r\n","// Libraries\r\nimport isNumber from 'lodash/isNumber';\r\n\r\nimport { NullValueMode, Field } from '../types/index';\r\nimport { Registry, RegistryItem } from '../utils/Registry';\r\n\r\nexport enum ReducerID {\r\n  sum = 'sum',\r\n  max = 'max',\r\n  min = 'min',\r\n  logmin = 'logmin',\r\n  mean = 'mean',\r\n  last = 'last',\r\n  first = 'first',\r\n  count = 'count',\r\n  range = 'range',\r\n  diff = 'diff',\r\n  delta = 'delta',\r\n  step = 'step',\r\n\r\n  firstNotNull = 'firstNotNull',\r\n  lastNotNull = 'lastNotNull',\r\n\r\n  changeCount = 'changeCount',\r\n  distinctCount = 'distinctCount',\r\n\r\n  allIsZero = 'allIsZero',\r\n  allIsNull = 'allIsNull',\r\n}\r\n\r\nexport interface FieldCalcs {\r\n  [key: string]: any;\r\n}\r\n\r\n// Internal function\r\ntype FieldReducer = (field: Field, ignoreNulls: boolean, nullAsZero: boolean) => FieldCalcs;\r\n\r\nexport interface FieldReducerInfo extends RegistryItem {\r\n  // Internal details\r\n  emptyInputResult?: any; // typically null, but some things like 'count' & 'sum' should be zero\r\n  standard: boolean; // The most common stats can all be calculated in a single pass\r\n  reduce?: FieldReducer;\r\n}\r\n\r\ninterface ReduceFieldOptions {\r\n  field: Field;\r\n  reducers: string[]; // The stats to calculate\r\n}\r\n\r\n/**\r\n * @returns an object with a key for each selected stat\r\n */\r\nexport function reduceField(options: ReduceFieldOptions): FieldCalcs {\r\n  const { field, reducers } = options;\r\n\r\n  if (!field || !reducers || reducers.length < 1) {\r\n    return {};\r\n  }\r\n\r\n  if (field.calcs) {\r\n    // Find the values we need to calculate\r\n    const missing: string[] = [];\r\n    for (const s of reducers) {\r\n      if (!field.calcs.hasOwnProperty(s)) {\r\n        missing.push(s);\r\n      }\r\n    }\r\n    if (missing.length < 1) {\r\n      return {\r\n        ...field.calcs,\r\n      };\r\n    }\r\n  }\r\n\r\n  const queue = fieldReducers.list(reducers);\r\n\r\n  // Return early for empty series\r\n  // This lets the concrete implementations assume at least one row\r\n  const data = field.values;\r\n  if (data.length < 1) {\r\n    const calcs = { ...field.calcs } as FieldCalcs;\r\n    for (const reducer of queue) {\r\n      calcs[reducer.id] = reducer.emptyInputResult !== null ? reducer.emptyInputResult : null;\r\n    }\r\n    return (field.calcs = calcs);\r\n  }\r\n\r\n  const { nullValueMode } = field.config;\r\n  const ignoreNulls = nullValueMode === NullValueMode.Ignore;\r\n  const nullAsZero = nullValueMode === NullValueMode.AsZero;\r\n\r\n  // Avoid calculating all the standard stats if possible\r\n  if (queue.length === 1 && queue[0].reduce) {\r\n    const values = queue[0].reduce(field, ignoreNulls, nullAsZero);\r\n    field.calcs = {\r\n      ...field.calcs,\r\n      ...values,\r\n    };\r\n    return values;\r\n  }\r\n\r\n  // For now everything can use the standard stats\r\n  let values = doStandardCalcs(field, ignoreNulls, nullAsZero);\r\n\r\n  for (const reducer of queue) {\r\n    if (!values.hasOwnProperty(reducer.id) && reducer.reduce) {\r\n      values = {\r\n        ...values,\r\n        ...reducer.reduce(field, ignoreNulls, nullAsZero),\r\n      };\r\n    }\r\n  }\r\n\r\n  field.calcs = {\r\n    ...field.calcs,\r\n    ...values,\r\n  };\r\n\r\n  return values;\r\n}\r\n\r\n// ------------------------------------------------------------------------------\r\n//\r\n//  No Exported symbols below here.\r\n//\r\n// ------------------------------------------------------------------------------\r\n\r\nexport const fieldReducers = new Registry<FieldReducerInfo>(() => [\r\n  {\r\n    id: ReducerID.lastNotNull,\r\n    name: 'Last (not null)',\r\n    description: 'Last non-null value',\r\n    standard: true,\r\n    aliasIds: ['current'],\r\n    reduce: calculateLastNotNull,\r\n  },\r\n  {\r\n    id: ReducerID.last,\r\n    name: 'Last',\r\n    description: 'Last Value',\r\n    standard: true,\r\n    reduce: calculateLast,\r\n  },\r\n  { id: ReducerID.first, name: 'First', description: 'First Value', standard: true, reduce: calculateFirst },\r\n  {\r\n    id: ReducerID.firstNotNull,\r\n    name: 'First (not null)',\r\n    description: 'First non-null value',\r\n    standard: true,\r\n    reduce: calculateFirstNotNull,\r\n  },\r\n  { id: ReducerID.min, name: 'Min', description: 'Minimum Value', standard: true },\r\n  { id: ReducerID.max, name: 'Max', description: 'Maximum Value', standard: true },\r\n  { id: ReducerID.mean, name: 'Mean', description: 'Average Value', standard: true, aliasIds: ['avg'] },\r\n  {\r\n    id: ReducerID.sum,\r\n    name: 'Total',\r\n    description: 'The sum of all values',\r\n    emptyInputResult: 0,\r\n    standard: true,\r\n    aliasIds: ['total'],\r\n  },\r\n  {\r\n    id: ReducerID.count,\r\n    name: 'Count',\r\n    description: 'Number of values in response',\r\n    emptyInputResult: 0,\r\n    standard: true,\r\n  },\r\n  {\r\n    id: ReducerID.range,\r\n    name: 'Range',\r\n    description: 'Difference between minimum and maximum values',\r\n    standard: true,\r\n  },\r\n  {\r\n    id: ReducerID.delta,\r\n    name: 'Delta',\r\n    description: 'Cumulative change in value',\r\n    standard: true,\r\n  },\r\n  {\r\n    id: ReducerID.step,\r\n    name: 'Step',\r\n    description: 'Minimum interval between values',\r\n    standard: true,\r\n  },\r\n  {\r\n    id: ReducerID.diff,\r\n    name: 'Difference',\r\n    description: 'Difference between first and last values',\r\n    standard: true,\r\n  },\r\n  {\r\n    id: ReducerID.logmin,\r\n    name: 'Min (above zero)',\r\n    description: 'Used for log min scale',\r\n    standard: true,\r\n  },\r\n  {\r\n    id: ReducerID.allIsZero,\r\n    name: 'All Zeros',\r\n    description: 'All values are zero',\r\n    emptyInputResult: false,\r\n    standard: true,\r\n  },\r\n  {\r\n    id: ReducerID.allIsNull,\r\n    name: 'All Nulls',\r\n    description: 'All values are null',\r\n    emptyInputResult: true,\r\n    standard: true,\r\n  },\r\n  {\r\n    id: ReducerID.changeCount,\r\n    name: 'Change Count',\r\n    description: 'Number of times the value changes',\r\n    standard: false,\r\n    reduce: calculateChangeCount,\r\n  },\r\n  {\r\n    id: ReducerID.distinctCount,\r\n    name: 'Distinct Count',\r\n    description: 'Number of distinct values',\r\n    standard: false,\r\n    reduce: calculateDistinctCount,\r\n  },\r\n]);\r\n\r\nfunction doStandardCalcs(field: Field, ignoreNulls: boolean, nullAsZero: boolean): FieldCalcs {\r\n  const calcs = {\r\n    sum: 0,\r\n    max: -Number.MAX_VALUE,\r\n    min: Number.MAX_VALUE,\r\n    logmin: Number.MAX_VALUE,\r\n    mean: null,\r\n    last: null,\r\n    first: null,\r\n    lastNotNull: null,\r\n    firstNotNull: null,\r\n    count: 0,\r\n    nonNullCount: 0,\r\n    allIsNull: true,\r\n    allIsZero: true,\r\n    range: null,\r\n    diff: null,\r\n    delta: 0,\r\n    step: Number.MAX_VALUE,\r\n\r\n    // Just used for calcutations -- not exposed as a stat\r\n    previousDeltaUp: true,\r\n  } as FieldCalcs;\r\n\r\n  const data = field.values;\r\n  calcs.count = data.length;\r\n\r\n  for (let i = 0; i < data.length; i++) {\r\n    let currentValue = data.get(i);\r\n\r\n    if (i === 0) {\r\n      calcs.first = currentValue;\r\n    }\r\n\r\n    calcs.last = currentValue;\r\n\r\n    if (currentValue === null) {\r\n      if (ignoreNulls) {\r\n        continue;\r\n      }\r\n      if (nullAsZero) {\r\n        currentValue = 0;\r\n      }\r\n    }\r\n\r\n    if (currentValue !== null && currentValue !== undefined) {\r\n      const isFirst = calcs.firstNotNull === null;\r\n      if (isFirst) {\r\n        calcs.firstNotNull = currentValue;\r\n      }\r\n\r\n      if (isNumber(currentValue)) {\r\n        calcs.sum += currentValue;\r\n        calcs.allIsNull = false;\r\n        calcs.nonNullCount++;\r\n\r\n        if (!isFirst) {\r\n          const step = currentValue - calcs.lastNotNull!;\r\n          if (calcs.step > step) {\r\n            calcs.step = step; // the minimum interval\r\n          }\r\n\r\n          if (calcs.lastNotNull! > currentValue) {\r\n            // counter reset\r\n            calcs.previousDeltaUp = false;\r\n            if (i === data.length - 1) {\r\n              // reset on last\r\n              calcs.delta += currentValue;\r\n            }\r\n          } else {\r\n            if (calcs.previousDeltaUp) {\r\n              calcs.delta += step; // normal increment\r\n            } else {\r\n              calcs.delta += currentValue; // account for counter reset\r\n            }\r\n            calcs.previousDeltaUp = true;\r\n          }\r\n        }\r\n\r\n        if (currentValue > calcs.max) {\r\n          calcs.max = currentValue;\r\n        }\r\n\r\n        if (currentValue < calcs.min) {\r\n          calcs.min = currentValue;\r\n        }\r\n\r\n        if (currentValue < calcs.logmin && currentValue > 0) {\r\n          calcs.logmin = currentValue;\r\n        }\r\n      }\r\n\r\n      if (currentValue !== 0) {\r\n        calcs.allIsZero = false;\r\n      }\r\n\r\n      calcs.lastNotNull = currentValue;\r\n    }\r\n  }\r\n\r\n  if (calcs.max === -Number.MAX_VALUE) {\r\n    calcs.max = null;\r\n  }\r\n\r\n  if (calcs.min === Number.MAX_VALUE) {\r\n    calcs.min = null;\r\n  }\r\n\r\n  if (calcs.step === Number.MAX_VALUE) {\r\n    calcs.step = null;\r\n  }\r\n\r\n  if (calcs.nonNullCount > 0) {\r\n    calcs.mean = calcs.sum! / calcs.nonNullCount;\r\n  }\r\n\r\n  if (calcs.allIsNull) {\r\n    calcs.allIsZero = false;\r\n  }\r\n\r\n  if (calcs.max !== null && calcs.min !== null) {\r\n    calcs.range = calcs.max - calcs.min;\r\n  }\r\n\r\n  if (isNumber(calcs.firstNotNull) && isNumber(calcs.lastNotNull)) {\r\n    calcs.diff = calcs.lastNotNull - calcs.firstNotNull;\r\n  }\r\n\r\n  return calcs;\r\n}\r\n\r\nfunction calculateFirst(field: Field, ignoreNulls: boolean, nullAsZero: boolean): FieldCalcs {\r\n  return { first: field.values.get(0) };\r\n}\r\n\r\nfunction calculateFirstNotNull(field: Field, ignoreNulls: boolean, nullAsZero: boolean): FieldCalcs {\r\n  const data = field.values;\r\n  for (let idx = 0; idx < data.length; idx++) {\r\n    const v = data.get(idx);\r\n    if (v != null && v !== undefined) {\r\n      return { firstNotNull: v };\r\n    }\r\n  }\r\n  return { firstNotNull: null };\r\n}\r\n\r\nfunction calculateLast(field: Field, ignoreNulls: boolean, nullAsZero: boolean): FieldCalcs {\r\n  const data = field.values;\r\n  return { last: data.get(data.length - 1) };\r\n}\r\n\r\nfunction calculateLastNotNull(field: Field, ignoreNulls: boolean, nullAsZero: boolean): FieldCalcs {\r\n  const data = field.values;\r\n  let idx = data.length - 1;\r\n  while (idx >= 0) {\r\n    const v = data.get(idx--);\r\n    if (v != null && v !== undefined) {\r\n      return { lastNotNull: v };\r\n    }\r\n  }\r\n  return { lastNotNull: null };\r\n}\r\n\r\nfunction calculateChangeCount(field: Field, ignoreNulls: boolean, nullAsZero: boolean): FieldCalcs {\r\n  const data = field.values;\r\n  let count = 0;\r\n  let first = true;\r\n  let last: any = null;\r\n  for (let i = 0; i < data.length; i++) {\r\n    let currentValue = data.get(i);\r\n    if (currentValue === null) {\r\n      if (ignoreNulls) {\r\n        continue;\r\n      }\r\n      if (nullAsZero) {\r\n        currentValue = 0;\r\n      }\r\n    }\r\n    if (!first && last !== currentValue) {\r\n      count++;\r\n    }\r\n    first = false;\r\n    last = currentValue;\r\n  }\r\n\r\n  return { changeCount: count };\r\n}\r\n\r\nfunction calculateDistinctCount(field: Field, ignoreNulls: boolean, nullAsZero: boolean): FieldCalcs {\r\n  const data = field.values;\r\n  const distinct = new Set<any>();\r\n  for (let i = 0; i < data.length; i++) {\r\n    let currentValue = data.get(i);\r\n    if (currentValue === null) {\r\n      if (ignoreNulls) {\r\n        continue;\r\n      }\r\n      if (nullAsZero) {\r\n        currentValue = 0;\r\n      }\r\n    }\r\n    distinct.add(currentValue);\r\n  }\r\n  return { distinctCount: distinct.size };\r\n}\r\n","export * from './matchers/ids';\r\nexport * from './transformers/ids';\r\nexport * from './matchers';\r\nexport * from './transformers';\r\nexport * from './fieldReducer';\r\nexport { FilterFieldsByNameTransformerOptions } from './transformers/filterByName';\r\nexport { FilterFramesByRefIdTransformerOptions } from './transformers/filterByRefId';\r\nexport { ReduceTransformerOptions } from './transformers/reduce';\r\n","// Load the Buildtin matchers\r\nimport { getFieldPredicateMatchers, getFramePredicateMatchers } from './matchers/predicates';\r\nimport { getFieldNameMatchers, getFrameNameMatchers } from './matchers/nameMatcher';\r\nimport { getFieldTypeMatchers } from './matchers/fieldTypeMatcher';\r\nimport { getRefIdMatchers } from './matchers/refIdMatcher';\r\nimport {\r\n  FieldMatcherInfo,\r\n  MatcherConfig,\r\n  FrameMatcherInfo,\r\n  FieldMatcher,\r\n  FrameMatcher,\r\n} from '../types/transformations';\r\nimport { Registry } from '../utils/Registry';\r\n\r\nexport const fieldMatchers = new Registry<FieldMatcherInfo>(() => {\r\n  return [\r\n    ...getFieldPredicateMatchers(), // Predicates\r\n    ...getFieldTypeMatchers(), // by type\r\n    ...getFieldNameMatchers(), // by name\r\n  ];\r\n});\r\n\r\nexport const frameMatchers = new Registry<FrameMatcherInfo>(() => {\r\n  return [\r\n    ...getFramePredicateMatchers(), // Predicates\r\n    ...getFrameNameMatchers(), // by name\r\n    ...getRefIdMatchers(), // by query refId\r\n  ];\r\n});\r\n\r\nexport function getFieldMatcher(config: MatcherConfig): FieldMatcher {\r\n  const info = fieldMatchers.get(config.id);\r\n  if (!info) {\r\n    throw new Error('Unknown Matcher: ' + config.id);\r\n  }\r\n  return info.get(config.options);\r\n}\r\n\r\nexport function getFrameMatchers(config: MatcherConfig): FrameMatcher {\r\n  const info = frameMatchers.get(config.id);\r\n  if (!info) {\r\n    throw new Error('Unknown Matcher: ' + config.id);\r\n  }\r\n  return info.get(config.options);\r\n}\r\n","import { Field, FieldType } from '../../types/dataFrame';\r\nimport { FieldMatcherID } from './ids';\r\nimport { FieldMatcherInfo } from '../../types/transformations';\r\n\r\n// General Field matcher\r\nconst fieldTypeMacher: FieldMatcherInfo<FieldType> = {\r\n  id: FieldMatcherID.byType,\r\n  name: 'Field Type',\r\n  description: 'match based on the field type',\r\n  defaultOptions: FieldType.number,\r\n\r\n  get: (type: FieldType) => {\r\n    return (field: Field) => {\r\n      return type === field.type;\r\n    };\r\n  },\r\n\r\n  getOptionsDisplayText: (type: FieldType) => {\r\n    return `Field type: ${type}`;\r\n  },\r\n};\r\n\r\n// Numeric Field matcher\r\n// This gets its own entry so it shows up in the dropdown\r\nconst numericMacher: FieldMatcherInfo = {\r\n  id: FieldMatcherID.numeric,\r\n  name: 'Numeric Fields',\r\n  description: 'Fields with type number',\r\n\r\n  get: () => {\r\n    return fieldTypeMacher.get(FieldType.number);\r\n  },\r\n\r\n  getOptionsDisplayText: () => {\r\n    return 'Numeric Fields';\r\n  },\r\n};\r\n\r\n// Time Field matcher\r\nconst timeMacher: FieldMatcherInfo = {\r\n  id: FieldMatcherID.time,\r\n  name: 'Time Fields',\r\n  description: 'Fields with type time',\r\n\r\n  get: () => {\r\n    return fieldTypeMacher.get(FieldType.time);\r\n  },\r\n\r\n  getOptionsDisplayText: () => {\r\n    return 'Time Fields';\r\n  },\r\n};\r\n\r\n/**\r\n * Registry Initalization\r\n */\r\nexport function getFieldTypeMatchers(): FieldMatcherInfo[] {\r\n  return [fieldTypeMacher, numericMacher, timeMacher];\r\n}\r\n","// This needs to be in its own file to avoid circular references\r\n\r\n// Builtin Predicates\r\n// not using 'any' and 'never' since they are reservered keywords\r\nexport enum MatcherID {\r\n  anyMatch = 'anyMatch', // checks children\r\n  allMatch = 'allMatch', // checks children\r\n  invertMatch = 'invertMatch', // checks child\r\n  alwaysMatch = 'alwaysMatch',\r\n  neverMatch = 'neverMatch',\r\n}\r\n\r\nexport enum FieldMatcherID {\r\n  // Specific Types\r\n  numeric = 'numeric',\r\n  time = 'time',\r\n\r\n  // With arguments\r\n  byType = 'byType',\r\n  byName = 'byName',\r\n  // byIndex = 'byIndex',\r\n  // byLabel = 'byLabel',\r\n}\r\n\r\n/**\r\n * Field name matchers\r\n */\r\nexport enum FrameMatcherID {\r\n  byName = 'byName',\r\n  byRefId = 'byRefId',\r\n  byIndex = 'byIndex',\r\n  byLabel = 'byLabel',\r\n}\r\n","import { Field, DataFrame } from '../../types/dataFrame';\r\nimport { FieldMatcherID, FrameMatcherID } from './ids';\r\nimport { FieldMatcherInfo, FrameMatcherInfo } from '../../types/transformations';\r\nimport { stringToJsRegex } from '../../text/string';\r\n\r\n// General Field matcher\r\nconst fieldNameMacher: FieldMatcherInfo<string> = {\r\n  id: FieldMatcherID.byName,\r\n  name: 'Field Name',\r\n  description: 'match the field name',\r\n  defaultOptions: '/.*/',\r\n\r\n  get: (pattern: string) => {\r\n    const regex = stringToJsRegex(pattern);\r\n    return (field: Field) => {\r\n      return regex.test(field.name);\r\n    };\r\n  },\r\n\r\n  getOptionsDisplayText: (pattern: string) => {\r\n    return `Field name: ${pattern}`;\r\n  },\r\n};\r\n\r\n// General Field matcher\r\nconst frameNameMacher: FrameMatcherInfo<string> = {\r\n  id: FrameMatcherID.byName,\r\n  name: 'Frame Name',\r\n  description: 'match the frame name',\r\n  defaultOptions: '/.*/',\r\n\r\n  get: (pattern: string) => {\r\n    const regex = stringToJsRegex(pattern);\r\n    return (frame: DataFrame) => {\r\n      return regex.test(frame.name || '');\r\n    };\r\n  },\r\n\r\n  getOptionsDisplayText: (pattern: string) => {\r\n    return `Frame name: ${pattern}`;\r\n  },\r\n};\r\n\r\n/**\r\n * Registry Initalization\r\n */\r\nexport function getFieldNameMatchers(): FieldMatcherInfo[] {\r\n  return [fieldNameMacher];\r\n}\r\n\r\nexport function getFrameNameMatchers(): FrameMatcherInfo[] {\r\n  return [frameNameMacher];\r\n}\r\n","import { Field, DataFrame } from '../../types/dataFrame';\r\nimport { MatcherID } from './ids';\r\nimport { getFieldMatcher, fieldMatchers, getFrameMatchers, frameMatchers } from '../matchers';\r\nimport { FieldMatcherInfo, MatcherConfig, FrameMatcherInfo } from '../../types/transformations';\r\n\r\nconst anyFieldMatcher: FieldMatcherInfo<MatcherConfig[]> = {\r\n  id: MatcherID.anyMatch,\r\n  name: 'Any',\r\n  description: 'Any child matches (OR)',\r\n  excludeFromPicker: true,\r\n  defaultOptions: [], // empty array\r\n\r\n  get: (options: MatcherConfig[]) => {\r\n    const children = options.map(option => {\r\n      return getFieldMatcher(option);\r\n    });\r\n    return (field: Field) => {\r\n      for (const child of children) {\r\n        if (child(field)) {\r\n          return true;\r\n        }\r\n      }\r\n      return false;\r\n    };\r\n  },\r\n\r\n  getOptionsDisplayText: (options: MatcherConfig[]) => {\r\n    let text = '';\r\n    for (const sub of options) {\r\n      if (text.length > 0) {\r\n        text += ' OR ';\r\n      }\r\n      const matcher = fieldMatchers.get(sub.id);\r\n      text += matcher.getOptionsDisplayText ? matcher.getOptionsDisplayText(sub) : matcher.name;\r\n    }\r\n    return text;\r\n  },\r\n};\r\n\r\nconst anyFrameMatcher: FrameMatcherInfo<MatcherConfig[]> = {\r\n  id: MatcherID.anyMatch,\r\n  name: 'Any',\r\n  description: 'Any child matches (OR)',\r\n  excludeFromPicker: true,\r\n  defaultOptions: [], // empty array\r\n\r\n  get: (options: MatcherConfig[]) => {\r\n    const children = options.map(option => {\r\n      return getFrameMatchers(option);\r\n    });\r\n    return (frame: DataFrame) => {\r\n      for (const child of children) {\r\n        if (child(frame)) {\r\n          return true;\r\n        }\r\n      }\r\n      return false;\r\n    };\r\n  },\r\n\r\n  getOptionsDisplayText: (options: MatcherConfig[]) => {\r\n    let text = '';\r\n    for (const sub of options) {\r\n      if (text.length > 0) {\r\n        text += ' OR ';\r\n      }\r\n      const matcher = frameMatchers.get(sub.id);\r\n      text += matcher.getOptionsDisplayText ? matcher.getOptionsDisplayText(sub) : matcher.name;\r\n    }\r\n    return text;\r\n  },\r\n};\r\n\r\nconst allFieldsMatcher: FieldMatcherInfo<MatcherConfig[]> = {\r\n  id: MatcherID.allMatch,\r\n  name: 'All',\r\n  description: 'Everything matches (AND)',\r\n  excludeFromPicker: true,\r\n  defaultOptions: [], // empty array\r\n\r\n  get: (options: MatcherConfig[]) => {\r\n    const children = options.map(option => {\r\n      return getFieldMatcher(option);\r\n    });\r\n    return (field: Field) => {\r\n      for (const child of children) {\r\n        if (!child(field)) {\r\n          return false;\r\n        }\r\n      }\r\n      return true;\r\n    };\r\n  },\r\n\r\n  getOptionsDisplayText: (options: MatcherConfig[]) => {\r\n    let text = '';\r\n    for (const sub of options) {\r\n      if (text.length > 0) {\r\n        text += ' AND ';\r\n      }\r\n      const matcher = fieldMatchers.get(sub.id); // Ugho what about frame\r\n      text += matcher.getOptionsDisplayText ? matcher.getOptionsDisplayText(sub) : matcher.name;\r\n    }\r\n    return text;\r\n  },\r\n};\r\n\r\nconst allFramesMatcher: FrameMatcherInfo<MatcherConfig[]> = {\r\n  id: MatcherID.allMatch,\r\n  name: 'All',\r\n  description: 'Everything matches (AND)',\r\n  excludeFromPicker: true,\r\n  defaultOptions: [], // empty array\r\n\r\n  get: (options: MatcherConfig[]) => {\r\n    const children = options.map(option => {\r\n      return getFrameMatchers(option);\r\n    });\r\n    return (frame: DataFrame) => {\r\n      for (const child of children) {\r\n        if (!child(frame)) {\r\n          return false;\r\n        }\r\n      }\r\n      return true;\r\n    };\r\n  },\r\n\r\n  getOptionsDisplayText: (options: MatcherConfig[]) => {\r\n    let text = '';\r\n    for (const sub of options) {\r\n      if (text.length > 0) {\r\n        text += ' AND ';\r\n      }\r\n      const matcher = frameMatchers.get(sub.id);\r\n      text += matcher.getOptionsDisplayText ? matcher.getOptionsDisplayText(sub) : matcher.name;\r\n    }\r\n    return text;\r\n  },\r\n};\r\n\r\nconst notFieldMatcher: FieldMatcherInfo<MatcherConfig> = {\r\n  id: MatcherID.invertMatch,\r\n  name: 'NOT',\r\n  description: 'Inverts other matchers',\r\n  excludeFromPicker: true,\r\n\r\n  get: (option: MatcherConfig) => {\r\n    const check = getFieldMatcher(option);\r\n    return (field: Field) => {\r\n      return !check(field);\r\n    };\r\n  },\r\n\r\n  getOptionsDisplayText: (options: MatcherConfig) => {\r\n    const matcher = fieldMatchers.get(options.id);\r\n    const text = matcher.getOptionsDisplayText ? matcher.getOptionsDisplayText(options.options) : matcher.name;\r\n    return 'NOT ' + text;\r\n  },\r\n};\r\n\r\nconst notFrameMatcher: FrameMatcherInfo<MatcherConfig> = {\r\n  id: MatcherID.invertMatch,\r\n  name: 'NOT',\r\n  description: 'Inverts other matchers',\r\n  excludeFromPicker: true,\r\n\r\n  get: (option: MatcherConfig) => {\r\n    const check = getFrameMatchers(option);\r\n    return (frame: DataFrame) => {\r\n      return !check(frame);\r\n    };\r\n  },\r\n\r\n  getOptionsDisplayText: (options: MatcherConfig) => {\r\n    const matcher = frameMatchers.get(options.id);\r\n    const text = matcher.getOptionsDisplayText ? matcher.getOptionsDisplayText(options.options) : matcher.name;\r\n    return 'NOT ' + text;\r\n  },\r\n};\r\n\r\nexport const alwaysFieldMatcher = (field: Field) => {\r\n  return true;\r\n};\r\n\r\nexport const alwaysFrameMatcher = (frame: DataFrame) => {\r\n  return true;\r\n};\r\n\r\nexport const neverFieldMatcher = (field: Field) => {\r\n  return false;\r\n};\r\n\r\nexport const neverFrameMatcher = (frame: DataFrame) => {\r\n  return false;\r\n};\r\n\r\nconst alwaysFieldMatcherInfo: FieldMatcherInfo = {\r\n  id: MatcherID.alwaysMatch,\r\n  name: 'All Fields',\r\n  description: 'Always Match',\r\n\r\n  get: (option: any) => {\r\n    return alwaysFieldMatcher;\r\n  },\r\n\r\n  getOptionsDisplayText: (options: any) => {\r\n    return 'Always';\r\n  },\r\n};\r\n\r\nconst alwaysFrameMatcherInfo: FrameMatcherInfo = {\r\n  id: MatcherID.alwaysMatch,\r\n  name: 'All Frames',\r\n  description: 'Always Match',\r\n\r\n  get: (option: any) => {\r\n    return alwaysFrameMatcher;\r\n  },\r\n\r\n  getOptionsDisplayText: (options: any) => {\r\n    return 'Always';\r\n  },\r\n};\r\n\r\nconst neverFieldMatcherInfo: FieldMatcherInfo = {\r\n  id: MatcherID.neverMatch,\r\n  name: 'No Fields',\r\n  description: 'Never Match',\r\n  excludeFromPicker: true,\r\n\r\n  get: (option: any) => {\r\n    return neverFieldMatcher;\r\n  },\r\n\r\n  getOptionsDisplayText: (options: any) => {\r\n    return 'Never';\r\n  },\r\n};\r\n\r\nconst neverFrameMatcherInfo: FrameMatcherInfo = {\r\n  id: MatcherID.neverMatch,\r\n  name: 'No Frames',\r\n  description: 'Never Match',\r\n\r\n  get: (option: any) => {\r\n    return neverFrameMatcher;\r\n  },\r\n\r\n  getOptionsDisplayText: (options: any) => {\r\n    return 'Never';\r\n  },\r\n};\r\n\r\nexport function getFieldPredicateMatchers(): FieldMatcherInfo[] {\r\n  return [anyFieldMatcher, allFieldsMatcher, notFieldMatcher, alwaysFieldMatcherInfo, neverFieldMatcherInfo];\r\n}\r\n\r\nexport function getFramePredicateMatchers(): FrameMatcherInfo[] {\r\n  return [anyFrameMatcher, allFramesMatcher, notFrameMatcher, alwaysFrameMatcherInfo, neverFrameMatcherInfo];\r\n}\r\n","import { DataFrame } from '../../types/dataFrame';\nimport { FrameMatcherID } from './ids';\nimport { FrameMatcherInfo } from '../../types/transformations';\nimport { stringToJsRegex } from '../../text';\n\n// General Field matcher\nconst refIdMacher: FrameMatcherInfo<string> = {\n  id: FrameMatcherID.byRefId,\n  name: 'Query refId',\n  description: 'match the refId',\n  defaultOptions: 'A',\n\n  get: (pattern: string) => {\n    const regex = stringToJsRegex(pattern);\n    return (frame: DataFrame) => {\n      return regex.test(frame.refId || '');\n    };\n  },\n\n  getOptionsDisplayText: (pattern: string) => {\n    return `RefID: ${pattern}`;\n  },\n};\n\nexport function getRefIdMatchers(): FrameMatcherInfo[] {\n  return [refIdMacher];\n}\n","import { DataFrame } from '../types/dataFrame';\r\nimport { Registry } from '../utils/Registry';\r\n// Initalize the Registry\r\n\r\nimport { appendTransformer, AppendOptions } from './transformers/append';\r\nimport { reduceTransformer, ReduceTransformerOptions } from './transformers/reduce';\r\nimport { filterFieldsTransformer, filterFramesTransformer } from './transformers/filter';\r\nimport { filterFieldsByNameTransformer, FilterFieldsByNameTransformerOptions } from './transformers/filterByName';\r\nimport { noopTransformer } from './transformers/noop';\r\nimport { DataTransformerInfo, DataTransformerConfig } from '../types/transformations';\r\nimport { filterFramesByRefIdTransformer } from './transformers/filterByRefId';\r\n\r\n/**\r\n * Apply configured transformations to the input data\r\n */\r\nexport function transformDataFrame(options: DataTransformerConfig[], data: DataFrame[]): DataFrame[] {\r\n  let processed = data;\r\n  for (const config of options) {\r\n    const info = transformersRegistry.get(config.id);\r\n    const transformer = info.transformer(config.options);\r\n    const after = transformer(processed);\r\n\r\n    // Add a key to the metadata if the data changed\r\n    if (after && after !== processed) {\r\n      for (const series of after) {\r\n        if (!series.meta) {\r\n          series.meta = {};\r\n        }\r\n        if (!series.meta.transformations) {\r\n          series.meta.transformations = [info.id];\r\n        } else {\r\n          series.meta.transformations = [...series.meta.transformations, info.id];\r\n        }\r\n      }\r\n      processed = after;\r\n    }\r\n  }\r\n  return processed;\r\n}\r\n\r\n/**\r\n * Registry of transformation options that can be driven by\r\n * stored configuration files.\r\n */\r\nclass TransformerRegistry extends Registry<DataTransformerInfo> {\r\n  // ------------------------------------------------------------\r\n  // Nacent options for more functional programming\r\n  // The API to these functions should change to match the actual\r\n  // needs of people trying to use it.\r\n  //  filterFields|Frames is left off since it is likely easier to\r\n  //  support with `frames.filter( f => {...} )`\r\n  // ------------------------------------------------------------\r\n\r\n  append(data: DataFrame[], options?: AppendOptions): DataFrame | undefined {\r\n    return appendTransformer.transformer(options || appendTransformer.defaultOptions)(data)[0];\r\n  }\r\n\r\n  reduce(data: DataFrame[], options: ReduceTransformerOptions): DataFrame[] {\r\n    return reduceTransformer.transformer(options)(data);\r\n  }\r\n}\r\n\r\nexport const transformersRegistry = new TransformerRegistry(() => [\r\n  noopTransformer,\r\n  filterFieldsTransformer,\r\n  filterFieldsByNameTransformer,\r\n  filterFramesTransformer,\r\n  filterFramesByRefIdTransformer,\r\n  appendTransformer,\r\n  reduceTransformer,\r\n]);\r\n\r\nexport { ReduceTransformerOptions, FilterFieldsByNameTransformerOptions };\r\n","import { DataFrame } from '../../types/dataFrame';\r\nimport { DataTransformerID } from './ids';\r\nimport { MutableDataFrame } from '../../dataframe/MutableDataFrame';\r\nimport { DataTransformerInfo } from '../../types/transformations';\r\n\r\nexport interface AppendOptions {}\r\n\r\nexport const appendTransformer: DataTransformerInfo<AppendOptions> = {\r\n  id: DataTransformerID.append,\r\n  name: 'Append',\r\n  description: 'Append values into a single DataFrame.  This uses the name as the key',\r\n  defaultOptions: {},\r\n\r\n  /**\r\n   * Return a modified copy of the series.  If the transform is not or should not\r\n   * be applied, just return the input series\r\n   */\r\n  transformer: (options: AppendOptions) => {\r\n    return (data: DataFrame[]) => {\r\n      if (data.length < 2) {\r\n        return data;\r\n      }\r\n\r\n      // Add the first row\r\n      const processed = new MutableDataFrame();\r\n      for (const f of data[0].fields) {\r\n        processed.addField({\r\n          ...f,\r\n          values: [...f.values.toArray()],\r\n        });\r\n      }\r\n\r\n      for (let i = 1; i < data.length; i++) {\r\n        const frame = data[i];\r\n        const startLength = frame.length;\r\n        for (let j = 0; j < frame.fields.length; j++) {\r\n          const src = frame.fields[j];\r\n          let vals = processed.values[src.name];\r\n          if (!vals) {\r\n            vals = processed.addField(\r\n              {\r\n                ...src,\r\n                values: [],\r\n              },\r\n              startLength\r\n            ).values;\r\n          }\r\n\r\n          // Add each row\r\n          for (let k = 0; k < frame.length; k++) {\r\n            vals.add(src.values.get(k));\r\n          }\r\n        }\r\n        processed.validate();\r\n      }\r\n      return [processed];\r\n    };\r\n  },\r\n};\r\n","import { noopTransformer } from './noop';\r\nimport { DataFrame, Field } from '../../types/dataFrame';\r\nimport { DataTransformerID } from './ids';\r\nimport { DataTransformerInfo, MatcherConfig } from '../../types/transformations';\r\nimport { FieldMatcherID } from '../matchers/ids';\r\nimport { getFieldMatcher, getFrameMatchers } from '../matchers';\r\n\r\nexport interface FilterOptions {\r\n  include?: MatcherConfig;\r\n  exclude?: MatcherConfig;\r\n}\r\n\r\nexport const filterFieldsTransformer: DataTransformerInfo<FilterOptions> = {\r\n  id: DataTransformerID.filterFields,\r\n  name: 'Filter Fields',\r\n  description: 'select a subset of fields',\r\n  defaultOptions: {\r\n    include: { id: FieldMatcherID.numeric },\r\n  },\r\n\r\n  /**\r\n   * Return a modified copy of the series.  If the transform is not or should not\r\n   * be applied, just return the input series\r\n   */\r\n  transformer: (options: FilterOptions) => {\r\n    if (!options.include && !options.exclude) {\r\n      return noopTransformer.transformer({});\r\n    }\r\n\r\n    const include = options.include ? getFieldMatcher(options.include) : null;\r\n    const exclude = options.exclude ? getFieldMatcher(options.exclude) : null;\r\n\r\n    return (data: DataFrame[]) => {\r\n      const processed: DataFrame[] = [];\r\n      for (const series of data) {\r\n        // Find the matching field indexes\r\n        const fields: Field[] = [];\r\n        for (let i = 0; i < series.fields.length; i++) {\r\n          const field = series.fields[i];\r\n          if (exclude) {\r\n            if (exclude(field)) {\r\n              continue;\r\n            }\r\n            if (!include) {\r\n              fields.push(field);\r\n            }\r\n          }\r\n          if (include && include(field)) {\r\n            fields.push(field);\r\n          }\r\n        }\r\n\r\n        if (!fields.length) {\r\n          continue;\r\n        }\r\n        const copy = {\r\n          ...series, // all the other properties\r\n          fields, // but a different set of fields\r\n        };\r\n        processed.push(copy);\r\n      }\r\n      return processed;\r\n    };\r\n  },\r\n};\r\n\r\nexport const filterFramesTransformer: DataTransformerInfo<FilterOptions> = {\r\n  id: DataTransformerID.filterFrames,\r\n  name: 'Filter Frames',\r\n  description: 'select a subset of frames',\r\n  defaultOptions: {},\r\n\r\n  /**\r\n   * Return a modified copy of the series.  If the transform is not or should not\r\n   * be applied, just return the input series\r\n   */\r\n  transformer: (options: FilterOptions) => {\r\n    if (!options.include && !options.exclude) {\r\n      return noopTransformer.transformer({});\r\n    }\r\n\r\n    const include = options.include ? getFrameMatchers(options.include) : null;\r\n    const exclude = options.exclude ? getFrameMatchers(options.exclude) : null;\r\n\r\n    return (data: DataFrame[]) => {\r\n      const processed: DataFrame[] = [];\r\n      for (const series of data) {\r\n        if (exclude) {\r\n          if (exclude(series)) {\r\n            continue;\r\n          }\r\n          if (!include) {\r\n            processed.push(series);\r\n          }\r\n        }\r\n        if (include && include(series)) {\r\n          processed.push(series);\r\n        }\r\n      }\r\n      return processed;\r\n    };\r\n  },\r\n};\r\n","import { DataTransformerID } from './ids';\r\nimport { filterFieldsTransformer, FilterOptions } from './filter';\r\nimport { DataTransformerInfo } from '../../types/transformations';\r\nimport { FieldMatcherID } from '../matchers/ids';\r\n\r\nexport interface FilterFieldsByNameTransformerOptions {\r\n  include?: string;\r\n  exclude?: string;\r\n}\r\n\r\nexport const filterFieldsByNameTransformer: DataTransformerInfo<FilterFieldsByNameTransformerOptions> = {\r\n  id: DataTransformerID.filterFieldsByName,\r\n  name: 'Filter fields by name',\r\n  description: 'select a subset of fields',\r\n  defaultOptions: {},\r\n\r\n  /**\r\n   * Return a modified copy of the series.  If the transform is not or should not\r\n   * be applied, just return the input series\r\n   */\r\n  transformer: (options: FilterFieldsByNameTransformerOptions) => {\r\n    const filterOptions: FilterOptions = {};\r\n    if (options.include) {\r\n      filterOptions.include = {\r\n        id: FieldMatcherID.byName,\r\n        options: options.include,\r\n      };\r\n    }\r\n    if (options.exclude) {\r\n      filterOptions.exclude = {\r\n        id: FieldMatcherID.byName,\r\n        options: options.exclude,\r\n      };\r\n    }\r\n\r\n    return filterFieldsTransformer.transformer(filterOptions);\r\n  },\r\n};\r\n","import { DataTransformerID } from './ids';\r\nimport { FilterOptions, filterFramesTransformer } from './filter';\r\nimport { DataTransformerInfo } from '../../types/transformations';\r\nimport { FrameMatcherID } from '../matchers/ids';\r\n\r\nexport interface FilterFramesByRefIdTransformerOptions {\r\n  include?: string;\r\n  exclude?: string;\r\n}\r\n\r\nexport const filterFramesByRefIdTransformer: DataTransformerInfo<FilterFramesByRefIdTransformerOptions> = {\r\n  id: DataTransformerID.filterByRefId,\r\n  name: 'Filter data by query refId',\r\n  description: 'select a subset of results',\r\n  defaultOptions: {},\r\n\r\n  /**\r\n   * Return a modified copy of the series.  If the transform is not or should not\r\n   * be applied, just return the input series\r\n   */\r\n  transformer: (options: FilterFramesByRefIdTransformerOptions) => {\r\n    const filterOptions: FilterOptions = {};\r\n    if (options.include) {\r\n      filterOptions.include = {\r\n        id: FrameMatcherID.byRefId,\r\n        options: options.include,\r\n      };\r\n    }\r\n    if (options.exclude) {\r\n      filterOptions.exclude = {\r\n        id: FrameMatcherID.byRefId,\r\n        options: options.exclude,\r\n      };\r\n    }\r\n\r\n    return filterFramesTransformer.transformer(filterOptions);\r\n  },\r\n};\r\n","export enum DataTransformerID {\r\n  //  join = 'join', // Pick a field and merge all series based on that field\r\n  append = 'append', // Merge all series together\r\n  //  rotate = 'rotate', // Columns to rows\r\n  reduce = 'reduce', // Run calculations on fields\r\n\r\n  filterFields = 'filterFields', // Pick some fields (keep all frames)\r\n  filterFieldsByName = 'filterFieldsByName', // Pick fields with name matching regex (keep all frames)\r\n  filterFrames = 'filterFrames', // Pick some frames (keep all fields)\r\n  filterByRefId = 'filterByRefId', // Pick some frames by RefId\r\n  noop = 'noop', // Does nothing to the dataframe\r\n}\r\n","import { DataTransformerID } from './ids';\r\nimport { DataFrame } from '../../types/dataFrame';\r\nimport { DataTransformerInfo } from '../../types/transformations';\r\n\r\nexport interface NoopTransformerOptions {\r\n  include?: string;\r\n  exclude?: string;\r\n}\r\n\r\nexport const noopTransformer: DataTransformerInfo<NoopTransformerOptions> = {\r\n  id: DataTransformerID.noop,\r\n  name: 'noop',\r\n  description: 'No-operation transformer',\r\n  defaultOptions: {},\r\n\r\n  /**\r\n   * Return a modified copy of the series.  If the transform is not or should not\r\n   * be applied, just return the input series\r\n   */\r\n  transformer: (options: NoopTransformerOptions) => {\r\n    return (data: DataFrame[]) => data;\r\n  },\r\n};\r\n","import { DataTransformerID } from './ids';\r\nimport { MatcherConfig, DataTransformerInfo } from '../../types/transformations';\r\nimport { ReducerID, fieldReducers, reduceField } from '../fieldReducer';\r\nimport { alwaysFieldMatcher } from '../matchers/predicates';\r\nimport { DataFrame, Field, FieldType } from '../../types/dataFrame';\r\nimport { ArrayVector } from '../../vector/ArrayVector';\r\nimport { KeyValue } from '../../types/data';\r\nimport { guessFieldTypeForField } from '../../dataframe/processDataFrame';\r\nimport { getFieldMatcher } from '../matchers';\r\n\r\nexport interface ReduceTransformerOptions {\r\n  reducers: ReducerID[];\r\n  fields?: MatcherConfig; // Assume all fields\r\n}\r\n\r\nexport const reduceTransformer: DataTransformerInfo<ReduceTransformerOptions> = {\r\n  id: DataTransformerID.reduce,\r\n  name: 'Reducer',\r\n  description: 'Return a DataFrame with the reduction results',\r\n  defaultOptions: {\r\n    reducers: [ReducerID.min, ReducerID.max, ReducerID.mean, ReducerID.last],\r\n  },\r\n\r\n  /**\r\n   * Return a modified copy of the series.  If the transform is not or should not\r\n   * be applied, just return the input series\r\n   */\r\n  transformer: (options: ReduceTransformerOptions) => {\r\n    const matcher = options.fields ? getFieldMatcher(options.fields) : alwaysFieldMatcher;\r\n    const calculators = options.reducers && options.reducers.length ? fieldReducers.list(options.reducers) : [];\r\n    const reducers = calculators.map(c => c.id);\r\n\r\n    return (data: DataFrame[]) => {\r\n      const processed: DataFrame[] = [];\r\n      for (const series of data) {\r\n        const values: ArrayVector[] = [];\r\n        const fields: Field[] = [];\r\n        const byId: KeyValue<ArrayVector> = {};\r\n        values.push(new ArrayVector()); // The name\r\n        fields.push({\r\n          name: 'Field',\r\n          type: FieldType.string,\r\n          values: values[0],\r\n          config: {},\r\n        });\r\n        for (const info of calculators) {\r\n          const vals = new ArrayVector();\r\n          byId[info.id] = vals;\r\n          values.push(vals);\r\n          fields.push({\r\n            name: info.id,\r\n            type: FieldType.other, // UNKNOWN until after we call the functions\r\n            values: values[values.length - 1],\r\n            config: {\r\n              title: info.name,\r\n              // UNIT from original field?\r\n            },\r\n          });\r\n        }\r\n        for (let i = 0; i < series.fields.length; i++) {\r\n          const field = series.fields[i];\r\n          if (matcher(field)) {\r\n            const results = reduceField({\r\n              field,\r\n              reducers,\r\n            });\r\n            // Update the name list\r\n            values[0].buffer.push(field.name);\r\n            for (const info of calculators) {\r\n              const v = results[info.id];\r\n              byId[info.id].buffer.push(v);\r\n            }\r\n          }\r\n        }\r\n        for (const f of fields) {\r\n          const t = guessFieldTypeForField(f);\r\n          if (t) {\r\n            f.type = t;\r\n          }\r\n        }\r\n        processed.push({\r\n          ...series, // Same properties, different fields\r\n          fields,\r\n          length: values[0].length,\r\n        });\r\n      }\r\n      return processed;\r\n    };\r\n  },\r\n};\r\n","import { ComponentClass } from 'react';\r\nimport { KeyValue } from './data';\r\nimport { NavModel } from './navModel';\r\nimport { PluginMeta, GrafanaPlugin, PluginIncludeType } from './plugin';\r\n\r\nexport enum CoreApp {\r\n  Dashboard = 'dashboard',\r\n  Explore = 'explore',\r\n}\r\n\r\nexport interface AppRootProps<T = KeyValue> {\r\n  meta: AppPluginMeta<T>;\r\n\r\n  path: string; // The URL path to this page\r\n  query: KeyValue; // The URL query parameters\r\n\r\n  /**\r\n   * Pass the nav model to the container... is there a better way?\r\n   */\r\n  onNavChanged: (nav: NavModel) => void;\r\n}\r\n\r\nexport interface AppPluginMeta<T = KeyValue> extends PluginMeta<T> {\r\n  // TODO anything specific to apps?\r\n}\r\n\r\nexport class AppPlugin<T = KeyValue> extends GrafanaPlugin<AppPluginMeta<T>> {\r\n  // Content under: /a/${plugin-id}/*\r\n  root?: ComponentClass<AppRootProps<T>>;\r\n  rootNav?: NavModel; // Initial navigation model\r\n\r\n  // Old style pages\r\n  angularPages?: { [component: string]: any };\r\n\r\n  /**\r\n   * Called after the module has loaded, and before the app is used.\r\n   * This function may be called multiple times on the same instance.\r\n   * The first time, `this.meta` will be undefined\r\n   */\r\n  init(meta: AppPluginMeta) {}\r\n\r\n  /**\r\n   * Set the component displayed under:\r\n   *   /a/${plugin-id}/*\r\n   */\r\n  setRootPage(root: ComponentClass<AppRootProps<T>>, rootNav?: NavModel) {\r\n    this.root = root;\r\n    this.rootNav = rootNav;\r\n    return this;\r\n  }\r\n\r\n  setComponentsFromLegacyExports(pluginExports: any) {\r\n    if (pluginExports.ConfigCtrl) {\r\n      this.angularConfigCtrl = pluginExports.ConfigCtrl;\r\n    }\r\n\r\n    if (this.meta && this.meta.includes) {\r\n      for (const include of this.meta.includes) {\r\n        if (include.type === PluginIncludeType.page && include.component) {\r\n          const exp = pluginExports[include.component];\r\n\r\n          if (!exp) {\r\n            console.warn('App Page uses unknown component: ', include.component, this.meta);\r\n            continue;\r\n          }\r\n\r\n          if (!this.angularPages) {\r\n            this.angularPages = {};\r\n          }\r\n\r\n          this.angularPages[include.component] = exp;\r\n        }\r\n      }\r\n    }\r\n  }\r\n}\r\n","import { eventFactory } from './utils';\r\n\r\nexport interface AppEvent<T> {\r\n  readonly name: string;\r\n  payload?: T;\r\n}\r\n\r\nexport type AlertPayload = [string, string?];\r\n\r\nexport const alertSuccess = eventFactory<AlertPayload>('alert-success');\r\nexport const alertWarning = eventFactory<AlertPayload>('alert-warning');\r\nexport const alertError = eventFactory<AlertPayload>('alert-error');\r\n","export type KeyValue<T = any> = { [s: string]: T };\r\n\r\nexport enum LoadingState {\r\n  NotStarted = 'NotStarted',\r\n  Loading = 'Loading',\r\n  Streaming = 'Streaming',\r\n  Done = 'Done',\r\n  Error = 'Error',\r\n}\r\n\r\nexport interface QueryResultMeta {\r\n  [key: string]: any;\r\n\r\n  // Match the result to the query\r\n  requestId?: string;\r\n\r\n  // Used in Explore for highlighting\r\n  searchWords?: string[];\r\n\r\n  // Used in Explore to show limit applied to search result\r\n  limit?: number;\r\n\r\n  // HACK: save the datassource name in the meta so we can load it from the response\r\n  // we should be able to find the datasource from the refId\r\n  datasource?: string;\r\n\r\n  // DatasSource Specific Values\r\n  custom?: Record<string, any>;\r\n}\r\n\r\nexport interface QueryResultBase {\r\n  /**\r\n   * Matches the query target refId\r\n   */\r\n  refId?: string;\r\n\r\n  /**\r\n   * Used by some backend data sources to communicate back info about the execution (generated sql, timing)\r\n   */\r\n  meta?: QueryResultMeta;\r\n}\r\n\r\nexport interface Labels {\r\n  [key: string]: string;\r\n}\r\n\r\nexport interface Column {\r\n  text: string; // For a Column, the 'text' is the field name\r\n  filterable?: boolean;\r\n  unit?: string;\r\n}\r\n\r\nexport interface TableData extends QueryResultBase {\r\n  name?: string;\r\n  columns: Column[];\r\n  rows: any[][];\r\n  type?: string;\r\n}\r\n\r\nexport type TimeSeriesValue = number | null;\r\n\r\nexport type TimeSeriesPoints = TimeSeriesValue[][];\r\n\r\nexport interface TimeSeries extends QueryResultBase {\r\n  target: string;\r\n  datapoints: TimeSeriesPoints;\r\n  unit?: string;\r\n  tags?: Labels;\r\n}\r\n\r\nexport enum NullValueMode {\r\n  Null = 'null',\r\n  Ignore = 'connected',\r\n  AsZero = 'null as zero',\r\n}\r\n\r\nexport interface AnnotationEvent {\r\n  id?: string;\r\n  annotation?: any;\r\n  dashboardId?: number;\r\n  panelId?: number;\r\n  userId?: number;\r\n  login?: string;\r\n  email?: string;\r\n  avatarUrl?: string;\r\n  time?: number;\r\n  timeEnd?: number;\r\n  isRegion?: boolean;\r\n  title?: string;\r\n  text?: string;\r\n  type?: string;\r\n  tags?: string[];\r\n\r\n  // Currently used to merge annotations from alerts and dashboard\r\n  source?: any; // source.type === 'dashboard'\r\n}\r\n","import { ThresholdsConfig } from './thresholds';\r\nimport { ValueMapping } from './valueMapping';\r\nimport { QueryResultBase, Labels, NullValueMode } from './data';\r\nimport { DisplayProcessor } from './displayValue';\r\nimport { DataLink } from './dataLink';\r\nimport { Vector } from './vector';\r\nimport { FieldCalcs } from '../transformations/fieldReducer';\r\nimport { FieldColor } from './fieldColor';\r\n\r\nexport enum FieldType {\r\n  time = 'time', // or date\r\n  number = 'number',\r\n  string = 'string',\r\n  boolean = 'boolean',\r\n  other = 'other', // Object, Array, etc\r\n}\r\n\r\n/**\r\n * Every property is optional\r\n *\r\n * Plugins may extend this with additional properties. Something like series overrides\r\n */\r\nexport interface FieldConfig {\r\n  title?: string; // The display value for this field.  This supports template variables blank is auto\r\n  filterable?: boolean;\r\n\r\n  // Numeric Options\r\n  unit?: string;\r\n  decimals?: number | null; // Significant digits (for display)\r\n  min?: number | null;\r\n  max?: number | null;\r\n\r\n  // Convert input values into a display string\r\n  mappings?: ValueMapping[];\r\n\r\n  // Map numeric values to states\r\n  thresholds?: ThresholdsConfig;\r\n\r\n  // Map values to a display color\r\n  color?: FieldColor;\r\n\r\n  // Used when reducing field values\r\n  nullValueMode?: NullValueMode;\r\n\r\n  // The behavior when clicking on a result\r\n  links?: DataLink[];\r\n\r\n  // Alternative to empty string\r\n  noValue?: string;\r\n\r\n  // Panel Specific Values\r\n  custom?: Record<string, any>;\r\n}\r\n\r\nexport interface Field<T = any, V = Vector<T>> {\r\n  /**\r\n   * Name of the field (column)\r\n   */\r\n  name: string;\r\n  /**\r\n   *  Field value type (string, number, etc)\r\n   */\r\n  type: FieldType;\r\n  /**\r\n   *  Meta info about how field and how to display it\r\n   */\r\n  config: FieldConfig;\r\n  values: V; // The raw field values\r\n  labels?: Labels;\r\n\r\n  /**\r\n   * Cache of reduced values\r\n   */\r\n  calcs?: FieldCalcs;\r\n\r\n  /**\r\n   * Convert text to the field value\r\n   */\r\n  parse?: (value: any) => T;\r\n\r\n  /**\r\n   * Convert a value for display\r\n   */\r\n  display?: DisplayProcessor;\r\n}\r\n\r\nexport interface DataFrame extends QueryResultBase {\r\n  name?: string;\r\n  fields: Field[]; // All fields of equal length\r\n\r\n  // The number of rows\r\n  length: number;\r\n}\r\n\r\n/**\r\n * Like a field, but properties are optional and values may be a simple array\r\n */\r\nexport interface FieldDTO<T = any> {\r\n  name: string; // The column name\r\n  type?: FieldType;\r\n  config?: FieldConfig;\r\n  values?: Vector<T> | T[]; // toJSON will always be T[], input could be either\r\n  labels?: Labels;\r\n}\r\n\r\n/**\r\n * Like a DataFrame, but fields may be a FieldDTO\r\n */\r\nexport interface DataFrameDTO extends QueryResultBase {\r\n  name?: string;\r\n  fields: Array<FieldDTO | Field>;\r\n}\r\n","import { Observable } from 'rxjs';\r\nimport { ComponentType } from 'react';\r\nimport { GrafanaPlugin, PluginMeta } from './plugin';\r\nimport { PanelData } from './panel';\r\nimport { LogRowModel } from './logs';\r\nimport { AnnotationEvent, KeyValue, LoadingState, TableData, TimeSeries } from './data';\r\nimport { DataFrame, DataFrameDTO } from './dataFrame';\r\nimport { RawTimeRange, TimeRange, AbsoluteTimeRange } from './time';\r\nimport { ScopedVars } from './ScopedVars';\r\nimport { CoreApp } from './app';\r\n\r\nexport interface DataSourcePluginOptionsEditorProps<JSONData = DataSourceJsonData, SecureJSONData = {}> {\r\n  options: DataSourceSettings<JSONData, SecureJSONData>;\r\n  onOptionsChange: (options: DataSourceSettings<JSONData, SecureJSONData>) => void;\r\n}\r\n\r\n// Utility type to extract the query type TQuery from a class extending DataSourceApi<TQuery, TOptions>\r\nexport type DataSourceQueryType<DSType extends DataSourceApi<any, any>> = DSType extends DataSourceApi<\r\n  infer TQuery,\r\n  infer _TOptions\r\n>\r\n  ? TQuery\r\n  : never;\r\n\r\n// Utility type to extract the options type TOptions from a class extending DataSourceApi<TQuery, TOptions>\r\nexport type DataSourceOptionsType<DSType extends DataSourceApi<any, any>> = DSType extends DataSourceApi<\r\n  infer _TQuery,\r\n  infer TOptions\r\n>\r\n  ? TOptions\r\n  : never;\r\n\r\nexport class DataSourcePlugin<\r\n  DSType extends DataSourceApi<TQuery, TOptions>,\r\n  TQuery extends DataQuery = DataSourceQueryType<DSType>,\r\n  TOptions extends DataSourceJsonData = DataSourceOptionsType<DSType>\r\n> extends GrafanaPlugin<DataSourcePluginMeta<TOptions>> {\r\n  components: DataSourcePluginComponents<DSType, TQuery, TOptions> = {};\r\n\r\n  constructor(public DataSourceClass: DataSourceConstructor<DSType, TQuery, TOptions>) {\r\n    super();\r\n  }\r\n\r\n  setConfigEditor(editor: ComponentType<DataSourcePluginOptionsEditorProps<TOptions>>) {\r\n    this.components.ConfigEditor = editor;\r\n    return this;\r\n  }\r\n\r\n  setConfigCtrl(ConfigCtrl: any) {\r\n    this.angularConfigCtrl = ConfigCtrl;\r\n    return this;\r\n  }\r\n\r\n  setQueryCtrl(QueryCtrl: any) {\r\n    this.components.QueryCtrl = QueryCtrl;\r\n    return this;\r\n  }\r\n\r\n  setAnnotationQueryCtrl(AnnotationsQueryCtrl: any) {\r\n    this.components.AnnotationsQueryCtrl = AnnotationsQueryCtrl;\r\n    return this;\r\n  }\r\n\r\n  setQueryEditor(QueryEditor: ComponentType<QueryEditorProps<DSType, TQuery, TOptions>>) {\r\n    this.components.QueryEditor = QueryEditor;\r\n    return this;\r\n  }\r\n\r\n  setExploreQueryField(ExploreQueryField: ComponentType<ExploreQueryFieldProps<DSType, TQuery, TOptions>>) {\r\n    this.components.ExploreQueryField = ExploreQueryField;\r\n    return this;\r\n  }\r\n\r\n  setExploreMetricsQueryField(ExploreQueryField: ComponentType<ExploreQueryFieldProps<DSType, TQuery, TOptions>>) {\r\n    this.components.ExploreMetricsQueryField = ExploreQueryField;\r\n    return this;\r\n  }\r\n\r\n  setExploreLogsQueryField(ExploreQueryField: ComponentType<ExploreQueryFieldProps<DSType, TQuery, TOptions>>) {\r\n    this.components.ExploreLogsQueryField = ExploreQueryField;\r\n    return this;\r\n  }\r\n\r\n  setExploreStartPage(ExploreStartPage: ComponentType<ExploreStartPageProps>) {\r\n    this.components.ExploreStartPage = ExploreStartPage;\r\n    return this;\r\n  }\r\n\r\n  setVariableQueryEditor(VariableQueryEditor: any) {\r\n    this.components.VariableQueryEditor = VariableQueryEditor;\r\n    return this;\r\n  }\r\n\r\n  setMetadataInspector(MetadataInspector: ComponentType<MetadataInspectorProps<DSType, TQuery, TOptions>>) {\r\n    this.components.MetadataInspector = MetadataInspector;\r\n    return this;\r\n  }\r\n\r\n  setComponentsFromLegacyExports(pluginExports: any) {\r\n    this.angularConfigCtrl = pluginExports.ConfigCtrl;\r\n\r\n    this.components.QueryCtrl = pluginExports.QueryCtrl;\r\n    this.components.AnnotationsQueryCtrl = pluginExports.AnnotationsQueryCtrl;\r\n    this.components.ExploreQueryField = pluginExports.ExploreQueryField;\r\n    this.components.ExploreStartPage = pluginExports.ExploreStartPage;\r\n    this.components.QueryEditor = pluginExports.QueryEditor;\r\n    this.components.VariableQueryEditor = pluginExports.VariableQueryEditor;\r\n  }\r\n}\r\n\r\nexport interface DataSourcePluginMeta<T extends KeyValue = {}> extends PluginMeta<T> {\r\n  builtIn?: boolean; // Is this for all\r\n  metrics?: boolean;\r\n  logs?: boolean;\r\n  annotations?: boolean;\r\n  alerting?: boolean;\r\n  mixed?: boolean;\r\n  hasQueryHelp?: boolean;\r\n  category?: string;\r\n  queryOptions?: PluginMetaQueryOptions;\r\n  sort?: number;\r\n  streaming?: boolean;\r\n}\r\n\r\ninterface PluginMetaQueryOptions {\r\n  cacheTimeout?: boolean;\r\n  maxDataPoints?: boolean;\r\n  minInterval?: boolean;\r\n}\r\n\r\nexport interface DataSourcePluginComponents<\r\n  DSType extends DataSourceApi<TQuery, TOptions>,\r\n  TQuery extends DataQuery = DataQuery,\r\n  TOptions extends DataSourceJsonData = DataSourceJsonData\r\n> {\r\n  QueryCtrl?: any;\r\n  AnnotationsQueryCtrl?: any;\r\n  VariableQueryEditor?: any;\r\n  QueryEditor?: ComponentType<QueryEditorProps<DSType, TQuery, TOptions>>;\r\n  ExploreQueryField?: ComponentType<ExploreQueryFieldProps<DSType, TQuery, TOptions>>;\r\n  ExploreMetricsQueryField?: ComponentType<ExploreQueryFieldProps<DSType, TQuery, TOptions>>;\r\n  ExploreLogsQueryField?: ComponentType<ExploreQueryFieldProps<DSType, TQuery, TOptions>>;\r\n  ExploreStartPage?: ComponentType<ExploreStartPageProps>;\r\n  ConfigEditor?: ComponentType<DataSourcePluginOptionsEditorProps<TOptions>>;\r\n  MetadataInspector?: ComponentType<MetadataInspectorProps<DSType, TQuery, TOptions>>;\r\n}\r\n\r\n// Only exported for tests\r\nexport interface DataSourceConstructor<\r\n  DSType extends DataSourceApi<TQuery, TOptions>,\r\n  TQuery extends DataQuery = DataQuery,\r\n  TOptions extends DataSourceJsonData = DataSourceJsonData\r\n> {\r\n  new (instanceSettings: DataSourceInstanceSettings<TOptions>, ...args: any[]): DSType;\r\n}\r\n\r\n/**\r\n * The main data source abstraction interface, represents an instance of a data source\r\n *\r\n * Although this is a class, datasource implementations do not *yet* need to extend it.\r\n * As such, we can not yet add functions with default implementations.\r\n */\r\nexport abstract class DataSourceApi<\r\n  TQuery extends DataQuery = DataQuery,\r\n  TOptions extends DataSourceJsonData = DataSourceJsonData\r\n> {\r\n  /**\r\n   *  Set in constructor\r\n   */\r\n  readonly name: string;\r\n\r\n  /**\r\n   *  Set in constructor\r\n   */\r\n  readonly id: number;\r\n\r\n  /**\r\n   *  min interval range\r\n   */\r\n  interval?: string;\r\n\r\n  constructor(instanceSettings: DataSourceInstanceSettings<TOptions>) {\r\n    this.name = instanceSettings.name;\r\n    this.id = instanceSettings.id;\r\n  }\r\n\r\n  /**\r\n   * Imports queries from a different datasource\r\n   */\r\n  importQueries?(queries: TQuery[], originMeta: PluginMeta): Promise<TQuery[]>;\r\n\r\n  /**\r\n   * Initializes a datasource after instantiation\r\n   */\r\n  init?: () => void;\r\n\r\n  /**\r\n   * Query for data, and optionally stream results\r\n   */\r\n  abstract query(request: DataQueryRequest<TQuery>): Promise<DataQueryResponse> | Observable<DataQueryResponse>;\r\n\r\n  /**\r\n   * Test & verify datasource settings & connection details\r\n   */\r\n  abstract testDatasource(): Promise<any>;\r\n\r\n  /**\r\n   *  Get hints for query improvements\r\n   */\r\n  getQueryHints?(query: TQuery, results: any[], ...rest: any): QueryHint[];\r\n\r\n  /**\r\n   * Convert a query to a simple text string\r\n   */\r\n  getQueryDisplayText?(query: TQuery): string;\r\n\r\n  /**\r\n   * Retrieve context for a given log row\r\n   */\r\n  getLogRowContext?: <TContextQueryOptions extends {}>(\r\n    row: LogRowModel,\r\n    options?: TContextQueryOptions\r\n  ) => Promise<DataQueryResponse>;\r\n\r\n  /**\r\n   * Variable query action.\r\n   */\r\n  metricFindQuery?(query: any, options?: any): Promise<MetricFindValue[]>;\r\n\r\n  /**\r\n   * Get tag keys for adhoc filters\r\n   */\r\n  getTagKeys?(options?: any): Promise<MetricFindValue[]>;\r\n\r\n  /**\r\n   * Get tag values for adhoc filters\r\n   */\r\n  getTagValues?(options: any): Promise<MetricFindValue[]>;\r\n\r\n  /**\r\n   * Set after constructor call, as the data source instance is the most common thing to pass around\r\n   * we attach the components to this instance for easy access\r\n   */\r\n  components?: DataSourcePluginComponents<DataSourceApi<TQuery, TOptions>, TQuery, TOptions>;\r\n\r\n  /**\r\n   * static information about the datasource\r\n   */\r\n  meta?: DataSourcePluginMeta;\r\n\r\n  /**\r\n   * Used by alerting to check if query contains template variables\r\n   */\r\n  targetContainsTemplate?(query: TQuery): boolean;\r\n\r\n  /**\r\n   * Used in explore\r\n   */\r\n  modifyQuery?(query: TQuery, action: QueryFixAction): TQuery;\r\n\r\n  /**\r\n   * Used in explore\r\n   */\r\n  getHighlighterExpression?(query: TQuery): string[];\r\n\r\n  /**\r\n   * Used in explore\r\n   */\r\n  languageProvider?: any;\r\n\r\n  getVersion?(optionalOptions?: any): Promise<string>;\r\n\r\n  /**\r\n   * Can be optionally implemented to allow datasource to be a source of annotations for dashboard. To be visible\r\n   * in the annotation editor `annotations` capability also needs to be enabled in plugin.json.\r\n   */\r\n  annotationQuery?(options: AnnotationQueryRequest<TQuery>): Promise<AnnotationEvent[]>;\r\n\r\n  interpolateVariablesInQueries?(queries: TQuery[], scopedVars: ScopedVars | {}): TQuery[];\r\n}\r\n\r\nexport interface MetadataInspectorProps<\r\n  DSType extends DataSourceApi<TQuery, TOptions>,\r\n  TQuery extends DataQuery = DataQuery,\r\n  TOptions extends DataSourceJsonData = DataSourceJsonData\r\n> {\r\n  datasource: DSType;\r\n\r\n  // All Data from this DataSource\r\n  data: DataFrame[];\r\n}\r\n\r\nexport interface QueryEditorProps<\r\n  DSType extends DataSourceApi<TQuery, TOptions>,\r\n  TQuery extends DataQuery = DataQuery,\r\n  TOptions extends DataSourceJsonData = DataSourceJsonData\r\n> {\r\n  datasource: DSType;\r\n  query: TQuery;\r\n  onRunQuery: () => void;\r\n  onChange: (value: TQuery) => void;\r\n  /**\r\n   * Contains query response filtered by refId of QueryResultBase and possible query error\r\n   */\r\n  data?: PanelData;\r\n}\r\n\r\nexport enum DataSourceStatus {\r\n  Connected,\r\n  Disconnected,\r\n}\r\n\r\nexport interface ExploreQueryFieldProps<\r\n  DSType extends DataSourceApi<TQuery, TOptions>,\r\n  TQuery extends DataQuery = DataQuery,\r\n  TOptions extends DataSourceJsonData = DataSourceJsonData\r\n> extends QueryEditorProps<DSType, TQuery, TOptions> {\r\n  history: any[];\r\n  onBlur?: () => void;\r\n  absoluteRange?: AbsoluteTimeRange;\r\n}\r\n\r\nexport interface ExploreStartPageProps {\r\n  datasource?: DataSourceApi;\r\n  exploreMode: 'Logs' | 'Metrics';\r\n  onClickExample: (query: DataQuery) => void;\r\n}\r\n\r\n/**\r\n * Starting in v6.2 DataFrame can represent both TimeSeries and TableData\r\n */\r\nexport type LegacyResponseData = TimeSeries | TableData | any;\r\n\r\nexport type DataQueryResponseData = DataFrame | DataFrameDTO | LegacyResponseData;\r\n\r\nexport interface DataQueryResponse {\r\n  /**\r\n   * The response data.  When streaming, this may be empty\r\n   * or a partial result set\r\n   */\r\n  data: DataQueryResponseData[];\r\n\r\n  /**\r\n   * When returning multiple partial responses or streams\r\n   * Use this key to inform Grafana how to combine the partial responses\r\n   * Multiple responses with same key are replaced (latest used)\r\n   */\r\n  key?: string;\r\n\r\n  /**\r\n   * Optionally include error info along with the response data\r\n   */\r\n  error?: DataQueryError;\r\n\r\n  /**\r\n   * Use this to control which state the response should have\r\n   * Defaults to LoadingState.Done if state is not defined\r\n   */\r\n  state?: LoadingState;\r\n}\r\n\r\nexport interface DataQuery {\r\n  /**\r\n   * A - Z\r\n   */\r\n  refId: string;\r\n\r\n  /**\r\n   * true if query is disabled (ie not executed / sent to TSDB)\r\n   */\r\n  hide?: boolean;\r\n\r\n  /**\r\n   * Unique, guid like, string used in explore mode\r\n   */\r\n  key?: string;\r\n\r\n  /**\r\n   * For mixed data sources the selected datasource is on the query level.\r\n   * For non mixed scenarios this is undefined.\r\n   */\r\n  datasource?: string | null;\r\n\r\n  metric?: any;\r\n}\r\n\r\nexport interface DataQueryError {\r\n  data?: {\r\n    message?: string;\r\n    error?: string;\r\n  };\r\n  message?: string;\r\n  status?: string;\r\n  statusText?: string;\r\n  refId?: string;\r\n  cancelled?: boolean;\r\n}\r\n\r\nexport interface DataQueryRequest<TQuery extends DataQuery = DataQuery> {\r\n  requestId: string; // Used to identify results and optionally cancel the request in backendSrv\r\n\r\n  dashboardId: number;\r\n  interval: string;\r\n  intervalMs?: number;\r\n  maxDataPoints?: number;\r\n  panelId: number;\r\n  range?: TimeRange;\r\n  reverse?: boolean;\r\n  scopedVars: ScopedVars;\r\n  targets: TQuery[];\r\n  timezone: string;\r\n  app: CoreApp | string;\r\n\r\n  cacheTimeout?: string;\r\n  exploreMode?: 'Logs' | 'Metrics';\r\n  rangeRaw?: RawTimeRange;\r\n  timeInfo?: string; // The query time description (blue text in the upper right)\r\n\r\n  // Request Timing\r\n  startTime: number;\r\n  endTime?: number;\r\n}\r\n\r\nexport interface QueryFix {\r\n  type: string;\r\n  label: string;\r\n  action?: QueryFixAction;\r\n}\r\n\r\nexport interface QueryFixAction {\r\n  type: string;\r\n  query?: string;\r\n  preventSubmit?: boolean;\r\n}\r\n\r\nexport interface QueryHint {\r\n  type: string;\r\n  label: string;\r\n  fix?: QueryFix;\r\n}\r\n\r\nexport interface MetricFindValue {\r\n  text: string;\r\n}\r\n\r\nexport interface DataSourceJsonData {\r\n  authType?: string;\r\n  defaultRegion?: string;\r\n}\r\n\r\n/**\r\n * Data Source instance edit model.  This is returned from:\r\n *  /api/datasources\r\n */\r\nexport interface DataSourceSettings<T extends DataSourceJsonData = DataSourceJsonData, S = {}> {\r\n  id: number;\r\n  orgId: number;\r\n  name: string;\r\n  typeLogoUrl: string;\r\n  type: string;\r\n  access: string;\r\n  url: string;\r\n  password: string;\r\n  user: string;\r\n  database: string;\r\n  basicAuth: boolean;\r\n  basicAuthPassword: string;\r\n  basicAuthUser: string;\r\n  isDefault: boolean;\r\n  jsonData: T;\r\n  secureJsonData?: S;\r\n  secureJsonFields?: KeyValue<boolean>;\r\n  readOnly: boolean;\r\n  withCredentials: boolean;\r\n  version?: number;\r\n}\r\n\r\n/**\r\n * Frontend settings model that is passed to Datasource constructor. This differs a bit from the model above\r\n * as this data model is available to every user who has access to a data source (Viewers+).  This is loaded\r\n * in bootData (on page load), or from: /api/frontend/settings\r\n */\r\nexport interface DataSourceInstanceSettings<T extends DataSourceJsonData = DataSourceJsonData> {\r\n  id: number;\r\n  type: string;\r\n  name: string;\r\n  meta: DataSourcePluginMeta;\r\n  url?: string;\r\n  jsonData: T;\r\n  username?: string;\r\n  password?: string; // when access is direct, for some legacy datasources\r\n  database?: string;\r\n\r\n  /**\r\n   * This is the full Authorization header if basic auth is ennabled.\r\n   * Only available here when access is Browser (direct), when acess is Server (proxy)\r\n   * The basic auth header, username & password is never exposted to browser/Frontend\r\n   * so this will be emtpy then.\r\n   */\r\n  basicAuth?: string;\r\n  withCredentials?: boolean;\r\n}\r\n\r\nexport interface DataSourceSelectItem {\r\n  name: string;\r\n  value: string | null;\r\n  meta: DataSourcePluginMeta;\r\n  sort: string;\r\n}\r\n\r\n/**\r\n * Options passed to the datasource.annotationQuery method. See docs/plugins/developing/datasource.md\r\n */\r\nexport interface AnnotationQueryRequest<MoreOptions = {}> {\r\n  range: TimeRange;\r\n  rangeRaw: RawTimeRange;\r\n  // Should be DataModel but cannot import that here from the main app. Needs to be moved to package first.\r\n  dashboard: any;\r\n  annotation: {\r\n    datasource: string;\r\n    enable: boolean;\r\n    name: string;\r\n  } & MoreOptions;\r\n}\r\n\r\nexport interface HistoryItem<TQuery extends DataQuery = DataQuery> {\r\n  ts: number;\r\n  query: TQuery;\r\n}\r\n\r\nexport abstract class LanguageProvider {\r\n  abstract datasource: DataSourceApi<any, any>;\r\n  abstract request: (url: string, params?: any) => Promise<any>;\r\n\r\n  /**\r\n   * Returns startTask that resolves with a task list when main syntax is loaded.\r\n   * Task list consists of secondary promises that load more detailed language features.\r\n   */\r\n  abstract start: () => Promise<any[]>;\r\n  startTask?: Promise<any[]>;\r\n}\r\n","export enum FieldColorMode {\r\n  Thresholds = 'thresholds',\r\n  Scheme = 'scheme',\r\n  Fixed = 'fixed',\r\n}\r\n\r\nexport interface FieldColor {\r\n  mode: FieldColorMode;\r\n  schemeName?: ColorScheme;\r\n  fixedColor?: string;\r\n}\r\n\r\n// https://github.com/d3/d3-scale-chromatic\r\nexport enum ColorScheme {\r\n  BrBG = 'BrBG',\r\n  PRGn = 'PRGn',\r\n  PiYG = 'PiYG',\r\n  PuOr = 'PuOr',\r\n  RdBu = 'RdBu',\r\n  RdGy = 'RdGy',\r\n  RdYlBu = 'RdYlBu',\r\n  RdYlGn = 'RdYlGn',\r\n  Spectral = 'Spectral',\r\n  BuGn = 'BuGn',\r\n  BuPu = 'BuPu',\r\n  GnBu = 'GnBu',\r\n  OrRd = 'OrRd',\r\n  PuBuGn = 'PuBuGn',\r\n  PuBu = 'PuBu',\r\n  PuRd = 'PuRd',\r\n  RdPu = 'RdPu',\r\n  YlGnBu = 'YlGnBu',\r\n  YlGn = 'YlGn',\r\n  YlOrBr = 'YlOrBr',\r\n  YlOrRd = 'YlOrRd',\r\n  Blues = 'Blues',\r\n  Greens = 'Greens',\r\n  Greys = 'Greys',\r\n  Purples = 'Purples',\r\n  Reds = 'Reds',\r\n  Oranges = 'Oranges',\r\n\r\n  // interpolateCubehelix\r\n  // interpolateRainbow,\r\n  // interpolateWarm\r\n  // interpolateCool\r\n  // interpolateSinebow\r\n  // interpolateViridis\r\n  // interpolateMagma\r\n  // interpolateInferno\r\n  // interpolatePlasma\r\n}\r\n","export * from './data';\r\nexport * from './dataFrame';\r\nexport * from './dataLink';\r\nexport * from './logs';\r\nexport * from './navModel';\r\nexport * from './select';\r\nexport * from './time';\r\nexport * from './thresholds';\r\nexport * from './utils';\r\nexport * from './valueMapping';\r\nexport * from './displayValue';\r\nexport * from './graph';\r\nexport * from './ScopedVars';\r\nexport * from './transformations';\r\nexport * from './fieldOverrides';\r\nexport * from './vector';\r\nexport * from './app';\r\nexport * from './datasource';\r\nexport * from './panel';\r\nexport * from './plugin';\r\nexport * from './thresholds';\r\nexport * from './fieldColor';\r\nexport * from './theme';\r\nexport * from './orgs';\r\nexport * from './flot';\r\n\r\nimport * as AppEvents from './appEvents';\r\nimport { AppEvent } from './appEvents';\r\nexport { AppEvent, AppEvents };\r\n\r\nimport * as PanelEvents from './panelEvents';\r\nexport { PanelEvents };\r\n","import { Labels } from './data';\r\nimport { GraphSeriesXY } from './graph';\r\nimport { DataFrame } from './dataFrame';\r\n\r\n/**\r\n * Mapping of log level abbreviation to canonical log level.\r\n * Supported levels are reduce to limit color variation.\r\n */\r\nexport enum LogLevel {\r\n  emerg = 'critical',\r\n  alert = 'critical',\r\n  crit = 'critical',\r\n  critical = 'critical',\r\n  warn = 'warning',\r\n  warning = 'warning',\r\n  err = 'error',\r\n  eror = 'error',\r\n  error = 'error',\r\n  info = 'info',\r\n  notice = 'info',\r\n  dbug = 'debug',\r\n  debug = 'debug',\r\n  trace = 'trace',\r\n  unknown = 'unknown',\r\n}\r\n\r\nexport enum LogsMetaKind {\r\n  Number,\r\n  String,\r\n  LabelsMap,\r\n}\r\n\r\nexport interface LogsMetaItem {\r\n  label: string;\r\n  value: string | number | Labels;\r\n  kind: LogsMetaKind;\r\n}\r\n\r\nexport interface LogRowModel {\r\n  // Index of the field from which the entry has been created so that we do not show it later in log row details.\r\n  entryFieldIndex: number;\r\n\r\n  // Index of the row in the dataframe. As log rows can be stitched from multiple dataFrames, this does not have to be\r\n  // the same as rows final index when rendered.\r\n  rowIndex: number;\r\n\r\n  // Full DataFrame from which we parsed this log.\r\n  // TODO: refactor this so we do not need to pass whole dataframes in addition to also parsed data.\r\n  dataFrame: DataFrame;\r\n  duplicates?: number;\r\n\r\n  // Actual log line\r\n  entry: string;\r\n  hasAnsi: boolean;\r\n  labels: Labels;\r\n  logLevel: LogLevel;\r\n  raw: string;\r\n  searchWords?: string[];\r\n  timeFromNow: string;\r\n  timeEpochMs: number;\r\n  timeLocal: string;\r\n  timeUtc: string;\r\n  uid: string;\r\n  uniqueLabels?: Labels;\r\n}\r\n\r\nexport interface LogsModel {\r\n  hasUniqueLabels: boolean;\r\n  meta?: LogsMetaItem[];\r\n  rows: LogRowModel[];\r\n  series?: GraphSeriesXY[];\r\n}\r\n\r\nexport interface LogSearchMatch {\r\n  start: number;\r\n  length: number;\r\n  text: string;\r\n}\r\n\r\nexport interface LogLabelStatsModel {\r\n  active?: boolean;\r\n  count: number;\r\n  proportion: number;\r\n  value: string;\r\n}\r\n\r\nexport enum LogsDedupStrategy {\r\n  none = 'none',\r\n  exact = 'exact',\r\n  numbers = 'numbers',\r\n  signature = 'signature',\r\n}\r\n\r\nexport interface LogsParser {\r\n  /**\r\n   * Value-agnostic matcher for a field label.\r\n   * Used to filter rows, and first capture group contains the value.\r\n   */\r\n  buildMatcher: (label: string) => RegExp;\r\n\r\n  /**\r\n   * Returns all parsable substrings from a line, used for highlighting\r\n   */\r\n  getFields: (line: string) => string[];\r\n\r\n  /**\r\n   * Gets the label name from a parsable substring of a line\r\n   */\r\n  getLabelFromField: (field: string) => string;\r\n\r\n  /**\r\n   * Gets the label value from a parsable substring of a line\r\n   */\r\n  getValueFromField: (field: string) => string;\r\n  /**\r\n   * Function to verify if this is a valid parser for the given line.\r\n   * The parser accepts the line unless it returns undefined.\r\n   */\r\n  test: (line: string) => any;\r\n}\r\n\r\nexport enum LogsDedupDescription {\r\n  none = 'No de-duplication',\r\n  exact = 'De-duplication of successive lines that are identical, ignoring ISO datetimes.',\r\n  numbers = 'De-duplication of successive lines that are identical when ignoring numbers, e.g., IP addresses, latencies.',\r\n  signature = 'De-duplication of successive lines that have identical punctuation and whitespace.',\r\n}\r\n","export interface UserOrgDTO {\n  orgId: number;\n  name: string;\n  role: OrgRole;\n}\n\nexport enum OrgRole {\n  Admin = 'Admin',\n  Editor = 'Editor',\n  Viewer = 'Viewer',\n}\n","import { ComponentClass, ComponentType } from 'react';\r\nimport { DataQueryError, DataQueryRequest } from './datasource';\r\nimport { GrafanaPlugin, PluginMeta } from './plugin';\r\nimport { ScopedVars } from './ScopedVars';\r\nimport { LoadingState } from './data';\r\nimport { DataFrame } from './dataFrame';\r\nimport { AbsoluteTimeRange, TimeRange, TimeZone } from './time';\r\n\r\nexport type InterpolateFunction = (value: string, scopedVars?: ScopedVars, format?: string | Function) => string;\r\n\r\nexport interface PanelPluginMeta extends PluginMeta {\r\n  skipDataQuery?: boolean;\r\n  hideFromList?: boolean;\r\n  sort: number;\r\n}\r\n\r\nexport interface PanelData {\r\n  state: LoadingState;\r\n  series: DataFrame[];\r\n  request?: DataQueryRequest;\r\n  error?: DataQueryError;\r\n  // Contains the range from the request or a shifted time range if a request uses relative time\r\n  timeRange: TimeRange;\r\n}\r\n\r\nexport interface PanelProps<T = any> {\r\n  id: number; // ID within the current dashboard\r\n  data: PanelData;\r\n  timeRange: TimeRange;\r\n  timeZone: TimeZone;\r\n  options: T;\r\n  onOptionsChange: (options: T) => void;\r\n  renderCounter: number;\r\n  transparent: boolean;\r\n  width: number;\r\n  height: number;\r\n  replaceVariables: InterpolateFunction;\r\n  onChangeTimeRange: (timeRange: AbsoluteTimeRange) => void;\r\n}\r\n\r\nexport interface PanelEditorProps<T = any> {\r\n  options: T;\r\n  onOptionsChange: (\r\n    options: T,\r\n    // callback can be used to run something right after update.\r\n    callback?: () => void\r\n  ) => void;\r\n  data: PanelData;\r\n}\r\n\r\nexport interface PanelModel<TOptions = any> {\r\n  id: number;\r\n  options: TOptions;\r\n  pluginVersion?: string;\r\n  scopedVars?: ScopedVars;\r\n}\r\n\r\n/**\r\n * Called when a panel is first loaded with current panel model\r\n */\r\nexport type PanelMigrationHandler<TOptions = any> = (panel: PanelModel<TOptions>) => Partial<TOptions>;\r\n\r\n/**\r\n * Called before a panel is initalized\r\n */\r\nexport type PanelTypeChangedHandler<TOptions = any> = (\r\n  options: Partial<TOptions>,\r\n  prevPluginId: string,\r\n  prevOptions: any\r\n) => Partial<TOptions>;\r\n\r\nexport class PanelPlugin<TOptions = any> extends GrafanaPlugin<PanelPluginMeta> {\r\n  panel: ComponentType<PanelProps<TOptions>>;\r\n  editor?: ComponentClass<PanelEditorProps<TOptions>>;\r\n  defaults?: TOptions;\r\n  onPanelMigration?: PanelMigrationHandler<TOptions>;\r\n  onPanelTypeChanged?: PanelTypeChangedHandler<TOptions>;\r\n  noPadding?: boolean;\r\n\r\n  /**\r\n   * Legacy angular ctrl.  If this exists it will be used instead of the panel\r\n   */\r\n  angularPanelCtrl?: any;\r\n\r\n  constructor(panel: ComponentType<PanelProps<TOptions>>) {\r\n    super();\r\n    this.panel = panel;\r\n  }\r\n\r\n  setEditor(editor: ComponentClass<PanelEditorProps<TOptions>>) {\r\n    this.editor = editor;\r\n    return this;\r\n  }\r\n\r\n  setDefaults(defaults: TOptions) {\r\n    this.defaults = defaults;\r\n    return this;\r\n  }\r\n\r\n  setNoPadding() {\r\n    this.noPadding = true;\r\n    return this;\r\n  }\r\n\r\n  /**\r\n   * This function is called before the panel first loads if\r\n   * the current version is different than the version that was saved.\r\n   *\r\n   * This is a good place to support any changes to the options model\r\n   */\r\n  setMigrationHandler(handler: PanelMigrationHandler) {\r\n    this.onPanelMigration = handler;\r\n    return this;\r\n  }\r\n\r\n  /**\r\n   * This function is called when the visualization was changed.  This\r\n   * passes in the options that were used in the previous visualization\r\n   */\r\n  setPanelChangeHandler(handler: PanelTypeChangedHandler) {\r\n    this.onPanelTypeChanged = handler;\r\n    return this;\r\n  }\r\n}\r\n\r\nexport interface PanelSize {\r\n  width: number;\r\n  height: number;\r\n}\r\n\r\nexport interface PanelMenuItem {\r\n  type?: 'submenu' | 'divider';\r\n  text?: string;\r\n  iconClassName?: string;\r\n  onClick?: (event: React.MouseEvent<any>) => void;\r\n  shortcut?: string;\r\n  subMenu?: PanelMenuItem[];\r\n}\r\n\r\nexport interface AngularPanelMenuItem {\r\n  click: Function;\r\n  icon: string;\r\n  href: string;\r\n  divider: boolean;\r\n  text: string;\r\n  shortcut: string;\r\n  submenu: any[];\r\n}\r\n\r\nexport enum VizOrientation {\r\n  Auto = 'auto',\r\n  Vertical = 'vertical',\r\n  Horizontal = 'horizontal',\r\n}\r\n","import { eventFactory } from './utils';\r\nimport { DataQueryError, DataQueryResponseData } from './datasource';\r\n\r\n/** Payloads */\r\nexport interface PanelChangeViewPayload {\r\n  fullscreen?: boolean;\r\n  edit?: boolean;\r\n  panelId?: number;\r\n  toggle?: boolean;\r\n}\r\n\r\nexport interface MenuElement {\r\n  text: string;\r\n  click: string;\r\n  role?: string;\r\n  shortcut?: string;\r\n}\r\n\r\n/** Events */\r\n\r\nexport const refresh = eventFactory('refresh');\r\nexport const componentDidMount = eventFactory('component-did-mount');\r\nexport const dataError = eventFactory<DataQueryError>('data-error');\r\nexport const dataReceived = eventFactory<DataQueryResponseData[]>('data-received');\r\nexport const dataSnapshotLoad = eventFactory<DataQueryResponseData[]>('data-snapshot-load');\r\nexport const editModeInitialized = eventFactory('init-edit-mode');\r\nexport const initPanelActions = eventFactory<MenuElement[]>('init-panel-actions');\r\nexport const panelChangeView = eventFactory<PanelChangeViewPayload>('panel-change-view');\r\nexport const panelInitialized = eventFactory('panel-initialized');\r\nexport const panelSizeChanged = eventFactory('panel-size-changed');\r\nexport const panelTeardown = eventFactory('panel-teardown');\r\nexport const render = eventFactory<any>('render');\r\nexport const viewModeChanged = eventFactory('view-mode-changed');\r\n","import { ComponentClass } from 'react';\r\nimport { KeyValue } from './data';\r\n\r\nexport enum PluginState {\r\n  alpha = 'alpha', // Only included it `enable_alpha` is true\r\n  beta = 'beta', // Will show a warning banner\r\n}\r\n\r\nexport enum PluginType {\r\n  panel = 'panel',\r\n  datasource = 'datasource',\r\n  app = 'app',\r\n  renderer = 'renderer',\r\n}\r\n\r\nexport interface PluginMeta<T extends KeyValue = {}> {\r\n  id: string;\r\n  name: string;\r\n  type: PluginType;\r\n  info: PluginMetaInfo;\r\n  includes?: PluginInclude[];\r\n  state?: PluginState;\r\n\r\n  // System.load & relative URLS\r\n  module: string;\r\n  baseUrl: string;\r\n\r\n  // Define plugin requirements\r\n  dependencies?: PluginDependencies;\r\n\r\n  // Filled in by the backend\r\n  jsonData?: T;\r\n  secureJsonData?: KeyValue;\r\n  enabled?: boolean;\r\n  defaultNavUrl?: string;\r\n  hasUpdate?: boolean;\r\n  latestVersion?: string;\r\n  pinned?: boolean;\r\n}\r\n\r\ninterface PluginDependencyInfo {\r\n  id: string;\r\n  name: string;\r\n  version: string;\r\n  type: PluginType;\r\n}\r\n\r\nexport interface PluginDependencies {\r\n  grafanaVersion: string;\r\n  plugins: PluginDependencyInfo[];\r\n}\r\n\r\nexport enum PluginIncludeType {\r\n  dashboard = 'dashboard',\r\n  page = 'page',\r\n\r\n  // Only valid for apps\r\n  panel = 'panel',\r\n  datasource = 'datasource',\r\n}\r\n\r\nexport interface PluginInclude {\r\n  type: PluginIncludeType;\r\n  name: string;\r\n  path?: string;\r\n  icon?: string;\r\n\r\n  role?: string; // \"Viewer\", Admin, editor???\r\n  addToNav?: boolean; // Show in the sidebar... only if type=page?\r\n\r\n  // Angular app pages\r\n  component?: string;\r\n}\r\n\r\ninterface PluginMetaInfoLink {\r\n  name: string;\r\n  url: string;\r\n}\r\n\r\nexport interface PluginBuildInfo {\r\n  time?: number;\r\n  repo?: string;\r\n  branch?: string;\r\n  hash?: string;\r\n  number?: number;\r\n  pr?: number;\r\n}\r\n\r\nexport interface ScreenshotInfo {\r\n  name: string;\r\n  path: string;\r\n}\r\n\r\nexport interface PluginMetaInfo {\r\n  author: {\r\n    name: string;\r\n    url?: string;\r\n  };\r\n  description: string;\r\n  links: PluginMetaInfoLink[];\r\n  logos: {\r\n    large: string;\r\n    small: string;\r\n  };\r\n  build?: PluginBuildInfo;\r\n  screenshots: ScreenshotInfo[];\r\n  updated: string;\r\n  version: string;\r\n}\r\n\r\nexport interface PluginConfigPageProps<T extends PluginMeta> {\r\n  plugin: GrafanaPlugin<T>;\r\n  query: KeyValue; // The URL query parameters\r\n}\r\n\r\nexport interface PluginConfigPage<T extends PluginMeta> {\r\n  title: string; // Display\r\n  icon?: string;\r\n  id: string; // Unique, in URL\r\n\r\n  body: ComponentClass<PluginConfigPageProps<T>>;\r\n}\r\n\r\nexport class GrafanaPlugin<T extends PluginMeta = PluginMeta> {\r\n  // Meta is filled in by the plugin loading system\r\n  meta?: T;\r\n\r\n  // This is set if the plugin system had errors loading the plugin\r\n  loadError?: boolean;\r\n\r\n  // Config control (app/datasource)\r\n  angularConfigCtrl?: any;\r\n\r\n  // Show configuration tabs on the plugin page\r\n  configPages?: Array<PluginConfigPage<T>>;\r\n\r\n  // Tabs on the plugin page\r\n  addConfigPage(tab: PluginConfigPage<T>) {\r\n    if (!this.configPages) {\r\n      this.configPages = [];\r\n    }\r\n    this.configPages.push(tab);\r\n    return this;\r\n  }\r\n}\r\n","export enum GrafanaThemeType {\r\n  Light = 'light',\r\n  Dark = 'dark',\r\n}\r\n\r\nexport interface GrafanaThemeCommons {\r\n  name: string;\r\n  // TODO: not sure if should be a part of theme\r\n  breakpoints: {\r\n    xs: string;\r\n    sm: string;\r\n    md: string;\r\n    lg: string;\r\n    xl: string;\r\n  };\r\n  typography: {\r\n    fontFamily: {\r\n      sansSerif: string;\r\n      monospace: string;\r\n    };\r\n    size: {\r\n      base: string;\r\n      xs: string;\r\n      sm: string;\r\n      md: string;\r\n      lg: string;\r\n    };\r\n    weight: {\r\n      light: number;\r\n      regular: number;\r\n      semibold: number;\r\n      bold: number;\r\n    };\r\n    lineHeight: {\r\n      xs: number; //1\r\n      sm: number; //1.1\r\n      md: number; // 4/3\r\n      lg: number; // 1.5\r\n    };\r\n    // TODO: Refactor to use size instead of custom defs\r\n    heading: {\r\n      h1: string;\r\n      h2: string;\r\n      h3: string;\r\n      h4: string;\r\n      h5: string;\r\n      h6: string;\r\n    };\r\n    link: {\r\n      decoration: string;\r\n      hoverDecoration: string;\r\n    };\r\n  };\r\n  spacing: {\r\n    insetSquishMd: string;\r\n    d: string;\r\n    xxs: string;\r\n    xs: string;\r\n    sm: string;\r\n    md: string;\r\n    lg: string;\r\n    xl: string;\r\n    gutter: string;\r\n\r\n    // Next-gen forms spacing variables\r\n    // TODO: Move variables definition to respective components when implementing\r\n    formSpacingBase: number;\r\n    formMargin: string;\r\n    formFieldsetMargin: string;\r\n    formLegendMargin: string;\r\n    formInputHeight: string;\r\n    formButtonHeight: number;\r\n    formInputPaddingHorizontal: string;\r\n    // Used for icons do define spacing between icon and input field\r\n    // Applied on the right(prefix) or left(suffix)\r\n    formInputAffixPaddingHorizontal: string;\r\n    formInputMargin: string;\r\n    formLabelPadding: string;\r\n    formLabelMargin: string;\r\n    formValidationMessagePadding: string;\r\n    formValidationMessageMargin: string;\r\n  };\r\n  border: {\r\n    radius: {\r\n      sm: string;\r\n      md: string;\r\n      lg: string;\r\n    };\r\n    width: {\r\n      sm: string;\r\n    };\r\n  };\r\n  height: {\r\n    sm: string;\r\n    md: string;\r\n    lg: string;\r\n  };\r\n  panelPadding: number;\r\n  panelHeaderHeight: number;\r\n  zIndex: {\r\n    dropdown: string;\r\n    navbarFixed: string;\r\n    sidemenu: string;\r\n    tooltip: string;\r\n    modalBackdrop: string;\r\n    modal: string;\r\n    typeahead: string;\r\n  };\r\n}\r\n\r\nexport interface GrafanaTheme extends GrafanaThemeCommons {\r\n  type: GrafanaThemeType;\r\n  isDark: boolean;\r\n  isLight: boolean;\r\n  background: {\r\n    dropdown: string;\r\n    scrollbar: string;\r\n    scrollbar2: string;\r\n    pageHeader: string;\r\n  };\r\n  colors: {\r\n    black: string;\r\n    white: string;\r\n    dark1: string;\r\n    dark2: string;\r\n    dark3: string;\r\n    dark4: string;\r\n    dark5: string;\r\n    dark6: string;\r\n    dark7: string;\r\n    dark8: string;\r\n    dark9: string;\r\n    dark10: string;\r\n    gray1: string;\r\n    gray2: string;\r\n    gray3: string;\r\n    gray4: string;\r\n    gray5: string;\r\n    gray6: string;\r\n    gray7: string;\r\n\r\n    // New greys palette used by next-gen form elements\r\n    gray98: string;\r\n    gray95: string;\r\n    gray85: string;\r\n    gray70: string;\r\n    gray33: string;\r\n    gray25: string;\r\n    gray15: string;\r\n    gray10: string;\r\n    gray05: string;\r\n\r\n    // New blues palette used by next-gen form elements\r\n    blue95: string;\r\n    blue85: string;\r\n    blue77: string;\r\n\r\n    // New reds palette used by next-gen form elements\r\n    red88: string;\r\n\r\n    grayBlue: string;\r\n    inputBlack: string;\r\n\r\n    // Accent colors\r\n    blue: string;\r\n    blueBase: string;\r\n    blueShade: string;\r\n    blueLight: string;\r\n    blueFaint: string;\r\n    redBase: string;\r\n    redShade: string;\r\n    greenBase: string;\r\n    greenShade: string;\r\n    red: string;\r\n    yellow: string;\r\n    purple: string;\r\n    variable: string;\r\n    orange: string;\r\n    orangeDark: string;\r\n    queryRed: string;\r\n    queryGreen: string;\r\n    queryPurple: string;\r\n    queryKeyword: string;\r\n    queryOrange: string;\r\n    brandPrimary: string;\r\n    brandSuccess: string;\r\n    brandWarning: string;\r\n    brandDanger: string;\r\n\r\n    // Status colors\r\n    online: string;\r\n    warn: string;\r\n    critical: string;\r\n\r\n    // Link colors\r\n    link: string;\r\n    linkDisabled: string;\r\n    linkHover: string;\r\n    linkExternal: string;\r\n\r\n    // Text colors\r\n    body: string;\r\n    text: string;\r\n    textStrong: string;\r\n    textWeak: string;\r\n    textFaint: string;\r\n    textEmphasis: string;\r\n\r\n    // panel\r\n    panelBg: string;\r\n\r\n    // TODO: move to background section\r\n    bodyBg: string;\r\n    pageBg: string;\r\n    headingColor: string;\r\n\r\n    pageHeaderBorder: string;\r\n\r\n    // Next-gen forms functional colors\r\n    formLabel: string;\r\n    formDescription: string;\r\n    formLegend: string;\r\n    formInputBg: string;\r\n    formInputBgDisabled: string;\r\n    formInputBorder: string;\r\n    formInputBorderHover: string;\r\n    formInputBorderActive: string;\r\n    formInputBorderInvalid: string;\r\n    formFocusOutline: string;\r\n    formInputText: string;\r\n    formInputDisabledText: string;\r\n    formInputTextStrong: string;\r\n    formInputTextWhite: string;\r\n    formValidationMessageText: string;\r\n    formValidationMessageBg: string;\r\n    formSwitchBg: string;\r\n    formSwitchBgActive: string;\r\n    formSwitchBgActiveHover: string;\r\n    formSwitchBgHover: string;\r\n    formSwitchBgDisabled: string;\r\n    formSwitchDot: string;\r\n    formCheckboxBg: string;\r\n    formCheckboxBgChecked: string;\r\n    formCheckboxBgCheckedHover: string;\r\n    formCheckboxCheckmark: string;\r\n  };\r\n  shadow: {\r\n    pageHeader: string;\r\n  };\r\n}\r\n","export interface Threshold {\r\n  value: number;\r\n  color: string;\r\n  state?: string; // Warning, Error, LowLow, Low, OK, High, HighHigh etc\r\n}\r\n\r\nexport enum ThresholdsMode {\r\n  Absolute = 'absolute',\r\n  Percentage = 'percentage', // between 0 and 1 (based on min/max)\r\n}\r\n\r\nexport interface ThresholdsConfig {\r\n  mode: ThresholdsMode;\r\n\r\n  // Must be sorted by 'value', first value is always -Infinity\r\n  steps: Threshold[];\r\n}\r\n","import { DateTime } from '../datetime/moment_wrapper';\r\n\r\nexport interface RawTimeRange {\r\n  from: DateTime | string;\r\n  to: DateTime | string;\r\n}\r\n\r\nexport interface TimeRange {\r\n  from: DateTime;\r\n  to: DateTime;\r\n  raw: RawTimeRange;\r\n}\r\n\r\nexport interface AbsoluteTimeRange {\r\n  from: number;\r\n  to: number;\r\n}\r\n\r\nexport interface IntervalValues {\r\n  interval: string; // 10s,5m\r\n  intervalMs: number;\r\n}\r\n\r\nexport type TimeZoneUtc = 'utc';\r\nexport type TimeZoneBrowser = 'browser';\r\nexport type TimeZone = TimeZoneBrowser | TimeZoneUtc | string;\r\n\r\nexport const DefaultTimeZone: TimeZone = 'browser';\r\n\r\nexport interface TimeOption {\r\n  from: string;\r\n  to: string;\r\n  display: string;\r\n  section: number;\r\n}\r\n\r\nexport interface TimeOptions {\r\n  [key: string]: TimeOption[];\r\n}\r\n\r\nexport type TimeFragment = string | DateTime;\r\n\r\nexport const TIME_FORMAT = 'YYYY-MM-DD HH:mm:ss';\r\n\r\nexport const DefaultTimeRange: TimeRange = {\r\n  from: {} as DateTime,\r\n  to: {} as DateTime,\r\n  raw: { from: '6h', to: 'now' },\r\n};\r\n","import { AppEvent } from './appEvents';\r\n\r\nexport type Omit<T, K> = Pick<T, Exclude<keyof T, K>>;\r\nexport type Subtract<T, K> = Omit<T, keyof K>;\r\n\r\nconst typeList: Set<string> = new Set();\r\nexport function eventFactory<T = undefined>(name: string): AppEvent<T> {\r\n  if (typeList.has(name)) {\r\n    throw new Error(`There is already an event defined with type '${name}'`);\r\n  }\r\n\r\n  typeList.add(name);\r\n  return { name };\r\n}\r\n","export enum MappingType {\r\n  ValueToText = 1,\r\n  RangeToText = 2,\r\n}\r\n\r\ninterface BaseMap {\r\n  id: number;\r\n  operator: string;\r\n  text: string;\r\n  type: MappingType;\r\n}\r\n\r\nexport type ValueMapping = ValueMap | RangeMap;\r\n\r\nexport interface ValueMap extends BaseMap {\r\n  value: string;\r\n}\r\n\r\nexport interface RangeMap extends BaseMap {\r\n  from: string;\r\n  to: string;\r\n}\r\n","import { SelectableValue } from '../types/select';\r\n\r\nexport interface RegistryItem {\r\n  id: string; // Unique Key -- saved in configs\r\n  name: string; // Display Name, can change without breaking configs\r\n  description: string;\r\n  aliasIds?: string[]; // when the ID changes, we may want backwards compatibility ('current' => 'last')\r\n\r\n  /**\r\n   * Some extensions should not be user selectable\r\n   *  like: 'all' and 'any' matchers;\r\n   */\r\n  excludeFromPicker?: boolean;\r\n}\r\n\r\nexport interface RegistryItemWithOptions<TOptions = any> extends RegistryItem {\r\n  /**\r\n   * Convert the options to a string\r\n   */\r\n  getOptionsDisplayText?: (options: TOptions) => string;\r\n\r\n  /**\r\n   * Default options used if nothing else is specified\r\n   */\r\n  defaultOptions?: TOptions;\r\n}\r\n\r\ninterface RegistrySelectInfo {\r\n  options: Array<SelectableValue<string>>;\r\n  current: Array<SelectableValue<string>>;\r\n}\r\n\r\nexport class Registry<T extends RegistryItem> {\r\n  private ordered: T[] = [];\r\n  private byId = new Map<string, T>();\r\n  private initalized = false;\r\n\r\n  constructor(private init?: () => T[]) {}\r\n\r\n  getIfExists(id: string | undefined): T | undefined {\r\n    if (!this.initalized) {\r\n      if (this.init) {\r\n        for (const ext of this.init()) {\r\n          this.register(ext);\r\n        }\r\n      }\r\n      this.sort();\r\n      this.initalized = true;\r\n    }\r\n    if (id) {\r\n      return this.byId.get(id);\r\n    }\r\n    return undefined;\r\n  }\r\n\r\n  get(id: string): T {\r\n    const v = this.getIfExists(id);\r\n    if (!v) {\r\n      throw new Error('Undefined: ' + id);\r\n    }\r\n    return v;\r\n  }\r\n\r\n  selectOptions(current?: string[], filter?: (ext: T) => boolean): RegistrySelectInfo {\r\n    if (!this.initalized) {\r\n      this.getIfExists('xxx'); // will trigger init\r\n    }\r\n\r\n    const select = {\r\n      options: [],\r\n      current: [],\r\n    } as RegistrySelectInfo;\r\n\r\n    const currentIds: any = {};\r\n    if (current) {\r\n      for (const id of current) {\r\n        currentIds[id] = true;\r\n      }\r\n    }\r\n\r\n    for (const ext of this.ordered) {\r\n      if (ext.excludeFromPicker) {\r\n        continue;\r\n      }\r\n      if (filter && !filter(ext)) {\r\n        continue;\r\n      }\r\n\r\n      const option = {\r\n        value: ext.id,\r\n        label: ext.name,\r\n        description: ext.description,\r\n      };\r\n\r\n      select.options.push(option);\r\n      if (currentIds[ext.id]) {\r\n        select.current.push(option);\r\n      }\r\n    }\r\n    return select;\r\n  }\r\n\r\n  /**\r\n   * Return a list of values by ID, or all values if not specified\r\n   */\r\n  list(ids?: any[]): T[] {\r\n    if (ids) {\r\n      const found: T[] = [];\r\n      for (const id of ids) {\r\n        const v = this.getIfExists(id);\r\n        if (v) {\r\n          found.push(v);\r\n        }\r\n      }\r\n      return found;\r\n    }\r\n    if (!this.initalized) {\r\n      this.getIfExists('xxx'); // will trigger init\r\n    }\r\n    return [...this.ordered]; // copy of everythign just in case\r\n  }\r\n\r\n  register(ext: T) {\r\n    if (this.byId.has(ext.id)) {\r\n      throw new Error('Duplicate Key:' + ext.id);\r\n    }\r\n    this.byId.set(ext.id, ext);\r\n    this.ordered.push(ext);\r\n\r\n    if (ext.aliasIds) {\r\n      for (const alias of ext.aliasIds) {\r\n        if (!this.byId.has(alias)) {\r\n          this.byId.set(alias, ext);\r\n        }\r\n      }\r\n    }\r\n\r\n    if (this.initalized) {\r\n      this.sort();\r\n    }\r\n  }\r\n\r\n  private sort() {\r\n    // TODO sort the list\r\n  }\r\n}\r\n","// Libraries\r\nimport Papa, { ParseResult, ParseConfig, Parser } from 'papaparse';\r\nimport defaults from 'lodash/defaults';\r\nimport isNumber from 'lodash/isNumber';\r\n\r\n// Types\r\nimport { DataFrame, Field, FieldType, FieldConfig } from '../types';\r\nimport { guessFieldTypeFromValue } from '../dataframe/processDataFrame';\r\nimport { MutableDataFrame } from '../dataframe/MutableDataFrame';\r\n\r\nexport enum CSVHeaderStyle {\r\n  full,\r\n  name,\r\n  none,\r\n}\r\n\r\n// Subset of all parse options\r\nexport interface CSVConfig {\r\n  delimiter?: string; // default: \",\"\r\n  newline?: string; // default: \"\\r\\n\"\r\n  quoteChar?: string; // default: '\"'\r\n  encoding?: string; // default: \"\",\r\n  headerStyle?: CSVHeaderStyle;\r\n}\r\n\r\nexport interface CSVParseCallbacks {\r\n  /**\r\n   * Get a callback before any rows are processed\r\n   * This can return a modified table to force any\r\n   * Column configurations\r\n   */\r\n  onHeader: (fields: Field[]) => void;\r\n\r\n  // Called after each row is read\r\n  onRow: (row: any[]) => void;\r\n}\r\n\r\nexport interface CSVOptions {\r\n  config?: CSVConfig;\r\n  callback?: CSVParseCallbacks;\r\n}\r\n\r\nexport function readCSV(csv: string, options?: CSVOptions): DataFrame[] {\r\n  return new CSVReader(options).readCSV(csv);\r\n}\r\n\r\nenum ParseState {\r\n  Starting,\r\n  InHeader,\r\n  ReadingRows,\r\n}\r\n\r\nexport class CSVReader {\r\n  config: CSVConfig;\r\n  callback?: CSVParseCallbacks;\r\n\r\n  state: ParseState;\r\n  data: MutableDataFrame[];\r\n  current: MutableDataFrame;\r\n\r\n  constructor(options?: CSVOptions) {\r\n    if (!options) {\r\n      options = {};\r\n    }\r\n    this.config = options.config || {};\r\n    this.callback = options.callback;\r\n\r\n    this.current = new MutableDataFrame({ fields: [] });\r\n    this.state = ParseState.Starting;\r\n    this.data = [];\r\n  }\r\n\r\n  // PapaParse callback on each line\r\n  private step = (results: ParseResult, parser: Parser): void => {\r\n    for (let i = 0; i < results.data.length; i++) {\r\n      const line: string[] = results.data[i];\r\n      if (line.length < 1) {\r\n        continue;\r\n      }\r\n      const first = line[0]; // null or value, papaparse does not return ''\r\n      if (first) {\r\n        // Comment or header queue\r\n        if (first.startsWith('#')) {\r\n          // Look for special header column\r\n          // #{columkey}#a,b,c\r\n          const idx = first.indexOf('#', 2);\r\n          if (idx > 0) {\r\n            const k = first.substr(1, idx - 1);\r\n            const isName = 'name' === k;\r\n\r\n            // Simple object used to check if headers match\r\n            const headerKeys: FieldConfig = {\r\n              unit: '#',\r\n            };\r\n\r\n            // Check if it is a known/supported column\r\n            if (isName || headerKeys.hasOwnProperty(k)) {\r\n              // Starting a new table after reading rows\r\n              if (this.state === ParseState.ReadingRows) {\r\n                this.current = new MutableDataFrame({ fields: [] });\r\n                this.data.push(this.current);\r\n              }\r\n\r\n              const v = first.substr(idx + 1);\r\n              if (isName) {\r\n                this.current.addFieldFor(undefined, v);\r\n                for (let j = 1; j < line.length; j++) {\r\n                  this.current.addFieldFor(undefined, line[j]);\r\n                }\r\n              } else {\r\n                const { fields } = this.current;\r\n                for (let j = 0; j < fields.length; j++) {\r\n                  if (!fields[j].config) {\r\n                    fields[j].config = {};\r\n                  }\r\n                  const disp = fields[j].config as any; // any lets name lookup\r\n                  disp[k] = j === 0 ? v : line[j];\r\n                }\r\n              }\r\n\r\n              this.state = ParseState.InHeader;\r\n              continue;\r\n            }\r\n          } else if (this.state === ParseState.Starting) {\r\n            this.state = ParseState.InHeader;\r\n            continue;\r\n          }\r\n          // Ignore comment lines\r\n          continue;\r\n        }\r\n\r\n        if (this.state === ParseState.Starting) {\r\n          const type = guessFieldTypeFromValue(first);\r\n          if (type === FieldType.string) {\r\n            for (const s of line) {\r\n              this.current.addFieldFor(undefined, s);\r\n            }\r\n            this.state = ParseState.InHeader;\r\n            continue;\r\n          }\r\n          this.state = ParseState.InHeader; // fall through to read rows\r\n        }\r\n      }\r\n\r\n      // Add the current results to the data\r\n      if (this.state !== ParseState.ReadingRows) {\r\n        // anything???\r\n      }\r\n\r\n      this.state = ParseState.ReadingRows;\r\n\r\n      // Make sure colum structure is valid\r\n      if (line.length > this.current.fields.length) {\r\n        const { fields } = this.current;\r\n        for (let f = fields.length; f < line.length; f++) {\r\n          this.current.addFieldFor(line[f]);\r\n        }\r\n        if (this.callback) {\r\n          this.callback.onHeader(this.current.fields);\r\n        }\r\n      }\r\n\r\n      this.current.appendRow(line);\r\n      if (this.callback) {\r\n        // // Send the header after we guess the type\r\n        // if (this.series.rows.length === 0) {\r\n        //   this.callback.onHeader(this.series);\r\n        // }\r\n        this.callback.onRow(line);\r\n      }\r\n    }\r\n  };\r\n\r\n  readCSV(text: string): MutableDataFrame[] {\r\n    this.current = new MutableDataFrame({ fields: [] });\r\n    this.data = [this.current];\r\n\r\n    const papacfg = {\r\n      ...this.config,\r\n      dynamicTyping: false,\r\n      skipEmptyLines: true,\r\n      comments: false, // Keep comment lines\r\n      step: this.step,\r\n    } as ParseConfig;\r\n\r\n    Papa.parse(text, papacfg);\r\n\r\n    return this.data;\r\n  }\r\n}\r\n\r\ntype FieldWriter = (value: any) => string;\r\n\r\nfunction writeValue(value: any, config: CSVConfig): string {\r\n  const str = value.toString();\r\n  if (str.includes('\"')) {\r\n    // Escape the double quote characters\r\n    return config.quoteChar + str.replace(/\"/gi, '\"\"') + config.quoteChar;\r\n  }\r\n  if (str.includes('\\n') || str.includes(config.delimiter)) {\r\n    return config.quoteChar + str + config.quoteChar;\r\n  }\r\n  return str;\r\n}\r\n\r\nfunction makeFieldWriter(field: Field, config: CSVConfig): FieldWriter {\r\n  if (field.type) {\r\n    if (field.type === FieldType.boolean) {\r\n      return (value: any) => {\r\n        return value ? 'true' : 'false';\r\n      };\r\n    }\r\n\r\n    if (field.type === FieldType.number) {\r\n      return (value: any) => {\r\n        if (isNumber(value)) {\r\n          return value.toString();\r\n        }\r\n        return writeValue(value, config);\r\n      };\r\n    }\r\n  }\r\n\r\n  return (value: any) => writeValue(value, config);\r\n}\r\n\r\nfunction getHeaderLine(key: string, fields: Field[], config: CSVConfig): string {\r\n  const isName = 'name' === key;\r\n  const isType = 'type' === key;\r\n\r\n  for (const f of fields) {\r\n    const display = f.config;\r\n    if (isName || isType || (display && display.hasOwnProperty(key))) {\r\n      let line = '#' + key + '#';\r\n      for (let i = 0; i < fields.length; i++) {\r\n        if (i > 0) {\r\n          line = line + config.delimiter;\r\n        }\r\n\r\n        let v: any = fields[i].name;\r\n        if (isType) {\r\n          v = fields[i].type;\r\n        } else if (isName) {\r\n          // already name\r\n        } else {\r\n          v = (fields[i].config as any)[key];\r\n        }\r\n        if (v) {\r\n          line = line + writeValue(v, config);\r\n        }\r\n      }\r\n      return line + config.newline;\r\n    }\r\n  }\r\n  return '';\r\n}\r\n\r\nexport function toCSV(data: DataFrame[], config?: CSVConfig): string {\r\n  if (!data) {\r\n    return '';\r\n  }\r\n\r\n  let csv = '';\r\n  config = defaults(config, {\r\n    delimiter: ',',\r\n    newline: '\\r\\n',\r\n    quoteChar: '\"',\r\n    encoding: '',\r\n    headerStyle: CSVHeaderStyle.name,\r\n  });\r\n\r\n  for (const series of data) {\r\n    const { fields } = series;\r\n\r\n    // ignore frames with no fields\r\n    if (fields.length === 0) {\r\n      continue;\r\n    }\r\n\r\n    if (config.headerStyle === CSVHeaderStyle.full) {\r\n      csv =\r\n        csv +\r\n        getHeaderLine('name', fields, config) +\r\n        getHeaderLine('type', fields, config) +\r\n        getHeaderLine('unit', fields, config) +\r\n        getHeaderLine('dateFormat', fields, config);\r\n    } else if (config.headerStyle === CSVHeaderStyle.name) {\r\n      for (let i = 0; i < fields.length; i++) {\r\n        if (i > 0) {\r\n          csv += config.delimiter;\r\n        }\r\n        csv += fields[i].name;\r\n      }\r\n      csv += config.newline;\r\n    }\r\n\r\n    const length = fields[0].values.length;\r\n\r\n    if (length > 0) {\r\n      const writers = fields.map(field => makeFieldWriter(field, config!));\r\n      for (let i = 0; i < length; i++) {\r\n        for (let j = 0; j < fields.length; j++) {\r\n          if (j > 0) {\r\n            csv = csv + config.delimiter;\r\n          }\r\n\r\n          const v = fields[j].values.get(i);\r\n          if (v !== null) {\r\n            csv = csv + writers[j](v);\r\n          }\r\n        }\r\n        csv = csv + config.newline;\r\n      }\r\n    }\r\n    csv = csv + config.newline;\r\n  }\r\n\r\n  return csv;\r\n}\r\n","import { DataSourcePluginOptionsEditorProps, SelectableValue, KeyValue, DataSourceSettings } from '../types';\r\n\r\nexport const onUpdateDatasourceOption = (props: DataSourcePluginOptionsEditorProps, key: keyof DataSourceSettings) => (\r\n  event: React.SyntheticEvent<HTMLInputElement | HTMLSelectElement>\r\n) => {\r\n  updateDatasourcePluginOption(props, key, event.currentTarget.value);\r\n};\r\n\r\nexport const onUpdateDatasourceJsonDataOption = <J, S, K extends keyof J>(\r\n  props: DataSourcePluginOptionsEditorProps<J, S>,\r\n  key: K\r\n) => (event: React.SyntheticEvent<HTMLInputElement | HTMLSelectElement>) => {\r\n  updateDatasourcePluginJsonDataOption(props, key, event.currentTarget.value);\r\n};\r\n\r\nexport const onUpdateDatasourceSecureJsonDataOption = <J, S extends {} = KeyValue>(\r\n  props: DataSourcePluginOptionsEditorProps<J, S>,\r\n  key: string\r\n) => (event: React.SyntheticEvent<HTMLInputElement | HTMLSelectElement>) => {\r\n  updateDatasourcePluginSecureJsonDataOption(props, key, event.currentTarget.value);\r\n};\r\n\r\nexport const onUpdateDatasourceJsonDataOptionSelect = <J, S, K extends keyof J>(\r\n  props: DataSourcePluginOptionsEditorProps<J, S>,\r\n  key: K\r\n) => (selected: SelectableValue) => {\r\n  updateDatasourcePluginJsonDataOption(props, key, selected.value);\r\n};\r\n\r\nexport const onUpdateDatasourceSecureJsonDataOptionSelect = <J, S extends {} = KeyValue>(\r\n  props: DataSourcePluginOptionsEditorProps<J, S>,\r\n  key: string\r\n) => (selected: SelectableValue) => {\r\n  updateDatasourcePluginSecureJsonDataOption(props, key, selected.value);\r\n};\r\n\r\nexport const onUpdateDatasourceResetOption = (props: DataSourcePluginOptionsEditorProps, key: string) => (\r\n  event: React.MouseEvent<HTMLButtonElement, MouseEvent>\r\n) => {\r\n  updateDatasourcePluginResetOption(props, key);\r\n};\r\n\r\nexport function updateDatasourcePluginOption(\r\n  props: DataSourcePluginOptionsEditorProps,\r\n  key: keyof DataSourceSettings,\r\n  val: any\r\n) {\r\n  const config = props.options;\r\n\r\n  props.onOptionsChange({\r\n    ...config,\r\n    [key]: val,\r\n  });\r\n}\r\n\r\nexport const updateDatasourcePluginJsonDataOption = <J, S, K extends keyof J>(\r\n  props: DataSourcePluginOptionsEditorProps<J, S>,\r\n  key: K,\r\n  val: any\r\n) => {\r\n  const config = props.options;\r\n\r\n  props.onOptionsChange({\r\n    ...config,\r\n    jsonData: {\r\n      ...config.jsonData,\r\n      [key]: val,\r\n    },\r\n  });\r\n};\r\n\r\nexport const updateDatasourcePluginSecureJsonDataOption = <J, S extends {} = KeyValue>(\r\n  props: DataSourcePluginOptionsEditorProps<J, S>,\r\n  key: string,\r\n  val: any\r\n) => {\r\n  const config = props.options;\r\n\r\n  props.onOptionsChange({\r\n    ...config,\r\n    secureJsonData: {\r\n      ...config.secureJsonData!,\r\n      [key]: val,\r\n    },\r\n  });\r\n};\r\n\r\nexport function updateDatasourcePluginResetOption(props: DataSourcePluginOptionsEditorProps, key: string) {\r\n  const config = props.options;\r\n\r\n  props.onOptionsChange({\r\n    ...config,\r\n    secureJsonData: {\r\n      ...config.secureJsonData,\r\n      [key]: '',\r\n    },\r\n    secureJsonFields: {\r\n      ...config.secureJsonFields,\r\n      [key]: false,\r\n    },\r\n  });\r\n}\r\n","import { KeyValue } from '../types';\r\n\r\n// Avoid writing the warning message more than once every 10s\r\nconst history: KeyValue<number> = {};\r\n\r\nexport const deprecationWarning = (file: string, oldName: string, newName?: string) => {\r\n  let message = `[Deprecation warning] ${file}: ${oldName} is deprecated`;\r\n  if (newName) {\r\n    message += `.  Use ${newName} instead`;\r\n  }\r\n  const now = Date.now();\r\n  const last = history[message];\r\n  if (!last || now - last > 10000) {\r\n    console.warn(message);\r\n    history[message] = now;\r\n  }\r\n};\r\n","import { Field, FieldType } from '../types/dataFrame';\nimport { guessFieldTypeFromValue } from '../dataframe/processDataFrame';\n\nexport function makeFieldParser(value: any, field: Field): (value: string) => any {\n  if (!field.type) {\n    if (field.name === 'time' || field.name === 'Time') {\n      field.type = FieldType.time;\n    } else {\n      field.type = guessFieldTypeFromValue(value);\n    }\n  }\n\n  if (field.type === FieldType.number) {\n    return (value: string) => {\n      return parseFloat(value);\n    };\n  }\n\n  // Will convert anything that starts with \"T\" to true\n  if (field.type === FieldType.boolean) {\n    return (value: string) => {\n      return !(value[0] === 'F' || value[0] === 'f' || value[0] === '0');\n    };\n  }\n\n  // Just pass the string back\n  return (value: string) => value;\n}\n","import { Field } from '../types/dataFrame';\nimport { NullValueMode } from '../types/data';\nimport { GraphSeriesValue } from '../types/graph';\nimport { TimeRange } from '../types/time';\n\n// Types\n// import { NullValueMode, GraphSeriesValue, Field, TimeRange } from '@grafana/data';\nexport interface FlotPairsOptions {\n  xField: Field;\n  yField: Field;\n  nullValueMode?: NullValueMode;\n}\n\nexport function getFlotPairs({ xField, yField, nullValueMode }: FlotPairsOptions): GraphSeriesValue[][] {\n  const vX = xField.values;\n  const vY = yField.values;\n  const length = vX.length;\n  if (vY.length !== length) {\n    throw new Error('Unexpected field length');\n  }\n\n  const ignoreNulls = nullValueMode === NullValueMode.Ignore;\n  const nullAsZero = nullValueMode === NullValueMode.AsZero;\n\n  const pairs: any[][] = [];\n\n  for (let i = 0; i < length; i++) {\n    const x = vX.get(i);\n    let y = vY.get(i);\n\n    if (y === null) {\n      if (ignoreNulls) {\n        continue;\n      }\n      if (nullAsZero) {\n        y = 0;\n      }\n    }\n\n    // X must be a value\n    if (x === null) {\n      continue;\n    }\n\n    pairs.push([x, y]);\n  }\n  return pairs;\n}\n\n/**\n * Returns a constant series based on the first value from the provide series.\n * @param seriesData Series\n * @param range Start and end time for the constant series\n */\nexport function getFlotPairsConstant(seriesData: GraphSeriesValue[][], range: TimeRange): GraphSeriesValue[][] {\n  if (!range.from || !range.to || !seriesData || seriesData.length === 0) {\n    return [];\n  }\n\n  const from = range.from.valueOf();\n  const to = range.to.valueOf();\n  const value = seriesData[0][1];\n  return [\n    [from, value],\n    [to, value],\n  ];\n}\n","export * from './Registry';\r\nexport * from './datasource';\r\nexport * from './deprecationWarning';\r\nexport * from './csv';\r\nexport * from './logs';\r\nexport * from './labels';\r\nexport * from './labels';\r\nexport * from './object';\r\nexport * from './namedColorsPalette';\r\nexport * from './series';\r\n\r\nexport { getMappedValue } from './valueMappings';\r\nexport { getFlotPairs, getFlotPairsConstant } from './flotPairs';\r\n","import { Labels } from '../types/data';\r\n\r\n/**\r\n * Regexp to extract Prometheus-style labels\r\n */\r\nconst labelRegexp = /\\b(\\w+)(!?=~?)\"([^\"\\n]*?)\"/g;\r\n\r\n/**\r\n * Returns a map of label keys to value from an input selector string.\r\n *\r\n * Example: `parseLabels('{job=\"foo\", instance=\"bar\"}) // {job: \"foo\", instance: \"bar\"}`\r\n */\r\nexport function parseLabels(labels: string): Labels {\r\n  const labelsByKey: Labels = {};\r\n  labels.replace(labelRegexp, (_, key, operator, value) => {\r\n    labelsByKey[key] = value;\r\n    return '';\r\n  });\r\n  return labelsByKey;\r\n}\r\n\r\n/**\r\n * Returns a map labels that are common to the given label sets.\r\n */\r\nexport function findCommonLabels(labelsSets: Labels[]): Labels {\r\n  return labelsSets.reduce((acc, labels) => {\r\n    if (!labels) {\r\n      throw new Error('Need parsed labels to find common labels.');\r\n    }\r\n    if (!acc) {\r\n      // Initial set\r\n      acc = { ...labels };\r\n    } else {\r\n      // Remove incoming labels that are missing or not matching in value\r\n      Object.keys(labels).forEach(key => {\r\n        if (acc[key] === undefined || acc[key] !== labels[key]) {\r\n          delete acc[key];\r\n        }\r\n      });\r\n      // Remove common labels that are missing from incoming label set\r\n      Object.keys(acc).forEach(key => {\r\n        if (labels[key] === undefined) {\r\n          delete acc[key];\r\n        }\r\n      });\r\n    }\r\n    return acc;\r\n  }, (undefined as unknown) as Labels);\r\n}\r\n\r\n/**\r\n * Returns a map of labels that are in `labels`, but not in `commonLabels`.\r\n */\r\nexport function findUniqueLabels(labels: Labels, commonLabels: Labels): Labels {\r\n  const uncommonLabels: Labels = { ...labels };\r\n  Object.keys(commonLabels).forEach(key => {\r\n    delete uncommonLabels[key];\r\n  });\r\n  return uncommonLabels;\r\n}\r\n\r\n/**\r\n * Serializes the given labels to a string.\r\n */\r\nexport function formatLabels(labels: Labels, defaultValue = ''): string {\r\n  if (!labels || Object.keys(labels).length === 0) {\r\n    return defaultValue;\r\n  }\r\n  const labelKeys = Object.keys(labels).sort();\r\n  const cleanSelector = labelKeys.map(key => `${key}=\"${labels[key]}\"`).join(', ');\r\n  return ['{', cleanSelector, '}'].join('');\r\n}\r\n","import { countBy, chain, escapeRegExp } from 'lodash';\r\n\r\nimport { LogLevel, LogRowModel, LogLabelStatsModel, LogsParser } from '../types/logs';\r\nimport { DataFrame, FieldType } from '../types/index';\r\nimport { ArrayVector } from '../vector/ArrayVector';\r\n\r\n// This matches:\r\n// first a label from start of the string or first white space, then any word chars until \"=\"\r\n// second either an empty quotes, or anything that starts with quote and ends with unescaped quote,\r\n// or any non whitespace chars that do not start with qoute\r\nconst LOGFMT_REGEXP = /(?:^|\\s)([\\w\\(\\)\\[\\]\\{\\}]+)=(\"\"|(?:\".*?[^\\\\]\"|[^\"\\s]\\S*))/;\r\n\r\n/**\r\n * Returns the log level of a log line.\r\n * Parse the line for level words. If no level is found, it returns `LogLevel.unknown`.\r\n *\r\n * Example: `getLogLevel('WARN 1999-12-31 this is great') // LogLevel.warn`\r\n */\r\nexport function getLogLevel(line: string): LogLevel {\r\n  if (!line) {\r\n    return LogLevel.unknown;\r\n  }\r\n  for (const key of Object.keys(LogLevel)) {\r\n    const regexp = new RegExp(`\\\\b${key}\\\\b`, 'i');\r\n    if (regexp.test(line)) {\r\n      const level = (LogLevel as any)[key];\r\n      if (level) {\r\n        return level;\r\n      }\r\n    }\r\n  }\r\n  return LogLevel.unknown;\r\n}\r\n\r\nexport function getLogLevelFromKey(key: string): LogLevel {\r\n  const level = (LogLevel as any)[key.toLowerCase()];\r\n  if (level) {\r\n    return level;\r\n  }\r\n\r\n  return LogLevel.unknown;\r\n}\r\n\r\nexport function addLogLevelToSeries(series: DataFrame, lineIndex: number): DataFrame {\r\n  const levels = new ArrayVector<LogLevel>();\r\n  const lines = series.fields[lineIndex];\r\n  for (let i = 0; i < lines.values.length; i++) {\r\n    const line = lines.values.get(lineIndex);\r\n    levels.buffer.push(getLogLevel(line));\r\n  }\r\n\r\n  return {\r\n    ...series, // Keeps Tags, RefID etc\r\n    fields: [\r\n      ...series.fields,\r\n      {\r\n        name: 'LogLevel',\r\n        type: FieldType.string,\r\n        values: levels,\r\n        config: {},\r\n      },\r\n    ],\r\n  };\r\n}\r\n\r\nexport const LogsParsers: { [name: string]: LogsParser } = {\r\n  JSON: {\r\n    buildMatcher: label => new RegExp(`(?:{|,)\\\\s*\"${label}\"\\\\s*:\\\\s*\"?([\\\\d\\\\.]+|[^\"]*)\"?`),\r\n    getFields: line => {\r\n      try {\r\n        const parsed = JSON.parse(line);\r\n        return Object.keys(parsed).map(key => {\r\n          return `\"${key}\":${JSON.stringify(parsed[key])}`;\r\n        });\r\n      } catch {}\r\n      return [];\r\n    },\r\n    getLabelFromField: field => (field.match(/^\"([^\"]+)\"\\s*:/) || [])[1],\r\n    getValueFromField: field => (field.match(/:\\s*(.*)$/) || [])[1],\r\n    test: line => {\r\n      try {\r\n        return JSON.parse(line);\r\n      } catch (error) {}\r\n    },\r\n  },\r\n\r\n  logfmt: {\r\n    buildMatcher: label => new RegExp(`(?:^|\\\\s)${escapeRegExp(label)}=(\"[^\"]*\"|\\\\S+)`),\r\n    getFields: line => {\r\n      const fields: string[] = [];\r\n      line.replace(new RegExp(LOGFMT_REGEXP, 'g'), substring => {\r\n        fields.push(substring.trim());\r\n        return '';\r\n      });\r\n      return fields;\r\n    },\r\n    getLabelFromField: field => (field.match(LOGFMT_REGEXP) || [])[1],\r\n    getValueFromField: field => (field.match(LOGFMT_REGEXP) || [])[2],\r\n    test: line => LOGFMT_REGEXP.test(line),\r\n  },\r\n};\r\n\r\nexport function calculateFieldStats(rows: LogRowModel[], extractor: RegExp): LogLabelStatsModel[] {\r\n  // Consider only rows that satisfy the matcher\r\n  const rowsWithField = rows.filter(row => extractor.test(row.entry));\r\n  const rowCount = rowsWithField.length;\r\n\r\n  // Get field value counts for eligible rows\r\n  const countsByValue = countBy(rowsWithField, r => {\r\n    const row: LogRowModel = r;\r\n    const match = row.entry.match(extractor);\r\n\r\n    return match ? match[1] : null;\r\n  });\r\n  return getSortedCounts(countsByValue, rowCount);\r\n}\r\n\r\nexport function calculateLogsLabelStats(rows: LogRowModel[], label: string): LogLabelStatsModel[] {\r\n  // Consider only rows that have the given label\r\n  const rowsWithLabel = rows.filter(row => row.labels[label] !== undefined);\r\n  const rowCount = rowsWithLabel.length;\r\n\r\n  // Get label value counts for eligible rows\r\n  const countsByValue = countBy(rowsWithLabel, row => (row as LogRowModel).labels[label]);\r\n  return getSortedCounts(countsByValue, rowCount);\r\n}\r\n\r\nexport function calculateStats(values: any[]): LogLabelStatsModel[] {\r\n  const nonEmptyValues = values.filter(value => value !== undefined && value !== null);\r\n  const countsByValue = countBy(nonEmptyValues);\r\n  return getSortedCounts(countsByValue, nonEmptyValues.length);\r\n}\r\n\r\nconst getSortedCounts = (countsByValue: { [value: string]: number }, rowCount: number) => {\r\n  return chain(countsByValue)\r\n    .map((count, value) => ({ count, value, proportion: count / rowCount }))\r\n    .sortBy('count')\r\n    .reverse()\r\n    .value();\r\n};\r\n\r\nexport function getParser(line: string): LogsParser | undefined {\r\n  let parser;\r\n  try {\r\n    if (LogsParsers.JSON.test(line)) {\r\n      parser = LogsParsers.JSON;\r\n    }\r\n  } catch (error) {}\r\n\r\n  if (!parser && LogsParsers.logfmt.test(line)) {\r\n    parser = LogsParsers.logfmt;\r\n  }\r\n\r\n  return parser;\r\n}\r\n","import flatten from 'lodash/flatten';\r\nimport tinycolor from 'tinycolor2';\r\nimport { GrafanaThemeType } from '../types/theme';\r\n\r\ntype Hue = 'green' | 'yellow' | 'red' | 'blue' | 'orange' | 'purple';\r\n\r\nexport type Color =\r\n  | 'green'\r\n  | 'dark-green'\r\n  | 'semi-dark-green'\r\n  | 'light-green'\r\n  | 'super-light-green'\r\n  | 'yellow'\r\n  | 'dark-yellow'\r\n  | 'semi-dark-yellow'\r\n  | 'light-yellow'\r\n  | 'super-light-yellow'\r\n  | 'red'\r\n  | 'dark-red'\r\n  | 'semi-dark-red'\r\n  | 'light-red'\r\n  | 'super-light-red'\r\n  | 'blue'\r\n  | 'dark-blue'\r\n  | 'semi-dark-blue'\r\n  | 'light-blue'\r\n  | 'super-light-blue'\r\n  | 'orange'\r\n  | 'dark-orange'\r\n  | 'semi-dark-orange'\r\n  | 'light-orange'\r\n  | 'super-light-orange'\r\n  | 'purple'\r\n  | 'dark-purple'\r\n  | 'semi-dark-purple'\r\n  | 'light-purple'\r\n  | 'super-light-purple';\r\n\r\ntype ThemeVariants = {\r\n  dark: string;\r\n  light: string;\r\n};\r\n\r\nexport type ColorDefinition = {\r\n  hue: Hue;\r\n  isPrimary?: boolean;\r\n  name: Color;\r\n  variants: ThemeVariants;\r\n};\r\n\r\nlet colorsPaletteInstance: Map<Hue, ColorDefinition[]>;\r\n\r\nconst buildColorDefinition = (\r\n  hue: Hue,\r\n  name: Color,\r\n  [light, dark]: string[],\r\n  isPrimary?: boolean\r\n): ColorDefinition => ({\r\n  hue,\r\n  name,\r\n  variants: {\r\n    light,\r\n    dark,\r\n  },\r\n  isPrimary: !!isPrimary,\r\n});\r\n\r\nexport const getColorDefinitionByName = (name: Color): ColorDefinition => {\r\n  return flatten(Array.from(getNamedColorPalette().values())).filter(definition => definition.name === name)[0];\r\n};\r\n\r\nexport const getColorDefinition = (hex: string, theme: GrafanaThemeType): ColorDefinition | undefined => {\r\n  return flatten(Array.from(getNamedColorPalette().values())).filter(\r\n    definition => definition.variants[theme] === hex\r\n  )[0];\r\n};\r\n\r\nconst isHex = (color: string) => {\r\n  const hexRegex = /^((0x){0,1}|#{0,1})([0-9A-F]{8}|[0-9A-F]{6}|[0-9A-F]{3})$/gi;\r\n  return hexRegex.test(color);\r\n};\r\n\r\nexport const getColorName = (color?: string, theme?: GrafanaThemeType): Color | undefined => {\r\n  if (!color) {\r\n    return undefined;\r\n  }\r\n\r\n  if (color.indexOf('rgb') > -1) {\r\n    return undefined;\r\n  }\r\n  if (isHex(color)) {\r\n    const definition = getColorDefinition(color, theme || GrafanaThemeType.Dark);\r\n    return definition ? definition.name : undefined;\r\n  }\r\n\r\n  return color as Color;\r\n};\r\n\r\nexport const getColorByName = (colorName: string) => {\r\n  const definition = flatten(Array.from(getNamedColorPalette().values())).filter(\r\n    definition => definition.name === colorName\r\n  );\r\n  return definition.length > 0 ? definition[0] : undefined;\r\n};\r\n\r\nexport const getColorFromHexRgbOrName = (color: string, theme?: GrafanaThemeType): string => {\r\n  if (color.indexOf('rgb') > -1 || isHex(color)) {\r\n    return color;\r\n  }\r\n\r\n  const colorDefinition = getColorByName(color);\r\n\r\n  if (!colorDefinition) {\r\n    return new tinycolor(color).toHexString();\r\n  }\r\n\r\n  return theme ? colorDefinition.variants[theme] : colorDefinition.variants.dark;\r\n};\r\n\r\nexport const getColorForTheme = (color: ColorDefinition, theme?: GrafanaThemeType) => {\r\n  return theme ? color.variants[theme] : color.variants.dark;\r\n};\r\n\r\nconst buildNamedColorsPalette = () => {\r\n  const palette = new Map<Hue, ColorDefinition[]>();\r\n\r\n  const BasicGreen = buildColorDefinition('green', 'green', ['#56A64B', '#73BF69'], true);\r\n  const DarkGreen = buildColorDefinition('green', 'dark-green', ['#19730E', '#37872D']);\r\n  const SemiDarkGreen = buildColorDefinition('green', 'semi-dark-green', ['#37872D', '#56A64B']);\r\n  const LightGreen = buildColorDefinition('green', 'light-green', ['#73BF69', '#96D98D']);\r\n  const SuperLightGreen = buildColorDefinition('green', 'super-light-green', ['#96D98D', '#C8F2C2']);\r\n\r\n  const BasicYellow = buildColorDefinition('yellow', 'yellow', ['#F2CC0C', '#FADE2A'], true);\r\n  const DarkYellow = buildColorDefinition('yellow', 'dark-yellow', ['#CC9D00', '#E0B400']);\r\n  const SemiDarkYellow = buildColorDefinition('yellow', 'semi-dark-yellow', ['#E0B400', '#F2CC0C']);\r\n  const LightYellow = buildColorDefinition('yellow', 'light-yellow', ['#FADE2A', '#FFEE52']);\r\n  const SuperLightYellow = buildColorDefinition('yellow', 'super-light-yellow', ['#FFEE52', '#FFF899']);\r\n\r\n  const BasicRed = buildColorDefinition('red', 'red', ['#E02F44', '#F2495C'], true);\r\n  const DarkRed = buildColorDefinition('red', 'dark-red', ['#AD0317', '#C4162A']);\r\n  const SemiDarkRed = buildColorDefinition('red', 'semi-dark-red', ['#C4162A', '#E02F44']);\r\n  const LightRed = buildColorDefinition('red', 'light-red', ['#F2495C', '#FF7383']);\r\n  const SuperLightRed = buildColorDefinition('red', 'super-light-red', ['#FF7383', '#FFA6B0']);\r\n\r\n  const BasicBlue = buildColorDefinition('blue', 'blue', ['#3274D9', '#5794F2'], true);\r\n  const DarkBlue = buildColorDefinition('blue', 'dark-blue', ['#1250B0', '#1F60C4']);\r\n  const SemiDarkBlue = buildColorDefinition('blue', 'semi-dark-blue', ['#1F60C4', '#3274D9']);\r\n  const LightBlue = buildColorDefinition('blue', 'light-blue', ['#5794F2', '#8AB8FF']);\r\n  const SuperLightBlue = buildColorDefinition('blue', 'super-light-blue', ['#8AB8FF', '#C0D8FF']);\r\n\r\n  const BasicOrange = buildColorDefinition('orange', 'orange', ['#FF780A', '#FF9830'], true);\r\n  const DarkOrange = buildColorDefinition('orange', 'dark-orange', ['#E55400', '#FA6400']);\r\n  const SemiDarkOrange = buildColorDefinition('orange', 'semi-dark-orange', ['#FA6400', '#FF780A']);\r\n  const LightOrange = buildColorDefinition('orange', 'light-orange', ['#FF9830', '#FFB357']);\r\n  const SuperLightOrange = buildColorDefinition('orange', 'super-light-orange', ['#FFB357', '#FFCB7D']);\r\n\r\n  const BasicPurple = buildColorDefinition('purple', 'purple', ['#A352CC', '#B877D9'], true);\r\n  const DarkPurple = buildColorDefinition('purple', 'dark-purple', ['#7C2EA3', '#8F3BB8']);\r\n  const SemiDarkPurple = buildColorDefinition('purple', 'semi-dark-purple', ['#8F3BB8', '#A352CC']);\r\n  const LightPurple = buildColorDefinition('purple', 'light-purple', ['#B877D9', '#CA95E5']);\r\n  const SuperLightPurple = buildColorDefinition('purple', 'super-light-purple', ['#CA95E5', '#DEB6F2']);\r\n\r\n  const greens = [BasicGreen, DarkGreen, SemiDarkGreen, LightGreen, SuperLightGreen];\r\n  const yellows = [BasicYellow, DarkYellow, SemiDarkYellow, LightYellow, SuperLightYellow];\r\n  const reds = [BasicRed, DarkRed, SemiDarkRed, LightRed, SuperLightRed];\r\n  const blues = [BasicBlue, DarkBlue, SemiDarkBlue, LightBlue, SuperLightBlue];\r\n  const oranges = [BasicOrange, DarkOrange, SemiDarkOrange, LightOrange, SuperLightOrange];\r\n  const purples = [BasicPurple, DarkPurple, SemiDarkPurple, LightPurple, SuperLightPurple];\r\n\r\n  palette.set('green', greens);\r\n  palette.set('yellow', yellows);\r\n  palette.set('red', reds);\r\n  palette.set('blue', blues);\r\n  palette.set('orange', oranges);\r\n  palette.set('purple', purples);\r\n\r\n  return palette;\r\n};\r\n\r\nexport const getNamedColorPalette = () => {\r\n  if (colorsPaletteInstance) {\r\n    return colorsPaletteInstance;\r\n  }\r\n\r\n  colorsPaletteInstance = buildNamedColorsPalette();\r\n  return colorsPaletteInstance;\r\n};\r\n","export const objRemoveUndefined = (obj: any) => {\n  return Object.keys(obj).reduce((acc: any, key) => {\n    if (obj[key] !== undefined) {\n      acc[key] = obj[key];\n    }\n    return acc;\n  }, {});\n};\n","import { Field } from '../types/dataFrame';\r\n\r\n/**\r\n * Returns minimal time step from series time field\r\n * @param timeField\r\n */\r\nexport const getSeriesTimeStep = (timeField: Field) => {\r\n  let previousTime;\r\n  let minTimeStep;\r\n\r\n  for (let i = 0; i < timeField.values.length; i++) {\r\n    const currentTime = timeField.values.get(i);\r\n\r\n    if (previousTime !== undefined) {\r\n      const timeStep = currentTime - previousTime;\r\n\r\n      if (minTimeStep === undefined) {\r\n        minTimeStep = timeStep;\r\n      }\r\n\r\n      if (timeStep < minTimeStep) {\r\n        minTimeStep = timeStep;\r\n      }\r\n    }\r\n    previousTime = currentTime;\r\n  }\r\n  return minTimeStep;\r\n};\r\n\r\n/**\r\n * Checks if series time field has ms resolution\r\n * @param timeField\r\n */\r\nexport const hasMsResolution = (timeField: Field) => {\r\n  for (let i = 0; i < timeField.values.length; i++) {\r\n    const value = timeField.values.get(i);\r\n    if (value !== null && value !== undefined) {\r\n      const timestamp = value.toString();\r\n      if (timestamp.length === 13 && timestamp % 1000 !== 0) {\r\n        return true;\r\n      }\r\n    }\r\n  }\r\n  return false;\r\n};\r\n","import { ValueMapping, MappingType, ValueMap, RangeMap } from '../types';\r\n\r\ntype TimeSeriesValue = string | number | null;\r\n\r\nconst addValueToTextMappingText = (\r\n  allValueMappings: ValueMapping[],\r\n  valueToTextMapping: ValueMap,\r\n  value: TimeSeriesValue\r\n) => {\r\n  if (valueToTextMapping.value === undefined) {\r\n    return allValueMappings;\r\n  }\r\n\r\n  if (value === null && isNullValueMap(valueToTextMapping)) {\r\n    return allValueMappings.concat(valueToTextMapping);\r\n  }\r\n\r\n  const valueAsNumber = parseFloat(value as string);\r\n  const valueToTextMappingAsNumber = parseFloat(valueToTextMapping.value as string);\r\n\r\n  if (isNaN(valueAsNumber) || isNaN(valueToTextMappingAsNumber)) {\r\n    return allValueMappings;\r\n  }\r\n\r\n  if (valueAsNumber !== valueToTextMappingAsNumber) {\r\n    return allValueMappings;\r\n  }\r\n\r\n  return allValueMappings.concat(valueToTextMapping);\r\n};\r\n\r\nconst addRangeToTextMappingText = (\r\n  allValueMappings: ValueMapping[],\r\n  rangeToTextMapping: RangeMap,\r\n  value: TimeSeriesValue\r\n) => {\r\n  if (rangeToTextMapping.from === undefined || rangeToTextMapping.to === undefined || value === undefined) {\r\n    return allValueMappings;\r\n  }\r\n\r\n  if (\r\n    value === null &&\r\n    rangeToTextMapping.from &&\r\n    rangeToTextMapping.to &&\r\n    rangeToTextMapping.from.toLowerCase() === 'null' &&\r\n    rangeToTextMapping.to.toLowerCase() === 'null'\r\n  ) {\r\n    return allValueMappings.concat(rangeToTextMapping);\r\n  }\r\n\r\n  const valueAsNumber = parseFloat(value as string);\r\n  const fromAsNumber = parseFloat(rangeToTextMapping.from as string);\r\n  const toAsNumber = parseFloat(rangeToTextMapping.to as string);\r\n\r\n  if (isNaN(valueAsNumber) || isNaN(fromAsNumber) || isNaN(toAsNumber)) {\r\n    return allValueMappings;\r\n  }\r\n\r\n  if (valueAsNumber >= fromAsNumber && valueAsNumber <= toAsNumber) {\r\n    return allValueMappings.concat(rangeToTextMapping);\r\n  }\r\n\r\n  return allValueMappings;\r\n};\r\n\r\nconst getAllFormattedValueMappings = (valueMappings: ValueMapping[], value: TimeSeriesValue) => {\r\n  const allFormattedValueMappings = valueMappings.reduce((allValueMappings, valueMapping) => {\r\n    if (valueMapping.type === MappingType.ValueToText) {\r\n      allValueMappings = addValueToTextMappingText(allValueMappings, valueMapping as ValueMap, value);\r\n    } else if (valueMapping.type === MappingType.RangeToText) {\r\n      allValueMappings = addRangeToTextMappingText(allValueMappings, valueMapping as RangeMap, value);\r\n    }\r\n\r\n    return allValueMappings;\r\n  }, [] as ValueMapping[]);\r\n\r\n  allFormattedValueMappings.sort((t1, t2) => {\r\n    return t1.id - t2.id;\r\n  });\r\n\r\n  return allFormattedValueMappings;\r\n};\r\n\r\nexport const getMappedValue = (valueMappings: ValueMapping[], value: TimeSeriesValue): ValueMapping => {\r\n  return getAllFormattedValueMappings(valueMappings, value)[0];\r\n};\r\n\r\nconst isNullValueMap = (mapping: ValueMap): boolean => {\r\n  if (!mapping || !mapping.value) {\r\n    return false;\r\n  }\r\n  return mapping.value.toLowerCase() === 'null';\r\n};\r\n","import { toFixed, FormattedValue } from './valueFormats';\r\nimport { DecimalCount } from '../types/displayValue';\r\n\r\nexport function toPercent(size: number, decimals: DecimalCount): FormattedValue {\r\n  if (size === null) {\r\n    return { text: '' };\r\n  }\r\n  return { text: toFixed(size, decimals), suffix: '%' };\r\n}\r\n\r\nexport function toPercentUnit(size: number, decimals: DecimalCount): FormattedValue {\r\n  if (size === null) {\r\n    return { text: '' };\r\n  }\r\n  return { text: toFixed(100 * size, decimals), suffix: '%' };\r\n}\r\n\r\nexport function toHex0x(value: number, decimals: DecimalCount): FormattedValue {\r\n  if (value == null) {\r\n    return { text: '' };\r\n  }\r\n  const asHex = toHex(value, decimals);\r\n  if (asHex.text.substring(0, 1) === '-') {\r\n    asHex.text = '-0x' + asHex.text.substring(1);\r\n  } else {\r\n    asHex.text = '0x' + asHex.text;\r\n  }\r\n  return asHex;\r\n}\r\n\r\nexport function toHex(value: number, decimals: DecimalCount): FormattedValue {\r\n  if (value == null) {\r\n    return { text: '' };\r\n  }\r\n  return {\r\n    text: parseFloat(toFixed(value, decimals))\r\n      .toString(16)\r\n      .toUpperCase(),\r\n  };\r\n}\r\n\r\nexport function sci(value: number, decimals: DecimalCount): FormattedValue {\r\n  if (value == null) {\r\n    return { text: '' };\r\n  }\r\n  return { text: value.toExponential(decimals as number) };\r\n}\r\n","import { locale, scaledUnits, simpleCountUnit, toFixedUnit, ValueFormatCategory } from './valueFormats';\r\nimport {\r\n  dateTimeAsIso,\r\n  dateTimeAsUS,\r\n  dateTimeFromNow,\r\n  toClockMilliseconds,\r\n  toClockSeconds,\r\n  toDays,\r\n  toDurationInHoursMinutesSeconds,\r\n  toDurationInMilliseconds,\r\n  toDurationInSeconds,\r\n  toHours,\r\n  toMicroSeconds,\r\n  toMilliSeconds,\r\n  toMinutes,\r\n  toNanoSeconds,\r\n  toSeconds,\r\n  toTimeTicks,\r\n} from './dateTimeFormatters';\r\nimport { toHex, sci, toHex0x, toPercent, toPercentUnit } from './arithmeticFormatters';\r\nimport { binarySIPrefix, currency, decimalSIPrefix } from './symbolFormatters';\r\n\r\nexport const getCategories = (): ValueFormatCategory[] => [\r\n  {\r\n    name: 'Misc',\r\n    formats: [\r\n      { name: 'none', id: 'none', fn: toFixedUnit('') },\r\n      {\r\n        name: 'short',\r\n        id: 'short',\r\n        fn: scaledUnits(1000, ['', ' K', ' Mil', ' Bil', ' Tri', ' Quadr', ' Quint', ' Sext', ' Sept']),\r\n      },\r\n      { name: 'percent (0-100)', id: 'percent', fn: toPercent },\r\n      { name: 'percent (0.0-1.0)', id: 'percentunit', fn: toPercentUnit },\r\n      { name: 'Humidity (%H)', id: 'humidity', fn: toFixedUnit('%H') },\r\n      { name: 'decibel', id: 'dB', fn: toFixedUnit('dB') },\r\n      { name: 'hexadecimal (0x)', id: 'hex0x', fn: toHex0x },\r\n      { name: 'hexadecimal', id: 'hex', fn: toHex },\r\n      { name: 'scientific notation', id: 'sci', fn: sci },\r\n      { name: 'locale format', id: 'locale', fn: locale },\r\n      { name: 'Pixels', id: 'pixel', fn: toFixedUnit('px') },\r\n    ],\r\n  },\r\n  {\r\n    name: 'Acceleration',\r\n    formats: [\r\n      { name: 'Meters/sec', id: 'accMS2', fn: toFixedUnit('m/sec') },\r\n      { name: 'Feet/sec', id: 'accFS2', fn: toFixedUnit('f/sec') },\r\n      { name: 'G unit', id: 'accG', fn: toFixedUnit('g') },\r\n    ],\r\n  },\r\n  {\r\n    name: 'Angle',\r\n    formats: [\r\n      { name: 'Degrees ()', id: 'degree', fn: toFixedUnit('') },\r\n      { name: 'Radians', id: 'radian', fn: toFixedUnit('rad') },\r\n      { name: 'Gradian', id: 'grad', fn: toFixedUnit('grad') },\r\n      { name: 'Arc Minutes', id: 'arcmin', fn: toFixedUnit('arcmin') },\r\n      { name: 'Arc Seconds', id: 'arcsec', fn: toFixedUnit('arcsec') },\r\n    ],\r\n  },\r\n  {\r\n    name: 'Area',\r\n    formats: [\r\n      { name: 'Square Meters (m)', id: 'areaM2', fn: toFixedUnit('m') },\r\n      { name: 'Square Feet (ft)', id: 'areaF2', fn: toFixedUnit('ft') },\r\n      { name: 'Square Miles (mi)', id: 'areaMI2', fn: toFixedUnit('mi') },\r\n    ],\r\n  },\r\n  {\r\n    name: 'Computation',\r\n    formats: [\r\n      { name: 'FLOP/s', id: 'flops', fn: decimalSIPrefix('FLOP/s') },\r\n      { name: 'MFLOP/s', id: 'mflops', fn: decimalSIPrefix('FLOP/s', 2) },\r\n      { name: 'GFLOP/s', id: 'gflops', fn: decimalSIPrefix('FLOP/s', 3) },\r\n      { name: 'TFLOP/s', id: 'tflops', fn: decimalSIPrefix('FLOP/s', 4) },\r\n      { name: 'PFLOP/s', id: 'pflops', fn: decimalSIPrefix('FLOP/s', 5) },\r\n      { name: 'EFLOP/s', id: 'eflops', fn: decimalSIPrefix('FLOP/s', 6) },\r\n      { name: 'ZFLOP/s', id: 'zflops', fn: decimalSIPrefix('FLOP/s', 7) },\r\n      { name: 'YFLOP/s', id: 'yflops', fn: decimalSIPrefix('FLOP/s', 8) },\r\n    ],\r\n  },\r\n  {\r\n    name: 'Concentration',\r\n    formats: [\r\n      { name: 'parts-per-million (ppm)', id: 'ppm', fn: toFixedUnit('ppm') },\r\n      { name: 'parts-per-billion (ppb)', id: 'conppb', fn: toFixedUnit('ppb') },\r\n      { name: 'nanogram per cubic meter (ng/m)', id: 'conngm3', fn: toFixedUnit('ng/m') },\r\n      { name: 'nanogram per normal cubic meter (ng/Nm)', id: 'conngNm3', fn: toFixedUnit('ng/Nm') },\r\n      { name: 'microgram per cubic meter (g/m)', id: 'congm3', fn: toFixedUnit('g/m') },\r\n      { name: 'microgram per normal cubic meter (g/Nm)', id: 'congNm3', fn: toFixedUnit('g/Nm') },\r\n      { name: 'milligram per cubic meter (mg/m)', id: 'conmgm3', fn: toFixedUnit('mg/m') },\r\n      { name: 'milligram per normal cubic meter (mg/Nm)', id: 'conmgNm3', fn: toFixedUnit('mg/Nm') },\r\n      { name: 'gram per cubic meter (g/m)', id: 'congm3', fn: toFixedUnit('g/m') },\r\n      { name: 'gram per normal cubic meter (g/Nm)', id: 'congNm3', fn: toFixedUnit('g/Nm') },\r\n      { name: 'milligrams per decilitre (mg/dL)', id: 'conmgdL', fn: toFixedUnit('mg/dL') },\r\n      { name: 'millimoles per litre (mmol/L)', id: 'conmmolL', fn: toFixedUnit('mmol/L') },\r\n    ],\r\n  },\r\n  {\r\n    name: 'Currency',\r\n    formats: [\r\n      { name: 'Dollars ($)', id: 'currencyUSD', fn: currency('$') },\r\n      { name: 'Pounds ()', id: 'currencyGBP', fn: currency('') },\r\n      { name: 'Euro ()', id: 'currencyEUR', fn: currency('') },\r\n      { name: 'Yen ()', id: 'currencyJPY', fn: currency('') },\r\n      { name: 'Rubles ()', id: 'currencyRUB', fn: currency('') },\r\n      { name: 'Hryvnias ()', id: 'currencyUAH', fn: currency('') },\r\n      { name: 'Real (R$)', id: 'currencyBRL', fn: currency('R$') },\r\n      { name: 'Danish Krone (kr)', id: 'currencyDKK', fn: currency('kr', true) },\r\n      { name: 'Icelandic Krna (kr)', id: 'currencyISK', fn: currency('kr', true) },\r\n      { name: 'Norwegian Krone (kr)', id: 'currencyNOK', fn: currency('kr', true) },\r\n      { name: 'Swedish Krona (kr)', id: 'currencySEK', fn: currency('kr', true) },\r\n      { name: 'Czech koruna (czk)', id: 'currencyCZK', fn: currency('czk') },\r\n      { name: 'Swiss franc (CHF)', id: 'currencyCHF', fn: currency('CHF') },\r\n      { name: 'Polish Zoty (PLN)', id: 'currencyPLN', fn: currency('PLN') },\r\n      { name: 'Bitcoin ()', id: 'currencyBTC', fn: currency('') },\r\n      { name: 'South African Rand (R)', id: 'currencyZAR', fn: currency('R') },\r\n      { name: 'Indian Rupee ()', id: 'currencyINR', fn: currency('') },\r\n      { name: 'South Korean Won ()', id: 'currencyKRW', fn: currency('') },\r\n    ],\r\n  },\r\n  {\r\n    name: 'Data (IEC)',\r\n    formats: [\r\n      { name: 'bits', id: 'bits', fn: binarySIPrefix('b') },\r\n      { name: 'bytes', id: 'bytes', fn: binarySIPrefix('B') },\r\n      { name: 'kibibytes', id: 'kbytes', fn: binarySIPrefix('B', 1) },\r\n      { name: 'mebibytes', id: 'mbytes', fn: binarySIPrefix('B', 2) },\r\n      { name: 'gibibytes', id: 'gbytes', fn: binarySIPrefix('B', 3) },\r\n      { name: 'tebibytes', id: 'tbytes', fn: binarySIPrefix('B', 4) },\r\n      { name: 'pebibytes', id: 'pbytes', fn: binarySIPrefix('B', 5) },\r\n    ],\r\n  },\r\n  {\r\n    name: 'Data (Metric)',\r\n    formats: [\r\n      { name: 'bits', id: 'decbits', fn: decimalSIPrefix('b') },\r\n      { name: 'bytes', id: 'decbytes', fn: decimalSIPrefix('B') },\r\n      { name: 'kilobytes', id: 'deckbytes', fn: decimalSIPrefix('B', 1) },\r\n      { name: 'megabytes', id: 'decmbytes', fn: decimalSIPrefix('B', 2) },\r\n      { name: 'gigabytes', id: 'decgbytes', fn: decimalSIPrefix('B', 3) },\r\n      { name: 'terabytes', id: 'dectbytes', fn: decimalSIPrefix('B', 4) },\r\n      { name: 'petabytes', id: 'decpbytes', fn: decimalSIPrefix('B', 5) },\r\n    ],\r\n  },\r\n  {\r\n    name: 'Data Rate',\r\n    formats: [\r\n      { name: 'packets/sec', id: 'pps', fn: decimalSIPrefix('pps') },\r\n      { name: 'bits/sec', id: 'bps', fn: decimalSIPrefix('bps') },\r\n      { name: 'bytes/sec', id: 'Bps', fn: decimalSIPrefix('Bs') },\r\n      { name: 'kilobytes/sec', id: 'KBs', fn: decimalSIPrefix('Bs', 1) },\r\n      { name: 'kilobits/sec', id: 'Kbits', fn: decimalSIPrefix('bps', 1) },\r\n      { name: 'megabytes/sec', id: 'MBs', fn: decimalSIPrefix('Bs', 2) },\r\n      { name: 'megabits/sec', id: 'Mbits', fn: decimalSIPrefix('bps', 2) },\r\n      { name: 'gigabytes/sec', id: 'GBs', fn: decimalSIPrefix('Bs', 3) },\r\n      { name: 'gigabits/sec', id: 'Gbits', fn: decimalSIPrefix('bps', 3) },\r\n      { name: 'terabytes/sec', id: 'TBs', fn: decimalSIPrefix('Bs', 4) },\r\n      { name: 'terabits/sec', id: 'Tbits', fn: decimalSIPrefix('bps', 4) },\r\n      { name: 'petabytes/sec', id: 'PBs', fn: decimalSIPrefix('Bs', 5) },\r\n      { name: 'petabits/sec', id: 'Pbits', fn: decimalSIPrefix('bps', 5) },\r\n    ],\r\n  },\r\n  {\r\n    name: 'Date & Time',\r\n    formats: [\r\n      { name: 'YYYY-MM-DD HH:mm:ss', id: 'dateTimeAsIso', fn: dateTimeAsIso },\r\n      { name: 'MM/DD/YYYY h:mm:ss a', id: 'dateTimeAsUS', fn: dateTimeAsUS },\r\n      { name: 'From Now', id: 'dateTimeFromNow', fn: dateTimeFromNow },\r\n    ],\r\n  },\r\n  {\r\n    name: 'Energy',\r\n    formats: [\r\n      { name: 'Watt (W)', id: 'watt', fn: decimalSIPrefix('W') },\r\n      { name: 'Kilowatt (kW)', id: 'kwatt', fn: decimalSIPrefix('W', 1) },\r\n      { name: 'Megawatt (MW)', id: 'megwatt', fn: decimalSIPrefix('W', 2) },\r\n      { name: 'Gigawatt (GW)', id: 'gwatt', fn: decimalSIPrefix('W', 3) },\r\n      { name: 'Milliwatt (mW)', id: 'mwatt', fn: decimalSIPrefix('W', -1) },\r\n      { name: 'Watt per square meter (W/m)', id: 'Wm2', fn: toFixedUnit('W/m') },\r\n      { name: 'Volt-ampere (VA)', id: 'voltamp', fn: decimalSIPrefix('VA') },\r\n      { name: 'Kilovolt-ampere (kVA)', id: 'kvoltamp', fn: decimalSIPrefix('VA', 1) },\r\n      { name: 'Volt-ampere reactive (var)', id: 'voltampreact', fn: decimalSIPrefix('var') },\r\n      { name: 'Kilovolt-ampere reactive (kvar)', id: 'kvoltampreact', fn: decimalSIPrefix('var', 1) },\r\n      { name: 'Watt-hour (Wh)', id: 'watth', fn: decimalSIPrefix('Wh') },\r\n      { name: 'Watt-hour per Kilogram (Wh/kg)', id: 'watthperkg', fn: decimalSIPrefix('Wh/kg') },\r\n      { name: 'Kilowatt-hour (kWh)', id: 'kwatth', fn: decimalSIPrefix('Wh', 1) },\r\n      { name: 'Kilowatt-min (kWm)', id: 'kwattm', fn: decimalSIPrefix('W-Min', 1) },\r\n      { name: 'Ampere-hour (Ah)', id: 'amph', fn: decimalSIPrefix('Ah') },\r\n      { name: 'Kiloampere-hour (kAh)', id: 'kamph', fn: decimalSIPrefix('Ah', 1) },\r\n      { name: 'Milliampere-hour (mAh)', id: 'mamph', fn: decimalSIPrefix('Ah', -1) },\r\n      { name: 'Joule (J)', id: 'joule', fn: decimalSIPrefix('J') },\r\n      { name: 'Electron volt (eV)', id: 'ev', fn: decimalSIPrefix('eV') },\r\n      { name: 'Ampere (A)', id: 'amp', fn: decimalSIPrefix('A') },\r\n      { name: 'Kiloampere (kA)', id: 'kamp', fn: decimalSIPrefix('A', 1) },\r\n      { name: 'Milliampere (mA)', id: 'mamp', fn: decimalSIPrefix('A', -1) },\r\n      { name: 'Volt (V)', id: 'volt', fn: decimalSIPrefix('V') },\r\n      { name: 'Kilovolt (kV)', id: 'kvolt', fn: decimalSIPrefix('V', 1) },\r\n      { name: 'Millivolt (mV)', id: 'mvolt', fn: decimalSIPrefix('V', -1) },\r\n      { name: 'Decibel-milliwatt (dBm)', id: 'dBm', fn: decimalSIPrefix('dBm') },\r\n      { name: 'Ohm ()', id: 'ohm', fn: decimalSIPrefix('') },\r\n      { name: 'Kiloohm (k)', id: 'kohm', fn: decimalSIPrefix('', 1) },\r\n      { name: 'Megaohm (M)', id: 'Mohm', fn: decimalSIPrefix('', 2) },\r\n      { name: 'Farad (F)', id: 'farad', fn: decimalSIPrefix('F') },\r\n      { name: 'Microfarad (F)', id: 'farad', fn: decimalSIPrefix('F', -2) },\r\n      { name: 'Nanofarad (nF)', id: 'nfarad', fn: decimalSIPrefix('F', -3) },\r\n      { name: 'Picofarad (pF)', id: 'pfarad', fn: decimalSIPrefix('F', -4) },\r\n      { name: 'Femtofarad (fF)', id: 'ffarad', fn: decimalSIPrefix('F', -5) },\r\n      { name: 'Henry (H)', id: 'henry', fn: decimalSIPrefix('H') },\r\n      { name: 'Millihenry (mH)', id: 'mhenry', fn: decimalSIPrefix('H', -1) },\r\n      { name: 'Microhenry (H)', id: 'henry', fn: decimalSIPrefix('H', -2) },\r\n      { name: 'Lumens (Lm)', id: 'lumens', fn: decimalSIPrefix('Lm') },\r\n    ],\r\n  },\r\n  {\r\n    name: 'Flow',\r\n    formats: [\r\n      { name: 'Gallons/min (gpm)', id: 'flowgpm', fn: toFixedUnit('gpm') },\r\n      { name: 'Cubic meters/sec (cms)', id: 'flowcms', fn: toFixedUnit('cms') },\r\n      { name: 'Cubic feet/sec (cfs)', id: 'flowcfs', fn: toFixedUnit('cfs') },\r\n      { name: 'Cubic feet/min (cfm)', id: 'flowcfm', fn: toFixedUnit('cfm') },\r\n      { name: 'Litre/hour', id: 'litreh', fn: toFixedUnit('L/h') },\r\n      { name: 'Litre/min (L/min)', id: 'flowlpm', fn: toFixedUnit('L/min') },\r\n      { name: 'milliLitre/min (mL/min)', id: 'flowmlpm', fn: toFixedUnit('mL/min') },\r\n      { name: 'Lux (lx)', id: 'lux', fn: toFixedUnit('lux') },\r\n    ],\r\n  },\r\n  {\r\n    name: 'Force',\r\n    formats: [\r\n      { name: 'Newton-meters (Nm)', id: 'forceNm', fn: decimalSIPrefix('Nm') },\r\n      { name: 'Kilonewton-meters (kNm)', id: 'forcekNm', fn: decimalSIPrefix('Nm', 1) },\r\n      { name: 'Newtons (N)', id: 'forceN', fn: decimalSIPrefix('N') },\r\n      { name: 'Kilonewtons (kN)', id: 'forcekN', fn: decimalSIPrefix('N', 1) },\r\n    ],\r\n  },\r\n  {\r\n    name: 'Hash Rate',\r\n    formats: [\r\n      { name: 'hashes/sec', id: 'Hs', fn: decimalSIPrefix('H/s') },\r\n      { name: 'kilohashes/sec', id: 'KHs', fn: decimalSIPrefix('H/s', 1) },\r\n      { name: 'megahashes/sec', id: 'MHs', fn: decimalSIPrefix('H/s', 2) },\r\n      { name: 'gigahashes/sec', id: 'GHs', fn: decimalSIPrefix('H/s', 3) },\r\n      { name: 'terahashes/sec', id: 'THs', fn: decimalSIPrefix('H/s', 4) },\r\n      { name: 'petahashes/sec', id: 'PHs', fn: decimalSIPrefix('H/s', 5) },\r\n      { name: 'exahashes/sec', id: 'EHs', fn: decimalSIPrefix('H/s', 6) },\r\n    ],\r\n  },\r\n  {\r\n    name: 'Mass',\r\n    formats: [\r\n      { name: 'milligram (mg)', id: 'massmg', fn: decimalSIPrefix('g', -1) },\r\n      { name: 'gram (g)', id: 'massg', fn: decimalSIPrefix('g') },\r\n      { name: 'kilogram (kg)', id: 'masskg', fn: decimalSIPrefix('g', 1) },\r\n      { name: 'metric ton (t)', id: 'masst', fn: toFixedUnit('t') },\r\n    ],\r\n  },\r\n  {\r\n    name: 'length',\r\n    formats: [\r\n      { name: 'millimeter (mm)', id: 'lengthmm', fn: decimalSIPrefix('m', -1) },\r\n      { name: 'feet (ft)', id: 'lengthft', fn: toFixedUnit('ft') },\r\n      { name: 'meter (m)', id: 'lengthm', fn: decimalSIPrefix('m') },\r\n      { name: 'kilometer (km)', id: 'lengthkm', fn: decimalSIPrefix('m', 1) },\r\n      { name: 'mile (mi)', id: 'lengthmi', fn: toFixedUnit('mi') },\r\n    ],\r\n  },\r\n  {\r\n    name: 'Pressure',\r\n    formats: [\r\n      { name: 'Millibars', id: 'pressurembar', fn: decimalSIPrefix('bar', -1) },\r\n      { name: 'Bars', id: 'pressurebar', fn: decimalSIPrefix('bar') },\r\n      { name: 'Kilobars', id: 'pressurekbar', fn: decimalSIPrefix('bar', 1) },\r\n      { name: 'Hectopascals', id: 'pressurehpa', fn: toFixedUnit('hPa') },\r\n      { name: 'Kilopascals', id: 'pressurekpa', fn: toFixedUnit('kPa') },\r\n      { name: 'Inches of mercury', id: 'pressurehg', fn: toFixedUnit('\"Hg') },\r\n      { name: 'PSI', id: 'pressurepsi', fn: scaledUnits(1000, ['psi', 'ksi', 'Mpsi']) },\r\n    ],\r\n  },\r\n  {\r\n    name: 'Radiation',\r\n    formats: [\r\n      { name: 'Becquerel (Bq)', id: 'radbq', fn: decimalSIPrefix('Bq') },\r\n      { name: 'curie (Ci)', id: 'radci', fn: decimalSIPrefix('Ci') },\r\n      { name: 'Gray (Gy)', id: 'radgy', fn: decimalSIPrefix('Gy') },\r\n      { name: 'rad', id: 'radrad', fn: decimalSIPrefix('rad') },\r\n      { name: 'Sievert (Sv)', id: 'radsv', fn: decimalSIPrefix('Sv') },\r\n      { name: 'milliSievert (mSv)', id: 'radmsv', fn: decimalSIPrefix('mSv', -1) },\r\n      { name: 'microSievert (Sv)', id: 'radusv', fn: decimalSIPrefix('Sv', -2) },\r\n      { name: 'rem', id: 'radrem', fn: decimalSIPrefix('rem') },\r\n      { name: 'Exposure (C/kg)', id: 'radexpckg', fn: decimalSIPrefix('C/kg') },\r\n      { name: 'roentgen (R)', id: 'radr', fn: decimalSIPrefix('R') },\r\n      { name: 'Sievert/hour (Sv/h)', id: 'radsvh', fn: decimalSIPrefix('Sv/h') },\r\n      { name: 'milliSievert/hour (mSv/h)', id: 'radmsvh', fn: decimalSIPrefix('Sv/h', -1) },\r\n      { name: 'microSievert/hour (Sv/h)', id: 'radusvh', fn: decimalSIPrefix('Sv/h', -2) },\r\n    ],\r\n  },\r\n  {\r\n    name: 'Temperature',\r\n    formats: [\r\n      { name: 'Celsius (C)', id: 'celsius', fn: toFixedUnit('C') },\r\n      { name: 'Fahrenheit (F)', id: 'fahrenheit', fn: toFixedUnit('F') },\r\n      { name: 'Kelvin (K)', id: 'kelvin', fn: toFixedUnit('K') },\r\n    ],\r\n  },\r\n  {\r\n    name: 'Time',\r\n    formats: [\r\n      { name: 'Hertz (1/s)', id: 'hertz', fn: decimalSIPrefix('Hz') },\r\n      { name: 'nanoseconds (ns)', id: 'ns', fn: toNanoSeconds },\r\n      { name: 'microseconds (s)', id: 's', fn: toMicroSeconds },\r\n      { name: 'milliseconds (ms)', id: 'ms', fn: toMilliSeconds },\r\n      { name: 'seconds (s)', id: 's', fn: toSeconds },\r\n      { name: 'minutes (m)', id: 'm', fn: toMinutes },\r\n      { name: 'hours (h)', id: 'h', fn: toHours },\r\n      { name: 'days (d)', id: 'd', fn: toDays },\r\n      { name: 'duration (ms)', id: 'dtdurationms', fn: toDurationInMilliseconds },\r\n      { name: 'duration (s)', id: 'dtdurations', fn: toDurationInSeconds },\r\n      { name: 'duration (hh:mm:ss)', id: 'dthms', fn: toDurationInHoursMinutesSeconds },\r\n      { name: 'Timeticks (s/100)', id: 'timeticks', fn: toTimeTicks },\r\n      { name: 'clock (ms)', id: 'clockms', fn: toClockMilliseconds },\r\n      { name: 'clock (s)', id: 'clocks', fn: toClockSeconds },\r\n    ],\r\n  },\r\n  {\r\n    name: 'Throughput',\r\n    formats: [\r\n      { name: 'counts/sec (cps)', id: 'cps', fn: simpleCountUnit('cps') },\r\n      { name: 'ops/sec (ops)', id: 'ops', fn: simpleCountUnit('ops') },\r\n      { name: 'requests/sec (rps)', id: 'reqps', fn: simpleCountUnit('reqps') },\r\n      { name: 'reads/sec (rps)', id: 'rps', fn: simpleCountUnit('rps') },\r\n      { name: 'writes/sec (wps)', id: 'wps', fn: simpleCountUnit('wps') },\r\n      { name: 'I/O ops/sec (iops)', id: 'iops', fn: simpleCountUnit('iops') },\r\n      { name: 'counts/min (cpm)', id: 'cpm', fn: simpleCountUnit('cpm') },\r\n      { name: 'ops/min (opm)', id: 'opm', fn: simpleCountUnit('opm') },\r\n      { name: 'reads/min (rpm)', id: 'rpm', fn: simpleCountUnit('rpm') },\r\n      { name: 'writes/min (wpm)', id: 'wpm', fn: simpleCountUnit('wpm') },\r\n    ],\r\n  },\r\n  {\r\n    name: 'Velocity',\r\n    formats: [\r\n      { name: 'meters/second (m/s)', id: 'velocityms', fn: toFixedUnit('m/s') },\r\n      { name: 'kilometers/hour (km/h)', id: 'velocitykmh', fn: toFixedUnit('km/h') },\r\n      { name: 'miles/hour (mph)', id: 'velocitymph', fn: toFixedUnit('mph') },\r\n      { name: 'knot (kn)', id: 'velocityknot', fn: toFixedUnit('kn') },\r\n    ],\r\n  },\r\n  {\r\n    name: 'Volume',\r\n    formats: [\r\n      { name: 'millilitre (mL)', id: 'mlitre', fn: decimalSIPrefix('L', -1) },\r\n      { name: 'litre (L)', id: 'litre', fn: decimalSIPrefix('L') },\r\n      { name: 'cubic meter', id: 'm3', fn: toFixedUnit('m') },\r\n      { name: 'Normal cubic meter', id: 'Nm3', fn: toFixedUnit('Nm') },\r\n      { name: 'cubic decimeter', id: 'dm3', fn: toFixedUnit('dm') },\r\n      { name: 'gallons', id: 'gallons', fn: toFixedUnit('gal') },\r\n    ],\r\n  },\r\n];\r\n","import { toDuration as duration, toUtc, dateTime } from '../datetime/moment_wrapper';\r\n\r\nimport { toFixed, toFixedScaled, FormattedValue, ValueFormatter } from './valueFormats';\r\nimport { DecimalCount } from '../types/displayValue';\r\nimport { TimeZone } from '../types';\r\n\r\ninterface IntervalsInSeconds {\r\n  [interval: string]: number;\r\n}\r\n\r\nexport enum Interval {\r\n  Year = 'year',\r\n  Month = 'month',\r\n  Week = 'week',\r\n  Day = 'day',\r\n  Hour = 'hour',\r\n  Minute = 'minute',\r\n  Second = 'second',\r\n  Millisecond = 'millisecond',\r\n}\r\n\r\nconst INTERVALS_IN_SECONDS: IntervalsInSeconds = {\r\n  [Interval.Year]: 31536000,\r\n  [Interval.Month]: 2592000,\r\n  [Interval.Week]: 604800,\r\n  [Interval.Day]: 86400,\r\n  [Interval.Hour]: 3600,\r\n  [Interval.Minute]: 60,\r\n  [Interval.Second]: 1,\r\n  [Interval.Millisecond]: 0.001,\r\n};\r\n\r\nexport function toNanoSeconds(size: number, decimals?: DecimalCount, scaledDecimals?: DecimalCount): FormattedValue {\r\n  if (size === null) {\r\n    return { text: '' };\r\n  }\r\n\r\n  if (Math.abs(size) < 1000) {\r\n    return { text: toFixed(size, decimals), suffix: ' ns' };\r\n  } else if (Math.abs(size) < 1000000) {\r\n    return toFixedScaled(size / 1000, decimals, scaledDecimals, 3, ' s');\r\n  } else if (Math.abs(size) < 1000000000) {\r\n    return toFixedScaled(size / 1000000, decimals, scaledDecimals, 6, ' ms');\r\n  } else if (Math.abs(size) < 60000000000) {\r\n    return toFixedScaled(size / 1000000000, decimals, scaledDecimals, 9, ' s');\r\n  } else {\r\n    return toFixedScaled(size / 60000000000, decimals, scaledDecimals, 12, ' min');\r\n  }\r\n}\r\n\r\nexport function toMicroSeconds(size: number, decimals?: DecimalCount, scaledDecimals?: DecimalCount): FormattedValue {\r\n  if (size === null) {\r\n    return { text: '' };\r\n  }\r\n\r\n  if (Math.abs(size) < 1000) {\r\n    return { text: toFixed(size, decimals), suffix: ' s' };\r\n  } else if (Math.abs(size) < 1000000) {\r\n    return toFixedScaled(size / 1000, decimals, scaledDecimals, 3, ' ms');\r\n  } else {\r\n    return toFixedScaled(size / 1000000, decimals, scaledDecimals, 6, ' s');\r\n  }\r\n}\r\n\r\nexport function toMilliSeconds(size: number, decimals?: DecimalCount, scaledDecimals?: DecimalCount): FormattedValue {\r\n  if (size === null) {\r\n    return { text: '' };\r\n  }\r\n\r\n  if (Math.abs(size) < 1000) {\r\n    return { text: toFixed(size, decimals), suffix: ' ms' };\r\n  } else if (Math.abs(size) < 60000) {\r\n    // Less than 1 min\r\n    return toFixedScaled(size / 1000, decimals, scaledDecimals, 3, ' s');\r\n  } else if (Math.abs(size) < 3600000) {\r\n    // Less than 1 hour, divide in minutes\r\n    return toFixedScaled(size / 60000, decimals, scaledDecimals, 5, ' min');\r\n  } else if (Math.abs(size) < 86400000) {\r\n    // Less than one day, divide in hours\r\n    return toFixedScaled(size / 3600000, decimals, scaledDecimals, 7, ' hour');\r\n  } else if (Math.abs(size) < 31536000000) {\r\n    // Less than one year, divide in days\r\n    return toFixedScaled(size / 86400000, decimals, scaledDecimals, 8, ' day');\r\n  }\r\n\r\n  return toFixedScaled(size / 31536000000, decimals, scaledDecimals, 10, ' year');\r\n}\r\n\r\nexport function trySubstract(value1: DecimalCount, value2: DecimalCount): DecimalCount {\r\n  if (value1 !== null && value1 !== undefined && value2 !== null && value2 !== undefined) {\r\n    return value1 - value2;\r\n  }\r\n  return undefined;\r\n}\r\n\r\nexport function toSeconds(size: number, decimals?: DecimalCount, scaledDecimals?: DecimalCount): FormattedValue {\r\n  if (size === null) {\r\n    return { text: '' };\r\n  }\r\n\r\n  // Less than 1 s, divide in ns\r\n  if (Math.abs(size) < 0.000001) {\r\n    return toFixedScaled(size * 1e9, decimals, trySubstract(scaledDecimals, decimals), -9, ' ns');\r\n  }\r\n  // Less than 1 ms, divide in s\r\n  if (Math.abs(size) < 0.001) {\r\n    return toFixedScaled(size * 1e6, decimals, trySubstract(scaledDecimals, decimals), -6, ' s');\r\n  }\r\n  // Less than 1 second, divide in ms\r\n  if (Math.abs(size) < 1) {\r\n    return toFixedScaled(size * 1e3, decimals, trySubstract(scaledDecimals, decimals), -3, ' ms');\r\n  }\r\n\r\n  if (Math.abs(size) < 60) {\r\n    return { text: toFixed(size, decimals), suffix: ' s' };\r\n  } else if (Math.abs(size) < 3600) {\r\n    // Less than 1 hour, divide in minutes\r\n    return toFixedScaled(size / 60, decimals, scaledDecimals, 1, ' min');\r\n  } else if (Math.abs(size) < 86400) {\r\n    // Less than one day, divide in hours\r\n    return toFixedScaled(size / 3600, decimals, scaledDecimals, 4, ' hour');\r\n  } else if (Math.abs(size) < 604800) {\r\n    // Less than one week, divide in days\r\n    return toFixedScaled(size / 86400, decimals, scaledDecimals, 5, ' day');\r\n  } else if (Math.abs(size) < 31536000) {\r\n    // Less than one year, divide in week\r\n    return toFixedScaled(size / 604800, decimals, scaledDecimals, 6, ' week');\r\n  }\r\n\r\n  return toFixedScaled(size / 3.15569e7, decimals, scaledDecimals, 7, ' year');\r\n}\r\n\r\nexport function toMinutes(size: number, decimals?: DecimalCount, scaledDecimals?: DecimalCount): FormattedValue {\r\n  if (size === null) {\r\n    return { text: '' };\r\n  }\r\n\r\n  if (Math.abs(size) < 60) {\r\n    return { text: toFixed(size, decimals), suffix: ' min' };\r\n  } else if (Math.abs(size) < 1440) {\r\n    return toFixedScaled(size / 60, decimals, scaledDecimals, 2, ' hour');\r\n  } else if (Math.abs(size) < 10080) {\r\n    return toFixedScaled(size / 1440, decimals, scaledDecimals, 3, ' day');\r\n  } else if (Math.abs(size) < 604800) {\r\n    return toFixedScaled(size / 10080, decimals, scaledDecimals, 4, ' week');\r\n  } else {\r\n    return toFixedScaled(size / 5.25948e5, decimals, scaledDecimals, 5, ' year');\r\n  }\r\n}\r\n\r\nexport function toHours(size: number, decimals?: DecimalCount, scaledDecimals?: DecimalCount): FormattedValue {\r\n  if (size === null) {\r\n    return { text: '' };\r\n  }\r\n\r\n  if (Math.abs(size) < 24) {\r\n    return { text: toFixed(size, decimals), suffix: ' hour' };\r\n  } else if (Math.abs(size) < 168) {\r\n    return toFixedScaled(size / 24, decimals, scaledDecimals, 2, ' day');\r\n  } else if (Math.abs(size) < 8760) {\r\n    return toFixedScaled(size / 168, decimals, scaledDecimals, 3, ' week');\r\n  } else {\r\n    return toFixedScaled(size / 8760, decimals, scaledDecimals, 4, ' year');\r\n  }\r\n}\r\n\r\nexport function toDays(size: number, decimals?: DecimalCount, scaledDecimals?: DecimalCount): FormattedValue {\r\n  if (size === null) {\r\n    return { text: '' };\r\n  }\r\n\r\n  if (Math.abs(size) < 7) {\r\n    return { text: toFixed(size, decimals), suffix: ' day' };\r\n  } else if (Math.abs(size) < 365) {\r\n    return toFixedScaled(size / 7, decimals, scaledDecimals, 2, ' week');\r\n  } else {\r\n    return toFixedScaled(size / 365, decimals, scaledDecimals, 3, ' year');\r\n  }\r\n}\r\n\r\nexport function toDuration(size: number, decimals: DecimalCount, timeScale: Interval): FormattedValue {\r\n  if (size === null) {\r\n    return { text: '' };\r\n  }\r\n\r\n  if (size === 0) {\r\n    return { text: '0', suffix: ' ' + timeScale + 's' };\r\n  }\r\n\r\n  if (size < 0) {\r\n    const v = toDuration(-size, decimals, timeScale);\r\n    if (!v.suffix) {\r\n      v.suffix = '';\r\n    }\r\n    v.suffix += ' ago';\r\n    return v;\r\n  }\r\n\r\n  const units = [\r\n    { long: Interval.Year },\r\n    { long: Interval.Month },\r\n    { long: Interval.Week },\r\n    { long: Interval.Day },\r\n    { long: Interval.Hour },\r\n    { long: Interval.Minute },\r\n    { long: Interval.Second },\r\n    { long: Interval.Millisecond },\r\n  ];\r\n\r\n  // convert $size to milliseconds\r\n  // intervals_in_seconds uses seconds (duh), convert them to milliseconds here to minimize floating point errors\r\n  size *= INTERVALS_IN_SECONDS[timeScale] * 1000;\r\n\r\n  const strings = [];\r\n\r\n  // after first value >= 1 print only $decimals more\r\n  let decrementDecimals = false;\r\n  let decimalsCount = 0;\r\n\r\n  if (decimals !== null || decimals !== undefined) {\r\n    decimalsCount = decimals as number;\r\n  }\r\n\r\n  for (let i = 0; i < units.length && decimalsCount >= 0; i++) {\r\n    const interval = INTERVALS_IN_SECONDS[units[i].long] * 1000;\r\n    const value = size / interval;\r\n    if (value >= 1 || decrementDecimals) {\r\n      decrementDecimals = true;\r\n      const floor = Math.floor(value);\r\n      const unit = units[i].long + (floor !== 1 ? 's' : '');\r\n      strings.push(floor + ' ' + unit);\r\n      size = size % interval;\r\n      decimalsCount--;\r\n    }\r\n  }\r\n\r\n  return { text: strings.join(', ') };\r\n}\r\n\r\nexport function toClock(size: number, decimals?: DecimalCount): FormattedValue {\r\n  if (size === null) {\r\n    return { text: '' };\r\n  }\r\n\r\n  // < 1 second\r\n  if (size < 1000) {\r\n    return {\r\n      text: toUtc(size).format('SSS\\\\m\\\\s'),\r\n    };\r\n  }\r\n\r\n  // < 1 minute\r\n  if (size < 60000) {\r\n    let format = 'ss\\\\s:SSS\\\\m\\\\s';\r\n    if (decimals === 0) {\r\n      format = 'ss\\\\s';\r\n    }\r\n    return { text: toUtc(size).format(format) };\r\n  }\r\n\r\n  // < 1 hour\r\n  if (size < 3600000) {\r\n    let format = 'mm\\\\m:ss\\\\s:SSS\\\\m\\\\s';\r\n    if (decimals === 0) {\r\n      format = 'mm\\\\m';\r\n    } else if (decimals === 1) {\r\n      format = 'mm\\\\m:ss\\\\s';\r\n    }\r\n    return { text: toUtc(size).format(format) };\r\n  }\r\n\r\n  let format = 'mm\\\\m:ss\\\\s:SSS\\\\m\\\\s';\r\n\r\n  const hours = `${('0' + Math.floor(duration(size, 'milliseconds').asHours())).slice(-2)}h`;\r\n\r\n  if (decimals === 0) {\r\n    format = '';\r\n  } else if (decimals === 1) {\r\n    format = 'mm\\\\m';\r\n  } else if (decimals === 2) {\r\n    format = 'mm\\\\m:ss\\\\s';\r\n  }\r\n\r\n  const text = format ? `${hours}:${toUtc(size).format(format)}` : hours;\r\n  return { text };\r\n}\r\n\r\nexport function toDurationInMilliseconds(size: number, decimals: DecimalCount): FormattedValue {\r\n  return toDuration(size, decimals, Interval.Millisecond);\r\n}\r\n\r\nexport function toDurationInSeconds(size: number, decimals: DecimalCount): FormattedValue {\r\n  return toDuration(size, decimals, Interval.Second);\r\n}\r\n\r\nexport function toDurationInHoursMinutesSeconds(size: number): FormattedValue {\r\n  if (size < 0) {\r\n    const v = toDurationInHoursMinutesSeconds(-size);\r\n    if (!v.suffix) {\r\n      v.suffix = '';\r\n    }\r\n    v.suffix += ' ago';\r\n    return v;\r\n  }\r\n  const strings = [];\r\n  const numHours = Math.floor(size / 3600);\r\n  const numMinutes = Math.floor((size % 3600) / 60);\r\n  const numSeconds = Math.floor((size % 3600) % 60);\r\n  numHours > 9 ? strings.push('' + numHours) : strings.push('0' + numHours);\r\n  numMinutes > 9 ? strings.push('' + numMinutes) : strings.push('0' + numMinutes);\r\n  numSeconds > 9 ? strings.push('' + numSeconds) : strings.push('0' + numSeconds);\r\n  return { text: strings.join(':') };\r\n}\r\n\r\nexport function toTimeTicks(size: number, decimals: DecimalCount, scaledDecimals: DecimalCount): FormattedValue {\r\n  return toSeconds(size / 100, decimals, scaledDecimals);\r\n}\r\n\r\nexport function toClockMilliseconds(size: number, decimals: DecimalCount): FormattedValue {\r\n  return toClock(size, decimals);\r\n}\r\n\r\nexport function toClockSeconds(size: number, decimals: DecimalCount): FormattedValue {\r\n  return toClock(size * 1000, decimals);\r\n}\r\n\r\nexport function toDateTimeValueFormatter(pattern: string, todayPattern?: string): ValueFormatter {\r\n  return (value: number, decimals: DecimalCount, scaledDecimals: DecimalCount, timeZone?: TimeZone): FormattedValue => {\r\n    const isUtc = timeZone === 'utc';\r\n    const time = isUtc ? toUtc(value) : dateTime(value);\r\n    if (todayPattern) {\r\n      if (dateTime().isSame(value, 'day')) {\r\n        return { text: time.format(todayPattern) };\r\n      }\r\n    }\r\n    return { text: time.format(pattern) };\r\n  };\r\n}\r\n\r\nexport const dateTimeAsIso = toDateTimeValueFormatter('YYYY-MM-DD HH:mm:ss', 'HH:mm:ss');\r\nexport const dateTimeAsUS = toDateTimeValueFormatter('MM/DD/YYYY h:mm:ss a', 'h:mm:ss a');\r\n\r\nexport function dateTimeFromNow(\r\n  value: number,\r\n  decimals: DecimalCount,\r\n  scaledDecimals: DecimalCount,\r\n  timeZone?: TimeZone\r\n): FormattedValue {\r\n  const isUtc = timeZone === 'utc';\r\n  const time = isUtc ? toUtc(value) : dateTime(value);\r\n  return { text: time.fromNow() };\r\n}\r\n","export * from './valueFormats';\n","import { scaledUnits, ValueFormatter } from './valueFormats';\r\nimport { DecimalCount } from '../types/displayValue';\r\n\r\nexport function currency(symbol: string, asSuffix?: boolean): ValueFormatter {\r\n  const units = ['', 'K', 'M', 'B', 'T'];\r\n  const scaler = scaledUnits(1000, units);\r\n  return (size: number, decimals?: DecimalCount, scaledDecimals?: DecimalCount) => {\r\n    if (size === null) {\r\n      return { text: '' };\r\n    }\r\n    const scaled = scaler(size, decimals, scaledDecimals);\r\n    if (asSuffix) {\r\n      scaled.suffix = symbol;\r\n    } else {\r\n      scaled.prefix = symbol;\r\n    }\r\n    return scaled;\r\n  };\r\n}\r\n\r\nexport function getOffsetFromSIPrefix(c: string): number {\r\n  switch (c) {\r\n    case 'f':\r\n      return -5;\r\n    case 'p':\r\n      return -4;\r\n    case 'n':\r\n      return -3;\r\n    case '': // Two different unicode chars for \r\n    case '':\r\n      return -2;\r\n    case 'm':\r\n      return -1;\r\n    case '':\r\n      return 0;\r\n    case 'k':\r\n      return 1;\r\n    case 'M':\r\n      return 2;\r\n    case 'G':\r\n      return 3;\r\n    case 'T':\r\n      return 4;\r\n    case 'P':\r\n      return 5;\r\n    case 'E':\r\n      return 6;\r\n    case 'Z':\r\n      return 7;\r\n    case 'Y':\r\n      return 8;\r\n  }\r\n  return 0;\r\n}\r\n\r\nexport function binarySIPrefix(unit: string, offset = 0): ValueFormatter {\r\n  const prefixes = ['', 'Ki', 'Mi', 'Gi', 'Ti', 'Pi', 'Ei', 'Zi', 'Yi'].slice(offset);\r\n  const units = prefixes.map(p => {\r\n    return ' ' + p + unit;\r\n  });\r\n  return scaledUnits(1024, units);\r\n}\r\n\r\nexport function decimalSIPrefix(unit: string, offset = 0): ValueFormatter {\r\n  let prefixes = ['f', 'p', 'n', '', 'm', '', 'k', 'M', 'G', 'T', 'P', 'E', 'Z', 'Y'];\r\n  prefixes = prefixes.slice(5 + (offset || 0));\r\n  const units = prefixes.map(p => {\r\n    return ' ' + p + unit;\r\n  });\r\n  return scaledUnits(1000, units);\r\n}\r\n","import { getCategories } from './categories';\r\nimport { DecimalCount } from '../types/displayValue';\r\nimport { toDateTimeValueFormatter } from './dateTimeFormatters';\r\nimport { getOffsetFromSIPrefix, decimalSIPrefix, currency } from './symbolFormatters';\r\nimport { TimeZone } from '../types';\r\n\r\nexport interface FormattedValue {\r\n  text: string;\r\n  prefix?: string;\r\n  suffix?: string;\r\n}\r\n\r\nexport function formattedValueToString(val: FormattedValue): string {\r\n  return `${val.prefix ?? ''}${val.text}${val.suffix ?? ''}`;\r\n}\r\n\r\nexport type ValueFormatter = (\r\n  value: number,\r\n  decimals?: DecimalCount,\r\n  scaledDecimals?: DecimalCount,\r\n  timeZone?: TimeZone\r\n) => FormattedValue;\r\n\r\nexport interface ValueFormat {\r\n  name: string;\r\n  id: string;\r\n  fn: ValueFormatter;\r\n}\r\n\r\nexport interface ValueFormatCategory {\r\n  name: string;\r\n  formats: ValueFormat[];\r\n}\r\n\r\ninterface ValueFormatterIndex {\r\n  [id: string]: ValueFormatter;\r\n}\r\n\r\n// Globals & formats cache\r\nlet categories: ValueFormatCategory[] = [];\r\nconst index: ValueFormatterIndex = {};\r\nlet hasBuiltIndex = false;\r\n\r\nexport function toFixed(value: number, decimals?: DecimalCount): string {\r\n  if (value === null) {\r\n    return '';\r\n  }\r\n  if (value === Number.NEGATIVE_INFINITY || value === Number.POSITIVE_INFINITY) {\r\n    return value.toLocaleString();\r\n  }\r\n\r\n  const factor = decimals ? Math.pow(10, Math.max(0, decimals)) : 1;\r\n  const formatted = String(Math.round(value * factor) / factor);\r\n\r\n  // if exponent return directly\r\n  if (formatted.indexOf('e') !== -1 || value === 0) {\r\n    return formatted;\r\n  }\r\n\r\n  // If tickDecimals was specified, ensure that we have exactly that\r\n  // much precision; otherwise default to the value's own precision.\r\n  if (decimals != null) {\r\n    const decimalPos = formatted.indexOf('.');\r\n    const precision = decimalPos === -1 ? 0 : formatted.length - decimalPos - 1;\r\n    if (precision < decimals) {\r\n      return (precision ? formatted : formatted + '.') + String(factor).substr(1, decimals - precision);\r\n    }\r\n  }\r\n\r\n  return formatted;\r\n}\r\n\r\nexport function toFixedScaled(\r\n  value: number,\r\n  decimals: DecimalCount,\r\n  scaledDecimals: DecimalCount,\r\n  additionalDecimals: number,\r\n  ext?: string\r\n): FormattedValue {\r\n  if (scaledDecimals === null || scaledDecimals === undefined) {\r\n    return { text: toFixed(value, decimals), suffix: ext };\r\n  }\r\n  return {\r\n    text: toFixed(value, scaledDecimals + additionalDecimals),\r\n    suffix: ext,\r\n  };\r\n}\r\n\r\nexport function toFixedUnit(unit: string, asPrefix?: boolean): ValueFormatter {\r\n  return (size: number, decimals?: DecimalCount) => {\r\n    if (size === null) {\r\n      return { text: '' };\r\n    }\r\n    const text = toFixed(size, decimals);\r\n    if (unit) {\r\n      if (asPrefix) {\r\n        return { text, prefix: unit };\r\n      }\r\n      return { text, suffix: ' ' + unit };\r\n    }\r\n    return { text };\r\n  };\r\n}\r\n\r\n// Formatter which scales the unit string geometrically according to the given\r\n// numeric factor. Repeatedly scales the value down by the factor until it is\r\n// less than the factor in magnitude, or the end of the array is reached.\r\nexport function scaledUnits(factor: number, extArray: string[]): ValueFormatter {\r\n  return (size: number, decimals?: DecimalCount, scaledDecimals?: DecimalCount) => {\r\n    if (size === null) {\r\n      return { text: '' };\r\n    }\r\n    if (size === Number.NEGATIVE_INFINITY || size === Number.POSITIVE_INFINITY || isNaN(size)) {\r\n      return { text: size.toLocaleString() };\r\n    }\r\n\r\n    let steps = 0;\r\n    const limit = extArray.length;\r\n\r\n    while (Math.abs(size) >= factor) {\r\n      steps++;\r\n      size /= factor;\r\n\r\n      if (steps >= limit) {\r\n        return { text: 'NA' };\r\n      }\r\n    }\r\n\r\n    if (steps > 0 && scaledDecimals !== null && scaledDecimals !== undefined) {\r\n      decimals = scaledDecimals + 3 * steps;\r\n    }\r\n\r\n    return { text: toFixed(size, decimals), suffix: extArray[steps] };\r\n  };\r\n}\r\n\r\nexport function locale(value: number, decimals: DecimalCount): FormattedValue {\r\n  if (value == null) {\r\n    return { text: '' };\r\n  }\r\n  return {\r\n    text: value.toLocaleString(undefined, { maximumFractionDigits: decimals as number }),\r\n  };\r\n}\r\n\r\nexport function simpleCountUnit(symbol: string): ValueFormatter {\r\n  const units = ['', 'K', 'M', 'B', 'T'];\r\n  const scaler = scaledUnits(1000, units);\r\n  return (size: number, decimals?: DecimalCount, scaledDecimals?: DecimalCount) => {\r\n    if (size === null) {\r\n      return { text: '' };\r\n    }\r\n    const v = scaler(size, decimals, scaledDecimals);\r\n    v.suffix += ' ' + symbol;\r\n    return v;\r\n  };\r\n}\r\n\r\nfunction buildFormats() {\r\n  categories = getCategories();\r\n\r\n  for (const cat of categories) {\r\n    for (const format of cat.formats) {\r\n      index[format.id] = format.fn;\r\n    }\r\n  }\r\n\r\n  // Resolve units pointing to old IDs\r\n  [{ from: 'farenheit', to: 'fahrenheit' }].forEach(alias => {\r\n    const f = index[alias.to];\r\n    if (f) {\r\n      index[alias.from] = f;\r\n    }\r\n  });\r\n\r\n  hasBuiltIndex = true;\r\n}\r\n\r\nexport function getValueFormat(id: string): ValueFormatter {\r\n  if (!hasBuiltIndex) {\r\n    buildFormats();\r\n  }\r\n\r\n  const fmt = index[id];\r\n  if (!fmt && id) {\r\n    const idx = id.indexOf(':');\r\n    if (idx > 0) {\r\n      const key = id.substring(0, idx);\r\n      const sub = id.substring(idx + 1);\r\n      if (key === 'prefix') {\r\n        return toFixedUnit(sub, true);\r\n      }\r\n      if (key === 'time') {\r\n        return toDateTimeValueFormatter(sub);\r\n      }\r\n      if (key === 'si') {\r\n        const offset = getOffsetFromSIPrefix(sub.charAt(0));\r\n        const unit = offset === 0 ? sub : sub.substring(1);\r\n        return decimalSIPrefix(unit, offset);\r\n      }\r\n      if (key === 'count') {\r\n        return simpleCountUnit(sub);\r\n      }\r\n      if (key === 'currency') {\r\n        return currency(sub);\r\n      }\r\n    }\r\n    return toFixedUnit(id);\r\n  }\r\n  return fmt;\r\n}\r\n\r\nexport function getValueFormatterIndex(): ValueFormatterIndex {\r\n  if (!hasBuiltIndex) {\r\n    buildFormats();\r\n  }\r\n\r\n  return index;\r\n}\r\n\r\nexport function getValueFormats() {\r\n  if (!hasBuiltIndex) {\r\n    buildFormats();\r\n  }\r\n\r\n  return categories.map(cat => {\r\n    return {\r\n      text: cat.name,\r\n      submenu: cat.formats.map(format => {\r\n        return {\r\n          text: format.name,\r\n          value: format.id,\r\n        };\r\n      }),\r\n    };\r\n  });\r\n}\r\n","import { Vector } from '../types/vector';\r\nimport { vectorToArray } from './vectorToArray';\r\n\r\ninterface AppendedVectorInfo<T> {\r\n  start: number;\r\n  end: number;\r\n  values: Vector<T>;\r\n}\r\n\r\n/**\r\n * This may be more trouble than it is worth.  This trades some computation time for\r\n * RAM -- rather than allocate a new array the size of all previous arrays, this just\r\n * points the correct index to their original array values\r\n */\r\nexport class AppendedVectors<T = any> implements Vector<T> {\r\n  length = 0;\r\n  source: Array<AppendedVectorInfo<T>> = new Array<AppendedVectorInfo<T>>();\r\n\r\n  constructor(startAt = 0) {\r\n    this.length = startAt;\r\n  }\r\n\r\n  /**\r\n   * Make the vector look like it is this long\r\n   */\r\n  setLength(length: number) {\r\n    if (length > this.length) {\r\n      // make the vector longer (filling with undefined)\r\n      this.length = length;\r\n    } else if (length < this.length) {\r\n      // make the array shorter\r\n      const sources: Array<AppendedVectorInfo<T>> = new Array<AppendedVectorInfo<T>>();\r\n      for (const src of this.source) {\r\n        sources.push(src);\r\n        if (src.end > length) {\r\n          src.end = length;\r\n          break;\r\n        }\r\n      }\r\n      this.source = sources;\r\n      this.length = length;\r\n    }\r\n  }\r\n\r\n  append(v: Vector<T>): AppendedVectorInfo<T> {\r\n    const info = {\r\n      start: this.length,\r\n      end: this.length + v.length,\r\n      values: v,\r\n    };\r\n    this.length = info.end;\r\n    this.source.push(info);\r\n    return info;\r\n  }\r\n\r\n  get(index: number): T {\r\n    for (let i = 0; i < this.source.length; i++) {\r\n      const src = this.source[i];\r\n      if (index >= src.start && index < src.end) {\r\n        return src.values.get(index - src.start);\r\n      }\r\n    }\r\n    return (undefined as unknown) as T;\r\n  }\r\n\r\n  toArray(): T[] {\r\n    return vectorToArray(this);\r\n  }\r\n\r\n  toJSON(): T[] {\r\n    return vectorToArray(this);\r\n  }\r\n}\r\n","import { MutableVector } from '../types/vector';\r\n\r\nexport class ArrayVector<T = any> implements MutableVector<T> {\r\n  buffer: T[];\r\n\r\n  constructor(buffer?: T[]) {\r\n    this.buffer = buffer ? buffer : [];\r\n  }\r\n\r\n  get length() {\r\n    return this.buffer.length;\r\n  }\r\n\r\n  add(value: T) {\r\n    this.buffer.push(value);\r\n  }\r\n\r\n  get(index: number): T {\r\n    return this.buffer[index];\r\n  }\r\n\r\n  set(index: number, value: T) {\r\n    this.buffer[index] = value;\r\n  }\r\n\r\n  reverse() {\r\n    this.buffer.reverse();\r\n  }\r\n\r\n  toArray(): T[] {\r\n    return this.buffer;\r\n  }\r\n\r\n  toJSON(): T[] {\r\n    return this.buffer;\r\n  }\r\n}\r\n","import { MutableVector } from '../types/vector';\r\nimport { vectorToArray } from './vectorToArray';\r\n\r\ninterface CircularOptions<T> {\r\n  buffer?: T[];\r\n  append?: 'head' | 'tail';\r\n  capacity?: number;\r\n}\r\n\r\n/**\r\n * Circular vector uses a single buffer to capture a stream of values\r\n * overwriting the oldest value on add.\r\n *\r\n * This supports addting to the 'head' or 'tail' and will grow the buffer\r\n * to match a configured capacity.\r\n */\r\nexport class CircularVector<T = any> implements MutableVector<T> {\r\n  private buffer: T[];\r\n  private index: number;\r\n  private capacity: number;\r\n  private tail: boolean;\r\n\r\n  constructor(options: CircularOptions<T>) {\r\n    this.buffer = options.buffer || [];\r\n    this.capacity = this.buffer.length;\r\n    this.tail = 'head' !== options.append;\r\n    this.index = 0;\r\n\r\n    this.add = this.getAddFunction();\r\n    if (options.capacity) {\r\n      this.setCapacity(options.capacity);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * This gets the appropriate add function depending on the buffer state:\r\n   *  * head vs tail\r\n   *  * growing buffer vs overwriting values\r\n   */\r\n  private getAddFunction() {\r\n    // When we are not at capacity, it should actually modify the buffer\r\n    if (this.capacity > this.buffer.length) {\r\n      if (this.tail) {\r\n        return (value: T) => {\r\n          this.buffer.push(value);\r\n          if (this.buffer.length >= this.capacity) {\r\n            this.add = this.getAddFunction();\r\n          }\r\n        };\r\n      } else {\r\n        return (value: T) => {\r\n          this.buffer.unshift(value);\r\n          if (this.buffer.length >= this.capacity) {\r\n            this.add = this.getAddFunction();\r\n          }\r\n        };\r\n      }\r\n    }\r\n\r\n    if (this.tail) {\r\n      return (value: T) => {\r\n        this.buffer[this.index] = value;\r\n        this.index = (this.index + 1) % this.buffer.length;\r\n      };\r\n    }\r\n\r\n    // Append values to the head\r\n    return (value: T) => {\r\n      let idx = this.index - 1;\r\n      if (idx < 0) {\r\n        idx = this.buffer.length - 1;\r\n      }\r\n      this.buffer[idx] = value;\r\n      this.index = idx;\r\n    };\r\n  }\r\n\r\n  setCapacity(v: number) {\r\n    if (this.capacity === v) {\r\n      return;\r\n    }\r\n    // Make a copy so it is in order and new additions can be at the head or tail\r\n    const copy = this.toArray();\r\n    if (v > this.length) {\r\n      this.buffer = copy;\r\n    } else if (v < this.capacity) {\r\n      // Shrink the buffer\r\n      const delta = this.length - v;\r\n      if (this.tail) {\r\n        this.buffer = copy.slice(delta, copy.length); // Keep last items\r\n      } else {\r\n        this.buffer = copy.slice(0, copy.length - delta); // Keep first items\r\n      }\r\n    }\r\n    this.capacity = v;\r\n    this.index = 0;\r\n    this.add = this.getAddFunction();\r\n  }\r\n\r\n  setAppendMode(mode: 'head' | 'tail') {\r\n    const tail = 'head' !== mode;\r\n    if (tail !== this.tail) {\r\n      this.buffer = this.toArray().reverse();\r\n      this.index = 0;\r\n      this.tail = tail;\r\n      this.add = this.getAddFunction();\r\n    }\r\n  }\r\n\r\n  reverse() {\r\n    this.buffer.reverse();\r\n  }\r\n\r\n  /**\r\n   * Add the value to the buffer\r\n   */\r\n  add: (value: T) => void;\r\n\r\n  get(index: number) {\r\n    return this.buffer[(index + this.index) % this.buffer.length];\r\n  }\r\n\r\n  set(index: number, value: T) {\r\n    this.buffer[(index + this.index) % this.buffer.length] = value;\r\n  }\r\n\r\n  get length() {\r\n    return this.buffer.length;\r\n  }\r\n\r\n  toArray(): T[] {\r\n    return vectorToArray(this);\r\n  }\r\n\r\n  toJSON(): T[] {\r\n    return vectorToArray(this);\r\n  }\r\n}\r\n","import { Vector } from '../types/vector';\r\n\r\nexport class ConstantVector<T = any> implements Vector<T> {\r\n  constructor(private value: T, private len: number) {}\r\n\r\n  get length() {\r\n    return this.len;\r\n  }\r\n\r\n  get(index: number): T {\r\n    return this.value;\r\n  }\r\n\r\n  toArray(): T[] {\r\n    const arr = new Array<T>(this.length);\r\n    return arr.fill(this.value);\r\n  }\r\n\r\n  toJSON(): T[] {\r\n    return this.toArray();\r\n  }\r\n}\r\n","import { Vector } from '../types/vector';\r\nimport { vectorToArray } from './vectorToArray';\r\n\r\nexport class ScaledVector implements Vector<number> {\r\n  constructor(private source: Vector<number>, private scale: number) {}\r\n\r\n  get length(): number {\r\n    return this.source.length;\r\n  }\r\n\r\n  get(index: number): number {\r\n    return this.source.get(index) * this.scale;\r\n  }\r\n\r\n  toArray(): number[] {\r\n    return vectorToArray(this);\r\n  }\r\n\r\n  toJSON(): number[] {\r\n    return vectorToArray(this);\r\n  }\r\n}\r\n","import { Vector } from '../types/vector';\nimport { vectorToArray } from './vectorToArray';\n\n/**\n * Values are returned in the order defined by the input parameter\n */\nexport class SortedVector<T = any> implements Vector<T> {\n  constructor(private source: Vector<T>, private order: number[]) {}\n\n  get length(): number {\n    return this.source.length;\n  }\n\n  get(index: number): T {\n    return this.source.get(this.order[index]);\n  }\n\n  toArray(): T[] {\n    return vectorToArray(this);\n  }\n\n  toJSON(): T[] {\n    return vectorToArray(this);\n  }\n}\n","export * from './AppendedVectors';\r\nexport * from './ArrayVector';\r\nexport * from './CircularVector';\r\nexport * from './ConstantVector';\r\nexport * from './ScaledVector';\r\nexport * from './SortedVector';\r\n","import { Vector } from '../types/vector';\r\n\r\nexport function vectorToArray<T>(v: Vector<T>): T[] {\r\n  const arr: T[] = [];\r\n  for (let i = 0; i < v.length; i++) {\r\n    arr[i] = v.get(i);\r\n  }\r\n  return arr;\r\n}\r\n","import { e2e } from '../index';\r\nimport { Url } from '../support/url';\r\n\r\nexport const addDashboard = () => {\r\n  e2e().logToConsole('Adding dashboard');\r\n  e2e.pages.AddDashboard.visit();\r\n\r\n  const dashboardTitle = e2e.flows.saveNewDashboard();\r\n  e2e().logToConsole('Added dashboard with title:', dashboardTitle);\r\n\r\n  e2e()\r\n    .url()\r\n    .then((url: string) => {\r\n      e2e.context().set('lastAddedDashboard', dashboardTitle);\r\n      e2e.context().set('lastAddedDashboardUid', Url.getDashboardUid(url));\r\n    });\r\n};\r\n","import { e2e } from '../index';\r\n\r\nexport const addDataSource = (pluginName?: string): string => {\r\n  pluginName = pluginName || 'TestData DB';\r\n  e2e().logToConsole('Adding data source with pluginName:', pluginName);\r\n  e2e.pages.AddDataSource.visit();\r\n  e2e.pages.AddDataSource.dataSourcePlugins(pluginName)\r\n    .scrollIntoView()\r\n    .should('be.visible') // prevents flakiness\r\n    .click();\r\n\r\n  const dataSourceName = `e2e-${new Date().getTime()}`;\r\n  e2e.pages.DataSource.name().clear();\r\n  e2e.pages.DataSource.name().type(dataSourceName);\r\n  e2e.pages.DataSource.saveAndTest().click();\r\n  e2e.pages.DataSource.alert().should('exist');\r\n  e2e.pages.DataSource.alertMessage().should('contain.text', 'Data source is working');\r\n  e2e().logToConsole('Added data source with name:', dataSourceName);\r\n  e2e.context().set('lastAddedDataSource', dataSourceName);\r\n\r\n  return dataSourceName;\r\n};\r\n","import { e2e } from '../index';\r\n\r\nexport const assertSuccessNotification = () => {\r\n  e2e()\r\n    .get('.alert-success')\r\n    .should('exist');\r\n};\r\n","import { Url } from '../support/url';\r\nimport { e2e } from '../index';\r\n\r\nexport const deleteDashboard = (dashBoardUid: string) => {\r\n  e2e().logToConsole('Deleting dashboard with uid:', dashBoardUid);\r\n  e2e().request('DELETE', Url.fromBaseUrl(`/api/dashboards/uid/${dashBoardUid}`));\r\n\r\n  /* https://github.com/cypress-io/cypress/issues/2831\r\n  Flows.openDashboard(dashboardName);\r\n\r\n  Pages.Dashboard.settings().click();\r\n\r\n  Pages.DashboardSettings.deleteDashBoard().click();\r\n\r\n  Pages.ConfirmModal.delete().click();\r\n\r\n  Flows.assertSuccessNotification();\r\n\r\n  Pages.Dashboards.visit();\r\n  Pages.Dashboards.dashboards().each(item => {\r\n    const text = item.text();\r\n    Cypress.log({ message: [text] });\r\n    if (text && text.indexOf(dashboardName) !== -1) {\r\n      expect(false).equals(true, `Dashboard ${dashboardName} was found although it was deleted.`);\r\n    }\r\n  });\r\n */\r\n};\r\n","import { Url } from '../support/url';\r\nimport { e2e } from '../index';\r\n\r\nexport const deleteDataSource = (dataSourceName: string) => {\r\n  e2e().logToConsole('Deleting data source with name:', dataSourceName);\r\n  e2e().request('DELETE', Url.fromBaseUrl(`/api/datasources/name/${dataSourceName}`));\r\n\r\n  /* https://github.com/cypress-io/cypress/issues/2831\r\n  Pages.DataSources.visit();\r\n  Pages.DataSources.dataSources(dataSourceName).click();\r\n\r\n  Pages.DataSource.delete().click();\r\n\r\n  Pages.ConfirmModal.delete().click();\r\n\r\n  Pages.DataSources.visit();\r\n  Pages.DataSources.dataSources().each(item => {\r\n    const text = item.text();\r\n    if (text && text.indexOf(dataSourceName) !== -1) {\r\n      expect(false).equals(true, `Data source ${dataSourceName} was found although it was deleted.`);\r\n    }\r\n  });\r\n */\r\n};\r\n","import { login } from './login';\r\nimport { addDataSource } from './addDataSource';\r\nimport { deleteDataSource } from './deleteDataSource';\r\nimport { addDashboard } from './addDashboard';\r\nimport { assertSuccessNotification } from './assertSuccessNotification';\r\nimport { deleteDashboard } from './deleteDashboard';\r\nimport { openDashboard } from './openDashboard';\r\nimport { saveNewDashboard } from './saveNewDashboard';\r\nimport { saveDashboard } from './saveDashboard';\r\n\r\nexport const Flows = {\r\n  login,\r\n  addDataSource,\r\n  deleteDataSource,\r\n  addDashboard,\r\n  assertSuccessNotification,\r\n  deleteDashboard,\r\n  openDashboard,\r\n  saveNewDashboard,\r\n  saveDashboard,\r\n};\r\n","import { e2e } from '../index';\r\n\r\nexport const login = (username: string, password: string) => {\r\n  e2e().logToConsole('Trying to login with:', { username, password });\r\n  e2e.pages.Login.visit();\r\n  e2e.pages.Login.username()\r\n    .should('be.visible') // prevents flakiness\r\n    .type(username);\r\n  e2e.pages.Login.password().type(password);\r\n  e2e.pages.Login.submit().click();\r\n  e2e.pages.Login.skip()\r\n    .should('be.visible')\r\n    .click();\r\n  e2e()\r\n    .get('.login-page')\r\n    .should('not.exist');\r\n  e2e().logToConsole('Logged in with', { username, password });\r\n};\r\n","import { e2e } from '../index';\r\n\r\nexport const openDashboard = (dashboardUid: string) => {\r\n  e2e.pages.Dashboard.visit(dashboardUid);\r\n};\r\n","import { e2e } from '../index';\r\n\r\nexport const saveDashboard = () => {\r\n  e2e.pages.Dashboard.Toolbar.toolbarItems('Save dashboard').click();\r\n\r\n  e2e.pages.SaveDashboardModal.save().click();\r\n\r\n  e2e.flows.assertSuccessNotification();\r\n};\r\n","import { e2e } from '../index';\r\n\r\nexport const saveNewDashboard = () => {\r\n  e2e.pages.Dashboard.Toolbar.toolbarItems('Save dashboard').click();\r\n\r\n  const dashboardTitle = `e2e-${new Date().getTime()}`;\r\n  e2e.pages.SaveDashboardAsModal.newName().clear();\r\n  e2e.pages.SaveDashboardAsModal.newName().type(dashboardTitle);\r\n  e2e.pages.SaveDashboardAsModal.save().click();\r\n\r\n  e2e.flows.assertSuccessNotification();\r\n\r\n  return dashboardTitle;\r\n};\r\n","import { e2e } from './noTypeCheck';\r\n\r\nexport { e2e };\r\n","// @ts-nocheck\r\n// importing the e2e package in Grafana will cause transpile errors because\r\n// Cypress is an unknown type. Adding the Cypress types would overwrite all jest test types like\r\n// toBe, toEqual and so forth. That's why this file is not type checked and will be so until we\r\n// can solve the above mentioned issue with Cypress/Jest.\r\nimport { e2eScenario, ScenarioArguments } from './support/scenario';\r\nimport { Pages } from './pages';\r\nimport { Flows } from './flows';\r\nimport { scenarioContext } from './support/scenarioContext';\r\n\r\nexport type SelectorFunction = (text?: string) => Cypress.Chainable<JQuery<HTMLElement>>;\r\nexport type SelectorObject<S> = {\r\n  visit: (args?: string) => Cypress.Chainable<Window>;\r\n  selectors: S;\r\n};\r\n\r\nconst e2eObject = {\r\n  env: (args: string) => Cypress.env(args),\r\n  config: () => Cypress.config(),\r\n  blobToBase64String: (blob: any) => Cypress.Blob.blobToBase64String(blob),\r\n  imgSrcToBlob: (url: string) => Cypress.Blob.imgSrcToBlob(url),\r\n  scenario: (args: ScenarioArguments) => e2eScenario(args),\r\n  context: scenarioContext,\r\n  pages: Pages,\r\n  flows: Flows,\r\n};\r\n\r\nexport const e2e: (() => Cypress.cy) & typeof e2eObject = Object.assign(() => cy, e2eObject);\r\n","import { pageFactory } from '../support';\r\n\r\nexport const AddDashboard = pageFactory({\r\n  url: '/dashboard/new',\r\n  selectors: {\r\n    ctaButtons: (text: string) => `Add Panel Widget CTA Button ${text}`,\r\n  },\r\n});\r\n","import { pageFactory } from '../support';\r\n\r\nexport const AddDataSource = pageFactory({\r\n  url: '/datasources/new',\r\n  selectors: {\r\n    dataSourcePlugins: (pluginName: string) => `Data source plugin item ${pluginName}`,\r\n  },\r\n});\r\n","import { pageFactory } from '../support';\r\n\r\nexport const ConfirmModal = pageFactory({\r\n  url: '',\r\n  selectors: {\r\n    delete: 'Confirm Modal Danger Button',\r\n  },\r\n});\r\n","import { pageFactory } from '../support';\r\n\r\nexport const Dashboard = pageFactory({\r\n  url: (uid: string) => `/d/${uid}`,\r\n  selectors: {\r\n    toolbarItems: (button: string) => `Dashboard navigation bar button ${button}`,\r\n    backArrow: 'Dashboard settings Go Back button',\r\n    navBar: () => '.navbar',\r\n  },\r\n});\r\n","import { pageFactory } from '../support';\r\n\r\nexport const DashboardSettings = pageFactory({\r\n  url: '',\r\n  selectors: {\r\n    deleteDashBoard: 'Dashboard settings page delete dashboard button',\r\n    sectionItems: (item: string) => `Dashboard settings section item ${item}`,\r\n    saveDashBoard: 'Dashboard settings aside actions Save button',\r\n    saveAsDashBoard: 'Dashboard settings aside actions Save As button',\r\n  },\r\n});\r\n","import { pageFactory } from '../support';\r\n\r\nexport const Dashboards = pageFactory({\r\n  url: '/dashboards',\r\n  selectors: {\r\n    dashboards: (title: string) => `Dashboard search item ${title}`,\r\n  },\r\n});\r\n","import { pageFactory } from '../support';\r\n\r\nexport const DataSource = pageFactory({\r\n  url: '',\r\n  selectors: {\r\n    name: 'Data source settings page name input field',\r\n    delete: 'Data source settings page Delete button',\r\n    saveAndTest: 'Data source settings page Save and Test button',\r\n    alert: 'Data source settings page Alert',\r\n    alertMessage: 'Data source settings page Alert message',\r\n  },\r\n});\r\n","import { pageFactory } from '../support';\r\n\r\nexport const DataSources = pageFactory({\r\n  url: '/datasources',\r\n  selectors: {\r\n    dataSources: (dataSourceName: string) => `Data source list item ${dataSourceName}`,\r\n  },\r\n});\r\n","import { pageFactory } from '../support';\r\n\r\nexport const EditPanel = pageFactory({\r\n  url: '',\r\n  selectors: {\r\n    tabItems: (text: string) => `Edit panel tab item ${text}`,\r\n  },\r\n});\r\n","import { VisualizationTab } from './visualizationTab';\r\n\r\nexport const Graph = {\r\n  VisualizationTab,\r\n};\r\n","import { pageFactory } from '../../support';\r\n\r\nexport const VisualizationTab = pageFactory({\r\n  url: '',\r\n  selectors: {\r\n    xAxisSection: 'X-Axis section',\r\n  },\r\n});\r\n","import { Login } from './login';\r\nimport { AddDataSource } from './addDataSource';\r\nimport { DataSource } from './datasource';\r\nimport { DataSources } from './datasources';\r\nimport { ConfirmModal } from './confirmModal';\r\nimport { AddDashboard } from './addDashboard';\r\nimport { Dashboard } from './dashboard';\r\nimport { SaveDashboardAsModal } from './saveDashboardAsModal';\r\nimport { Dashboards } from './dashboards';\r\nimport { DashboardSettings } from './dashboardSettings';\r\nimport { EditPanel } from './editPanel';\r\nimport { TestData } from './testdata';\r\nimport { Graph } from './graph';\r\nimport { SaveDashboardModal } from './saveDashboardModal';\r\nimport { Panel } from './panel';\r\nimport { SharePanelModal } from './sharePanelModal';\r\nimport { ConstantVariable, QueryVariable, VariableGeneral, Variables, VariablesSubMenu } from './variables';\r\n\r\nexport const Pages = {\r\n  Login,\r\n  DataSource,\r\n  DataSources,\r\n  AddDataSource,\r\n  ConfirmModal,\r\n  AddDashboard,\r\n  Dashboard: {\r\n    visit: (uid: string) => Dashboard.visit(uid),\r\n    Toolbar: Dashboard,\r\n    SubMenu: VariablesSubMenu,\r\n    Settings: {\r\n      General: DashboardSettings,\r\n      Variables: {\r\n        List: Variables,\r\n        Edit: {\r\n          General: VariableGeneral,\r\n          QueryVariable: QueryVariable,\r\n          ConstantVariable: ConstantVariable,\r\n        },\r\n      },\r\n    },\r\n    Panels: {\r\n      Panel,\r\n      EditPanel,\r\n      DataSource: {\r\n        TestData,\r\n      },\r\n      Visualization: {\r\n        Graph,\r\n      },\r\n    },\r\n  },\r\n  Dashboards,\r\n  SaveDashboardAsModal,\r\n  SaveDashboardModal,\r\n  SharePanelModal,\r\n};\r\n","import { pageFactory } from '../support';\r\n\r\nexport const Login = pageFactory({\r\n  url: '/login',\r\n  selectors: {\r\n    username: 'Username input field',\r\n    password: 'Password input field',\r\n    submit: 'Login button',\r\n    skip: 'Skip change password button',\r\n  },\r\n});\r\n","import { pageFactory } from '../support';\r\n\r\nexport const Panel = pageFactory({\r\n  url: '',\r\n  selectors: {\r\n    title: (title: string) => `Panel header title item ${title}`,\r\n    headerItems: (item: string) => `Panel header item ${item}`,\r\n  },\r\n});\r\n","import { pageFactory } from '../support';\r\n\r\nexport const SaveDashboardAsModal = pageFactory({\r\n  url: '',\r\n  selectors: {\r\n    newName: 'Save dashboard title field',\r\n    save: 'Save dashboard button',\r\n  },\r\n});\r\n","import { pageFactory } from '../support';\r\n\r\nexport const SaveDashboardModal = pageFactory({\r\n  url: '',\r\n  selectors: {\r\n    save: 'Dashboard settings Save Dashboard Modal Save button',\r\n  },\r\n});\r\n","import { pageFactory } from '../support';\r\n\r\nexport const SharePanelModal = pageFactory({\r\n  url: '',\r\n  selectors: {\r\n    linkToRenderedImage: 'Link to rendered image',\r\n  },\r\n});\r\n","import { QueryTab } from './queryTab';\r\n\r\nexport const TestData = {\r\n  QueryTab,\r\n};\r\n","import { pageFactory } from '../../support';\r\n\r\nexport const QueryTab = pageFactory({\r\n  url: '',\r\n  selectors: {\r\n    scenarioSelect: 'Test Data Query scenario select',\r\n  },\r\n});\r\n","import { pageFactory } from '../support';\r\n\r\nexport const Variables = pageFactory({\r\n  url: '',\r\n  selectors: {\r\n    addVariableCTA: 'Call to action button Add variable',\r\n    newButton: 'Variable editor New variable button',\r\n    table: 'Variable editor Table',\r\n    tableRowNameFields: (variableName: string) => `Variable editor Table Name field ${variableName}`,\r\n    tableRowDefinitionFields: (variableName: string) => `Variable editor Table Definition field ${variableName}`,\r\n    tableRowArrowUpButtons: (variableName: string) => `Variable editor Table ArrowUp button ${variableName}`,\r\n    tableRowArrowDownButtons: (variableName: string) => `Variable editor Table ArrowDown button ${variableName}`,\r\n    tableRowDuplicateButtons: (variableName: string) => `Variable editor Table Duplicate button ${variableName}`,\r\n    tableRowRemoveButtons: (variableName: string) => `Variable editor Table Remove button ${variableName}`,\r\n  },\r\n});\r\n\r\nexport const VariablesSubMenu = pageFactory({\r\n  url: '',\r\n  selectors: {\r\n    submenuItem: 'Dashboard template variables submenu item',\r\n    submenuItemLabels: (item: string) => `Dashboard template variables submenu Label ${item}`,\r\n    submenuItemValueDropDownValueLinkTexts: (item: string) =>\r\n      `Dashboard template variables Variable Value DropDown value link text ${item}`,\r\n    submenuItemValueDropDownDropDown: 'Dashboard template variables Variable Value DropDown DropDown',\r\n    submenuItemValueDropDownOptionTexts: (item: string) =>\r\n      `Dashboard template variables Variable Value DropDown option text ${item}`,\r\n  },\r\n});\r\n\r\nexport const VariableGeneral = pageFactory({\r\n  url: '',\r\n  selectors: {\r\n    headerLink: 'Variable editor Header link',\r\n    modeLabelNew: 'Variable editor Header mode New',\r\n    modeLabelEdit: 'Variable editor Header mode Edit',\r\n    generalNameInput: 'Variable editor Form Name field',\r\n    generalTypeSelect: 'Variable editor Form Type select',\r\n    generalLabelInput: 'Variable editor Form Label field',\r\n    generalHideSelect: 'Variable editor Form Hide select',\r\n    selectionOptionsMultiSwitch: 'Variable editor Form Multi switch',\r\n    selectionOptionsIncludeAllSwitch: 'Variable editor Form IncludeAll switch',\r\n    selectionOptionsCustomAllInput: 'Variable editor Form IncludeAll field',\r\n    previewOfValuesOption: 'Variable editor Preview of Values option',\r\n    addButton: 'Variable editor Add button',\r\n    updateButton: 'Variable editor Update button',\r\n  },\r\n});\r\n\r\nexport const QueryVariable = pageFactory({\r\n  url: '',\r\n  selectors: {\r\n    queryOptionsDataSourceSelect: 'Variable editor Form Query DataSource select',\r\n    queryOptionsRefreshSelect: 'Variable editor Form Query Refresh select',\r\n    queryOptionsRegExInput: 'Variable editor Form Query RegEx field',\r\n    queryOptionsSortSelect: 'Variable editor Form Query Sort select',\r\n    queryOptionsQueryInput: 'Variable editor Form Default Variable Query Editor textarea',\r\n    valueGroupsTagsEnabledSwitch: 'Variable editor Form Query UseTags switch',\r\n    valueGroupsTagsTagsQueryInput: 'Variable editor Form Query TagsQuery field',\r\n    valueGroupsTagsTagsValuesQueryInput: 'Variable editor Form Query TagsValuesQuery field',\r\n  },\r\n});\r\n\r\nexport const ConstantVariable = pageFactory({\r\n  url: '',\r\n  selectors: {\r\n    constantOptionsQueryInput: 'Variable editor Form Constant Query field',\r\n  },\r\n});\r\n","export * from './types';\r\nexport * from './selector';\r\nexport * from './scenarioContext';\r\n","import { e2e } from '../index';\r\n\r\nexport interface ScenarioArguments {\r\n  describeName: string;\r\n  itName: string;\r\n  scenario: () => void;\r\n  skipScenario?: boolean;\r\n  addScenarioDataSource?: boolean;\r\n  addScenarioDashBoard?: boolean;\r\n}\r\n\r\nexport const e2eScenario = ({\r\n  describeName,\r\n  itName,\r\n  scenario,\r\n  skipScenario = false,\r\n  addScenarioDataSource = false,\r\n  addScenarioDashBoard = false,\r\n}: ScenarioArguments) => {\r\n  describe(describeName, () => {\r\n    if (skipScenario) {\r\n      it.skip(itName, () => {\r\n        // @ts-ignore yarn start in root throws error otherwise\r\n        expect(false).equals(true);\r\n      });\r\n      return;\r\n    }\r\n\r\n    beforeEach(() => {\r\n      e2e.flows.login('admin', 'admin');\r\n      if (addScenarioDataSource) {\r\n        e2e.flows.addDataSource('TestData DB');\r\n      }\r\n      if (addScenarioDashBoard) {\r\n        e2e.flows.addDashboard();\r\n      }\r\n    });\r\n\r\n    afterEach(() => {\r\n      if (e2e.context().get('lastAddedDataSource')) {\r\n        e2e.flows.deleteDataSource(e2e.context().get('lastAddedDataSource'));\r\n      }\r\n      if (e2e.context().get('lastAddedDashboardUid')) {\r\n        e2e.flows.deleteDashboard(e2e.context().get('lastAddedDashboardUid'));\r\n      }\r\n    });\r\n\r\n    it(itName, () => {\r\n      scenario();\r\n    });\r\n  });\r\n};\r\n","export interface ScenarioContext {\r\n  lastAddedDataSource: string;\r\n  lastAddedDashboard: string;\r\n  lastAddedDashboardUid: string;\r\n  [key: string]: any;\r\n}\r\n\r\nconst scenarioContexts: ScenarioContext = {\r\n  lastAddedDataSource: '',\r\n  lastAddedDashboard: '',\r\n  lastAddedDashboardUid: '',\r\n};\r\n\r\nexport interface ScenarioContextApi {\r\n  get: <T>(name: string | keyof ScenarioContext) => T;\r\n  set: <T>(name: string | keyof ScenarioContext, value: T) => void;\r\n}\r\n\r\nexport const scenarioContext = (): ScenarioContextApi => {\r\n  const get = <T>(name: string | keyof ScenarioContext): T => scenarioContexts[name] as T;\r\n  const set = <T>(name: string | keyof ScenarioContext, value: T): void => {\r\n    scenarioContexts[name] = value;\r\n  };\r\n\r\n  return {\r\n    get,\r\n    set,\r\n  };\r\n};\r\n","export interface SelectorApi {\r\n  fromAriaLabel: (selector: string) => string;\r\n  fromSelector: (selector: string) => string;\r\n}\r\n\r\nexport const Selector: SelectorApi = {\r\n  fromAriaLabel: (selector: string) => `[aria-label=\"${selector}\"]`,\r\n  fromSelector: (selector: string) => selector,\r\n};\r\n","import { Selector } from './selector';\r\nimport { Url } from './url';\r\nimport { e2e } from '../index';\r\nimport { SelectorFunction, SelectorObject } from '../noTypeCheck';\r\n\r\nexport type Selectors = Record<string, string | Function>;\r\nexport type PageObjects<S> = { [P in keyof S]: SelectorFunction };\r\nexport type PageFactory<S> = PageObjects<S> & SelectorObject<S>;\r\nexport interface PageFactoryArgs<S extends Selectors> {\r\n  url?: string | Function;\r\n  selectors: S;\r\n}\r\n\r\nexport const pageFactory = <S extends Selectors>({ url, selectors }: PageFactoryArgs<S>): PageFactory<S> => {\r\n  const visit = (args?: string) => {\r\n    if (!url) {\r\n      return e2e().visit('');\r\n    }\r\n\r\n    let parsedUrl = '';\r\n    if (typeof url === 'string') {\r\n      parsedUrl = Url.fromBaseUrl(url);\r\n    }\r\n\r\n    if (typeof url === 'function' && args) {\r\n      parsedUrl = Url.fromBaseUrl(url(args));\r\n    }\r\n\r\n    e2e().logToConsole('Visiting', parsedUrl);\r\n    return e2e().visit(parsedUrl);\r\n  };\r\n  const pageObjects: PageObjects<S> = {} as PageObjects<S>;\r\n  const keys = Object.keys(selectors);\r\n\r\n  keys.forEach(key => {\r\n    const value = selectors[key];\r\n    if (typeof value === 'string') {\r\n      // @ts-ignore\r\n      pageObjects[key] = () => {\r\n        e2e().logToConsole('Retrieving Selector:', value);\r\n        return e2e().get(Selector.fromAriaLabel(value));\r\n      };\r\n    }\r\n    if (typeof value === 'function') {\r\n      // @ts-ignore\r\n      pageObjects[key] = (text?: string) => {\r\n        if (!text) {\r\n          const selector = value();\r\n          e2e().logToConsole('Retrieving Selector:', selector);\r\n          return e2e().get(selector);\r\n        }\r\n        const selector = value(text);\r\n        e2e().logToConsole('Retrieving Selector:', selector);\r\n        return e2e().get(Selector.fromAriaLabel(selector));\r\n      };\r\n    }\r\n  });\r\n\r\n  return {\r\n    visit,\r\n    ...pageObjects,\r\n    selectors,\r\n  };\r\n};\r\n","import { e2e } from '../index';\r\n\r\nexport interface UrlApi {\r\n  fromBaseUrl: (url: string | undefined) => string;\r\n  getDashboardUid: (url: string) => string;\r\n}\r\n\r\nconst uidRegex = '\\\\/d\\\\/(.*)\\\\/';\r\nconst getBaseUrl = () => e2e.env('BASE_URL') || e2e.config().baseUrl || 'http://localhost:3000';\r\n\r\nexport const Url: UrlApi = {\r\n  fromBaseUrl: (url: string | undefined) => {\r\n    url = url || '';\r\n    const strippedUrl = url.replace('^/', '');\r\n    return `${getBaseUrl()}${strippedUrl}`;\r\n  },\r\n  getDashboardUid: (url: string) => {\r\n    const matches = url.match(uidRegex);\r\n    if (!matches) {\r\n      throw new Error(`Couldn't parse uid from ${url}`);\r\n    }\r\n\r\n    return matches[1];\r\n  },\r\n};\r\n","import extend from 'lodash/extend';\r\nimport { getTheme } from '@grafana/ui';\r\nimport { GrafanaTheme, GrafanaThemeType, PanelPluginMeta, DataSourceInstanceSettings } from '@grafana/data';\r\n\r\nexport interface BuildInfo {\r\n  version: string;\r\n  commit: string;\r\n  isEnterprise: boolean; // deprecated: use licenseInfo.hasLicense instead\r\n  env: string;\r\n  edition: string;\r\n  latestVersion: string;\r\n  hasUpdate: boolean;\r\n}\r\n\r\ninterface FeatureToggles {\r\n  transformations: boolean;\r\n  inspect: boolean;\r\n  expressions: boolean;\r\n  newEdit: boolean;\r\n}\r\n\r\ninterface LicenseInfo {\r\n  hasLicense: boolean;\r\n  expiry: number;\r\n  licenseUrl: string;\r\n  stateInfo: string;\r\n}\r\n\r\nexport class GrafanaBootConfig {\r\n  datasources: { [str: string]: DataSourceInstanceSettings } = {};\r\n  panels: { [key: string]: PanelPluginMeta } = {};\r\n  appSubUrl = '';\r\n  windowTitlePrefix = '';\r\n  buildInfo: BuildInfo = {} as BuildInfo;\r\n  newPanelTitle = '';\r\n  bootData: any;\r\n  externalUserMngLinkUrl = '';\r\n  externalUserMngLinkName = '';\r\n  externalUserMngInfo = '';\r\n  allowOrgCreate = false;\r\n  disableLoginForm = false;\r\n  defaultDatasource = '';\r\n  alertingEnabled = false;\r\n  alertingErrorOrTimeout = '';\r\n  alertingNoDataOrNullValues = '';\r\n  alertingMinInterval = 1;\r\n  authProxyEnabled = false;\r\n  exploreEnabled = false;\r\n  ldapEnabled = false;\r\n  samlEnabled = false;\r\n  oauth: any;\r\n  disableUserSignUp = false;\r\n  loginHint: any;\r\n  passwordHint: any;\r\n  loginError: any;\r\n  viewersCanEdit = false;\r\n  editorsCanAdmin = false;\r\n  disableSanitizeHtml = false;\r\n  theme: GrafanaTheme;\r\n  pluginsToPreload: string[] = [];\r\n  featureToggles: FeatureToggles = {\r\n    transformations: false,\r\n    inspect: false,\r\n    expressions: false,\r\n    newEdit: false,\r\n  };\r\n  licenseInfo: LicenseInfo = {} as LicenseInfo;\r\n\r\n  constructor(options: GrafanaBootConfig) {\r\n    this.theme = options.bootData.user.lightTheme ? getTheme(GrafanaThemeType.Light) : getTheme(GrafanaThemeType.Dark);\r\n\r\n    const defaults = {\r\n      datasources: {},\r\n      windowTitlePrefix: 'Grafana - ',\r\n      panels: {},\r\n      newPanelTitle: 'Panel Title',\r\n      playlist_timespan: '1m',\r\n      unsaved_changes_warning: true,\r\n      appSubUrl: '',\r\n      buildInfo: {\r\n        version: 'v1.0',\r\n        commit: '1',\r\n        env: 'production',\r\n        isEnterprise: false,\r\n      },\r\n      viewersCanEdit: false,\r\n      editorsCanAdmin: false,\r\n      disableSanitizeHtml: false,\r\n    };\r\n\r\n    extend(this, defaults, options);\r\n  }\r\n}\r\n\r\nconst bootData = (window as any).grafanaBootData || {\r\n  settings: {},\r\n  user: {},\r\n};\r\n\r\nconst options = bootData.settings;\r\noptions.bootData = bootData;\r\n\r\nexport const config = new GrafanaBootConfig(options);\r\n","export * from './services';\r\nexport * from './config';\r\nexport * from './types';\r\nexport { loadPluginCss, SystemJS } from './utils/plugin';\r\nexport { reportMetaAnalytics } from './utils/analytics';\r\n\r\nexport { DataSourceWithBackend } from './utils/DataSourceWithBackend';\r\n","export interface AngularComponent {\r\n  destroy(): void;\r\n  digest(): void;\r\n  getScope(): any;\r\n}\r\n\r\nexport interface AngularLoader {\r\n  load(elem: any, scopeProps: any, template: string): AngularComponent;\r\n}\r\n\r\nlet instance: AngularLoader;\r\n\r\nexport function setAngularLoader(v: AngularLoader) {\r\n  instance = v;\r\n}\r\n\r\nexport function getAngularLoader(): AngularLoader {\r\n  return instance;\r\n}\r\n","interface SizeMeta {\r\n  width: number;\r\n  height: number;\r\n}\r\n\r\nexport interface EchoMeta {\r\n  screenSize: SizeMeta;\r\n  windowSize: SizeMeta;\r\n  userAgent: string;\r\n  url?: string;\r\n  /**\r\n   * A unique browser session\r\n   */\r\n  sessionId: string;\r\n  userLogin: string;\r\n  userId: number;\r\n  userSignedIn: boolean;\r\n  /**\r\n   * A millisecond epoch\r\n   */\r\n  ts: number;\r\n  /**\r\n   * A highres timestamp since navigation start\r\n   */\r\n  timeSinceNavigationStart: number;\r\n}\r\n\r\nexport interface EchoBackend<T extends EchoEvent = any, O = any> {\r\n  options: O;\r\n  supportedEvents: EchoEventType[];\r\n  flush: () => void;\r\n  addEvent: (event: T) => void;\r\n}\r\n\r\nexport interface EchoEvent<T extends EchoEventType = any, P = any> {\r\n  type: EchoEventType;\r\n  payload: P;\r\n  meta: EchoMeta;\r\n}\r\n\r\nexport enum EchoEventType {\r\n  Performance = 'performance',\r\n  MetaAnalytics = 'meta-analytics',\r\n}\r\n\r\nexport interface EchoSrv {\r\n  flush(): void;\r\n  addBackend(backend: EchoBackend): void;\r\n  addEvent<T extends EchoEvent>(event: Omit<T, 'meta'>, meta?: {}): void;\r\n}\r\n\r\nlet singletonInstance: EchoSrv;\r\n\r\nexport function setEchoSrv(instance: EchoSrv) {\r\n  singletonInstance = instance;\r\n}\r\n\r\nexport function getEchoSrv(): EchoSrv {\r\n  return singletonInstance;\r\n}\r\n\r\nexport const registerEchoBackend = (backend: EchoBackend) => {\r\n  getEchoSrv().addBackend(backend);\r\n};\r\n","export interface LocationUpdate {\r\n  path?: string;\r\n  query?: UrlQueryMap;\r\n\r\n  /**\r\n   * Add the query argument to the existing URL\r\n   */\r\n  partial?: boolean;\r\n\r\n  /**\r\n   * Do not change this unless you are the angular router\r\n   */\r\n  routeParams?: UrlQueryMap;\r\n\r\n  /*\r\n   * If true this will replace url state (ie cause no new browser history)\r\n   */\r\n  replace?: boolean;\r\n}\r\n\r\nexport type UrlQueryValue = string | number | boolean | string[] | number[] | boolean[] | undefined;\r\nexport type UrlQueryMap = Record<string, UrlQueryValue>;\r\n\r\nexport interface LocationSrv {\r\n  update(options: LocationUpdate): void;\r\n}\r\n\r\nlet singletonInstance: LocationSrv;\r\n\r\nexport function setLocationSrv(instance: LocationSrv) {\r\n  singletonInstance = instance;\r\n}\r\n\r\nexport function getLocationSrv(): LocationSrv {\r\n  return singletonInstance;\r\n}\r\n","/**\r\n * Currently implemented with:\r\n * https://docs.angularjs.org/api/ng/service/$http#usage\r\n * but that will likely change in the future\r\n */\r\nexport type BackendSrvRequest = {\r\n  url: string;\r\n  retry?: number;\r\n  headers?: any;\r\n  method?: string;\r\n\r\n  // Show a message with the result\r\n  showSuccessAlert?: boolean;\r\n\r\n  // A requestID is provided by the datasource as a unique identifier for a\r\n  // particular query. If the requestID exists, the promise it is keyed to\r\n  // is canceled, canceling the previous datasource request if it is still\r\n  // in-flight.\r\n  requestId?: string;\r\n\r\n  // Allow any other parameters\r\n  [key: string]: any;\r\n};\r\n\r\nexport interface BackendSrv {\r\n  get(url: string, params?: any): Promise<any>;\r\n\r\n  delete(url: string): Promise<any>;\r\n\r\n  post(url: string, data?: any): Promise<any>;\r\n\r\n  patch(url: string, data?: any): Promise<any>;\r\n\r\n  put(url: string, data?: any): Promise<any>;\r\n\r\n  // If there is an error, set: err.isHandled = true\r\n  // otherwise the backend will show a message for you\r\n  request(options: BackendSrvRequest): Promise<any>;\r\n\r\n  // DataSource requests add hooks into the query inspector\r\n  datasourceRequest(options: BackendSrvRequest): Promise<any>;\r\n}\r\n\r\nlet singletonInstance: BackendSrv;\r\n\r\nexport function setBackendSrv(instance: BackendSrv) {\r\n  singletonInstance = instance;\r\n}\r\n\r\nexport function getBackendSrv(): BackendSrv {\r\n  return singletonInstance;\r\n}\r\n","import { ScopedVars, DataSourceApi } from '@grafana/data';\r\n\r\nexport interface DataSourceSrv {\r\n  get(name?: string, scopedVars?: ScopedVars): Promise<DataSourceApi>;\r\n}\r\n\r\nlet singletonInstance: DataSourceSrv;\r\n\r\nexport function setDataSourceSrv(instance: DataSourceSrv) {\r\n  singletonInstance = instance;\r\n}\r\n\r\nexport function getDataSourceSrv(): DataSourceSrv {\r\n  return singletonInstance;\r\n}\r\n","export * from './backendSrv';\r\nexport * from './AngularLoader';\r\nexport * from './dataSourceSrv';\r\nexport * from './LocationSrv';\r\nexport * from './EchoSrv';\r\n","export * from './analytics';\n","import {\r\n  DataSourceApi,\r\n  DataQueryRequest,\r\n  DataQueryResponse,\r\n  DataSourceInstanceSettings,\r\n  DataQuery,\r\n  DataSourceJsonData,\r\n} from '@grafana/data';\r\nimport { Observable, from } from 'rxjs';\r\nimport { config } from '..';\r\nimport { getBackendSrv } from '../services';\r\n\r\n// Ideally internal (exported for consistency)\r\nconst ExpressionDatasourceID = '__expr__';\r\n\r\nexport class DataSourceWithBackend<\r\n  TQuery extends DataQuery = DataQuery,\r\n  TOptions extends DataSourceJsonData = DataSourceJsonData\r\n> extends DataSourceApi<TQuery, TOptions> {\r\n  constructor(instanceSettings: DataSourceInstanceSettings<TOptions>) {\r\n    super(instanceSettings);\r\n  }\r\n\r\n  /**\r\n   * Ideally final -- any other implementation would be wrong!\r\n   */\r\n  query(request: DataQueryRequest): Observable<DataQueryResponse> {\r\n    const { targets, intervalMs, maxDataPoints, range } = request;\r\n\r\n    let expressionCount = 0;\r\n    const orgId = config.bootData.user.orgId;\r\n    const queries = targets.map(q => {\r\n      if (q.datasource === ExpressionDatasourceID) {\r\n        expressionCount++;\r\n        return {\r\n          ...q,\r\n          datasourceId: this.id,\r\n          orgId,\r\n        };\r\n      }\r\n      const dsName = q.datasource && q.datasource !== 'default' ? q.datasource : config.defaultDatasource;\r\n      const ds = config.datasources[dsName];\r\n      if (!ds) {\r\n        throw new Error('Unknown Datasource: ' + q.datasource);\r\n      }\r\n      return {\r\n        ...q,\r\n        datasourceId: ds.id,\r\n        intervalMs,\r\n        maxDataPoints,\r\n        orgId,\r\n      };\r\n    });\r\n\r\n    const body: any = {\r\n      expressionCount,\r\n      queries,\r\n    };\r\n    if (range) {\r\n      body.range = range;\r\n      body.from = range.from.valueOf().toString();\r\n      body.to = range.to.valueOf().toString();\r\n    }\r\n\r\n    const req: Promise<DataQueryResponse> = getBackendSrv()\r\n      .post('/api/ds/query', body)\r\n      .then((rsp: any) => {\r\n        return this.toDataQueryResponse(rsp);\r\n      });\r\n    return from(req);\r\n  }\r\n\r\n  /**\r\n   * This makes the arrow libary loading async.\r\n   */\r\n  async toDataQueryResponse(rsp: any): Promise<DataQueryResponse> {\r\n    const { resultsToDataFrames } = await import(\r\n      /* webpackChunkName: \"apache-arrow-util\" */ '@grafana/data/src/dataframe/ArrowDataFrame'\r\n    );\r\n    return { data: resultsToDataFrames(rsp) };\r\n  }\r\n\r\n  testDatasource() {\r\n    // TODO, this will call the backend healthcheck endpoint\r\n    return Promise.resolve({});\r\n  }\r\n}\r\n","import { getEchoSrv, EchoEventType } from '../services/EchoSrv';\r\nimport { MetaAnalyticsEvent, MetaAnalyticsEventPayload } from '../types/analytics';\r\n\r\nexport const reportMetaAnalytics = (payload: MetaAnalyticsEventPayload) => {\r\n  getEchoSrv().addEvent<MetaAnalyticsEvent>({\r\n    type: EchoEventType.MetaAnalytics,\r\n    payload,\r\n  });\r\n};\r\n","import { config } from '../config';\r\n\r\n// @ts-ignore\r\nimport System from 'systemjs/dist/system.js';\r\n\r\nexport interface PluginCssOptions {\r\n  light: string;\r\n  dark: string;\r\n}\r\n\r\nexport const SystemJS = System;\r\n\r\nexport function loadPluginCss(options: PluginCssOptions): Promise<any> {\r\n  const theme = config.bootData.user.lightTheme ? options.light : options.dark;\r\n  return SystemJS.import(`${theme}!css`);\r\n}\r\n","import React, { FC, ReactNode } from 'react';\r\nimport classNames from 'classnames';\r\n\r\nexport type AlertVariant = 'success' | 'warning' | 'error' | 'info';\r\n\r\ninterface AlertProps {\r\n  title: string;\r\n  buttonText?: string;\r\n  onButtonClick?: (event: React.MouseEvent) => void;\r\n  onRemove?: (event: React.MouseEvent) => void;\r\n  severity?: AlertVariant;\r\n  children?: ReactNode;\r\n}\r\n\r\nfunction getIconFromSeverity(severity: AlertVariant): string {\r\n  switch (severity) {\r\n    case 'error': {\r\n      return 'fa fa-exclamation-triangle';\r\n    }\r\n    case 'warning': {\r\n      return 'fa fa-exclamation-triangle';\r\n    }\r\n    case 'info': {\r\n      return 'fa fa-info-circle';\r\n    }\r\n    case 'success': {\r\n      return 'fa fa-check';\r\n    }\r\n    default:\r\n      return '';\r\n  }\r\n}\r\n\r\nexport const Alert: FC<AlertProps> = ({ title, buttonText, onButtonClick, onRemove, children, severity = 'error' }) => {\r\n  const alertClass = classNames('alert', `alert-${severity}`);\r\n  return (\r\n    <div className=\"alert-container\">\r\n      <div className={alertClass}>\r\n        <div className=\"alert-icon\">\r\n          <i className={getIconFromSeverity(severity)} />\r\n        </div>\r\n        <div className=\"alert-body\">\r\n          <div className=\"alert-title\">{title}</div>\r\n          {children && <div className=\"alert-text\">{children}</div>}\r\n        </div>\r\n        {/* If onRemove is specified , giving preference to onRemove */}\r\n        {onRemove && (\r\n          <button type=\"button\" className=\"alert-close\" onClick={onRemove}>\r\n            <i className=\"fa fa fa-remove\" />\r\n          </button>\r\n        )}\r\n        {onButtonClick && (\r\n          <button type=\"button\" className=\"btn btn-outline-danger\" onClick={onButtonClick}>\r\n            {buttonText}\r\n          </button>\r\n        )}\r\n      </div>\r\n    </div>\r\n  );\r\n};\r\n","import React, { FC, useContext } from 'react';\r\nimport { css, cx } from 'emotion';\r\nimport { ThemeContext } from '../../index';\r\nimport { PluginState } from '@grafana/data';\r\n\r\ninterface Props {\r\n  state?: PluginState;\r\n  text?: string;\r\n  className?: string;\r\n}\r\n\r\nexport const AlphaNotice: FC<Props> = ({ state, text, className }) => {\r\n  const tooltipContent = text || 'This feature is a work in progress and updates may include breaking changes';\r\n  const theme = useContext(ThemeContext);\r\n\r\n  const styles = cx(\r\n    className,\r\n    css`\r\n      background: linear-gradient(to bottom, ${theme.colors.blueBase}, ${theme.colors.blueShade});\r\n      color: ${theme.colors.gray7};\r\n      white-space: nowrap;\r\n      border-radius: 3px;\r\n      text-shadow: none;\r\n      font-size: 13px;\r\n      padding: 4px 8px;\r\n      cursor: help;\r\n      display: inline-block;\r\n    `\r\n  );\r\n\r\n  return (\r\n    <div className={styles} title={tooltipContent}>\r\n      <i className=\"fa fa-warning\" /> {state}\r\n    </div>\r\n  );\r\n};\r\n","// Library\r\nimport React, { PureComponent, CSSProperties, ReactNode } from 'react';\r\nimport tinycolor from 'tinycolor2';\r\nimport * as d3 from 'd3-scale-chromatic';\r\nimport {\r\n  TimeSeriesValue,\r\n  DisplayValue,\r\n  formattedValueToString,\r\n  FormattedValue,\r\n  DisplayValueAlignmentFactors,\r\n  ThresholdsMode,\r\n  DisplayProcessor,\r\n  FieldConfig,\r\n  FieldColorMode,\r\n} from '@grafana/data';\r\n\r\n// Compontents\r\nimport { FormattedValueDisplay } from '../FormattedValueDisplay/FormattedValueDisplay';\r\n\r\n// Utils\r\nimport { getColorFromHexRgbOrName } from '@grafana/data';\r\nimport { measureText, calculateFontSize } from '../../utils/measureText';\r\n\r\n// Types\r\nimport { VizOrientation } from '@grafana/data';\r\nimport { Themeable } from '../../types';\r\n\r\nconst MIN_VALUE_HEIGHT = 18;\r\nconst MAX_VALUE_HEIGHT = 50;\r\nconst MIN_VALUE_WIDTH = 50;\r\nconst MAX_VALUE_WIDTH = 150;\r\nconst TITLE_LINE_HEIGHT = 1.5;\r\nconst VALUE_LINE_HEIGHT = 1;\r\nconst VALUE_LEFT_PADDING = 10;\r\n\r\nexport interface Props extends Themeable {\r\n  height: number;\r\n  width: number;\r\n  field: FieldConfig;\r\n  display: DisplayProcessor;\r\n  value: DisplayValue;\r\n  orientation: VizOrientation;\r\n  itemSpacing?: number;\r\n  lcdCellWidth?: number;\r\n  displayMode: BarGaugeDisplayMode;\r\n  onClick?: React.MouseEventHandler<HTMLElement>;\r\n  className?: string;\r\n  showUnfilled?: boolean;\r\n  alignmentFactors?: DisplayValueAlignmentFactors;\r\n}\r\n\r\nexport enum BarGaugeDisplayMode {\r\n  Basic = 'basic',\r\n  Lcd = 'lcd',\r\n  Gradient = 'gradient',\r\n}\r\n\r\nexport class BarGauge extends PureComponent<Props> {\r\n  static defaultProps: Partial<Props> = {\r\n    lcdCellWidth: 12,\r\n    value: {\r\n      text: '100',\r\n      numeric: 100,\r\n    },\r\n    displayMode: BarGaugeDisplayMode.Gradient,\r\n    orientation: VizOrientation.Horizontal,\r\n    field: {\r\n      min: 0,\r\n      max: 100,\r\n      thresholds: {\r\n        mode: ThresholdsMode.Absolute,\r\n        steps: [],\r\n      },\r\n    },\r\n    itemSpacing: 10,\r\n    showUnfilled: true,\r\n  };\r\n\r\n  render() {\r\n    const { onClick, className } = this.props;\r\n    const { title } = this.props.value;\r\n    const styles = getTitleStyles(this.props);\r\n\r\n    if (!title) {\r\n      return (\r\n        <div style={styles.wrapper} onClick={onClick} className={className}>\r\n          {this.renderBarAndValue()}\r\n        </div>\r\n      );\r\n    }\r\n\r\n    return (\r\n      <div style={styles.wrapper} onClick={onClick} className={className}>\r\n        <div style={styles.title}>{title}</div>\r\n        {this.renderBarAndValue()}\r\n      </div>\r\n    );\r\n  }\r\n\r\n  renderBarAndValue() {\r\n    switch (this.props.displayMode) {\r\n      case 'lcd':\r\n        return this.renderRetroBars();\r\n      case 'basic':\r\n      case 'gradient':\r\n      default:\r\n        return this.renderBasicAndGradientBars();\r\n    }\r\n  }\r\n\r\n  renderBasicAndGradientBars(): ReactNode {\r\n    const { value, showUnfilled } = this.props;\r\n\r\n    const styles = getBasicAndGradientStyles(this.props);\r\n\r\n    return (\r\n      <div style={styles.wrapper}>\r\n        <FormattedValueDisplay className=\"bar-gauge__value\" value={value} style={styles.value} />\r\n        {showUnfilled && <div style={styles.emptyBar} />}\r\n        <div style={styles.bar} />\r\n      </div>\r\n    );\r\n  }\r\n\r\n  getCellColor(positionValue: TimeSeriesValue): CellColors {\r\n    const { value, display } = this.props;\r\n    if (positionValue === null) {\r\n      return {\r\n        background: 'gray',\r\n        border: 'gray',\r\n      };\r\n    }\r\n\r\n    const color = display(positionValue).color;\r\n    if (color) {\r\n      // if we are past real value the cell is not \"on\"\r\n      if (value === null || (positionValue !== null && positionValue > value.numeric)) {\r\n        return {\r\n          background: tinycolor(color)\r\n            .setAlpha(0.18)\r\n            .toRgbString(),\r\n          border: 'transparent',\r\n          isLit: false,\r\n        };\r\n      } else {\r\n        return {\r\n          background: tinycolor(color)\r\n            .setAlpha(0.95)\r\n            .toRgbString(),\r\n          backgroundShade: tinycolor(color)\r\n            .setAlpha(0.55)\r\n            .toRgbString(),\r\n          border: tinycolor(color)\r\n            .setAlpha(0.9)\r\n            .toRgbString(),\r\n          isLit: true,\r\n        };\r\n      }\r\n    }\r\n\r\n    return {\r\n      background: 'gray',\r\n      border: 'gray',\r\n    };\r\n  }\r\n\r\n  renderRetroBars(): ReactNode {\r\n    const { field, value, itemSpacing, alignmentFactors, orientation, lcdCellWidth } = this.props;\r\n    const {\r\n      valueHeight,\r\n      valueWidth,\r\n      maxBarHeight,\r\n      maxBarWidth,\r\n      wrapperWidth,\r\n      wrapperHeight,\r\n    } = calculateBarAndValueDimensions(this.props);\r\n    const minValue = field.min!;\r\n    const maxValue = field.max!;\r\n\r\n    const isVert = isVertical(orientation);\r\n    const valueRange = maxValue - minValue;\r\n    const maxSize = isVert ? maxBarHeight : maxBarWidth;\r\n    const cellSpacing = itemSpacing!;\r\n    const cellCount = Math.floor(maxSize / lcdCellWidth!);\r\n    const cellSize = Math.floor((maxSize - cellSpacing * cellCount) / cellCount);\r\n    const valueColor = getValueColor(this.props);\r\n\r\n    const valueToBaseSizeOn = alignmentFactors ? alignmentFactors : value;\r\n    const valueStyles = getValueStyles(valueToBaseSizeOn, valueColor, valueWidth, valueHeight, orientation);\r\n\r\n    const containerStyles: CSSProperties = {\r\n      width: `${wrapperWidth}px`,\r\n      height: `${wrapperHeight}px`,\r\n      display: 'flex',\r\n    };\r\n\r\n    if (isVert) {\r\n      containerStyles.flexDirection = 'column-reverse';\r\n      containerStyles.alignItems = 'center';\r\n    } else {\r\n      containerStyles.flexDirection = 'row';\r\n      containerStyles.alignItems = 'center';\r\n      valueStyles.justifyContent = 'flex-end';\r\n    }\r\n\r\n    const cells: JSX.Element[] = [];\r\n\r\n    for (let i = 0; i < cellCount; i++) {\r\n      const currentValue = minValue + (valueRange / cellCount) * i;\r\n      const cellColor = this.getCellColor(currentValue);\r\n      const cellStyles: CSSProperties = {\r\n        borderRadius: '2px',\r\n      };\r\n\r\n      if (cellColor.isLit) {\r\n        cellStyles.backgroundImage = `radial-gradient(${cellColor.background} 10%, ${cellColor.backgroundShade})`;\r\n      } else {\r\n        cellStyles.backgroundColor = cellColor.background;\r\n      }\r\n\r\n      if (isVert) {\r\n        cellStyles.height = `${cellSize}px`;\r\n        cellStyles.width = `${maxBarWidth}px`;\r\n        cellStyles.marginTop = `${cellSpacing}px`;\r\n      } else {\r\n        cellStyles.width = `${cellSize}px`;\r\n        cellStyles.height = `${maxBarHeight}px`;\r\n        cellStyles.marginRight = `${cellSpacing}px`;\r\n      }\r\n\r\n      cells.push(<div key={i.toString()} style={cellStyles} />);\r\n    }\r\n\r\n    return (\r\n      <div style={containerStyles}>\r\n        {cells}\r\n        <FormattedValueDisplay className=\"bar-gauge__value\" value={value} style={valueStyles} />\r\n      </div>\r\n    );\r\n  }\r\n}\r\n\r\ninterface CellColors {\r\n  background: string;\r\n  backgroundShade?: string;\r\n  border: string;\r\n  isLit?: boolean;\r\n}\r\n\r\ninterface TitleDimensions {\r\n  fontSize: number;\r\n  placement: 'above' | 'left' | 'below';\r\n  width: number;\r\n  height: number;\r\n}\r\n\r\nfunction isVertical(orientation: VizOrientation) {\r\n  return orientation === VizOrientation.Vertical;\r\n}\r\n\r\nfunction calculateTitleDimensions(props: Props): TitleDimensions {\r\n  const { height, width, alignmentFactors, orientation } = props;\r\n  const title = alignmentFactors ? alignmentFactors.title : props.value.title;\r\n\r\n  if (!title) {\r\n    return { fontSize: 0, width: 0, height: 0, placement: 'above' };\r\n  }\r\n\r\n  if (isVertical(orientation)) {\r\n    return {\r\n      fontSize: 14,\r\n      width: width,\r\n      height: 14 * TITLE_LINE_HEIGHT,\r\n      placement: 'below',\r\n    };\r\n  }\r\n\r\n  // if height above 40 put text to above bar\r\n  if (height > 40) {\r\n    const maxTitleHeightRatio = 0.45;\r\n    const titleHeight = Math.max(Math.min(height * maxTitleHeightRatio, MAX_VALUE_HEIGHT), 17);\r\n\r\n    return {\r\n      fontSize: titleHeight / TITLE_LINE_HEIGHT,\r\n      width: 0,\r\n      height: titleHeight,\r\n      placement: 'above',\r\n    };\r\n  }\r\n\r\n  // title to left of bar scenario\r\n  const maxTitleHeightRatio = 0.6;\r\n  const titleHeight = Math.max(height * maxTitleHeightRatio, MIN_VALUE_HEIGHT);\r\n  const titleFontSize = titleHeight / TITLE_LINE_HEIGHT;\r\n  const textSize = measureText(title, titleFontSize);\r\n\r\n  return {\r\n    fontSize: titleFontSize,\r\n    height: 0,\r\n    width: textSize.width + 15,\r\n    placement: 'left',\r\n  };\r\n}\r\n\r\nexport function getTitleStyles(props: Props): { wrapper: CSSProperties; title: CSSProperties } {\r\n  const wrapperStyles: CSSProperties = {\r\n    display: 'flex',\r\n    overflow: 'hidden',\r\n    width: '100%',\r\n  };\r\n\r\n  const titleDim = calculateTitleDimensions(props);\r\n\r\n  const titleStyles: CSSProperties = {\r\n    fontSize: `${titleDim.fontSize}px`,\r\n    whiteSpace: 'nowrap',\r\n    overflow: 'hidden',\r\n    textOverflow: 'ellipsis',\r\n    width: '100%',\r\n    alignItems: 'center',\r\n    alignSelf: 'center',\r\n  };\r\n\r\n  if (isVertical(props.orientation)) {\r\n    wrapperStyles.flexDirection = 'column-reverse';\r\n    titleStyles.textAlign = 'center';\r\n  } else {\r\n    if (titleDim.placement === 'above') {\r\n      wrapperStyles.flexDirection = 'column';\r\n    } else {\r\n      wrapperStyles.flexDirection = 'row';\r\n\r\n      titleStyles.width = `${titleDim.width}px`;\r\n      titleStyles.textAlign = 'right';\r\n      titleStyles.paddingRight = '10px';\r\n    }\r\n  }\r\n\r\n  return {\r\n    wrapper: wrapperStyles,\r\n    title: titleStyles,\r\n  };\r\n}\r\n\r\ninterface BasicAndGradientStyles {\r\n  wrapper: CSSProperties;\r\n  bar: CSSProperties;\r\n  emptyBar: CSSProperties;\r\n  value: CSSProperties;\r\n}\r\n\r\ninterface BarAndValueDimensions {\r\n  valueWidth: number;\r\n  valueHeight: number;\r\n  maxBarWidth: number;\r\n  maxBarHeight: number;\r\n  wrapperHeight: number;\r\n  wrapperWidth: number;\r\n}\r\n\r\nfunction calculateBarAndValueDimensions(props: Props): BarAndValueDimensions {\r\n  const { height, width, orientation } = props;\r\n  const titleDim = calculateTitleDimensions(props);\r\n\r\n  let maxBarHeight = 0;\r\n  let maxBarWidth = 0;\r\n  let valueHeight = 0;\r\n  let valueWidth = 0;\r\n  let wrapperWidth = 0;\r\n  let wrapperHeight = 0;\r\n\r\n  if (isVertical(orientation)) {\r\n    valueHeight = Math.min(Math.max(height * 0.1, MIN_VALUE_HEIGHT), MAX_VALUE_HEIGHT);\r\n    valueWidth = width;\r\n    maxBarHeight = height - (titleDim.height + valueHeight);\r\n    maxBarWidth = width;\r\n    wrapperWidth = width;\r\n    wrapperHeight = height - titleDim.height;\r\n  } else {\r\n    valueHeight = height - titleDim.height;\r\n    valueWidth = Math.max(Math.min(width * 0.2, MAX_VALUE_WIDTH), MIN_VALUE_WIDTH);\r\n    maxBarHeight = height - titleDim.height;\r\n    maxBarWidth = width - valueWidth - titleDim.width;\r\n\r\n    if (titleDim.placement === 'above') {\r\n      wrapperWidth = width;\r\n      wrapperHeight = height - titleDim.height;\r\n    } else {\r\n      wrapperWidth = width - titleDim.width;\r\n      wrapperHeight = height;\r\n    }\r\n  }\r\n\r\n  return {\r\n    valueWidth,\r\n    valueHeight,\r\n    maxBarWidth,\r\n    maxBarHeight,\r\n    wrapperHeight,\r\n    wrapperWidth,\r\n  };\r\n}\r\n\r\nexport function getValuePercent(value: number, minValue: number, maxValue: number): number {\r\n  return Math.min((value - minValue) / (maxValue - minValue), 1);\r\n}\r\n\r\n/**\r\n * Only exported to for unit test\r\n */\r\nexport function getBasicAndGradientStyles(props: Props): BasicAndGradientStyles {\r\n  const { displayMode, field, value, alignmentFactors, orientation, theme } = props;\r\n  const { valueWidth, valueHeight, maxBarHeight, maxBarWidth } = calculateBarAndValueDimensions(props);\r\n\r\n  const valuePercent = getValuePercent(value.numeric, field.min!, field.max!);\r\n  const valueColor = getValueColor(props);\r\n\r\n  const valueToBaseSizeOn = alignmentFactors ? alignmentFactors : value;\r\n  const valueStyles = getValueStyles(valueToBaseSizeOn, valueColor, valueWidth, valueHeight, orientation);\r\n\r\n  const isBasic = displayMode === 'basic';\r\n  const wrapperStyles: CSSProperties = {\r\n    display: 'flex',\r\n    flexGrow: 1,\r\n  };\r\n\r\n  const barStyles: CSSProperties = {\r\n    borderRadius: '3px',\r\n    position: 'relative',\r\n    zIndex: 1,\r\n  };\r\n\r\n  const emptyBar: CSSProperties = {\r\n    background: `rgba(${theme.isDark ? '255,255,255' : '0,0,0'}, 0.07)`,\r\n    flexGrow: 1,\r\n    display: 'flex',\r\n    borderRadius: '3px',\r\n    position: 'relative',\r\n  };\r\n\r\n  if (isVertical(orientation)) {\r\n    const barHeight = Math.max(valuePercent * maxBarHeight, 1);\r\n\r\n    // vertical styles\r\n    wrapperStyles.flexDirection = 'column';\r\n    wrapperStyles.justifyContent = 'flex-end';\r\n\r\n    barStyles.transition = 'height 1s';\r\n    barStyles.height = `${barHeight}px`;\r\n    barStyles.width = `${maxBarWidth}px`;\r\n\r\n    // adjust so that filled in bar is at the bottom\r\n    emptyBar.bottom = '-3px';\r\n\r\n    if (isBasic) {\r\n      // Basic styles\r\n      barStyles.background = `${tinycolor(valueColor)\r\n        .setAlpha(0.35)\r\n        .toRgbString()}`;\r\n\r\n      barStyles.borderTop = `2px solid ${valueColor}`;\r\n    } else {\r\n      // Gradient styles\r\n      barStyles.background = getBarGradient(props, maxBarHeight);\r\n    }\r\n  } else {\r\n    const barWidth = Math.max(valuePercent * maxBarWidth, 1);\r\n\r\n    // Custom styles for horizontal orientation\r\n    wrapperStyles.flexDirection = 'row-reverse';\r\n    wrapperStyles.justifyContent = 'flex-end';\r\n    wrapperStyles.alignItems = 'stretch';\r\n\r\n    barStyles.transition = 'width 1s';\r\n    barStyles.height = `${maxBarHeight}px`;\r\n    barStyles.width = `${barWidth}px`;\r\n\r\n    // shift empty region back to fill gaps due to border radius\r\n    emptyBar.left = '-3px';\r\n\r\n    if (isBasic) {\r\n      // Basic styles\r\n      barStyles.background = `${tinycolor(valueColor)\r\n        .setAlpha(0.35)\r\n        .toRgbString()}`;\r\n      barStyles.borderRight = `2px solid ${valueColor}`;\r\n    } else {\r\n      // Gradient styles\r\n      barStyles.background = getBarGradient(props, maxBarWidth);\r\n    }\r\n  }\r\n\r\n  return {\r\n    wrapper: wrapperStyles,\r\n    bar: barStyles,\r\n    value: valueStyles,\r\n    emptyBar,\r\n  };\r\n}\r\n\r\n/**\r\n * Only exported to for unit test\r\n */\r\nexport function getBarGradient(props: Props, maxSize: number): string {\r\n  const { field, value, orientation } = props;\r\n  const cssDirection = isVertical(orientation) ? '0deg' : '90deg';\r\n  const minValue = field.min!;\r\n  const maxValue = field.max!;\r\n\r\n  let gradient = '';\r\n  let lastpos = 0;\r\n\r\n  if (field.color && field.color.mode === FieldColorMode.Scheme) {\r\n    const schemeSet = (d3 as any)[`scheme${field.color.schemeName}`] as any[];\r\n    if (!schemeSet) {\r\n      // Error: unknown scheme\r\n      const color = '#F00';\r\n      gradient = `linear-gradient(${cssDirection}, ${color}, ${color}`;\r\n      gradient += ` ${maxSize}px, ${color}`;\r\n      return gradient + ')';\r\n    }\r\n    // Get the scheme with as many steps as possible\r\n    const scheme = schemeSet[schemeSet.length - 1] as string[];\r\n    for (let i = 0; i < scheme.length; i++) {\r\n      const color = scheme[i];\r\n      const valuePercent = i / (scheme.length - 1);\r\n      const pos = valuePercent * maxSize;\r\n      const offset = Math.round(pos - (pos - lastpos) / 2);\r\n\r\n      if (gradient === '') {\r\n        gradient = `linear-gradient(${cssDirection}, ${color}, ${color}`;\r\n      } else {\r\n        lastpos = pos;\r\n        gradient += ` ${offset}px, ${color}`;\r\n      }\r\n    }\r\n  } else {\r\n    const thresholds = field.thresholds!;\r\n\r\n    for (let i = 0; i < thresholds.steps.length; i++) {\r\n      const threshold = thresholds.steps[i];\r\n      const color = getColorFromHexRgbOrName(threshold.color);\r\n      const valuePercent = getValuePercent(threshold.value, minValue, maxValue);\r\n      const pos = valuePercent * maxSize;\r\n      const offset = Math.round(pos - (pos - lastpos) / 2);\r\n\r\n      if (gradient === '') {\r\n        gradient = `linear-gradient(${cssDirection}, ${color}, ${color}`;\r\n      } else if (value.numeric < threshold.value) {\r\n        break;\r\n      } else {\r\n        lastpos = pos;\r\n        gradient += ` ${offset}px, ${color}`;\r\n      }\r\n    }\r\n  }\r\n\r\n  return gradient + ')';\r\n}\r\n\r\n/**\r\n * Only exported to for unit test\r\n */\r\nexport function getValueColor(props: Props): string {\r\n  const { theme, value } = props;\r\n  if (value.color) {\r\n    return value.color;\r\n  }\r\n  return getColorFromHexRgbOrName('gray', theme.type);\r\n}\r\n\r\nfunction getValueStyles(\r\n  value: FormattedValue,\r\n  color: string,\r\n  width: number,\r\n  height: number,\r\n  orientation: VizOrientation\r\n): CSSProperties {\r\n  const styles: CSSProperties = {\r\n    color: color,\r\n    height: `${height}px`,\r\n    width: `${width}px`,\r\n    display: 'flex',\r\n    alignItems: 'center',\r\n    lineHeight: VALUE_LINE_HEIGHT,\r\n  };\r\n\r\n  // how many pixels in wide can the text be?\r\n  let textWidth = width;\r\n  const formattedValueString = formattedValueToString(value);\r\n\r\n  if (isVertical(orientation)) {\r\n    styles.fontSize = calculateFontSize(formattedValueString, textWidth, height, VALUE_LINE_HEIGHT);\r\n    styles.justifyContent = `center`;\r\n  } else {\r\n    styles.fontSize = calculateFontSize(\r\n      formattedValueString,\r\n      textWidth - VALUE_LEFT_PADDING * 2,\r\n      height,\r\n      VALUE_LINE_HEIGHT\r\n    );\r\n    styles.justifyContent = `flex-end`;\r\n    styles.paddingLeft = `${VALUE_LEFT_PADDING}px`;\r\n    styles.paddingRight = `${VALUE_LEFT_PADDING}px`;\r\n    // Need to remove the left padding from the text width constraints\r\n    textWidth -= VALUE_LEFT_PADDING;\r\n\r\n    // adjust width of title box\r\n    styles.width = measureText(formattedValueString, styles.fontSize).width + VALUE_LEFT_PADDING * 2;\r\n  }\r\n\r\n  return styles;\r\n}\r\n","// Library\r\nimport React, { PureComponent } from 'react';\r\nimport { DisplayValue, GraphSeriesValue, DisplayValueAlignmentFactors } from '@grafana/data';\r\n\r\n// Types\r\nimport { Themeable } from '../../types';\r\nimport { buildLayout } from './BigValueLayout';\r\nimport { FormattedValueDisplay } from '../FormattedValueDisplay/FormattedValueDisplay';\r\n\r\nexport interface BigValueSparkline {\r\n  data: GraphSeriesValue[][];\r\n  xMin?: number | null;\r\n  xMax?: number | null;\r\n  yMin?: number | null;\r\n  yMax?: number | null;\r\n  highlightIndex?: number;\r\n}\r\n\r\nexport enum BigValueColorMode {\r\n  Value = 'value',\r\n  Background = 'background',\r\n}\r\n\r\nexport enum BigValueGraphMode {\r\n  None = 'none',\r\n  Line = 'line',\r\n  Area = 'area',\r\n}\r\n\r\nexport enum BigValueJustifyMode {\r\n  Auto = 'auto',\r\n  Center = 'center',\r\n}\r\n\r\nexport interface Props extends Themeable {\r\n  height: number;\r\n  width: number;\r\n  value: DisplayValue;\r\n  sparkline?: BigValueSparkline;\r\n  onClick?: React.MouseEventHandler<HTMLElement>;\r\n  className?: string;\r\n  colorMode: BigValueColorMode;\r\n  graphMode: BigValueGraphMode;\r\n  justifyMode?: BigValueJustifyMode;\r\n  alignmentFactors?: DisplayValueAlignmentFactors;\r\n}\r\n\r\nexport class BigValue extends PureComponent<Props> {\r\n  static defaultProps: Partial<Props> = {\r\n    justifyMode: BigValueJustifyMode.Auto,\r\n  };\r\n\r\n  render() {\r\n    const { value, onClick, className } = this.props;\r\n\r\n    const layout = buildLayout(this.props);\r\n    const panelStyles = layout.getPanelStyles();\r\n    const valueAndTitleContainerStyles = layout.getValueAndTitleContainerStyles();\r\n    const valueStyles = layout.getValueStyles();\r\n    const titleStyles = layout.getTitleStyles();\r\n\r\n    return (\r\n      <div className={className} style={panelStyles} onClick={onClick}>\r\n        <div style={valueAndTitleContainerStyles}>\r\n          {value.title && <div style={titleStyles}>{value.title}</div>}\r\n          <FormattedValueDisplay value={value} style={valueStyles} />\r\n        </div>\r\n        {layout.renderChart()}\r\n      </div>\r\n    );\r\n  }\r\n}\r\n","// Libraries\r\nimport React, { CSSProperties } from 'react';\r\nimport tinycolor from 'tinycolor2';\r\nimport { Chart, Geom } from 'bizcharts';\r\n\r\n// Utils\r\nimport { getColorFromHexRgbOrName, formattedValueToString } from '@grafana/data';\r\nimport { calculateFontSize } from '../../utils/measureText';\r\n\r\n// Types\r\nimport { BigValueColorMode, Props, BigValueJustifyMode } from './BigValue';\r\n\r\nconst LINE_HEIGHT = 1.2;\r\nconst MAX_TITLE_SIZE = 30;\r\n\r\nexport abstract class BigValueLayout {\r\n  titleFontSize: number;\r\n  valueFontSize: number;\r\n  chartHeight: number;\r\n  chartWidth: number;\r\n  valueColor: string;\r\n  panelPadding: number;\r\n  justifyCenter: boolean;\r\n  titleToAlignTo?: string;\r\n  valueToAlignTo: string;\r\n  maxTextWidth: number;\r\n  maxTextHeight: number;\r\n\r\n  constructor(private props: Props) {\r\n    const { width, height, value, alignmentFactors, theme } = props;\r\n\r\n    this.valueColor = getColorFromHexRgbOrName(value.color || 'green', theme.type);\r\n    this.justifyCenter = shouldJustifyCenter(props);\r\n    this.panelPadding = height > 100 ? 12 : 8;\r\n    this.titleToAlignTo = alignmentFactors ? alignmentFactors.title : value.title;\r\n    this.valueToAlignTo = formattedValueToString(alignmentFactors ? alignmentFactors : value);\r\n\r\n    this.titleFontSize = 14;\r\n    this.valueFontSize = 14;\r\n    this.chartHeight = 0;\r\n    this.chartWidth = 0;\r\n    this.maxTextWidth = width - this.panelPadding * 2;\r\n    this.maxTextHeight = height - this.panelPadding * 2;\r\n  }\r\n\r\n  getTitleStyles(): CSSProperties {\r\n    const styles: CSSProperties = {\r\n      fontSize: `${this.titleFontSize}px`,\r\n      lineHeight: LINE_HEIGHT,\r\n    };\r\n\r\n    if (this.props.colorMode === BigValueColorMode.Background) {\r\n      styles.color = 'white';\r\n    }\r\n\r\n    return styles;\r\n  }\r\n\r\n  getValueStyles(): CSSProperties {\r\n    const styles: CSSProperties = {\r\n      fontSize: this.valueFontSize,\r\n      fontWeight: 500,\r\n      lineHeight: LINE_HEIGHT,\r\n    };\r\n\r\n    switch (this.props.colorMode) {\r\n      case BigValueColorMode.Value:\r\n        styles.color = this.valueColor;\r\n        break;\r\n      case BigValueColorMode.Background:\r\n        styles.color = 'white';\r\n    }\r\n\r\n    return styles;\r\n  }\r\n\r\n  getValueAndTitleContainerStyles() {\r\n    const styles: CSSProperties = {\r\n      display: 'flex',\r\n    };\r\n\r\n    if (this.justifyCenter) {\r\n      styles.alignItems = 'center';\r\n      styles.justifyContent = 'center';\r\n      styles.flexGrow = 1;\r\n    }\r\n\r\n    return styles;\r\n  }\r\n\r\n  getPanelStyles(): CSSProperties {\r\n    const { width, height, theme, colorMode } = this.props;\r\n\r\n    const panelStyles: CSSProperties = {\r\n      width: `${width}px`,\r\n      height: `${height}px`,\r\n      padding: `${this.panelPadding}px`,\r\n      borderRadius: '3px',\r\n      position: 'relative',\r\n      display: 'flex',\r\n    };\r\n\r\n    const themeFactor = theme.isDark ? 1 : -0.7;\r\n\r\n    switch (colorMode) {\r\n      case BigValueColorMode.Background:\r\n        const bgColor2 = tinycolor(this.valueColor)\r\n          .darken(15 * themeFactor)\r\n          .spin(8)\r\n          .toRgbString();\r\n        const bgColor3 = tinycolor(this.valueColor)\r\n          .darken(5 * themeFactor)\r\n          .spin(-8)\r\n          .toRgbString();\r\n        panelStyles.background = `linear-gradient(120deg, ${bgColor2}, ${bgColor3})`;\r\n        break;\r\n      case BigValueColorMode.Value:\r\n        panelStyles.background = `${theme.colors.panelBg}`;\r\n        break;\r\n    }\r\n\r\n    if (this.justifyCenter) {\r\n      panelStyles.alignItems = 'center';\r\n      panelStyles.flexDirection = 'row';\r\n    }\r\n\r\n    return panelStyles;\r\n  }\r\n\r\n  renderChart(): JSX.Element | null {\r\n    const { sparkline } = this.props;\r\n\r\n    if (!sparkline || sparkline.data.length === 0) {\r\n      return null;\r\n    }\r\n\r\n    const data = sparkline.data.map(values => {\r\n      return { time: values[0], value: values[1], name: 'A' };\r\n    });\r\n\r\n    const scales = {\r\n      time: {\r\n        type: 'time',\r\n        min: sparkline.xMin,\r\n        max: sparkline.xMax,\r\n      },\r\n      value: {\r\n        min: sparkline.yMin,\r\n        max: sparkline.yMax,\r\n      },\r\n    };\r\n\r\n    if (sparkline.xMax && sparkline.xMin) {\r\n      // Having the last data point align with the edge of the panel looks good\r\n      // So if it's close adjust time.max to the last data point time\r\n      const timeDelta = sparkline.xMax - sparkline.xMin;\r\n      const lastDataPointTime = data[data.length - 1].time || 0;\r\n      const lastTimeDiffFromMax = Math.abs(sparkline.xMax - lastDataPointTime);\r\n\r\n      // if last data point is just 5% or lower from the edge adjust it\r\n      if (lastTimeDiffFromMax / timeDelta < 0.05) {\r\n        scales.time.max = lastDataPointTime;\r\n      }\r\n    }\r\n\r\n    return (\r\n      <Chart\r\n        height={this.chartHeight}\r\n        width={this.chartWidth}\r\n        data={data}\r\n        animate={false}\r\n        padding={[4, 0, 0, 0]}\r\n        scale={scales}\r\n        style={this.getChartStyles()}\r\n      >\r\n        {this.renderGeom()}\r\n      </Chart>\r\n    );\r\n  }\r\n\r\n  renderGeom(): JSX.Element {\r\n    const { colorMode } = this.props;\r\n\r\n    const lineStyle: any = {\r\n      opacity: 1,\r\n      fillOpacity: 1,\r\n      lineWidth: 2,\r\n    };\r\n\r\n    let fillColor: string;\r\n    let lineColor: string;\r\n\r\n    switch (colorMode) {\r\n      case BigValueColorMode.Value:\r\n        lineColor = this.valueColor;\r\n        fillColor = tinycolor(this.valueColor)\r\n          .setAlpha(0.2)\r\n          .toRgbString();\r\n        break;\r\n      case BigValueColorMode.Background:\r\n        fillColor = 'rgba(255,255,255,0.4)';\r\n        lineColor = tinycolor(this.valueColor)\r\n          .brighten(40)\r\n          .toRgbString();\r\n    }\r\n\r\n    lineStyle.stroke = lineColor;\r\n\r\n    return (\r\n      <>\r\n        <Geom type=\"area\" position=\"time*value\" size={0} color={fillColor} style={lineStyle} shape=\"smooth\" />\r\n        <Geom type=\"line\" position=\"time*value\" size={1} color={lineColor} style={lineStyle} shape=\"smooth\" />\r\n      </>\r\n    );\r\n  }\r\n\r\n  getChartStyles(): CSSProperties {\r\n    return {\r\n      position: 'absolute',\r\n      right: 0,\r\n      bottom: 0,\r\n    };\r\n  }\r\n}\r\n\r\nexport class WideNoChartLayout extends BigValueLayout {\r\n  constructor(props: Props) {\r\n    super(props);\r\n\r\n    const valueWidthPercent = 0.3;\r\n\r\n    if (this.titleToAlignTo && this.titleToAlignTo.length > 0) {\r\n      // initial value size\r\n      this.valueFontSize = calculateFontSize(\r\n        this.valueToAlignTo,\r\n        this.maxTextWidth * valueWidthPercent,\r\n        this.maxTextHeight,\r\n        LINE_HEIGHT\r\n      );\r\n\r\n      // How big can we make the title and still have it fit\r\n      this.titleFontSize = calculateFontSize(\r\n        this.titleToAlignTo,\r\n        this.maxTextWidth * 0.6,\r\n        this.maxTextHeight,\r\n        LINE_HEIGHT,\r\n        MAX_TITLE_SIZE\r\n      );\r\n\r\n      // make sure it's a bit smaller than valueFontSize\r\n      this.titleFontSize = Math.min(this.valueFontSize * 0.7, this.titleFontSize);\r\n    } else {\r\n      // if no title wide\r\n      this.valueFontSize = calculateFontSize(this.valueToAlignTo, this.maxTextWidth, this.maxTextHeight, LINE_HEIGHT);\r\n    }\r\n  }\r\n\r\n  getValueAndTitleContainerStyles() {\r\n    const styles = super.getValueAndTitleContainerStyles();\r\n    styles.flexDirection = 'row';\r\n    styles.alignItems = 'center';\r\n    styles.flexGrow = 1;\r\n\r\n    if (!this.justifyCenter) {\r\n      styles.justifyContent = 'space-between';\r\n    }\r\n\r\n    return styles;\r\n  }\r\n\r\n  renderChart(): JSX.Element | null {\r\n    return null;\r\n  }\r\n\r\n  getPanelStyles() {\r\n    const panelStyles = super.getPanelStyles();\r\n    panelStyles.alignItems = 'center';\r\n    return panelStyles;\r\n  }\r\n}\r\n\r\nexport class WideWithChartLayout extends BigValueLayout {\r\n  constructor(props: Props) {\r\n    super(props);\r\n\r\n    const { width, height } = props;\r\n    const chartHeightPercent = 0.5;\r\n    const titleWidthPercent = 0.6;\r\n    const valueWidthPercent = 1 - titleWidthPercent;\r\n    const textHeightPercent = 0.4;\r\n\r\n    this.chartWidth = width;\r\n    this.chartHeight = height * chartHeightPercent;\r\n\r\n    if (this.titleToAlignTo && this.titleToAlignTo.length > 0) {\r\n      this.titleFontSize = calculateFontSize(\r\n        this.titleToAlignTo,\r\n        this.maxTextWidth * titleWidthPercent,\r\n        this.maxTextHeight * textHeightPercent,\r\n        LINE_HEIGHT,\r\n        MAX_TITLE_SIZE\r\n      );\r\n    }\r\n\r\n    this.valueFontSize = calculateFontSize(\r\n      this.valueToAlignTo,\r\n      this.maxTextWidth * valueWidthPercent,\r\n      this.maxTextHeight * chartHeightPercent,\r\n      LINE_HEIGHT\r\n    );\r\n  }\r\n\r\n  getValueAndTitleContainerStyles() {\r\n    const styles = super.getValueAndTitleContainerStyles();\r\n    styles.flexDirection = 'row';\r\n    styles.flexGrow = 1;\r\n\r\n    if (!this.justifyCenter) {\r\n      styles.justifyContent = 'space-between';\r\n    }\r\n\r\n    return styles;\r\n  }\r\n\r\n  getPanelStyles() {\r\n    const styles = super.getPanelStyles();\r\n    styles.flexDirection = 'row';\r\n    styles.justifyContent = 'space-between';\r\n    return styles;\r\n  }\r\n}\r\n\r\nexport class StackedWithChartLayout extends BigValueLayout {\r\n  constructor(props: Props) {\r\n    super(props);\r\n\r\n    const { width, height } = props;\r\n    const titleHeightPercent = 0.15;\r\n    const chartHeightPercent = 0.25;\r\n    let titleHeight = 0;\r\n\r\n    this.chartHeight = height * chartHeightPercent;\r\n    this.chartWidth = width;\r\n\r\n    if (this.titleToAlignTo && this.titleToAlignTo.length > 0) {\r\n      this.titleFontSize = calculateFontSize(\r\n        this.titleToAlignTo,\r\n        this.maxTextWidth,\r\n        height * titleHeightPercent,\r\n        LINE_HEIGHT,\r\n        MAX_TITLE_SIZE\r\n      );\r\n\r\n      titleHeight = this.titleFontSize * LINE_HEIGHT;\r\n    }\r\n\r\n    this.valueFontSize = calculateFontSize(\r\n      this.valueToAlignTo,\r\n      this.maxTextWidth,\r\n      this.maxTextHeight - this.chartHeight - titleHeight,\r\n      LINE_HEIGHT\r\n    );\r\n\r\n    // make title fontsize it's a bit smaller than valueFontSize\r\n    this.titleFontSize = Math.min(this.valueFontSize * 0.7, this.titleFontSize);\r\n\r\n    // make chart take up onused space\r\n    this.chartHeight = height - this.titleFontSize * LINE_HEIGHT - this.valueFontSize * LINE_HEIGHT;\r\n  }\r\n\r\n  getValueAndTitleContainerStyles() {\r\n    const styles = super.getValueAndTitleContainerStyles();\r\n    styles.flexDirection = 'column';\r\n    styles.justifyContent = 'center';\r\n    return styles;\r\n  }\r\n\r\n  getPanelStyles() {\r\n    const styles = super.getPanelStyles();\r\n    styles.flexDirection = 'column';\r\n    return styles;\r\n  }\r\n}\r\n\r\nexport class StackedWithNoChartLayout extends BigValueLayout {\r\n  constructor(props: Props) {\r\n    super(props);\r\n\r\n    const { height } = props;\r\n    const titleHeightPercent = 0.15;\r\n    let titleHeight = 0;\r\n\r\n    if (this.titleToAlignTo && this.titleToAlignTo.length > 0) {\r\n      this.titleFontSize = calculateFontSize(\r\n        this.titleToAlignTo,\r\n        this.maxTextWidth,\r\n        height * titleHeightPercent,\r\n        LINE_HEIGHT,\r\n        MAX_TITLE_SIZE\r\n      );\r\n\r\n      titleHeight = this.titleFontSize * LINE_HEIGHT;\r\n    }\r\n\r\n    this.valueFontSize = calculateFontSize(\r\n      this.valueToAlignTo,\r\n      this.maxTextWidth,\r\n      this.maxTextHeight - titleHeight,\r\n      LINE_HEIGHT\r\n    );\r\n\r\n    // make title fontsize it's a bit smaller than valueFontSize\r\n    this.titleFontSize = Math.min(this.valueFontSize * 0.7, this.titleFontSize);\r\n  }\r\n\r\n  getValueAndTitleContainerStyles() {\r\n    const styles = super.getValueAndTitleContainerStyles();\r\n    styles.flexDirection = 'column';\r\n    styles.flexGrow = 1;\r\n    return styles;\r\n  }\r\n\r\n  getPanelStyles() {\r\n    const styles = super.getPanelStyles();\r\n    styles.alignItems = 'center';\r\n    return styles;\r\n  }\r\n}\r\n\r\nexport function buildLayout(props: Props): BigValueLayout {\r\n  const { width, height, sparkline } = props;\r\n  const useWideLayout = width / height > 2.5;\r\n\r\n  if (useWideLayout) {\r\n    if (height > 50 && !!sparkline) {\r\n      return new WideWithChartLayout(props);\r\n    } else {\r\n      return new WideNoChartLayout(props);\r\n    }\r\n  }\r\n\r\n  // stacked layouts\r\n  if (height > 100 && !!sparkline) {\r\n    return new StackedWithChartLayout(props);\r\n  } else {\r\n    return new StackedWithNoChartLayout(props);\r\n  }\r\n}\r\n\r\nexport function shouldJustifyCenter(props: Props) {\r\n  const { value, justifyMode } = props;\r\n  if (justifyMode === BigValueJustifyMode.Center) {\r\n    return true;\r\n  }\r\n  return (value.title ?? '').length === 0;\r\n}\r\n","import React, { AnchorHTMLAttributes, ButtonHTMLAttributes, useContext } from 'react';\r\nimport { ThemeContext } from '../../themes';\r\nimport { getButtonStyles } from './styles';\r\nimport { ButtonContent } from './ButtonContent';\r\nimport { ButtonSize, ButtonStyles, ButtonVariant } from './types';\r\n\r\ntype CommonProps = {\r\n  size?: ButtonSize;\r\n  variant?: ButtonVariant;\r\n  /**\r\n   * icon prop is a temporary solution. It accepts legacy icon class names for the icon to be rendered.\r\n   * TODO: migrate to a component when we are going to migrate icons to @grafana/ui\r\n   */\r\n  icon?: string;\r\n  className?: string;\r\n  styles?: ButtonStyles;\r\n};\r\n\r\ntype ButtonProps = CommonProps & ButtonHTMLAttributes<HTMLButtonElement>;\r\nexport const Button = React.forwardRef<HTMLButtonElement, ButtonProps>((props, ref) => {\r\n  const theme = useContext(ThemeContext);\r\n  const { size, variant, icon, children, className, styles: stylesProp, ...buttonProps } = props;\r\n\r\n  // Default this to 'button', otherwise html defaults to 'submit' which then submits any form it is in.\r\n  buttonProps.type = buttonProps.type || 'button';\r\n\r\n  const styles: ButtonStyles =\r\n    stylesProp ||\r\n    getButtonStyles({\r\n      theme,\r\n      size: size || 'md',\r\n      variant: variant || 'primary',\r\n      textAndIcon: !!(children && icon),\r\n    });\r\n\r\n  return (\r\n    <button className={styles.button} {...buttonProps} ref={ref}>\r\n      <ButtonContent icon={icon}>{children}</ButtonContent>\r\n    </button>\r\n  );\r\n});\r\n\r\nButton.displayName = 'Button';\r\n\r\ntype LinkButtonProps = CommonProps &\r\n  AnchorHTMLAttributes<HTMLAnchorElement> & {\r\n    // We allow disabled here even though it is not standard for a link. We use it as a selector to style it as\r\n    // disabled.\r\n    disabled?: boolean;\r\n  };\r\n\r\nexport const LinkButton = React.forwardRef<HTMLAnchorElement, LinkButtonProps>((props, ref) => {\r\n  const theme = useContext(ThemeContext);\r\n  const { size, variant, icon, children, className, styles: stylesProp, ...anchorProps } = props;\r\n  const styles: ButtonStyles =\r\n    stylesProp ||\r\n    getButtonStyles({\r\n      theme,\r\n      size: size || 'md',\r\n      variant: variant || 'primary',\r\n      textAndIcon: !!(children && icon),\r\n    });\r\n\r\n  return (\r\n    <a className={styles.button} {...anchorProps} ref={ref}>\r\n      <ButtonContent icon={icon}>{children}</ButtonContent>\r\n    </a>\r\n  );\r\n});\r\nLinkButton.displayName = 'LinkButton';\r\n","import React from 'react';\r\nimport { css } from 'emotion';\r\nimport { stylesFactory, useTheme } from '../../themes';\r\nimport { GrafanaTheme } from '@grafana/data';\r\nimport { ButtonSize } from './types';\r\n\r\nconst getStyles = stylesFactory((theme: GrafanaTheme) => ({\r\n  content: css`\r\n    display: flex;\r\n    flex-direction: row;\r\n    align-items: center;\r\n    white-space: nowrap;\r\n    height: 100%;\r\n  `,\r\n\r\n  icon: css`\r\n    & + * {\r\n      margin-left: ${theme.spacing.sm};\r\n    }\r\n  `,\r\n}));\r\n\r\ntype Props = {\r\n  icon?: string;\r\n  className?: string;\r\n  children: React.ReactNode;\r\n  size?: ButtonSize;\r\n};\r\n\r\nexport function ButtonContent(props: Props) {\r\n  const { icon, children } = props;\r\n  const theme = useTheme();\r\n  const styles = getStyles(theme);\r\n\r\n  if (!children) {\r\n    return (\r\n      <span className={styles.content}>\r\n        <i className={icon} />\r\n      </span>\r\n    );\r\n  }\r\n\r\n  const iconElement = icon && (\r\n    <span className={styles.icon}>\r\n      <i className={icon} />\r\n    </span>\r\n  );\r\n\r\n  return (\r\n    <span className={styles.content}>\r\n      {iconElement}\r\n      <span>{children}</span>\r\n    </span>\r\n  );\r\n}\r\n","import tinycolor from 'tinycolor2';\r\nimport { css } from 'emotion';\r\nimport { selectThemeVariant, stylesFactory } from '../../themes';\r\nimport { StyleDeps, ButtonSize } from './types';\r\nimport { GrafanaTheme } from '@grafana/data';\r\n\r\nconst buttonVariantStyles = (\r\n  from: string,\r\n  to: string,\r\n  textColor: string,\r\n  textShadowColor = 'rgba(0, 0, 0, 0.1)',\r\n  invert = false\r\n) => css`\r\n  background: linear-gradient(to bottom, ${from}, ${to});\r\n  color: ${textColor};\r\n  text-shadow: 0 ${invert ? '1px' : '-1px'} ${textShadowColor};\r\n  &:hover {\r\n    background: ${from};\r\n    color: ${textColor};\r\n  }\r\n\r\n  &:focus {\r\n    background: ${from};\r\n    outline: none;\r\n  }\r\n`;\r\n\r\nexport const getButtonStyles = stylesFactory(({ theme, size, variant, textAndIcon }: StyleDeps) => {\r\n  const borderRadius = theme.border.radius.sm;\r\n  const { padding, fontSize, height, fontWeight } = calculateMeasures(theme, size, !!textAndIcon);\r\n\r\n  let background;\r\n\r\n  switch (variant) {\r\n    case 'primary':\r\n      background = buttonVariantStyles(theme.colors.greenBase, theme.colors.greenShade, theme.colors.white);\r\n      break;\r\n\r\n    case 'secondary':\r\n      background = buttonVariantStyles(theme.colors.blueBase, theme.colors.blueShade, theme.colors.white);\r\n      break;\r\n\r\n    case 'danger':\r\n      background = buttonVariantStyles(theme.colors.redBase, theme.colors.redShade, theme.colors.white);\r\n      break;\r\n\r\n    case 'inverse':\r\n      const from = selectThemeVariant({ light: theme.colors.gray5, dark: theme.colors.dark6 }, theme.type) as string;\r\n      const to = selectThemeVariant(\r\n        {\r\n          light: tinycolor(from)\r\n            .darken(5)\r\n            .toString(),\r\n          dark: tinycolor(from)\r\n            .lighten(4)\r\n            .toString(),\r\n        },\r\n        theme.type\r\n      ) as string;\r\n\r\n      background = buttonVariantStyles(from, to, theme.colors.link, 'rgba(0, 0, 0, 0.1)', true);\r\n      break;\r\n\r\n    case 'transparent':\r\n      background = css`\r\n        ${buttonVariantStyles('', '', theme.colors.link, 'rgba(0, 0, 0, 0.1)', true)};\r\n        background: transparent;\r\n      `;\r\n      break;\r\n\r\n    case 'link':\r\n      background = css`\r\n        ${buttonVariantStyles('', '', theme.colors.linkExternal, 'rgba(0, 0, 0, 0.1)', true)};\r\n        background: transparent;\r\n      `;\r\n      break;\r\n  }\r\n\r\n  return {\r\n    button: css`\r\n      label: button;\r\n      display: inline-flex;\r\n      align-items: center;\r\n      font-weight: ${fontWeight};\r\n      font-size: ${fontSize};\r\n      font-family: ${theme.typography.fontFamily.sansSerif};\r\n      line-height: ${theme.typography.lineHeight.xs};\r\n      padding: ${padding};\r\n      vertical-align: middle;\r\n      cursor: pointer;\r\n      border: none;\r\n      height: ${height};\r\n      border-radius: ${borderRadius};\r\n      ${background};\r\n\r\n      &[disabled],\r\n      &:disabled {\r\n        cursor: not-allowed;\r\n        opacity: 0.65;\r\n        box-shadow: none;\r\n      }\r\n    `,\r\n    iconWrap: css`\r\n      label: button-icon-wrap;\r\n      & + * {\r\n        margin-left: ${theme.spacing.sm};\r\n      }\r\n    `,\r\n  };\r\n});\r\n\r\ntype ButtonMeasures = {\r\n  padding: string;\r\n  fontSize: string;\r\n  height: string;\r\n  fontWeight: number;\r\n};\r\n\r\nconst calculateMeasures = (theme: GrafanaTheme, size: ButtonSize, textAndIcon: boolean): ButtonMeasures => {\r\n  switch (size) {\r\n    case 'sm': {\r\n      return {\r\n        padding: `${theme.spacing.xs} ${theme.spacing.sm}`,\r\n        fontSize: theme.typography.size.sm,\r\n        height: theme.height.sm,\r\n        fontWeight: theme.typography.weight.semibold,\r\n      };\r\n    }\r\n\r\n    case 'md': {\r\n      const leftPadding = textAndIcon ? theme.spacing.sm : theme.spacing.md;\r\n\r\n      return {\r\n        padding: `${theme.spacing.sm} ${theme.spacing.md} ${theme.spacing.sm} ${leftPadding}`,\r\n        fontSize: theme.typography.size.md,\r\n        height: theme.height.md,\r\n        fontWeight: theme.typography.weight.semibold,\r\n      };\r\n    }\r\n\r\n    case 'lg': {\r\n      const leftPadding = textAndIcon ? theme.spacing.md : theme.spacing.lg;\r\n\r\n      return {\r\n        padding: `${theme.spacing.md} ${theme.spacing.lg} ${theme.spacing.md} ${leftPadding}`,\r\n        fontSize: theme.typography.size.lg,\r\n        height: theme.height.lg,\r\n        fontWeight: theme.typography.weight.regular,\r\n      };\r\n    }\r\n\r\n    default: {\r\n      const leftPadding = textAndIcon ? theme.spacing.sm : theme.spacing.md;\r\n\r\n      return {\r\n        padding: `${theme.spacing.sm} ${theme.spacing.md} ${theme.spacing.sm} ${leftPadding}`,\r\n        fontSize: theme.typography.size.base,\r\n        height: theme.height.md,\r\n        fontWeight: theme.typography.weight.regular,\r\n      };\r\n    }\r\n  }\r\n};\r\n","import React from 'react';\r\nimport { Icon } from '../Icon/Icon';\r\n\r\n// @ts-ignore\r\nimport RCCascader from 'rc-cascader';\r\nimport { CascaderOption } from '../Cascader/Cascader';\r\n\r\nexport interface ButtonCascaderProps {\r\n  options: CascaderOption[];\r\n  children: string;\r\n  disabled?: boolean;\r\n  value?: string[];\r\n  fieldNames?: { label: string; value: string; children: string };\r\n\r\n  loadData?: (selectedOptions: CascaderOption[]) => void;\r\n  onChange?: (value: string[], selectedOptions: CascaderOption[]) => void;\r\n  onPopupVisibleChange?: (visible: boolean) => void;\r\n}\r\n\r\nexport const ButtonCascader: React.FC<ButtonCascaderProps> = props => (\r\n  <RCCascader {...props} expandIcon={null}>\r\n    <button className=\"gf-form-label gf-form-label--btn\" disabled={props.disabled}>\r\n      {props.children} <Icon name=\"caret-down\" />\r\n    </button>\r\n  </RCCascader>\r\n);\r\n","import React from 'react';\r\nimport { Themeable } from '../../types/theme';\r\nimport { GrafanaTheme } from '@grafana/data';\r\nimport { selectThemeVariant } from '../../themes/selectThemeVariant';\r\nimport { css, cx } from 'emotion';\r\nimport { stylesFactory } from '../../themes';\r\n\r\nexport interface CallToActionCardProps extends Themeable {\r\n  message?: string | JSX.Element;\r\n  callToActionElement: JSX.Element;\r\n  footer?: string | JSX.Element;\r\n  className?: string;\r\n}\r\n\r\nconst getCallToActionCardStyles = stylesFactory((theme: GrafanaTheme) => ({\r\n  wrapper: css`\r\n    label: call-to-action-card;\r\n    padding: ${theme.spacing.lg};\r\n    background: ${selectThemeVariant({ light: theme.colors.gray6, dark: theme.colors.grayBlue }, theme.type)};\r\n    border-radius: ${theme.border.radius.md};\r\n    display: flex;\r\n    flex-direction: column;\r\n    align-items: center;\r\n    justify-content: center;\r\n  `,\r\n  message: css`\r\n    margin-bottom: ${theme.spacing.lg};\r\n    font-style: italic;\r\n  `,\r\n  footer: css`\r\n    margin-top: ${theme.spacing.lg};\r\n  `,\r\n}));\r\n\r\nexport const CallToActionCard: React.FunctionComponent<CallToActionCardProps> = ({\r\n  message,\r\n  callToActionElement,\r\n  footer,\r\n  theme,\r\n  className,\r\n}) => {\r\n  const css = getCallToActionCardStyles(theme);\r\n\r\n  return (\r\n    <div className={cx([css.wrapper, className])}>\r\n      {message && <div className={css.message}>{message}</div>}\r\n      {callToActionElement}\r\n      {footer && <div className={css.footer}>{footer}</div>}\r\n    </div>\r\n  );\r\n};\r\n","import React from 'react';\r\nimport { Icon } from '../Icon/Icon';\r\n// @ts-ignore\r\nimport RCCascader from 'rc-cascader';\r\n\r\nimport { Select } from '../Forms/Select/Select';\r\nimport { FormInputSize } from '../Forms/types';\r\nimport { Input } from '../Forms/Input/Input';\r\nimport { SelectableValue } from '@grafana/data';\r\nimport { css } from 'emotion';\r\n\r\ninterface CascaderProps {\r\n  separator?: string;\r\n  options: CascaderOption[];\r\n  onSelect(val: string): void;\r\n  size?: FormInputSize;\r\n  initialValue?: string;\r\n}\r\n\r\ninterface CascaderState {\r\n  isSearching: boolean;\r\n  searchableOptions: Array<SelectableValue<string[]>>;\r\n  focusCascade: boolean;\r\n  //Array for cascade navigation\r\n  rcValue: SelectableValue<string[]>;\r\n  activeLabel: string;\r\n}\r\n\r\nexport interface CascaderOption {\r\n  value: any;\r\n  label: string;\r\n  items?: CascaderOption[];\r\n  disabled?: boolean;\r\n  title?: string;\r\n  children?: CascaderOption[];\r\n}\r\n\r\nconst disableDivFocus = css(`\r\n&:focus{\r\n  outline: none;\r\n}\r\n`);\r\n\r\nexport class Cascader extends React.PureComponent<CascaderProps, CascaderState> {\r\n  constructor(props: CascaderProps) {\r\n    super(props);\r\n    const searchableOptions = this.flattenOptions(props.options);\r\n    const { rcValue, activeLabel } = this.setInitialValue(searchableOptions, props.initialValue);\r\n    this.state = {\r\n      isSearching: false,\r\n      focusCascade: false,\r\n      searchableOptions,\r\n      rcValue,\r\n      activeLabel,\r\n    };\r\n  }\r\n\r\n  flattenOptions = (options: CascaderOption[], optionPath: CascaderOption[] = []) => {\r\n    let selectOptions: Array<SelectableValue<string[]>> = [];\r\n    for (const option of options) {\r\n      const cpy = [...optionPath];\r\n      cpy.push(option);\r\n      if (!option.items) {\r\n        selectOptions.push({\r\n          label: cpy.map(o => o.label).join(this.props.separator || ' / '),\r\n          value: cpy.map(o => o.value),\r\n        });\r\n      } else {\r\n        selectOptions = [...selectOptions, ...this.flattenOptions(option.items, cpy)];\r\n      }\r\n    }\r\n    return selectOptions;\r\n  };\r\n\r\n  setInitialValue(searchableOptions: Array<SelectableValue<string[]>>, initValue?: string) {\r\n    if (!initValue) {\r\n      return { rcValue: [], activeLabel: '' };\r\n    }\r\n    for (const option of searchableOptions) {\r\n      const optionPath = option.value || [];\r\n\r\n      if (optionPath.indexOf(initValue) === optionPath.length - 1) {\r\n        return {\r\n          rcValue: optionPath,\r\n          activeLabel: option.label || '',\r\n        };\r\n      }\r\n    }\r\n    return { rcValue: [], activeLabel: '' };\r\n  }\r\n\r\n  //For rc-cascader\r\n  onChange = (value: string[], selectedOptions: CascaderOption[]) => {\r\n    this.setState({\r\n      rcValue: value,\r\n      activeLabel: selectedOptions.map(o => o.label).join(this.props.separator || ' / '),\r\n    });\r\n\r\n    this.props.onSelect(selectedOptions[selectedOptions.length - 1].value);\r\n  };\r\n\r\n  //For select\r\n  onSelect = (obj: SelectableValue<string[]>) => {\r\n    this.setState({\r\n      activeLabel: obj.label || '',\r\n      rcValue: obj.value || [],\r\n      isSearching: false,\r\n    });\r\n    this.props.onSelect(this.state.rcValue[this.state.rcValue.length - 1]);\r\n  };\r\n\r\n  onClick = () => {\r\n    this.setState({\r\n      focusCascade: true,\r\n    });\r\n  };\r\n\r\n  onBlur = () => {\r\n    this.setState({\r\n      isSearching: false,\r\n      focusCascade: false,\r\n    });\r\n\r\n    if (this.state.activeLabel === '') {\r\n      this.setState({\r\n        rcValue: [],\r\n      });\r\n    }\r\n  };\r\n\r\n  onBlurCascade = () => {\r\n    this.setState({\r\n      focusCascade: false,\r\n    });\r\n  };\r\n\r\n  onInputKeyDown = (e: React.KeyboardEvent<HTMLInputElement>) => {\r\n    if (\r\n      e.key !== 'ArrowDown' &&\r\n      e.key !== 'ArrowUp' &&\r\n      e.key !== 'Enter' &&\r\n      e.key !== 'ArrowLeft' &&\r\n      e.key !== 'ArrowRight'\r\n    ) {\r\n      this.setState({\r\n        focusCascade: false,\r\n        isSearching: true,\r\n      });\r\n      if (e.key === 'Backspace') {\r\n        const label = this.state.activeLabel || '';\r\n        this.setState({\r\n          activeLabel: label.slice(0, -1),\r\n        });\r\n      }\r\n    }\r\n  };\r\n\r\n  onInputChange = (value: string) => {\r\n    this.setState({\r\n      activeLabel: value,\r\n    });\r\n  };\r\n\r\n  render() {\r\n    const { size } = this.props;\r\n    const { focusCascade, isSearching, searchableOptions, rcValue, activeLabel } = this.state;\r\n\r\n    return (\r\n      <div>\r\n        {isSearching ? (\r\n          <Select\r\n            inputValue={activeLabel}\r\n            placeholder=\"Search\"\r\n            autoFocus={!focusCascade}\r\n            onChange={this.onSelect}\r\n            onInputChange={this.onInputChange}\r\n            onBlur={this.onBlur}\r\n            options={searchableOptions}\r\n            size={size || 'md'}\r\n          />\r\n        ) : (\r\n          <RCCascader\r\n            onChange={this.onChange}\r\n            onClick={this.onClick}\r\n            options={this.props.options}\r\n            isFocused={focusCascade}\r\n            onBlur={this.onBlurCascade}\r\n            value={rcValue}\r\n            fieldNames={{ label: 'label', value: 'value', children: 'items' }}\r\n            expandIcon={null}\r\n          >\r\n            <div className={disableDivFocus}>\r\n              <Input\r\n                value={activeLabel}\r\n                onKeyDown={this.onInputKeyDown}\r\n                onChange={() => {}}\r\n                size={size || 'md'}\r\n                suffix={focusCascade ? <Icon name=\"caret-up\" /> : <Icon name=\"caret-down\" />}\r\n              />\r\n            </div>\r\n          </RCCascader>\r\n        )}\r\n      </div>\r\n    );\r\n  }\r\n}\r\n","import React from 'react';\r\nimport { css } from 'emotion';\r\nimport { Portal } from '../Portal/Portal';\r\nimport { Dimensions } from '@grafana/data';\r\nimport { FlotPosition } from '../Graph/types';\r\nimport { TooltipContainer } from './TooltipContainer';\r\n\r\nexport type TooltipMode = 'single' | 'multi';\r\n\r\n// Describes active dimensions user interacts with\r\n// It's a key-value pair where:\r\n// - key is the name of the dimension\r\n// - value is a tuple addresing which column and row from given dimension is active.\r\n//   If row is undefined, it means that we are not hovering over a datapoint\r\nexport type ActiveDimensions<T extends Dimensions = any> = { [key in keyof T]: [number, number | undefined] | null };\r\n\r\nexport interface TooltipContentProps<T extends Dimensions = any> {\r\n  // Each dimension is described by array of fields representing it\r\n  // I.e. for graph there are two dimensions: x and y axis:\r\n  // { xAxis: [<array of time fields>], yAxis: [<array of value fields>]}\r\n  // TODO: type this better, no good idea how yet\r\n  dimensions: T; // Dimension[]\r\n  activeDimensions?: ActiveDimensions<T>;\r\n  // timeZone: TimeZone;\r\n  pos: FlotPosition;\r\n  mode: TooltipMode;\r\n}\r\n\r\nexport interface TooltipProps {\r\n  /** Element used as tooltips content */\r\n  content?: React.ReactElement<any>;\r\n\r\n  /** Optional component to be used as a tooltip content */\r\n  tooltipComponent?: React.ComponentType<TooltipContentProps>;\r\n\r\n  /** x/y position relative to the window */\r\n  position?: { x: number; y: number };\r\n\r\n  /** x/y offset relative to tooltip origin element, i.e. graph's datapoint */\r\n  offset?: { x: number; y: number };\r\n\r\n  // Mode in which tooltip works\r\n  // - single - display single series info\r\n  // - multi - display all series info\r\n  mode?: TooltipMode;\r\n}\r\n\r\nexport const Tooltip: React.FC<TooltipProps> = ({ content, position, offset }) => {\r\n  if (position) {\r\n    return (\r\n      <Portal\r\n        className={css`\r\n          position: absolute;\r\n          top: 0;\r\n          left: 0;\r\n          pointer-events: none;\r\n          width: 100%;\r\n          height: 100%;\r\n        `}\r\n      >\r\n        <TooltipContainer position={position} offset={offset || { x: 0, y: 0 }}>\r\n          {content}\r\n        </TooltipContainer>\r\n      </Portal>\r\n    );\r\n  }\r\n  return null;\r\n};\r\n\r\nTooltip.displayName = 'ChartTooltip';\r\n","import React, { useState, useLayoutEffect, useRef } from 'react';\r\nimport { stylesFactory } from '../../themes/stylesFactory';\r\nimport { selectThemeVariant } from '../../themes/selectThemeVariant';\r\nimport { css } from 'emotion';\r\nimport { useTheme } from '../../themes/ThemeContext';\r\nimport useWindowSize from 'react-use/lib/useWindowSize';\r\nimport { GrafanaTheme } from '@grafana/data';\r\n\r\ninterface TooltipContainerProps {\r\n  position: { x: number; y: number };\r\n  offset: { x: number; y: number };\r\n  children?: JSX.Element;\r\n}\r\n\r\nconst getTooltipContainerStyles = stylesFactory((theme: GrafanaTheme) => {\r\n  const bgColor = selectThemeVariant({ light: theme.colors.gray5, dark: theme.colors.dark1 }, theme.type);\r\n  return {\r\n    wrapper: css`\r\n      overflow: hidden;\r\n      background: ${bgColor};\r\n      /* max-width is set up based on .grafana-tooltip class that's used in dashboard */\r\n      max-width: 800px;\r\n      padding: ${theme.spacing.sm};\r\n      border-radius: ${theme.border.radius.sm};\r\n      z-index: ${theme.zIndex.tooltip};\r\n    `,\r\n  };\r\n});\r\n\r\nexport const TooltipContainer: React.FC<TooltipContainerProps> = ({ position, offset, children }) => {\r\n  const theme = useTheme();\r\n  const tooltipRef = useRef<HTMLDivElement>(null);\r\n  const { width, height } = useWindowSize();\r\n  const [placement, setPlacement] = useState({\r\n    x: position.x + offset.x,\r\n    y: position.y + offset.y,\r\n  });\r\n\r\n  // Make sure tooltip does not overflow window\r\n  useLayoutEffect(() => {\r\n    let xO = 0,\r\n      yO = 0;\r\n    if (tooltipRef && tooltipRef.current) {\r\n      const measurement = tooltipRef.current.getBoundingClientRect();\r\n      const xOverflow = width - (position.x + measurement.width);\r\n      const yOverflow = height - (position.y + measurement.height);\r\n      if (xOverflow < 0) {\r\n        xO = measurement.width + offset.x;\r\n      }\r\n\r\n      if (yOverflow < 0) {\r\n        yO = measurement.height + offset.y;\r\n      }\r\n    }\r\n\r\n    setPlacement({\r\n      x: position.x - xO,\r\n      y: position.y - yO,\r\n    });\r\n  }, [tooltipRef, position]);\r\n\r\n  const styles = getTooltipContainerStyles(theme);\r\n\r\n  return (\r\n    <div\r\n      ref={tooltipRef}\r\n      style={{\r\n        position: 'fixed',\r\n        left: 0,\r\n        top: 0,\r\n        transform: `translate3d(${placement.x}px, ${placement.y}px, 0)`,\r\n      }}\r\n      className={styles.wrapper}\r\n    >\r\n      {children}\r\n    </div>\r\n  );\r\n};\r\n\r\nTooltipContainer.displayName = 'TooltipContainer';\r\n","import { Tooltip } from './Tooltip';\r\n\r\nconst Chart = {\r\n  Tooltip,\r\n};\r\n\r\nexport default Chart;\r\n","import { PureComponent } from 'react';\r\nimport ReactDOM from 'react-dom';\r\n\r\nexport interface Props {\r\n  onClick: () => void;\r\n}\r\n\r\ninterface State {\r\n  hasEventListener: boolean;\r\n}\r\n\r\nexport class ClickOutsideWrapper extends PureComponent<Props, State> {\r\n  state = {\r\n    hasEventListener: false,\r\n  };\r\n\r\n  componentDidMount() {\r\n    window.addEventListener('click', this.onOutsideClick, false);\r\n  }\r\n\r\n  componentWillUnmount() {\r\n    window.removeEventListener('click', this.onOutsideClick, false);\r\n  }\r\n\r\n  onOutsideClick = (event: any) => {\r\n    const domNode = ReactDOM.findDOMNode(this) as Element;\r\n\r\n    if (!domNode || !domNode.contains(event.target)) {\r\n      this.props.onClick();\r\n    }\r\n  };\r\n\r\n  render() {\r\n    return this.props.children;\r\n  }\r\n}\r\n","import React, { FunctionComponent, useContext } from 'react';\r\nimport { css, cx } from 'emotion';\r\n\r\nimport { GrafanaTheme } from '@grafana/data';\r\nimport { selectThemeVariant } from '../../themes/selectThemeVariant';\r\nimport { ThemeContext } from '../../themes/ThemeContext';\r\nimport { stylesFactory } from '../../themes/stylesFactory';\r\n\r\nconst getStyles = stylesFactory((theme: GrafanaTheme) => ({\r\n  collapse: css`\r\n    label: collapse;\r\n    margin-top: ${theme.spacing.sm};\r\n  `,\r\n  collapseBody: css`\r\n    label: collapse__body;\r\n    padding: ${theme.panelPadding}px;\r\n  `,\r\n  loader: css`\r\n    label: collapse__loader;\r\n    height: 2px;\r\n    position: relative;\r\n    overflow: hidden;\r\n    background: none;\r\n    margin: ${theme.spacing.xs};\r\n  `,\r\n  loaderActive: css`\r\n    label: collapse__loader_active;\r\n    &:after {\r\n      content: ' ';\r\n      display: block;\r\n      width: 25%;\r\n      top: 0;\r\n      top: -50%;\r\n      height: 250%;\r\n      position: absolute;\r\n      animation: loader 2s cubic-bezier(0.17, 0.67, 0.83, 0.67) 500ms;\r\n      animation-iteration-count: 100;\r\n      left: -25%;\r\n      background: ${theme.colors.blue};\r\n    }\r\n    @keyframes loader {\r\n      from {\r\n        left: -25%;\r\n        opacity: 0.1;\r\n      }\r\n      to {\r\n        left: 100%;\r\n        opacity: 1;\r\n      }\r\n    }\r\n  `,\r\n  header: css`\r\n    label: collapse__header;\r\n    padding: ${theme.spacing.sm} ${theme.spacing.md} 0 ${theme.spacing.md};\r\n    display: flex;\r\n    cursor: inherit;\r\n    transition: all 0.1s linear;\r\n    cursor: pointer;\r\n  `,\r\n  headerCollapsed: css`\r\n    label: collapse__header--collapsed;\r\n    cursor: pointer;\r\n    padding: ${theme.spacing.sm} ${theme.spacing.md} 0 ${theme.spacing.md};\r\n  `,\r\n  headerButtons: css`\r\n    label: collapse__header-buttons;\r\n    margin-right: ${theme.spacing.sm};\r\n    font-size: ${theme.typography.size.lg};\r\n    line-height: ${theme.typography.heading.h6};\r\n    display: inherit;\r\n  `,\r\n  headerButtonsCollapsed: css`\r\n    label: collapse__header-buttons--collapsed;\r\n    display: none;\r\n  `,\r\n  headerLabel: css`\r\n    label: collapse__header-label;\r\n    font-weight: ${theme.typography.weight.semibold};\r\n    margin-right: ${theme.spacing.sm};\r\n    font-size: ${theme.typography.heading.h6};\r\n    box-shadow: ${selectThemeVariant({ light: 'none', dark: '1px 1px 4px rgb(45, 45, 45)' }, theme.type)};\r\n  `,\r\n}));\r\n\r\ninterface Props {\r\n  isOpen?: boolean;\r\n  label: string;\r\n  loading?: boolean;\r\n  collapsible?: boolean;\r\n  onToggle?: (isOpen: boolean) => void;\r\n}\r\n\r\nexport const Collapse: FunctionComponent<Props> = ({ isOpen, label, loading, collapsible, onToggle, children }) => {\r\n  const theme = useContext(ThemeContext);\r\n  const style = getStyles(theme);\r\n  const onClickToggle = () => {\r\n    if (onToggle) {\r\n      onToggle(!isOpen);\r\n    }\r\n  };\r\n\r\n  const panelClass = cx([style.collapse, 'panel-container']);\r\n  const iconClass = isOpen ? 'fa fa-caret-up' : 'fa fa-caret-down';\r\n  const loaderClass = loading ? cx([style.loader, style.loaderActive]) : cx([style.loader]);\r\n  const headerClass = collapsible ? cx([style.header]) : cx([style.headerCollapsed]);\r\n  const headerButtonsClass = collapsible ? cx([style.headerButtons]) : cx([style.headerButtonsCollapsed]);\r\n\r\n  return (\r\n    <div className={panelClass}>\r\n      <div className={headerClass} onClick={onClickToggle}>\r\n        <div className={headerButtonsClass}>\r\n          <span className={iconClass} />\r\n        </div>\r\n        <div className={cx([style.headerLabel])}>{label}</div>\r\n      </div>\r\n      {isOpen && (\r\n        <div className={cx([style.collapseBody])}>\r\n          <div className={loaderClass} />\r\n          {children}\r\n        </div>\r\n      )}\r\n    </div>\r\n  );\r\n};\r\n\r\nCollapse.displayName = 'Collapse';\r\n","import React from 'react';\r\nimport tinycolor from 'tinycolor2';\r\nimport debounce from 'lodash/debounce';\r\n\r\nimport { ColorPickerProps } from './ColorPickerPopover';\r\nimport { Input } from '../Input/Input';\r\n\r\ninterface ColorInputState {\r\n  previousColor: string;\r\n  value: string;\r\n}\r\n\r\ninterface ColorInputProps extends ColorPickerProps {\r\n  style?: React.CSSProperties;\r\n}\r\n\r\nclass ColorInput extends React.PureComponent<ColorInputProps, ColorInputState> {\r\n  constructor(props: ColorInputProps) {\r\n    super(props);\r\n    this.state = {\r\n      previousColor: props.color,\r\n      value: props.color,\r\n    };\r\n\r\n    this.updateColor = debounce(this.updateColor, 100);\r\n  }\r\n\r\n  static getDerivedStateFromProps(props: ColorPickerProps, state: ColorInputState) {\r\n    const newColor = tinycolor(props.color);\r\n    if (newColor.isValid() && props.color !== state.previousColor) {\r\n      return {\r\n        ...state,\r\n        previousColor: props.color,\r\n        value: newColor.toString(),\r\n      };\r\n    }\r\n\r\n    return state;\r\n  }\r\n  updateColor = (color: string) => {\r\n    this.props.onChange(color);\r\n  };\r\n\r\n  onChange = (event: React.SyntheticEvent<HTMLInputElement>) => {\r\n    const newColor = tinycolor(event.currentTarget.value);\r\n\r\n    this.setState({\r\n      value: event.currentTarget.value,\r\n    });\r\n\r\n    if (newColor.isValid()) {\r\n      this.updateColor(newColor.toString());\r\n    }\r\n  };\r\n\r\n  onBlur = () => {\r\n    const newColor = tinycolor(this.state.value);\r\n\r\n    if (!newColor.isValid()) {\r\n      this.setState({\r\n        value: this.props.color,\r\n      });\r\n    }\r\n  };\r\n\r\n  render() {\r\n    const { value } = this.state;\r\n    return (\r\n      <div\r\n        style={{\r\n          display: 'flex',\r\n          ...this.props.style,\r\n        }}\r\n      >\r\n        <div\r\n          style={{\r\n            background: this.props.color,\r\n            width: '35px',\r\n            height: '35px',\r\n            flexGrow: 0,\r\n            borderRadius: '3px 0 0 3px',\r\n          }}\r\n        />\r\n        <div\r\n          style={{\r\n            flexGrow: 1,\r\n          }}\r\n        >\r\n          <Input className=\"gf-form-input\" value={value} onChange={this.onChange} onBlur={this.onBlur} />\r\n        </div>\r\n      </div>\r\n    );\r\n  }\r\n}\r\n\r\nexport default ColorInput;\r\n","import React, { Component, createRef } from 'react';\r\nimport omit from 'lodash/omit';\r\nimport { PopoverController } from '../Tooltip/PopoverController';\r\nimport { Popover } from '../Tooltip/Popover';\r\nimport { ColorPickerPopover, ColorPickerProps, ColorPickerChangeHandler } from './ColorPickerPopover';\r\nimport { getColorFromHexRgbOrName } from '@grafana/data';\r\nimport { SeriesColorPickerPopover } from './SeriesColorPickerPopover';\r\n\r\nimport { withTheme } from '../../themes/ThemeContext';\r\nimport { ColorPickerTrigger } from './ColorPickerTrigger';\r\n\r\n/**\r\n * If you need custom trigger for the color picker you can do that with a render prop pattern and supply a function\r\n * as a child. You will get show/hide function which you can map to desired interaction (like onClick or onMouseLeave)\r\n * and a ref which needs to be passed to an HTMLElement for correct positioning. If you want to use class or functional\r\n * component as a custom trigger you will need to forward the reference to first HTMLElement child.\r\n */\r\ntype ColorPickerTriggerRenderer = (props: {\r\n  // This should be a React.RefObject<HTMLElement> but due to how object refs are defined you cannot downcast from that\r\n  // to a specific type like React.RefObject<HTMLDivElement> even though it would be fine in runtime.\r\n  ref: React.RefObject<any>;\r\n  showColorPicker: () => void;\r\n  hideColorPicker: () => void;\r\n}) => React.ReactNode;\r\n\r\nexport const colorPickerFactory = <T extends ColorPickerProps>(\r\n  popover: React.ComponentType<T>,\r\n  displayName = 'ColorPicker'\r\n) => {\r\n  return class ColorPicker extends Component<T & { children?: ColorPickerTriggerRenderer }, any> {\r\n    static displayName = displayName;\r\n    pickerTriggerRef = createRef<any>();\r\n\r\n    onColorChange = (color: string) => {\r\n      const { onColorChange, onChange } = this.props;\r\n      const changeHandler = (onColorChange || onChange) as ColorPickerChangeHandler;\r\n\r\n      return changeHandler(color);\r\n    };\r\n\r\n    render() {\r\n      const { theme, children } = this.props;\r\n      const popoverElement = React.createElement(popover, {\r\n        ...omit(this.props, 'children'),\r\n        onChange: this.onColorChange,\r\n      });\r\n\r\n      return (\r\n        <PopoverController content={popoverElement} hideAfter={300}>\r\n          {(showPopper, hidePopper, popperProps) => {\r\n            return (\r\n              <>\r\n                {this.pickerTriggerRef.current && (\r\n                  <Popover\r\n                    {...popperProps}\r\n                    referenceElement={this.pickerTriggerRef.current}\r\n                    wrapperClassName=\"ColorPicker\"\r\n                    onMouseLeave={hidePopper}\r\n                    onMouseEnter={showPopper}\r\n                  />\r\n                )}\r\n\r\n                {children ? (\r\n                  // Children have a bit weird type due to intersection used in the definition so we need to cast here,\r\n                  // but the definition is correct and should not allow to pass a children that does not conform to\r\n                  // ColorPickerTriggerRenderer type.\r\n                  (children as ColorPickerTriggerRenderer)({\r\n                    ref: this.pickerTriggerRef,\r\n                    showColorPicker: showPopper,\r\n                    hideColorPicker: hidePopper,\r\n                  })\r\n                ) : (\r\n                  <ColorPickerTrigger\r\n                    ref={this.pickerTriggerRef}\r\n                    onClick={showPopper}\r\n                    onMouseLeave={hidePopper}\r\n                    color={getColorFromHexRgbOrName(this.props.color || '#000000', theme.type)}\r\n                  />\r\n                )}\r\n              </>\r\n            );\r\n          }}\r\n        </PopoverController>\r\n      );\r\n    }\r\n  };\r\n};\r\n\r\nexport const ColorPicker = withTheme(colorPickerFactory(ColorPickerPopover, 'ColorPicker'));\r\nexport const SeriesColorPicker = withTheme(colorPickerFactory(SeriesColorPickerPopover, 'SeriesColorPicker'));\r\n","import React from 'react';\r\nimport { NamedColorsPalette } from './NamedColorsPalette';\r\nimport { PopoverContentProps } from '../Tooltip/Tooltip';\r\nimport SpectrumPalette from './SpectrumPalette';\r\nimport { Themeable } from '../../types/theme';\r\nimport { warnAboutColorPickerPropsDeprecation } from './warnAboutColorPickerPropsDeprecation';\r\nimport { GrafanaThemeType, getColorName, getColorFromHexRgbOrName } from '@grafana/data';\r\n\r\nexport type ColorPickerChangeHandler = (color: string) => void;\r\n\r\nexport interface ColorPickerProps extends Themeable {\r\n  color: string;\r\n  onChange: ColorPickerChangeHandler;\r\n\r\n  /**\r\n   * @deprecated Use onChange instead\r\n   */\r\n  onColorChange?: ColorPickerChangeHandler;\r\n  enableNamedColors?: boolean;\r\n}\r\n\r\nexport interface Props<T> extends ColorPickerProps, PopoverContentProps {\r\n  customPickers?: T;\r\n}\r\n\r\ntype PickerType = 'palette' | 'spectrum';\r\n\r\nexport interface CustomPickersDescriptor {\r\n  [key: string]: {\r\n    tabComponent: React.ComponentType<ColorPickerProps>;\r\n    name: string;\r\n  };\r\n}\r\n\r\ninterface State<T> {\r\n  activePicker: PickerType | keyof T;\r\n}\r\n\r\nexport class ColorPickerPopover<T extends CustomPickersDescriptor> extends React.Component<Props<T>, State<T>> {\r\n  constructor(props: Props<T>) {\r\n    super(props);\r\n    this.state = {\r\n      activePicker: 'palette',\r\n    };\r\n    warnAboutColorPickerPropsDeprecation('ColorPickerPopover', props);\r\n  }\r\n\r\n  getTabClassName = (tabName: PickerType | keyof T) => {\r\n    const { activePicker } = this.state;\r\n    return `ColorPickerPopover__tab ${activePicker === tabName && 'ColorPickerPopover__tab--active'}`;\r\n  };\r\n\r\n  handleChange = (color: any) => {\r\n    const { onColorChange, onChange, enableNamedColors, theme } = this.props;\r\n    const changeHandler = onColorChange || onChange;\r\n\r\n    if (enableNamedColors) {\r\n      return changeHandler(color);\r\n    }\r\n    changeHandler(getColorFromHexRgbOrName(color, theme.type));\r\n  };\r\n\r\n  onTabChange = (tab: PickerType | keyof T) => {\r\n    return () => this.setState({ activePicker: tab });\r\n  };\r\n\r\n  renderPicker = () => {\r\n    const { activePicker } = this.state;\r\n    const { color, theme } = this.props;\r\n\r\n    switch (activePicker) {\r\n      case 'spectrum':\r\n        return <SpectrumPalette color={color} onChange={this.handleChange} theme={theme} />;\r\n      case 'palette':\r\n        return (\r\n          <NamedColorsPalette color={getColorName(color, theme.type)} onChange={this.handleChange} theme={theme} />\r\n        );\r\n      default:\r\n        return this.renderCustomPicker(activePicker);\r\n    }\r\n  };\r\n\r\n  renderCustomPicker = (tabKey: keyof T) => {\r\n    const { customPickers, color, theme } = this.props;\r\n    if (!customPickers) {\r\n      return null;\r\n    }\r\n\r\n    return React.createElement(customPickers[tabKey].tabComponent, {\r\n      color,\r\n      theme,\r\n      onChange: this.handleChange,\r\n    });\r\n  };\r\n\r\n  renderCustomPickerTabs = () => {\r\n    const { customPickers } = this.props;\r\n\r\n    if (!customPickers) {\r\n      return null;\r\n    }\r\n\r\n    return (\r\n      <>\r\n        {Object.keys(customPickers).map(key => {\r\n          return (\r\n            <div className={this.getTabClassName(key)} onClick={this.onTabChange(key)} key={key}>\r\n              {customPickers[key].name}\r\n            </div>\r\n          );\r\n        })}\r\n      </>\r\n    );\r\n  };\r\n\r\n  render() {\r\n    const { theme } = this.props;\r\n    const colorPickerTheme = theme.type || GrafanaThemeType.Dark;\r\n    return (\r\n      <div className={`ColorPickerPopover ColorPickerPopover--${colorPickerTheme}`}>\r\n        <div className=\"ColorPickerPopover__tabs\">\r\n          <div className={this.getTabClassName('palette')} onClick={this.onTabChange('palette')}>\r\n            Colors\r\n          </div>\r\n          <div className={this.getTabClassName('spectrum')} onClick={this.onTabChange('spectrum')}>\r\n            Custom\r\n          </div>\r\n          {this.renderCustomPickerTabs()}\r\n        </div>\r\n\r\n        <div className=\"ColorPickerPopover__content\">{this.renderPicker()}</div>\r\n      </div>\r\n    );\r\n  }\r\n}\r\n","import React, { forwardRef } from 'react';\r\n\r\ninterface ColorPickerTriggerProps {\r\n  onClick: () => void;\r\n  onMouseLeave: () => void;\r\n  color: string;\r\n}\r\n\r\nexport const ColorPickerTrigger = forwardRef(function ColorPickerTrigger(\r\n  props: ColorPickerTriggerProps,\r\n  ref: React.Ref<HTMLDivElement>\r\n) {\r\n  return (\r\n    <div\r\n      ref={ref}\r\n      onClick={props.onClick}\r\n      onMouseLeave={props.onMouseLeave}\r\n      style={{\r\n        overflow: 'hidden',\r\n        background: 'inherit',\r\n        border: 'none',\r\n        color: 'inherit',\r\n        padding: 0,\r\n        borderRadius: 10,\r\n        cursor: 'pointer',\r\n      }}\r\n    >\r\n      <div\r\n        style={{\r\n          position: 'relative',\r\n          width: 15,\r\n          height: 15,\r\n          border: 'none',\r\n          margin: 0,\r\n          float: 'left',\r\n          zIndex: 0,\r\n          backgroundImage:\r\n            // tslint:disable-next-line:max-line-length\r\n            'url(data:image/png,base64,iVBORw0KGgoAAAANSUhEUgAAAAwAAAAMCAIAAADZF8uwAAAAGUlEQVQYV2M4gwH+YwCGIasIUwhT25BVBADtzYNYrHvv4gAAAABJRU5ErkJggg==)',\r\n        }}\r\n      >\r\n        <div\r\n          style={{\r\n            backgroundColor: props.color,\r\n            display: 'block',\r\n            position: 'absolute',\r\n            top: 0,\r\n            left: 0,\r\n            bottom: 0,\r\n            right: 0,\r\n          }}\r\n        />\r\n      </div>\r\n    </div>\r\n  );\r\n});\r\n","import React, { FunctionComponent } from 'react';\r\nimport { Themeable } from '../../types';\r\nimport { ColorDefinition, getColorForTheme } from '@grafana/data';\r\nimport { Color } from 'csstype';\r\nimport upperFirst from 'lodash/upperFirst';\r\nimport find from 'lodash/find';\r\nimport { selectThemeVariant } from '../../themes/selectThemeVariant';\r\n\r\ntype ColorChangeHandler = (color: ColorDefinition) => void;\r\n\r\nexport enum ColorSwatchVariant {\r\n  Small = 'small',\r\n  Large = 'large',\r\n}\r\n\r\ninterface ColorSwatchProps extends Themeable, React.DOMAttributes<HTMLDivElement> {\r\n  color: string;\r\n  label?: string;\r\n  variant?: ColorSwatchVariant;\r\n  isSelected?: boolean;\r\n}\r\n\r\nexport const ColorSwatch: FunctionComponent<ColorSwatchProps> = ({\r\n  color,\r\n  label,\r\n  variant = ColorSwatchVariant.Small,\r\n  isSelected,\r\n  theme,\r\n  ...otherProps\r\n}) => {\r\n  const isSmall = variant === ColorSwatchVariant.Small;\r\n  const swatchSize = isSmall ? '16px' : '32px';\r\n\r\n  const selectedSwatchBorder = selectThemeVariant(\r\n    {\r\n      light: theme.colors.white,\r\n      dark: theme.colors.black,\r\n    },\r\n    theme.type\r\n  );\r\n\r\n  const swatchStyles = {\r\n    width: swatchSize,\r\n    height: swatchSize,\r\n    borderRadius: '50%',\r\n    background: `${color}`,\r\n    marginRight: isSmall ? '0px' : '8px',\r\n    boxShadow: isSelected ? `inset 0 0 0 2px ${color}, inset 0 0 0 4px ${selectedSwatchBorder}` : 'none',\r\n  };\r\n\r\n  return (\r\n    <div\r\n      style={{\r\n        display: 'flex',\r\n        alignItems: 'center',\r\n        cursor: 'pointer',\r\n      }}\r\n      {...otherProps}\r\n    >\r\n      <div style={swatchStyles} />\r\n      {variant === ColorSwatchVariant.Large && <span>{label}</span>}\r\n    </div>\r\n  );\r\n};\r\n\r\ninterface NamedColorsGroupProps extends Themeable {\r\n  colors: ColorDefinition[];\r\n  selectedColor?: Color;\r\n  onColorSelect: ColorChangeHandler;\r\n  key?: string;\r\n}\r\n\r\nconst NamedColorsGroup: FunctionComponent<NamedColorsGroupProps> = ({\r\n  colors,\r\n  selectedColor,\r\n  onColorSelect,\r\n  theme,\r\n  ...otherProps\r\n}) => {\r\n  const primaryColor = find(colors, color => !!color.isPrimary);\r\n\r\n  return (\r\n    <div {...otherProps} style={{ display: 'flex', flexDirection: 'column' }}>\r\n      {primaryColor && (\r\n        <ColorSwatch\r\n          key={primaryColor.name}\r\n          isSelected={primaryColor.name === selectedColor}\r\n          variant={ColorSwatchVariant.Large}\r\n          color={getColorForTheme(primaryColor, theme.type)}\r\n          label={upperFirst(primaryColor.hue)}\r\n          onClick={() => onColorSelect(primaryColor)}\r\n          theme={theme}\r\n        />\r\n      )}\r\n      <div\r\n        style={{\r\n          display: 'flex',\r\n          marginTop: '8px',\r\n        }}\r\n      >\r\n        {colors.map(\r\n          color =>\r\n            !color.isPrimary && (\r\n              <div key={color.name} style={{ marginRight: '4px' }}>\r\n                <ColorSwatch\r\n                  key={color.name}\r\n                  isSelected={color.name === selectedColor}\r\n                  color={getColorForTheme(color, theme.type)}\r\n                  onClick={() => onColorSelect(color)}\r\n                  theme={theme}\r\n                />\r\n              </div>\r\n            )\r\n        )}\r\n      </div>\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default NamedColorsGroup;\r\n","import React from 'react';\r\nimport { Color, getNamedColorPalette } from '@grafana/data';\r\nimport { Themeable } from '../../types/index';\r\nimport NamedColorsGroup from './NamedColorsGroup';\r\n\r\ninterface NamedColorsPaletteProps extends Themeable {\r\n  color?: Color;\r\n  onChange: (colorName: string) => void;\r\n}\r\n\r\nexport const NamedColorsPalette = ({ color, onChange, theme }: NamedColorsPaletteProps) => {\r\n  const swatches: JSX.Element[] = [];\r\n  getNamedColorPalette().forEach((colors, hue) => {\r\n    swatches.push(\r\n      <NamedColorsGroup\r\n        key={hue}\r\n        theme={theme}\r\n        selectedColor={color}\r\n        colors={colors}\r\n        onColorSelect={color => {\r\n          onChange(color.name);\r\n        }}\r\n      />\r\n    );\r\n  });\r\n\r\n  return (\r\n    <div\r\n      style={{\r\n        display: 'grid',\r\n        gridTemplateColumns: 'repeat(3, 1fr)',\r\n        gridRowGap: '24px',\r\n        gridColumnGap: '24px',\r\n      }}\r\n    >\r\n      {swatches}\r\n    </div>\r\n  );\r\n};\r\n","import React, { FunctionComponent } from 'react';\r\n\r\nimport { ColorPickerPopover, ColorPickerProps } from './ColorPickerPopover';\r\nimport { PopoverContentProps } from '../Tooltip/Tooltip';\r\nimport { Switch } from '../Switch/Switch';\r\nimport { withTheme } from '../../themes/ThemeContext';\r\n\r\nexport interface SeriesColorPickerPopoverProps extends ColorPickerProps, PopoverContentProps {\r\n  yaxis?: number;\r\n  onToggleAxis?: () => void;\r\n}\r\n\r\nexport const SeriesColorPickerPopover: FunctionComponent<SeriesColorPickerPopoverProps> = props => {\r\n  const { yaxis, onToggleAxis, color, ...colorPickerProps } = props;\r\n  return (\r\n    <ColorPickerPopover\r\n      {...colorPickerProps}\r\n      color={color || '#000000'}\r\n      customPickers={{\r\n        yaxis: {\r\n          name: 'Y-Axis',\r\n          tabComponent: () => (\r\n            <Switch\r\n              key=\"yaxisSwitch\"\r\n              label=\"Use right y-axis\"\r\n              className=\"ColorPicker__axisSwitch\"\r\n              labelClass=\"ColorPicker__axisSwitchLabel\"\r\n              checked={yaxis === 2}\r\n              onChange={() => {\r\n                if (onToggleAxis) {\r\n                  onToggleAxis();\r\n                }\r\n              }}\r\n            />\r\n          ),\r\n        },\r\n      }}\r\n    />\r\n  );\r\n};\r\n\r\ninterface AxisSelectorProps {\r\n  yaxis: number;\r\n  onToggleAxis?: () => void;\r\n}\r\n\r\ninterface AxisSelectorState {\r\n  yaxis: number;\r\n}\r\n\r\nexport class AxisSelector extends React.PureComponent<AxisSelectorProps, AxisSelectorState> {\r\n  constructor(props: AxisSelectorProps) {\r\n    super(props);\r\n    this.state = {\r\n      yaxis: this.props.yaxis,\r\n    };\r\n    this.onToggleAxis = this.onToggleAxis.bind(this);\r\n  }\r\n\r\n  onToggleAxis() {\r\n    this.setState({\r\n      yaxis: this.state.yaxis === 2 ? 1 : 2,\r\n    });\r\n\r\n    if (this.props.onToggleAxis) {\r\n      this.props.onToggleAxis();\r\n    }\r\n  }\r\n\r\n  render() {\r\n    const leftButtonClass = this.state.yaxis === 1 ? 'btn-primary' : 'btn-inverse';\r\n    const rightButtonClass = this.state.yaxis === 2 ? 'btn-primary' : 'btn-inverse';\r\n\r\n    return (\r\n      <div className=\"p-b-1\">\r\n        <label className=\"small p-r-1\">Y Axis:</label>\r\n        <button onClick={this.onToggleAxis} className={'btn btn-small ' + leftButtonClass}>\r\n          Left\r\n        </button>\r\n        <button onClick={this.onToggleAxis} className={'btn btn-small ' + rightButtonClass}>\r\n          Right\r\n        </button>\r\n      </div>\r\n    );\r\n  }\r\n}\r\n\r\n// This component is to enable SeriecColorPickerPopover usage via series-color-picker-popover directive\r\nexport const SeriesColorPickerPopoverWithTheme = withTheme(SeriesColorPickerPopover);\r\n","import React from 'react';\r\nimport { CustomPicker, ColorResult } from 'react-color';\r\n\r\nimport { Saturation, Hue, Alpha } from 'react-color/lib/components/common';\r\nimport tinycolor from 'tinycolor2';\r\nimport ColorInput from './ColorInput';\r\nimport { Themeable } from '../../types';\r\nimport SpectrumPalettePointer, { SpectrumPalettePointerProps } from './SpectrumPalettePointer';\r\nimport { GrafanaTheme, getColorFromHexRgbOrName } from '@grafana/data';\r\n\r\nexport interface SpectrumPaletteProps extends Themeable {\r\n  color: string;\r\n  onChange: (color: string) => void;\r\n}\r\n\r\nconst renderPointer = (theme: GrafanaTheme) => (props: SpectrumPalettePointerProps) => (\r\n  <SpectrumPalettePointer {...props} theme={theme} />\r\n);\r\n\r\n// @ts-ignore\r\nconst SpectrumPicker = CustomPicker<Themeable>(({ rgb, hsl, onChange, theme }) => {\r\n  return (\r\n    <div\r\n      style={{\r\n        display: 'flex',\r\n        width: '100%',\r\n        flexDirection: 'column',\r\n      }}\r\n    >\r\n      <div\r\n        style={{\r\n          display: 'flex',\r\n        }}\r\n      >\r\n        <div\r\n          style={{\r\n            display: 'flex',\r\n            flexGrow: 1,\r\n            flexDirection: 'column',\r\n          }}\r\n        >\r\n          <div\r\n            style={{\r\n              position: 'relative',\r\n              height: '100px',\r\n              width: '100%',\r\n            }}\r\n          >\r\n            {/*\r\n      // @ts-ignore */}\r\n            <Saturation onChange={onChange} hsl={hsl} hsv={tinycolor(hsl).toHsv()} />\r\n          </div>\r\n          <div\r\n            style={{\r\n              width: '100%',\r\n              height: '16px',\r\n              marginTop: '16px',\r\n              position: 'relative',\r\n              background: 'white',\r\n            }}\r\n          >\r\n            {/*\r\n      // @ts-ignore */}\r\n            <Alpha rgb={rgb} hsl={hsl} a={rgb.a} onChange={onChange} pointer={renderPointer(theme)} />\r\n          </div>\r\n        </div>\r\n\r\n        <div\r\n          style={{\r\n            position: 'relative',\r\n            width: '16px',\r\n            height: '100px',\r\n            marginLeft: '16px',\r\n          }}\r\n        >\r\n          {/*\r\n        // @ts-ignore */}\r\n          <Hue onChange={onChange} hsl={hsl} direction=\"vertical\" pointer={renderPointer(theme)} />\r\n        </div>\r\n      </div>\r\n    </div>\r\n  );\r\n});\r\n\r\nconst SpectrumPalette: React.FunctionComponent<SpectrumPaletteProps> = ({ color, onChange, theme }) => {\r\n  return (\r\n    <div>\r\n      <SpectrumPicker\r\n        color={tinycolor(getColorFromHexRgbOrName(color)).toRgb()}\r\n        onChange={(a: ColorResult) => {\r\n          onChange(tinycolor(a.rgb).toString());\r\n        }}\r\n        theme={theme}\r\n      />\r\n      <ColorInput theme={theme} color={color} onChange={onChange} style={{ marginTop: '16px' }} />\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default SpectrumPalette;\r\n","import React from 'react';\r\nimport { Themeable } from '../../types';\r\nimport { selectThemeVariant } from '../../themes/selectThemeVariant';\r\n\r\nexport interface SpectrumPalettePointerProps extends Themeable {\r\n  direction?: string;\r\n}\r\n\r\nconst SpectrumPalettePointer: React.FunctionComponent<SpectrumPalettePointerProps> = ({ theme, direction }) => {\r\n  const styles = {\r\n    picker: {\r\n      width: '16px',\r\n      height: '16px',\r\n      transform: direction === 'vertical' ? 'translate(0, -8px)' : 'translate(-8px, 0)',\r\n    },\r\n  };\r\n\r\n  const pointerColor = selectThemeVariant(\r\n    {\r\n      light: theme.colors.dark3,\r\n      dark: theme.colors.gray2,\r\n    },\r\n    theme.type\r\n  );\r\n\r\n  let pointerStyles: React.CSSProperties = {\r\n    position: 'absolute',\r\n    left: '6px',\r\n    width: '0',\r\n    height: '0',\r\n    borderStyle: 'solid',\r\n    background: 'none',\r\n  };\r\n\r\n  let topArrowStyles: React.CSSProperties = {\r\n    top: '-7px',\r\n    borderWidth: '6px 3px 0px 3px',\r\n    borderColor: `${pointerColor} transparent transparent transparent`,\r\n  };\r\n\r\n  let bottomArrowStyles: React.CSSProperties = {\r\n    bottom: '-7px',\r\n    borderWidth: '0px 3px 6px 3px',\r\n    borderColor: ` transparent transparent ${pointerColor} transparent`,\r\n  };\r\n\r\n  if (direction === 'vertical') {\r\n    pointerStyles = {\r\n      ...pointerStyles,\r\n      left: 'auto',\r\n    };\r\n    topArrowStyles = {\r\n      borderWidth: '3px 0px 3px 6px',\r\n      borderColor: `transparent transparent transparent ${pointerColor}`,\r\n      left: '-7px',\r\n      top: '7px',\r\n    };\r\n    bottomArrowStyles = {\r\n      borderWidth: '3px 6px 3px 0px',\r\n      borderColor: `transparent ${pointerColor} transparent transparent`,\r\n      right: '-7px',\r\n      top: '7px',\r\n    };\r\n  }\r\n\r\n  return (\r\n    <div style={styles.picker}>\r\n      <div\r\n        style={{\r\n          ...pointerStyles,\r\n          ...topArrowStyles,\r\n        }}\r\n      />\r\n      <div\r\n        style={{\r\n          ...pointerStyles,\r\n          ...bottomArrowStyles,\r\n        }}\r\n      />\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default SpectrumPalettePointer;\r\n","import { deprecationWarning } from '@grafana/data';\nimport { ColorPickerProps } from './ColorPickerPopover';\n\nexport const warnAboutColorPickerPropsDeprecation = (componentName: string, props: ColorPickerProps) => {\n  const { onColorChange } = props;\n  if (onColorChange) {\n    deprecationWarning(componentName, 'onColorChange', 'onChange');\n  }\n};\n","import React, { PureComponent, SyntheticEvent } from 'react';\r\nimport { cx, css } from 'emotion';\r\nimport { stylesFactory, withTheme } from '../../themes';\r\nimport { GrafanaTheme } from '@grafana/data';\r\nimport { Themeable } from '../../types';\r\nimport { Button } from '../Button/Button';\r\nimport Forms from '../Forms';\r\nimport { ButtonVariant, ButtonSize } from '../Button/types';\r\n\r\nconst getStyles = stylesFactory((theme: GrafanaTheme) => {\r\n  return {\r\n    buttonContainer: css`\r\n      direction: rtl;\r\n      display: flex;\r\n      align-items: center;\r\n    `,\r\n    buttonDisabled: css`\r\n      text-decoration: none;\r\n      color: ${theme.colors.text};\r\n      opacity: 0.65;\r\n      cursor: not-allowed;\r\n      pointer-events: none;\r\n    `,\r\n    buttonShow: css`\r\n      opacity: 1;\r\n      transition: opacity 0.1s ease;\r\n      z-index: 2;\r\n    `,\r\n    buttonHide: css`\r\n      opacity: 0;\r\n      transition: opacity 0.1s ease;\r\n      z-index: 0;\r\n    `,\r\n    confirmButtonContainer: css`\r\n      overflow: hidden;\r\n      position: absolute;\r\n      z-index: 1;\r\n    `,\r\n    confirmButton: css`\r\n      display: flex;\r\n      align-items: flex-start;\r\n    `,\r\n    confirmButtonShow: css`\r\n      opacity: 1;\r\n      transition: opacity 0.08s ease-out, transform 0.1s ease-out;\r\n      transform: translateX(0);\r\n    `,\r\n    confirmButtonHide: css`\r\n      opacity: 0;\r\n      transition: opacity 0.12s ease-in, transform 0.14s ease-in;\r\n      transform: translateX(100px);\r\n    `,\r\n  };\r\n});\r\n\r\ninterface Props extends Themeable {\r\n  className?: string;\r\n  size?: ButtonSize;\r\n  confirmText?: string;\r\n  disabled?: boolean;\r\n  confirmVariant?: ButtonVariant;\r\n\r\n  onConfirm(): void;\r\n  onClick?(): void;\r\n  onCancel?(): void;\r\n}\r\n\r\ninterface State {\r\n  showConfirm: boolean;\r\n}\r\n\r\nclass UnThemedConfirmButton extends PureComponent<Props, State> {\r\n  static defaultProps: Partial<Props> = {\r\n    size: 'md',\r\n    confirmText: 'Save',\r\n    disabled: false,\r\n    confirmVariant: 'primary',\r\n  };\r\n\r\n  state: State = {\r\n    showConfirm: false,\r\n  };\r\n\r\n  onClickButton = (event: SyntheticEvent) => {\r\n    if (event) {\r\n      event.preventDefault();\r\n    }\r\n\r\n    this.setState({\r\n      showConfirm: true,\r\n    });\r\n\r\n    if (this.props.onClick) {\r\n      this.props.onClick();\r\n    }\r\n  };\r\n\r\n  onClickCancel = (event: SyntheticEvent) => {\r\n    if (event) {\r\n      event.preventDefault();\r\n    }\r\n    this.setState({\r\n      showConfirm: false,\r\n    });\r\n    if (this.props.onCancel) {\r\n      this.props.onCancel();\r\n    }\r\n  };\r\n\r\n  render() {\r\n    const {\r\n      theme,\r\n      className,\r\n      size,\r\n      disabled,\r\n      confirmText,\r\n      confirmVariant: confirmButtonVariant,\r\n      onConfirm,\r\n      children,\r\n    } = this.props;\r\n    const styles = getStyles(theme);\r\n    const buttonClass = cx(\r\n      className,\r\n      this.state.showConfirm ? styles.buttonHide : styles.buttonShow,\r\n      disabled && styles.buttonDisabled\r\n    );\r\n    const confirmButtonClass = cx(\r\n      styles.confirmButton,\r\n      this.state.showConfirm ? styles.confirmButtonShow : styles.confirmButtonHide\r\n    );\r\n    const onClick = disabled ? () => {} : this.onClickButton;\r\n\r\n    return (\r\n      <span className={styles.buttonContainer}>\r\n        {typeof children === 'string' ? (\r\n          <span className={buttonClass}>\r\n            <Forms.Button size={size} variant=\"link\" onClick={onClick}>\r\n              {children}\r\n            </Forms.Button>\r\n          </span>\r\n        ) : (\r\n          <span className={buttonClass} onClick={onClick}>\r\n            {children}\r\n          </span>\r\n        )}\r\n        <span className={styles.confirmButtonContainer}>\r\n          <span className={confirmButtonClass}>\r\n            <Button size={size} variant=\"transparent\" onClick={this.onClickCancel}>\r\n              Cancel\r\n            </Button>\r\n            <Button size={size} variant={confirmButtonVariant} onClick={onConfirm}>\r\n              {confirmText}\r\n            </Button>\r\n          </span>\r\n        </span>\r\n      </span>\r\n    );\r\n  }\r\n}\r\n\r\nexport const ConfirmButton = withTheme(UnThemedConfirmButton);\r\nConfirmButton.displayName = 'ConfirmButton';\r\n","import React, { FC } from 'react';\r\nimport { ConfirmButton } from './ConfirmButton';\r\nimport { Button } from '../Button/Button';\r\nimport { ButtonSize } from '../Button/types';\r\n\r\ninterface Props {\r\n  size?: ButtonSize;\r\n  disabled?: boolean;\r\n  onConfirm(): void;\r\n}\r\n\r\nexport const DeleteButton: FC<Props> = ({ size, disabled, onConfirm }) => {\r\n  return (\r\n    <ConfirmButton\r\n      confirmText=\"Delete\"\r\n      confirmVariant=\"danger\"\r\n      size={size || 'md'}\r\n      disabled={disabled}\r\n      onConfirm={onConfirm}\r\n    >\r\n      <Button variant=\"danger\" icon=\"fa fa-remove\" size={size || 'sm'} />\r\n    </ConfirmButton>\r\n  );\r\n};\r\n","import React, { FC, useContext } from 'react';\r\nimport { css } from 'emotion';\r\nimport { Modal } from '../Modal/Modal';\r\nimport { IconType } from '../Icon/types';\r\nimport { Button } from '../Button/Button';\r\nimport { stylesFactory, ThemeContext } from '../../themes';\r\nimport { GrafanaTheme } from '@grafana/data';\r\n\r\nconst getStyles = stylesFactory((theme: GrafanaTheme) => ({\r\n  modal: css`\r\n    width: 500px;\r\n  `,\r\n  modalContent: css`\r\n    text-align: center;\r\n  `,\r\n  modalText: css`\r\n    font-size: ${theme.typography.heading.h4};\r\n    color: ${theme.colors.link};\r\n    margin-bottom: calc(${theme.spacing.d} * 2);\r\n    padding-top: ${theme.spacing.d};\r\n  `,\r\n  modalButtonRow: css`\r\n    margin-bottom: 14px;\r\n    a,\r\n    button {\r\n      margin-right: ${theme.spacing.d};\r\n    }\r\n  `,\r\n}));\r\n\r\nconst defaultIcon: IconType = 'exclamation-triangle';\r\n\r\ninterface Props {\r\n  isOpen: boolean;\r\n  title: string;\r\n  body: string;\r\n  confirmText: string;\r\n  icon?: IconType;\r\n\r\n  onConfirm(): void;\r\n  onDismiss(): void;\r\n}\r\n\r\nexport const ConfirmModal: FC<Props> = ({ isOpen, title, body, confirmText, icon, onConfirm, onDismiss }) => {\r\n  const theme = useContext(ThemeContext);\r\n  const styles = getStyles(theme);\r\n\r\n  return (\r\n    <Modal className={styles.modal} title={title} icon={icon || defaultIcon} isOpen={isOpen} onDismiss={onDismiss}>\r\n      <div className={styles.modalContent}>\r\n        <div className={styles.modalText}>{body}</div>\r\n        <div className={styles.modalButtonRow}>\r\n          <Button variant=\"danger\" onClick={onConfirm}>\r\n            {confirmText}\r\n          </Button>\r\n          <Button variant=\"inverse\" onClick={onDismiss}>\r\n            Cancel\r\n          </Button>\r\n        </div>\r\n      </div>\r\n    </Modal>\r\n  );\r\n};\r\n","import React, { useContext, useRef, useState, useLayoutEffect } from 'react';\r\nimport { css, cx } from 'emotion';\r\nimport useClickAway from 'react-use/lib/useClickAway';\r\nimport { selectThemeVariant, ThemeContext } from '../../index';\r\nimport { GrafanaTheme } from '@grafana/data';\r\nimport { stylesFactory } from '../../themes/stylesFactory';\r\nimport { Portal, List } from '../index';\r\nimport { LinkTarget } from '@grafana/data';\r\n\r\nexport interface ContextMenuItem {\r\n  label: string;\r\n  target?: LinkTarget;\r\n  icon?: string;\r\n  url?: string;\r\n  onClick?: (event?: React.SyntheticEvent<HTMLElement>) => void;\r\n  group?: string;\r\n}\r\n\r\nexport interface ContextMenuGroup {\r\n  label?: string;\r\n  items: ContextMenuItem[];\r\n}\r\nexport interface ContextMenuProps {\r\n  x: number;\r\n  y: number;\r\n  onClose: () => void;\r\n  items?: ContextMenuGroup[];\r\n  renderHeader?: () => React.ReactNode;\r\n}\r\n\r\nconst getContextMenuStyles = stylesFactory((theme: GrafanaTheme) => {\r\n  const linkColor = selectThemeVariant(\r\n    {\r\n      light: theme.colors.dark2,\r\n      dark: theme.colors.text,\r\n    },\r\n    theme.type\r\n  );\r\n  const linkColorHover = selectThemeVariant(\r\n    {\r\n      light: theme.colors.link,\r\n      dark: theme.colors.white,\r\n    },\r\n    theme.type\r\n  );\r\n  const wrapperBg = selectThemeVariant(\r\n    {\r\n      light: theme.colors.gray7,\r\n      dark: theme.colors.dark2,\r\n    },\r\n    theme.type\r\n  );\r\n  const wrapperShadow = selectThemeVariant(\r\n    {\r\n      light: theme.colors.gray3,\r\n      dark: theme.colors.black,\r\n    },\r\n    theme.type\r\n  );\r\n  const itemColor = selectThemeVariant(\r\n    {\r\n      light: theme.colors.black,\r\n      dark: theme.colors.white,\r\n    },\r\n    theme.type\r\n  );\r\n\r\n  const groupLabelColor = selectThemeVariant(\r\n    {\r\n      light: theme.colors.gray1,\r\n      dark: theme.colors.textWeak,\r\n    },\r\n    theme.type\r\n  );\r\n\r\n  const itemBgHover = selectThemeVariant(\r\n    {\r\n      light: theme.colors.gray5,\r\n      dark: theme.colors.dark7,\r\n    },\r\n    theme.type\r\n  );\r\n  const headerBg = selectThemeVariant(\r\n    {\r\n      light: theme.colors.white,\r\n      dark: theme.colors.dark1,\r\n    },\r\n    theme.type\r\n  );\r\n  const headerSeparator = selectThemeVariant(\r\n    {\r\n      light: theme.colors.white,\r\n      dark: theme.colors.dark7,\r\n    },\r\n    theme.type\r\n  );\r\n\r\n  return {\r\n    header: css`\r\n      padding: 4px;\r\n      border-bottom: 1px solid ${headerSeparator};\r\n      background: ${headerBg};\r\n      margin-bottom: ${theme.spacing.xs};\r\n      border-radius: ${theme.border.radius.sm} ${theme.border.radius.sm} 0 0;\r\n    `,\r\n    wrapper: css`\r\n      background: ${wrapperBg};\r\n      z-index: 1;\r\n      box-shadow: 0 2px 5px 0 ${wrapperShadow};\r\n      min-width: 200px;\r\n      display: inline-block;\r\n      border-radius: ${theme.border.radius.sm};\r\n    `,\r\n    link: css`\r\n      color: ${linkColor};\r\n      display: flex;\r\n      cursor: pointer;\r\n      &:hover {\r\n        color: ${linkColorHover};\r\n        text-decoration: none;\r\n      }\r\n    `,\r\n    item: css`\r\n      background: none;\r\n      padding: 4px 8px;\r\n      color: ${itemColor};\r\n      border-left: 2px solid transparent;\r\n      cursor: pointer;\r\n      &:hover {\r\n        background: ${itemBgHover};\r\n        border-image: linear-gradient(#f05a28 30%, #fbca0a 99%);\r\n        border-image-slice: 1;\r\n      }\r\n    `,\r\n    groupLabel: css`\r\n      color: ${groupLabelColor};\r\n      font-size: ${theme.typography.size.sm};\r\n      line-height: ${theme.typography.lineHeight.md};\r\n      padding: ${theme.spacing.xs} ${theme.spacing.sm};\r\n    `,\r\n    icon: css`\r\n      opacity: 0.7;\r\n      width: 12px;\r\n      height: 12px;\r\n      display: inline-block;\r\n      margin-right: 10px;\r\n      color: ${theme.colors.linkDisabled};\r\n      position: relative;\r\n      top: 4px;\r\n    `,\r\n  };\r\n});\r\n\r\nexport const ContextMenu: React.FC<ContextMenuProps> = React.memo(({ x, y, onClose, items, renderHeader }) => {\r\n  const theme = useContext(ThemeContext);\r\n  const menuRef = useRef<HTMLDivElement>(null);\r\n  const [positionStyles, setPositionStyles] = useState({});\r\n\r\n  useLayoutEffect(() => {\r\n    const menuElement = menuRef.current;\r\n    if (menuElement) {\r\n      const rect = menuElement.getBoundingClientRect();\r\n      const OFFSET = 5;\r\n      const collisions = {\r\n        right: window.innerWidth < x + rect.width,\r\n        bottom: window.innerHeight < rect.bottom + rect.height + OFFSET,\r\n      };\r\n\r\n      setPositionStyles({\r\n        position: 'fixed',\r\n        left: collisions.right ? x - rect.width - OFFSET : x - OFFSET,\r\n        top: collisions.bottom ? y - rect.height - OFFSET : y + OFFSET,\r\n      });\r\n    }\r\n  }, [menuRef.current]);\r\n\r\n  useClickAway(menuRef, () => {\r\n    if (onClose) {\r\n      onClose();\r\n    }\r\n  });\r\n\r\n  const styles = getContextMenuStyles(theme);\r\n  const header = renderHeader && renderHeader();\r\n  return (\r\n    <Portal>\r\n      <div ref={menuRef} style={positionStyles} className={styles.wrapper}>\r\n        {header && <div className={styles.header}>{header}</div>}\r\n        <List\r\n          items={items || []}\r\n          renderItem={(item, index) => {\r\n            return (\r\n              <>\r\n                <ContextMenuGroup group={item} onClick={onClose} />\r\n              </>\r\n            );\r\n          }}\r\n        />\r\n      </div>\r\n    </Portal>\r\n  );\r\n});\r\n\r\ninterface ContextMenuItemProps {\r\n  label: string;\r\n  icon?: string;\r\n  url?: string;\r\n  target?: string;\r\n  onClick?: (e: React.MouseEvent<HTMLAnchorElement>) => void;\r\n  className?: string;\r\n}\r\n\r\nconst ContextMenuItem: React.FC<ContextMenuItemProps> = React.memo(\r\n  ({ url, icon, label, target, onClick, className }) => {\r\n    const theme = useContext(ThemeContext);\r\n    const styles = getContextMenuStyles(theme);\r\n    return (\r\n      <div className={styles.item}>\r\n        <a\r\n          href={url ? url : undefined}\r\n          target={target || '_self'}\r\n          className={cx(className, styles.link)}\r\n          onClick={e => {\r\n            if (onClick) {\r\n              onClick(e);\r\n            }\r\n          }}\r\n        >\r\n          {icon && <i className={cx(`${icon}`, styles.icon)} />} {label}\r\n        </a>\r\n      </div>\r\n    );\r\n  }\r\n);\r\n\r\ninterface ContextMenuGroupProps {\r\n  group: ContextMenuGroup;\r\n  onClick?: () => void; // Used with 'onClose'\r\n}\r\n\r\nconst ContextMenuGroup: React.FC<ContextMenuGroupProps> = ({ group, onClick }) => {\r\n  const theme = useContext(ThemeContext);\r\n  const styles = getContextMenuStyles(theme);\r\n\r\n  if (group.items.length === 0) {\r\n    return null;\r\n  }\r\n\r\n  return (\r\n    <div>\r\n      {group.label && <div className={styles.groupLabel}>{group.label}</div>}\r\n      <List\r\n        items={group.items || []}\r\n        renderItem={item => {\r\n          return (\r\n            <ContextMenuItem\r\n              url={item.url}\r\n              label={item.label}\r\n              target={item.target}\r\n              icon={item.icon}\r\n              onClick={(e: React.MouseEvent<HTMLElement>) => {\r\n                if (item.onClick) {\r\n                  item.onClick(e);\r\n                }\r\n\r\n                // Typically closes the context menu\r\n                if (onClick) {\r\n                  onClick();\r\n                }\r\n              }}\r\n            />\r\n          );\r\n        }}\r\n      />\r\n    </div>\r\n  );\r\n};\r\nContextMenu.displayName = 'ContextMenu';\r\n","import React, { useState } from 'react';\r\nimport { ContextMenu, ContextMenuGroup } from '../ContextMenu/ContextMenu';\r\n\r\ninterface WithContextMenuProps {\r\n  children: (props: { openMenu: React.MouseEventHandler<HTMLElement> }) => JSX.Element;\r\n  getContextMenuItems: () => ContextMenuGroup[];\r\n}\r\n\r\nexport const WithContextMenu: React.FC<WithContextMenuProps> = ({ children, getContextMenuItems }) => {\r\n  const [isMenuOpen, setIsMenuOpen] = useState(false);\r\n  const [menuPosition, setMenuPositon] = useState({ x: 0, y: 0 });\r\n\r\n  return (\r\n    <>\r\n      {children({\r\n        openMenu: e => {\r\n          setIsMenuOpen(true);\r\n          setMenuPositon({\r\n            x: e.pageX,\r\n            y: e.pageY,\r\n          });\r\n        },\r\n      })}\r\n\r\n      {isMenuOpen && (\r\n        <ContextMenu\r\n          onClose={() => setIsMenuOpen(false)}\r\n          x={menuPosition.x}\r\n          y={menuPosition.y}\r\n          items={getContextMenuItems()}\r\n        />\r\n      )}\r\n    </>\r\n  );\r\n};\r\n","import React, { Component } from 'react';\r\nimport isNil from 'lodash/isNil';\r\nimport classNames from 'classnames';\r\nimport Scrollbars from 'react-custom-scrollbars';\r\nimport { cx, css } from 'emotion';\r\n\r\ninterface Props {\r\n  className?: string;\r\n  autoHide?: boolean;\r\n  autoHideTimeout?: number;\r\n  autoHideDuration?: number;\r\n  autoHeightMax?: string;\r\n  hideTracksWhenNotNeeded?: boolean;\r\n  hideHorizontalTrack?: boolean;\r\n  hideVerticalTrack?: boolean;\r\n  scrollTop?: number;\r\n  setScrollTop: (event: any) => void;\r\n  autoHeightMin?: number | string;\r\n  updateAfterMountMs?: number;\r\n}\r\n\r\n/**\r\n * Wraps component into <Scrollbars> component from `react-custom-scrollbars`\r\n */\r\nexport class CustomScrollbar extends Component<Props> {\r\n  static defaultProps: Partial<Props> = {\r\n    autoHide: false,\r\n    autoHideTimeout: 200,\r\n    autoHideDuration: 200,\r\n    setScrollTop: () => {},\r\n    hideTracksWhenNotNeeded: false,\r\n    autoHeightMin: '0',\r\n    autoHeightMax: '100%',\r\n  };\r\n\r\n  private ref: React.RefObject<Scrollbars>;\r\n\r\n  constructor(props: Props) {\r\n    super(props);\r\n    this.ref = React.createRef<Scrollbars>();\r\n  }\r\n\r\n  updateScroll() {\r\n    const ref = this.ref.current;\r\n    const { scrollTop } = this.props;\r\n\r\n    if (ref && !isNil(scrollTop)) {\r\n      ref.scrollTop(scrollTop);\r\n    }\r\n  }\r\n\r\n  componentDidMount() {\r\n    this.updateScroll();\r\n\r\n    // this logic is to make scrollbar visible when content is added body after mount\r\n    if (this.props.updateAfterMountMs) {\r\n      setTimeout(() => this.updateAfterMount(), this.props.updateAfterMountMs);\r\n    }\r\n  }\r\n\r\n  updateAfterMount() {\r\n    if (this.ref && this.ref.current) {\r\n      const scrollbar = this.ref.current as any;\r\n      if (scrollbar.update) {\r\n        scrollbar.update();\r\n      }\r\n    }\r\n  }\r\n\r\n  componentDidUpdate() {\r\n    this.updateScroll();\r\n  }\r\n\r\n  renderTrack = (track: 'track-vertical' | 'track-horizontal', hideTrack: boolean | undefined, passedProps: any) => {\r\n    return (\r\n      <div\r\n        {...passedProps}\r\n        className={cx(\r\n          css`\r\n            visibility: ${hideTrack ? 'hidden' : 'visible'};\r\n          `,\r\n          track\r\n        )}\r\n      />\r\n    );\r\n  };\r\n\r\n  renderThumb = (thumb: 'thumb-horizontal' | 'thumb-vertical', passedProps: any) => {\r\n    return <div {...passedProps} className={thumb} />;\r\n  };\r\n\r\n  renderTrackHorizontal = (passedProps: any) => {\r\n    return this.renderTrack('track-horizontal', this.props.hideHorizontalTrack, passedProps);\r\n  };\r\n\r\n  renderTrackVertical = (passedProps: any) => {\r\n    return this.renderTrack('track-vertical', this.props.hideVerticalTrack, passedProps);\r\n  };\r\n\r\n  renderThumbHorizontal = (passedProps: any) => {\r\n    return this.renderThumb('thumb-horizontal', passedProps);\r\n  };\r\n\r\n  renderThumbVertical = (passedProps: any) => {\r\n    return this.renderThumb('thumb-vertical', passedProps);\r\n  };\r\n\r\n  renderView = (passedProps: any) => {\r\n    return <div {...passedProps} className=\"view\" />;\r\n  };\r\n\r\n  render() {\r\n    const {\r\n      className,\r\n      children,\r\n      autoHeightMax,\r\n      autoHeightMin,\r\n      setScrollTop,\r\n      autoHide,\r\n      autoHideTimeout,\r\n      hideTracksWhenNotNeeded,\r\n    } = this.props;\r\n\r\n    return (\r\n      <Scrollbars\r\n        ref={this.ref}\r\n        className={classNames('custom-scrollbar', className)}\r\n        onScroll={setScrollTop}\r\n        autoHeight={true}\r\n        autoHide={autoHide}\r\n        autoHideTimeout={autoHideTimeout}\r\n        hideTracksWhenNotNeeded={hideTracksWhenNotNeeded}\r\n        // These autoHeightMin & autoHeightMax options affect firefox and chrome differently.\r\n        // Before these where set to inhert but that caused problems with cut of legends in firefox\r\n        autoHeightMax={autoHeightMax}\r\n        autoHeightMin={autoHeightMin}\r\n        renderTrackHorizontal={this.renderTrackHorizontal}\r\n        renderTrackVertical={this.renderTrackVertical}\r\n        renderThumbHorizontal={this.renderThumbHorizontal}\r\n        renderThumbVertical={this.renderThumbVertical}\r\n        renderView={this.renderView}\r\n      >\r\n        {children}\r\n      </Scrollbars>\r\n    );\r\n  }\r\n}\r\n\r\nexport default CustomScrollbar;\r\n","import React, { ChangeEvent, useContext } from 'react';\r\nimport { DataLink } from '@grafana/data';\r\nimport { FormField, Switch } from '../index';\r\nimport { VariableSuggestion } from './DataLinkSuggestions';\r\nimport { css } from 'emotion';\r\nimport { ThemeContext, stylesFactory } from '../../themes/index';\r\nimport { DataLinkInput } from './DataLinkInput';\r\nimport { GrafanaTheme } from '@grafana/data';\r\n\r\ninterface DataLinkEditorProps {\r\n  index: number;\r\n  isLast: boolean;\r\n  value: DataLink;\r\n  suggestions: VariableSuggestion[];\r\n  onChange: (index: number, link: DataLink, callback?: () => void) => void;\r\n  onRemove: (link: DataLink) => void;\r\n}\r\n\r\nconst getStyles = stylesFactory((theme: GrafanaTheme) => ({\r\n  listItem: css`\r\n    margin-bottom: ${theme.spacing.sm};\r\n  `,\r\n  infoText: css`\r\n    padding-bottom: ${theme.spacing.md};\r\n    margin-left: 66px;\r\n    color: ${theme.colors.textWeak};\r\n  `,\r\n}));\r\n\r\nexport const DataLinkEditor: React.FC<DataLinkEditorProps> = React.memo(\r\n  ({ index, value, onChange, onRemove, suggestions, isLast }) => {\r\n    const theme = useContext(ThemeContext);\r\n    const styles = getStyles(theme);\r\n\r\n    const onUrlChange = (url: string, callback?: () => void) => {\r\n      onChange(index, { ...value, url }, callback);\r\n    };\r\n    const onTitleChange = (event: ChangeEvent<HTMLInputElement>) => {\r\n      onChange(index, { ...value, title: event.target.value });\r\n    };\r\n\r\n    const onRemoveClick = () => {\r\n      onRemove(value);\r\n    };\r\n\r\n    const onOpenInNewTabChanged = () => {\r\n      onChange(index, { ...value, targetBlank: !value.targetBlank });\r\n    };\r\n\r\n    return (\r\n      <div className={styles.listItem}>\r\n        <div className=\"gf-form gf-form--inline\">\r\n          <FormField\r\n            className=\"gf-form--grow\"\r\n            label=\"Title\"\r\n            value={value.title}\r\n            onChange={onTitleChange}\r\n            inputWidth={0}\r\n            labelWidth={5}\r\n            placeholder=\"Show details\"\r\n          />\r\n          <Switch label=\"Open in new tab\" checked={value.targetBlank || false} onChange={onOpenInNewTabChanged} />\r\n          <button className=\"gf-form-label gf-form-label--btn\" onClick={onRemoveClick} title=\"Remove link\">\r\n            <i className=\"fa fa-times\" />\r\n          </button>\r\n        </div>\r\n        <FormField\r\n          label=\"URL\"\r\n          labelWidth={5}\r\n          inputEl={<DataLinkInput value={value.url} onChange={onUrlChange} suggestions={suggestions} />}\r\n          className={css`\r\n            width: 100%;\r\n          `}\r\n        />\r\n        {isLast && (\r\n          <div className={styles.infoText}>\r\n            With data links you can reference data variables like series name, labels and values. Type CMD+Space,\r\n            CTRL+Space, or $ to open variable suggestions.\r\n          </div>\r\n        )}\r\n      </div>\r\n    );\r\n  }\r\n);\r\n\r\nDataLinkEditor.displayName = 'DataLinkEditor';\r\n","import React, { useState, useMemo, useContext, useRef, RefObject, memo, useEffect } from 'react';\r\nimport usePrevious from 'react-use/lib/usePrevious';\r\nimport { VariableSuggestion, VariableOrigin, DataLinkSuggestions } from './DataLinkSuggestions';\r\nimport { ThemeContext, DataLinkBuiltInVars, makeValue } from '../../index';\r\nimport { SelectionReference } from './SelectionReference';\r\nimport { Portal } from '../index';\r\n\r\nimport { Editor } from '@grafana/slate-react';\r\nimport { Value } from 'slate';\r\nimport Plain from 'slate-plain-serializer';\r\nimport { Popper as ReactPopper } from 'react-popper';\r\nimport { css, cx } from 'emotion';\r\n\r\nimport { SlatePrism } from '../../slate-plugins';\r\nimport { SCHEMA } from '../../utils/slate';\r\nimport { stylesFactory } from '../../themes';\r\nimport { GrafanaTheme } from '@grafana/data';\r\n\r\nconst modulo = (a: number, n: number) => a - n * Math.floor(a / n);\r\n\r\ninterface DataLinkInputProps {\r\n  value: string;\r\n  onChange: (url: string, callback?: () => void) => void;\r\n  suggestions: VariableSuggestion[];\r\n  placeholder?: string;\r\n}\r\n\r\nconst plugins = [\r\n  SlatePrism({\r\n    onlyIn: (node: any) => node.type === 'code_block',\r\n    getSyntax: () => 'links',\r\n  }),\r\n];\r\n\r\nconst getStyles = stylesFactory((theme: GrafanaTheme) => ({\r\n  editor: css`\r\n    .token.builtInVariable {\r\n      color: ${theme.colors.queryGreen};\r\n    }\r\n    .token.variable {\r\n      color: ${theme.colors.queryKeyword};\r\n    }\r\n  `,\r\n}));\r\n\r\n// This memoised also because rerendering the slate editor grabs focus which created problem in some cases this\r\n// was used and changes to different state were propagated here.\r\nexport const DataLinkInput: React.FC<DataLinkInputProps> = memo(\r\n  ({ value, onChange, suggestions, placeholder = 'http://your-grafana.com/d/000000010/annotations' }) => {\r\n    const editorRef = useRef<Editor>() as RefObject<Editor>;\r\n    const theme = useContext(ThemeContext);\r\n    const styles = getStyles(theme);\r\n    const [showingSuggestions, setShowingSuggestions] = useState(false);\r\n    const [suggestionsIndex, setSuggestionsIndex] = useState(0);\r\n    const [linkUrl, setLinkUrl] = useState<Value>(makeValue(value));\r\n    const prevLinkUrl = usePrevious<Value>(linkUrl);\r\n\r\n    // Workaround for https://github.com/ianstormtaylor/slate/issues/2927\r\n    const stateRef = useRef({ showingSuggestions, suggestions, suggestionsIndex, linkUrl, onChange });\r\n    stateRef.current = { showingSuggestions, suggestions, suggestionsIndex, linkUrl, onChange };\r\n\r\n    // SelectionReference is used to position the variables suggestion relatively to current DOM selection\r\n    const selectionRef = useMemo(() => new SelectionReference(), [setShowingSuggestions, linkUrl]);\r\n\r\n    const onKeyDown = React.useCallback((event: KeyboardEvent, next: () => any) => {\r\n      if (!stateRef.current.showingSuggestions) {\r\n        if (event.key === '=' || event.key === '$' || (event.keyCode === 32 && event.ctrlKey)) {\r\n          return setShowingSuggestions(true);\r\n        }\r\n        return next();\r\n      }\r\n\r\n      switch (event.key) {\r\n        case 'Backspace':\r\n        case 'Escape':\r\n          setShowingSuggestions(false);\r\n          return setSuggestionsIndex(0);\r\n\r\n        case 'Enter':\r\n          event.preventDefault();\r\n          return onVariableSelect(stateRef.current.suggestions[stateRef.current.suggestionsIndex]);\r\n\r\n        case 'ArrowDown':\r\n        case 'ArrowUp':\r\n          event.preventDefault();\r\n          const direction = event.key === 'ArrowDown' ? 1 : -1;\r\n          return setSuggestionsIndex(index => modulo(index + direction, stateRef.current.suggestions.length));\r\n        default:\r\n          return next();\r\n      }\r\n    }, []);\r\n\r\n    useEffect(() => {\r\n      // Update the state of the link in the parent. This is basically done on blur but we need to do it after\r\n      // our state have been updated. The duplicity of state is done for perf reasons and also because local\r\n      // state also contains things like selection and formating.\r\n      if (prevLinkUrl && prevLinkUrl.selection.isFocused && !linkUrl.selection.isFocused) {\r\n        stateRef.current.onChange(Plain.serialize(linkUrl));\r\n      }\r\n    }, [linkUrl, prevLinkUrl]);\r\n\r\n    const onUrlChange = React.useCallback(({ value }: { value: Value }) => {\r\n      setLinkUrl(value);\r\n    }, []);\r\n\r\n    const onVariableSelect = (item: VariableSuggestion, editor = editorRef.current!) => {\r\n      const includeDollarSign = Plain.serialize(editor.value).slice(-1) !== '$';\r\n      if (item.origin !== VariableOrigin.Template || item.value === DataLinkBuiltInVars.includeVars) {\r\n        editor.insertText(`${includeDollarSign ? '$' : ''}\\{${item.value}}`);\r\n      } else {\r\n        editor.insertText(`var-${item.value}=$\\{${item.value}}`);\r\n      }\r\n\r\n      setLinkUrl(editor.value);\r\n      setShowingSuggestions(false);\r\n\r\n      setSuggestionsIndex(0);\r\n      stateRef.current.onChange(Plain.serialize(editor.value));\r\n    };\r\n\r\n    return (\r\n      <div\r\n        className={cx(\r\n          'gf-form-input',\r\n          css`\r\n            position: relative;\r\n            height: auto;\r\n          `\r\n        )}\r\n      >\r\n        <div className=\"slate-query-field\">\r\n          {showingSuggestions && (\r\n            <Portal>\r\n              <ReactPopper\r\n                referenceElement={selectionRef}\r\n                placement=\"top-end\"\r\n                modifiers={{\r\n                  preventOverflow: { enabled: true, boundariesElement: 'window' },\r\n                  arrow: { enabled: false },\r\n                  offset: { offset: 250 }, // width of the suggestions menu\r\n                }}\r\n              >\r\n                {({ ref, style, placement }) => {\r\n                  return (\r\n                    <div ref={ref} style={style} data-placement={placement}>\r\n                      <DataLinkSuggestions\r\n                        suggestions={stateRef.current.suggestions}\r\n                        onSuggestionSelect={onVariableSelect}\r\n                        onClose={() => setShowingSuggestions(false)}\r\n                        activeIndex={suggestionsIndex}\r\n                      />\r\n                    </div>\r\n                  );\r\n                }}\r\n              </ReactPopper>\r\n            </Portal>\r\n          )}\r\n          <Editor\r\n            schema={SCHEMA}\r\n            ref={editorRef}\r\n            placeholder={placeholder}\r\n            value={stateRef.current.linkUrl}\r\n            onChange={onUrlChange}\r\n            onKeyDown={(event, _editor, next) => onKeyDown(event as KeyboardEvent, next)}\r\n            plugins={plugins}\r\n            className={styles.editor}\r\n          />\r\n        </div>\r\n      </div>\r\n    );\r\n  }\r\n);\r\n\r\nDataLinkInput.displayName = 'DataLinkInput';\r\n","import { selectThemeVariant, ThemeContext } from '../../index';\r\nimport { GrafanaTheme } from '@grafana/data';\r\nimport { css, cx } from 'emotion';\r\nimport _ from 'lodash';\r\nimport React, { useRef, useContext, useMemo } from 'react';\r\nimport useClickAway from 'react-use/lib/useClickAway';\r\nimport { List } from '../index';\r\nimport tinycolor from 'tinycolor2';\r\nimport { stylesFactory } from '../../themes';\r\n\r\nexport enum VariableOrigin {\r\n  Series = 'series',\r\n  Field = 'field',\r\n  Fields = 'fields',\r\n  Value = 'value',\r\n  BuiltIn = 'built-in',\r\n  Template = 'template',\r\n}\r\n\r\nexport interface VariableSuggestion {\r\n  value: string;\r\n  label: string;\r\n  documentation?: string;\r\n  origin: VariableOrigin;\r\n}\r\n\r\ninterface DataLinkSuggestionsProps {\r\n  suggestions: VariableSuggestion[];\r\n  activeIndex: number;\r\n  onSuggestionSelect: (suggestion: VariableSuggestion) => void;\r\n  onClose?: () => void;\r\n}\r\n\r\nconst getStyles = stylesFactory((theme: GrafanaTheme) => {\r\n  const wrapperBg = selectThemeVariant(\r\n    {\r\n      light: theme.colors.white,\r\n      dark: theme.colors.dark2,\r\n    },\r\n    theme.type\r\n  );\r\n\r\n  const wrapperShadow = selectThemeVariant(\r\n    {\r\n      light: theme.colors.gray5,\r\n      dark: theme.colors.black,\r\n    },\r\n    theme.type\r\n  );\r\n\r\n  const itemColor = selectThemeVariant(\r\n    {\r\n      light: theme.colors.black,\r\n      dark: theme.colors.white,\r\n    },\r\n    theme.type\r\n  );\r\n\r\n  const itemDocsColor = selectThemeVariant(\r\n    {\r\n      light: theme.colors.dark3,\r\n      dark: theme.colors.gray2,\r\n    },\r\n    theme.type\r\n  );\r\n\r\n  const itemBgHover = selectThemeVariant(\r\n    {\r\n      light: theme.colors.gray5,\r\n      dark: theme.colors.dark7,\r\n    },\r\n    theme.type\r\n  );\r\n\r\n  const itemBgActive = selectThemeVariant(\r\n    {\r\n      light: theme.colors.gray6,\r\n      dark: theme.colors.dark9,\r\n    },\r\n    theme.type\r\n  );\r\n\r\n  const separatorColor = selectThemeVariant(\r\n    {\r\n      light: tinycolor(wrapperBg.toString())\r\n        .darken(10)\r\n        .toString(),\r\n      dark: tinycolor(wrapperBg.toString())\r\n        .lighten(10)\r\n        .toString(),\r\n    },\r\n    theme.type\r\n  );\r\n\r\n  return {\r\n    list: css`\r\n      border-bottom: 1px solid ${separatorColor};\r\n      &:last-child {\r\n        border: none;\r\n      }\r\n    `,\r\n    wrapper: css`\r\n      background: ${wrapperBg};\r\n      z-index: 1;\r\n      width: 250px;\r\n      box-shadow: 0 5px 10px 0 ${wrapperShadow};\r\n    `,\r\n    item: css`\r\n      background: none;\r\n      padding: 2px 8px;\r\n      color: ${itemColor};\r\n      cursor: pointer;\r\n      &:hover {\r\n        background: ${itemBgHover};\r\n      }\r\n    `,\r\n    label: css`\r\n      color: ${theme.colors.textWeak};\r\n    `,\r\n    activeItem: css`\r\n      background: ${itemBgActive};\r\n      &:hover {\r\n        background: ${itemBgActive};\r\n      }\r\n    `,\r\n    itemValue: css`\r\n      font-family: ${theme.typography.fontFamily.monospace};\r\n      font-size: ${theme.typography.size.sm};\r\n    `,\r\n    itemDocs: css`\r\n      margin-top: ${theme.spacing.xs};\r\n      color: ${itemDocsColor};\r\n    `,\r\n  };\r\n});\r\n\r\nexport const DataLinkSuggestions: React.FC<DataLinkSuggestionsProps> = ({ suggestions, ...otherProps }) => {\r\n  const ref = useRef(null);\r\n  const theme = useContext(ThemeContext);\r\n  useClickAway(ref, () => {\r\n    if (otherProps.onClose) {\r\n      otherProps.onClose();\r\n    }\r\n  });\r\n\r\n  const groupedSuggestions = useMemo(() => {\r\n    return _.groupBy(suggestions, s => s.origin);\r\n  }, [suggestions]);\r\n\r\n  const styles = getStyles(theme);\r\n  return (\r\n    <div ref={ref} className={styles.wrapper}>\r\n      {Object.keys(groupedSuggestions).map((key, i) => {\r\n        const indexOffset =\r\n          i === 0\r\n            ? 0\r\n            : Object.keys(groupedSuggestions).reduce((acc, current, index) => {\r\n                if (index >= i) {\r\n                  return acc;\r\n                }\r\n                return acc + groupedSuggestions[current].length;\r\n              }, 0);\r\n\r\n        return (\r\n          <DataLinkSuggestionsList\r\n            {...otherProps}\r\n            suggestions={groupedSuggestions[key]}\r\n            label={`${_.capitalize(key)}`}\r\n            activeIndex={otherProps.activeIndex}\r\n            activeIndexOffset={indexOffset}\r\n            key={key}\r\n          />\r\n        );\r\n      })}\r\n    </div>\r\n  );\r\n};\r\n\r\nDataLinkSuggestions.displayName = 'DataLinkSuggestions';\r\n\r\ninterface DataLinkSuggestionsListProps extends DataLinkSuggestionsProps {\r\n  label: string;\r\n  activeIndexOffset: number;\r\n}\r\n\r\nconst DataLinkSuggestionsList: React.FC<DataLinkSuggestionsListProps> = React.memo(\r\n  ({ activeIndex, activeIndexOffset, label, onClose, onSuggestionSelect, suggestions }) => {\r\n    const theme = useContext(ThemeContext);\r\n    const styles = getStyles(theme);\r\n\r\n    return (\r\n      <>\r\n        <List\r\n          className={styles.list}\r\n          items={suggestions}\r\n          renderItem={(item, index) => {\r\n            return (\r\n              <div\r\n                className={cx(styles.item, index + activeIndexOffset === activeIndex && styles.activeItem)}\r\n                onClick={() => {\r\n                  onSuggestionSelect(item);\r\n                }}\r\n                title={item.documentation}\r\n              >\r\n                <span className={styles.itemValue}>\r\n                  <span className={styles.label}>{label}</span> {item.label}\r\n                </span>\r\n              </div>\r\n            );\r\n          }}\r\n        />\r\n      </>\r\n    );\r\n  }\r\n);\r\n\r\nDataLinkSuggestionsList.displayName = 'DataLinkSuggestionsList';\r\n","import React from 'react';\r\nimport { WithContextMenu } from '../ContextMenu/WithContextMenu';\r\nimport { LinkModelSupplier } from '@grafana/data';\r\nimport { linkModelToContextMenuItems } from '../../utils/dataLinks';\r\nimport { css } from 'emotion';\r\n\r\ninterface DataLinksContextMenuProps {\r\n  children: (props: { openMenu?: React.MouseEventHandler<HTMLElement>; targetClassName?: string }) => JSX.Element;\r\n  links?: LinkModelSupplier<any>;\r\n}\r\n\r\nexport const DataLinksContextMenu: React.FC<DataLinksContextMenuProps> = ({ children, links }) => {\r\n  if (!links) {\r\n    return children({});\r\n  }\r\n\r\n  const getDataLinksContextMenuItems = () => {\r\n    return [{ items: linkModelToContextMenuItems(links), label: 'Data links' }];\r\n  };\r\n\r\n  // Use this class name (exposed via render prop) to add context menu indicator to the click target of the visualization\r\n  const targetClassName = css`\r\n    cursor: context-menu;\r\n  `;\r\n\r\n  return (\r\n    <WithContextMenu getContextMenuItems={getDataLinksContextMenuItems}>\r\n      {({ openMenu }) => {\r\n        return children({ openMenu, targetClassName });\r\n      }}\r\n    </WithContextMenu>\r\n  );\r\n};\r\n","// Libraries\r\nimport React, { FC } from 'react';\r\n// @ts-ignore\r\nimport Prism from 'prismjs';\r\n// Components\r\nimport { css } from 'emotion';\r\nimport { DataLink } from '@grafana/data';\r\nimport { Button } from '../index';\r\nimport { DataLinkEditor } from './DataLinkEditor';\r\nimport { VariableSuggestion } from './DataLinkSuggestions';\r\nimport { useTheme } from '../../themes/ThemeContext';\r\n\r\ninterface DataLinksEditorProps {\r\n  value: DataLink[];\r\n  onChange: (links: DataLink[], callback?: () => void) => void;\r\n  suggestions: VariableSuggestion[];\r\n  maxLinks?: number;\r\n}\r\n\r\nexport const enableDatalinksPrismSyntax = () => {\r\n  Prism.languages['links'] = {\r\n    builtInVariable: {\r\n      pattern: /(\\${\\S+?})/,\r\n    },\r\n  };\r\n};\r\n\r\nexport const DataLinksEditor: FC<DataLinksEditorProps> = React.memo(({ value, onChange, suggestions, maxLinks }) => {\r\n  const theme = useTheme();\r\n  enableDatalinksPrismSyntax();\r\n\r\n  const onAdd = () => {\r\n    onChange(value ? [...value, { url: '', title: '' }] : [{ url: '', title: '' }]);\r\n  };\r\n\r\n  const onLinkChanged = (linkIndex: number, newLink: DataLink, callback?: () => void) => {\r\n    onChange(\r\n      value.map((item, listIndex) => {\r\n        if (linkIndex === listIndex) {\r\n          return newLink;\r\n        }\r\n        return item;\r\n      }),\r\n      callback\r\n    );\r\n  };\r\n\r\n  const onRemove = (link: DataLink) => {\r\n    onChange(value.filter(item => item !== link));\r\n  };\r\n\r\n  return (\r\n    <>\r\n      {value && value.length > 0 && (\r\n        <div\r\n          className={css`\r\n            margin-bottom: ${theme.spacing.sm};\r\n          `}\r\n        >\r\n          {value.map((link, index) => (\r\n            <DataLinkEditor\r\n              key={index.toString()}\r\n              index={index}\r\n              isLast={index === value.length - 1}\r\n              value={link}\r\n              onChange={onLinkChanged}\r\n              onRemove={onRemove}\r\n              suggestions={suggestions}\r\n            />\r\n          ))}\r\n        </div>\r\n      )}\r\n\r\n      {(!value || (value && value.length < (maxLinks || Infinity))) && (\r\n        <Button variant=\"inverse\" icon=\"fa fa-plus\" onClick={() => onAdd()}>\r\n          Add link\r\n        </Button>\r\n      )}\r\n    </>\r\n  );\r\n});\r\n\r\nDataLinksEditor.displayName = 'DataLinksEditor';\r\n","export class SelectionReference {\n  getBoundingClientRect() {\n    const selection = window.getSelection();\n    const node = selection && selection.anchorNode;\n\n    if (node && node.parentElement) {\n      const rect = node.parentElement.getBoundingClientRect();\n      return rect;\n    }\n\n    return {\n      top: 0,\n      left: 0,\n      bottom: 0,\n      right: 0,\n      width: 0,\n      height: 0,\n    };\n  }\n\n  get clientWidth() {\n    return this.getBoundingClientRect().width;\n  }\n\n  get clientHeight() {\n    return this.getBoundingClientRect().height;\n  }\n}\n","import React from 'react';\r\nimport { HttpSettingsProps } from './types';\r\nimport { FormField } from '../FormField/FormField';\r\nimport { SecretFormField } from '../SecretFormFied/SecretFormField';\r\n\r\nexport const BasicAuthSettings: React.FC<HttpSettingsProps> = ({ dataSourceConfig, onChange }) => {\r\n  const password = dataSourceConfig.secureJsonData ? dataSourceConfig.secureJsonData.basicAuthPassword : '';\r\n\r\n  const onPasswordReset = () => {\r\n    onChange({\r\n      ...dataSourceConfig,\r\n      basicAuthPassword: '',\r\n      secureJsonData: {\r\n        ...dataSourceConfig.secureJsonData,\r\n        basicAuthPassword: '',\r\n      },\r\n      secureJsonFields: {\r\n        ...dataSourceConfig.secureJsonFields,\r\n        basicAuthPassword: false,\r\n      },\r\n    });\r\n  };\r\n\r\n  const onPasswordChange = (event: React.SyntheticEvent<HTMLInputElement>) => {\r\n    onChange({\r\n      ...dataSourceConfig,\r\n      secureJsonData: {\r\n        ...dataSourceConfig.secureJsonData,\r\n        basicAuthPassword: event.currentTarget.value,\r\n      },\r\n    });\r\n  };\r\n\r\n  return (\r\n    <>\r\n      <div className=\"gf-form\">\r\n        <FormField\r\n          label=\"User\"\r\n          labelWidth={10}\r\n          inputWidth={18}\r\n          placeholder=\"user\"\r\n          value={dataSourceConfig.basicAuthUser}\r\n          onChange={event => onChange({ ...dataSourceConfig, basicAuthUser: event.currentTarget.value })}\r\n        />\r\n      </div>\r\n      <div className=\"gf-form\">\r\n        <SecretFormField\r\n          isConfigured={\r\n            !!dataSourceConfig.basicAuthPassword ||\r\n            !!(dataSourceConfig.secureJsonFields && dataSourceConfig.secureJsonFields.basicAuthPassword)\r\n          }\r\n          value={password || ''}\r\n          inputWidth={18}\r\n          labelWidth={10}\r\n          onReset={onPasswordReset}\r\n          onChange={onPasswordChange}\r\n        />\r\n      </div>\r\n    </>\r\n  );\r\n};\r\n","import React, { ChangeEvent, MouseEvent, FC } from 'react';\r\n\r\ninterface Props {\r\n  label: string;\r\n  hasCert: boolean;\r\n  placeholder: string;\r\n\r\n  onChange: (event: ChangeEvent<HTMLTextAreaElement>) => void;\r\n  onClick: (event: MouseEvent<HTMLAnchorElement>) => void;\r\n}\r\n\r\nexport const CertificationKey: FC<Props> = ({ hasCert, label, onChange, onClick, placeholder }) => {\r\n  return (\r\n    <div className=\"gf-form-inline\">\r\n      <div className=\"gf-form gf-form--v-stretch\">\r\n        <label className=\"gf-form-label width-7\">{label}</label>\r\n      </div>\r\n      {!hasCert && (\r\n        <div className=\"gf-form gf-form--grow\">\r\n          <textarea\r\n            rows={7}\r\n            className=\"gf-form-input gf-form-textarea\"\r\n            onChange={onChange}\r\n            placeholder={placeholder}\r\n            required\r\n          />\r\n        </div>\r\n      )}\r\n\r\n      {hasCert && (\r\n        <div className=\"gf-form\">\r\n          <input type=\"text\" className=\"gf-form-input max-width-12\" disabled value=\"configured\" />\r\n          <a className=\"btn btn-secondary gf-form-btn\" onClick={onClick}>\r\n            reset\r\n          </a>\r\n        </div>\r\n      )}\r\n    </div>\r\n  );\r\n};\r\n","import React, { useState, useCallback } from 'react';\r\nimport { SelectableValue } from '@grafana/data';\r\nimport { css, cx } from 'emotion';\r\nimport { useTheme } from '../../themes';\r\nimport { BasicAuthSettings } from './BasicAuthSettings';\r\nimport { HttpProxySettings } from './HttpProxySettings';\r\nimport { TLSAuthSettings } from './TLSAuthSettings';\r\nimport { DataSourceSettings } from '@grafana/data';\r\nimport { HttpSettingsProps } from './types';\r\nimport { Select } from '../Select/Select';\r\nimport { Input } from '../Input/Input';\r\nimport { FormField } from '../FormField/FormField';\r\nimport { FormLabel } from '../FormLabel/FormLabel';\r\nimport { Switch } from '../Switch/Switch';\r\nimport { TagsInput } from '../TagsInput/TagsInput';\r\n\r\nconst ACCESS_OPTIONS: Array<SelectableValue<string>> = [\r\n  {\r\n    label: 'Server (default)',\r\n    value: 'proxy',\r\n  },\r\n  {\r\n    label: 'Browser',\r\n    value: 'direct',\r\n  },\r\n];\r\n\r\nconst DEFAULT_ACCESS_OPTION = {\r\n  label: 'Server (default)',\r\n  value: 'proxy',\r\n};\r\n\r\nconst HttpAccessHelp = () => (\r\n  <div className=\"grafana-info-box m-t-2\">\r\n    <p>\r\n      Access mode controls how requests to the data source will be handled.\r\n      <strong>\r\n        <i>Server</i>\r\n      </strong>{' '}\r\n      should be the preferred way if nothing else stated.\r\n    </p>\r\n    <div className=\"alert-title\">Server access mode (Default):</div>\r\n    <p>\r\n      All requests will be made from the browser to Grafana backend/server which in turn will forward the requests to\r\n      the data source and by that circumvent possible Cross-Origin Resource Sharing (CORS) requirements. The URL needs\r\n      to be accessible from the grafana backend/server if you select this access mode.\r\n    </p>\r\n    <div className=\"alert-title\">Browser access mode:</div>\r\n    <p>\r\n      All requests will be made from the browser directly to the data source and may be subject to Cross-Origin Resource\r\n      Sharing (CORS) requirements. The URL needs to be accessible from the browser if you select this access mode.\r\n    </p>\r\n  </div>\r\n);\r\n\r\nexport const DataSourceHttpSettings: React.FC<HttpSettingsProps> = props => {\r\n  const { defaultUrl, dataSourceConfig, onChange, showAccessOptions } = props;\r\n  let urlTooltip;\r\n  const [isAccessHelpVisible, setIsAccessHelpVisible] = useState(false);\r\n  const theme = useTheme();\r\n\r\n  const onSettingsChange = useCallback(\r\n    (change: Partial<DataSourceSettings<any, any>>) => {\r\n      onChange({\r\n        ...dataSourceConfig,\r\n        ...change,\r\n      });\r\n    },\r\n    [dataSourceConfig]\r\n  );\r\n\r\n  switch (dataSourceConfig.access) {\r\n    case 'direct':\r\n      urlTooltip = (\r\n        <>\r\n          Your access method is <em>Browser</em>, this means the URL needs to be accessible from the browser.\r\n        </>\r\n      );\r\n      break;\r\n    case 'proxy':\r\n      urlTooltip = (\r\n        <>\r\n          Your access method is <em>Server</em>, this means the URL needs to be accessible from the grafana\r\n          backend/server.\r\n        </>\r\n      );\r\n      break;\r\n    default:\r\n      urlTooltip = 'Specify a complete HTTP URL (for example http://your_server:8080)';\r\n  }\r\n\r\n  const accessSelect = (\r\n    <Select\r\n      width={20}\r\n      options={ACCESS_OPTIONS}\r\n      value={ACCESS_OPTIONS.filter(o => o.value === dataSourceConfig.access)[0] || DEFAULT_ACCESS_OPTION}\r\n      onChange={selectedValue => onSettingsChange({ access: selectedValue.value })}\r\n    />\r\n  );\r\n\r\n  const isValidUrl = /^(ftp|http|https):\\/\\/(\\w+:{0,1}\\w*@)?(\\S+)(:[0-9]+)?(\\/|\\/([\\w#!:.?+=&%@!\\-\\/]))?$/.test(\r\n    dataSourceConfig.url\r\n  );\r\n\r\n  const notValidStyle = css`\r\n    box-shadow: inset 0 0px 5px ${theme.colors.red};\r\n  `;\r\n\r\n  const inputStyle = cx({ [`width-20`]: true, [notValidStyle]: !isValidUrl });\r\n\r\n  const urlInput = (\r\n    <Input\r\n      className={inputStyle}\r\n      placeholder={defaultUrl}\r\n      value={dataSourceConfig.url}\r\n      onChange={event => onSettingsChange({ url: event.currentTarget.value })}\r\n    />\r\n  );\r\n\r\n  return (\r\n    <div className=\"gf-form-group\">\r\n      <>\r\n        <h3 className=\"page-heading\">HTTP</h3>\r\n        <div className=\"gf-form-group\">\r\n          <div className=\"gf-form\">\r\n            <FormField label=\"URL\" labelWidth={11} tooltip={urlTooltip} inputEl={urlInput} />\r\n          </div>\r\n\r\n          {showAccessOptions && (\r\n            <>\r\n              <div className=\"gf-form-inline\">\r\n                <div className=\"gf-form\">\r\n                  <FormField label=\"Access\" labelWidth={11} inputWidth={20} inputEl={accessSelect} />\r\n                </div>\r\n                <div className=\"gf-form\">\r\n                  <label\r\n                    className=\"gf-form-label query-keyword pointer\"\r\n                    onClick={() => setIsAccessHelpVisible(isVisible => !isVisible)}\r\n                  >\r\n                    Help&nbsp;\r\n                    <i className={`fa fa-caret-${isAccessHelpVisible ? 'down' : 'right'}`} />\r\n                  </label>\r\n                </div>\r\n              </div>\r\n              {isAccessHelpVisible && <HttpAccessHelp />}\r\n            </>\r\n          )}\r\n          {dataSourceConfig.access === 'proxy' && (\r\n            <div className=\"gf-form\">\r\n              <FormLabel\r\n                width={11}\r\n                tooltip=\"Grafana Proxy deletes forwarded cookies by default. Specify cookies by name that should be forwarded to the data source.\"\r\n              >\r\n                Whitelisted Cookies\r\n              </FormLabel>\r\n              <TagsInput\r\n                tags={dataSourceConfig.jsonData.keepCookies}\r\n                onChange={cookies =>\r\n                  onSettingsChange({ jsonData: { ...dataSourceConfig.jsonData, keepCookies: cookies } })\r\n                }\r\n                width={20}\r\n              />\r\n            </div>\r\n          )}\r\n        </div>\r\n      </>\r\n\r\n      <>\r\n        <h3 className=\"page-heading\">Auth</h3>\r\n        <div className=\"gf-form-group\">\r\n          <div className=\"gf-form-inline\">\r\n            <Switch\r\n              label=\"Basic auth\"\r\n              labelClass=\"width-13\"\r\n              checked={dataSourceConfig.basicAuth}\r\n              onChange={event => {\r\n                onSettingsChange({ basicAuth: event!.currentTarget.checked });\r\n              }}\r\n            />\r\n            <Switch\r\n              label=\"With Credentials\"\r\n              labelClass=\"width-13\"\r\n              checked={dataSourceConfig.withCredentials}\r\n              onChange={event => {\r\n                onSettingsChange({ withCredentials: event!.currentTarget.checked });\r\n              }}\r\n              tooltip=\"Whether credentials such as cookies or auth headers should be sent with cross-site requests.\"\r\n            />\r\n          </div>\r\n\r\n          {dataSourceConfig.access === 'proxy' && (\r\n            <HttpProxySettings\r\n              dataSourceConfig={dataSourceConfig}\r\n              onChange={jsonData => onSettingsChange({ jsonData })}\r\n            />\r\n          )}\r\n        </div>\r\n        {dataSourceConfig.basicAuth && (\r\n          <>\r\n            <h6>Basic Auth Details</h6>\r\n            <div className=\"gf-form-group\">\r\n              <BasicAuthSettings {...props} />\r\n            </div>\r\n          </>\r\n        )}\r\n\r\n        {(dataSourceConfig.jsonData.tlsAuth || dataSourceConfig.jsonData.tlsAuthWithCACert) && (\r\n          <TLSAuthSettings dataSourceConfig={dataSourceConfig} onChange={onChange} />\r\n        )}\r\n      </>\r\n    </div>\r\n  );\r\n};\r\n","import React from 'react';\r\nimport { HttpSettingsBaseProps } from './types';\r\nimport { Switch } from '../Switch/Switch';\r\n\r\nexport const HttpProxySettings: React.FC<HttpSettingsBaseProps> = ({ dataSourceConfig, onChange }) => {\r\n  return (\r\n    <>\r\n      <div className=\"gf-form-inline\">\r\n        <Switch\r\n          label=\"TLS Client Auth\"\r\n          labelClass=\"width-13\"\r\n          checked={dataSourceConfig.jsonData.tlsAuth || false}\r\n          onChange={event => onChange({ ...dataSourceConfig.jsonData, tlsAuth: event!.currentTarget.checked })}\r\n        />\r\n\r\n        <Switch\r\n          label=\"With CA Cert\"\r\n          labelClass=\"width-13\"\r\n          checked={dataSourceConfig.jsonData.tlsAuthWithCACert || false}\r\n          onChange={event =>\r\n            onChange({ ...dataSourceConfig.jsonData, tlsAuthWithCACert: event!.currentTarget.checked })\r\n          }\r\n          tooltip=\"Needed for verifying self-signed TLS Certs\"\r\n        />\r\n      </div>\r\n      <div className=\"gf-form-inline\">\r\n        <Switch\r\n          label=\"Skip TLS Verify\"\r\n          labelClass=\"width-13\"\r\n          checked={dataSourceConfig.jsonData.tlsSkipVerify || false}\r\n          onChange={event => onChange({ ...dataSourceConfig.jsonData, tlsSkipVerify: event!.currentTarget.checked })}\r\n        />\r\n      </div>\r\n      <div className=\"gf-form-inline\">\r\n        <Switch\r\n          label=\"Forward OAuth Identity\"\r\n          labelClass=\"width-13\"\r\n          checked={dataSourceConfig.jsonData.oauthPassThru || false}\r\n          onChange={event => onChange({ ...dataSourceConfig.jsonData, oauthPassThru: event!.currentTarget.checked })}\r\n          tooltip=\"Forward the user's upstream OAuth identity to the data source (Their access token gets passed along).\"\r\n        />\r\n      </div>\r\n    </>\r\n  );\r\n};\r\n","import React from 'react';\r\nimport { KeyValue } from '@grafana/data';\r\nimport { css, cx } from 'emotion';\r\nimport { Tooltip } from '../Tooltip/Tooltip';\r\nimport { CertificationKey } from './CertificationKey';\r\nimport { HttpSettingsBaseProps } from './types';\r\n\r\nexport const TLSAuthSettings: React.FC<HttpSettingsBaseProps> = ({ dataSourceConfig, onChange }) => {\r\n  const hasTLSCACert = dataSourceConfig.secureJsonFields && dataSourceConfig.secureJsonFields.tlsCACert;\r\n  const hasTLSClientCert = dataSourceConfig.secureJsonFields && dataSourceConfig.secureJsonFields.tlsClientCert;\r\n  const hasTLSClientKey = dataSourceConfig.secureJsonFields && dataSourceConfig.secureJsonFields.tlsClientKey;\r\n\r\n  const onResetClickFactory = (field: string) => (event: React.MouseEvent<HTMLAnchorElement>) => {\r\n    event.preventDefault();\r\n    const newSecureJsonFields: KeyValue<boolean> = { ...dataSourceConfig.secureJsonFields };\r\n    newSecureJsonFields[field] = false;\r\n    onChange({\r\n      ...dataSourceConfig,\r\n      secureJsonFields: newSecureJsonFields,\r\n    });\r\n  };\r\n\r\n  const onCertificateChangeFactory = (field: string) => (event: React.SyntheticEvent<HTMLTextAreaElement>) => {\r\n    const newSecureJsonData = { ...dataSourceConfig.secureJsonData };\r\n    newSecureJsonData[field] = event.currentTarget.value;\r\n\r\n    onChange({\r\n      ...dataSourceConfig,\r\n      secureJsonData: newSecureJsonData,\r\n    });\r\n  };\r\n\r\n  return (\r\n    <div className=\"gf-form-group\">\r\n      <div\r\n        className={cx(\r\n          'gf-form',\r\n          css`\r\n            align-items: baseline;\r\n          `\r\n        )}\r\n      >\r\n        <h6>TLS Auth Details</h6>\r\n        <Tooltip\r\n          placement=\"right-end\"\r\n          content=\"TLS Certs are encrypted and stored in the Grafana database.\"\r\n          theme=\"info\"\r\n        >\r\n          <div className=\"gf-form-help-icon gf-form-help-icon--right-normal\">\r\n            <i className=\"fa fa-info-circle\" />\r\n          </div>\r\n        </Tooltip>\r\n      </div>\r\n      <div>\r\n        {dataSourceConfig.jsonData.tlsAuthWithCACert && (\r\n          <CertificationKey\r\n            hasCert={!!hasTLSCACert}\r\n            onChange={onCertificateChangeFactory('tlsCACert')}\r\n            placeholder=\"Begins with -----BEGIN CERTIFICATE-----\"\r\n            label=\"CA Cert\"\r\n            onClick={onResetClickFactory('tlsCACert')}\r\n          />\r\n        )}\r\n\r\n        {dataSourceConfig.jsonData.tlsAuth && (\r\n          <>\r\n            <CertificationKey\r\n              hasCert={!!hasTLSClientCert}\r\n              label=\"Client Cert\"\r\n              onChange={onCertificateChangeFactory('tlsClientCert')}\r\n              placeholder=\"Begins with -----BEGIN CERTIFICATE-----\"\r\n              onClick={onResetClickFactory('tlsClientCert')}\r\n            />\r\n\r\n            <CertificationKey\r\n              hasCert={!!hasTLSClientKey}\r\n              label=\"Client Key\"\r\n              placeholder=\"Begins with -----BEGIN RSA PRIVATE KEY-----\"\r\n              onChange={onCertificateChangeFactory('tlsClientKey')}\r\n              onClick={onResetClickFactory('tlsClientKey')}\r\n            />\r\n          </>\r\n        )}\r\n      </div>\r\n    </div>\r\n  );\r\n};\r\n","import React, { CSSProperties, FC, ReactNode } from 'react';\r\nimport { GrafanaTheme } from '@grafana/data';\r\nimport RcDrawer from 'rc-drawer';\r\nimport { css } from 'emotion';\r\nimport { stylesFactory, useTheme, selectThemeVariant } from '../../themes';\r\n\r\nexport interface Props {\r\n  children: ReactNode;\r\n  /** Title shown at the top of the drawer */\r\n  title?: string;\r\n  /** Should the Drawer be closable by clicking on the mask */\r\n  closeOnMaskClick?: boolean;\r\n  /** Render the drawer inside a container on the page */\r\n  inline?: boolean;\r\n  /** Either a number in px or a string with unit postfix */\r\n  width?: number | string;\r\n\r\n  onClose: () => void;\r\n}\r\n\r\nconst getStyles = stylesFactory((theme: GrafanaTheme) => {\r\n  const closeButtonWidth = '50px';\r\n  const borderColor = selectThemeVariant(\r\n    {\r\n      light: theme.colors.gray4,\r\n      dark: theme.colors.dark9,\r\n    },\r\n    theme.type\r\n  );\r\n  return {\r\n    drawer: css`\r\n      .drawer-content {\r\n        background-color: ${theme.colors.bodyBg};\r\n      }\r\n    `,\r\n    titleWrapper: css`\r\n      font-size: ${theme.typography.size.lg};\r\n      display: flex;\r\n      align-items: center;\r\n      justify-content: space-between;\r\n      border-bottom: 1px solid ${borderColor};\r\n      padding: ${theme.spacing.sm} 0 ${theme.spacing.sm} ${theme.spacing.md};\r\n      background-color: ${theme.colors.bodyBg};\r\n      position: sticky;\r\n      top: 0;\r\n    `,\r\n    close: css`\r\n      cursor: pointer;\r\n      width: ${closeButtonWidth};\r\n      height: 100%;\r\n      display: flex;\r\n      flex-shrink: 0;\r\n      justify-content: center;\r\n    `,\r\n    content: css`\r\n      padding: ${theme.spacing.md};\r\n      height: 100%;\r\n    `,\r\n  };\r\n});\r\n\r\nexport const Drawer: FC<Props> = ({\r\n  children,\r\n  inline = false,\r\n  onClose,\r\n  closeOnMaskClick = false,\r\n  title,\r\n  width = '40%',\r\n}) => {\r\n  const theme = useTheme();\r\n  const drawerStyles = getStyles(theme);\r\n\r\n  return (\r\n    <RcDrawer\r\n      level={null}\r\n      handler={false}\r\n      open={true}\r\n      onClose={onClose}\r\n      maskClosable={closeOnMaskClick}\r\n      placement=\"right\"\r\n      width={width}\r\n      getContainer={inline ? false : 'body'}\r\n      style={{ position: `${inline && 'absolute'}` } as CSSProperties}\r\n      className={drawerStyles.drawer}\r\n    >\r\n      <div className={drawerStyles.titleWrapper}>\r\n        <div>{title}</div>\r\n        <div className={drawerStyles.close} onClick={onClose}>\r\n          <i className=\"fa fa-close\" />\r\n        </div>\r\n      </div>\r\n      <div className={drawerStyles.content}>{children}</div>\r\n    </RcDrawer>\r\n  );\r\n};\r\n","import React, { FC } from 'react';\r\n\r\nexport interface Props {\r\n  children: JSX.Element | string;\r\n}\r\n\r\nconst EmptySearchResult: FC<Props> = ({ children }) => {\r\n  return <div className=\"empty-search-result\">{children}</div>;\r\n};\r\n\r\nexport { EmptySearchResult };\r\n","import React, { PureComponent, ReactNode } from 'react';\r\nimport { Alert } from '../Alert/Alert';\r\nimport { ErrorWithStack } from './ErrorWithStack';\r\n\r\nexport interface ErrorInfo {\r\n  componentStack: string;\r\n}\r\n\r\nexport interface ErrorBoundaryApi {\r\n  error: Error | null;\r\n  errorInfo: ErrorInfo | null;\r\n}\r\n\r\ninterface Props {\r\n  children: (r: ErrorBoundaryApi) => ReactNode;\r\n}\r\n\r\ninterface State {\r\n  error: Error | null;\r\n  errorInfo: ErrorInfo | null;\r\n}\r\n\r\nexport class ErrorBoundary extends PureComponent<Props, State> {\r\n  readonly state: State = {\r\n    error: null,\r\n    errorInfo: null,\r\n  };\r\n\r\n  componentDidCatch(error: Error, errorInfo: ErrorInfo) {\r\n    this.setState({\r\n      error: error,\r\n      errorInfo: errorInfo,\r\n    });\r\n  }\r\n\r\n  render() {\r\n    const { children } = this.props;\r\n    const { error, errorInfo } = this.state;\r\n\r\n    return children({\r\n      error,\r\n      errorInfo,\r\n    });\r\n  }\r\n}\r\n\r\ninterface WithAlertBoxProps {\r\n  title?: string;\r\n  children: ReactNode;\r\n  style?: 'page' | 'alertbox';\r\n}\r\n\r\nexport class ErrorBoundaryAlert extends PureComponent<WithAlertBoxProps> {\r\n  static defaultProps: Partial<WithAlertBoxProps> = {\r\n    title: 'An unexpected error happened',\r\n    style: 'alertbox',\r\n  };\r\n\r\n  render() {\r\n    const { title, children, style } = this.props;\r\n\r\n    return (\r\n      <ErrorBoundary>\r\n        {({ error, errorInfo }) => {\r\n          if (!errorInfo) {\r\n            return children;\r\n          }\r\n\r\n          if (style === 'alertbox') {\r\n            return (\r\n              <Alert title={title || ''}>\r\n                <details style={{ whiteSpace: 'pre-wrap' }}>\r\n                  {error && error.toString()}\r\n                  <br />\r\n                  {errorInfo.componentStack}\r\n                </details>\r\n              </Alert>\r\n            );\r\n          }\r\n\r\n          return <ErrorWithStack title={title || ''} error={error} errorInfo={errorInfo} />;\r\n        }}\r\n      </ErrorBoundary>\r\n    );\r\n  }\r\n}\r\n","import React, { FunctionComponent } from 'react';\r\nimport { ErrorBoundaryApi } from './ErrorBoundary';\r\nimport { stylesFactory } from '../../themes';\r\nimport { css } from 'emotion';\r\n\r\nconst getStyles = stylesFactory(() => {\r\n  return css`\r\n    width: 500px;\r\n    margin: 64px auto;\r\n  `;\r\n});\r\n\r\nexport interface Props extends ErrorBoundaryApi {\r\n  title: string;\r\n}\r\n\r\nexport const ErrorWithStack: FunctionComponent<Props> = ({ error, errorInfo, title }) => (\r\n  <div className={getStyles()}>\r\n    <h2>{title}</h2>\r\n    <details style={{ whiteSpace: 'pre-wrap' }}>\r\n      {error && error.toString()}\r\n      <br />\r\n      {errorInfo && errorInfo.componentStack}\r\n    </details>\r\n  </div>\r\n);\r\n\r\nErrorWithStack.displayName = 'ErrorWithStack';\r\n","import React, { InputHTMLAttributes, FunctionComponent } from 'react';\r\nimport { FormLabel } from '../FormLabel/FormLabel';\r\nimport { PopoverContent } from '../Tooltip/Tooltip';\r\nimport { cx } from 'emotion';\r\n\r\nexport interface Props extends InputHTMLAttributes<HTMLInputElement> {\r\n  label: string;\r\n  tooltip?: PopoverContent;\r\n  labelWidth?: number;\r\n  inputWidth?: number;\r\n  inputEl?: React.ReactNode;\r\n}\r\n\r\nconst defaultProps = {\r\n  labelWidth: 6,\r\n  inputWidth: 12,\r\n};\r\n\r\n/**\r\n * Default form field including label used in Grafana UI. Default input element is simple <input />. You can also pass\r\n * custom inputEl if required in which case inputWidth and inputProps are ignored.\r\n */\r\nexport const FormField: FunctionComponent<Props> = ({\r\n  label,\r\n  tooltip,\r\n  labelWidth,\r\n  inputWidth,\r\n  inputEl,\r\n  className,\r\n  ...inputProps\r\n}) => {\r\n  return (\r\n    <div className={cx('form-field', className)}>\r\n      <FormLabel width={labelWidth} tooltip={tooltip}>\r\n        {label}\r\n      </FormLabel>\r\n      {inputEl || (\r\n        <input type=\"text\" className={`gf-form-input ${inputWidth ? `width-${inputWidth}` : ''}`} {...inputProps} />\r\n      )}\r\n    </div>\r\n  );\r\n};\r\n\r\nFormField.displayName = 'FormField';\r\nFormField.defaultProps = defaultProps;\r\n","import React, { FunctionComponent, ReactNode } from 'react';\r\nimport classNames from 'classnames';\r\nimport { Tooltip, PopoverContent } from '../Tooltip/Tooltip';\r\n\r\ninterface Props {\r\n  children: ReactNode;\r\n  className?: string;\r\n  htmlFor?: string;\r\n  isFocused?: boolean;\r\n  isInvalid?: boolean;\r\n  tooltip?: PopoverContent;\r\n  width?: number;\r\n}\r\n\r\nexport const FormLabel: FunctionComponent<Props> = ({\r\n  children,\r\n  isFocused,\r\n  isInvalid,\r\n  className,\r\n  htmlFor,\r\n  tooltip,\r\n  width,\r\n  ...rest\r\n}) => {\r\n  const classes = classNames(`gf-form-label width-${width ? width : '10'}`, className, {\r\n    'gf-form-label--is-focused': isFocused,\r\n    'gf-form-label--is-invalid': isInvalid,\r\n  });\r\n\r\n  return (\r\n    <label className={classes} {...rest} htmlFor={htmlFor}>\r\n      {children}\r\n      {tooltip && (\r\n        <Tooltip placement=\"top\" content={tooltip} theme={'info'}>\r\n          <div className=\"gf-form-help-icon gf-form-help-icon--right-normal\">\r\n            <i className=\"fa fa-info-circle\" />\r\n          </div>\r\n        </Tooltip>\r\n      )}\r\n    </label>\r\n  );\r\n};\r\n","import React, { FC, CSSProperties } from 'react';\r\nimport { FormattedValue } from '@grafana/data';\r\n\r\nexport interface Props {\r\n  className?: string;\r\n  value: FormattedValue;\r\n  style: CSSProperties;\r\n}\r\n\r\nfunction fontSizeReductionFactor(fontSize: number) {\r\n  if (fontSize < 20) {\r\n    return 0.9;\r\n  }\r\n  if (fontSize < 26) {\r\n    return 0.8;\r\n  }\r\n  return 0.6;\r\n}\r\n\r\nexport const FormattedValueDisplay: FC<Props> = ({ value, className, style }) => {\r\n  const fontSize = style.fontSize as number;\r\n  const reductionFactor = fontSizeReductionFactor(fontSize);\r\n  const hasPrefix = (value.prefix ?? '').length > 0;\r\n  const hasSuffix = (value.suffix ?? '').length > 0;\r\n\r\n  return (\r\n    <div className={className} style={style}>\r\n      <div>\r\n        {hasPrefix && <span>{value.prefix}</span>}\r\n        <span>{value.text}</span>\r\n        {hasSuffix && <span style={{ fontSize: fontSize * reductionFactor }}>{value.suffix}</span>}\r\n      </div>\r\n    </div>\r\n  );\r\n};\r\n\r\nFormattedValueDisplay.displayName = 'FormattedDisplayValue';\r\n","import React, { AnchorHTMLAttributes, ButtonHTMLAttributes, useContext } from 'react';\r\nimport { css, cx } from 'emotion';\r\nimport tinycolor from 'tinycolor2';\r\nimport { selectThemeVariant, stylesFactory, ThemeContext } from '../../themes';\r\nimport { Button as DefaultButton, LinkButton as DefaultLinkButton } from '../Button/Button';\r\nimport { getFocusStyle, getPropertiesForButtonSize } from './commonStyles';\r\nimport { ButtonSize, StyleDeps } from '../Button/types';\r\nimport { GrafanaTheme } from '@grafana/data';\r\n\r\nconst buttonVariantStyles = (from: string, to: string, textColor: string) => css`\r\n  background: linear-gradient(180deg, ${from} 0%, ${to} 100%);\r\n  color: ${textColor};\r\n  &:hover {\r\n    background: ${from};\r\n    color: ${textColor};\r\n  }\r\n\r\n  &:focus {\r\n    background: ${from};\r\n    outline: none;\r\n  }\r\n`;\r\n\r\nconst getPropertiesForVariant = (theme: GrafanaTheme, variant: ButtonVariant) => {\r\n  switch (variant) {\r\n    case 'secondary':\r\n      const from = selectThemeVariant({ light: theme.colors.gray7, dark: theme.colors.gray15 }, theme.type) as string;\r\n      const to = selectThemeVariant(\r\n        {\r\n          light: tinycolor(from)\r\n            .darken(5)\r\n            .toString(),\r\n          dark: tinycolor(from)\r\n            .lighten(4)\r\n            .toString(),\r\n        },\r\n        theme.type\r\n      ) as string;\r\n\r\n      return {\r\n        borderColor: selectThemeVariant({ light: theme.colors.gray85, dark: theme.colors.gray25 }, theme.type),\r\n        background: buttonVariantStyles(\r\n          from,\r\n          to,\r\n          selectThemeVariant({ light: theme.colors.gray25, dark: theme.colors.gray4 }, theme.type) as string\r\n        ),\r\n      };\r\n\r\n    case 'destructive':\r\n      return {\r\n        borderColor: theme.colors.redShade,\r\n        background: buttonVariantStyles(theme.colors.redBase, theme.colors.redShade, theme.colors.white),\r\n      };\r\n\r\n    case 'link':\r\n      return {\r\n        borderColor: 'transparent',\r\n        background: buttonVariantStyles('transparent', 'transparent', theme.colors.linkExternal),\r\n        variantStyles: css`\r\n          &:focus {\r\n            outline: none;\r\n            box-shadow: none;\r\n          }\r\n        `,\r\n      };\r\n\r\n    case 'primary':\r\n    default:\r\n      return {\r\n        borderColor: theme.colors.blueShade,\r\n        background: buttonVariantStyles(theme.colors.blueBase, theme.colors.blueShade, theme.colors.white),\r\n      };\r\n  }\r\n};\r\n\r\n// Need to do this because of mismatch between variants in standard buttons and here\r\ntype StyleProps = Omit<StyleDeps, 'variant'> & { variant: ButtonVariant };\r\n\r\nexport const getButtonStyles = stylesFactory(({ theme, size, variant }: StyleProps) => {\r\n  const { padding, fontSize, height } = getPropertiesForButtonSize(theme, size);\r\n  const { background, borderColor, variantStyles } = getPropertiesForVariant(theme, variant);\r\n\r\n  return {\r\n    button: cx(\r\n      css`\r\n        label: button;\r\n        display: inline-flex;\r\n        align-items: center;\r\n        font-weight: ${theme.typography.weight.semibold};\r\n        font-family: ${theme.typography.fontFamily.sansSerif};\r\n        line-height: ${theme.typography.lineHeight.sm};\r\n        font-size: ${fontSize};\r\n        padding: ${padding};\r\n        height: ${height};\r\n        vertical-align: middle;\r\n        cursor: pointer;\r\n        border: 1px solid ${borderColor};\r\n        border-radius: ${theme.border.radius.sm};\r\n        ${background};\r\n\r\n        &[disabled],\r\n        &:disabled {\r\n          cursor: not-allowed;\r\n          opacity: 0.65;\r\n          box-shadow: none;\r\n        }\r\n      `,\r\n      getFocusStyle(theme),\r\n      css`\r\n        ${variantStyles}\r\n      `\r\n    ),\r\n    buttonWithIcon: css`\r\n      padding-left: ${theme.spacing.sm};\r\n    `,\r\n    // used for buttons with icon only\r\n    iconButton: css`\r\n      padding-right: 0;\r\n    `,\r\n    iconWrap: css`\r\n      label: button-icon-wrap;\r\n      & + * {\r\n        margin-left: ${theme.spacing.sm};\r\n      }\r\n    `,\r\n  };\r\n});\r\n\r\n// These are different from the standard Button where there are more variants.\r\nexport type ButtonVariant = 'primary' | 'secondary' | 'destructive' | 'link';\r\n\r\n// These also needs to be different because the ButtonVariant is different\r\ntype CommonProps = {\r\n  size?: ButtonSize;\r\n  variant?: ButtonVariant;\r\n  icon?: string;\r\n  className?: string;\r\n};\r\n\r\nexport type ButtonProps = CommonProps & ButtonHTMLAttributes<HTMLButtonElement>;\r\n\r\nexport const Button = React.forwardRef<HTMLButtonElement, ButtonProps>((props, ref) => {\r\n  const theme = useContext(ThemeContext);\r\n  const styles = getButtonStyles({\r\n    theme,\r\n    size: props.size || 'md',\r\n    variant: props.variant || 'primary',\r\n  });\r\n  return <DefaultButton {...props} styles={styles} ref={ref} />;\r\n});\r\n\r\ntype ButtonLinkProps = CommonProps & AnchorHTMLAttributes<HTMLAnchorElement>;\r\nexport const LinkButton = React.forwardRef<HTMLAnchorElement, ButtonLinkProps>((props, ref) => {\r\n  const theme = useContext(ThemeContext);\r\n  const styles = getButtonStyles({\r\n    theme,\r\n    size: props.size || 'md',\r\n    variant: props.variant || 'primary',\r\n  });\r\n  return <DefaultLinkButton {...props} styles={styles} ref={ref} />;\r\n});\r\n","import React, { HTMLProps } from 'react';\r\nimport { GrafanaTheme } from '@grafana/data';\r\nimport { getLabelStyles } from './Label';\r\nimport { useTheme, stylesFactory } from '../../themes';\r\nimport { css, cx } from 'emotion';\r\nimport { getFocusCss } from './commonStyles';\r\n\r\nexport interface CheckboxProps extends Omit<HTMLProps<HTMLInputElement>, 'onChange' | 'value'> {\r\n  label?: string;\r\n  description?: string;\r\n  value: boolean;\r\n  onChange?: (checked: boolean) => void;\r\n}\r\n\r\nexport const getCheckboxStyles = stylesFactory((theme: GrafanaTheme) => {\r\n  const labelStyles = getLabelStyles(theme);\r\n  const checkboxSize = '16px';\r\n  return {\r\n    label: cx(\r\n      labelStyles.label,\r\n      css`\r\n        padding-left: ${theme.spacing.formSpacingBase}px;\r\n      `\r\n    ),\r\n    description: cx(\r\n      labelStyles.description,\r\n      css`\r\n        padding-left: ${theme.spacing.formSpacingBase}px;\r\n      `\r\n    ),\r\n    wrapper: css`\r\n      position: relative;\r\n      padding-left: ${checkboxSize};\r\n    `,\r\n    input: css`\r\n      position: absolute;\r\n      top: 0;\r\n      left: 0;\r\n      width: 100%;\r\n      height: 100%;\r\n      opacity: 0;\r\n      &:focus + span {\r\n        ${getFocusCss(theme)}\r\n      }\r\n\r\n      /**\r\n       * Using adjacent sibling selector to style checked state.\r\n       * Primarily to limit the classes necessary to use when these classes will be used\r\n       * for angular components styling\r\n       * */\r\n      &:checked + span {\r\n        background: blue;\r\n        background: ${theme.colors.formCheckboxBgChecked};\r\n        border: none;\r\n        &:hover {\r\n          background: ${theme.colors.formCheckboxBgCheckedHover};\r\n        }\r\n        &:after {\r\n          content: '';\r\n          position: absolute;\r\n          left: 5px;\r\n          top: 1px;\r\n          width: 6px;\r\n          height: 12px;\r\n          border: solid ${theme.colors.formCheckboxCheckmark};\r\n          border-width: 0 3px 3px 0;\r\n          transform: rotate(45deg);\r\n        }\r\n      }\r\n    `,\r\n    checkmark: css`\r\n      display: inline-block;\r\n      width: ${checkboxSize};\r\n      height: ${checkboxSize};\r\n      border-radius: ${theme.border.radius.sm};\r\n      margin-right: ${theme.spacing.formSpacingBase}px;\r\n      background: ${theme.colors.formCheckboxBg};\r\n      border: 1px solid ${theme.colors.formInputBorder};\r\n      position: absolute;\r\n      top: 1px;\r\n      left: 0;\r\n      &:hover {\r\n        cursor: pointer;\r\n        border-color: ${theme.colors.formInputBorderHover};\r\n      }\r\n    `,\r\n  };\r\n});\r\n\r\nexport const Checkbox: React.FC<CheckboxProps> = ({\r\n  label,\r\n  description,\r\n  value,\r\n  onChange,\r\n  id,\r\n  disabled,\r\n  ...inputProps\r\n}) => {\r\n  const theme = useTheme();\r\n  const styles = getCheckboxStyles(theme);\r\n\r\n  return (\r\n    <label className={styles.wrapper}>\r\n      <input\r\n        type=\"checkbox\"\r\n        className={styles.input}\r\n        id={id}\r\n        checked={value}\r\n        disabled={disabled}\r\n        onChange={event => {\r\n          if (onChange) {\r\n            onChange(event.target.checked);\r\n          }\r\n        }}\r\n        {...inputProps}\r\n      />\r\n      <span className={styles.checkmark} />\r\n      {label && <span className={styles.label}>{label}</span>}\r\n      {description && (\r\n        <>\r\n          <br />\r\n          <span className={styles.description}>{description}</span>\r\n        </>\r\n      )}\r\n    </label>\r\n  );\r\n};\r\n\r\nCheckbox.displayName = 'Checkbox';\r\n","import React from 'react';\r\nimport { Label } from './Label';\r\nimport { stylesFactory, useTheme } from '../../themes';\r\nimport { css, cx } from 'emotion';\r\nimport { GrafanaTheme } from '@grafana/data';\r\nimport { FieldValidationMessage } from './FieldValidationMessage';\r\n\r\nexport interface FieldProps {\r\n  /** Form input element, i.e Input or Switch */\r\n  children: React.ReactElement;\r\n  /** Label for the field */\r\n  label?: string;\r\n  /** Description of the field */\r\n  description?: string;\r\n  /** Indicates if field is in invalid state */\r\n  invalid?: boolean;\r\n  /** Indicates if field is in loading state */\r\n  loading?: boolean;\r\n  /** Indicates if field is disabled */\r\n  disabled?: boolean;\r\n  /** Error message to display */\r\n  error?: string;\r\n  /** Indicates horizontal layout of the field */\r\n  horizontal?: boolean;\r\n  className?: string;\r\n}\r\n\r\nexport const getFieldStyles = stylesFactory((theme: GrafanaTheme) => {\r\n  return {\r\n    field: css`\r\n      display: flex;\r\n      flex-direction: column;\r\n      margin-bottom: ${theme.spacing.formSpacingBase * 2}px;\r\n    `,\r\n    fieldHorizontal: css`\r\n      flex-direction: row;\r\n      justify-content: space-between;\r\n      flex-wrap: wrap;\r\n    `,\r\n    fieldValidationWrapper: css`\r\n      margin-top: ${theme.spacing.formSpacingBase / 2}px;\r\n    `,\r\n    fieldValidationWrapperHorizontal: css`\r\n      flex: 1 1 100%;\r\n    `,\r\n  };\r\n});\r\n\r\nexport const Field: React.FC<FieldProps> = ({\r\n  label,\r\n  description,\r\n  horizontal,\r\n  invalid,\r\n  loading,\r\n  disabled,\r\n  error,\r\n  children,\r\n  className,\r\n}) => {\r\n  const theme = useTheme();\r\n  let inputId;\r\n  const styles = getFieldStyles(theme);\r\n\r\n  // Get the first, and only, child to retrieve form input's id\r\n  const child = React.Children.map(children, c => c)[0];\r\n\r\n  if (child) {\r\n    // Retrieve input's id to apply on the label for correct click interaction\r\n    inputId = (child as React.ReactElement<{ id?: string }>).props.id;\r\n  }\r\n\r\n  return (\r\n    <div className={cx(styles.field, horizontal && styles.fieldHorizontal, className)}>\r\n      {label && (\r\n        <Label htmlFor={inputId} description={description}>\r\n          {label}\r\n        </Label>\r\n      )}\r\n      <div>\r\n        {React.cloneElement(children, { invalid, disabled, loading })}\r\n        {invalid && error && !horizontal && (\r\n          <div className={styles.fieldValidationWrapper}>\r\n            <FieldValidationMessage>{error}</FieldValidationMessage>\r\n          </div>\r\n        )}\r\n      </div>\r\n\r\n      {invalid && error && horizontal && (\r\n        <div className={cx(styles.fieldValidationWrapper, styles.fieldValidationWrapperHorizontal)}>\r\n          <FieldValidationMessage>{error}</FieldValidationMessage>\r\n        </div>\r\n      )}\r\n    </div>\r\n  );\r\n};\r\n","import React from 'react';\r\nimport { useTheme, stylesFactory } from '../../themes';\r\nimport { GrafanaTheme } from '@grafana/data';\r\nimport { css, cx } from 'emotion';\r\n\r\nexport interface FieldValidationMessageProps {\r\n  children: string;\r\n  className?: string;\r\n}\r\n\r\nexport const getFieldValidationMessageStyles = stylesFactory((theme: GrafanaTheme) => {\r\n  return {\r\n    fieldValidationMessage: css`\r\n      font-size: ${theme.typography.size.sm};\r\n      font-weight: ${theme.typography.weight.semibold};\r\n      margin: ${theme.spacing.formValidationMessageMargin};\r\n      padding: ${theme.spacing.formValidationMessagePadding};\r\n      color: ${theme.colors.formValidationMessageText};\r\n      background: ${theme.colors.formValidationMessageBg};\r\n      border-radius: ${theme.border.radius.sm};\r\n      position: relative;\r\n      display: inline-block;\r\n\r\n      &:before {\r\n        content: '';\r\n        position: absolute;\r\n        left: 9px;\r\n        top: -4px;\r\n        width: 0;\r\n        height: 0;\r\n        border-left: 4px solid transparent;\r\n        border-right: 4px solid transparent;\r\n        border-bottom: 4px solid ${theme.colors.formValidationMessageBg};\r\n      }\r\n    `,\r\n    fieldValidationMessageIcon: css`\r\n      margin-right: ${theme.spacing.formSpacingBase}px;\r\n    `,\r\n  };\r\n});\r\n\r\nexport const FieldValidationMessage: React.FC<FieldValidationMessageProps> = ({ children, className }) => {\r\n  const theme = useTheme();\r\n  const styles = getFieldValidationMessageStyles(theme);\r\n\r\n  return (\r\n    <div className={cx(styles.fieldValidationMessage, className)}>\r\n      <i className={cx(styles.fieldValidationMessageIcon, 'fa', 'fa-warning')} />\r\n      {children}\r\n    </div>\r\n  );\r\n};\r\n","/**\r\n * This is a stub implementation only for correct styles to be applied\r\n */\r\n\r\nimport React from 'react';\r\nimport { stylesFactory, useTheme } from '../../themes';\r\nimport { GrafanaTheme } from '@grafana/data';\r\nimport { css } from 'emotion';\r\n\r\nconst getFormStyles = stylesFactory((theme: GrafanaTheme) => {\r\n  return {\r\n    form: css`\r\n      margin-bottom: ${theme.spacing.formMargin};\r\n    `,\r\n  };\r\n});\r\n\r\nexport const Form: React.FC = ({ children }) => {\r\n  const theme = useTheme();\r\n  const styles = getFormStyles(theme);\r\n  return <div className={styles.form}>{children}</div>;\r\n};\r\n","import React, { HTMLProps, ReactNode } from 'react';\r\nimport { GrafanaTheme } from '@grafana/data';\r\nimport { css, cx } from 'emotion';\r\nimport { getFocusStyle, inputSizes, sharedInputStyle } from '../commonStyles';\r\nimport { stylesFactory, useTheme } from '../../../themes';\r\nimport { Icon } from '../../Icon/Icon';\r\nimport { useClientRect } from '../../../utils/useClientRect';\r\nimport { FormInputSize } from '../types';\r\n\r\nexport interface Props extends Omit<HTMLProps<HTMLInputElement>, 'prefix' | 'size'> {\r\n  /** Show an invalid state around the input */\r\n  invalid?: boolean;\r\n  /** Show an icon as a prefix in the input */\r\n  prefix?: JSX.Element | string | null;\r\n  /** Show an icon as a suffix in the input */\r\n  suffix?: JSX.Element | string | null;\r\n  /** Show a loading indicator as a suffix in the input */\r\n  loading?: boolean;\r\n  /** Add a component as an addon before the input  */\r\n  addonBefore?: ReactNode;\r\n  /** Add a component as an addon after the input */\r\n  addonAfter?: ReactNode;\r\n  size?: FormInputSize;\r\n}\r\n\r\ninterface StyleDeps {\r\n  theme: GrafanaTheme;\r\n  invalid: boolean;\r\n}\r\n\r\nexport const getInputStyles = stylesFactory(({ theme, invalid = false }: StyleDeps) => {\r\n  const colors = theme.colors;\r\n  const borderRadius = theme.border.radius.sm;\r\n  const height = theme.spacing.formInputHeight;\r\n\r\n  const prefixSuffixStaticWidth = '28px';\r\n  const prefixSuffix = css`\r\n    position: absolute;\r\n    top: 0;\r\n    z-index: 1;\r\n    display: flex;\r\n    align-items: center;\r\n    justify-content: center;\r\n    flex-grow: 0;\r\n    flex-shrink: 0;\r\n    font-size: ${theme.typography.size.md};\r\n    height: 100%;\r\n    /* Min width specified for prefix/suffix classes used outside React component*/\r\n    min-width: ${prefixSuffixStaticWidth};\r\n  `;\r\n\r\n  return {\r\n    // Wraps inputWraper and addons\r\n    wrapper: cx(\r\n      css`\r\n        label: input-wrapper;\r\n        display: flex;\r\n        width: 100%;\r\n        height: ${height};\r\n        border-radius: ${borderRadius};\r\n        &:hover {\r\n          > .prefix,\r\n          .suffix,\r\n          .input {\r\n            border-color: ${invalid ? colors.redBase : colors.formInputBorder};\r\n          }\r\n        }\r\n      `\r\n    ),\r\n    // Wraps input and prefix/suffix\r\n    inputWrapper: css`\r\n      label: input-inputWrapper;\r\n      position: relative;\r\n      flex-grow: 1;\r\n      /* we want input to be above addons, especially for focused state */\r\n      z-index: 1;\r\n\r\n      /* when input rendered with addon before only*/\r\n      &:not(:first-child):last-child {\r\n        > input {\r\n          border-left: none;\r\n          border-top-left-radius: 0;\r\n          border-bottom-left-radius: 0;\r\n        }\r\n      }\r\n\r\n      /* when input rendered with addon after only*/\r\n      &:first-child:not(:last-child) {\r\n        > input {\r\n          border-right: none;\r\n          border-top-right-radius: 0;\r\n          border-bottom-right-radius: 0;\r\n        }\r\n      }\r\n\r\n      /* when rendered with addon before and after */\r\n      &:not(:first-child):not(:last-child) {\r\n        > input {\r\n          border-right: none;\r\n          border-top-right-radius: 0;\r\n          border-bottom-right-radius: 0;\r\n          border-top-left-radius: 0;\r\n          border-bottom-left-radius: 0;\r\n        }\r\n      }\r\n\r\n      input {\r\n        /* paddings specified for classes used outside React component */\r\n        &:not(:first-child) {\r\n          padding-left: ${prefixSuffixStaticWidth};\r\n        }\r\n        &:not(:last-child) {\r\n          padding-right: ${prefixSuffixStaticWidth};\r\n        }\r\n        &[readonly] {\r\n          cursor: default;\r\n        }\r\n      }\r\n    `,\r\n\r\n    input: cx(\r\n      getFocusStyle(theme),\r\n      sharedInputStyle(theme, invalid),\r\n      css`\r\n        label: input-input;\r\n        position: relative;\r\n        z-index: 0;\r\n        flex-grow: 1;\r\n        border-radius: ${borderRadius};\r\n        height: 100%;\r\n        width: 100%;\r\n\r\n        /*\r\n         Restoring increase/decrease spinner on number inputs. Overwriting rules implemented in\r\n         https://github.com/grafana/grafana/commit/488fe62f158a9e0a0bced2b678ada5d43cf3998e.\r\n         */\r\n\r\n        &[type='number']::-webkit-outer-spin-button,\r\n        &[type='number']::-webkit-inner-spin-button {\r\n          -webkit-appearance: inner-spin-button !important;\r\n          opacity: 1;\r\n        }\r\n\r\n        &[type='number'] {\r\n          -moz-appearance: number-input;\r\n        }\r\n      `\r\n    ),\r\n    inputDisabled: css`\r\n      background-color: ${colors.formInputBgDisabled};\r\n      color: ${colors.formInputDisabledText};\r\n    `,\r\n    addon: css`\r\n        label: input-addon;\r\n        display: flex;\r\n        justify-content: center;\r\n        align-items: center;\r\n        flex-grow: 0;\r\n        flex-shrink: 0;\r\n        position: relative;\r\n\r\n        &:first-child {\r\n          border-top-right-radius: 0;\r\n          border-bottom-right-radius: 0;\r\n          > :last-child {\r\n            border-top-right-radius: 0;\r\n            border-bottom-right-radius: 0;\r\n          }\r\n        }\r\n\r\n        &:last-child {\r\n          border-top-left-radius: 0;\r\n          border-bottom-left-radius: 0;\r\n          > :first-child {\r\n            border-top-left-radius: 0;\r\n            border-bottom-left-radius: 0;\r\n          }\r\n        }\r\n        > *:focus {\r\n          /* we want anything that has focus and is an addon to be above input */\r\n          z-index: 2;\r\n        }\r\n        }\r\n      `,\r\n    prefix: cx(\r\n      prefixSuffix,\r\n      css`\r\n        label: input-prefix;\r\n        padding-left: ${theme.spacing.sm};\r\n        padding-right: ${theme.spacing.xs};\r\n        border-right: none;\r\n        border-top-right-radius: 0;\r\n        border-bottom-right-radius: 0;\r\n      `\r\n    ),\r\n    suffix: cx(\r\n      prefixSuffix,\r\n      css`\r\n        label: input-suffix;\r\n        padding-right: ${theme.spacing.sm};\r\n        padding-left: ${theme.spacing.xs};\r\n        border-left: none;\r\n        border-top-left-radius: 0;\r\n        border-bottom-left-radius: 0;\r\n        right: 0;\r\n      `\r\n    ),\r\n    loadingIndicator: css`\r\n      & + * {\r\n        margin-left: ${theme.spacing.xs};\r\n      }\r\n    `,\r\n  };\r\n});\r\n\r\nexport const Input = React.forwardRef<HTMLInputElement, Props>((props, ref) => {\r\n  const { addonAfter, addonBefore, prefix, suffix, invalid, loading, size = 'auto', ...restProps } = props;\r\n  /**\r\n   * Prefix & suffix are positioned absolutely within inputWrapper. We use client rects below to apply correct padding to the input\r\n   * when prefix/suffix is larger than default (28px = 16px(icon) + 12px(left/right paddings)).\r\n   * Thanks to that prefix/suffix do not overflow the input element itself.\r\n   */\r\n  const [prefixRect, prefixRef] = useClientRect<HTMLDivElement>();\r\n  const [suffixRect, suffixRef] = useClientRect<HTMLDivElement>();\r\n\r\n  const theme = useTheme();\r\n  const styles = getInputStyles({ theme, invalid: !!invalid });\r\n\r\n  return (\r\n    <div className={cx(styles.wrapper, inputSizes()[size])}>\r\n      {!!addonBefore && <div className={styles.addon}>{addonBefore}</div>}\r\n\r\n      <div className={styles.inputWrapper}>\r\n        {prefix && (\r\n          <div className={styles.prefix} ref={prefixRef}>\r\n            {prefix}\r\n          </div>\r\n        )}\r\n\r\n        <input\r\n          ref={ref}\r\n          className={styles.input}\r\n          {...restProps}\r\n          style={{\r\n            paddingLeft: prefixRect ? prefixRect.width : undefined,\r\n            paddingRight: suffixRect ? suffixRect.width : undefined,\r\n          }}\r\n        />\r\n\r\n        {(suffix || loading) && (\r\n          <div className={styles.suffix} ref={suffixRef}>\r\n            {loading && <Icon name=\"spinner\" className={cx('fa-spin', styles.loadingIndicator)} />}\r\n            {suffix}\r\n          </div>\r\n        )}\r\n      </div>\r\n\r\n      {!!addonAfter && <div className={styles.addon}>{addonAfter}</div>}\r\n    </div>\r\n  );\r\n});\r\n","import React from 'react';\r\nimport { useTheme, stylesFactory } from '../../themes';\r\nimport { GrafanaTheme } from '@grafana/data';\r\nimport { css, cx } from 'emotion';\r\n\r\nexport interface LabelProps extends React.LabelHTMLAttributes<HTMLLabelElement> {\r\n  children: string;\r\n  description?: string;\r\n}\r\n\r\nexport const getLabelStyles = stylesFactory((theme: GrafanaTheme) => {\r\n  return {\r\n    label: css`\r\n      font-size: ${theme.typography.size.sm};\r\n      font-weight: ${theme.typography.weight.semibold};\r\n      line-height: 1.25;\r\n      margin: ${theme.spacing.formLabelMargin};\r\n      padding: ${theme.spacing.formLabelPadding};\r\n      color: ${theme.colors.formLabel};\r\n      max-width: 480px;\r\n    `,\r\n    description: css`\r\n      color: ${theme.colors.formLabel};\r\n      font-size: ${theme.typography.size.sm};\r\n      font-weight: ${theme.typography.weight.regular};\r\n      display: block;\r\n    `,\r\n  };\r\n});\r\n\r\nexport const Label: React.FC<LabelProps> = ({ children, description, className, ...labelProps }) => {\r\n  const theme = useTheme();\r\n  const styles = getLabelStyles(theme);\r\n\r\n  return (\r\n    <div className={cx(styles.label, className)}>\r\n      <label {...labelProps}>\r\n        {children}\r\n        {description && <span className={styles.description}>{description}</span>}\r\n      </label>\r\n    </div>\r\n  );\r\n};\r\n","import React from 'react';\r\nimport { useTheme, stylesFactory } from '../../themes';\r\nimport { GrafanaTheme } from '@grafana/data';\r\nimport { css, cx } from 'emotion';\r\n\r\nexport interface LabelProps extends React.HTMLAttributes<HTMLLegendElement> {\r\n  children: string;\r\n  description?: string;\r\n}\r\n\r\nexport const getLegendStyles = stylesFactory((theme: GrafanaTheme) => {\r\n  return {\r\n    legend: css`\r\n      font-size: ${theme.typography.heading.h3};\r\n      font-weight: ${theme.typography.weight.regular};\r\n      margin: ${theme.spacing.formLegendMargin};\r\n      color: ${theme.colors.formLegend};\r\n    `,\r\n  };\r\n});\r\n\r\nexport const Legend: React.FC<LabelProps> = ({ children, className, ...legendProps }) => {\r\n  const theme = useTheme();\r\n  const styles = getLegendStyles(theme);\r\n\r\n  return (\r\n    <legend className={cx(styles.legend, className)} {...legendProps}>\r\n      {children}\r\n    </legend>\r\n  );\r\n};\r\n","import React from 'react';\r\nimport { Icon } from '../../Icon/Icon';\r\n\r\ninterface DropdownIndicatorProps {\r\n  isOpen: boolean;\r\n}\r\n\r\nexport const DropdownIndicator: React.FC<DropdownIndicatorProps> = ({ isOpen }) => {\r\n  const icon = isOpen ? 'caret-up' : 'caret-down';\r\n  return <Icon name={icon} />;\r\n};\r\n","import React from 'react';\r\nimport { useTheme } from '../../../themes/ThemeContext';\r\nimport { getInputStyles } from '../Input/Input';\r\nimport { cx, css } from 'emotion';\r\n\r\nexport const IndicatorsContainer = React.forwardRef<HTMLDivElement, React.PropsWithChildren<any>>((props, ref) => {\r\n  const { children } = props;\r\n  const theme = useTheme();\r\n  const styles = getInputStyles({ theme, invalid: false });\r\n\r\n  return (\r\n    <div\r\n      className={cx(\r\n        styles.suffix,\r\n        css`\r\n          position: relative;\r\n          top: auto;\r\n        `\r\n      )}\r\n      ref={ref}\r\n    >\r\n      {children}\r\n    </div>\r\n  );\r\n});\r\n","import React from 'react';\r\nimport { useTheme } from '../../../themes/ThemeContext';\r\nimport { getFocusCss, sharedInputStyle } from '../commonStyles';\r\nimport { getInputStyles } from '../Input/Input';\r\nimport { cx, css } from 'emotion';\r\nimport { stylesFactory } from '../../../themes';\r\nimport { GrafanaTheme } from '@grafana/data';\r\n\r\ninterface InputControlProps {\r\n  /** Show an icon as a prefix in the input */\r\n  prefix?: JSX.Element | string | null;\r\n  focused: boolean;\r\n  invalid: boolean;\r\n  disabled: boolean;\r\n  innerProps: any;\r\n}\r\n\r\nconst getInputControlStyles = stylesFactory(\r\n  (theme: GrafanaTheme, invalid: boolean, focused: boolean, disabled: boolean, withPrefix: boolean) => {\r\n    const styles = getInputStyles({ theme, invalid });\r\n\r\n    return {\r\n      wrapper: cx(\r\n        styles.wrapper,\r\n        sharedInputStyle(theme, invalid),\r\n        focused &&\r\n          css`\r\n            ${getFocusCss(theme)}\r\n          `,\r\n        disabled && styles.inputDisabled,\r\n        css`\r\n          min-height: 32px;\r\n          height: auto;\r\n          flex-direction: row;\r\n          padding-right: 0;\r\n          max-width: 100%;\r\n          align-items: center;\r\n          cursor: default;\r\n          display: flex;\r\n          flex-wrap: wrap;\r\n          justify-content: space-between;\r\n          position: relative;\r\n          box-sizing: border-box;\r\n        `,\r\n        withPrefix &&\r\n          css`\r\n            padding-left: 0;\r\n          `\r\n      ),\r\n      prefix: cx(\r\n        styles.prefix,\r\n        css`\r\n          position: relative;\r\n        `\r\n      ),\r\n    };\r\n  }\r\n);\r\n\r\nexport const InputControl = React.forwardRef<HTMLDivElement, React.PropsWithChildren<InputControlProps>>(\r\n  function InputControl({ focused, invalid, disabled, children, innerProps, prefix, ...otherProps }, ref) {\r\n    const theme = useTheme();\r\n    const styles = getInputControlStyles(theme, invalid, focused, disabled, !!prefix);\r\n    return (\r\n      <div className={styles.wrapper} {...innerProps} ref={ref}>\r\n        {prefix && <div className={cx(styles.prefix)}>{prefix}</div>}\r\n        {children}\r\n      </div>\r\n    );\r\n  }\r\n);\r\n","import React from 'react';\r\nimport { useTheme } from '../../../themes';\r\nimport { getSelectStyles } from './getSelectStyles';\r\nimport { Icon } from '../../Icon/Icon';\r\n\r\ninterface MultiValueContainerProps {\r\n  innerProps: any;\r\n}\r\n\r\nexport const MultiValueContainer: React.FC<MultiValueContainerProps> = ({ innerProps, children }) => {\r\n  const theme = useTheme();\r\n  const styles = getSelectStyles(theme);\r\n\r\n  return (\r\n    <div {...innerProps} className={styles.multiValueContainer}>\r\n      {children}\r\n    </div>\r\n  );\r\n};\r\n\r\nexport type MultiValueRemoveProps = {\r\n  innerProps: any;\r\n};\r\n\r\nexport const MultiValueRemove: React.FC<MultiValueRemoveProps> = ({ children, innerProps }) => {\r\n  const theme = useTheme();\r\n  const styles = getSelectStyles(theme);\r\n  return (\r\n    <div {...innerProps} className={styles.multiValueRemove}>\r\n      <Icon name=\"times\" />\r\n    </div>\r\n  );\r\n};\r\n","import React from 'react';\r\nimport { SelectableValue } from '@grafana/data';\r\nimport { SelectCommonProps, SelectBase, MultiSelectCommonProps, SelectAsyncProps } from './SelectBase';\r\n\r\nexport function Select<T>(props: SelectCommonProps<T>) {\r\n  return <SelectBase {...props} />;\r\n}\r\n\r\nexport function MultiSelect<T>(props: MultiSelectCommonProps<T>) {\r\n  // @ts-ignore\r\n  return <SelectBase {...props} isMulti />;\r\n}\r\n\r\ninterface AsyncSelectProps<T> extends Omit<SelectCommonProps<T>, 'options'>, SelectAsyncProps<T> {\r\n  // AsyncSelect has options stored internally. We cannot enable plain values as we don't have access to the fetched options\r\n  value?: SelectableValue<T>;\r\n}\r\n\r\nexport function AsyncSelect<T>(props: AsyncSelectProps<T>) {\r\n  return <SelectBase {...props} />;\r\n}\r\n\r\ninterface AsyncMultiSelectProps<T> extends Omit<MultiSelectCommonProps<T>, 'options'>, SelectAsyncProps<T> {\r\n  // AsyncSelect has options stored internally. We cannot enable plain values as we don't have access to the fetched options\r\n  value?: Array<SelectableValue<T>>;\r\n}\r\n\r\nexport function AsyncMultiSelect<T>(props: AsyncMultiSelectProps<T>) {\r\n  // @ts-ignore\r\n  return <SelectBase {...props} isMulti />;\r\n}\r\n","import React from 'react';\r\nimport { SelectableValue, deprecationWarning } from '@grafana/data';\r\n// @ts-ignore\r\nimport { default as ReactSelect, Creatable } from '@torkelo/react-select';\r\n// @ts-ignore\r\nimport { default as ReactAsyncSelect } from '@torkelo/react-select/lib/Async';\r\n\r\nimport { Icon } from '../../Icon/Icon';\r\nimport { css } from 'emotion';\r\nimport { inputSizes } from '../commonStyles';\r\nimport { FormInputSize } from '../types';\r\nimport resetSelectStyles from './resetSelectStyles';\r\nimport { SelectMenu, SelectMenuOptions } from './SelectMenu';\r\nimport { IndicatorsContainer } from './IndicatorsContainer';\r\nimport { ValueContainer } from './ValueContainer';\r\nimport { InputControl } from './InputControl';\r\nimport { DropdownIndicator } from './DropdownIndicator';\r\nimport { SelectOptionGroup } from './SelectOptionGroup';\r\nimport { SingleValue } from './SingleValue';\r\nimport { MultiValueContainer, MultiValueRemove } from './MultiValue';\r\nimport { useTheme } from '../../../themes';\r\nimport { getSelectStyles } from './getSelectStyles';\r\n\r\ntype SelectValue<T> = T | SelectableValue<T> | T[] | Array<SelectableValue<T>>;\r\n\r\nexport interface SelectCommonProps<T> {\r\n  className?: string;\r\n  options?: Array<SelectableValue<T>>;\r\n  defaultValue?: any;\r\n  inputValue?: string;\r\n  value?: SelectValue<T>;\r\n  getOptionLabel?: (item: SelectableValue<T>) => string;\r\n  getOptionValue?: (item: SelectableValue<T>) => string;\r\n  onChange: (value: SelectableValue<T>) => {} | void;\r\n  onInputChange?: (label: string) => void;\r\n  onKeyDown?: (event: React.KeyboardEvent) => void;\r\n  placeholder?: string;\r\n  disabled?: boolean;\r\n  isSearchable?: boolean;\r\n  isClearable?: boolean;\r\n  autoFocus?: boolean;\r\n  openMenuOnFocus?: boolean;\r\n  onBlur?: () => void;\r\n  maxMenuHeight?: number;\r\n  isLoading?: boolean;\r\n  noOptionsMessage?: string;\r\n  isMulti?: boolean;\r\n  backspaceRemovesValue?: boolean;\r\n  isOpen?: boolean;\r\n  components?: any;\r\n  onOpenMenu?: () => void;\r\n  onCloseMenu?: () => void;\r\n  tabSelectsValue?: boolean;\r\n  formatCreateLabel?: (input: string) => string;\r\n  allowCustomValue?: boolean;\r\n  width?: number;\r\n  size?: FormInputSize;\r\n  /** item to be rendered in front of the input */\r\n  prefix?: JSX.Element | string | null;\r\n  renderControl?: ControlComponent<T>;\r\n}\r\n\r\nexport interface SelectAsyncProps<T> {\r\n  /** When specified as boolean the loadOptions will execute when component is mounted */\r\n  defaultOptions?: boolean | Array<SelectableValue<T>>;\r\n  /** Asynchroniously load select options */\r\n  loadOptions?: (query: string) => Promise<Array<SelectableValue<T>>>;\r\n  /** Message to display when options are loading */\r\n  loadingMessage?: string;\r\n}\r\n\r\nexport interface MultiSelectCommonProps<T> extends Omit<SelectCommonProps<T>, 'onChange' | 'isMulti' | 'value'> {\r\n  value?: Array<SelectableValue<T>> | T[];\r\n  onChange: (item: Array<SelectableValue<T>>) => {} | void;\r\n}\r\n\r\nexport interface SelectBaseProps<T> extends SelectCommonProps<T>, SelectAsyncProps<T> {\r\n  invalid?: boolean;\r\n}\r\n\r\nexport interface CustomControlProps<T> {\r\n  ref: React.Ref<any>;\r\n  isOpen: boolean;\r\n  /** Currently selected value */\r\n  value?: SelectableValue<T>;\r\n  /** onClick will be automatically passed to custom control allowing menu toggle */\r\n  onClick: () => void;\r\n  /** onBlur will be automatically passed to custom control closing the menu on element blur */\r\n  onBlur: () => void;\r\n  disabled: boolean;\r\n  invalid: boolean;\r\n}\r\n\r\nexport type ControlComponent<T> = React.ComponentType<CustomControlProps<T>>;\r\n\r\nconst CustomControl = (props: any) => {\r\n  const {\r\n    children,\r\n    innerProps,\r\n    selectProps: { menuIsOpen, onMenuClose, onMenuOpen },\r\n    isFocused,\r\n    isMulti,\r\n    getValue,\r\n    innerRef,\r\n  } = props;\r\n  const selectProps = props.selectProps as SelectBaseProps<any>;\r\n\r\n  if (selectProps.renderControl) {\r\n    return React.createElement(selectProps.renderControl, {\r\n      isOpen: menuIsOpen,\r\n      value: isMulti ? getValue() : getValue()[0],\r\n      ref: innerRef,\r\n      onClick: menuIsOpen ? onMenuClose : onMenuOpen,\r\n      onBlur: onMenuClose,\r\n      disabled: !!selectProps.disabled,\r\n      invalid: !!selectProps.invalid,\r\n    });\r\n  }\r\n\r\n  return (\r\n    <InputControl\r\n      ref={innerRef}\r\n      innerProps={innerProps}\r\n      prefix={selectProps.prefix}\r\n      focused={isFocused}\r\n      invalid={!!selectProps.invalid}\r\n      disabled={!!selectProps.disabled}\r\n    >\r\n      {children}\r\n    </InputControl>\r\n  );\r\n};\r\n\r\nexport function SelectBase<T>({\r\n  value,\r\n  defaultValue,\r\n  inputValue,\r\n  onInputChange,\r\n  options = [],\r\n  onChange,\r\n  onBlur,\r\n  onKeyDown,\r\n  onCloseMenu,\r\n  onOpenMenu,\r\n  placeholder = 'Choose',\r\n  getOptionValue,\r\n  getOptionLabel,\r\n  isSearchable = true,\r\n  disabled = false,\r\n  isClearable = false,\r\n  isMulti = false,\r\n  isLoading = false,\r\n  isOpen,\r\n  autoFocus = false,\r\n  openMenuOnFocus = false,\r\n  maxMenuHeight = 300,\r\n  noOptionsMessage = 'No options found',\r\n  tabSelectsValue = true,\r\n  backspaceRemovesValue = true,\r\n  allowCustomValue = false,\r\n  size = 'auto',\r\n  prefix,\r\n  formatCreateLabel,\r\n  loadOptions,\r\n  loadingMessage = 'Loading options...',\r\n  defaultOptions,\r\n  renderControl,\r\n  width,\r\n  invalid,\r\n  components,\r\n}: SelectBaseProps<T>) {\r\n  const theme = useTheme();\r\n  const styles = getSelectStyles(theme);\r\n  let Component: ReactSelect | Creatable = ReactSelect;\r\n  const creatableProps: any = {};\r\n  let asyncSelectProps: any = {};\r\n\r\n  let selectedValue = [];\r\n  if (isMulti && loadOptions) {\r\n    selectedValue = value as any;\r\n  } else {\r\n    // If option is passed as a plain value (value property from SelectableValue property)\r\n    // we are selecting the corresponding value from the options\r\n    if (isMulti && value && Array.isArray(value) && !loadOptions) {\r\n      // @ts-ignore\r\n      selectedValue = value.map(v => {\r\n        return options.filter(o => {\r\n          return v === o.value || o.value === v.value;\r\n        })[0];\r\n      });\r\n    } else {\r\n      selectedValue = options.filter(o => o.value === value || o === value);\r\n    }\r\n  }\r\n\r\n  const commonSelectProps = {\r\n    autoFocus,\r\n    placeholder,\r\n    isSearchable,\r\n    // Passing isDisabled as react-select accepts this prop\r\n    isDisabled: disabled,\r\n    // Also passing disabled, as this is the new Select API, and I want to use this prop instead of react-select's one\r\n    disabled,\r\n    invalid,\r\n    prefix,\r\n    isClearable,\r\n    isLoading,\r\n    menuIsOpen: isOpen,\r\n    defaultValue,\r\n    inputValue,\r\n    onInputChange,\r\n    value: isMulti ? selectedValue : selectedValue[0],\r\n    getOptionLabel,\r\n    getOptionValue,\r\n    openMenuOnFocus,\r\n    maxMenuHeight,\r\n    isMulti,\r\n    backspaceRemovesValue,\r\n    onMenuOpen: onOpenMenu,\r\n    onMenuClose: onCloseMenu,\r\n    tabSelectsValue,\r\n    options,\r\n    onChange,\r\n    onBlur,\r\n    onKeyDown,\r\n    menuShouldScrollIntoView: false,\r\n    renderControl,\r\n  };\r\n\r\n  // width property is deprecated in favor of size or className\r\n  let widthClass = '';\r\n  if (width) {\r\n    deprecationWarning('Select', 'width property', 'size or className');\r\n    widthClass = 'width-' + width;\r\n  }\r\n\r\n  if (allowCustomValue) {\r\n    Component = Creatable;\r\n    creatableProps.formatCreateLabel = formatCreateLabel ?? ((input: string) => `Create: ${input}`);\r\n  }\r\n\r\n  // Instead of having AsyncSelect, as a separate component we render ReactAsyncSelect\r\n  if (loadOptions) {\r\n    Component = ReactAsyncSelect;\r\n    asyncSelectProps = {\r\n      loadOptions,\r\n      defaultOptions,\r\n    };\r\n  }\r\n\r\n  return (\r\n    <Component\r\n      components={{\r\n        MenuList: SelectMenu,\r\n        Group: SelectOptionGroup,\r\n        ValueContainer: ValueContainer,\r\n        IndicatorsContainer: IndicatorsContainer,\r\n        IndicatorSeparator: () => <></>,\r\n        Control: CustomControl,\r\n        Option: SelectMenuOptions,\r\n        ClearIndicator: (props: any) => {\r\n          const { clearValue } = props;\r\n          return (\r\n            <Icon\r\n              name=\"times\"\r\n              onMouseDown={e => {\r\n                e.preventDefault();\r\n                e.stopPropagation();\r\n                clearValue();\r\n              }}\r\n            />\r\n          );\r\n        },\r\n        LoadingIndicator: (props: any) => {\r\n          return <Icon name=\"spinner\" className=\"fa fa-spin\" />;\r\n        },\r\n        LoadingMessage: (props: any) => {\r\n          return <div className={styles.loadingMessage}>{loadingMessage}</div>;\r\n        },\r\n        NoOptionsMessage: (props: any) => {\r\n          return (\r\n            <div className={styles.loadingMessage} aria-label=\"No options provided\">\r\n              {noOptionsMessage}\r\n            </div>\r\n          );\r\n        },\r\n        DropdownIndicator: (props: any) => <DropdownIndicator isOpen={props.selectProps.menuIsOpen} />,\r\n        SingleValue: SingleValue,\r\n        MultiValueContainer: MultiValueContainer,\r\n        MultiValueRemove: MultiValueRemove,\r\n        ...components,\r\n      }}\r\n      styles={{\r\n        ...resetSelectStyles(),\r\n        singleValue: () => {\r\n          return css`\r\n            overflow: hidden;\r\n          `;\r\n        },\r\n        container: () => {\r\n          return css`\r\n            position: relative;\r\n            ${inputSizes()[size]}\r\n          `;\r\n        },\r\n        placeholder: () => {\r\n          return css`\r\n            display: inline-block;\r\n            color: hsl(0, 0%, 50%);\r\n            position: absolute;\r\n            top: 50%;\r\n            transform: translateY(-50%);\r\n            box-sizing: border-box;\r\n            line-height: 1;\r\n          `;\r\n        },\r\n      }}\r\n      className={widthClass}\r\n      {...commonSelectProps}\r\n      {...creatableProps}\r\n      {...asyncSelectProps}\r\n    />\r\n  );\r\n}\r\n","import React from 'react';\r\nimport { useTheme } from '../../../themes/ThemeContext';\r\nimport { getSelectStyles } from './getSelectStyles';\r\nimport { cx } from 'emotion';\r\nimport { SelectableValue } from '@grafana/data';\r\nimport { Icon } from '../../Icon/Icon';\r\nimport { CustomScrollbar } from '../../CustomScrollbar/CustomScrollbar';\r\ninterface SelectMenuProps {\r\n  maxHeight: number;\r\n  innerRef: React.Ref<any>;\r\n}\r\n\r\nexport const SelectMenu = React.forwardRef<HTMLDivElement, React.PropsWithChildren<SelectMenuProps>>((props, ref) => {\r\n  const theme = useTheme();\r\n  const styles = getSelectStyles(theme);\r\n  const { children, maxHeight, innerRef } = props;\r\n\r\n  return (\r\n    <div className={styles.menu} ref={innerRef} style={{ maxHeight }} aria-label=\"Select options menu\">\r\n      <CustomScrollbar autoHide={false} autoHeightMax=\"inherit\" hideHorizontalTrack>\r\n        {children}\r\n      </CustomScrollbar>\r\n    </div>\r\n  );\r\n});\r\n\r\nSelectMenu.displayName = 'SelectMenu';\r\n\r\ninterface SelectMenuOptionProps<T> {\r\n  isDisabled: boolean;\r\n  isFocused: boolean;\r\n  isSelected: boolean;\r\n  innerProps: any;\r\n  renderOptionLabel?: (value: SelectableValue<T>) => JSX.Element;\r\n  data: SelectableValue<T>;\r\n}\r\n\r\nexport const SelectMenuOptions = React.forwardRef<HTMLDivElement, React.PropsWithChildren<SelectMenuOptionProps<any>>>(\r\n  (props, ref) => {\r\n    const theme = useTheme();\r\n    const styles = getSelectStyles(theme);\r\n    const { children, innerProps, data, renderOptionLabel, isSelected, isFocused } = props;\r\n    return (\r\n      <div\r\n        ref={ref}\r\n        className={cx(styles.option, isFocused && styles.optionFocused)}\r\n        {...innerProps}\r\n        aria-label=\"Select option\"\r\n      >\r\n        <span>{renderOptionLabel ? renderOptionLabel(data) : children}</span>\r\n        {isSelected && (\r\n          <span>\r\n            <Icon name=\"check\" />\r\n          </span>\r\n        )}\r\n      </div>\r\n    );\r\n  }\r\n);\r\n","import React, { PureComponent } from 'react';\r\nimport { css, cx } from 'emotion';\r\nimport { GrafanaTheme } from '@grafana/data';\r\nimport { GroupProps } from 'react-select/lib/components/Group';\r\nimport { stylesFactory, withTheme, selectThemeVariant } from '../../../themes';\r\nimport { Themeable } from '../../../types';\r\n\r\ninterface ExtendedGroupProps extends GroupProps<any>, Themeable {\r\n  data: {\r\n    label: string;\r\n    expanded: boolean;\r\n    options: any[];\r\n  };\r\n}\r\n\r\ninterface State {\r\n  expanded: boolean;\r\n}\r\n\r\nconst getSelectOptionGroupStyles = stylesFactory((theme: GrafanaTheme) => {\r\n  const optionBorder = selectThemeVariant(\r\n    {\r\n      light: theme.colors.gray4,\r\n      dark: theme.colors.dark9,\r\n    },\r\n    theme.type\r\n  );\r\n  return {\r\n    header: css`\r\n      display: flex;\r\n      align-items: center;\r\n      justify-content: flex-start;\r\n      justify-items: center;\r\n      cursor: pointer;\r\n      padding: 7px 10px;\r\n      width: 100%;\r\n      border-bottom: 1px solid ${optionBorder};\r\n      text-transform: capitalize;\r\n    `,\r\n    label: css`\r\n      flex-grow: 1;\r\n    `,\r\n    icon: css`\r\n      padding-right: 2px;\r\n    `,\r\n  };\r\n});\r\n\r\nclass UnthemedSelectOptionGroup extends PureComponent<ExtendedGroupProps, State> {\r\n  state = {\r\n    expanded: false,\r\n  };\r\n\r\n  componentDidMount() {\r\n    if (this.props.data.expanded) {\r\n      this.setState({ expanded: true });\r\n    } else if (this.props.selectProps && this.props.selectProps.value) {\r\n      const { value } = this.props.selectProps.value;\r\n\r\n      if (value && this.props.options.some(option => option.value === value)) {\r\n        this.setState({ expanded: true });\r\n      }\r\n    }\r\n  }\r\n\r\n  componentDidUpdate(nextProps: ExtendedGroupProps) {\r\n    if (nextProps.selectProps.inputValue !== '') {\r\n      this.setState({ expanded: true });\r\n    }\r\n  }\r\n\r\n  onToggleChildren = () => {\r\n    this.setState(prevState => ({\r\n      expanded: !prevState.expanded,\r\n    }));\r\n  };\r\n\r\n  render() {\r\n    const { children, label, theme } = this.props;\r\n    const { expanded } = this.state;\r\n    const styles = getSelectOptionGroupStyles(theme);\r\n    const icon = expanded ? 'fa-caret-left' : 'fa-caret-down';\r\n    return (\r\n      <div>\r\n        <div className={styles.header} onClick={this.onToggleChildren}>\r\n          <span className={styles.label}>{label}</span>\r\n          <i className={cx('fa', icon, styles.icon)} />{' '}\r\n        </div>\r\n        {expanded && children}\r\n      </div>\r\n    );\r\n  }\r\n}\r\n\r\nexport const SelectOptionGroup = withTheme(UnthemedSelectOptionGroup);\r\n","import React from 'react';\r\nimport { css } from 'emotion';\r\n\r\n// Ignoring because I couldn't get @types/react-select work wih Torkel's fork\r\n// @ts-ignore\r\nimport { components } from '@torkelo/react-select';\r\nimport { useDelayedSwitch } from '../../../utils/useDelayedSwitch';\r\nimport { stylesFactory, useTheme } from '../../../themes';\r\nimport { SlideOutTransition } from '../../transitions/SlideOutTransition';\r\nimport { FadeTransition } from '../../transitions/FadeTransition';\r\nimport { Spinner } from '../../Spinner/Spinner';\r\nimport { GrafanaTheme } from '@grafana/data';\r\n\r\nconst getStyles = stylesFactory((theme: GrafanaTheme) => {\r\n  const singleValue = css`\r\n    label: singleValue;\r\n    color: ${theme.colors.formInputText};\r\n    white-space: nowrap;\r\n    overflow: hidden;\r\n    text-overflow: ellipsis;\r\n    box-sizing: border-box;\r\n    max-width: 100%;\r\n    /* padding-right: 40px; */\r\n  `;\r\n  const container = css`\r\n    width: 16px;\r\n    height: 16px;\r\n    display: inline-block;\r\n    margin-right: 10px;\r\n    position: relative;\r\n    vertical-align: middle;\r\n    overflow: hidden;\r\n  `;\r\n\r\n  const item = css`\r\n    width: 100%;\r\n    height: 100%;\r\n    position: absolute;\r\n  `;\r\n\r\n  return { singleValue, container, item };\r\n});\r\n\r\ntype Props = {\r\n  children: React.ReactNode;\r\n  data: {\r\n    imgUrl?: string;\r\n    loading?: boolean;\r\n    hideText?: boolean;\r\n  };\r\n};\r\n\r\nexport const SingleValue = (props: Props) => {\r\n  const { children, data } = props;\r\n  const theme = useTheme();\r\n  const styles = getStyles(theme);\r\n\r\n  const loading = useDelayedSwitch(data.loading || false, { delay: 250, duration: 750 });\r\n\r\n  return (\r\n    <components.SingleValue {...props}>\r\n      <div className={styles.singleValue}>\r\n        {data.imgUrl ? (\r\n          <FadeWithImage loading={loading} imgUrl={data.imgUrl} />\r\n        ) : (\r\n          <SlideOutTransition horizontal size={16} visible={loading} duration={150}>\r\n            <div className={styles.container}>\r\n              <Spinner className={styles.item} inline />\r\n            </div>\r\n          </SlideOutTransition>\r\n        )}\r\n        {!data.hideText && children}\r\n      </div>\r\n    </components.SingleValue>\r\n  );\r\n};\r\n\r\nconst FadeWithImage = (props: { loading: boolean; imgUrl: string }) => {\r\n  const theme = useTheme();\r\n  const styles = getStyles(theme);\r\n\r\n  return (\r\n    <div className={styles.container}>\r\n      <FadeTransition duration={150} visible={props.loading}>\r\n        <Spinner className={styles.item} inline />\r\n      </FadeTransition>\r\n      <FadeTransition duration={150} visible={!props.loading}>\r\n        <img className={styles.item} src={props.imgUrl} />\r\n      </FadeTransition>\r\n    </div>\r\n  );\r\n};\r\n","import React from 'react';\r\nimport { cx } from 'emotion';\r\nimport { useTheme } from '../../../themes/ThemeContext';\r\nimport { getSelectStyles } from './getSelectStyles';\r\n\r\nexport const ValueContainer = (props: any) => {\r\n  const theme = useTheme();\r\n  const styles = getSelectStyles(theme);\r\n  const { children, isMulti } = props;\r\n  return <div className={cx(styles.valueContainer, isMulti && styles.valueContainerMulti)}>{children}</div>;\r\n};\r\n","import { stylesFactory } from '../../../themes/stylesFactory';\r\nimport { selectThemeVariant as stv } from '../../../themes/selectThemeVariant';\r\nimport { css } from 'emotion';\r\nimport { GrafanaTheme } from '@grafana/data';\r\n\r\nexport const getSelectStyles = stylesFactory((theme: GrafanaTheme) => {\r\n  const bgColor = stv({ light: theme.colors.white, dark: theme.colors.gray15 }, theme.type);\r\n  const menuShadowColor = stv({ light: theme.colors.gray4, dark: theme.colors.black }, theme.type);\r\n  const optionBgHover = stv({ light: theme.colors.gray7, dark: theme.colors.gray10 }, theme.type);\r\n  const multiValueContainerBg = stv({ light: theme.colors.gray6, dark: theme.colors.gray05 }, theme.type);\r\n  const multiValueColor = stv({ light: theme.colors.gray25, dark: theme.colors.gray85 }, theme.type);\r\n\r\n  return {\r\n    menu: css`\r\n      background: ${bgColor};\r\n      box-shadow: 0px 4px 4px ${menuShadowColor};\r\n      position: absolute;\r\n      min-width: 100%;\r\n    `,\r\n    option: css`\r\n      padding: 8px;\r\n      display: flex;\r\n      justify-content: space-between;\r\n      align-items: center;\r\n      flex-direction: row;\r\n      white-space: nowrap;\r\n      cursor: pointer;\r\n      &:hover {\r\n        background: ${optionBgHover};\r\n      }\r\n    `,\r\n    optionFocused: css`\r\n      background: ${optionBgHover};\r\n      border-image: linear-gradient(#f05a28 30%, #fbca0a 99%);\r\n      border-image-slice: 1;\r\n      border-style: solid;\r\n      border-top: 0;\r\n      border-right: 0;\r\n      border-bottom: 0;\r\n      border-left-width: 2px;\r\n    `,\r\n    singleValue: css`\r\n      color: ${theme.colors.formInputText};\r\n      white-space: nowrap;\r\n      overflow: hidden;\r\n      text-overflow: ellipsis;\r\n      box-sizing: border-box;\r\n      max-width: 100%;\r\n    `,\r\n    valueContainer: css`\r\n      align-items: center;\r\n      display: flex;\r\n      position: relative;\r\n      box-sizing: border-box;\r\n      flex: 1 1 0%;\r\n      outline: none;\r\n      overflow: hidden;\r\n    `,\r\n    valueContainerMulti: css`\r\n      flex-wrap: wrap;\r\n    `,\r\n    loadingMessage: css`\r\n      padding: ${theme.spacing.sm};\r\n      text-align: center;\r\n      width: 100%;\r\n    `,\r\n    multiValueContainer: css`\r\n      display: flex;\r\n      align-items: center;\r\n      line-height: 1;\r\n      background: ${multiValueContainerBg};\r\n      border-radius: ${theme.border.radius.sm};\r\n      padding: ${theme.spacing.xs} ${theme.spacing.xxs} ${theme.spacing.xs} ${theme.spacing.sm};\r\n      margin: ${theme.spacing.xxs} ${theme.spacing.xs} ${theme.spacing.xxs} 0;\r\n      color: ${multiValueColor};\r\n    `,\r\n    multiValueRemove: css`\r\n      margin-left: ${theme.spacing.xs};\r\n    `,\r\n  };\r\n});\r\n","export default function resetSelectStyles() {\r\n  return {\r\n    clearIndicator: () => ({}),\r\n    container: () => ({}),\r\n    control: () => ({}),\r\n    dropdownIndicator: () => ({}),\r\n    group: () => ({}),\r\n    groupHeading: () => ({}),\r\n    indicatorsContainer: () => ({}),\r\n    indicatorSeparator: () => ({}),\r\n    input: () => ({}),\r\n    loadingIndicator: () => ({}),\r\n    loadingMessage: () => ({}),\r\n    menu: () => ({}),\r\n    menuList: ({ maxHeight }: { maxHeight: number }) => ({\r\n      maxHeight,\r\n    }),\r\n    multiValue: () => ({}),\r\n    multiValueLabel: () => ({}),\r\n    multiValueRemove: () => ({}),\r\n    noOptionsMessage: () => ({}),\r\n    option: () => ({}),\r\n    placeholder: () => ({}),\r\n    singleValue: () => ({}),\r\n    valueContainer: () => ({}),\r\n  };\r\n}\r\n","import React from 'react';\r\nimport { stylesFactory, useTheme } from '../../themes';\r\nimport { GrafanaTheme } from '@grafana/data';\r\nimport { css, cx } from 'emotion';\r\nimport { getFocusStyle } from './commonStyles';\r\n\r\nexport interface SwitchProps {\r\n  checked?: boolean;\r\n  disabled?: boolean;\r\n  onChange?: (e: React.SyntheticEvent<HTMLButtonElement>, checked: boolean) => void;\r\n}\r\n\r\nexport const getSwitchStyles = stylesFactory((theme: GrafanaTheme) => {\r\n  return {\r\n    slider: cx(\r\n      css`\r\n        width: 32px;\r\n        height: 16px;\r\n        background: ${theme.colors.formSwitchBg};\r\n        transition: all 0.30s ease;\r\n        border-radius: 50px;\r\n        position: relative;\r\n        border: none;\r\n        display: block;\r\n        padding: 0;\r\n        &:hover {\r\n          background: ${theme.colors.formSwitchBgHover};\r\n        }\r\n        &:after {\r\n          content: '';\r\n          transition: transform 0.2s cubic-bezier(0.19, 1, 0.22, 1);\r\n          position: absolute;\r\n          top: 50%;\r\n          display: block;\r\n          width: 12px;\r\n          height: 12px;\r\n          background: ${theme.colors.formSwitchDot};\r\n          border-radius: 6px;\r\n          transform: translate3d(2px, -50%, 0);\r\n        }\r\n        &:focus {\r\n          /* border: 1px solid ${theme.colors.formSwitchDot}; */\r\n        }\r\n        &[disabled] {\r\n          background: ${theme.colors.formSwitchBgDisabled};\r\n        }\r\n      `,\r\n      getFocusStyle(theme)\r\n    ),\r\n    sliderActive: css`\r\n      background: ${theme.colors.formSwitchBgActive};\r\n      &:hover {\r\n        background: ${theme.colors.formSwitchBgActiveHover};\r\n      }\r\n      &:after {\r\n        transform: translate3d(16px, -50%, 0);\r\n      }\r\n    `,\r\n  };\r\n});\r\nexport const Switch: React.FC<SwitchProps> = ({ checked = false, disabled = false, onChange }) => {\r\n  const theme = useTheme();\r\n  const styles = getSwitchStyles(theme);\r\n\r\n  return (\r\n    <button\r\n      type=\"button\"\r\n      role=\"switch\"\r\n      aria-checked={!!checked}\r\n      disabled={disabled}\r\n      className={cx(styles.slider, checked && styles.sliderActive)}\r\n      onClick={e => {\r\n        if (onChange) {\r\n          onChange(e, !!!checked);\r\n        }\r\n      }}\r\n    />\r\n  );\r\n};\r\n","import { css } from 'emotion';\r\nimport { GrafanaTheme } from '@grafana/data';\r\nimport { ButtonSize } from '../Button/types';\r\n\r\nexport const getFocusCss = (theme: GrafanaTheme) => `\r\n  outline: 2px dotted transparent;\r\n  outline-offset: 2px;\r\n  box-shadow: 0 0 0 2px ${theme.colors.pageBg}, 0 0 0px 4px ${theme.colors.formFocusOutline};\r\n  transition: all 0.2s cubic-bezier(0.19, 1, 0.22, 1);\r\n`;\r\n\r\nexport const getFocusStyle = (theme: GrafanaTheme) => css`\r\n  &:focus {\r\n    ${getFocusCss(theme)}\r\n  }\r\n`;\r\n\r\nexport const sharedInputStyle = (theme: GrafanaTheme, invalid = false) => {\r\n  const colors = theme.colors;\r\n  const borderColor = invalid ? colors.redBase : colors.formInputBorder;\r\n\r\n  return css`\r\n    background-color: ${colors.formInputBg};\r\n    line-height: ${theme.typography.lineHeight.md};\r\n    font-size: ${theme.typography.size.md};\r\n    color: ${colors.formInputText};\r\n    border: 1px solid ${borderColor};\r\n    padding: 0 ${theme.spacing.sm} 0 ${theme.spacing.sm};\r\n\r\n    &:hover {\r\n      border-color: ${borderColor};\r\n    }\r\n\r\n    &:focus {\r\n      outline: none;\r\n    }\r\n\r\n    &:disabled {\r\n      background-color: ${colors.formInputBgDisabled};\r\n      color: ${colors.formInputDisabledText};\r\n    }\r\n  `;\r\n};\r\n\r\nexport const inputSizes = () => {\r\n  return {\r\n    sm: css`\r\n      width: 200px;\r\n    `,\r\n    md: css`\r\n      width: 320px;\r\n    `,\r\n    lg: css`\r\n      width: 580px;\r\n    `,\r\n    auto: css`\r\n      width: auto;\r\n    `,\r\n  };\r\n};\r\n\r\nexport const getPropertiesForButtonSize = (theme: GrafanaTheme, size: ButtonSize) => {\r\n  switch (size) {\r\n    case 'sm':\r\n      return {\r\n        padding: `0 ${theme.spacing.sm}`,\r\n        fontSize: theme.typography.size.sm,\r\n        height: theme.height.sm,\r\n      };\r\n\r\n    case 'md':\r\n      return {\r\n        padding: `0 ${theme.spacing.md}`,\r\n        fontSize: theme.typography.size.md,\r\n        height: `${theme.spacing.formButtonHeight}px`,\r\n      };\r\n\r\n    case 'lg':\r\n      return {\r\n        padding: `0 ${theme.spacing.lg}`,\r\n        fontSize: theme.typography.size.lg,\r\n        height: theme.height.lg,\r\n      };\r\n\r\n    default:\r\n      return {\r\n        padding: `0 ${theme.spacing.md}`,\r\n        fontSize: theme.typography.size.base,\r\n        height: theme.height.md,\r\n      };\r\n  }\r\n};\r\n","import { stylesFactory } from '../../themes';\r\nimport { GrafanaTheme } from '@grafana/data';\r\nimport { getLabelStyles } from './Label';\r\nimport { getLegendStyles } from './Legend';\r\nimport { getFieldValidationMessageStyles } from './FieldValidationMessage';\r\nimport { getButtonStyles, ButtonVariant } from './Button';\r\nimport { ButtonSize } from '../Button/types';\r\nimport { getInputStyles } from './Input/Input';\r\nimport { getSwitchStyles } from './Switch';\r\nimport { getCheckboxStyles } from './Checkbox';\r\n\r\nexport const getFormStyles = stylesFactory(\r\n  (theme: GrafanaTheme, options: { variant: ButtonVariant; size: ButtonSize; invalid: boolean }) => {\r\n    return {\r\n      label: getLabelStyles(theme),\r\n      legend: getLegendStyles(theme),\r\n      fieldValidationMessage: getFieldValidationMessageStyles(theme),\r\n      button: getButtonStyles({\r\n        theme,\r\n        variant: options.variant,\r\n        size: options.size,\r\n      }),\r\n      input: getInputStyles({ theme, invalid: options.invalid }),\r\n      switch: getSwitchStyles(theme),\r\n      checkbox: getCheckboxStyles(theme),\r\n    };\r\n  }\r\n);\r\n","import { getFormStyles } from './getFormStyles';\r\nimport { Label } from './Label';\r\nimport { Input } from './Input/Input';\r\nimport { Select } from './Select/Select';\r\nimport { Form } from './Form';\r\nimport { Field } from './Field';\r\nimport { Button, LinkButton } from './Button';\r\n\r\nconst Forms = {\r\n  getFormStyles,\r\n  Label,\r\n  Input,\r\n  Form,\r\n  Field,\r\n  Button,\r\n  LinkButton,\r\n  Select,\r\n};\r\n\r\nexport default Forms;\r\n","import React, { PureComponent } from 'react';\r\nimport $ from 'jquery';\r\nimport {\r\n  DisplayValue,\r\n  getColorFromHexRgbOrName,\r\n  formattedValueToString,\r\n  FieldConfig,\r\n  ThresholdsMode,\r\n  getActiveThreshold,\r\n  Threshold,\r\n} from '@grafana/data';\r\nimport { Themeable } from '../../types';\r\nimport { selectThemeVariant } from '../../themes';\r\n\r\nexport interface Props extends Themeable {\r\n  height: number;\r\n  field: FieldConfig;\r\n  showThresholdMarkers: boolean;\r\n  showThresholdLabels: boolean;\r\n  width: number;\r\n  value: DisplayValue;\r\n  onClick?: React.MouseEventHandler<HTMLElement>;\r\n  className?: string;\r\n}\r\n\r\nconst FONT_SCALE = 1;\r\n\r\nexport class Gauge extends PureComponent<Props> {\r\n  canvasElement: any;\r\n\r\n  static defaultProps: Partial<Props> = {\r\n    showThresholdMarkers: true,\r\n    showThresholdLabels: false,\r\n    field: {\r\n      min: 0,\r\n      max: 100,\r\n      thresholds: {\r\n        mode: ThresholdsMode.Absolute,\r\n        steps: [\r\n          { value: -Infinity, color: 'green' },\r\n          { value: 80, color: 'red' },\r\n        ],\r\n      },\r\n    },\r\n  };\r\n\r\n  componentDidMount() {\r\n    this.draw();\r\n  }\r\n\r\n  componentDidUpdate() {\r\n    this.draw();\r\n  }\r\n\r\n  getFormattedThresholds(): Threshold[] {\r\n    const { field, theme } = this.props;\r\n    const isPercent = field.thresholds?.mode === ThresholdsMode.Percentage;\r\n    const steps = field.thresholds!.steps;\r\n    let min = field.min!;\r\n    let max = field.max!;\r\n    if (isPercent) {\r\n      min = 0;\r\n      max = 100;\r\n    }\r\n\r\n    const first = getActiveThreshold(min, steps);\r\n    const last = getActiveThreshold(max, steps);\r\n    const formatted: Threshold[] = [];\r\n    formatted.push({ value: min, color: getColorFromHexRgbOrName(first.color, theme.type) });\r\n    let skip = true;\r\n    for (let i = 0; i < steps.length; i++) {\r\n      const step = steps[i];\r\n      if (skip) {\r\n        if (first === step) {\r\n          skip = false;\r\n        }\r\n        continue;\r\n      }\r\n      const prev = steps[i - 1];\r\n      formatted.push({ value: step.value, color: getColorFromHexRgbOrName(prev!.color, theme.type) });\r\n      if (step === last) {\r\n        break;\r\n      }\r\n    }\r\n    formatted.push({ value: max, color: getColorFromHexRgbOrName(last.color, theme.type) });\r\n    return formatted;\r\n  }\r\n\r\n  getFontScale(length: number): number {\r\n    if (length > 12) {\r\n      return FONT_SCALE - (length * 5) / 110;\r\n    }\r\n    return FONT_SCALE - (length * 5) / 101;\r\n  }\r\n\r\n  draw() {\r\n    const { field, showThresholdLabels, showThresholdMarkers, width, height, theme, value } = this.props;\r\n\r\n    const autoProps = calculateGaugeAutoProps(width, height, value.title);\r\n    const dimension = Math.min(width, autoProps.gaugeHeight);\r\n\r\n    const backgroundColor = selectThemeVariant(\r\n      {\r\n        dark: theme.colors.dark8,\r\n        light: theme.colors.gray6,\r\n      },\r\n      theme.type\r\n    );\r\n\r\n    const gaugeWidthReduceRatio = showThresholdLabels ? 1.5 : 1;\r\n    const gaugeWidth = Math.min(dimension / 5.5, 40) / gaugeWidthReduceRatio;\r\n    const thresholdMarkersWidth = gaugeWidth / 5;\r\n    const text = formattedValueToString(value);\r\n    const fontSize = Math.min(dimension / 4, 100) * (text !== null ? this.getFontScale(text.length) : 1);\r\n\r\n    const thresholdLabelFontSize = fontSize / 2.5;\r\n\r\n    let min = field.min!;\r\n    let max = field.max!;\r\n    let numeric = value.numeric;\r\n    if (field.thresholds?.mode === ThresholdsMode.Percentage) {\r\n      min = 0;\r\n      max = 100;\r\n      if (value.percent === undefined) {\r\n        numeric = ((numeric - min) / (max - min)) * 100;\r\n      } else {\r\n        numeric = value.percent! * 100;\r\n      }\r\n    }\r\n\r\n    const options: any = {\r\n      series: {\r\n        gauges: {\r\n          gauge: {\r\n            min,\r\n            max,\r\n            background: { color: backgroundColor },\r\n            border: { color: null },\r\n            shadow: { show: false },\r\n            width: gaugeWidth,\r\n          },\r\n          frame: { show: false },\r\n          label: { show: false },\r\n          layout: { margin: 0, thresholdWidth: 0, vMargin: 0 },\r\n          cell: { border: { width: 0 } },\r\n          threshold: {\r\n            values: this.getFormattedThresholds(),\r\n            label: {\r\n              show: showThresholdLabels,\r\n              margin: thresholdMarkersWidth + 1,\r\n              font: { size: thresholdLabelFontSize },\r\n            },\r\n            show: showThresholdMarkers,\r\n            width: thresholdMarkersWidth,\r\n          },\r\n          value: {\r\n            color: value.color,\r\n            formatter: () => {\r\n              return text;\r\n            },\r\n            font: { size: fontSize, family: theme.typography.fontFamily.sansSerif },\r\n          },\r\n          show: true,\r\n        },\r\n      },\r\n    };\r\n\r\n    const plotSeries = {\r\n      data: [[0, numeric]],\r\n      label: value.title,\r\n    };\r\n\r\n    try {\r\n      $.plot(this.canvasElement, [plotSeries], options);\r\n    } catch (err) {\r\n      console.log('Gauge rendering error', err, options, value);\r\n    }\r\n  }\r\n\r\n  renderVisualization = () => {\r\n    const { width, value, height, onClick } = this.props;\r\n    const autoProps = calculateGaugeAutoProps(width, height, value.title);\r\n\r\n    return (\r\n      <>\r\n        <div\r\n          style={{ height: `${autoProps.gaugeHeight}px`, width: '100%' }}\r\n          ref={element => (this.canvasElement = element)}\r\n          onClick={onClick}\r\n        />\r\n        {autoProps.showLabel && (\r\n          <div\r\n            style={{\r\n              textAlign: 'center',\r\n              fontSize: autoProps.titleFontSize,\r\n              overflow: 'hidden',\r\n              textOverflow: 'ellipsis',\r\n              whiteSpace: 'nowrap',\r\n              position: 'relative',\r\n              width: '100%',\r\n              top: '-4px',\r\n              cursor: 'default',\r\n            }}\r\n          >\r\n            {value.title}\r\n          </div>\r\n        )}\r\n      </>\r\n    );\r\n  };\r\n\r\n  render() {\r\n    return (\r\n      <div\r\n        style={{\r\n          width: '100%',\r\n          height: '100%',\r\n          display: 'flex',\r\n          flexDirection: 'column',\r\n          justifyContent: 'center',\r\n          overflow: 'hidden',\r\n        }}\r\n        className={this.props.className}\r\n      >\r\n        {this.renderVisualization()}\r\n      </div>\r\n    );\r\n  }\r\n}\r\n\r\ninterface GaugeAutoProps {\r\n  titleFontSize: number;\r\n  gaugeHeight: number;\r\n  showLabel: boolean;\r\n}\r\n\r\nfunction calculateGaugeAutoProps(width: number, height: number, title: string | undefined): GaugeAutoProps {\r\n  const showLabel = title !== null && title !== undefined;\r\n  const titleFontSize = Math.min((width * 0.15) / 1.5, 20); // 20% of height * line-height, max 40px\r\n  const titleHeight = titleFontSize * 1.5;\r\n  const availableHeight = showLabel ? height - titleHeight : height;\r\n  const gaugeHeight = Math.min(availableHeight, width);\r\n\r\n  return {\r\n    showLabel,\r\n    gaugeHeight,\r\n    titleFontSize,\r\n  };\r\n}\r\n","// Libraries\r\nimport $ from 'jquery';\r\nimport React, { PureComponent } from 'react';\r\nimport uniqBy from 'lodash/uniqBy';\r\n// Types\r\nimport {\r\n  TimeRange,\r\n  GraphSeriesXY,\r\n  TimeZone,\r\n  DefaultTimeZone,\r\n  createDimension,\r\n  DateTimeInput,\r\n  dateTime,\r\n} from '@grafana/data';\r\nimport _ from 'lodash';\r\nimport { FlotPosition, FlotItem } from './types';\r\nimport { TooltipProps, TooltipContentProps, ActiveDimensions, Tooltip } from '../Chart/Tooltip';\r\nimport { GraphTooltip } from './GraphTooltip/GraphTooltip';\r\nimport { GraphContextMenu, GraphContextMenuProps, ContextDimensions } from './GraphContextMenu';\r\nimport { GraphDimensions } from './GraphTooltip/types';\r\n\r\nexport interface GraphProps {\r\n  children?: JSX.Element | JSX.Element[];\r\n  series: GraphSeriesXY[];\r\n  timeRange: TimeRange; // NOTE: we should aim to make `time` a property of the axis, not force it for all graphs\r\n  timeZone?: TimeZone; // NOTE: we should aim to make `time` a property of the axis, not force it for all graphs\r\n  showLines?: boolean;\r\n  showPoints?: boolean;\r\n  showBars?: boolean;\r\n  width: number;\r\n  height: number;\r\n  isStacked?: boolean;\r\n  lineWidth?: number;\r\n  onHorizontalRegionSelected?: (from: number, to: number) => void;\r\n}\r\n\r\ninterface GraphState {\r\n  pos?: FlotPosition;\r\n  contextPos?: FlotPosition;\r\n  isTooltipVisible: boolean;\r\n  isContextVisible: boolean;\r\n  activeItem?: FlotItem<GraphSeriesXY>;\r\n  contextItem?: FlotItem<GraphSeriesXY>;\r\n}\r\n\r\nexport class Graph extends PureComponent<GraphProps, GraphState> {\r\n  static defaultProps = {\r\n    showLines: true,\r\n    showPoints: false,\r\n    showBars: false,\r\n    isStacked: false,\r\n    lineWidth: 1,\r\n  };\r\n\r\n  state: GraphState = {\r\n    isTooltipVisible: false,\r\n    isContextVisible: false,\r\n  };\r\n\r\n  element: HTMLElement | null = null;\r\n  $element: any;\r\n\r\n  componentDidUpdate(prevProps: GraphProps, prevState: GraphState) {\r\n    if (prevProps !== this.props) {\r\n      this.draw();\r\n    }\r\n  }\r\n\r\n  componentDidMount() {\r\n    this.draw();\r\n    if (this.element) {\r\n      this.$element = $(this.element);\r\n      this.$element.bind('plotselected', this.onPlotSelected);\r\n      this.$element.bind('plothover', this.onPlotHover);\r\n      this.$element.bind('plotclick', this.onPlotClick);\r\n    }\r\n  }\r\n\r\n  componentWillUnmount() {\r\n    this.$element.unbind('plotselected', this.onPlotSelected);\r\n  }\r\n\r\n  onPlotSelected = (event: JQueryEventObject, ranges: { xaxis: { from: number; to: number } }) => {\r\n    const { onHorizontalRegionSelected } = this.props;\r\n    if (onHorizontalRegionSelected) {\r\n      onHorizontalRegionSelected(ranges.xaxis.from, ranges.xaxis.to);\r\n    }\r\n  };\r\n\r\n  onPlotHover = (event: JQueryEventObject, pos: FlotPosition, item?: FlotItem<GraphSeriesXY>) => {\r\n    this.setState({\r\n      isTooltipVisible: true,\r\n      activeItem: item,\r\n      pos,\r\n    });\r\n  };\r\n\r\n  onPlotClick = (event: JQueryEventObject, contextPos: FlotPosition, item?: FlotItem<GraphSeriesXY>) => {\r\n    this.setState({\r\n      isContextVisible: true,\r\n      isTooltipVisible: false,\r\n      contextItem: item,\r\n      contextPos,\r\n    });\r\n  };\r\n\r\n  getYAxes(series: GraphSeriesXY[]) {\r\n    if (series.length === 0) {\r\n      return [{ show: true, min: -1, max: 1 }];\r\n    }\r\n    return uniqBy(\r\n      series.map(s => {\r\n        const index = s.yAxis ? s.yAxis.index : 1;\r\n        const min = s.yAxis && !isNaN(s.yAxis.min as number) ? s.yAxis.min : null;\r\n        const tickDecimals = s.yAxis && !isNaN(s.yAxis.tickDecimals as number) ? s.yAxis.tickDecimals : null;\r\n        return {\r\n          show: true,\r\n          index,\r\n          position: index === 1 ? 'left' : 'right',\r\n          min,\r\n          tickDecimals,\r\n        };\r\n      }),\r\n      yAxisConfig => yAxisConfig.index\r\n    );\r\n  }\r\n\r\n  renderTooltip = () => {\r\n    const { children, series } = this.props;\r\n    const { pos, activeItem, isTooltipVisible } = this.state;\r\n    let tooltipElement: React.ReactElement<TooltipProps> | null = null;\r\n\r\n    if (!isTooltipVisible || !pos || series.length === 0) {\r\n      return null;\r\n    }\r\n\r\n    // Find children that indicate tooltip to be rendered\r\n    React.Children.forEach(children, c => {\r\n      // We have already found tooltip\r\n      if (tooltipElement) {\r\n        return;\r\n      }\r\n      // @ts-ignore\r\n      const childType = c && c.type && (c.type.displayName || c.type.name);\r\n\r\n      if (childType === Tooltip.displayName) {\r\n        tooltipElement = c as React.ReactElement<TooltipProps>;\r\n      }\r\n    });\r\n    // If no tooltip provided, skip rendering\r\n    if (!tooltipElement) {\r\n      return null;\r\n    }\r\n    const tooltipElementProps = (tooltipElement as React.ReactElement<TooltipProps>).props;\r\n\r\n    const tooltipMode = tooltipElementProps.mode || 'single';\r\n\r\n    // If mode is single series and user is not hovering over item, skip rendering\r\n    if (!activeItem && tooltipMode === 'single') {\r\n      return null;\r\n    }\r\n\r\n    // Check if tooltip needs to be rendered with custom tooltip component, otherwise default to GraphTooltip\r\n    const tooltipContentRenderer = tooltipElementProps.tooltipComponent || GraphTooltip;\r\n    // Indicates column(field) index in y-axis dimension\r\n    const seriesIndex = activeItem ? activeItem.series.seriesIndex : 0;\r\n    // Indicates row index in active field values\r\n    const rowIndex = activeItem ? activeItem.dataIndex : undefined;\r\n\r\n    const activeDimensions: ActiveDimensions<GraphDimensions> = {\r\n      // Described x-axis active item\r\n      // When hovering over an item - let's take it's dataIndex, otherwise undefined\r\n      // Tooltip itself needs to figure out correct datapoint display information based on pos passed to it\r\n      xAxis: [seriesIndex, rowIndex],\r\n      // Describes y-axis active item\r\n      yAxis: activeItem ? [activeItem.series.seriesIndex, activeItem.dataIndex] : null,\r\n    };\r\n\r\n    const tooltipContentProps: TooltipContentProps<GraphDimensions> = {\r\n      dimensions: {\r\n        // time/value dimension columns are index-aligned - see getGraphSeriesModel\r\n        xAxis: createDimension(\r\n          'xAxis',\r\n          series.map(s => s.timeField)\r\n        ),\r\n        yAxis: createDimension(\r\n          'yAxis',\r\n          series.map(s => s.valueField)\r\n        ),\r\n      },\r\n      activeDimensions,\r\n      pos,\r\n      mode: tooltipElementProps.mode || 'single',\r\n    };\r\n\r\n    const tooltipContent = React.createElement(tooltipContentRenderer, { ...tooltipContentProps });\r\n\r\n    return React.cloneElement<TooltipProps>(tooltipElement as React.ReactElement<TooltipProps>, {\r\n      content: tooltipContent,\r\n      position: { x: pos.pageX, y: pos.pageY },\r\n      offset: { x: 10, y: 10 },\r\n    });\r\n  };\r\n\r\n  renderContextMenu = () => {\r\n    const { series } = this.props;\r\n    const { contextPos, contextItem, isContextVisible } = this.state;\r\n\r\n    if (!isContextVisible || !contextPos || !contextItem || series.length === 0) {\r\n      return null;\r\n    }\r\n\r\n    // Indicates column(field) index in y-axis dimension\r\n    const seriesIndex = contextItem ? contextItem.series.seriesIndex : 0;\r\n    // Indicates row index in context field values\r\n    const rowIndex = contextItem ? contextItem.dataIndex : undefined;\r\n\r\n    const contextDimensions: ContextDimensions<GraphDimensions> = {\r\n      // Described x-axis context item\r\n      xAxis: [seriesIndex, rowIndex],\r\n      // Describes y-axis context item\r\n      yAxis: contextItem ? [contextItem.series.seriesIndex, contextItem.dataIndex] : null,\r\n    };\r\n\r\n    const dimensions: GraphDimensions = {\r\n      // time/value dimension columns are index-aligned - see getGraphSeriesModel\r\n      xAxis: createDimension(\r\n        'xAxis',\r\n        series.map(s => s.timeField)\r\n      ),\r\n      yAxis: createDimension(\r\n        'yAxis',\r\n        series.map(s => s.valueField)\r\n      ),\r\n    };\r\n\r\n    const formatDate = (date: DateTimeInput, format?: string) => {\r\n      return dateTime(date)?.format(format);\r\n    };\r\n\r\n    const closeContext = () => this.setState({ isContextVisible: false });\r\n\r\n    const getContextMenuSource = () => {\r\n      return {\r\n        datapoint: contextItem.datapoint,\r\n        dataIndex: contextItem.dataIndex,\r\n        series: contextItem.series,\r\n        seriesIndex: contextItem.series.seriesIndex,\r\n        pageX: contextPos.pageX,\r\n        pageY: contextPos.pageY,\r\n      };\r\n    };\r\n\r\n    const contextContentProps: GraphContextMenuProps = {\r\n      x: contextPos.pageX,\r\n      y: contextPos.pageY,\r\n      onClose: closeContext,\r\n      getContextMenuSource: getContextMenuSource,\r\n      formatSourceDate: formatDate,\r\n      dimensions,\r\n      contextDimensions,\r\n    };\r\n\r\n    return <GraphContextMenu {...contextContentProps} />;\r\n  };\r\n\r\n  getBarWidth = () => {\r\n    const { series } = this.props;\r\n    return Math.min(...series.map(s => s.timeStep));\r\n  };\r\n\r\n  draw() {\r\n    if (this.element === null) {\r\n      return;\r\n    }\r\n\r\n    const {\r\n      width,\r\n      series,\r\n      timeRange,\r\n      showLines,\r\n      showBars,\r\n      showPoints,\r\n      isStacked,\r\n      lineWidth,\r\n      timeZone,\r\n      onHorizontalRegionSelected,\r\n    } = this.props;\r\n\r\n    if (!width) {\r\n      return;\r\n    }\r\n\r\n    const ticks = width / 100;\r\n    const min = timeRange.from.valueOf();\r\n    const max = timeRange.to.valueOf();\r\n    const yaxes = this.getYAxes(series);\r\n\r\n    const flotOptions: any = {\r\n      legend: {\r\n        show: false,\r\n      },\r\n      series: {\r\n        stack: isStacked,\r\n        lines: {\r\n          show: showLines,\r\n          linewidth: lineWidth,\r\n          zero: false,\r\n        },\r\n        points: {\r\n          show: showPoints,\r\n          fill: 1,\r\n          fillColor: false,\r\n          radius: 2,\r\n        },\r\n        bars: {\r\n          show: showBars,\r\n          fill: 1,\r\n          // Dividig the width by 1.5 to make the bars not touch each other\r\n          barWidth: showBars ? this.getBarWidth() / 1.5 : 1,\r\n          zero: false,\r\n          lineWidth: lineWidth,\r\n        },\r\n        shadowSize: 0,\r\n      },\r\n      xaxis: {\r\n        show: true,\r\n        mode: 'time',\r\n        min: min,\r\n        max: max,\r\n        label: 'Datetime',\r\n        ticks: ticks,\r\n        timeformat: timeFormat(ticks, min, max),\r\n        timezone: timeZone ?? DefaultTimeZone,\r\n      },\r\n      yaxes,\r\n      grid: {\r\n        minBorderMargin: 0,\r\n        markings: [],\r\n        backgroundColor: null,\r\n        borderWidth: 0,\r\n        hoverable: true,\r\n        clickable: true,\r\n        color: '#a1a1a1',\r\n        margin: { left: 0, right: 0 },\r\n        labelMarginX: 0,\r\n        mouseActiveRadius: 30,\r\n      },\r\n      selection: {\r\n        mode: onHorizontalRegionSelected ? 'x' : null,\r\n        color: '#666',\r\n      },\r\n      crosshair: {\r\n        mode: 'x',\r\n      },\r\n    };\r\n\r\n    try {\r\n      $.plot(\r\n        this.element,\r\n        series.filter(s => s.isVisible),\r\n        flotOptions\r\n      );\r\n    } catch (err) {\r\n      console.log('Graph rendering error', err, flotOptions, series);\r\n      throw new Error('Error rendering panel');\r\n    }\r\n  }\r\n\r\n  render() {\r\n    const { height, width, series } = this.props;\r\n    const noDataToBeDisplayed = series.length === 0;\r\n    const tooltip = this.renderTooltip();\r\n    const context = this.renderContextMenu();\r\n    return (\r\n      <div className=\"graph-panel\">\r\n        <div\r\n          className=\"graph-panel__chart\"\r\n          ref={e => (this.element = e)}\r\n          style={{ height, width }}\r\n          onMouseLeave={() => {\r\n            this.setState({ isTooltipVisible: false });\r\n          }}\r\n        />\r\n        {noDataToBeDisplayed && <div className=\"datapoints-warning\">No data</div>}\r\n        {tooltip}\r\n        {context}\r\n      </div>\r\n    );\r\n  }\r\n}\r\n\r\n// Copied from graph.ts\r\nfunction timeFormat(ticks: number, min: number, max: number): string {\r\n  if (min && max && ticks) {\r\n    const range = max - min;\r\n    const secPerTick = range / ticks / 1000;\r\n    const oneDay = 86400000;\r\n    const oneYear = 31536000000;\r\n\r\n    if (secPerTick <= 45) {\r\n      return '%H:%M:%S';\r\n    }\r\n    if (secPerTick <= 7200 || range <= oneDay) {\r\n      return '%H:%M';\r\n    }\r\n    if (secPerTick <= 80000) {\r\n      return '%m/%d %H:%M';\r\n    }\r\n    if (secPerTick <= 2419200 || range <= oneYear) {\r\n      return '%m/%d';\r\n    }\r\n    return '%Y-%m';\r\n  }\r\n\r\n  return '%H:%M';\r\n}\r\n\r\nexport default Graph;\r\n","import React, { useContext } from 'react';\r\nimport { ContextMenu, ContextMenuProps } from '../ContextMenu/ContextMenu';\r\nimport { ThemeContext } from '../../themes';\r\nimport { SeriesIcon } from '../Legend/SeriesIcon';\r\nimport { GraphDimensions } from './GraphTooltip/types';\r\nimport {\r\n  DateTimeInput,\r\n  FlotDataPoint,\r\n  getValueFromDimension,\r\n  getDisplayProcessor,\r\n  formattedValueToString,\r\n  Dimensions,\r\n  MS_DATE_TIME_FORMAT,\r\n  DEFAULT_DATE_TIME_FORMAT,\r\n} from '@grafana/data';\r\nimport { css } from 'emotion';\r\n\r\nexport type ContextDimensions<T extends Dimensions = any> = { [key in keyof T]: [number, number | undefined] | null };\r\n\r\nexport type GraphContextMenuProps = ContextMenuProps & {\r\n  getContextMenuSource: () => FlotDataPoint | null;\r\n  formatSourceDate: (date: DateTimeInput, format?: string) => string;\r\n  dimensions?: GraphDimensions;\r\n  contextDimensions?: ContextDimensions;\r\n};\r\n\r\nexport const GraphContextMenu: React.FC<GraphContextMenuProps> = ({\r\n  getContextMenuSource,\r\n  formatSourceDate,\r\n  items,\r\n  dimensions,\r\n  contextDimensions,\r\n  ...otherProps\r\n}) => {\r\n  const theme = useContext(ThemeContext);\r\n  const source = getContextMenuSource();\r\n\r\n  //  Do not render items that do not have label specified\r\n  const itemsToRender = items\r\n    ? items.map(group => ({\r\n        ...group,\r\n        items: group.items.filter(item => item.label),\r\n      }))\r\n    : [];\r\n\r\n  const renderHeader = () => {\r\n    if (!source) {\r\n      return null;\r\n    }\r\n\r\n    // If dimensions supplied, we can calculate and display value\r\n    let value;\r\n    if (dimensions?.yAxis && contextDimensions?.yAxis?.[1]) {\r\n      const valueFromDimensions = getValueFromDimension(\r\n        dimensions.yAxis,\r\n        contextDimensions.yAxis[0],\r\n        contextDimensions.yAxis[1]\r\n      );\r\n      const display = source.series.valueField.display ?? getDisplayProcessor({ field: source.series.valueField });\r\n      value = display(valueFromDimensions);\r\n    }\r\n\r\n    const timeFormat = source.series.hasMsResolution ? MS_DATE_TIME_FORMAT : DEFAULT_DATE_TIME_FORMAT;\r\n    return (\r\n      <div\r\n        className={css`\r\n          padding: ${theme.spacing.xs} ${theme.spacing.sm};\r\n          font-size: ${theme.typography.size.sm};\r\n          z-index: ${theme.zIndex.tooltip};\r\n        `}\r\n      >\r\n        <strong>{formatSourceDate(source.datapoint[0], timeFormat)}</strong>\r\n        <div>\r\n          <SeriesIcon color={source.series.color} />\r\n          <span\r\n            className={css`\r\n              white-space: nowrap;\r\n              padding-left: ${theme.spacing.xs};\r\n            `}\r\n          >\r\n            {source.series.alias || source.series.label}\r\n          </span>\r\n          {value && (\r\n            <span\r\n              className={css`\r\n                white-space: nowrap;\r\n                padding-left: ${theme.spacing.md};\r\n              `}\r\n            >\r\n              {formattedValueToString(value)}\r\n            </span>\r\n          )}\r\n        </div>\r\n      </div>\r\n    );\r\n  };\r\n\r\n  return <ContextMenu {...otherProps} items={itemsToRender} renderHeader={renderHeader} />;\r\n};\r\n","import React, { useContext } from 'react';\r\nimport { LegendProps, LegendItem, LegendDisplayMode } from '../Legend/Legend';\r\nimport { GraphLegendListItem, GraphLegendTableRow } from './GraphLegendItem';\r\nimport { SeriesColorChangeHandler, SeriesAxisToggleHandler } from './GraphWithLegend';\r\nimport { LegendTable } from '../Legend/LegendTable';\r\nimport { LegendList } from '../Legend/LegendList';\r\nimport union from 'lodash/union';\r\nimport sortBy from 'lodash/sortBy';\r\nimport { ThemeContext } from '../../themes/ThemeContext';\r\nimport { css } from 'emotion';\r\nimport { selectThemeVariant } from '../../themes/index';\r\n\r\ninterface GraphLegendProps extends LegendProps {\r\n  displayMode: LegendDisplayMode;\r\n  sortBy?: string;\r\n  sortDesc?: boolean;\r\n  onSeriesColorChange?: SeriesColorChangeHandler;\r\n  onSeriesAxisToggle?: SeriesAxisToggleHandler;\r\n  onToggleSort?: (sortBy: string) => void;\r\n  onLabelClick?: (item: LegendItem, event: React.MouseEvent<HTMLElement>) => void;\r\n}\r\n\r\nexport const GraphLegend: React.FunctionComponent<GraphLegendProps> = ({\r\n  items,\r\n  displayMode,\r\n  sortBy: sortKey,\r\n  sortDesc,\r\n  onToggleSort,\r\n  onSeriesAxisToggle,\r\n  placement,\r\n  className,\r\n  ...graphLegendItemProps\r\n}) => {\r\n  const theme = useContext(ThemeContext);\r\n\r\n  if (displayMode === LegendDisplayMode.Table) {\r\n    const columns = items\r\n      .map(item => {\r\n        if (item.displayValues) {\r\n          return item.displayValues.map(i => i.title);\r\n        }\r\n        return [];\r\n      })\r\n      .reduce(\r\n        (acc, current) => {\r\n          return union(\r\n            acc,\r\n            current.filter(item => !!item)\r\n          );\r\n        },\r\n        ['']\r\n      ) as string[];\r\n\r\n    const sortedItems = sortKey\r\n      ? sortBy(items, item => {\r\n          if (item.displayValues) {\r\n            const stat = item.displayValues.filter(stat => stat.title === sortKey)[0];\r\n            return stat && stat.numeric;\r\n          }\r\n          return undefined;\r\n        })\r\n      : items;\r\n\r\n    const legendTableEvenRowBackground = selectThemeVariant(\r\n      {\r\n        dark: theme.colors.dark6,\r\n        light: theme.colors.gray5,\r\n      },\r\n      theme.type\r\n    );\r\n\r\n    return (\r\n      <LegendTable\r\n        className={css`\r\n          font-size: ${theme.typography.size.sm};\r\n          th {\r\n            padding: ${theme.spacing.xxs} ${theme.spacing.sm};\r\n          }\r\n        `}\r\n        items={sortDesc ? sortedItems.reverse() : sortedItems}\r\n        columns={columns}\r\n        placement={placement}\r\n        sortBy={sortKey}\r\n        sortDesc={sortDesc}\r\n        itemRenderer={(item, index) => (\r\n          <GraphLegendTableRow\r\n            key={`${item.label}-${index}`}\r\n            item={item}\r\n            onToggleAxis={() => {\r\n              if (onSeriesAxisToggle) {\r\n                onSeriesAxisToggle(item.label, item.yAxis === 1 ? 2 : 1);\r\n              }\r\n            }}\r\n            className={css`\r\n              background: ${index % 2 === 0 ? legendTableEvenRowBackground : 'none'};\r\n            `}\r\n            {...graphLegendItemProps}\r\n          />\r\n        )}\r\n        onToggleSort={onToggleSort}\r\n      />\r\n    );\r\n  }\r\n  return (\r\n    <LegendList\r\n      items={items}\r\n      placement={placement}\r\n      itemRenderer={item => (\r\n        <GraphLegendListItem\r\n          item={item}\r\n          onToggleAxis={() => {\r\n            if (onSeriesAxisToggle) {\r\n              onSeriesAxisToggle(item.label, item.yAxis === 1 ? 2 : 1);\r\n            }\r\n          }}\r\n          {...graphLegendItemProps}\r\n        />\r\n      )}\r\n    />\r\n  );\r\n};\r\n\r\nGraphLegend.displayName = 'GraphLegend';\r\n","import React, { useContext } from 'react';\r\nimport { css, cx } from 'emotion';\r\nimport { LegendSeriesIcon } from '../Legend/LegendSeriesIcon';\r\nimport { LegendItem } from '../Legend/Legend';\r\nimport { SeriesColorChangeHandler } from './GraphWithLegend';\r\nimport { LegendStatsList } from '../Legend/LegendStatsList';\r\nimport { ThemeContext } from '../../themes/ThemeContext';\r\nimport { stylesFactory } from '../../themes';\r\nimport { GrafanaTheme, formattedValueToString } from '@grafana/data';\r\n\r\nexport interface GraphLegendItemProps {\r\n  key?: React.Key;\r\n  item: LegendItem;\r\n  className?: string;\r\n  onLabelClick?: (item: LegendItem, event: React.MouseEvent<HTMLDivElement>) => void;\r\n  onSeriesColorChange?: SeriesColorChangeHandler;\r\n  onToggleAxis?: () => void;\r\n}\r\n\r\nexport const GraphLegendListItem: React.FunctionComponent<GraphLegendItemProps> = ({\r\n  item,\r\n  onSeriesColorChange,\r\n  onToggleAxis,\r\n  onLabelClick,\r\n}) => {\r\n  const theme = useContext(ThemeContext);\r\n\r\n  return (\r\n    <>\r\n      <LegendSeriesIcon\r\n        disabled={!onSeriesColorChange}\r\n        color={item.color}\r\n        onColorChange={color => {\r\n          if (onSeriesColorChange) {\r\n            onSeriesColorChange(item.label, color);\r\n          }\r\n        }}\r\n        onToggleAxis={onToggleAxis}\r\n        yAxis={item.yAxis}\r\n      />\r\n      <div\r\n        onClick={event => {\r\n          if (onLabelClick) {\r\n            onLabelClick(item, event);\r\n          }\r\n        }}\r\n        className={css`\r\n          cursor: pointer;\r\n          white-space: pre-wrap;\r\n          color: ${!item.isVisible && theme.colors.linkDisabled};\r\n        `}\r\n      >\r\n        {item.label}\r\n      </div>\r\n\r\n      {item.displayValues && <LegendStatsList stats={item.displayValues} />}\r\n    </>\r\n  );\r\n};\r\n\r\nconst getStyles = stylesFactory((theme: GrafanaTheme) => {\r\n  return {\r\n    row: css`\r\n      font-size: ${theme.typography.size.sm};\r\n      td {\r\n        padding: ${theme.spacing.xxs} ${theme.spacing.sm};\r\n        white-space: nowrap;\r\n      }\r\n    `,\r\n    label: css`\r\n      cursor: pointer;\r\n      white-space: nowrap;\r\n    `,\r\n    itemWrapper: css`\r\n      display: flex;\r\n      white-space: nowrap;\r\n    `,\r\n    value: css`\r\n      text-align: right;\r\n    `,\r\n    yAxisLabel: css`\r\n      color: ${theme.colors.gray2};\r\n    `,\r\n  };\r\n});\r\n\r\nexport const GraphLegendTableRow: React.FunctionComponent<GraphLegendItemProps> = ({\r\n  item,\r\n  onSeriesColorChange,\r\n  onToggleAxis,\r\n  onLabelClick,\r\n  className,\r\n}) => {\r\n  const theme = useContext(ThemeContext);\r\n  const styles = getStyles(theme);\r\n  return (\r\n    <tr className={cx(styles.row, className)}>\r\n      <td>\r\n        <span className={styles.itemWrapper}>\r\n          <LegendSeriesIcon\r\n            disabled={!!onSeriesColorChange}\r\n            color={item.color}\r\n            onColorChange={color => {\r\n              if (onSeriesColorChange) {\r\n                onSeriesColorChange(item.label, color);\r\n              }\r\n            }}\r\n            onToggleAxis={onToggleAxis}\r\n            yAxis={item.yAxis}\r\n          />\r\n          <div\r\n            onClick={event => {\r\n              if (onLabelClick) {\r\n                onLabelClick(item, event);\r\n              }\r\n            }}\r\n            className={styles.label}\r\n          >\r\n            {item.label} {item.yAxis === 2 && <span className={styles.yAxisLabel}>(right y-axis)</span>}\r\n          </div>\r\n        </span>\r\n      </td>\r\n      {item.displayValues &&\r\n        item.displayValues.map((stat, index) => {\r\n          return (\r\n            <td className={styles.value} key={`${stat.title}-${index}`}>\r\n              {formattedValueToString(stat)}\r\n            </td>\r\n          );\r\n        })}\r\n    </tr>\r\n  );\r\n};\r\n","import React from 'react';\r\nimport { GraphSeriesXY } from '@grafana/data';\r\nimport difference from 'lodash/difference';\r\nimport isEqual from 'lodash/isEqual';\r\n\r\nexport interface GraphSeriesTogglerAPI {\r\n  onSeriesToggle: (label: string, event: React.MouseEvent<HTMLElement>) => void;\r\n  toggledSeries: GraphSeriesXY[];\r\n}\r\n\r\nexport interface GraphSeriesTogglerProps {\r\n  children: (api: GraphSeriesTogglerAPI) => JSX.Element;\r\n  series: GraphSeriesXY[];\r\n  onHiddenSeriesChanged?: (hiddenSeries: string[]) => void;\r\n}\r\n\r\nexport interface GraphSeriesTogglerState {\r\n  hiddenSeries: string[];\r\n  toggledSeries: GraphSeriesXY[];\r\n}\r\n\r\nexport class GraphSeriesToggler extends React.Component<GraphSeriesTogglerProps, GraphSeriesTogglerState> {\r\n  constructor(props: GraphSeriesTogglerProps) {\r\n    super(props);\r\n\r\n    this.onSeriesToggle = this.onSeriesToggle.bind(this);\r\n\r\n    this.state = {\r\n      hiddenSeries: [],\r\n      toggledSeries: props.series,\r\n    };\r\n  }\r\n\r\n  componentDidUpdate(prevProps: Readonly<GraphSeriesTogglerProps>) {\r\n    const { series } = this.props;\r\n    if (!isEqual(prevProps.series, series)) {\r\n      this.setState({ hiddenSeries: [], toggledSeries: series });\r\n    }\r\n  }\r\n\r\n  onSeriesToggle(label: string, event: React.MouseEvent<HTMLElement>) {\r\n    const { series, onHiddenSeriesChanged } = this.props;\r\n    const { hiddenSeries } = this.state;\r\n\r\n    if (event.ctrlKey || event.metaKey || event.shiftKey) {\r\n      // Toggling series with key makes the series itself to toggle\r\n      const newHiddenSeries =\r\n        hiddenSeries.indexOf(label) > -1\r\n          ? hiddenSeries.filter(series => series !== label)\r\n          : hiddenSeries.concat([label]);\r\n\r\n      const toggledSeries = series.map(series => ({\r\n        ...series,\r\n        isVisible: newHiddenSeries.indexOf(series.label) === -1,\r\n      }));\r\n      this.setState({ hiddenSeries: newHiddenSeries, toggledSeries }, () =>\r\n        onHiddenSeriesChanged ? onHiddenSeriesChanged(newHiddenSeries) : undefined\r\n      );\r\n      return;\r\n    }\r\n\r\n    // Toggling series with out key toggles all the series but the clicked one\r\n    const allSeriesLabels = series.map(series => series.label);\r\n    const newHiddenSeries =\r\n      hiddenSeries.length + 1 === allSeriesLabels.length ? [] : difference(allSeriesLabels, [label]);\r\n    const toggledSeries = series.map(series => ({\r\n      ...series,\r\n      isVisible: newHiddenSeries.indexOf(series.label) === -1,\r\n    }));\r\n\r\n    this.setState({ hiddenSeries: newHiddenSeries, toggledSeries }, () =>\r\n      onHiddenSeriesChanged ? onHiddenSeriesChanged(newHiddenSeries) : undefined\r\n    );\r\n  }\r\n\r\n  render() {\r\n    const { children } = this.props;\r\n    const { toggledSeries } = this.state;\r\n\r\n    return children({\r\n      onSeriesToggle: this.onSeriesToggle,\r\n      toggledSeries,\r\n    });\r\n  }\r\n}\r\n","import React from 'react';\r\nimport { TooltipContentProps } from '../../Chart/Tooltip';\r\nimport { SingleModeGraphTooltip } from './SingleModeGraphTooltip';\r\nimport { MultiModeGraphTooltip } from './MultiModeGraphTooltip';\r\nimport { GraphDimensions } from './types';\r\n\r\nexport const GraphTooltip: React.FC<TooltipContentProps<GraphDimensions>> = ({\r\n  mode = 'single',\r\n  dimensions,\r\n  activeDimensions,\r\n  pos,\r\n}) => {\r\n  // When\r\n  // [1] no active dimension or\r\n  // [2] no xAxis position\r\n  // we assume no tooltip should be rendered\r\n  if (!activeDimensions || !activeDimensions.xAxis) {\r\n    return null;\r\n  }\r\n\r\n  if (mode === 'single') {\r\n    return <SingleModeGraphTooltip dimensions={dimensions} activeDimensions={activeDimensions} />;\r\n  } else {\r\n    return <MultiModeGraphTooltip dimensions={dimensions} activeDimensions={activeDimensions} pos={pos} />;\r\n  }\r\n};\r\n\r\nGraphTooltip.displayName = 'GraphTooltip';\r\n","import React from 'react';\r\nimport { SeriesTable } from './SeriesTable';\r\nimport { GraphTooltipContentProps } from './types';\r\nimport { getMultiSeriesGraphHoverInfo } from '../utils';\r\nimport { FlotPosition } from '../types';\r\nimport { getValueFromDimension } from '@grafana/data';\r\n\r\nexport const MultiModeGraphTooltip: React.FC<GraphTooltipContentProps & {\r\n  // We expect position to figure out correct values when not hovering over a datapoint\r\n  pos: FlotPosition;\r\n}> = ({ dimensions, activeDimensions, pos }) => {\r\n  let activeSeriesIndex: number | null = null;\r\n  // when no x-axis provided, skip rendering\r\n  if (activeDimensions.xAxis === null) {\r\n    return null;\r\n  }\r\n\r\n  if (activeDimensions.yAxis) {\r\n    activeSeriesIndex = activeDimensions.yAxis[0];\r\n  }\r\n\r\n  // when not hovering over a point, time is undefined, and we use pos.x as time\r\n  const time = activeDimensions.xAxis[1]\r\n    ? getValueFromDimension(dimensions.xAxis, activeDimensions.xAxis[0], activeDimensions.xAxis[1])\r\n    : pos.x;\r\n\r\n  const hoverInfo = getMultiSeriesGraphHoverInfo(dimensions.yAxis.columns, dimensions.xAxis.columns, time);\r\n  const timestamp = hoverInfo.time;\r\n\r\n  const series = hoverInfo.results.map((s, i) => {\r\n    return {\r\n      color: s.color,\r\n      label: s.label,\r\n      value: s.value,\r\n      isActive: activeSeriesIndex === i,\r\n    };\r\n  });\r\n\r\n  return <SeriesTable series={series} timestamp={timestamp} />;\r\n};\r\n\r\nMultiModeGraphTooltip.displayName = 'MultiModeGraphTooltip';\r\n","import React from 'react';\r\nimport { stylesFactory } from '../../../themes/stylesFactory';\r\nimport { GrafanaTheme, GraphSeriesValue } from '@grafana/data';\r\nimport { css, cx } from 'emotion';\r\nimport { SeriesIcon } from '../../Legend/SeriesIcon';\r\nimport { useTheme } from '../../../themes';\r\n\r\ninterface SeriesTableRowProps {\r\n  color?: string;\r\n  label?: string;\r\n  value: string | GraphSeriesValue;\r\n  isActive?: boolean;\r\n}\r\n\r\nconst getSeriesTableRowStyles = stylesFactory((theme: GrafanaTheme) => {\r\n  return {\r\n    icon: css`\r\n      margin-right: ${theme.spacing.xs};\r\n    `,\r\n    seriesTable: css`\r\n      display: table;\r\n    `,\r\n    seriesTableRow: css`\r\n      display: table-row;\r\n      font-size: ${theme.typography.size.sm};\r\n    `,\r\n    seriesTableCell: css`\r\n      display: table-cell;\r\n    `,\r\n    label: css`\r\n      word-break: break-all;\r\n    `,\r\n    value: css`\r\n      padding-left: ${theme.spacing.md};\r\n    `,\r\n    activeSeries: css`\r\n      font-weight: ${theme.typography.weight.bold};\r\n    `,\r\n    timestamp: css`\r\n      font-weight: ${theme.typography.weight.bold};\r\n      font-size: ${theme.typography.size.sm};\r\n    `,\r\n  };\r\n});\r\n\r\nconst SeriesTableRow: React.FC<SeriesTableRowProps> = ({ color, label, value, isActive }) => {\r\n  const theme = useTheme();\r\n  const styles = getSeriesTableRowStyles(theme);\r\n  return (\r\n    <div className={cx(styles.seriesTableRow, isActive && styles.activeSeries)}>\r\n      {color && (\r\n        <div className={styles.seriesTableCell}>\r\n          <SeriesIcon color={color} className={styles.icon} />\r\n        </div>\r\n      )}\r\n      <div className={cx(styles.seriesTableCell, styles.label)}>{label}</div>\r\n      <div className={cx(styles.seriesTableCell, styles.value)}>{value}</div>\r\n    </div>\r\n  );\r\n};\r\n\r\ninterface SeriesTableProps {\r\n  timestamp?: string | GraphSeriesValue;\r\n  series: SeriesTableRowProps[];\r\n}\r\n\r\nexport const SeriesTable: React.FC<SeriesTableProps> = ({ timestamp, series }) => {\r\n  const theme = useTheme();\r\n  const styles = getSeriesTableRowStyles(theme);\r\n  return (\r\n    <>\r\n      {timestamp && (\r\n        <div className={styles.timestamp} aria-label=\"Timestamp\">\r\n          {timestamp}\r\n        </div>\r\n      )}\r\n      {series.map(s => {\r\n        return <SeriesTableRow isActive={s.isActive} label={s.label} color={s.color} value={s.value} key={s.label} />;\r\n      })}\r\n    </>\r\n  );\r\n};\r\n","import React from 'react';\r\nimport {\r\n  getValueFromDimension,\r\n  getColumnFromDimension,\r\n  formattedValueToString,\r\n  getDisplayProcessor,\r\n} from '@grafana/data';\r\nimport { SeriesTable } from './SeriesTable';\r\nimport { GraphTooltipContentProps } from './types';\r\n\r\nexport const SingleModeGraphTooltip: React.FC<GraphTooltipContentProps> = ({ dimensions, activeDimensions }) => {\r\n  // not hovering over a point, skip rendering\r\n  if (\r\n    activeDimensions.yAxis === null ||\r\n    activeDimensions.yAxis[1] === undefined ||\r\n    activeDimensions.xAxis === null ||\r\n    activeDimensions.xAxis[1] === undefined\r\n  ) {\r\n    return null;\r\n  }\r\n  const time = getValueFromDimension(dimensions.xAxis, activeDimensions.xAxis[0], activeDimensions.xAxis[1]);\r\n  const timeField = getColumnFromDimension(dimensions.xAxis, activeDimensions.xAxis[0]);\r\n  const processedTime = timeField.display ? formattedValueToString(timeField.display(time)) : time;\r\n\r\n  const valueField = getColumnFromDimension(dimensions.yAxis, activeDimensions.yAxis[0]);\r\n  const value = getValueFromDimension(dimensions.yAxis, activeDimensions.yAxis[0], activeDimensions.yAxis[1]);\r\n  const display = valueField.display ?? getDisplayProcessor({ field: valueField });\r\n  const disp = display(value);\r\n\r\n  return (\r\n    <SeriesTable\r\n      series={[\r\n        {\r\n          color: disp.color,\r\n          label: valueField.name,\r\n          value: formattedValueToString(disp),\r\n        },\r\n      ]}\r\n      timestamp={processedTime}\r\n    />\r\n  );\r\n};\r\n\r\nSingleModeGraphTooltip.displayName = 'SingleModeGraphTooltip';\r\n","// Libraries\r\n\r\nimport React from 'react';\r\nimport { css } from 'emotion';\r\nimport { GraphSeriesValue } from '@grafana/data';\r\n\r\nimport { Graph, GraphProps } from './Graph';\r\nimport { LegendRenderOptions, LegendItem, LegendDisplayMode } from '../Legend/Legend';\r\nimport { GraphLegend } from './GraphLegend';\r\nimport { CustomScrollbar } from '../CustomScrollbar/CustomScrollbar';\r\nimport { stylesFactory } from '../../themes';\r\n\r\nexport type SeriesOptionChangeHandler<TOption> = (label: string, option: TOption) => void;\r\nexport type SeriesColorChangeHandler = SeriesOptionChangeHandler<string>;\r\nexport type SeriesAxisToggleHandler = SeriesOptionChangeHandler<number>;\r\n\r\nexport interface GraphWithLegendProps extends GraphProps, LegendRenderOptions {\r\n  isLegendVisible: boolean;\r\n  displayMode: LegendDisplayMode;\r\n  sortLegendBy?: string;\r\n  sortLegendDesc?: boolean;\r\n  onSeriesColorChange?: SeriesColorChangeHandler;\r\n  onSeriesAxisToggle?: SeriesAxisToggleHandler;\r\n  onSeriesToggle?: (label: string, event: React.MouseEvent<HTMLElement>) => void;\r\n  onToggleSort: (sortBy: string) => void;\r\n}\r\n\r\nconst getGraphWithLegendStyles = stylesFactory(({ placement }: GraphWithLegendProps) => ({\r\n  wrapper: css`\r\n    display: flex;\r\n    flex-direction: ${placement === 'under' ? 'column' : 'row'};\r\n    height: 100%;\r\n  `,\r\n  graphContainer: css`\r\n    min-height: 65%;\r\n    flex-grow: 1;\r\n  `,\r\n  legendContainer: css`\r\n    padding: 10px 0;\r\n    max-height: ${placement === 'under' ? '35%' : 'none'};\r\n  `,\r\n}));\r\n\r\nconst shouldHideLegendItem = (data: GraphSeriesValue[][], hideEmpty = false, hideZero = false) => {\r\n  const isZeroOnlySeries = data.reduce((acc, current) => acc + (current[1] || 0), 0) === 0;\r\n  const isNullOnlySeries = !data.reduce((acc, current) => acc && current[1] !== null, true);\r\n\r\n  return (hideEmpty && isNullOnlySeries) || (hideZero && isZeroOnlySeries);\r\n};\r\n\r\nexport const GraphWithLegend: React.FunctionComponent<GraphWithLegendProps> = (props: GraphWithLegendProps) => {\r\n  const {\r\n    series,\r\n    timeRange,\r\n    width,\r\n    height,\r\n    showBars,\r\n    showLines,\r\n    showPoints,\r\n    sortLegendBy,\r\n    sortLegendDesc,\r\n    isLegendVisible,\r\n    displayMode,\r\n    placement,\r\n    onSeriesAxisToggle,\r\n    onSeriesColorChange,\r\n    onSeriesToggle,\r\n    onToggleSort,\r\n    hideEmpty,\r\n    hideZero,\r\n    isStacked,\r\n    lineWidth,\r\n    onHorizontalRegionSelected,\r\n    timeZone,\r\n    children,\r\n  } = props;\r\n  const { graphContainer, wrapper, legendContainer } = getGraphWithLegendStyles(props);\r\n\r\n  const legendItems = series.reduce<LegendItem[]>((acc, s) => {\r\n    return shouldHideLegendItem(s.data, hideEmpty, hideZero)\r\n      ? acc\r\n      : acc.concat([\r\n          {\r\n            label: s.label,\r\n            color: s.color,\r\n            isVisible: s.isVisible,\r\n            yAxis: s.yAxis.index,\r\n            displayValues: s.info || [],\r\n          },\r\n        ]);\r\n  }, []);\r\n\r\n  return (\r\n    <div className={wrapper}>\r\n      <div className={graphContainer}>\r\n        <Graph\r\n          series={series}\r\n          timeRange={timeRange}\r\n          timeZone={timeZone}\r\n          showLines={showLines}\r\n          showPoints={showPoints}\r\n          showBars={showBars}\r\n          width={width}\r\n          height={height}\r\n          key={isLegendVisible ? 'legend-visible' : 'legend-invisible'}\r\n          isStacked={isStacked}\r\n          lineWidth={lineWidth}\r\n          onHorizontalRegionSelected={onHorizontalRegionSelected}\r\n        >\r\n          {children}\r\n        </Graph>\r\n      </div>\r\n\r\n      {isLegendVisible && (\r\n        <div className={legendContainer}>\r\n          <CustomScrollbar hideHorizontalTrack>\r\n            <GraphLegend\r\n              items={legendItems}\r\n              displayMode={displayMode}\r\n              placement={placement}\r\n              sortBy={sortLegendBy}\r\n              sortDesc={sortLegendDesc}\r\n              onLabelClick={(item, event) => {\r\n                if (onSeriesToggle) {\r\n                  onSeriesToggle(item.label, event);\r\n                }\r\n              }}\r\n              onSeriesColorChange={onSeriesColorChange}\r\n              onSeriesAxisToggle={onSeriesAxisToggle}\r\n              onToggleSort={onToggleSort}\r\n            />\r\n          </CustomScrollbar>\r\n        </div>\r\n      )}\r\n    </div>\r\n  );\r\n};\r\n","import { GraphSeriesValue, Field, formattedValueToString, getDisplayProcessor } from '@grafana/data';\r\n\r\n/**\r\n * Returns index of the closest datapoint BEFORE hover position\r\n *\r\n * @param posX\r\n * @param series\r\n */\r\nexport const findHoverIndexFromData = (xAxisDimension: Field, xPos: number) => {\r\n  let lower = 0;\r\n  let upper = xAxisDimension.values.length - 1;\r\n  let middle;\r\n\r\n  while (true) {\r\n    if (lower > upper) {\r\n      return Math.max(upper, 0);\r\n    }\r\n    middle = Math.floor((lower + upper) / 2);\r\n    const xPosition = xAxisDimension.values.get(middle);\r\n\r\n    if (xPosition === xPos) {\r\n      return middle;\r\n    } else if (xPosition && xPosition < xPos) {\r\n      lower = middle + 1;\r\n    } else {\r\n      upper = middle - 1;\r\n    }\r\n  }\r\n};\r\n\r\ninterface MultiSeriesHoverInfo {\r\n  value: string;\r\n  time: string;\r\n  datapointIndex: number;\r\n  seriesIndex: number;\r\n  label?: string;\r\n  color?: string;\r\n}\r\n\r\n/**\r\n * Returns information about closest datapoints when hovering over a Graph\r\n *\r\n * @param seriesList list of series visible on the Graph\r\n * @param pos mouse cursor position, based on jQuery.flot position\r\n */\r\nexport const getMultiSeriesGraphHoverInfo = (\r\n  // x and y axis dimensions order is aligned\r\n  yAxisDimensions: Field[],\r\n  xAxisDimensions: Field[],\r\n  /** Well, time basically */\r\n  xAxisPosition: number\r\n): {\r\n  results: MultiSeriesHoverInfo[];\r\n  time?: GraphSeriesValue;\r\n} => {\r\n  let i, field, hoverIndex, hoverDistance, pointTime;\r\n\r\n  const results: MultiSeriesHoverInfo[] = [];\r\n\r\n  let minDistance, minTime;\r\n\r\n  for (i = 0; i < yAxisDimensions.length; i++) {\r\n    field = yAxisDimensions[i];\r\n    const time = xAxisDimensions[i];\r\n    hoverIndex = findHoverIndexFromData(time, xAxisPosition);\r\n    hoverDistance = xAxisPosition - time.values.get(hoverIndex);\r\n    pointTime = time.values.get(hoverIndex);\r\n    // Take the closest point before the cursor, or if it does not exist, the closest after\r\n    if (\r\n      minDistance === undefined ||\r\n      (hoverDistance >= 0 && (hoverDistance < minDistance || minDistance < 0)) ||\r\n      (hoverDistance < 0 && hoverDistance > minDistance)\r\n    ) {\r\n      minDistance = hoverDistance;\r\n      minTime = time.display ? formattedValueToString(time.display(pointTime)) : pointTime;\r\n    }\r\n\r\n    const display = field.display ?? getDisplayProcessor({ field });\r\n    const disp = display(field.values.get(hoverIndex));\r\n\r\n    results.push({\r\n      value: formattedValueToString(disp),\r\n      datapointIndex: hoverIndex,\r\n      seriesIndex: i,\r\n      color: disp.color,\r\n      label: field.name,\r\n      time: time.display ? formattedValueToString(time.display(pointTime)) : pointTime,\r\n    });\r\n  }\r\n\r\n  return {\r\n    results,\r\n    time: minTime,\r\n  };\r\n};\r\n","import React from 'react';\r\nimport { cx, css } from 'emotion';\r\nimport { stylesFactory } from '../../themes';\r\nimport { IconType } from './types';\r\n\r\nexport interface IconProps {\r\n  name: IconType;\r\n  className?: string;\r\n  onClick?: () => void;\r\n  onMouseDown?: React.MouseEventHandler;\r\n}\r\n\r\nconst getIconStyles = stylesFactory(() => {\r\n  return {\r\n    icon: css`\r\n      display: inline-block;\r\n      width: 16px;\r\n      height: 16px;\r\n      text-align: center;\r\n      font-size: 14px;\r\n      &:before {\r\n        vertical-align: middle;\r\n      }\r\n    `,\r\n  };\r\n});\r\n\r\nexport const Icon: React.FC<IconProps> = ({ name, className, onClick, onMouseDown }) => {\r\n  const styles = getIconStyles();\r\n  return <i className={cx(styles.icon, 'fa', `fa-${name}`, className)} onClick={onClick} onMouseDown={onMouseDown} />;\r\n};\r\n\r\nIcon.displayName = 'Icon';\r\n","import React, { PureComponent, ChangeEvent } from 'react';\r\nimport classNames from 'classnames';\r\nimport { validate, EventsWithValidation, hasValidationEvent } from '../../utils';\r\nimport { ValidationEvents, ValidationRule } from '../../types';\r\n\r\nexport enum InputStatus {\r\n  Invalid = 'invalid',\r\n  Valid = 'valid',\r\n}\r\n\r\ninterface Props extends React.HTMLProps<HTMLInputElement> {\r\n  validationEvents?: ValidationEvents;\r\n  hideErrorMessage?: boolean;\r\n  inputRef?: React.LegacyRef<HTMLInputElement>;\r\n\r\n  // Override event props and append status as argument\r\n  onBlur?: (event: React.FocusEvent<HTMLInputElement>, status?: InputStatus) => void;\r\n  onFocus?: (event: React.FocusEvent<HTMLInputElement>, status?: InputStatus) => void;\r\n  onChange?: (event: React.ChangeEvent<HTMLInputElement>, status?: InputStatus) => void;\r\n}\r\n\r\ninterface State {\r\n  error: string | null;\r\n}\r\n\r\nexport class Input extends PureComponent<Props, State> {\r\n  static defaultProps = {\r\n    className: '',\r\n  };\r\n\r\n  state: State = {\r\n    error: null,\r\n  };\r\n\r\n  get status() {\r\n    return this.state.error ? InputStatus.Invalid : InputStatus.Valid;\r\n  }\r\n\r\n  get isInvalid() {\r\n    return this.status === InputStatus.Invalid;\r\n  }\r\n\r\n  validatorAsync = (validationRules: ValidationRule[]) => {\r\n    return (evt: ChangeEvent<HTMLInputElement>) => {\r\n      const errors = validate(evt.target.value, validationRules);\r\n      this.setState(prevState => {\r\n        return { ...prevState, error: errors ? errors[0] : null };\r\n      });\r\n    };\r\n  };\r\n\r\n  populateEventPropsWithStatus = (restProps: any, validationEvents: ValidationEvents | undefined) => {\r\n    const inputElementProps = { ...restProps };\r\n    if (!validationEvents) {\r\n      return inputElementProps;\r\n    }\r\n    Object.keys(EventsWithValidation).forEach(eventName => {\r\n      if (hasValidationEvent(eventName as EventsWithValidation, validationEvents) || restProps[eventName]) {\r\n        inputElementProps[eventName] = async (evt: ChangeEvent<HTMLInputElement>) => {\r\n          evt.persist(); // Needed for async. https://reactjs.org/docs/events.html#event-pooling\r\n          if (hasValidationEvent(eventName as EventsWithValidation, validationEvents)) {\r\n            await this.validatorAsync(validationEvents[eventName]).apply(this, [evt]);\r\n          }\r\n          if (restProps[eventName]) {\r\n            restProps[eventName].apply(null, [evt, this.status]);\r\n          }\r\n        };\r\n      }\r\n    });\r\n    return inputElementProps;\r\n  };\r\n\r\n  render() {\r\n    const { validationEvents, className, hideErrorMessage, inputRef, ...restProps } = this.props;\r\n    const { error } = this.state;\r\n    const inputClassName = classNames('gf-form-input', { invalid: this.isInvalid }, className);\r\n    const inputElementProps = this.populateEventPropsWithStatus(restProps, validationEvents);\r\n\r\n    return (\r\n      <div style={{ flexGrow: 1 }}>\r\n        <input {...inputElementProps} ref={inputRef} className={inputClassName} />\r\n        {error && !hideErrorMessage && <span>{error}</span>}\r\n      </div>\r\n    );\r\n  }\r\n}\r\n","import React, { PureComponent, createRef } from 'react';\nimport { JsonExplorer } from './json_explorer/json_explorer'; // We have made some monkey-patching of json-formatter-js so we can't switch right now\n\ninterface Props {\n  className?: string;\n  json: {};\n  config?: any;\n  open?: number;\n  onDidRender?: (formattedJson: any) => void;\n}\n\nexport class JSONFormatter extends PureComponent<Props> {\n  private wrapperRef = createRef<HTMLDivElement>();\n\n  static defaultProps = {\n    open: 3,\n    config: {\n      animateOpen: true,\n    },\n  };\n\n  componentDidMount() {\n    this.renderJson();\n  }\n\n  componentDidUpdate() {\n    this.renderJson();\n  }\n\n  renderJson = () => {\n    const { json, config, open, onDidRender } = this.props;\n    const wrapperEl = this.wrapperRef.current;\n    const formatter = new JsonExplorer(json, open, config);\n    // @ts-ignore\n    const hasChildren: boolean = wrapperEl.hasChildNodes();\n    if (hasChildren) {\n      // @ts-ignore\n      wrapperEl.replaceChild(formatter.render(), wrapperEl.lastChild);\n    } else {\n      // @ts-ignore\n      wrapperEl.appendChild(formatter.render());\n    }\n\n    if (onDidRender) {\n      onDidRender(formatter.json);\n    }\n  };\n\n  render() {\n    const { className } = this.props;\n    return <div className={className} ref={this.wrapperRef} />;\n  }\n}\n","// Based on work https://github.com/mohsen1/json-formatter-js\n// License MIT, Copyright (c) 2015 Mohsen Azimi\n\n/*\n * Escapes `\"` characters from string\n */\nfunction escapeString(str: string): string {\n  return str.replace('\"', '\"');\n}\n\n/*\n * Determines if a value is an object\n */\nexport function isObject(value: any): boolean {\n  const type = typeof value;\n  return !!value && type === 'object';\n}\n\n/*\n * Gets constructor name of an object.\n * From http://stackoverflow.com/a/332429\n *\n */\nexport function getObjectName(object: object): string {\n  if (object === undefined) {\n    return '';\n  }\n  if (object === null) {\n    return 'Object';\n  }\n  if (typeof object === 'object' && !object.constructor) {\n    return 'Object';\n  }\n\n  const funcNameRegex = /function ([^(]*)/;\n  const results = funcNameRegex.exec(object.constructor.toString());\n  if (results && results.length > 1) {\n    return results[1];\n  } else {\n    return '';\n  }\n}\n\n/*\n * Gets type of an object. Returns \"null\" for null objects\n */\nexport function getType(object: object): string {\n  if (object === null) {\n    return 'null';\n  }\n  return typeof object;\n}\n\n/*\n * Generates inline preview for a JavaScript object based on a value\n */\nexport function getValuePreview(object: object, value: string): string {\n  const type = getType(object);\n\n  if (type === 'null' || type === 'undefined') {\n    return type;\n  }\n\n  if (type === 'string') {\n    value = '\"' + escapeString(value) + '\"';\n  }\n  if (type === 'function') {\n    // Remove content of the function\n    return (\n      object\n        .toString()\n        .replace(/[\\r\\n]/g, '')\n        .replace(/\\{.*\\}/, '') + '{}'\n    );\n  }\n  return value;\n}\n\n/*\n * Generates inline preview for a JavaScript object\n */\nlet value = '';\nexport function getPreview(obj: object): string {\n  if (isObject(obj)) {\n    value = getObjectName(obj);\n    if (Array.isArray(obj)) {\n      value += '[' + obj.length + ']';\n    }\n  } else {\n    value = getValuePreview(obj, obj.toString());\n  }\n  return value;\n}\n\n/*\n * Generates a prefixed CSS class name\n */\nexport function cssClass(className: string): string {\n  return `json-formatter-${className}`;\n}\n\n/*\n * Creates a new DOM element with given type and class\n * TODO: move me to helpers\n */\nexport function createElement(type: string, className?: string, content?: Element | string): Element {\n  const el = document.createElement(type);\n  if (className) {\n    el.classList.add(cssClass(className));\n  }\n  if (content !== undefined) {\n    if (content instanceof Node) {\n      el.appendChild(content);\n    } else {\n      el.appendChild(document.createTextNode(String(content)));\n    }\n  }\n  return el;\n}\n","// Based on work https://github.com/mohsen1/json-formatter-js\r\n// License MIT, Copyright (c) 2015 Mohsen Azimi\r\n\r\nimport { isObject, getObjectName, getType, getValuePreview, cssClass, createElement } from './helpers';\r\n\r\nimport _ from 'lodash';\r\n\r\nconst DATE_STRING_REGEX = /(^\\d{1,4}[\\.|\\\\/|-]\\d{1,2}[\\.|\\\\/|-]\\d{1,4})(\\s*(?:0?[1-9]:[0-5]|1(?=[012])\\d:[0-5])\\d\\s*[ap]m)?$/;\r\nconst PARTIAL_DATE_REGEX = /\\d{2}:\\d{2}:\\d{2} GMT-\\d{4}/;\r\nconst JSON_DATE_REGEX = /\\d{4}-\\d{2}-\\d{2}T\\d{2}:\\d{2}:\\d{2}.\\d{3}Z/;\r\n\r\n// When toggleing, don't animated removal or addition of more than a few items\r\nconst MAX_ANIMATED_TOGGLE_ITEMS = 10;\r\n\r\nconst requestAnimationFrame =\r\n  window.requestAnimationFrame ||\r\n  ((cb: () => void) => {\r\n    cb();\r\n    return 0;\r\n  });\r\n\r\nexport interface JsonExplorerConfig {\r\n  animateOpen?: boolean;\r\n  animateClose?: boolean;\r\n  theme?: string;\r\n}\r\n\r\nconst _defaultConfig: JsonExplorerConfig = {\r\n  animateOpen: true,\r\n  animateClose: true,\r\n};\r\n\r\n/**\r\n * @class JsonExplorer\r\n *\r\n * JsonExplorer allows you to render JSON objects in HTML with a\r\n * **collapsible** navigation.\r\n */\r\nexport class JsonExplorer {\r\n  // Hold the open state after the toggler is used\r\n  private _isOpen: boolean | null = null;\r\n\r\n  // A reference to the element that we render to\r\n  private element: Element | null = null;\r\n\r\n  private skipChildren = false;\r\n\r\n  /**\r\n   * @param {object} json The JSON object you want to render. It has to be an\r\n   * object or array. Do NOT pass raw JSON string.\r\n   *\r\n   * @param {number} [open=1] his number indicates up to how many levels the\r\n   * rendered tree should expand. Set it to `0` to make the whole tree collapsed\r\n   * or set it to `Infinity` to expand the tree deeply\r\n   *\r\n   * @param {object} [config=defaultConfig] -\r\n   *  defaultConfig = {\r\n   *   hoverPreviewEnabled: false,\r\n   *   hoverPreviewArrayCount: 100,\r\n   *   hoverPreviewFieldCount: 5\r\n   * }\r\n   *\r\n   * Available configurations:\r\n   *  #####Hover Preview\r\n   * * `hoverPreviewEnabled`:  enable preview on hover\r\n   * * `hoverPreviewArrayCount`: number of array items to show in preview Any\r\n   *    array larger than this number will be shown as `Array[XXX]` where `XXX`\r\n   *    is length of the array.\r\n   * * `hoverPreviewFieldCount`: number of object properties to show for object\r\n   *   preview. Any object with more properties that thin number will be\r\n   *   truncated.\r\n   *\r\n   * @param {string} [key=undefined] The key that this object in it's parent\r\n   * context\r\n   */\r\n  constructor(\r\n    public json: any,\r\n    private open = 1,\r\n    private config: JsonExplorerConfig = _defaultConfig,\r\n    private key?: string\r\n  ) {}\r\n\r\n  /*\r\n   * is formatter open?\r\n   */\r\n  private get isOpen(): boolean {\r\n    if (this._isOpen !== null) {\r\n      return this._isOpen;\r\n    } else {\r\n      return this.open > 0;\r\n    }\r\n  }\r\n\r\n  /*\r\n   * set open state (from toggler)\r\n   */\r\n  private set isOpen(value: boolean) {\r\n    this._isOpen = value;\r\n  }\r\n\r\n  /*\r\n   * is this a date string?\r\n   */\r\n  private get isDate(): boolean {\r\n    return (\r\n      this.type === 'string' &&\r\n      (DATE_STRING_REGEX.test(this.json) || JSON_DATE_REGEX.test(this.json) || PARTIAL_DATE_REGEX.test(this.json))\r\n    );\r\n  }\r\n\r\n  /*\r\n   * is this a URL string?\r\n   */\r\n  private get isUrl(): boolean {\r\n    return this.type === 'string' && this.json.indexOf('http') === 0;\r\n  }\r\n\r\n  /*\r\n   * is this an array?\r\n   */\r\n  private get isArray(): boolean {\r\n    return Array.isArray(this.json);\r\n  }\r\n\r\n  /*\r\n   * is this an object?\r\n   * Note: In this context arrays are object as well\r\n   */\r\n  private get isObject(): boolean {\r\n    return isObject(this.json);\r\n  }\r\n\r\n  /*\r\n   * is this an empty object with no properties?\r\n   */\r\n  private get isEmptyObject(): boolean {\r\n    return !this.keys.length && !this.isArray;\r\n  }\r\n\r\n  /*\r\n   * is this an empty object or array?\r\n   */\r\n  private get isEmpty(): boolean {\r\n    return this.isEmptyObject || (this.keys && !this.keys.length && this.isArray);\r\n  }\r\n\r\n  /*\r\n   * did we receive a key argument?\r\n   * This means that the formatter was called as a sub formatter of a parent formatter\r\n   */\r\n  private get hasKey(): boolean {\r\n    return typeof this.key !== 'undefined';\r\n  }\r\n\r\n  /*\r\n   * if this is an object, get constructor function name\r\n   */\r\n  private get constructorName(): string {\r\n    return getObjectName(this.json);\r\n  }\r\n\r\n  /*\r\n   * get type of this value\r\n   * Possible values: all JavaScript primitive types plus \"array\" and \"null\"\r\n   */\r\n  private get type(): string {\r\n    return getType(this.json);\r\n  }\r\n\r\n  /*\r\n   * get object keys\r\n   * If there is an empty key we pad it wit quotes to make it visible\r\n   */\r\n  private get keys(): string[] {\r\n    if (this.isObject) {\r\n      return Object.keys(this.json).map(key => (key ? key : '\"\"'));\r\n    } else {\r\n      return [];\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Toggles `isOpen` state\r\n   *\r\n   */\r\n  toggleOpen() {\r\n    this.isOpen = !this.isOpen;\r\n\r\n    if (this.element) {\r\n      if (this.isOpen) {\r\n        this.appendChildren(this.config.animateOpen);\r\n      } else {\r\n        this.removeChildren(this.config.animateClose);\r\n      }\r\n      this.element.classList.toggle(cssClass('open'));\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Open all children up to a certain depth.\r\n   * Allows actions such as expand all/collapse all\r\n   *\r\n   */\r\n  openAtDepth(depth = 1) {\r\n    if (depth < 0) {\r\n      return;\r\n    }\r\n\r\n    this.open = depth;\r\n    this.isOpen = depth !== 0;\r\n\r\n    if (this.element) {\r\n      this.removeChildren(false);\r\n\r\n      if (depth === 0) {\r\n        this.element.classList.remove(cssClass('open'));\r\n      } else {\r\n        this.appendChildren(this.config.animateOpen);\r\n        this.element.classList.add(cssClass('open'));\r\n      }\r\n    }\r\n  }\r\n\r\n  isNumberArray() {\r\n    return this.json.length > 0 && this.json.length < 4 && (_.isNumber(this.json[0]) || _.isNumber(this.json[1]));\r\n  }\r\n\r\n  renderArray() {\r\n    const arrayWrapperSpan = createElement('span');\r\n    arrayWrapperSpan.appendChild(createElement('span', 'bracket', '['));\r\n\r\n    // some pretty handling of number arrays\r\n    if (this.isNumberArray()) {\r\n      this.json.forEach((val: any, index: number) => {\r\n        if (index > 0) {\r\n          arrayWrapperSpan.appendChild(createElement('span', 'array-comma', ','));\r\n        }\r\n        arrayWrapperSpan.appendChild(createElement('span', 'number', val));\r\n      });\r\n      this.skipChildren = true;\r\n    } else {\r\n      arrayWrapperSpan.appendChild(createElement('span', 'number', this.json.length));\r\n    }\r\n\r\n    arrayWrapperSpan.appendChild(createElement('span', 'bracket', ']'));\r\n    return arrayWrapperSpan;\r\n  }\r\n\r\n  /**\r\n   * Renders an HTML element and installs event listeners\r\n   *\r\n   * @returns {HTMLDivElement}\r\n   */\r\n  render(skipRoot = false): HTMLDivElement {\r\n    // construct the root element and assign it to this.element\r\n    this.element = createElement('div', 'row');\r\n\r\n    // construct the toggler link\r\n    const togglerLink = createElement('a', 'toggler-link');\r\n    const togglerIcon = createElement('span', 'toggler');\r\n\r\n    // if this is an object we need a wrapper span (toggler)\r\n    if (this.isObject) {\r\n      togglerLink.appendChild(togglerIcon);\r\n    }\r\n\r\n    // if this is child of a parent formatter we need to append the key\r\n    if (this.hasKey) {\r\n      togglerLink.appendChild(createElement('span', 'key', `${this.key}:`));\r\n    }\r\n\r\n    // Value for objects and arrays\r\n    if (this.isObject) {\r\n      // construct the value holder element\r\n      const value = createElement('span', 'value');\r\n\r\n      // we need a wrapper span for objects\r\n      const objectWrapperSpan = createElement('span');\r\n\r\n      // get constructor name and append it to wrapper span\r\n      const constructorName = createElement('span', 'constructor-name', this.constructorName);\r\n      objectWrapperSpan.appendChild(constructorName);\r\n\r\n      // if it's an array append the array specific elements like brackets and length\r\n      if (this.isArray) {\r\n        const arrayWrapperSpan = this.renderArray();\r\n        objectWrapperSpan.appendChild(arrayWrapperSpan);\r\n      }\r\n\r\n      // append object wrapper span to toggler link\r\n      value.appendChild(objectWrapperSpan);\r\n      togglerLink.appendChild(value);\r\n      // Primitive values\r\n    } else {\r\n      // make a value holder element\r\n      const value = this.isUrl ? createElement('a') : createElement('span');\r\n\r\n      // add type and other type related CSS classes\r\n      value.classList.add(cssClass(this.type));\r\n      if (this.isDate) {\r\n        value.classList.add(cssClass('date'));\r\n      }\r\n      if (this.isUrl) {\r\n        value.classList.add(cssClass('url'));\r\n        value.setAttribute('href', this.json);\r\n      }\r\n\r\n      // Append value content to value element\r\n      const valuePreview = getValuePreview(this.json, this.json);\r\n      value.appendChild(document.createTextNode(valuePreview));\r\n\r\n      // append the value element to toggler link\r\n      togglerLink.appendChild(value);\r\n    }\r\n\r\n    // construct a children element\r\n    const children = createElement('div', 'children');\r\n\r\n    // set CSS classes for children\r\n    if (this.isObject) {\r\n      children.classList.add(cssClass('object'));\r\n    }\r\n    if (this.isArray) {\r\n      children.classList.add(cssClass('array'));\r\n    }\r\n    if (this.isEmpty) {\r\n      children.classList.add(cssClass('empty'));\r\n    }\r\n\r\n    // set CSS classes for root element\r\n    if (this.config && this.config.theme) {\r\n      this.element.classList.add(cssClass(this.config.theme));\r\n    }\r\n    if (this.isOpen) {\r\n      this.element.classList.add(cssClass('open'));\r\n    }\r\n\r\n    // append toggler and children elements to root element\r\n    if (!skipRoot) {\r\n      this.element.appendChild(togglerLink);\r\n    }\r\n\r\n    if (!this.skipChildren) {\r\n      this.element.appendChild(children);\r\n    } else {\r\n      // remove togglerIcon\r\n      togglerLink.removeChild(togglerIcon);\r\n    }\r\n\r\n    // if formatter is set to be open call appendChildren\r\n    if (this.isObject && this.isOpen) {\r\n      this.appendChildren();\r\n    }\r\n\r\n    // add event listener for toggling\r\n    if (this.isObject) {\r\n      togglerLink.addEventListener('click', this.toggleOpen.bind(this));\r\n    }\r\n\r\n    return this.element as HTMLDivElement;\r\n  }\r\n\r\n  /**\r\n   * Appends all the children to children element\r\n   * Animated option is used when user triggers this via a click\r\n   */\r\n  appendChildren(animated = false) {\r\n    const children = this.element && this.element.querySelector(`div.${cssClass('children')}`);\r\n\r\n    if (!children || this.isEmpty) {\r\n      return;\r\n    }\r\n\r\n    if (animated) {\r\n      let index = 0;\r\n      const addAChild = () => {\r\n        const key = this.keys[index];\r\n        const formatter = new JsonExplorer(this.json[key], this.open - 1, this.config, key);\r\n        children.appendChild(formatter.render());\r\n\r\n        index += 1;\r\n\r\n        if (index < this.keys.length) {\r\n          if (index > MAX_ANIMATED_TOGGLE_ITEMS) {\r\n            addAChild();\r\n          } else {\r\n            requestAnimationFrame(addAChild);\r\n          }\r\n        }\r\n      };\r\n\r\n      requestAnimationFrame(addAChild);\r\n    } else {\r\n      this.keys.forEach(key => {\r\n        const formatter = new JsonExplorer(this.json[key], this.open - 1, this.config, key);\r\n        children.appendChild(formatter.render());\r\n      });\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Removes all the children from children element\r\n   * Animated option is used when user triggers this via a click\r\n   */\r\n  removeChildren(animated = false) {\r\n    const childrenElement =\r\n      this.element && (this.element.querySelector(`div.${cssClass('children')}`) as HTMLDivElement);\r\n\r\n    if (animated) {\r\n      let childrenRemoved = 0;\r\n      const removeAChild = () => {\r\n        if (childrenElement && childrenElement.children.length) {\r\n          childrenElement.removeChild(childrenElement.children[0]);\r\n          childrenRemoved += 1;\r\n          if (childrenRemoved > MAX_ANIMATED_TOGGLE_ITEMS) {\r\n            removeAChild();\r\n          } else {\r\n            requestAnimationFrame(removeAChild);\r\n          }\r\n        }\r\n      };\r\n      requestAnimationFrame(removeAChild);\r\n    } else {\r\n      if (childrenElement) {\r\n        childrenElement.innerHTML = '';\r\n      }\r\n    }\r\n  }\r\n}\r\n","import { DisplayValue } from '@grafana/data';\r\n\r\nimport { LegendList } from './LegendList';\r\nimport { LegendTable } from './LegendTable';\r\n\r\nexport enum LegendDisplayMode {\r\n  List = 'list',\r\n  Table = 'table',\r\n}\r\nexport interface LegendBasicOptions {\r\n  isVisible: boolean;\r\n  asTable: boolean;\r\n}\r\n\r\nexport interface LegendRenderOptions {\r\n  placement: LegendPlacement;\r\n  hideEmpty?: boolean;\r\n  hideZero?: boolean;\r\n}\r\n\r\nexport type LegendPlacement = 'under' | 'right' | 'over'; // Over used by piechart\r\n\r\nexport interface LegendOptions extends LegendBasicOptions, LegendRenderOptions {}\r\n\r\nexport interface LegendItem {\r\n  label: string;\r\n  color: string;\r\n  isVisible: boolean;\r\n  yAxis: number;\r\n  displayValues?: DisplayValue[];\r\n}\r\n\r\nexport interface LegendComponentProps {\r\n  className?: string;\r\n  items: LegendItem[];\r\n  placement: LegendPlacement;\r\n  // Function to render given item\r\n  itemRenderer?: (item: LegendItem, index: number) => JSX.Element;\r\n}\r\n\r\nexport interface LegendProps extends LegendComponentProps {}\r\n\r\nexport { LegendList, LegendTable };\r\n","import React, { useContext } from 'react';\r\nimport { LegendComponentProps, LegendItem } from './Legend';\r\nimport { InlineList } from '../List/InlineList';\r\nimport { List } from '../List/List';\r\nimport { css, cx } from 'emotion';\r\nimport { ThemeContext } from '../../themes/ThemeContext';\r\nimport { stylesFactory } from '../../themes';\r\nimport { GrafanaTheme } from '@grafana/data';\r\n\r\nconst getStyles = stylesFactory((theme: GrafanaTheme) => ({\r\n  item: css`\r\n    padding-left: 10px;\r\n    display: flex;\r\n    font-size: ${theme.typography.size.sm};\r\n    white-space: nowrap;\r\n  `,\r\n  wrapper: css`\r\n    display: flex;\r\n    flex-wrap: wrap;\r\n    justify-content: space-between;\r\n    width: 100%;\r\n  `,\r\n  section: css`\r\n    display: flex;\r\n  `,\r\n  sectionRight: css`\r\n    justify-content: flex-end;\r\n    flex-grow: 1;\r\n  `,\r\n}));\r\n\r\nexport const LegendList: React.FunctionComponent<LegendComponentProps> = ({\r\n  items,\r\n  itemRenderer,\r\n  placement,\r\n  className,\r\n}) => {\r\n  const theme = useContext(ThemeContext);\r\n  const styles = getStyles(theme);\r\n\r\n  const renderItem = (item: LegendItem, index: number) => {\r\n    return <span className={styles.item}>{itemRenderer ? itemRenderer(item, index) : item.label}</span>;\r\n  };\r\n\r\n  const getItemKey = (item: LegendItem) => `${item.label}`;\r\n\r\n  return placement === 'under' ? (\r\n    <div className={cx(styles.wrapper, className)}>\r\n      <div className={styles.section}>\r\n        <InlineList items={items.filter(item => item.yAxis === 1)} renderItem={renderItem} getItemKey={getItemKey} />\r\n      </div>\r\n      <div className={cx(styles.section, styles.sectionRight)}>\r\n        <InlineList items={items.filter(item => item.yAxis !== 1)} renderItem={renderItem} getItemKey={getItemKey} />\r\n      </div>\r\n    </div>\r\n  ) : (\r\n    <List items={items} renderItem={renderItem} getItemKey={getItemKey} className={className} />\r\n  );\r\n};\r\n\r\nLegendList.displayName = 'LegendList';\r\n","import React from 'react';\r\nimport { css, cx } from 'emotion';\r\nimport { SeriesColorPicker } from '../ColorPicker/ColorPicker';\r\nimport { SeriesIcon, SeriesIconProps } from './SeriesIcon';\r\n\r\ninterface LegendSeriesIconProps {\r\n  disabled: boolean;\r\n  color: string;\r\n  yAxis: number;\r\n  onColorChange: (color: string) => void;\r\n  onToggleAxis?: () => void;\r\n}\r\n\r\nexport const LegendSeriesIcon: React.FunctionComponent<LegendSeriesIconProps> = ({\r\n  disabled,\r\n  yAxis,\r\n  color,\r\n  onColorChange,\r\n  onToggleAxis,\r\n}) => {\r\n  let iconProps: SeriesIconProps = {\r\n    color,\r\n  };\r\n\r\n  if (!disabled) {\r\n    iconProps = {\r\n      ...iconProps,\r\n      className: 'pointer',\r\n    };\r\n  }\r\n\r\n  return disabled ? (\r\n    <span\r\n      className={cx(\r\n        'graph-legend-icon',\r\n        disabled &&\r\n          css`\r\n            cursor: default;\r\n          `\r\n      )}\r\n    >\r\n      <SeriesIcon {...iconProps} />\r\n    </span>\r\n  ) : (\r\n    <SeriesColorPicker\r\n      yaxis={yAxis}\r\n      color={color}\r\n      onChange={onColorChange}\r\n      onToggleAxis={onToggleAxis}\r\n      enableNamedColors\r\n    >\r\n      {({ ref, showColorPicker, hideColorPicker }) => (\r\n        <span ref={ref} onClick={showColorPicker} onMouseLeave={hideColorPicker} className=\"graph-legend-icon\">\r\n          <SeriesIcon {...iconProps} />\r\n        </span>\r\n      )}\r\n    </SeriesColorPicker>\r\n  );\r\n};\r\n\r\nLegendSeriesIcon.displayName = 'LegendSeriesIcon';\r\n","import React from 'react';\r\nimport { InlineList } from '../List/InlineList';\r\nimport { css } from 'emotion';\r\nimport { DisplayValue, formattedValueToString } from '@grafana/data';\r\nimport capitalize from 'lodash/capitalize';\r\n\r\nconst LegendItemStat: React.FunctionComponent<{ stat: DisplayValue }> = ({ stat }) => {\r\n  return (\r\n    <div\r\n      className={css`\r\n        margin-left: 6px;\r\n      `}\r\n    >\r\n      {stat.title && `${capitalize(stat.title)}:`} {formattedValueToString(stat)}\r\n    </div>\r\n  );\r\n};\r\n\r\nLegendItemStat.displayName = 'LegendItemStat';\r\n\r\nexport const LegendStatsList: React.FunctionComponent<{ stats: DisplayValue[] }> = ({ stats }) => {\r\n  if (stats.length === 0) {\r\n    return null;\r\n  }\r\n  return <InlineList items={stats} renderItem={stat => <LegendItemStat stat={stat} />} />;\r\n};\r\n\r\nLegendStatsList.displayName = 'LegendStatsList';\r\n","import React, { useContext } from 'react';\r\nimport { css, cx } from 'emotion';\r\nimport { LegendComponentProps } from './Legend';\r\nimport { ThemeContext } from '../../themes/ThemeContext';\r\n\r\ninterface LegendTableProps extends LegendComponentProps {\r\n  columns: string[];\r\n  sortBy?: string;\r\n  sortDesc?: boolean;\r\n  onToggleSort?: (sortBy: string) => void;\r\n}\r\n\r\nexport const LegendTable: React.FunctionComponent<LegendTableProps> = ({\r\n  items,\r\n  columns,\r\n  sortBy,\r\n  sortDesc,\r\n  itemRenderer,\r\n  className,\r\n  onToggleSort,\r\n}) => {\r\n  const theme = useContext(ThemeContext);\r\n\r\n  return (\r\n    <table\r\n      className={cx(\r\n        css`\r\n          width: 100%;\r\n          td {\r\n            padding: 2px 10px;\r\n          }\r\n        `,\r\n        className\r\n      )}\r\n    >\r\n      <thead>\r\n        <tr>\r\n          {columns.map(columnHeader => {\r\n            return (\r\n              <th\r\n                key={columnHeader}\r\n                className={css`\r\n                  color: ${theme.colors.blue};\r\n                  font-weight: bold;\r\n                  text-align: right;\r\n                  cursor: pointer;\r\n                `}\r\n                onClick={() => {\r\n                  if (onToggleSort) {\r\n                    onToggleSort(columnHeader);\r\n                  }\r\n                }}\r\n              >\r\n                {columnHeader}\r\n                {sortBy === columnHeader && (\r\n                  <span\r\n                    className={cx(\r\n                      `fa fa-caret-${sortDesc ? 'down' : 'up'}`,\r\n                      css`\r\n                        margin-left: ${theme.spacing.sm};\r\n                      `\r\n                    )}\r\n                  />\r\n                )}\r\n              </th>\r\n            );\r\n          })}\r\n        </tr>\r\n      </thead>\r\n      <tbody>\r\n        {items.map((item, index) => {\r\n          return itemRenderer ? (\r\n            itemRenderer(item, index)\r\n          ) : (\r\n            <tr key={`${item.label}-${index}`}>\r\n              <td>{item.label}</td>\r\n            </tr>\r\n          );\r\n        })}\r\n      </tbody>\r\n    </table>\r\n  );\r\n};\r\n","import React from 'react';\r\nimport { cx } from 'emotion';\r\n\r\nexport interface SeriesIconProps {\r\n  color: string;\r\n  className?: string;\r\n}\r\n\r\nexport const SeriesIcon: React.FunctionComponent<SeriesIconProps> = ({ color, className }) => {\r\n  return <i className={cx('fa', 'fa-minus', className)} style={{ color }} />;\r\n};\r\n\r\nSeriesIcon.displayName = 'SeriesIcon';\r\n","import React from 'react';\r\nimport { cx, css } from 'emotion';\r\nimport { stylesFactory } from '../../themes';\r\n\r\nexport interface ListProps<T> {\r\n  items: T[];\r\n  renderItem: (item: T, index: number) => JSX.Element;\r\n  getItemKey?: (item: T) => string;\r\n  className?: string;\r\n}\r\n\r\ninterface AbstractListProps<T> extends ListProps<T> {\r\n  inline?: boolean;\r\n}\r\n\r\nconst getStyles = stylesFactory((inlineList = false) => ({\r\n  list: css`\r\n    list-style-type: none;\r\n    margin: 0;\r\n    padding: 0;\r\n  `,\r\n\r\n  item: css`\r\n    display: ${(inlineList && 'inline-block') || 'block'};\r\n  `,\r\n}));\r\n\r\nexport class AbstractList<T> extends React.PureComponent<AbstractListProps<T>> {\r\n  constructor(props: AbstractListProps<T>) {\r\n    super(props);\r\n  }\r\n\r\n  render() {\r\n    const { items, renderItem, getItemKey, className, inline } = this.props;\r\n    const styles = getStyles(inline);\r\n\r\n    return (\r\n      <ul className={cx(styles.list, className)}>\r\n        {items.map((item, i) => {\r\n          return (\r\n            <li className={styles.item} key={getItemKey ? getItemKey(item) : i}>\r\n              {renderItem(item, i)}\r\n            </li>\r\n          );\r\n        })}\r\n      </ul>\r\n    );\r\n  }\r\n}\r\n","import React from 'react';\nimport { ListProps, AbstractList } from './AbstractList';\n\nexport class InlineList<T> extends React.PureComponent<ListProps<T>> {\n  render() {\n    return <AbstractList inline {...this.props} />;\n  }\n}\n","import React from 'react';\nimport { ListProps, AbstractList } from './AbstractList';\n\nexport class List<T> extends React.PureComponent<ListProps<T>> {\n  render() {\n    return <AbstractList {...this.props} />;\n  }\n}\n","import React, { SFC } from 'react';\r\n\r\ninterface LoadingPlaceholderProps {\r\n  text: string;\r\n}\r\n\r\nexport const LoadingPlaceholder: SFC<LoadingPlaceholderProps> = ({ text }) => (\r\n  <div className=\"gf-form-group\">\r\n    {text} <i className=\"fa fa-spinner fa-spin\" />\r\n  </div>\r\n);\r\n","import React, { PureComponent } from 'react';\r\nimport memoizeOne from 'memoize-one';\r\nimport { css, cx } from 'emotion';\r\nimport {\r\n  calculateFieldStats,\r\n  calculateLogsLabelStats,\r\n  calculateStats,\r\n  Field,\r\n  getParser,\r\n  LinkModel,\r\n  LogRowModel,\r\n  GrafanaTheme,\r\n} from '@grafana/data';\r\n\r\nimport { Themeable } from '../../types/theme';\r\nimport { withTheme } from '../../themes/index';\r\nimport { getLogRowStyles } from './getLogRowStyles';\r\nimport { stylesFactory } from '../../themes/stylesFactory';\r\nimport { selectThemeVariant } from '../../themes/selectThemeVariant';\r\n\r\n//Components\r\nimport { LogDetailsRow } from './LogDetailsRow';\r\n\r\ntype FieldDef = {\r\n  key: string;\r\n  value: string;\r\n  links?: string[];\r\n  fieldIndex?: number;\r\n};\r\n\r\nexport interface Props extends Themeable {\r\n  row: LogRowModel;\r\n  showDuplicates: boolean;\r\n  getRows: () => LogRowModel[];\r\n  className?: string;\r\n  onMouseEnter?: () => void;\r\n  onMouseLeave?: () => void;\r\n  onClickFilterLabel?: (key: string, value: string) => void;\r\n  onClickFilterOutLabel?: (key: string, value: string) => void;\r\n  getFieldLinks?: (field: Field, rowIndex: number) => Array<LinkModel<Field>>;\r\n}\r\n\r\nconst getStyles = stylesFactory((theme: GrafanaTheme) => {\r\n  const bgColor = selectThemeVariant({ light: theme.colors.gray7, dark: theme.colors.dark2 }, theme.type);\r\n  return {\r\n    hoverBackground: css`\r\n      label: hoverBackground;\r\n      background-color: ${bgColor};\r\n    `,\r\n    logsRowLevelDetails: css`\r\n      label: logs-row__level_details;\r\n      &::after {\r\n        top: -3px;\r\n      }\r\n    `,\r\n    logDetailsDefaultCursor: css`\r\n      label: logDetailsDefaultCursor;\r\n      cursor: default;\r\n    `,\r\n  };\r\n});\r\n\r\nclass UnThemedLogDetails extends PureComponent<Props> {\r\n  getParser = memoizeOne(getParser);\r\n\r\n  parseMessage = memoizeOne((rowEntry): FieldDef[] => {\r\n    const parser = this.getParser(rowEntry);\r\n    if (!parser) {\r\n      return [];\r\n    }\r\n    // Use parser to highlight detected fields\r\n    const parsedFields = parser.getFields(rowEntry);\r\n    const fields = parsedFields.map(field => {\r\n      const key = parser.getLabelFromField(field);\r\n      const value = parser.getValueFromField(field);\r\n      return { key, value };\r\n    });\r\n\r\n    return fields;\r\n  });\r\n\r\n  getDerivedFields = memoizeOne((row: LogRowModel): FieldDef[] => {\r\n    return (\r\n      row.dataFrame.fields\r\n        .map((field, index) => ({ ...field, index }))\r\n        // Remove Id which we use for react key and entry field which we are showing as the log message.\r\n        .filter((field, index) => 'id' !== field.name && row.entryFieldIndex !== index)\r\n        // Filter out fields without values. For example in elastic the fields are parsed from the document which can\r\n        // have different structure per row and so the dataframe is pretty sparse.\r\n        .filter(field => {\r\n          const value = field.values.get(row.rowIndex);\r\n          // Not sure exactly what will be the empty value here. And we want to keep 0 as some values can be non\r\n          // string.\r\n          return value !== null && value !== undefined;\r\n        })\r\n        .map(field => {\r\n          const { getFieldLinks } = this.props;\r\n          const links = getFieldLinks ? getFieldLinks(field, row.rowIndex) : [];\r\n          return {\r\n            key: field.name,\r\n            value: field.values.get(row.rowIndex).toString(),\r\n            links: links.map(link => link.href),\r\n            fieldIndex: field.index,\r\n          };\r\n        })\r\n    );\r\n  });\r\n\r\n  getAllFields = memoizeOne((row: LogRowModel) => {\r\n    const fields = this.parseMessage(row.entry);\r\n    const derivedFields = this.getDerivedFields(row);\r\n    const fieldsMap = [...derivedFields, ...fields].reduce((acc, field) => {\r\n      // Strip enclosing quotes for hashing. When values are parsed from log line the quotes are kept, but if same\r\n      // value is in the dataFrame it will be without the quotes. We treat them here as the same value.\r\n      const value = field.value.replace(/(^\")|(\"$)/g, '');\r\n      const fieldHash = `${field.key}=${value}`;\r\n      if (acc[fieldHash]) {\r\n        acc[fieldHash].links = [...(acc[fieldHash].links || []), ...(field.links || [])];\r\n      } else {\r\n        acc[fieldHash] = field;\r\n      }\r\n      return acc;\r\n    }, {} as { [key: string]: FieldDef });\r\n    return Object.values(fieldsMap);\r\n  });\r\n\r\n  getStatsForParsedField = (key: string) => {\r\n    const matcher = this.getParser(this.props.row.entry)!.buildMatcher(key);\r\n    return calculateFieldStats(this.props.getRows(), matcher);\r\n  };\r\n\r\n  render() {\r\n    const {\r\n      row,\r\n      theme,\r\n      onClickFilterOutLabel,\r\n      onClickFilterLabel,\r\n      getRows,\r\n      showDuplicates,\r\n      className,\r\n      onMouseEnter,\r\n      onMouseLeave,\r\n    } = this.props;\r\n    const style = getLogRowStyles(theme, row.logLevel);\r\n    const styles = getStyles(theme);\r\n    const labels = row.labels ? row.labels : {};\r\n    const labelsAvailable = Object.keys(labels).length > 0;\r\n    const fields = this.getAllFields(row);\r\n    const parsedFieldsAvailable = fields && fields.length > 0;\r\n\r\n    return (\r\n      <tr\r\n        className={cx(className, styles.logDetailsDefaultCursor)}\r\n        onMouseEnter={onMouseEnter}\r\n        onMouseLeave={onMouseLeave}\r\n      >\r\n        {showDuplicates && <td />}\r\n        <td className={cx(style.logsRowLevel, styles.logsRowLevelDetails)} />\r\n        <td colSpan={4}>\r\n          <div className={style.logDetailsContainer}>\r\n            <table className={style.logDetailsTable}>\r\n              <tbody>\r\n                {labelsAvailable && (\r\n                  <tr>\r\n                    <td colSpan={5} className={style.logDetailsHeading} aria-label=\"Log Labels\">\r\n                      Log Labels:\r\n                    </td>\r\n                  </tr>\r\n                )}\r\n                {Object.keys(labels).map(key => {\r\n                  const value = labels[key];\r\n                  return (\r\n                    <LogDetailsRow\r\n                      key={`${key}=${value}`}\r\n                      parsedKey={key}\r\n                      parsedValue={value}\r\n                      isLabel={true}\r\n                      getStats={() => calculateLogsLabelStats(getRows(), key)}\r\n                      onClickFilterOutLabel={onClickFilterOutLabel}\r\n                      onClickFilterLabel={onClickFilterLabel}\r\n                    />\r\n                  );\r\n                })}\r\n\r\n                {parsedFieldsAvailable && (\r\n                  <tr>\r\n                    <td colSpan={5} className={style.logDetailsHeading} aria-label=\"Parsed Fields\">\r\n                      Parsed Fields:\r\n                    </td>\r\n                  </tr>\r\n                )}\r\n                {fields.map(field => {\r\n                  const { key, value, links, fieldIndex } = field;\r\n                  return (\r\n                    <LogDetailsRow\r\n                      key={`${key}=${value}`}\r\n                      parsedKey={key}\r\n                      parsedValue={value}\r\n                      links={links}\r\n                      getStats={() =>\r\n                        fieldIndex === undefined\r\n                          ? this.getStatsForParsedField(key)\r\n                          : calculateStats(row.dataFrame.fields[fieldIndex].values.toArray())\r\n                      }\r\n                    />\r\n                  );\r\n                })}\r\n                {!parsedFieldsAvailable && !labelsAvailable && (\r\n                  <tr>\r\n                    <td colSpan={5} aria-label=\"No details\">\r\n                      No details available\r\n                    </td>\r\n                  </tr>\r\n                )}\r\n              </tbody>\r\n            </table>\r\n          </div>\r\n        </td>\r\n      </tr>\r\n    );\r\n  }\r\n}\r\n\r\nexport const LogDetails = withTheme(UnThemedLogDetails);\r\nLogDetails.displayName = 'LogDetails';\r\n","import React, { PureComponent } from 'react';\r\nimport { css, cx } from 'emotion';\r\nimport { LogLabelStatsModel, GrafanaTheme } from '@grafana/data';\r\n\r\nimport { Themeable } from '../../types/theme';\r\nimport { withTheme } from '../../themes/index';\r\nimport { getLogRowStyles } from './getLogRowStyles';\r\nimport { stylesFactory } from '../../themes/stylesFactory';\r\n\r\n//Components\r\nimport { LogLabelStats } from './LogLabelStats';\r\n\r\nexport interface Props extends Themeable {\r\n  parsedValue: string;\r\n  parsedKey: string;\r\n  isLabel?: boolean;\r\n  onClickFilterLabel?: (key: string, value: string) => void;\r\n  onClickFilterOutLabel?: (key: string, value: string) => void;\r\n  links?: string[];\r\n  getStats: () => LogLabelStatsModel[] | null;\r\n}\r\n\r\ninterface State {\r\n  showFieldsStats: boolean;\r\n  fieldCount: number;\r\n  fieldStats: LogLabelStatsModel[] | null;\r\n}\r\n\r\nconst getStyles = stylesFactory((theme: GrafanaTheme) => {\r\n  return {\r\n    noHoverBackground: css`\r\n      label: noHoverBackground;\r\n      :hover {\r\n        background-color: transparent;\r\n      }\r\n    `,\r\n    hoverCursor: css`\r\n      label: hoverCursor;\r\n      cursor: pointer;\r\n    `,\r\n    wordBreakAll: css`\r\n      label: wordBreakAll;\r\n      word-break: break-all;\r\n    `,\r\n  };\r\n});\r\n\r\nclass UnThemedLogDetailsRow extends PureComponent<Props, State> {\r\n  state: State = {\r\n    showFieldsStats: false,\r\n    fieldCount: 0,\r\n    fieldStats: null,\r\n  };\r\n\r\n  filterLabel = () => {\r\n    const { onClickFilterLabel, parsedKey, parsedValue } = this.props;\r\n    if (onClickFilterLabel) {\r\n      onClickFilterLabel(parsedKey, parsedValue);\r\n    }\r\n  };\r\n\r\n  filterOutLabel = () => {\r\n    const { onClickFilterOutLabel, parsedKey, parsedValue } = this.props;\r\n    if (onClickFilterOutLabel) {\r\n      onClickFilterOutLabel(parsedKey, parsedValue);\r\n    }\r\n  };\r\n\r\n  showStats = () => {\r\n    const { showFieldsStats } = this.state;\r\n    if (!showFieldsStats) {\r\n      const fieldStats = this.props.getStats();\r\n      const fieldCount = fieldStats ? fieldStats.reduce((sum, stat) => sum + stat.count, 0) : 0;\r\n      this.setState({ fieldStats, fieldCount });\r\n    }\r\n    this.toggleFieldsStats();\r\n  };\r\n\r\n  toggleFieldsStats() {\r\n    this.setState(state => {\r\n      return {\r\n        showFieldsStats: !state.showFieldsStats,\r\n      };\r\n    });\r\n  }\r\n\r\n  render() {\r\n    const { theme, parsedKey, parsedValue, isLabel, links } = this.props;\r\n    const { showFieldsStats, fieldStats, fieldCount } = this.state;\r\n    const styles = getStyles(theme);\r\n    const style = getLogRowStyles(theme);\r\n    return (\r\n      <tr className={cx(style.logDetailsValue, { [styles.noHoverBackground]: showFieldsStats })}>\r\n        {/* Action buttons - show stats/filter results */}\r\n        <td className={style.logsDetailsIcon} colSpan={isLabel ? undefined : 3}>\r\n          <i title=\"Ad-hoc statistics\" className={`fa fa-signal ${styles.hoverCursor}`} onClick={this.showStats} />\r\n        </td>\r\n\r\n        {isLabel && (\r\n          <>\r\n            <td className={style.logsDetailsIcon}>\r\n              <i\r\n                title=\"Filter for value\"\r\n                className={`fa fa-search-plus ${styles.hoverCursor}`}\r\n                onClick={this.filterLabel}\r\n              />\r\n            </td>\r\n            <td className={style.logsDetailsIcon}>\r\n              <i\r\n                title=\"Filter out value\"\r\n                className={`fa fa-search-minus ${styles.hoverCursor}`}\r\n                onClick={this.filterOutLabel}\r\n              />\r\n            </td>\r\n          </>\r\n        )}\r\n\r\n        {/* Key - value columns */}\r\n        <td className={style.logDetailsLabel}>{parsedKey}</td>\r\n        <td className={styles.wordBreakAll}>\r\n          {parsedValue}\r\n          {links &&\r\n            links.map(link => {\r\n              return (\r\n                <span key={link}>\r\n                  &nbsp;\r\n                  <a href={link} target={'_blank'}>\r\n                    <i className={'fa fa-external-link'} />\r\n                  </a>\r\n                </span>\r\n              );\r\n            })}\r\n          {showFieldsStats && (\r\n            <LogLabelStats\r\n              stats={fieldStats!}\r\n              label={parsedKey}\r\n              value={parsedValue}\r\n              rowCount={fieldCount}\r\n              isLabel={isLabel}\r\n            />\r\n          )}\r\n        </td>\r\n      </tr>\r\n    );\r\n  }\r\n}\r\n\r\nexport const LogDetailsRow = withTheme(UnThemedLogDetailsRow);\r\nLogDetailsRow.displayName = 'LogDetailsRow';\r\n","import React, { PureComponent } from 'react';\r\nimport { css } from 'emotion';\r\nimport { LogLabelStatsModel, GrafanaTheme } from '@grafana/data';\r\n\r\nimport { Themeable } from '../../types/theme';\r\nimport { stylesFactory } from '../../themes';\r\nimport { selectThemeVariant } from '../../themes/selectThemeVariant';\r\nimport { withTheme } from '../../themes/index';\r\n\r\n//Components\r\nimport { LogLabelStatsRow } from './LogLabelStatsRow';\r\n\r\nconst STATS_ROW_LIMIT = 5;\r\n\r\nconst getStyles = stylesFactory((theme: GrafanaTheme) => {\r\n  const borderColor = selectThemeVariant(\r\n    {\r\n      light: theme.colors.gray5,\r\n      dark: theme.colors.dark9,\r\n    },\r\n    theme.type\r\n  );\r\n  return {\r\n    logsStats: css`\r\n      label: logs-stats;\r\n      column-span: 2;\r\n      background: inherit;\r\n      color: ${theme.colors.text};\r\n      word-break: break-all;\r\n    `,\r\n    logsStatsHeader: css`\r\n      label: logs-stats__header;\r\n      border-bottom: 1px solid ${borderColor};\r\n      display: flex;\r\n    `,\r\n    logsStatsTitle: css`\r\n      label: logs-stats__title;\r\n      font-weight: ${theme.typography.weight.semibold};\r\n      padding-right: ${theme.spacing.d};\r\n      display: inline-block;\r\n      white-space: nowrap;\r\n      text-overflow: ellipsis;\r\n      flex-grow: 1;\r\n    `,\r\n    logsStatsClose: css`\r\n      label: logs-stats__close;\r\n      cursor: pointer;\r\n    `,\r\n    logsStatsBody: css`\r\n      label: logs-stats__body;\r\n      padding: 5px 0;\r\n    `,\r\n  };\r\n});\r\n\r\ninterface Props extends Themeable {\r\n  stats: LogLabelStatsModel[];\r\n  label: string;\r\n  value: string;\r\n  rowCount: number;\r\n  isLabel?: boolean;\r\n}\r\n\r\nclass UnThemedLogLabelStats extends PureComponent<Props> {\r\n  render() {\r\n    const { label, rowCount, stats, value, theme, isLabel } = this.props;\r\n    const style = getStyles(theme);\r\n    const topRows = stats.slice(0, STATS_ROW_LIMIT);\r\n    let activeRow = topRows.find(row => row.value === value);\r\n    let otherRows = stats.slice(STATS_ROW_LIMIT);\r\n    const insertActiveRow = !activeRow;\r\n\r\n    // Remove active row from other to show extra\r\n    if (insertActiveRow) {\r\n      activeRow = otherRows.find(row => row.value === value);\r\n      otherRows = otherRows.filter(row => row.value !== value);\r\n    }\r\n\r\n    const otherCount = otherRows.reduce((sum, row) => sum + row.count, 0);\r\n    const topCount = topRows.reduce((sum, row) => sum + row.count, 0);\r\n    const total = topCount + otherCount;\r\n    const otherProportion = otherCount / total;\r\n\r\n    return (\r\n      <td className={style.logsStats}>\r\n        <div className={style.logsStatsHeader}>\r\n          <div className={style.logsStatsTitle}>\r\n            {label}: {total} of {rowCount} rows have that {isLabel ? 'label' : 'field'}\r\n          </div>\r\n        </div>\r\n        <div className={style.logsStatsBody}>\r\n          {topRows.map(stat => (\r\n            <LogLabelStatsRow key={stat.value} {...stat} active={stat.value === value} />\r\n          ))}\r\n          {insertActiveRow && activeRow && <LogLabelStatsRow key={activeRow.value} {...activeRow} active />}\r\n          {otherCount > 0 && (\r\n            <LogLabelStatsRow key=\"__OTHERS__\" count={otherCount} value=\"Other\" proportion={otherProportion} />\r\n          )}\r\n        </div>\r\n      </td>\r\n    );\r\n  }\r\n}\r\n\r\nexport const LogLabelStats = withTheme(UnThemedLogLabelStats);\r\nLogLabelStats.displayName = 'LogLabelStats';\r\n","import React, { FunctionComponent, useContext } from 'react';\r\nimport { css, cx } from 'emotion';\r\n\r\nimport { ThemeContext } from '../../themes/ThemeContext';\r\nimport { GrafanaTheme } from '@grafana/data';\r\n\r\nconst getStyles = (theme: GrafanaTheme) => ({\r\n  logsStatsRow: css`\r\n    label: logs-stats-row;\r\n    margin: ${parseInt(theme.spacing.d, 10) / 1.75}px 0;\r\n  `,\r\n  logsStatsRowActive: css`\r\n    label: logs-stats-row--active;\r\n    color: ${theme.colors.blue};\r\n    position: relative;\r\n  `,\r\n  logsStatsRowLabel: css`\r\n    label: logs-stats-row__label;\r\n    display: flex;\r\n    margin-bottom: 1px;\r\n  `,\r\n  logsStatsRowValue: css`\r\n    label: logs-stats-row__value;\r\n    flex: 1;\r\n    text-overflow: ellipsis;\r\n    overflow: hidden;\r\n  `,\r\n  logsStatsRowCount: css`\r\n    label: logs-stats-row__count;\r\n    text-align: right;\r\n    margin-left: 0.5em;\r\n  `,\r\n  logsStatsRowPercent: css`\r\n    label: logs-stats-row__percent;\r\n    text-align: right;\r\n    margin-left: 0.5em;\r\n    width: 3em;\r\n  `,\r\n  logsStatsRowBar: css`\r\n    label: logs-stats-row__bar;\r\n    height: 4px;\r\n    overflow: hidden;\r\n    background: ${theme.colors.textFaint};\r\n  `,\r\n  logsStatsRowInnerBar: css`\r\n    label: logs-stats-row__innerbar;\r\n    height: 4px;\r\n    overflow: hidden;\r\n    background: ${theme.colors.textFaint};\r\n    background: ${theme.colors.blue};\r\n  `,\r\n});\r\n\r\nexport interface Props {\r\n  active?: boolean;\r\n  count: number;\r\n  proportion: number;\r\n  value?: string;\r\n}\r\n\r\nexport const LogLabelStatsRow: FunctionComponent<Props> = ({ active, count, proportion, value }) => {\r\n  const theme = useContext(ThemeContext);\r\n  const style = getStyles(theme);\r\n  const percent = `${Math.round(proportion * 100)}%`;\r\n  const barStyle = { width: percent };\r\n  const className = active ? cx([style.logsStatsRow, style.logsStatsRowActive]) : cx([style.logsStatsRow]);\r\n\r\n  return (\r\n    <div className={className}>\r\n      <div className={cx([style.logsStatsRowLabel])}>\r\n        <div className={cx([style.logsStatsRowValue])} title={value}>\r\n          {value}\r\n        </div>\r\n        <div className={cx([style.logsStatsRowCount])}>{count}</div>\r\n        <div className={cx([style.logsStatsRowPercent])}>{percent}</div>\r\n      </div>\r\n      <div className={cx([style.logsStatsRowBar])}>\r\n        <div className={cx([style.logsStatsRowInnerBar])} style={barStyle} />\r\n      </div>\r\n    </div>\r\n  );\r\n};\r\n\r\nLogLabelStatsRow.displayName = 'LogLabelStatsRow';\r\n","import React, { FunctionComponent } from 'react';\r\nimport { css, cx } from 'emotion';\r\nimport { Labels } from '@grafana/data';\r\n\r\nimport { stylesFactory } from '../../themes';\r\nimport { Themeable } from '../../types/theme';\r\nimport { GrafanaTheme } from '@grafana/data';\r\nimport { selectThemeVariant } from '../../themes/selectThemeVariant';\r\nimport { withTheme } from '../../themes/ThemeContext';\r\n\r\n// Levels are already encoded in color, filename is a Loki-ism\r\nconst HIDDEN_LABELS = ['level', 'lvl', 'filename'];\r\n\r\nconst getStyles = stylesFactory((theme: GrafanaTheme) => {\r\n  return {\r\n    logsLabels: css`\r\n      display: flex;\r\n      flex-wrap: wrap;\r\n      font-size: ${theme.typography.size.xs};\r\n    `,\r\n    logsLabel: css`\r\n      label: logs-label;\r\n      display: flex;\r\n      padding: 0 2px;\r\n      background-color: ${selectThemeVariant({ light: theme.colors.gray5, dark: theme.colors.dark6 }, theme.type)};\r\n      border-radius: ${theme.border.radius};\r\n      margin: 1px 4px 0 0;\r\n      text-overflow: ellipsis;\r\n      white-space: nowrap;\r\n      overflow: hidden;\r\n    `,\r\n    logsLabelValue: css`\r\n      label: logs-label__value;\r\n      display: inline-block;\r\n      max-width: 20em;\r\n      text-overflow: ellipsis;\r\n      overflow: hidden;\r\n    `,\r\n  };\r\n});\r\n\r\ninterface Props extends Themeable {\r\n  labels: Labels;\r\n}\r\n\r\nexport const UnThemedLogLabels: FunctionComponent<Props> = ({ labels, theme }) => {\r\n  const styles = getStyles(theme);\r\n  const displayLabels = Object.keys(labels).filter(label => !label.startsWith('_') && !HIDDEN_LABELS.includes(label));\r\n\r\n  if (displayLabels.length === 0) {\r\n    return (\r\n      <span className={cx([styles.logsLabels])}>\r\n        <span className={cx([styles.logsLabel])}>(no unique labels)</span>\r\n      </span>\r\n    );\r\n  }\r\n\r\n  return (\r\n    <span className={cx([styles.logsLabels])}>\r\n      {displayLabels.map(label => {\r\n        const value = labels[label];\r\n        const tooltip = `${label}: ${value}`;\r\n        return (\r\n          <span key={label} className={cx([styles.logsLabel])}>\r\n            <span className={cx([styles.logsLabelValue])} title={tooltip}>\r\n              {value}\r\n            </span>\r\n          </span>\r\n        );\r\n      })}\r\n    </span>\r\n  );\r\n};\r\n\r\nexport const LogLabels = withTheme(UnThemedLogLabels);\r\nLogLabels.displayName = 'LogLabels';\r\n","import React, { PureComponent } from 'react';\r\nimport ansicolor from '../../utils/ansicolor';\r\n\r\ninterface Style {\r\n  [key: string]: string;\r\n}\r\n\r\ninterface ParsedChunk {\r\n  style: Style;\r\n  text: string;\r\n}\r\n\r\nfunction convertCSSToStyle(css: string): Style {\r\n  return css.split(/;\\s*/).reduce((accumulated, line) => {\r\n    const match = line.match(/([^:\\s]+)\\s*:\\s*(.+)/);\r\n\r\n    if (match && match[1] && match[2]) {\r\n      const key = match[1].replace(/-([a-z])/g, (_, character) => character.toUpperCase());\r\n      // @ts-ignore\r\n      accumulated[key] = match[2];\r\n    }\r\n\r\n    return accumulated;\r\n  }, {});\r\n}\r\n\r\ninterface Props {\r\n  value: string;\r\n}\r\n\r\ninterface State {\r\n  chunks: ParsedChunk[];\r\n  prevValue: string;\r\n}\r\n\r\nexport class LogMessageAnsi extends PureComponent<Props, State> {\r\n  state: State = {\r\n    chunks: [],\r\n    prevValue: '',\r\n  };\r\n\r\n  static getDerivedStateFromProps(props: Props, state: State) {\r\n    if (props.value === state.prevValue) {\r\n      return null;\r\n    }\r\n\r\n    const parsed = ansicolor.parse(props.value);\r\n\r\n    return {\r\n      chunks: parsed.spans.map(span => {\r\n        return span.css\r\n          ? {\r\n              style: convertCSSToStyle(span.css),\r\n              text: span.text,\r\n            }\r\n          : { text: span.text };\r\n      }),\r\n      prevValue: props.value,\r\n    };\r\n  }\r\n\r\n  render() {\r\n    const { chunks } = this.state;\r\n\r\n    return chunks.map((chunk, index) =>\r\n      chunk.style ? (\r\n        <span key={index} style={chunk.style}>\r\n          {chunk.text}\r\n        </span>\r\n      ) : (\r\n        chunk.text\r\n      )\r\n    );\r\n  }\r\n}\r\n","import React, { PureComponent } from 'react';\r\nimport { Field, LinkModel, LogRowModel, TimeZone, DataQueryResponse, GrafanaTheme } from '@grafana/data';\r\nimport { cx, css } from 'emotion';\r\n\r\nimport {\r\n  LogRowContextRows,\r\n  LogRowContextQueryErrors,\r\n  HasMoreContextRows,\r\n  LogRowContextProvider,\r\n} from './LogRowContextProvider';\r\nimport { Themeable } from '../../types/theme';\r\nimport { withTheme } from '../../themes/index';\r\nimport { getLogRowStyles } from './getLogRowStyles';\r\nimport { stylesFactory } from '../../themes/stylesFactory';\r\nimport { selectThemeVariant } from '../../themes/selectThemeVariant';\r\n\r\n//Components\r\nimport { LogDetails } from './LogDetails';\r\nimport { LogRowMessage } from './LogRowMessage';\r\nimport { LogLabels } from './LogLabels';\r\n\r\ninterface Props extends Themeable {\r\n  highlighterExpressions?: string[];\r\n  row: LogRowModel;\r\n  showDuplicates: boolean;\r\n  showLabels: boolean;\r\n  showTime: boolean;\r\n  wrapLogMessage: boolean;\r\n  timeZone: TimeZone;\r\n  allowDetails?: boolean;\r\n  getRows: () => LogRowModel[];\r\n  onClickFilterLabel?: (key: string, value: string) => void;\r\n  onClickFilterOutLabel?: (key: string, value: string) => void;\r\n  onContextClick?: () => void;\r\n  getRowContext: (row: LogRowModel, options?: any) => Promise<DataQueryResponse>;\r\n  getFieldLinks?: (field: Field, rowIndex: number) => Array<LinkModel<Field>>;\r\n}\r\n\r\ninterface State {\r\n  showContext: boolean;\r\n  showDetails: boolean;\r\n  hasHoverBackground: boolean;\r\n}\r\n\r\nconst getStyles = stylesFactory((theme: GrafanaTheme) => {\r\n  const bgColor = selectThemeVariant({ light: theme.colors.gray7, dark: theme.colors.dark2 }, theme.type);\r\n  return {\r\n    topVerticalAlign: css`\r\n      label: topVerticalAlign;\r\n      vertical-align: top;\r\n    `,\r\n    hoverBackground: css`\r\n      label: hoverBackground;\r\n      background-color: ${bgColor};\r\n    `,\r\n  };\r\n});\r\n/**\r\n * Renders a log line.\r\n *\r\n * When user hovers over it for a certain time, it lazily parses the log line.\r\n * Once a parser is found, it will determine fields, that will be highlighted.\r\n * When the user requests stats for a field, they will be calculated and rendered below the row.\r\n */\r\nclass UnThemedLogRow extends PureComponent<Props, State> {\r\n  state: State = {\r\n    showContext: false,\r\n    showDetails: false,\r\n    hasHoverBackground: false,\r\n  };\r\n\r\n  toggleContext = () => {\r\n    this.setState(state => {\r\n      return {\r\n        showContext: !state.showContext,\r\n      };\r\n    });\r\n  };\r\n\r\n  /**\r\n   * We are using onMouse events to change background of Log Details Table to hover-state-background when\r\n   * hovered over Log Row and vice versa. This can't be done with css because we use 2 separate table rows without common parent element.\r\n   */\r\n  addHoverBackground = () => {\r\n    this.setState({\r\n      hasHoverBackground: true,\r\n    });\r\n  };\r\n\r\n  clearHoverBackground = () => {\r\n    this.setState({\r\n      hasHoverBackground: false,\r\n    });\r\n  };\r\n\r\n  toggleDetails = () => {\r\n    if (this.props.allowDetails) {\r\n      return;\r\n    }\r\n    this.setState(state => {\r\n      return {\r\n        showDetails: !state.showDetails,\r\n      };\r\n    });\r\n  };\r\n\r\n  renderLogRow(\r\n    context?: LogRowContextRows,\r\n    errors?: LogRowContextQueryErrors,\r\n    hasMoreContextRows?: HasMoreContextRows,\r\n    updateLimit?: () => void\r\n  ) {\r\n    const {\r\n      getRows,\r\n      onClickFilterLabel,\r\n      onClickFilterOutLabel,\r\n      highlighterExpressions,\r\n      allowDetails,\r\n      row,\r\n      showDuplicates,\r\n      timeZone,\r\n      showLabels,\r\n      showTime,\r\n      wrapLogMessage,\r\n      theme,\r\n      getFieldLinks,\r\n    } = this.props;\r\n    const { showDetails, showContext, hasHoverBackground } = this.state;\r\n    const style = getLogRowStyles(theme, row.logLevel);\r\n    const styles = getStyles(theme);\r\n    const showUtc = timeZone === 'utc';\r\n    const showDetailsClassName = showDetails\r\n      ? cx(['fa fa-chevron-down', styles.topVerticalAlign])\r\n      : cx(['fa fa-chevron-right', styles.topVerticalAlign]);\r\n    const hoverBackground = cx(style.logsRow, { [styles.hoverBackground]: hasHoverBackground });\r\n\r\n    return (\r\n      <>\r\n        <tr\r\n          className={hoverBackground}\r\n          onMouseEnter={this.addHoverBackground}\r\n          onMouseLeave={this.clearHoverBackground}\r\n          onClick={this.toggleDetails}\r\n        >\r\n          {showDuplicates && (\r\n            <td className={style.logsRowDuplicates}>\r\n              {row.duplicates && row.duplicates > 0 ? `${row.duplicates + 1}x` : null}\r\n            </td>\r\n          )}\r\n          <td className={style.logsRowLevel} />\r\n          {!allowDetails && (\r\n            <td title={showDetails ? 'Hide log details' : 'See log details'} className={style.logsRowToggleDetails}>\r\n              <i className={showDetailsClassName} />\r\n            </td>\r\n          )}\r\n          {showTime && showUtc && (\r\n            <td className={style.logsRowLocalTime} title={`Local: ${row.timeLocal} (${row.timeFromNow})`}>\r\n              {row.timeUtc}\r\n            </td>\r\n          )}\r\n          {showTime && !showUtc && (\r\n            <td className={style.logsRowLocalTime} title={`${row.timeUtc} (${row.timeFromNow})`}>\r\n              {row.timeLocal}\r\n            </td>\r\n          )}\r\n          {showLabels && row.uniqueLabels && (\r\n            <td className={style.logsRowLabels}>\r\n              <LogLabels labels={row.uniqueLabels} />\r\n            </td>\r\n          )}\r\n          <LogRowMessage\r\n            highlighterExpressions={highlighterExpressions}\r\n            row={row}\r\n            getRows={getRows}\r\n            errors={errors}\r\n            hasMoreContextRows={hasMoreContextRows}\r\n            updateLimit={updateLimit}\r\n            context={context}\r\n            showContext={showContext}\r\n            wrapLogMessage={wrapLogMessage}\r\n            onToggleContext={this.toggleContext}\r\n          />\r\n        </tr>\r\n        {this.state.showDetails && (\r\n          <LogDetails\r\n            className={hoverBackground}\r\n            onMouseEnter={this.addHoverBackground}\r\n            onMouseLeave={this.clearHoverBackground}\r\n            showDuplicates={showDuplicates}\r\n            getFieldLinks={getFieldLinks}\r\n            onClickFilterLabel={onClickFilterLabel}\r\n            onClickFilterOutLabel={onClickFilterOutLabel}\r\n            getRows={getRows}\r\n            row={row}\r\n          />\r\n        )}\r\n      </>\r\n    );\r\n  }\r\n\r\n  render() {\r\n    const { showContext } = this.state;\r\n\r\n    if (showContext) {\r\n      return (\r\n        <>\r\n          <LogRowContextProvider row={this.props.row} getRowContext={this.props.getRowContext}>\r\n            {({ result, errors, hasMoreContextRows, updateLimit }) => {\r\n              return <>{this.renderLogRow(result, errors, hasMoreContextRows, updateLimit)}</>;\r\n            }}\r\n          </LogRowContextProvider>\r\n        </>\r\n      );\r\n    }\r\n\r\n    return this.renderLogRow();\r\n  }\r\n}\r\n\r\nexport const LogRow = withTheme(UnThemedLogRow);\r\nLogRow.displayName = 'LogRow';\r\n","import React, { useContext, useRef, useState, useLayoutEffect } from 'react';\r\nimport { LogRowModel } from '@grafana/data';\r\nimport { css, cx } from 'emotion';\r\n\r\nimport { Alert } from '../Alert/Alert';\r\nimport { LogRowContextRows, LogRowContextQueryErrors, HasMoreContextRows } from './LogRowContextProvider';\r\nimport { GrafanaTheme } from '@grafana/data';\r\nimport { selectThemeVariant } from '../../themes/selectThemeVariant';\r\nimport { DataQueryError } from '@grafana/data';\r\nimport { ThemeContext } from '../../themes/ThemeContext';\r\nimport { CustomScrollbar } from '../CustomScrollbar/CustomScrollbar';\r\nimport { List } from '../List/List';\r\nimport { ClickOutsideWrapper } from '../ClickOutsideWrapper/ClickOutsideWrapper';\r\n\r\ninterface LogRowContextProps {\r\n  row: LogRowModel;\r\n  context: LogRowContextRows;\r\n  errors?: LogRowContextQueryErrors;\r\n  hasMoreContextRows?: HasMoreContextRows;\r\n  onOutsideClick: () => void;\r\n  onLoadMoreContext: () => void;\r\n}\r\n\r\nconst getLogRowContextStyles = (theme: GrafanaTheme) => {\r\n  const gradientTop = selectThemeVariant(\r\n    {\r\n      light: theme.colors.white,\r\n      dark: theme.colors.dark1,\r\n    },\r\n    theme.type\r\n  );\r\n  const gradientBottom = selectThemeVariant(\r\n    {\r\n      light: theme.colors.gray7,\r\n      dark: theme.colors.dark2,\r\n    },\r\n    theme.type\r\n  );\r\n\r\n  const boxShadowColor = selectThemeVariant(\r\n    {\r\n      light: theme.colors.gray5,\r\n      dark: theme.colors.black,\r\n    },\r\n    theme.type\r\n  );\r\n  const borderColor = selectThemeVariant(\r\n    {\r\n      light: theme.colors.gray5,\r\n      dark: theme.colors.dark9,\r\n    },\r\n    theme.type\r\n  );\r\n\r\n  return {\r\n    commonStyles: css`\r\n      position: absolute;\r\n      width: calc(100% + 20px);\r\n      left: -10px;\r\n      height: 250px;\r\n      z-index: 2;\r\n      overflow: hidden;\r\n      background: ${theme.colors.pageBg};\r\n      background: linear-gradient(180deg, ${gradientTop} 0%, ${gradientBottom} 104.25%);\r\n      box-shadow: 0px 2px 4px ${boxShadowColor}, 0px 0px 2px ${boxShadowColor};\r\n      border: 1px solid ${borderColor};\r\n      border-radius: ${theme.border.radius.md};\r\n    `,\r\n    header: css`\r\n      height: 30px;\r\n      padding: 0 10px;\r\n      display: flex;\r\n      align-items: center;\r\n      background: ${borderColor};\r\n    `,\r\n    logs: css`\r\n      height: 220px;\r\n      padding: 10px;\r\n    `,\r\n  };\r\n};\r\n\r\ninterface LogRowContextGroupHeaderProps {\r\n  row: LogRowModel;\r\n  rows: Array<string | DataQueryError>;\r\n  onLoadMoreContext: () => void;\r\n  shouldScrollToBottom?: boolean;\r\n  canLoadMoreRows?: boolean;\r\n}\r\ninterface LogRowContextGroupProps extends LogRowContextGroupHeaderProps {\r\n  rows: Array<string | DataQueryError>;\r\n  className: string;\r\n  error?: string;\r\n}\r\n\r\nconst LogRowContextGroupHeader: React.FunctionComponent<LogRowContextGroupHeaderProps> = ({\r\n  row,\r\n  rows,\r\n  onLoadMoreContext,\r\n  canLoadMoreRows,\r\n}) => {\r\n  const theme = useContext(ThemeContext);\r\n  const { header } = getLogRowContextStyles(theme);\r\n\r\n  return (\r\n    <div className={header}>\r\n      <span\r\n        className={css`\r\n          opacity: 0.6;\r\n        `}\r\n      >\r\n        Found {rows.length} rows.\r\n      </span>\r\n      {(rows.length >= 10 || (rows.length > 10 && rows.length % 10 !== 0)) && canLoadMoreRows && (\r\n        <span\r\n          className={css`\r\n            margin-left: 10px;\r\n            &:hover {\r\n              text-decoration: underline;\r\n              cursor: pointer;\r\n            }\r\n          `}\r\n          onClick={() => onLoadMoreContext()}\r\n        >\r\n          Load 10 more\r\n        </span>\r\n      )}\r\n    </div>\r\n  );\r\n};\r\n\r\nconst LogRowContextGroup: React.FunctionComponent<LogRowContextGroupProps> = ({\r\n  row,\r\n  rows,\r\n  error,\r\n  className,\r\n  shouldScrollToBottom,\r\n  canLoadMoreRows,\r\n  onLoadMoreContext,\r\n}) => {\r\n  const theme = useContext(ThemeContext);\r\n  const { commonStyles, logs } = getLogRowContextStyles(theme);\r\n  const [scrollTop, setScrollTop] = useState(0);\r\n  const listContainerRef = useRef<HTMLDivElement>() as React.RefObject<HTMLDivElement>;\r\n\r\n  useLayoutEffect(() => {\r\n    if (shouldScrollToBottom && listContainerRef.current) {\r\n      setScrollTop(listContainerRef.current.offsetHeight);\r\n    }\r\n  });\r\n\r\n  const headerProps = {\r\n    row,\r\n    rows,\r\n    onLoadMoreContext,\r\n    canLoadMoreRows,\r\n  };\r\n\r\n  return (\r\n    <div className={cx(className, commonStyles)}>\r\n      {/* When displaying \"after\" context */}\r\n      {shouldScrollToBottom && !error && <LogRowContextGroupHeader {...headerProps} />}\r\n      <div className={logs}>\r\n        <CustomScrollbar autoHide scrollTop={scrollTop}>\r\n          <div ref={listContainerRef}>\r\n            {!error && (\r\n              <List\r\n                items={rows}\r\n                renderItem={item => {\r\n                  return (\r\n                    <div\r\n                      className={css`\r\n                        padding: 5px 0;\r\n                      `}\r\n                    >\r\n                      {item}\r\n                    </div>\r\n                  );\r\n                }}\r\n              />\r\n            )}\r\n            {error && <Alert title={error} />}\r\n          </div>\r\n        </CustomScrollbar>\r\n      </div>\r\n      {/* When displaying \"before\" context */}\r\n      {!shouldScrollToBottom && !error && <LogRowContextGroupHeader {...headerProps} />}\r\n    </div>\r\n  );\r\n};\r\n\r\nexport const LogRowContext: React.FunctionComponent<LogRowContextProps> = ({\r\n  row,\r\n  context,\r\n  errors,\r\n  onOutsideClick,\r\n  onLoadMoreContext,\r\n  hasMoreContextRows,\r\n}) => {\r\n  return (\r\n    <ClickOutsideWrapper onClick={onOutsideClick}>\r\n      <div>\r\n        {context.after && (\r\n          <LogRowContextGroup\r\n            rows={context.after}\r\n            error={errors && errors.after}\r\n            row={row}\r\n            className={css`\r\n              top: -250px;\r\n            `}\r\n            shouldScrollToBottom\r\n            canLoadMoreRows={hasMoreContextRows ? hasMoreContextRows.after : false}\r\n            onLoadMoreContext={onLoadMoreContext}\r\n          />\r\n        )}\r\n\r\n        {context.before && (\r\n          <LogRowContextGroup\r\n            onLoadMoreContext={onLoadMoreContext}\r\n            canLoadMoreRows={hasMoreContextRows ? hasMoreContextRows.before : false}\r\n            row={row}\r\n            rows={context.before}\r\n            error={errors && errors.before}\r\n            className={css`\r\n              top: 100%;\r\n            `}\r\n          />\r\n        )}\r\n      </div>\r\n    </ClickOutsideWrapper>\r\n  );\r\n};\r\n","import { LogRowModel, toDataFrame, Field, FieldCache } from '@grafana/data';\r\nimport React, { useState, useEffect } from 'react';\r\nimport flatten from 'lodash/flatten';\r\nimport useAsync from 'react-use/lib/useAsync';\r\n\r\nimport { DataQueryResponse, DataQueryError } from '@grafana/data';\r\n\r\nexport interface LogRowContextRows {\r\n  before?: string[];\r\n  after?: string[];\r\n}\r\nexport interface LogRowContextQueryErrors {\r\n  before?: string;\r\n  after?: string;\r\n}\r\n\r\nexport interface HasMoreContextRows {\r\n  before: boolean;\r\n  after: boolean;\r\n}\r\n\r\ninterface ResultType {\r\n  data: string[][];\r\n  errors: string[];\r\n}\r\n\r\ninterface LogRowContextProviderProps {\r\n  row: LogRowModel;\r\n  getRowContext: (row: LogRowModel, options?: any) => Promise<DataQueryResponse>;\r\n  children: (props: {\r\n    result: LogRowContextRows;\r\n    errors: LogRowContextQueryErrors;\r\n    hasMoreContextRows: HasMoreContextRows;\r\n    updateLimit: () => void;\r\n  }) => JSX.Element;\r\n}\r\n\r\nexport const getRowContexts = async (\r\n  getRowContext: (row: LogRowModel, options?: any) => Promise<DataQueryResponse>,\r\n  row: LogRowModel,\r\n  limit: number\r\n) => {\r\n  const promises = [\r\n    getRowContext(row, {\r\n      limit,\r\n    }),\r\n    getRowContext(row, {\r\n      // The start time is inclusive so we will get the one row we are using as context entry\r\n      limit: limit + 1,\r\n      direction: 'FORWARD',\r\n    }),\r\n  ];\r\n\r\n  const results: Array<DataQueryResponse | DataQueryError> = await Promise.all(promises.map(p => p.catch(e => e)));\r\n\r\n  return {\r\n    data: results.map(result => {\r\n      const dataResult: DataQueryResponse = result as DataQueryResponse;\r\n      if (!dataResult.data) {\r\n        return [];\r\n      }\r\n\r\n      const data: any[] = [];\r\n      for (let index = 0; index < dataResult.data.length; index++) {\r\n        const dataFrame = toDataFrame(dataResult.data[index]);\r\n        const fieldCache = new FieldCache(dataFrame);\r\n        const timestampField: Field<string> = fieldCache.getFieldByName('ts')!;\r\n        const idField: Field<string> | undefined = fieldCache.getFieldByName('id');\r\n\r\n        for (let fieldIndex = 0; fieldIndex < timestampField.values.length; fieldIndex++) {\r\n          // TODO: this filtering is datasource dependant so it will make sense to move it there so the API is\r\n          //  to return correct list of lines handling inclusive ranges or how to filter the correct line on the\r\n          //  datasource.\r\n\r\n          // Filter out the row that is the one used as a focal point for the context as we will get it in one of the\r\n          // requests.\r\n          if (idField) {\r\n            // For Loki this means we filter only the one row. Issue is we could have other rows logged at the same\r\n            // ns which came before but they come in the response that search for logs after. This means right now\r\n            // we will show those as if they came after. This is not strictly correct but seems better than loosing them\r\n            // and making this correct would mean quite a bit of complexity to shuffle things around and messing up\r\n            //counts.\r\n            if (idField.values.get(fieldIndex) === row.uid) {\r\n              continue;\r\n            }\r\n          } else {\r\n            // Fallback to timestamp. This should not happen right now as this feature is implemented only for loki\r\n            // and that has ID. Later this branch could be used in other DS but mind that this could also filter out\r\n            // logs which were logged in the same timestamp and that can be a problem depending on the precision.\r\n            if (parseInt(timestampField.values.get(fieldIndex), 10) === row.timeEpochMs) {\r\n              continue;\r\n            }\r\n          }\r\n\r\n          const lineField: Field<string> = dataFrame.fields.filter(field => field.name === 'line')[0];\r\n          const line = lineField.values.get(fieldIndex); // assuming that both fields have same length\r\n\r\n          if (data.length === 0) {\r\n            data[0] = [line];\r\n          } else {\r\n            data[0].push(line);\r\n          }\r\n        }\r\n      }\r\n\r\n      return data;\r\n    }),\r\n    errors: results.map(result => {\r\n      const errorResult: DataQueryError = result as DataQueryError;\r\n      if (!errorResult.message) {\r\n        return '';\r\n      }\r\n\r\n      return errorResult.message;\r\n    }),\r\n  };\r\n};\r\n\r\nexport const LogRowContextProvider: React.FunctionComponent<LogRowContextProviderProps> = ({\r\n  getRowContext,\r\n  row,\r\n  children,\r\n}) => {\r\n  // React Hook that creates a number state value called limit to component state and a setter function called setLimit\r\n  // The intial value for limit is 10\r\n  // Used for the number of rows to retrieve from backend from a specific point in time\r\n  const [limit, setLimit] = useState(10);\r\n\r\n  // React Hook that creates an object state value called result to component state and a setter function called setResult\r\n  // The intial value for result is null\r\n  // Used for sorting the response from backend\r\n  const [result, setResult] = useState<ResultType>((null as any) as ResultType);\r\n\r\n  // React Hook that creates an object state value called hasMoreContextRows to component state and a setter function called setHasMoreContextRows\r\n  // The intial value for hasMoreContextRows is {before: true, after: true}\r\n  // Used for indicating in UI if there are more rows to load in a given direction\r\n  const [hasMoreContextRows, setHasMoreContextRows] = useState({\r\n    before: true,\r\n    after: true,\r\n  });\r\n\r\n  // React Hook that resolves two promises every time the limit prop changes\r\n  // First promise fetches limit number of rows backwards in time from a specific point in time\r\n  // Second promise fetches limit number of rows forwards in time from a specific point in time\r\n  const { value } = useAsync(async () => {\r\n    return await getRowContexts(getRowContext, row, limit); // Moved it to a separate function for debugging purposes\r\n  }, [limit]);\r\n\r\n  // React Hook that performs a side effect every time the value (from useAsync hook) prop changes\r\n  // The side effect changes the result state with the response from the useAsync hook\r\n  // The side effect changes the hasMoreContextRows state if there are more context rows before or after the current result\r\n  useEffect(() => {\r\n    if (value) {\r\n      setResult((currentResult: any) => {\r\n        let hasMoreLogsBefore = true,\r\n          hasMoreLogsAfter = true;\r\n\r\n        if (currentResult && currentResult.data[0].length === value.data[0].length) {\r\n          hasMoreLogsBefore = false;\r\n        }\r\n\r\n        if (currentResult && currentResult.data[1].length === value.data[1].length) {\r\n          hasMoreLogsAfter = false;\r\n        }\r\n\r\n        setHasMoreContextRows({\r\n          before: hasMoreLogsBefore,\r\n          after: hasMoreLogsAfter,\r\n        });\r\n\r\n        return value;\r\n      });\r\n    }\r\n  }, [value]);\r\n\r\n  return children({\r\n    result: {\r\n      before: result ? flatten(result.data[0]) : [],\r\n      after: result ? flatten(result.data[1]) : [],\r\n    },\r\n    errors: {\r\n      before: result ? result.errors[0] : undefined,\r\n      after: result ? result.errors[1] : undefined,\r\n    },\r\n    hasMoreContextRows,\r\n    updateLimit: () => setLimit(limit + 10),\r\n  });\r\n};\r\n","import React, { PureComponent } from 'react';\r\nimport _ from 'lodash';\r\nimport tinycolor from 'tinycolor2';\r\nimport { css, cx } from 'emotion';\r\nimport { LogRowModel, findHighlightChunksInText, GrafanaTheme } from '@grafana/data';\r\n\r\n// @ts-ignore\r\nimport Highlighter from 'react-highlight-words';\r\nimport { LogRowContextQueryErrors, HasMoreContextRows, LogRowContextRows } from './LogRowContextProvider';\r\nimport { selectThemeVariant } from '../../index';\r\nimport { Themeable } from '../../types/theme';\r\nimport { withTheme } from '../../themes/index';\r\nimport { getLogRowStyles } from './getLogRowStyles';\r\nimport { stylesFactory } from '../../themes/stylesFactory';\r\n\r\n//Components\r\nimport { LogRowContext } from './LogRowContext';\r\nimport { LogMessageAnsi } from './LogMessageAnsi';\r\n\r\ninterface Props extends Themeable {\r\n  row: LogRowModel;\r\n  hasMoreContextRows?: HasMoreContextRows;\r\n  showContext: boolean;\r\n  wrapLogMessage: boolean;\r\n  errors?: LogRowContextQueryErrors;\r\n  context?: LogRowContextRows;\r\n  highlighterExpressions?: string[];\r\n  getRows: () => LogRowModel[];\r\n  onToggleContext: () => void;\r\n  updateLimit?: () => void;\r\n}\r\n\r\nconst getStyles = stylesFactory((theme: GrafanaTheme) => {\r\n  const outlineColor = selectThemeVariant(\r\n    {\r\n      light: theme.colors.white,\r\n      dark: theme.colors.black,\r\n    },\r\n    theme.type\r\n  );\r\n\r\n  return {\r\n    positionRelative: css`\r\n      label: positionRelative;\r\n      position: relative;\r\n    `,\r\n    rowWithContext: css`\r\n      label: rowWithContext;\r\n      z-index: 1;\r\n      outline: 9999px solid\r\n        ${tinycolor(outlineColor as tinycolor.ColorInput)\r\n          .setAlpha(0.7)\r\n          .toRgbString()};\r\n    `,\r\n    whiteSpacePreWrap: css`\r\n      label: whiteSpacePreWrap;\r\n      white-space: pre-wrap;\r\n    `,\r\n    horizontalScroll: css`\r\n      label: verticalScroll;\r\n      white-space: nowrap;\r\n    `,\r\n  };\r\n});\r\n\r\nclass UnThemedLogRowMessage extends PureComponent<Props> {\r\n  onContextToggle = (e: React.SyntheticEvent<HTMLElement>) => {\r\n    e.stopPropagation();\r\n    this.props.onToggleContext();\r\n  };\r\n\r\n  render() {\r\n    const {\r\n      highlighterExpressions,\r\n      row,\r\n      theme,\r\n      errors,\r\n      hasMoreContextRows,\r\n      updateLimit,\r\n      context,\r\n      showContext,\r\n      wrapLogMessage,\r\n      onToggleContext,\r\n    } = this.props;\r\n\r\n    const style = getLogRowStyles(theme, row.logLevel);\r\n    const { entry, hasAnsi, raw } = row;\r\n\r\n    const previewHighlights = highlighterExpressions && !_.isEqual(highlighterExpressions, row.searchWords);\r\n    const highlights = previewHighlights ? highlighterExpressions : row.searchWords;\r\n    const needsHighlighter = highlights && highlights.length > 0 && highlights[0] && highlights[0].length > 0;\r\n    const highlightClassName = previewHighlights\r\n      ? cx([style.logsRowMatchHighLight, style.logsRowMatchHighLightPreview])\r\n      : cx([style.logsRowMatchHighLight]);\r\n    const styles = getStyles(theme);\r\n    return (\r\n      <td className={style.logsRowMessage}>\r\n        <div className={cx(styles.positionRelative, { [styles.horizontalScroll]: !wrapLogMessage })}>\r\n          {showContext && context && (\r\n            <LogRowContext\r\n              row={row}\r\n              context={context}\r\n              errors={errors}\r\n              hasMoreContextRows={hasMoreContextRows}\r\n              onOutsideClick={onToggleContext}\r\n              onLoadMoreContext={() => {\r\n                if (updateLimit) {\r\n                  updateLimit();\r\n                }\r\n              }}\r\n            />\r\n          )}\r\n          <span className={cx(styles.positionRelative, { [styles.rowWithContext]: showContext })}>\r\n            {needsHighlighter ? (\r\n              <Highlighter\r\n                style={styles.whiteSpacePreWrap}\r\n                textToHighlight={entry}\r\n                searchWords={highlights}\r\n                findChunks={findHighlightChunksInText}\r\n                highlightClassName={highlightClassName}\r\n              />\r\n            ) : hasAnsi ? (\r\n              <LogMessageAnsi value={raw} />\r\n            ) : (\r\n              entry\r\n            )}\r\n          </span>\r\n          {row.searchWords && row.searchWords.length > 0 && (\r\n            <span onClick={this.onContextToggle} className={cx(style.context)}>\r\n              {showContext ? 'Hide' : 'Show'} context\r\n            </span>\r\n          )}\r\n        </div>\r\n      </td>\r\n    );\r\n  }\r\n}\r\n\r\nexport const LogRowMessage = withTheme(UnThemedLogRowMessage);\r\nLogRowMessage.displayName = 'LogRowMessage';\r\n","import React, { PureComponent } from 'react';\r\nimport memoizeOne from 'memoize-one';\r\nimport { TimeZone, LogsDedupStrategy, LogRowModel, Field, LinkModel } from '@grafana/data';\r\n\r\nimport { Themeable } from '../../types/theme';\r\nimport { withTheme } from '../../themes/index';\r\nimport { getLogRowStyles } from './getLogRowStyles';\r\n\r\n//Components\r\nimport { LogRow } from './LogRow';\r\n\r\nexport const PREVIEW_LIMIT = 100;\r\nexport const RENDER_LIMIT = 500;\r\n\r\nexport interface Props extends Themeable {\r\n  logRows?: LogRowModel[];\r\n  deduplicatedRows?: LogRowModel[];\r\n  dedupStrategy: LogsDedupStrategy;\r\n  highlighterExpressions?: string[];\r\n  showLabels: boolean;\r\n  showTime: boolean;\r\n  wrapLogMessage: boolean;\r\n  timeZone: TimeZone;\r\n  rowLimit?: number;\r\n  allowDetails?: boolean;\r\n  previewLimit?: number;\r\n  onClickFilterLabel?: (key: string, value: string) => void;\r\n  onClickFilterOutLabel?: (key: string, value: string) => void;\r\n  getRowContext?: (row: LogRowModel, options?: any) => Promise<any>;\r\n  getFieldLinks?: (field: Field, rowIndex: number) => Array<LinkModel<Field>>;\r\n}\r\n\r\ninterface State {\r\n  renderAll: boolean;\r\n}\r\n\r\nclass UnThemedLogRows extends PureComponent<Props, State> {\r\n  renderAllTimer: number | null = null;\r\n\r\n  static defaultProps = {\r\n    previewLimit: PREVIEW_LIMIT,\r\n    rowLimit: RENDER_LIMIT,\r\n  };\r\n\r\n  state: State = {\r\n    renderAll: false,\r\n  };\r\n\r\n  componentDidMount() {\r\n    // Staged rendering\r\n    const { logRows, previewLimit } = this.props;\r\n    const rowCount = logRows ? logRows.length : 0;\r\n    // Render all right away if not too far over the limit\r\n    const renderAll = rowCount <= previewLimit! * 2;\r\n    if (renderAll) {\r\n      this.setState({ renderAll });\r\n    } else {\r\n      this.renderAllTimer = window.setTimeout(() => this.setState({ renderAll: true }), 2000);\r\n    }\r\n  }\r\n\r\n  componentWillUnmount() {\r\n    if (this.renderAllTimer) {\r\n      clearTimeout(this.renderAllTimer);\r\n    }\r\n  }\r\n\r\n  makeGetRows = memoizeOne((processedRows: LogRowModel[]) => {\r\n    return () => processedRows;\r\n  });\r\n\r\n  render() {\r\n    const {\r\n      dedupStrategy,\r\n      showLabels,\r\n      showTime,\r\n      wrapLogMessage,\r\n      logRows,\r\n      deduplicatedRows,\r\n      highlighterExpressions,\r\n      timeZone,\r\n      onClickFilterLabel,\r\n      onClickFilterOutLabel,\r\n      rowLimit,\r\n      theme,\r\n      allowDetails,\r\n      previewLimit,\r\n      getFieldLinks,\r\n    } = this.props;\r\n    const { renderAll } = this.state;\r\n    const { logsRowsTable, logsRowsHorizontalScroll } = getLogRowStyles(theme);\r\n    const dedupedRows = deduplicatedRows ? deduplicatedRows : logRows;\r\n    const hasData = logRows && logRows.length > 0;\r\n    const dedupCount = dedupedRows\r\n      ? dedupedRows.reduce((sum, row) => (row.duplicates ? sum + row.duplicates : sum), 0)\r\n      : 0;\r\n    const showDuplicates = dedupStrategy !== LogsDedupStrategy.none && dedupCount > 0;\r\n    const horizontalScrollWindow = wrapLogMessage ? '' : logsRowsHorizontalScroll;\r\n\r\n    // Staged rendering\r\n    const processedRows = dedupedRows ? dedupedRows : [];\r\n    const firstRows = processedRows.slice(0, previewLimit!);\r\n    const rowCount = Math.min(processedRows.length, rowLimit!);\r\n    const lastRows = processedRows.slice(previewLimit!, rowCount);\r\n\r\n    // React profiler becomes unusable if we pass all rows to all rows and their labels, using getter instead\r\n    const getRows = this.makeGetRows(processedRows);\r\n    const getRowContext = this.props.getRowContext ? this.props.getRowContext : () => Promise.resolve([]);\r\n\r\n    return (\r\n      <div className={horizontalScrollWindow}>\r\n        <table className={logsRowsTable}>\r\n          <tbody>\r\n            {hasData &&\r\n              firstRows.map((row, index) => (\r\n                <LogRow\r\n                  key={row.uid}\r\n                  getRows={getRows}\r\n                  getRowContext={getRowContext}\r\n                  highlighterExpressions={highlighterExpressions}\r\n                  row={row}\r\n                  showDuplicates={showDuplicates}\r\n                  showLabels={showLabels}\r\n                  showTime={showTime}\r\n                  wrapLogMessage={wrapLogMessage}\r\n                  timeZone={timeZone}\r\n                  allowDetails={allowDetails}\r\n                  onClickFilterLabel={onClickFilterLabel}\r\n                  onClickFilterOutLabel={onClickFilterOutLabel}\r\n                  getFieldLinks={getFieldLinks}\r\n                />\r\n              ))}\r\n            {hasData &&\r\n              renderAll &&\r\n              lastRows.map((row, index) => (\r\n                <LogRow\r\n                  key={row.uid}\r\n                  getRows={getRows}\r\n                  getRowContext={getRowContext}\r\n                  row={row}\r\n                  showDuplicates={showDuplicates}\r\n                  showLabels={showLabels}\r\n                  showTime={showTime}\r\n                  wrapLogMessage={wrapLogMessage}\r\n                  timeZone={timeZone}\r\n                  allowDetails={allowDetails}\r\n                  onClickFilterLabel={onClickFilterLabel}\r\n                  onClickFilterOutLabel={onClickFilterOutLabel}\r\n                  getFieldLinks={getFieldLinks}\r\n                />\r\n              ))}\r\n            {hasData && !renderAll && (\r\n              <tr>\r\n                <td colSpan={5}>Rendering {rowCount - previewLimit!} rows...</td>\r\n              </tr>\r\n            )}\r\n          </tbody>\r\n        </table>\r\n      </div>\r\n    );\r\n  }\r\n}\r\n\r\nexport const LogRows = withTheme(UnThemedLogRows);\r\nLogRows.displayName = 'LogsRows';\r\n","import { css } from 'emotion';\r\nimport { LogLevel } from '@grafana/data';\r\n\r\nimport { GrafanaTheme } from '@grafana/data';\r\nimport { selectThemeVariant } from '../../themes/selectThemeVariant';\r\nimport { stylesFactory } from '../../themes';\r\n\r\nexport const getLogRowStyles = stylesFactory((theme: GrafanaTheme, logLevel?: LogLevel) => {\r\n  let logColor = selectThemeVariant({ light: theme.colors.gray5, dark: theme.colors.gray2 }, theme.type);\r\n  const borderColor = selectThemeVariant({ light: theme.colors.gray5, dark: theme.colors.gray2 }, theme.type);\r\n  const bgColor = selectThemeVariant({ light: theme.colors.gray5, dark: theme.colors.dark4 }, theme.type);\r\n  const context = css`\r\n    label: context;\r\n    visibility: hidden;\r\n    white-space: nowrap;\r\n    position: relative;\r\n  `;\r\n\r\n  switch (logLevel) {\r\n    case LogLevel.crit:\r\n    case LogLevel.critical:\r\n      logColor = '#705da0';\r\n      break;\r\n    case LogLevel.error:\r\n    case LogLevel.err:\r\n      logColor = '#e24d42';\r\n      break;\r\n    case LogLevel.warning:\r\n    case LogLevel.warn:\r\n      logColor = theme.colors.yellow;\r\n      break;\r\n    case LogLevel.info:\r\n      logColor = '#7eb26d';\r\n      break;\r\n    case LogLevel.debug:\r\n      logColor = '#1f78c1';\r\n      break;\r\n    case LogLevel.trace:\r\n      logColor = '#6ed0e0';\r\n      break;\r\n  }\r\n\r\n  return {\r\n    logsRowMatchHighLight: css`\r\n      label: logs-row__match-highlight;\r\n      background: inherit;\r\n      padding: inherit;\r\n      color: ${theme.colors.yellow};\r\n      background-color: rgba(${theme.colors.yellow}, 0.1);\r\n    `,\r\n    logsRowMatchHighLightPreview: css`\r\n      label: logs-row__match-highlight--preview;\r\n      background-color: rgba(${theme.colors.yellow}, 0.2);\r\n      border-bottom-style: dotted;\r\n    `,\r\n    logsRowsTable: css`\r\n      label: logs-rows;\r\n      font-family: ${theme.typography.fontFamily.monospace};\r\n      font-size: ${theme.typography.size.sm};\r\n      width: 100%;\r\n    `,\r\n    logsRowsHorizontalScroll: css`\r\n      label: logs-rows__horizontal-scroll;\r\n      overflow: scroll;\r\n    `,\r\n    context: context,\r\n    logsRow: css`\r\n      label: logs-row;\r\n      width: 100%;\r\n      cursor: pointer;\r\n      vertical-align: top;\r\n      &:hover {\r\n        .${context} {\r\n          visibility: visible;\r\n          z-index: 1;\r\n          margin-left: 10px;\r\n          text-decoration: underline;\r\n          &:hover {\r\n            color: ${theme.colors.yellow};\r\n          }\r\n        }\r\n      }\r\n      td:last-child {\r\n        width: 100%;\r\n      }\r\n\r\n      > td {\r\n        padding-right: ${theme.spacing.sm};\r\n        border-top: ${theme.border.width.sm} solid transparent;\r\n        border-bottom: ${theme.border.width.sm} solid transparent;\r\n        height: 100%;\r\n      }\r\n\r\n      &:hover {\r\n        background: ${theme.colors.pageBg};\r\n      }\r\n    `,\r\n    logsRowDuplicates: css`\r\n      label: logs-row__duplicates;\r\n      text-align: right;\r\n      width: 4em;\r\n      cursor: default;\r\n    `,\r\n    logsRowLevel: css`\r\n      label: logs-row__level;\r\n      position: relative;\r\n      max-width: 10px;\r\n      cursor: default;\r\n      &::after {\r\n        content: '';\r\n        display: block;\r\n        position: absolute;\r\n        top: 1px;\r\n        bottom: 1px;\r\n        width: 3px;\r\n        background-color: ${logColor};\r\n      }\r\n    `,\r\n    logsRowToggleDetails: css`\r\n      label: logs-row-toggle-details__level;\r\n      position: relative;\r\n      font-size: 9px;\r\n      padding-top: 5px;\r\n      max-width: 15px;\r\n    `,\r\n    logsRowLocalTime: css`\r\n      label: logs-row__localtime;\r\n      white-space: nowrap;\r\n      max-width: 12.5em;\r\n    `,\r\n    logsRowLabels: css`\r\n      label: logs-row__labels;\r\n      white-space: nowrap;\r\n      max-width: 22em;\r\n    `,\r\n    logsRowMessage: css`\r\n      label: logs-row__message;\r\n      word-break: break-all;\r\n    `,\r\n    //Log details sepcific CSS\r\n    logDetailsContainer: css`\r\n      label: logs-row-details-table;\r\n      border: 1px solid ${borderColor};\r\n      padding: 0 ${theme.spacing.sm} ${theme.spacing.sm};\r\n      border-radius: 3px;\r\n      margin: 20px 8px 20px 16px;\r\n      cursor: default;\r\n    `,\r\n    logDetailsTable: css`\r\n      label: logs-row-details-table;\r\n      line-height: 2;\r\n      width: 100%;\r\n      td:last-child {\r\n        width: 100%;\r\n      }\r\n    `,\r\n    logsDetailsIcon: css`\r\n      label: logs-row-details__icon;\r\n      position: relative;\r\n      padding-right: ${theme.spacing.md};\r\n      color: ${theme.colors.gray3};\r\n    `,\r\n    logDetailsLabel: css`\r\n      label: logs-row-details__label;\r\n      max-width: 30em;\r\n      min-width: 20em;\r\n      padding: 0 ${theme.spacing.sm};\r\n      overflow-wrap: break-word;\r\n    `,\r\n    logDetailsHeading: css`\r\n      label: logs-row-details__heading;\r\n      font-weight: ${theme.typography.weight.bold};\r\n      padding: ${theme.spacing.sm} 0 ${theme.spacing.xs};\r\n    `,\r\n    logDetailsValue: css`\r\n      label: logs-row-details__row;\r\n      position: relative;\r\n      vertical-align: top;\r\n      cursor: default;\r\n      &:hover {\r\n        background-color: ${bgColor};\r\n      }\r\n    `,\r\n  };\r\n});\r\n","import React from 'react';\r\nimport { Portal } from '../Portal/Portal';\r\nimport { css, cx } from 'emotion';\r\nimport { stylesFactory, withTheme } from '../../themes';\r\nimport { GrafanaTheme } from '@grafana/data';\r\nimport { Icon } from '../Icon/Icon';\r\nimport { IconType } from '../Icon/types';\r\n\r\nconst getStyles = stylesFactory((theme: GrafanaTheme) => ({\r\n  modal: css`\r\n    position: fixed;\r\n    z-index: ${theme.zIndex.modal};\r\n    background: ${theme.colors.pageBg};\r\n    box-shadow: 0 3px 7px rgba(0, 0, 0, 0.3);\r\n    background-clip: padding-box;\r\n    outline: none;\r\n    width: 750px;\r\n    max-width: 100%;\r\n    left: 0;\r\n    right: 0;\r\n    margin-left: auto;\r\n    margin-right: auto;\r\n    top: 10%;\r\n  `,\r\n  modalBackdrop: css`\r\n    position: fixed;\r\n    top: 0;\r\n    right: 0;\r\n    bottom: 0;\r\n    left: 0;\r\n    z-index: ${theme.zIndex.modalBackdrop};\r\n    background-color: ${theme.colors.blueFaint};\r\n    opacity: 0.8;\r\n    backdrop-filter: blur(4px);\r\n  `,\r\n  modalHeader: css`\r\n    background: ${theme.background.pageHeader};\r\n    box-shadow: ${theme.shadow.pageHeader};\r\n    border-bottom: 1px solid ${theme.colors.pageHeaderBorder};\r\n    display: flex;\r\n  `,\r\n  modalHeaderTitle: css`\r\n    font-size: ${theme.typography.heading.h3};\r\n    padding-top: ${theme.spacing.sm};\r\n    margin: 0 ${theme.spacing.md};\r\n  `,\r\n  modalHeaderIcon: css`\r\n    margin-right: ${theme.spacing.md};\r\n    font-size: inherit;\r\n    &:before {\r\n      vertical-align: baseline;\r\n    }\r\n  `,\r\n  modalHeaderClose: css`\r\n    margin-left: auto;\r\n    padding: 9px ${theme.spacing.d};\r\n  `,\r\n  modalContent: css`\r\n    padding: calc(${theme.spacing.d} * 2);\r\n    overflow: auto;\r\n    width: 100%;\r\n    max-height: calc(90vh - ${theme.spacing.d} * 2);\r\n  `,\r\n}));\r\n\r\ninterface Props {\r\n  icon?: IconType;\r\n  title: string | JSX.Element;\r\n  theme: GrafanaTheme;\r\n  className?: string;\r\n\r\n  isOpen?: boolean;\r\n  onDismiss?: () => void;\r\n\r\n  // If not set will call onDismiss if that is set.\r\n  onClickBackdrop?: () => void;\r\n}\r\n\r\nexport class UnthemedModal extends React.PureComponent<Props> {\r\n  onDismiss = () => {\r\n    if (this.props.onDismiss) {\r\n      this.props.onDismiss();\r\n    }\r\n  };\r\n\r\n  onClickBackdrop = () => {\r\n    this.onDismiss();\r\n  };\r\n\r\n  renderDefaultHeader() {\r\n    const { title, icon, theme } = this.props;\r\n    const styles = getStyles(theme);\r\n\r\n    return (\r\n      <h2 className={styles.modalHeaderTitle}>\r\n        {icon && <Icon name={icon} className={styles.modalHeaderIcon} />}\r\n        {title}\r\n      </h2>\r\n    );\r\n  }\r\n\r\n  render() {\r\n    const { title, isOpen = false, theme, className } = this.props;\r\n    const styles = getStyles(theme);\r\n\r\n    if (!isOpen) {\r\n      return null;\r\n    }\r\n\r\n    return (\r\n      <Portal>\r\n        <div className={cx(styles.modal, className)}>\r\n          <div className={styles.modalHeader}>\r\n            {typeof title === 'string' ? this.renderDefaultHeader() : title}\r\n            <a className={styles.modalHeaderClose} onClick={this.onDismiss}>\r\n              <i className=\"fa fa-remove\" />\r\n            </a>\r\n          </div>\r\n          <div className={styles.modalContent}>{this.props.children}</div>\r\n        </div>\r\n        <div className={styles.modalBackdrop} onClick={this.props.onClickBackdrop || this.onClickBackdrop} />\r\n      </Portal>\r\n    );\r\n  }\r\n}\r\n\r\nexport const Modal = withTheme(UnthemedModal);\r\n","import React, { SFC } from 'react';\r\n\r\ninterface Props {\r\n  cols?: number;\r\n  children: JSX.Element[] | JSX.Element;\r\n}\r\n\r\nexport const PanelOptionsGrid: SFC<Props> = ({ children }) => {\r\n  return <div className=\"panel-options-grid\">{children}</div>;\r\n};\r\n","// Libraries\r\nimport React, { FunctionComponent } from 'react';\r\n\r\ninterface Props {\r\n  title?: string | JSX.Element;\r\n  onClose?: () => void;\r\n  children: JSX.Element | JSX.Element[] | boolean;\r\n  onAdd?: () => void;\r\n}\r\n\r\nexport const PanelOptionsGroup: FunctionComponent<Props> = props => {\r\n  return (\r\n    <div className=\"panel-options-group\">\r\n      {props.onAdd ? (\r\n        <div className=\"panel-options-group__header\">\r\n          <button className=\"panel-options-group__add-btn\" onClick={props.onAdd}>\r\n            <div className=\"panel-options-group__add-circle\">\r\n              <i className=\"fa fa-plus\" />\r\n            </div>\r\n            <span className=\"panel-options-group__title\">{props.title}</span>\r\n          </button>\r\n        </div>\r\n      ) : (\r\n        props.title && (\r\n          <div className=\"panel-options-group__header\">\r\n            <span className=\"panel-options-group__title\">{props.title}</span>\r\n            {props.onClose && (\r\n              <button className=\"btn btn-link\" onClick={props.onClose}>\r\n                <i className=\"fa fa-remove\" />\r\n              </button>\r\n            )}\r\n          </div>\r\n        )\r\n      )}\r\n      {props.children && <div className=\"panel-options-group__body\">{props.children}</div>}\r\n    </div>\r\n  );\r\n};\r\n","import React, { PureComponent } from 'react';\r\nimport { select, pie, arc, event } from 'd3';\r\nimport sum from 'lodash/sum';\r\nimport { DisplayValue, GrafanaThemeType, formattedValueToString } from '@grafana/data';\r\nimport { Themeable } from '../../index';\r\nimport { colors as grafana_colors } from '../../utils/index';\r\n\r\nexport enum PieChartType {\r\n  PIE = 'pie',\r\n  DONUT = 'donut',\r\n}\r\n\r\nexport interface Props extends Themeable {\r\n  height: number;\r\n  width: number;\r\n  values: DisplayValue[];\r\n\r\n  pieType: PieChartType;\r\n  strokeWidth: number;\r\n}\r\n\r\nexport class PieChart extends PureComponent<Props> {\r\n  containerElement: any;\r\n  svgElement: any;\r\n  tooltipElement: any;\r\n  tooltipValueElement: any;\r\n\r\n  static defaultProps = {\r\n    pieType: 'pie',\r\n    format: 'short',\r\n    stat: 'current',\r\n    strokeWidth: 1,\r\n    theme: GrafanaThemeType.Dark,\r\n  };\r\n\r\n  componentDidMount() {\r\n    this.draw();\r\n  }\r\n\r\n  componentDidUpdate() {\r\n    this.draw();\r\n  }\r\n\r\n  draw() {\r\n    const { values, pieType, strokeWidth } = this.props;\r\n\r\n    if (values.length === 0) {\r\n      return;\r\n    }\r\n\r\n    const data = values.map(datapoint => datapoint.numeric);\r\n    const names = values.map(datapoint => formattedValueToString(datapoint));\r\n    const colors = values.map((p, idx) => {\r\n      if (p.color) {\r\n        return p.color;\r\n      }\r\n      return grafana_colors[idx % grafana_colors.length];\r\n    });\r\n\r\n    const total = sum(data) || 1;\r\n    const percents = data.map((item: number) => (item / total) * 100);\r\n\r\n    const width = this.containerElement.offsetWidth;\r\n    const height = this.containerElement.offsetHeight;\r\n    const radius = Math.min(width, height) / 2;\r\n\r\n    const outerRadius = radius - radius / 10;\r\n    const innerRadius = pieType === PieChartType.PIE ? 0 : radius - radius / 3;\r\n\r\n    const svg = select(this.svgElement)\r\n      .html('')\r\n      .attr('width', width)\r\n      .attr('height', height)\r\n      .append('g')\r\n      .attr('transform', `translate(${width / 2},${height / 2})`);\r\n\r\n    const pieChart = pie();\r\n\r\n    const customArc = arc()\r\n      .outerRadius(outerRadius)\r\n      .innerRadius(innerRadius)\r\n      .padAngle(0);\r\n\r\n    svg\r\n      .selectAll('path')\r\n      .data(pieChart(data))\r\n      .enter()\r\n      .append('path')\r\n      .attr('d', customArc as any)\r\n      .attr('fill', (d: any, idx: number) => colors[idx])\r\n      .style('fill-opacity', 0.15)\r\n      .style('stroke', (d: any, idx: number) => colors[idx])\r\n      .style('stroke-width', `${strokeWidth}px`)\r\n      .on('mouseover', (d: any, idx: any) => {\r\n        select(this.tooltipElement).style('opacity', 1);\r\n        select(this.tooltipValueElement).text(`${names[idx]} (${percents[idx].toFixed(2)}%)`);\r\n      })\r\n      .on('mousemove', () => {\r\n        select(this.tooltipElement)\r\n          .style('top', `${event.pageY - height / 2}px`)\r\n          .style('left', `${event.pageX}px`);\r\n      })\r\n      .on('mouseout', () => {\r\n        select(this.tooltipElement).style('opacity', 0);\r\n      });\r\n  }\r\n\r\n  render() {\r\n    const { height, width, values } = this.props;\r\n\r\n    if (values.length > 0) {\r\n      return (\r\n        <div className=\"piechart-panel\">\r\n          <div\r\n            ref={element => (this.containerElement = element)}\r\n            className=\"piechart-container\"\r\n            style={{\r\n              height: `${height * 0.9}px`,\r\n              width: `${Math.min(width, height * 1.3)}px`,\r\n            }}\r\n          >\r\n            <svg ref={element => (this.svgElement = element)} />\r\n          </div>\r\n          <div className=\"piechart-tooltip\" ref={element => (this.tooltipElement = element)}>\r\n            <div className=\"piechart-tooltip-time\">\r\n              <div\r\n                id=\"tooltip-value\"\r\n                className=\"piechart-tooltip-value\"\r\n                ref={element => (this.tooltipValueElement = element)}\r\n              />\r\n            </div>\r\n          </div>\r\n        </div>\r\n      );\r\n    } else {\r\n      return (\r\n        <div className=\"piechart-panel\">\r\n          <div className=\"datapoints-warning\">\r\n            <span className=\"small\">No data points</span>\r\n          </div>\r\n        </div>\r\n      );\r\n    }\r\n  }\r\n}\r\n","import { PureComponent } from 'react';\r\nimport ReactDOM from 'react-dom';\r\n\r\ninterface Props {\r\n  className?: string;\r\n  root?: HTMLElement;\r\n}\r\n\r\nexport class Portal extends PureComponent<Props> {\r\n  node: HTMLElement = document.createElement('div');\r\n  portalRoot: HTMLElement;\r\n\r\n  constructor(props: Props) {\r\n    super(props);\r\n    const { className, root = document.body } = this.props;\r\n\r\n    if (className) {\r\n      this.node.classList.add(className);\r\n    }\r\n\r\n    this.portalRoot = root;\r\n    this.portalRoot.appendChild(this.node);\r\n  }\r\n\r\n  componentWillUnmount() {\r\n    this.portalRoot.removeChild(this.node);\r\n  }\r\n\r\n  render() {\r\n    return ReactDOM.createPortal(this.props.children, this.node);\r\n  }\r\n}\r\n","import _ from 'lodash';\r\nimport React, { Context } from 'react';\r\n\r\nimport { Value, Editor as CoreEditor } from 'slate';\r\nimport { Editor, Plugin } from '@grafana/slate-react';\r\nimport Plain from 'slate-plain-serializer';\r\nimport classnames from 'classnames';\r\n\r\nimport {\r\n  ClearPlugin,\r\n  NewlinePlugin,\r\n  SelectionShortcutsPlugin,\r\n  IndentationPlugin,\r\n  ClipboardPlugin,\r\n  RunnerPlugin,\r\n  SuggestionsPlugin,\r\n} from '../../slate-plugins';\r\n\r\nimport { makeValue, SCHEMA, CompletionItemGroup, TypeaheadOutput, TypeaheadInput, SuggestionsState } from '../..';\r\n\r\nexport interface QueryFieldProps {\r\n  additionalPlugins?: Plugin[];\r\n  cleanText?: (text: string) => string;\r\n  disabled?: boolean;\r\n  // We have both value and local state. This is usually an antipattern but we need to keep local state\r\n  // for perf reasons and also have outside value in for example in Explore redux that is mutable from logs\r\n  // creating a two way binding.\r\n  query: string | null;\r\n  onRunQuery?: () => void;\r\n  onBlur?: () => void;\r\n  onChange?: (value: string) => void;\r\n  onTypeahead?: (typeahead: TypeaheadInput) => Promise<TypeaheadOutput>;\r\n  onWillApplySuggestion?: (suggestion: string, state: SuggestionsState) => string;\r\n  placeholder?: string;\r\n  portalOrigin: string;\r\n  syntax?: string;\r\n  syntaxLoaded?: boolean;\r\n}\r\n\r\nexport interface QueryFieldState {\r\n  suggestions: CompletionItemGroup[];\r\n  typeaheadContext: string | null;\r\n  typeaheadPrefix: string;\r\n  typeaheadText: string;\r\n  value: Value;\r\n}\r\n\r\n/**\r\n * Renders an editor field.\r\n * Pass initial value as initialQuery and listen to changes in props.onValueChanged.\r\n * This component can only process strings. Internally it uses Slate Value.\r\n * Implement props.onTypeahead to use suggestions, see PromQueryField.tsx as an example.\r\n */\r\nexport class QueryField extends React.PureComponent<QueryFieldProps, QueryFieldState> {\r\n  plugins: Plugin[];\r\n  runOnChangeDebounced: Function;\r\n  lastExecutedValue: Value | null = null;\r\n  mounted = false;\r\n  editor: Editor | null = null;\r\n\r\n  constructor(props: QueryFieldProps, context: Context<any>) {\r\n    super(props, context);\r\n\r\n    this.runOnChangeDebounced = _.debounce(this.runOnChange, 500);\r\n\r\n    const { onTypeahead, cleanText, portalOrigin, onWillApplySuggestion } = props;\r\n\r\n    // Base plugins\r\n    this.plugins = [\r\n      NewlinePlugin(),\r\n      SuggestionsPlugin({ onTypeahead, cleanText, portalOrigin, onWillApplySuggestion }),\r\n      ClearPlugin(),\r\n      RunnerPlugin({ handler: this.runOnChangeAndRunQuery }),\r\n      SelectionShortcutsPlugin(),\r\n      IndentationPlugin(),\r\n      ClipboardPlugin(),\r\n      ...(props.additionalPlugins || []),\r\n    ].filter(p => p);\r\n\r\n    this.state = {\r\n      suggestions: [],\r\n      typeaheadContext: null,\r\n      typeaheadPrefix: '',\r\n      typeaheadText: '',\r\n      value: makeValue(props.query || '', props.syntax),\r\n    };\r\n  }\r\n\r\n  componentDidMount() {\r\n    this.mounted = true;\r\n  }\r\n\r\n  componentWillUnmount() {\r\n    this.mounted = false;\r\n  }\r\n\r\n  componentDidUpdate(prevProps: QueryFieldProps, prevState: QueryFieldState) {\r\n    const { query, syntax } = this.props;\r\n    const { value } = this.state;\r\n\r\n    // Handle two way binging between local state and outside prop.\r\n    // if query changed from the outside\r\n    if (query !== prevProps.query) {\r\n      // and we have a version that differs\r\n      if (query !== Plain.serialize(value)) {\r\n        this.setState({ value: makeValue(query || '', syntax) });\r\n      }\r\n    }\r\n  }\r\n\r\n  UNSAFE_componentWillReceiveProps(nextProps: QueryFieldProps) {\r\n    if (nextProps.syntaxLoaded && !this.props.syntaxLoaded) {\r\n      if (!this.editor) {\r\n        return;\r\n      }\r\n\r\n      // Need a bogus edit to re-render the editor after syntax has fully loaded\r\n      const editor = this.editor.insertText(' ').deleteBackward(1);\r\n      this.onChange(editor.value, true);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Update local state, propagate change upstream and optionally run the query afterwards.\r\n   */\r\n  onChange = (value: Value, runQuery?: boolean) => {\r\n    const documentChanged = value.document !== this.state.value.document;\r\n    const prevValue = this.state.value;\r\n\r\n    // Update local state with new value and optionally change value upstream.\r\n    this.setState({ value }, () => {\r\n      // The diff is needed because the actual value of editor have much more metadata (for example text selection)\r\n      // that is not passed upstream so every change of editor value does not mean change of the query text.\r\n      if (documentChanged) {\r\n        const textChanged = Plain.serialize(prevValue) !== Plain.serialize(value);\r\n        if (textChanged && runQuery) {\r\n          this.runOnChangeAndRunQuery();\r\n        }\r\n        if (textChanged && !runQuery) {\r\n          // Debounce change propagation by default for perf reasons.\r\n          this.runOnChangeDebounced();\r\n        }\r\n      }\r\n    });\r\n  };\r\n\r\n  runOnChange = () => {\r\n    const { onChange } = this.props;\r\n\r\n    if (onChange) {\r\n      onChange(Plain.serialize(this.state.value));\r\n    }\r\n  };\r\n\r\n  runOnRunQuery = () => {\r\n    const { onRunQuery } = this.props;\r\n\r\n    if (onRunQuery) {\r\n      onRunQuery();\r\n      this.lastExecutedValue = this.state.value;\r\n    }\r\n  };\r\n\r\n  runOnChangeAndRunQuery = () => {\r\n    // onRunQuery executes query from Redux in Explore so it needs to be updated sync in case we want to run\r\n    // the query.\r\n    this.runOnChange();\r\n    this.runOnRunQuery();\r\n  };\r\n\r\n  /**\r\n   * We need to handle blur events here mainly because of dashboard panels which expect to have query executed on blur.\r\n   */\r\n  handleBlur = (event: Event, editor: CoreEditor, next: Function) => {\r\n    const { onBlur } = this.props;\r\n    if (onBlur) {\r\n      onBlur();\r\n    } else {\r\n      // Run query by default on blur\r\n      const previousValue = this.lastExecutedValue ? Plain.serialize(this.lastExecutedValue) : null;\r\n      const currentValue = Plain.serialize(editor.value);\r\n\r\n      if (previousValue !== currentValue) {\r\n        this.runOnChangeAndRunQuery();\r\n      }\r\n    }\r\n    return next();\r\n  };\r\n\r\n  render() {\r\n    const { disabled } = this.props;\r\n    const wrapperClassName = classnames('slate-query-field__wrapper', {\r\n      'slate-query-field__wrapper--disabled': disabled,\r\n    });\r\n\r\n    return (\r\n      <div className={wrapperClassName}>\r\n        <div className=\"slate-query-field\">\r\n          <Editor\r\n            ref={editor => (this.editor = editor!)}\r\n            schema={SCHEMA}\r\n            autoCorrect={false}\r\n            readOnly={this.props.disabled}\r\n            onBlur={this.handleBlur}\r\n            // onKeyDown={this.onKeyDown}\r\n            onChange={(change: { value: Value }) => {\r\n              this.onChange(change.value, false);\r\n            }}\r\n            placeholder={this.props.placeholder}\r\n            plugins={this.plugins}\r\n            spellCheck={false}\r\n            value={this.state.value}\r\n          />\r\n        </div>\r\n      </div>\r\n    );\r\n  }\r\n}\r\n\r\nexport default QueryField;\r\n","import React, { PureComponent } from 'react';\r\nimport classNames from 'classnames';\r\nimport { SelectableValue } from '@grafana/data';\r\nimport { css } from 'emotion';\r\nimport { Tooltip } from '../Tooltip/Tooltip';\r\nimport { ButtonSelect } from '../Select/ButtonSelect';\r\nimport memoizeOne from 'memoize-one';\r\nimport { GrafanaTheme } from '@grafana/data';\r\nimport { withTheme } from '../../themes';\r\n\r\nconst defaultIntervals = ['5s', '10s', '30s', '1m', '5m', '15m', '30m', '1h', '2h', '1d'];\r\n\r\nconst getStyles = memoizeOne((theme: GrafanaTheme) => {\r\n  return {\r\n    selectButton: css`\r\n      label: selectButton;\r\n      .select-button-value {\r\n        color: ${theme.colors.orange};\r\n      }\r\n    `,\r\n  };\r\n});\r\n\r\nexport interface Props {\r\n  intervals?: string[];\r\n  onRefresh?: () => any;\r\n  onIntervalChanged: (interval: string) => void;\r\n  value?: string;\r\n  tooltip?: string;\r\n  hasLiveOption?: boolean;\r\n  // You can supply your own refresh button element. In that case onRefresh and tooltip are ignored.\r\n  refreshButton?: React.ReactNode;\r\n  buttonSelectClassName?: string;\r\n  theme: GrafanaTheme;\r\n}\r\n\r\nexport class RefreshPickerBase extends PureComponent<Props> {\r\n  static offOption = { label: 'Off', value: '' };\r\n  static liveOption = { label: 'Live', value: 'LIVE' };\r\n  static isLive = (refreshInterval?: string): boolean => refreshInterval === RefreshPicker.liveOption.value;\r\n\r\n  constructor(props: Props) {\r\n    super(props);\r\n  }\r\n\r\n  intervalsToOptions = (intervals: string[] | undefined): Array<SelectableValue<string>> => {\r\n    const intervalsOrDefault = intervals || defaultIntervals;\r\n    const options = intervalsOrDefault\r\n      .filter(str => str !== '')\r\n      .map(interval => ({ label: interval, value: interval }));\r\n\r\n    if (this.props.hasLiveOption) {\r\n      options.unshift(RefreshPicker.liveOption);\r\n    }\r\n\r\n    options.unshift(RefreshPicker.offOption);\r\n    return options;\r\n  };\r\n\r\n  onChangeSelect = (item: SelectableValue<string>) => {\r\n    const { onIntervalChanged } = this.props;\r\n    if (onIntervalChanged) {\r\n      // @ts-ignore\r\n      onIntervalChanged(item.value);\r\n    }\r\n  };\r\n\r\n  render() {\r\n    const { onRefresh, intervals, tooltip, value, refreshButton, buttonSelectClassName, theme } = this.props;\r\n    const options = this.intervalsToOptions(intervals);\r\n    const currentValue = value || '';\r\n    const selectedValue = options.find(item => item.value === currentValue) || RefreshPicker.offOption;\r\n    const styles = getStyles(theme);\r\n\r\n    const cssClasses = classNames({\r\n      'refresh-picker': true,\r\n      'refresh-picker--off': selectedValue.label === RefreshPicker.offOption.label,\r\n      'refresh-picker--live': selectedValue === RefreshPicker.liveOption,\r\n    });\r\n\r\n    return (\r\n      <div className={cssClasses}>\r\n        <div className=\"refresh-picker-buttons\">\r\n          {refreshButton ? (\r\n            refreshButton\r\n          ) : (\r\n            <Tooltip placement=\"top\" content={tooltip!}>\r\n              <button\r\n                className=\"btn btn--radius-right-0 navbar-button navbar-button--border-right-0\"\r\n                onClick={onRefresh!}\r\n              >\r\n                <i className=\"fa fa-refresh\" />\r\n              </button>\r\n            </Tooltip>\r\n          )}\r\n          <ButtonSelect\r\n            className={classNames('navbar-button--attached', styles.selectButton, buttonSelectClassName)}\r\n            value={selectedValue}\r\n            label={selectedValue.label}\r\n            options={options}\r\n            onChange={this.onChangeSelect}\r\n            maxMenuHeight={380}\r\n          />\r\n        </div>\r\n      </div>\r\n    );\r\n  }\r\n}\r\n\r\nexport const RefreshPicker = withTheme<\r\n  Props,\r\n  {\r\n    offOption: typeof RefreshPickerBase.offOption;\r\n    liveOption: typeof RefreshPickerBase.liveOption;\r\n    isLive: typeof RefreshPickerBase.isLive;\r\n  }\r\n>(RefreshPickerBase);\r\n","import omit from 'lodash/omit';\r\nimport React, { InputHTMLAttributes, FunctionComponent } from 'react';\r\nimport { FormField } from '../FormField/FormField';\r\n\r\ninterface Props extends InputHTMLAttributes<HTMLInputElement> {\r\n  // Function to use when reset is clicked. Means you have to reset the input value yourself as this is  uncontrolled\r\n  // component (or do something else if required).\r\n  onReset: () => void;\r\n  isConfigured: boolean;\r\n\r\n  label?: string;\r\n  labelWidth?: number;\r\n  inputWidth?: number;\r\n  // Placeholder of the input field when in non configured state.\r\n  placeholder?: string;\r\n}\r\n\r\nconst defaultProps = {\r\n  inputWidth: 12,\r\n  placeholder: 'Password',\r\n  label: 'Password',\r\n};\r\n\r\n/**\r\n * Form field that has 2 states configured and not configured. If configured it will not show its contents and adds\r\n * a reset button that will clear the input and makes it accessible. In non configured state it behaves like normal\r\n * form field. This is used for passwords or anything that is encrypted on the server and is later returned encrypted\r\n * to the user (like datasource passwords).\r\n */\r\nexport const SecretFormField: FunctionComponent<Props> = ({\r\n  label,\r\n  labelWidth,\r\n  inputWidth,\r\n  onReset,\r\n  isConfigured,\r\n  placeholder,\r\n  ...inputProps\r\n}: Props) => {\r\n  return (\r\n    <FormField\r\n      label={label!}\r\n      labelWidth={labelWidth}\r\n      inputEl={\r\n        isConfigured ? (\r\n          <>\r\n            <input\r\n              type=\"text\"\r\n              className={`gf-form-input width-${inputWidth! - 2}`}\r\n              disabled={true}\r\n              value=\"configured\"\r\n              {...omit(inputProps, 'value')}\r\n            />\r\n            <button className=\"btn btn-secondary gf-form-btn\" onClick={onReset}>\r\n              reset\r\n            </button>\r\n          </>\r\n        ) : (\r\n          <input\r\n            type=\"password\"\r\n            className={`gf-form-input width-${inputWidth}`}\r\n            placeholder={placeholder}\r\n            {...inputProps}\r\n          />\r\n        )\r\n      }\r\n    />\r\n  );\r\n};\r\n\r\nSecretFormField.defaultProps = defaultProps;\r\nSecretFormField.displayName = 'SecretFormField';\r\n","import React from 'react';\r\nimport { cx } from 'emotion';\r\nimport _ from 'lodash';\r\nimport { SelectableValue } from '@grafana/data';\r\nimport { SegmentSelect, useExpandableLabel, SegmentProps } from './';\r\n\r\nexport interface SegmentSyncProps<T> extends SegmentProps<T> {\r\n  value?: T | SelectableValue<T>;\r\n  onChange: (item: SelectableValue<T>) => void;\r\n  options: Array<SelectableValue<T>>;\r\n}\r\n\r\nexport function Segment<T>({\r\n  options,\r\n  value,\r\n  onChange,\r\n  Component,\r\n  className,\r\n  allowCustomValue,\r\n  placeholder,\r\n}: React.PropsWithChildren<SegmentSyncProps<T>>) {\r\n  const [Label, width, expanded, setExpanded] = useExpandableLabel(false);\r\n\r\n  if (!expanded) {\r\n    const label = _.isObject(value) ? value.label : value;\r\n    return (\r\n      <Label\r\n        Component={\r\n          Component || (\r\n            <a className={cx('gf-form-label', 'query-part', !value && placeholder && 'query-placeholder', className)}>\r\n              {label || placeholder}\r\n            </a>\r\n          )\r\n        }\r\n      />\r\n    );\r\n  }\r\n\r\n  return (\r\n    <SegmentSelect\r\n      value={value && !_.isObject(value) ? { value } : value}\r\n      options={options}\r\n      width={width}\r\n      onClickOutside={() => setExpanded(false)}\r\n      allowCustomValue={allowCustomValue}\r\n      onChange={item => {\r\n        setExpanded(false);\r\n        onChange(item);\r\n      }}\r\n    />\r\n  );\r\n}\r\n","import React, { useState } from 'react';\r\nimport { cx } from 'emotion';\r\nimport _ from 'lodash';\r\nimport { SegmentSelect } from './SegmentSelect';\r\nimport { SelectableValue } from '@grafana/data';\r\nimport { useExpandableLabel, SegmentProps } from '.';\r\n\r\nexport interface SegmentAsyncProps<T> extends SegmentProps<T> {\r\n  value?: T | SelectableValue<T>;\r\n  loadOptions: (query?: string) => Promise<Array<SelectableValue<T>>>;\r\n  onChange: (item: SelectableValue<T>) => void;\r\n}\r\n\r\nexport function SegmentAsync<T>({\r\n  value,\r\n  onChange,\r\n  loadOptions,\r\n  Component,\r\n  className,\r\n  allowCustomValue,\r\n  placeholder,\r\n}: React.PropsWithChildren<SegmentAsyncProps<T>>) {\r\n  const [selectPlaceholder, setSelectPlaceholder] = useState<string>('');\r\n  const [loadedOptions, setLoadedOptions] = useState<Array<SelectableValue<T>>>([]);\r\n  const [Label, width, expanded, setExpanded] = useExpandableLabel(false);\r\n\r\n  if (!expanded) {\r\n    const label = _.isObject(value) ? value.label : value;\r\n    return (\r\n      <Label\r\n        onClick={async () => {\r\n          setSelectPlaceholder('Loading options...');\r\n          const opts = await loadOptions();\r\n          setLoadedOptions(opts);\r\n          setSelectPlaceholder(opts.length ? '' : 'No options found');\r\n        }}\r\n        Component={\r\n          Component || (\r\n            <a className={cx('gf-form-label', 'query-part', !value && placeholder && 'query-placeholder', className)}>\r\n              {label || placeholder}\r\n            </a>\r\n          )\r\n        }\r\n      />\r\n    );\r\n  }\r\n\r\n  return (\r\n    <SegmentSelect\r\n      value={value && !_.isObject(value) ? { value } : value}\r\n      options={loadedOptions}\r\n      width={width}\r\n      noOptionsMessage={selectPlaceholder}\r\n      allowCustomValue={allowCustomValue}\r\n      onClickOutside={() => {\r\n        setSelectPlaceholder('');\r\n        setLoadedOptions([]);\r\n        setExpanded(false);\r\n      }}\r\n      onChange={item => {\r\n        setSelectPlaceholder('');\r\n        setLoadedOptions([]);\r\n        setExpanded(false);\r\n        onChange(item);\r\n      }}\r\n    />\r\n  );\r\n}\r\n","import React, { useRef, useState } from 'react';\r\nimport { cx, css } from 'emotion';\r\nimport useClickAway from 'react-use/lib/useClickAway';\r\nimport { measureText } from '../../utils/measureText';\r\nimport { useExpandableLabel, SegmentProps } from '.';\r\n\r\nexport interface SegmentInputProps<T> extends SegmentProps<T> {\r\n  value: string | number;\r\n  onChange: (text: string | number) => void;\r\n  autofocus?: boolean;\r\n}\r\n\r\nconst FONT_SIZE = 14;\r\n\r\nexport function SegmentInput<T>({\r\n  value: initialValue,\r\n  onChange,\r\n  Component,\r\n  className,\r\n  placeholder,\r\n  autofocus = false,\r\n}: React.PropsWithChildren<SegmentInputProps<T>>) {\r\n  const ref = useRef<HTMLInputElement>(null);\r\n  const [value, setValue] = useState<number | string>(initialValue);\r\n  const [inputWidth, setInputWidth] = useState<number>(measureText((initialValue || '').toString(), FONT_SIZE).width);\r\n  const [Label, , expanded, setExpanded] = useExpandableLabel(autofocus);\r\n\r\n  useClickAway(ref, () => {\r\n    setExpanded(false);\r\n    onChange(value);\r\n  });\r\n\r\n  if (!expanded) {\r\n    return (\r\n      <Label\r\n        Component={\r\n          Component || (\r\n            <a className={cx('gf-form-label', 'query-part', !value && placeholder && 'query-placeholder', className)}>\r\n              {initialValue || placeholder}\r\n            </a>\r\n          )\r\n        }\r\n      />\r\n    );\r\n  }\r\n\r\n  const inputWidthStyle = css`\r\n    width: ${Math.max(inputWidth + 20, 32)}px;\r\n  `;\r\n\r\n  return (\r\n    <input\r\n      ref={ref}\r\n      autoFocus\r\n      className={cx(`gf-form gf-form-input`, inputWidthStyle)}\r\n      value={value}\r\n      onChange={item => {\r\n        const { width } = measureText(item.target.value, FONT_SIZE);\r\n        setInputWidth(width);\r\n        setValue(item.target.value);\r\n      }}\r\n      onBlur={() => {\r\n        setExpanded(false);\r\n        onChange(value);\r\n      }}\r\n      onKeyDown={e => {\r\n        if ([13, 27].includes(e.keyCode)) {\r\n          setExpanded(false);\r\n          onChange(value);\r\n        }\r\n      }}\r\n    />\r\n  );\r\n}\r\n","import React, { useRef } from 'react';\r\nimport { css, cx } from 'emotion';\r\nimport useClickAway from 'react-use/lib/useClickAway';\r\nimport { SelectableValue } from '@grafana/data';\r\nimport { Select } from '../Select/Select';\r\n\r\nexport interface Props<T> {\r\n  value?: SelectableValue<T>;\r\n  options: Array<SelectableValue<T>>;\r\n  onChange: (item: SelectableValue<T>) => void;\r\n  onClickOutside: () => void;\r\n  width: number;\r\n  noOptionsMessage?: string;\r\n  allowCustomValue?: boolean;\r\n}\r\n\r\nexport function SegmentSelect<T>({\r\n  value,\r\n  options = [],\r\n  onChange,\r\n  onClickOutside,\r\n  width,\r\n  noOptionsMessage = '',\r\n  allowCustomValue = false,\r\n}: React.PropsWithChildren<Props<T>>) {\r\n  const ref = useRef(null);\r\n\r\n  useClickAway(ref, () => {\r\n    onClickOutside();\r\n  });\r\n\r\n  return (\r\n    <div ref={ref}>\r\n      <Select\r\n        className={cx(\r\n          css`\r\n            width: ${width > 120 ? width : 120}px;\r\n          `\r\n        )}\r\n        noOptionsMessage={() => noOptionsMessage}\r\n        placeholder=\"\"\r\n        autoFocus={true}\r\n        isOpen={true}\r\n        onChange={onChange}\r\n        options={options}\r\n        value={value}\r\n        allowCustomValue={allowCustomValue}\r\n      />\r\n    </div>\r\n  );\r\n}\r\n","export { Segment } from './Segment';\r\nexport { SegmentAsync } from './SegmentAsync';\r\nexport { SegmentSelect } from './SegmentSelect';\r\nexport { SegmentInput } from './SegmentInput';\r\nexport { SegmentProps } from './types';\r\nexport { useExpandableLabel } from './useExpandableLabel';\r\n","import React, { useState, useRef, ReactElement } from 'react';\r\n\r\nexport const useExpandableLabel = (initialExpanded: boolean) => {\r\n  const ref = useRef<HTMLDivElement>(null);\r\n  const [expanded, setExpanded] = useState(initialExpanded);\r\n  const [width, setWidth] = useState();\r\n  const Label = ({ Component, onClick }: { Component: ReactElement; onClick: () => void }) => (\r\n    <div\r\n      className=\"gf-form\"\r\n      ref={ref}\r\n      onClick={() => {\r\n        setExpanded(true);\r\n        if (ref && ref.current) {\r\n          setWidth(ref.current.clientWidth);\r\n        }\r\n        if (onClick) {\r\n          onClick();\r\n        }\r\n      }}\r\n    >\r\n      {Component}\r\n    </div>\r\n  );\r\n\r\n  return [Label, width, expanded, setExpanded];\r\n};\r\n","import React, { PureComponent, ReactElement } from 'react';\r\nimport Select from './Select';\r\nimport { PopoverContent } from '../Tooltip/Tooltip';\r\nimport { SelectableValue } from '@grafana/data';\r\n\r\ninterface ButtonComponentProps {\r\n  label: ReactElement | string | undefined;\r\n  className: string | undefined;\r\n  iconClass?: string;\r\n}\r\n\r\nconst ButtonComponent = (buttonProps: ButtonComponentProps) => (props: any) => {\r\n  const { label, className, iconClass } = buttonProps;\r\n\r\n  return (\r\n    <div // changed to div because of FireFox on MacOs issue below\r\n      ref={props.innerRef}\r\n      className={`btn navbar-button navbar-button--tight ${className}`}\r\n      onClick={props.selectProps.menuIsOpen ? props.selectProps.onMenuClose : props.selectProps.onMenuOpen}\r\n      onBlur={props.selectProps.onMenuClose}\r\n      tabIndex={0} // necessary to get onBlur to work https://developer.mozilla.org/en-US/docs/Web/HTML/Element/button#Clicking_and_focus\r\n    >\r\n      <div className=\"select-button\">\r\n        {iconClass && <i className={`select-button-icon ${iconClass}`} />}\r\n        <span className=\"select-button-value\">{label ? label : ''}</span>\r\n        {!props.menuIsOpen && <i className=\"fa fa-caret-down fa-fw\" />}\r\n        {props.menuIsOpen && <i className=\"fa fa-caret-up fa-fw\" />}\r\n      </div>\r\n    </div>\r\n  );\r\n};\r\n\r\nexport interface Props<T> {\r\n  className: string | undefined;\r\n  options: Array<SelectableValue<T>>;\r\n  value?: SelectableValue<T>;\r\n  label?: ReactElement | string;\r\n  iconClass?: string;\r\n  components?: any;\r\n  maxMenuHeight?: number;\r\n  onChange: (item: SelectableValue<T>) => void;\r\n  tooltipContent?: PopoverContent;\r\n  isMenuOpen?: boolean;\r\n  onOpenMenu?: () => void;\r\n  onCloseMenu?: () => void;\r\n  tabSelectsValue?: boolean;\r\n  autoFocus?: boolean;\r\n}\r\n\r\nexport class ButtonSelect<T> extends PureComponent<Props<T>> {\r\n  onChange = (item: SelectableValue<T>) => {\r\n    const { onChange } = this.props;\r\n    onChange(item);\r\n  };\r\n\r\n  render() {\r\n    const {\r\n      className,\r\n      options,\r\n      value,\r\n      label,\r\n      iconClass,\r\n      components,\r\n      maxMenuHeight,\r\n      tooltipContent,\r\n      isMenuOpen,\r\n      onOpenMenu,\r\n      onCloseMenu,\r\n      tabSelectsValue,\r\n      autoFocus = true,\r\n    } = this.props;\r\n    const combinedComponents = {\r\n      ...components,\r\n      Control: ButtonComponent({ label, className, iconClass }),\r\n    };\r\n\r\n    return (\r\n      <Select\r\n        autoFocus={autoFocus}\r\n        backspaceRemovesValue={false}\r\n        isClearable={false}\r\n        isSearchable={false}\r\n        options={options}\r\n        onChange={this.onChange}\r\n        value={value}\r\n        isOpen={isMenuOpen}\r\n        onOpenMenu={onOpenMenu}\r\n        onCloseMenu={onCloseMenu}\r\n        maxMenuHeight={maxMenuHeight}\r\n        components={combinedComponents}\r\n        className=\"gf-form-select-box-button-select\"\r\n        tooltipContent={tooltipContent}\r\n        tabSelectsValue={tabSelectsValue}\r\n      />\r\n    );\r\n  }\r\n}\r\n","import React from 'react';\r\n\r\n// Ignoring because I couldn't get @types/react-select work wih Torkel's fork\r\n// @ts-ignore\r\nimport { components } from '@torkelo/react-select';\r\n\r\nexport const IndicatorsContainer = (props: any) => {\r\n  const isOpen = props.selectProps.menuIsOpen;\r\n  return (\r\n    <components.IndicatorsContainer {...props}>\r\n      <span\r\n        className={`gf-form-select-box__select-arrow ${isOpen ? `gf-form-select-box__select-arrow--reversed` : ''}`}\r\n      />\r\n    </components.IndicatorsContainer>\r\n  );\r\n};\r\n\r\nexport default IndicatorsContainer;\r\n","import React from 'react';\r\n\r\n// Ignoring because I couldn't get @types/react-select work wih Torkel's fork\r\n// @ts-ignore\r\nimport { components } from '@torkelo/react-select';\r\n// @ts-ignore\r\nimport { OptionProps } from '@torkelo/react-select/lib/components/Option';\r\n\r\nexport interface Props {\r\n  children: Element;\r\n}\r\n\r\nexport const NoOptionsMessage = (props: OptionProps<any>) => {\r\n  const { children } = props;\r\n  return (\r\n    <components.Option {...props}>\r\n      <div className=\"gf-form-select-box__desc-option\">\r\n        <div className=\"gf-form-select-box__desc-option__body\">{children}</div>\r\n      </div>\r\n    </components.Option>\r\n  );\r\n};\r\n\r\nexport default NoOptionsMessage;\r\n","// Libraries\r\nimport classNames from 'classnames';\r\nimport React, { PureComponent } from 'react';\r\n\r\n// Ignoring because I couldn't get @types/react-select work wih Torkel's fork\r\n// @ts-ignore\r\nimport { default as ReactSelect, Creatable } from '@torkelo/react-select';\r\n// @ts-ignore\r\nimport { Creatable } from '@torkelo/react-select/lib/creatable';\r\n// @ts-ignore\r\nimport { default as ReactAsyncSelect } from '@torkelo/react-select/lib/Async';\r\n// @ts-ignore\r\nimport { components } from '@torkelo/react-select';\r\n\r\n// Components\r\nimport { SelectOption } from './SelectOption';\r\nimport { SelectOptionGroup } from '../Forms/Select/SelectOptionGroup';\r\nimport { SingleValue } from '../Forms/Select/SingleValue';\r\nimport { SelectCommonProps, SelectAsyncProps } from '../Forms/Select/SelectBase';\r\nimport IndicatorsContainer from './IndicatorsContainer';\r\nimport NoOptionsMessage from './NoOptionsMessage';\r\nimport resetSelectStyles from '../Forms/Select/resetSelectStyles';\r\nimport { CustomScrollbar } from '../CustomScrollbar/CustomScrollbar';\r\nimport { PopoverContent } from '../Tooltip/Tooltip';\r\nimport { Tooltip } from '../Tooltip/Tooltip';\r\nimport { SelectableValue } from '@grafana/data';\r\n\r\n/**\r\n * Changes in new selects:\r\n * - noOptionsMessage & loadingMessage is of string type\r\n * - isDisabled is renamed to disabled\r\n */\r\ntype LegacyCommonProps<T> = Omit<SelectCommonProps<T>, 'noOptionsMessage' | 'disabled' | 'value'>;\r\n\r\ninterface AsyncProps<T> extends LegacyCommonProps<T>, Omit<SelectAsyncProps<T>, 'loadingMessage'> {\r\n  loadingMessage?: () => string;\r\n  noOptionsMessage?: () => string;\r\n  tooltipContent?: PopoverContent;\r\n  isDisabled?: boolean;\r\n  value?: SelectableValue<T>;\r\n}\r\n\r\ninterface LegacySelectProps<T> extends LegacyCommonProps<T> {\r\n  tooltipContent?: PopoverContent;\r\n  noOptionsMessage?: () => string;\r\n  isDisabled?: boolean;\r\n  value?: SelectableValue<T>;\r\n}\r\n\r\nexport const MenuList = (props: any) => {\r\n  return (\r\n    <components.MenuList {...props}>\r\n      <CustomScrollbar autoHide={false} autoHeightMax=\"inherit\">\r\n        {props.children}\r\n      </CustomScrollbar>\r\n    </components.MenuList>\r\n  );\r\n};\r\nexport class Select<T> extends PureComponent<LegacySelectProps<T>> {\r\n  static defaultProps: Partial<LegacySelectProps<any>> = {\r\n    className: '',\r\n    isDisabled: false,\r\n    isSearchable: true,\r\n    isClearable: false,\r\n    isMulti: false,\r\n    openMenuOnFocus: false,\r\n    autoFocus: false,\r\n    isLoading: false,\r\n    backspaceRemovesValue: true,\r\n    maxMenuHeight: 300,\r\n    tabSelectsValue: true,\r\n    allowCustomValue: false,\r\n    components: {\r\n      Option: SelectOption,\r\n      SingleValue,\r\n      IndicatorsContainer,\r\n      MenuList,\r\n      Group: SelectOptionGroup,\r\n    },\r\n  };\r\n\r\n  render() {\r\n    const {\r\n      defaultValue,\r\n      getOptionLabel,\r\n      getOptionValue,\r\n      onChange,\r\n      options,\r\n      placeholder,\r\n      width,\r\n      value,\r\n      className,\r\n      isDisabled,\r\n      isLoading,\r\n      isSearchable,\r\n      isClearable,\r\n      backspaceRemovesValue,\r\n      isMulti,\r\n      autoFocus,\r\n      openMenuOnFocus,\r\n      onBlur,\r\n      maxMenuHeight,\r\n      noOptionsMessage,\r\n      isOpen,\r\n      components,\r\n      tooltipContent,\r\n      tabSelectsValue,\r\n      onCloseMenu,\r\n      onOpenMenu,\r\n      allowCustomValue,\r\n      formatCreateLabel,\r\n    } = this.props;\r\n\r\n    let widthClass = '';\r\n    if (width) {\r\n      widthClass = 'width-' + width;\r\n    }\r\n\r\n    let SelectComponent: ReactSelect | Creatable = ReactSelect;\r\n    const creatableOptions: any = {};\r\n\r\n    if (allowCustomValue) {\r\n      SelectComponent = Creatable;\r\n      creatableOptions.formatCreateLabel = formatCreateLabel ?? ((input: string) => input);\r\n    }\r\n\r\n    const selectClassNames = classNames('gf-form-input', 'gf-form-input--form-dropdown', widthClass, className);\r\n    const selectComponents = { ...Select.defaultProps.components, ...components };\r\n    return (\r\n      <WrapInTooltip onCloseMenu={onCloseMenu} onOpenMenu={onOpenMenu} tooltipContent={tooltipContent} isOpen={isOpen}>\r\n        {(onOpenMenuInternal, onCloseMenuInternal) => {\r\n          return (\r\n            <SelectComponent\r\n              classNamePrefix=\"gf-form-select-box\"\r\n              className={selectClassNames}\r\n              components={selectComponents}\r\n              defaultValue={defaultValue}\r\n              value={value}\r\n              getOptionLabel={getOptionLabel}\r\n              getOptionValue={getOptionValue}\r\n              menuShouldScrollIntoView={false}\r\n              isSearchable={isSearchable}\r\n              onChange={onChange}\r\n              options={options}\r\n              placeholder={placeholder || 'Choose'}\r\n              styles={resetSelectStyles()}\r\n              isDisabled={isDisabled}\r\n              isLoading={isLoading}\r\n              isClearable={isClearable}\r\n              autoFocus={autoFocus}\r\n              onBlur={onBlur}\r\n              openMenuOnFocus={openMenuOnFocus}\r\n              maxMenuHeight={maxMenuHeight}\r\n              noOptionsMessage={() => noOptionsMessage}\r\n              isMulti={isMulti}\r\n              backspaceRemovesValue={backspaceRemovesValue}\r\n              menuIsOpen={isOpen}\r\n              onMenuOpen={onOpenMenuInternal}\r\n              onMenuClose={onCloseMenuInternal}\r\n              tabSelectsValue={tabSelectsValue}\r\n              {...creatableOptions}\r\n            />\r\n          );\r\n        }}\r\n      </WrapInTooltip>\r\n    );\r\n  }\r\n}\r\n\r\nexport class AsyncSelect<T> extends PureComponent<AsyncProps<T>> {\r\n  static defaultProps: Partial<AsyncProps<any>> = {\r\n    className: '',\r\n    components: {},\r\n    loadingMessage: () => 'Loading...',\r\n    isDisabled: false,\r\n    isClearable: false,\r\n    isMulti: false,\r\n    isSearchable: true,\r\n    backspaceRemovesValue: true,\r\n    autoFocus: false,\r\n    openMenuOnFocus: false,\r\n    maxMenuHeight: 300,\r\n  };\r\n\r\n  render() {\r\n    const {\r\n      defaultValue,\r\n      getOptionLabel,\r\n      getOptionValue,\r\n      onChange,\r\n      placeholder,\r\n      width,\r\n      value,\r\n      className,\r\n      loadOptions,\r\n      defaultOptions,\r\n      isLoading,\r\n      loadingMessage,\r\n      noOptionsMessage,\r\n      isDisabled,\r\n      isSearchable,\r\n      isClearable,\r\n      backspaceRemovesValue,\r\n      autoFocus,\r\n      onBlur,\r\n      openMenuOnFocus,\r\n      maxMenuHeight,\r\n      isMulti,\r\n      tooltipContent,\r\n      onCloseMenu,\r\n      onOpenMenu,\r\n      isOpen,\r\n    } = this.props;\r\n\r\n    let widthClass = '';\r\n    if (width) {\r\n      widthClass = 'width-' + width;\r\n    }\r\n\r\n    const selectClassNames = classNames('gf-form-input', 'gf-form-input--form-dropdown', widthClass, className);\r\n\r\n    return (\r\n      <WrapInTooltip onCloseMenu={onCloseMenu} onOpenMenu={onOpenMenu} tooltipContent={tooltipContent} isOpen={isOpen}>\r\n        {(onOpenMenuInternal, onCloseMenuInternal) => {\r\n          return (\r\n            <ReactAsyncSelect\r\n              classNamePrefix=\"gf-form-select-box\"\r\n              className={selectClassNames}\r\n              components={{\r\n                Option: SelectOption,\r\n                SingleValue,\r\n                IndicatorsContainer,\r\n                NoOptionsMessage,\r\n              }}\r\n              defaultValue={defaultValue}\r\n              value={value}\r\n              getOptionLabel={getOptionLabel}\r\n              getOptionValue={getOptionValue}\r\n              menuShouldScrollIntoView={false}\r\n              onChange={onChange}\r\n              loadOptions={loadOptions}\r\n              isLoading={isLoading}\r\n              defaultOptions={defaultOptions}\r\n              placeholder={placeholder || 'Choose'}\r\n              styles={resetSelectStyles()}\r\n              loadingMessage={() => loadingMessage}\r\n              noOptionsMessage={noOptionsMessage}\r\n              isDisabled={isDisabled}\r\n              isSearchable={isSearchable}\r\n              isClearable={isClearable}\r\n              autoFocus={autoFocus}\r\n              onBlur={onBlur}\r\n              openMenuOnFocus={openMenuOnFocus}\r\n              maxMenuHeight={maxMenuHeight}\r\n              isMulti={isMulti}\r\n              backspaceRemovesValue={backspaceRemovesValue}\r\n            />\r\n          );\r\n        }}\r\n      </WrapInTooltip>\r\n    );\r\n  }\r\n}\r\n\r\nexport interface TooltipWrapperProps {\r\n  children: (onOpenMenu: () => void, onCloseMenu: () => void) => React.ReactNode;\r\n  onOpenMenu?: () => void;\r\n  onCloseMenu?: () => void;\r\n  isOpen?: boolean;\r\n  tooltipContent?: PopoverContent;\r\n}\r\n\r\nexport interface TooltipWrapperState {\r\n  isOpenInternal: boolean;\r\n}\r\n\r\nexport class WrapInTooltip extends PureComponent<TooltipWrapperProps, TooltipWrapperState> {\r\n  state: TooltipWrapperState = {\r\n    isOpenInternal: false,\r\n  };\r\n\r\n  onOpenMenu = () => {\r\n    const { onOpenMenu } = this.props;\r\n    if (onOpenMenu) {\r\n      onOpenMenu();\r\n    }\r\n    this.setState({ isOpenInternal: true });\r\n  };\r\n\r\n  onCloseMenu = () => {\r\n    const { onCloseMenu } = this.props;\r\n    if (onCloseMenu) {\r\n      onCloseMenu();\r\n    }\r\n    this.setState({ isOpenInternal: false });\r\n  };\r\n\r\n  render() {\r\n    const { children, isOpen, tooltipContent } = this.props;\r\n    const { isOpenInternal } = this.state;\r\n\r\n    let showTooltip: boolean | undefined = undefined;\r\n\r\n    if (isOpenInternal || isOpen) {\r\n      showTooltip = false;\r\n    }\r\n\r\n    if (tooltipContent) {\r\n      return (\r\n        <Tooltip show={showTooltip} content={tooltipContent} placement=\"bottom\">\r\n          <div>\r\n            {/* div needed for tooltip */}\r\n            {children(this.onOpenMenu, this.onCloseMenu)}\r\n          </div>\r\n        </Tooltip>\r\n      );\r\n    } else {\r\n      return <div>{children(this.onOpenMenu, this.onCloseMenu)}</div>;\r\n    }\r\n  }\r\n}\r\n\r\nexport default Select;\r\n","import React from 'react';\r\n\r\n// Ignoring because I couldn't get @types/react-select work wih Torkel's fork\r\n// @ts-ignore\r\nimport { components } from '@torkelo/react-select';\r\nimport { OptionProps } from 'react-select/lib/components/Option';\r\n\r\n// https://github.com/JedWatson/react-select/issues/3038\r\nexport interface ExtendedOptionProps extends OptionProps<any> {\r\n  data: {\r\n    description?: string;\r\n    imgUrl?: string;\r\n  };\r\n}\r\n\r\nexport const SelectOption = (props: ExtendedOptionProps) => {\r\n  const { children, isSelected, data } = props;\r\n\r\n  return (\r\n    <components.Option {...props}>\r\n      <div className=\"gf-form-select-box__desc-option\">\r\n        {data.imgUrl && <img className=\"gf-form-select-box__desc-option__img\" src={data.imgUrl} />}\r\n        <div className=\"gf-form-select-box__desc-option__body\">\r\n          <div>{children}</div>\r\n          {data.description && <div className=\"gf-form-select-box__desc-option__desc\">{data.description}</div>}\r\n        </div>\r\n        {isSelected && <i className=\"fa fa-check\" aria-hidden=\"true\" />}\r\n      </div>\r\n    </components.Option>\r\n  );\r\n};\r\n\r\nexport default SelectOption;\r\n","import { PureComponent } from 'react';\r\nimport { interval, Subscription, Subject, of, NEVER } from 'rxjs';\r\nimport { tap, switchMap } from 'rxjs/operators';\r\nimport _ from 'lodash';\r\n\r\nimport { stringToMs, SelectableValue } from '@grafana/data';\r\nimport { RefreshPicker } from '../RefreshPicker/RefreshPicker';\r\n\r\nexport function getIntervalFromString(strInterval: string): SelectableValue<number> {\r\n  return {\r\n    label: strInterval,\r\n    value: stringToMs(strInterval),\r\n  };\r\n}\r\n\r\ninterface Props {\r\n  func: () => any; // TODO\r\n  loading: boolean;\r\n  interval: string;\r\n}\r\n\r\nexport class SetInterval extends PureComponent<Props> {\r\n  private propsSubject: Subject<Props>;\r\n  private subscription: Subscription | null;\r\n\r\n  constructor(props: Props) {\r\n    super(props);\r\n    this.propsSubject = new Subject<Props>();\r\n    this.subscription = null;\r\n  }\r\n\r\n  componentDidMount() {\r\n    // Creating a subscription to propsSubject. This subject pushes values every time\r\n    // SetInterval's props change\r\n    this.subscription = this.propsSubject\r\n      .pipe(\r\n        // switchMap creates a new observables based on the input stream,\r\n        // which becomes part of the propsSubject stream\r\n        switchMap(props => {\r\n          // If the query is live, empty value is emited. `of` creates single value,\r\n          // which is merged to propsSubject stream\r\n          if (RefreshPicker.isLive(props.interval)) {\r\n            return of({});\r\n          }\r\n\r\n          // When query is loading, a new stream is merged. But it's a stream that emits no values(NEVER),\r\n          // hence next call of this function will happen when query changes, and new props are passed into this component\r\n          // When query is NOT loading, a new value is emited, this time it's an interval value,\r\n          // which makes tap function below execute on that interval basis.\r\n          return props.loading ? NEVER : interval(stringToMs(props.interval));\r\n        }),\r\n        // tap will execute function passed via func prop\r\n        // * on value from `of` stream merged if query is live\r\n        // * on specified interval (triggered by values emited by interval)\r\n        tap(() => this.props.func())\r\n      )\r\n      .subscribe();\r\n\r\n    // When component has mounted, propsSubject emits it's first value\r\n    this.propsSubject.next(this.props);\r\n  }\r\n\r\n  componentDidUpdate(prevProps: Props) {\r\n    if (\r\n      (RefreshPicker.isLive(prevProps.interval) && RefreshPicker.isLive(this.props.interval)) ||\r\n      _.isEqual(prevProps, this.props)\r\n    ) {\r\n      return;\r\n    }\r\n    // if props changed, a new value is emited from propsSubject\r\n    this.propsSubject.next(this.props);\r\n  }\r\n\r\n  componentWillUnmount() {\r\n    if (this.subscription) {\r\n      this.subscription.unsubscribe();\r\n    }\r\n\r\n    this.propsSubject.unsubscribe();\r\n  }\r\n\r\n  render(): null {\r\n    return null;\r\n  }\r\n}\r\n","// Libraries\r\nimport React, { PureComponent, ChangeEvent } from 'react';\r\n\r\n// Components\r\nimport { FormLabel } from '../FormLabel/FormLabel';\r\nimport { FormField } from '../FormField/FormField';\r\nimport { StatsPicker } from '../StatsPicker/StatsPicker';\r\n\r\n// Types\r\nimport Select from '../Select/Select';\r\nimport {\r\n  FieldDisplayOptions,\r\n  DEFAULT_FIELD_DISPLAY_VALUES_LIMIT,\r\n  ReducerID,\r\n  toNumberString,\r\n  toIntegerOrUndefined,\r\n  SelectableValue,\r\n  FieldConfig,\r\n} from '@grafana/data';\r\n\r\nconst showOptions: Array<SelectableValue<boolean>> = [\r\n  {\r\n    value: true,\r\n    label: 'All Values',\r\n    description: 'Each row in the response data',\r\n  },\r\n  {\r\n    value: false,\r\n    label: 'Calculation',\r\n    description: 'Calculate a value based on the response',\r\n  },\r\n];\r\n\r\nexport interface Props {\r\n  labelWidth?: number;\r\n  value: FieldDisplayOptions;\r\n  onChange: (value: FieldDisplayOptions, event?: React.SyntheticEvent<HTMLElement>) => void;\r\n}\r\n\r\nexport class FieldDisplayEditor extends PureComponent<Props> {\r\n  onShowValuesChange = (item: SelectableValue<boolean>) => {\r\n    const val = item.value === true;\r\n    this.props.onChange({ ...this.props.value, values: val });\r\n  };\r\n\r\n  onCalcsChange = (calcs: string[]) => {\r\n    this.props.onChange({ ...this.props.value, calcs });\r\n  };\r\n\r\n  onDefaultsChange = (value: FieldConfig) => {\r\n    this.props.onChange({ ...this.props.value, defaults: value });\r\n  };\r\n\r\n  onLimitChange = (event: ChangeEvent<HTMLInputElement>) => {\r\n    this.props.onChange({\r\n      ...this.props.value,\r\n      limit: toIntegerOrUndefined(event.target.value),\r\n    });\r\n  };\r\n\r\n  render() {\r\n    const { value } = this.props;\r\n    const { calcs, values, limit } = value;\r\n\r\n    const labelWidth = this.props.labelWidth || 5;\r\n\r\n    return (\r\n      <>\r\n        <div className=\"gf-form\">\r\n          <FormLabel width={labelWidth}>Show</FormLabel>\r\n          <Select\r\n            options={showOptions}\r\n            value={values ? showOptions[0] : showOptions[1]}\r\n            onChange={this.onShowValuesChange}\r\n          />\r\n        </div>\r\n        {values ? (\r\n          <FormField\r\n            label=\"Limit\"\r\n            labelWidth={labelWidth}\r\n            placeholder={`${DEFAULT_FIELD_DISPLAY_VALUES_LIMIT}`}\r\n            onChange={this.onLimitChange}\r\n            value={toNumberString(limit)}\r\n            type=\"number\"\r\n          />\r\n        ) : (\r\n          <div className=\"gf-form\">\r\n            <FormLabel width={labelWidth}>Calc</FormLabel>\r\n            <StatsPicker\r\n              width={12}\r\n              placeholder=\"Choose Stat\"\r\n              defaultStat={ReducerID.mean}\r\n              allowMultiple={false}\r\n              stats={calcs}\r\n              onChange={this.onCalcsChange}\r\n            />\r\n          </div>\r\n        )}\r\n      </>\r\n    );\r\n  }\r\n}\r\n","// Libraries\r\nimport React, { ChangeEvent, useState, useCallback } from 'react';\r\n\r\n// Components\r\nimport { FormField } from '../FormField/FormField';\r\nimport { FormLabel } from '../FormLabel/FormLabel';\r\nimport { UnitPicker } from '../UnitPicker/UnitPicker';\r\n\r\n// Types\r\nimport {\r\n  VAR_SERIES_NAME,\r\n  VAR_FIELD_NAME,\r\n  VAR_CALC,\r\n  VAR_CELL_PREFIX,\r\n  toIntegerOrUndefined,\r\n  FieldConfig,\r\n  toFloatOrUndefined,\r\n  toNumberString,\r\n} from '@grafana/data';\r\n\r\nconst labelWidth = 6;\r\n\r\nexport interface Props {\r\n  showMinMax?: boolean;\r\n  showTitle?: boolean;\r\n  value: FieldConfig;\r\n  onChange: (value: FieldConfig, event?: React.SyntheticEvent<HTMLElement>) => void;\r\n}\r\n\r\nexport const FieldPropertiesEditor: React.FC<Props> = ({ value, onChange, showMinMax, showTitle }) => {\r\n  const { unit, title } = value;\r\n\r\n  const [decimals, setDecimals] = useState(\r\n    value.decimals !== undefined && value.decimals !== null ? value.decimals.toString() : ''\r\n  );\r\n  const [min, setMin] = useState(toNumberString(value.min));\r\n  const [max, setMax] = useState(toNumberString(value.max));\r\n\r\n  const onTitleChange = (event: ChangeEvent<HTMLInputElement>) => {\r\n    onChange({ ...value, title: event.target.value });\r\n  };\r\n\r\n  const onDecimalChange = useCallback(\r\n    (event: ChangeEvent<HTMLInputElement>) => {\r\n      setDecimals(event.target.value);\r\n    },\r\n    [value.decimals, onChange]\r\n  );\r\n\r\n  const onMinChange = useCallback(\r\n    (event: ChangeEvent<HTMLInputElement>) => {\r\n      setMin(event.target.value);\r\n    },\r\n    [value.min, onChange]\r\n  );\r\n\r\n  const onMaxChange = useCallback(\r\n    (event: ChangeEvent<HTMLInputElement>) => {\r\n      setMax(event.target.value);\r\n    },\r\n    [value.max, onChange]\r\n  );\r\n\r\n  const onUnitChange = (unit?: string) => {\r\n    onChange({ ...value, unit });\r\n  };\r\n\r\n  const commitChanges = useCallback(() => {\r\n    onChange({\r\n      ...value,\r\n      decimals: toIntegerOrUndefined(decimals),\r\n      min: toFloatOrUndefined(min),\r\n      max: toFloatOrUndefined(max),\r\n    });\r\n  }, [min, max, decimals]);\r\n\r\n  const titleTooltip = (\r\n    <div>\r\n      Template Variables:\r\n      <br />\r\n      {'${' + VAR_SERIES_NAME + '}'}\r\n      <br />\r\n      {'${' + VAR_FIELD_NAME + '}'}\r\n      <br />\r\n      {'$' + VAR_CELL_PREFIX + '{N}'} / {'$' + VAR_CALC}\r\n    </div>\r\n  );\r\n\r\n  return (\r\n    <>\r\n      {showTitle && (\r\n        <FormField\r\n          label=\"Title\"\r\n          labelWidth={labelWidth}\r\n          onChange={onTitleChange}\r\n          value={title}\r\n          tooltip={titleTooltip}\r\n          placeholder=\"Auto\"\r\n        />\r\n      )}\r\n\r\n      <div className=\"gf-form\">\r\n        <FormLabel width={labelWidth}>Unit</FormLabel>\r\n        <UnitPicker value={unit} onChange={onUnitChange} />\r\n      </div>\r\n      {showMinMax && (\r\n        <>\r\n          <FormField\r\n            label=\"Min\"\r\n            labelWidth={labelWidth}\r\n            onChange={onMinChange}\r\n            onBlur={commitChanges}\r\n            value={min}\r\n            placeholder=\"Auto\"\r\n            type=\"number\"\r\n          />\r\n          <FormField\r\n            label=\"Max\"\r\n            labelWidth={labelWidth}\r\n            onChange={onMaxChange}\r\n            onBlur={commitChanges}\r\n            value={max}\r\n            type=\"number\"\r\n            placeholder=\"Auto\"\r\n          />\r\n        </>\r\n      )}\r\n      <FormField\r\n        label=\"Decimals\"\r\n        labelWidth={labelWidth}\r\n        placeholder=\"auto\"\r\n        onChange={onDecimalChange}\r\n        onBlur={commitChanges}\r\n        value={decimals}\r\n        type=\"number\"\r\n      />\r\n    </>\r\n  );\r\n};\r\n","import cloneDeep from 'lodash/cloneDeep';\r\nimport omit from 'lodash/omit';\r\n\r\nimport {\r\n  fieldReducers,\r\n  Threshold,\r\n  sortThresholds,\r\n  FieldConfig,\r\n  ReducerID,\r\n  ValueMapping,\r\n  MappingType,\r\n  VizOrientation,\r\n  PanelModel,\r\n  FieldDisplayOptions,\r\n  ConfigOverrideRule,\r\n  ThresholdsMode,\r\n  ThresholdsConfig,\r\n  validateFieldConfig,\r\n  FieldColorMode,\r\n} from '@grafana/data';\r\n\r\nexport interface SingleStatBaseOptions {\r\n  fieldOptions: FieldDisplayOptions;\r\n  orientation: VizOrientation;\r\n}\r\n\r\nconst optionsToKeep = ['fieldOptions', 'orientation'];\r\n\r\nexport function sharedSingleStatPanelChangedHandler(\r\n  options: Partial<SingleStatBaseOptions> | any,\r\n  prevPluginId: string,\r\n  prevOptions: any\r\n) {\r\n  // Migrating from angular singlestat\r\n  if (prevPluginId === 'singlestat' && prevOptions.angular) {\r\n    const panel = prevOptions.angular;\r\n    const reducer = fieldReducers.getIfExists(panel.valueName);\r\n    const options = {\r\n      fieldOptions: {\r\n        defaults: {} as FieldConfig,\r\n        overrides: [] as ConfigOverrideRule[],\r\n        calcs: [reducer ? reducer.id : ReducerID.mean],\r\n      },\r\n      orientation: VizOrientation.Horizontal,\r\n    };\r\n\r\n    const defaults = options.fieldOptions.defaults;\r\n    if (panel.format) {\r\n      defaults.unit = panel.format;\r\n    }\r\n    if (panel.nullPointMode) {\r\n      defaults.nullValueMode = panel.nullPointMode;\r\n    }\r\n    if (panel.nullText) {\r\n      defaults.noValue = panel.nullText;\r\n    }\r\n    if (panel.decimals || panel.decimals === 0) {\r\n      defaults.decimals = panel.decimals;\r\n    }\r\n\r\n    // Convert thresholds and color values\r\n    if (panel.thresholds && panel.colors) {\r\n      const levels = panel.thresholds.split(',').map((strVale: string) => {\r\n        return Number(strVale.trim());\r\n      });\r\n\r\n      // One more color than threshold\r\n      const thresholds: Threshold[] = [];\r\n      for (const color of panel.colors) {\r\n        const idx = thresholds.length - 1;\r\n        if (idx >= 0) {\r\n          thresholds.push({ value: levels[idx], color });\r\n        } else {\r\n          thresholds.push({ value: -Infinity, color });\r\n        }\r\n      }\r\n      defaults.thresholds = {\r\n        mode: ThresholdsMode.Absolute,\r\n        steps: thresholds,\r\n      };\r\n    }\r\n\r\n    // Convert value mappings\r\n    const mappings = convertOldAngularValueMapping(panel);\r\n    if (mappings && mappings.length) {\r\n      defaults.mappings = mappings;\r\n    }\r\n\r\n    if (panel.gauge) {\r\n      defaults.min = panel.gauge.minValue;\r\n      defaults.max = panel.gauge.maxValue;\r\n    }\r\n    return options;\r\n  }\r\n\r\n  for (const k of optionsToKeep) {\r\n    if (prevOptions.hasOwnProperty(k)) {\r\n      options[k] = cloneDeep(prevOptions[k]);\r\n    }\r\n  }\r\n  return options;\r\n}\r\n\r\nexport function sharedSingleStatMigrationHandler(panel: PanelModel<SingleStatBaseOptions>): SingleStatBaseOptions {\r\n  if (!panel.options) {\r\n    // This happens on the first load or when migrating from angular\r\n    return {} as any;\r\n  }\r\n\r\n  const previousVersion = parseFloat(panel.pluginVersion || '6.1');\r\n  let options = panel.options as any;\r\n\r\n  if (previousVersion < 6.2) {\r\n    options = migrateFromValueOptions(options);\r\n  }\r\n\r\n  if (previousVersion < 6.3) {\r\n    options = moveThresholdsAndMappingsToField(options);\r\n  }\r\n\r\n  if (previousVersion < 6.6) {\r\n    const { fieldOptions } = options;\r\n\r\n    // discard the old `override` options and enter an empty array\r\n    if (fieldOptions && fieldOptions.override) {\r\n      const { override, ...rest } = options.fieldOptions;\r\n      options = {\r\n        ...options,\r\n        fieldOptions: {\r\n          ...rest,\r\n          overrides: [],\r\n        },\r\n      };\r\n    }\r\n\r\n    // Move thresholds to steps\r\n    let thresholds = fieldOptions?.defaults?.thresholds;\r\n    if (thresholds) {\r\n      delete fieldOptions.defaults.thresholds;\r\n    } else {\r\n      thresholds = fieldOptions?.thresholds;\r\n      delete fieldOptions.thresholds;\r\n    }\r\n\r\n    if (thresholds) {\r\n      fieldOptions.defaults.thresholds = {\r\n        mode: ThresholdsMode.Absolute,\r\n        steps: thresholds,\r\n      };\r\n    }\r\n\r\n    // Migrate color from simple string to a mode\r\n    const { defaults } = fieldOptions;\r\n    if (defaults.color && typeof defaults.color === 'string') {\r\n      defaults.color = {\r\n        mode: FieldColorMode.Fixed,\r\n        fixedColor: defaults.color,\r\n      };\r\n    }\r\n\r\n    validateFieldConfig(defaults);\r\n  }\r\n\r\n  return options as SingleStatBaseOptions;\r\n}\r\n\r\nexport function moveThresholdsAndMappingsToField(old: any) {\r\n  const { fieldOptions } = old;\r\n\r\n  if (!fieldOptions) {\r\n    return old;\r\n  }\r\n\r\n  const { mappings, ...rest } = old.fieldOptions;\r\n\r\n  let thresholds: ThresholdsConfig | undefined = undefined;\r\n  if (old.thresholds) {\r\n    thresholds = {\r\n      mode: ThresholdsMode.Absolute,\r\n      steps: migrateOldThresholds(old.thresholds)!,\r\n    };\r\n  }\r\n\r\n  return {\r\n    ...old,\r\n    fieldOptions: {\r\n      ...rest,\r\n      defaults: {\r\n        ...fieldOptions.defaults,\r\n        mappings,\r\n        thresholds,\r\n      },\r\n    },\r\n  };\r\n}\r\n\r\n/*\r\n * Moves valueMappings and thresholds from root to new fieldOptions object\r\n * Renames valueOptions to to defaults and moves it under fieldOptions\r\n */\r\nexport function migrateFromValueOptions(old: any) {\r\n  const { valueOptions } = old;\r\n  if (!valueOptions) {\r\n    return old;\r\n  }\r\n\r\n  const fieldOptions: any = {};\r\n  const fieldDefaults: any = {};\r\n\r\n  fieldOptions.mappings = old.valueMappings;\r\n  fieldOptions.thresholds = old.thresholds;\r\n  fieldOptions.defaults = fieldDefaults;\r\n\r\n  fieldDefaults.unit = valueOptions.unit;\r\n  fieldDefaults.decimals = valueOptions.decimals;\r\n\r\n  // Make sure the stats have a valid name\r\n  if (valueOptions.stat) {\r\n    const reducer = fieldReducers.get(valueOptions.stat);\r\n    if (reducer) {\r\n      fieldOptions.calcs = [reducer.id];\r\n    }\r\n  }\r\n\r\n  fieldDefaults.min = old.minValue;\r\n  fieldDefaults.max = old.maxValue;\r\n\r\n  const newOptions = {\r\n    ...old,\r\n    fieldOptions,\r\n  };\r\n\r\n  return omit(newOptions, 'valueMappings', 'thresholds', 'valueOptions', 'minValue', 'maxValue');\r\n}\r\n\r\nexport function migrateOldThresholds(thresholds?: any[]): Threshold[] | undefined {\r\n  if (!thresholds || !thresholds.length) {\r\n    return undefined;\r\n  }\r\n  const copy = thresholds.map(t => {\r\n    return {\r\n      // Drops 'index'\r\n      value: t.value === null ? -Infinity : t.value,\r\n      color: t.color,\r\n    };\r\n  });\r\n  sortThresholds(copy);\r\n  copy[0].value = -Infinity;\r\n  return copy;\r\n}\r\n\r\n/**\r\n * Convert the angular single stat mapping to new react style\r\n */\r\nexport function convertOldAngularValueMapping(panel: any): ValueMapping[] {\r\n  const mappings: ValueMapping[] = [];\r\n\r\n  // Guess the right type based on options\r\n  let mappingType = panel.mappingType;\r\n  if (!panel.mappingType) {\r\n    if (panel.valueMaps && panel.valueMaps.length) {\r\n      mappingType = 1;\r\n    } else if (panel.rangeMaps && panel.rangeMaps.length) {\r\n      mappingType = 2;\r\n    }\r\n  }\r\n\r\n  // check value to text mappings if its enabled\r\n  if (mappingType === 1) {\r\n    for (let i = 0; i < panel.valueMaps.length; i++) {\r\n      const map = panel.valueMaps[i];\r\n      mappings.push({\r\n        ...map,\r\n        id: i, // used for order\r\n        type: MappingType.ValueToText,\r\n      });\r\n    }\r\n  } else if (mappingType === 2) {\r\n    for (let i = 0; i < panel.rangeMaps.length; i++) {\r\n      const map = panel.rangeMaps[i];\r\n      mappings.push({\r\n        ...map,\r\n        id: i, // used for order\r\n        type: MappingType.RangeToText,\r\n      });\r\n    }\r\n  }\r\n\r\n  return mappings;\r\n}\r\n","export { FieldDisplayEditor } from './FieldDisplayEditor';\r\nexport { FieldPropertiesEditor } from './FieldPropertiesEditor';\r\n\r\nexport {\r\n  SingleStatBaseOptions,\r\n  sharedSingleStatPanelChangedHandler,\r\n  sharedSingleStatMigrationHandler,\r\n  convertOldAngularValueMapping,\r\n} from './SingleStatBaseOptions';\r\n","import React, { FC } from 'react';\r\nimport { cx, css } from 'emotion';\r\nimport { stylesFactory } from '../../themes';\r\n\r\nconst getStyles = stylesFactory((size: number, inline: boolean) => {\r\n  return {\r\n    wrapper: css`\r\n      font-size: ${size}px;\r\n      ${inline\r\n        ? css`\r\n            display: inline-block;\r\n          `\r\n        : ''}\r\n    `,\r\n  };\r\n});\r\n\r\ntype Props = {\r\n  className?: string;\r\n  style?: React.CSSProperties;\r\n  iconClassName?: string;\r\n  inline?: boolean;\r\n  size?: number;\r\n};\r\nexport const Spinner: FC<Props> = (props: Props) => {\r\n  const { className, inline = false, iconClassName, style, size = 16 } = props;\r\n  const styles = getStyles(size, inline);\r\n  return (\r\n    <div style={style} className={cx(styles.wrapper, className)}>\r\n      <i className={cx('fa fa-spinner fa-spin', iconClassName)} />\r\n    </div>\r\n  );\r\n};\r\n","import React, { PureComponent } from 'react';\r\n\r\nimport isArray from 'lodash/isArray';\r\nimport difference from 'lodash/difference';\r\n\r\nimport { Select } from '../Select/Select';\r\n\r\nimport { fieldReducers, SelectableValue } from '@grafana/data';\r\n\r\ninterface Props {\r\n  placeholder?: string;\r\n  onChange: (stats: string[]) => void;\r\n  stats: string[];\r\n  width?: number;\r\n  allowMultiple?: boolean;\r\n  defaultStat?: string;\r\n}\r\n\r\nexport class StatsPicker extends PureComponent<Props> {\r\n  static defaultProps = {\r\n    width: 12,\r\n    allowMultiple: false,\r\n  };\r\n\r\n  componentDidMount() {\r\n    this.checkInput();\r\n  }\r\n\r\n  componentDidUpdate(prevProps: Props) {\r\n    this.checkInput();\r\n  }\r\n\r\n  checkInput = () => {\r\n    const { stats, allowMultiple, defaultStat, onChange } = this.props;\r\n\r\n    const current = fieldReducers.list(stats);\r\n    if (current.length !== stats.length) {\r\n      const found = current.map(v => v.id);\r\n      const notFound = difference(stats, found);\r\n      console.warn('Unknown stats', notFound, stats);\r\n      onChange(current.map(stat => stat.id));\r\n    }\r\n\r\n    // Make sure there is only one\r\n    if (!allowMultiple && stats.length > 1) {\r\n      console.warn('Removing extra stat', stats);\r\n      onChange([stats[0]]);\r\n    }\r\n\r\n    // Set the reducer from callback\r\n    if (defaultStat && stats.length < 1) {\r\n      onChange([defaultStat]);\r\n    }\r\n  };\r\n\r\n  onSelectionChange = (item: SelectableValue<string>) => {\r\n    const { onChange } = this.props;\r\n    if (isArray(item)) {\r\n      onChange(item.map(v => v.value));\r\n    } else {\r\n      onChange(item.value ? [item.value] : []);\r\n    }\r\n  };\r\n\r\n  render() {\r\n    const { width, stats, allowMultiple, defaultStat, placeholder } = this.props;\r\n\r\n    const select = fieldReducers.selectOptions(stats);\r\n    return (\r\n      <Select\r\n        width={width}\r\n        value={select.current}\r\n        isClearable={!defaultStat}\r\n        isMulti={allowMultiple}\r\n        isSearchable={true}\r\n        options={select.options}\r\n        placeholder={placeholder}\r\n        onChange={this.onSelectionChange}\r\n      />\r\n    );\r\n  }\r\n}\r\n","import React, { PureComponent } from 'react';\r\nimport uniqueId from 'lodash/uniqueId';\r\nimport { Tooltip } from '../Tooltip/Tooltip';\r\nimport * as PopperJS from 'popper.js';\r\n\r\nexport interface Props {\r\n  label: string;\r\n  checked: boolean;\r\n  className?: string;\r\n  labelClass?: string;\r\n  switchClass?: string;\r\n  tooltip?: string;\r\n  tooltipPlacement?: PopperJS.Placement;\r\n  transparent?: boolean;\r\n  onChange: (event?: React.SyntheticEvent<HTMLInputElement>) => void;\r\n}\r\n\r\nexport interface State {\r\n  id: string;\r\n}\r\n\r\nexport class Switch extends PureComponent<Props, State> {\r\n  state = {\r\n    id: uniqueId(),\r\n  };\r\n\r\n  internalOnChange = (event: React.FormEvent<HTMLInputElement>) => {\r\n    event.stopPropagation();\r\n    this.props.onChange(event);\r\n  };\r\n\r\n  render() {\r\n    const {\r\n      labelClass = '',\r\n      switchClass = '',\r\n      label,\r\n      checked,\r\n      transparent,\r\n      className,\r\n      tooltip,\r\n      tooltipPlacement,\r\n    } = this.props;\r\n\r\n    const labelId = this.state.id;\r\n    const labelClassName = `gf-form-label ${labelClass} ${transparent ? 'gf-form-label--transparent' : ''} pointer`;\r\n    const switchClassName = `gf-form-switch ${switchClass} ${transparent ? 'gf-form-switch--transparent' : ''}`;\r\n\r\n    return (\r\n      <div className=\"gf-form-switch-container-react\">\r\n        <label htmlFor={labelId} className={`gf-form gf-form-switch-container ${className || ''}`}>\r\n          {label && (\r\n            <div className={labelClassName}>\r\n              {label}\r\n              {tooltip && (\r\n                <Tooltip placement={tooltipPlacement ? tooltipPlacement : 'auto'} content={tooltip} theme={'info'}>\r\n                  <div className=\"gf-form-help-icon gf-form-help-icon--right-normal\">\r\n                    <i className=\"fa fa-info-circle\" />\r\n                  </div>\r\n                </Tooltip>\r\n              )}\r\n            </div>\r\n          )}\r\n          <div className={switchClassName}>\r\n            <input id={labelId} type=\"checkbox\" checked={checked} onChange={this.internalOnChange} />\r\n            <span className=\"gf-form-switch__slider\" />\r\n          </div>\r\n        </label>\r\n      </div>\r\n    );\r\n  }\r\n}\r\n","import React, { CSSProperties, FC } from 'react';\r\nimport { TableCellProps } from './types';\r\nimport tinycolor from 'tinycolor2';\r\nimport { formattedValueToString } from '@grafana/data';\r\n\r\nexport const BackgroundColoredCell: FC<TableCellProps> = props => {\r\n  const { cell, tableStyles, field } = props;\r\n\r\n  if (!field.display) {\r\n    return null;\r\n  }\r\n\r\n  const themeFactor = tableStyles.theme.isDark ? 1 : -0.7;\r\n  const displayValue = field.display(cell.value);\r\n\r\n  const bgColor2 = tinycolor(displayValue.color)\r\n    .darken(10 * themeFactor)\r\n    .spin(5)\r\n    .toRgbString();\r\n\r\n  const styles: CSSProperties = {\r\n    background: `linear-gradient(120deg, ${bgColor2}, ${displayValue.color})`,\r\n    borderRadius: '0px',\r\n    color: 'white',\r\n    height: tableStyles.cellHeight,\r\n    padding: tableStyles.cellPadding,\r\n  };\r\n\r\n  return <div style={styles}>{formattedValueToString(displayValue)}</div>;\r\n};\r\n","import React, { FC } from 'react';\r\nimport { ThresholdsConfig, ThresholdsMode, VizOrientation } from '@grafana/data';\r\nimport { BarGauge, BarGaugeDisplayMode } from '../BarGauge/BarGauge';\r\nimport { TableCellProps, TableCellDisplayMode } from './types';\r\n\r\nconst defaultScale: ThresholdsConfig = {\r\n  mode: ThresholdsMode.Absolute,\r\n  steps: [\r\n    {\r\n      color: 'blue',\r\n      value: -Infinity,\r\n    },\r\n    {\r\n      color: 'green',\r\n      value: 20,\r\n    },\r\n  ],\r\n};\r\n\r\nexport const BarGaugeCell: FC<TableCellProps> = props => {\r\n  const { field, column, tableStyles, cell } = props;\r\n\r\n  if (!field.display) {\r\n    return null;\r\n  }\r\n\r\n  let { config } = field;\r\n  if (!config.thresholds) {\r\n    config = {\r\n      ...config,\r\n      thresholds: defaultScale,\r\n    };\r\n  }\r\n\r\n  const displayValue = field.display(cell.value);\r\n  let barGaugeMode = BarGaugeDisplayMode.Gradient;\r\n\r\n  if (field.config.custom && field.config.custom.displayMode === TableCellDisplayMode.LcdGauge) {\r\n    barGaugeMode = BarGaugeDisplayMode.Lcd;\r\n  }\r\n\r\n  let width;\r\n  if (column.width) {\r\n    width = (column.width as number) - tableStyles.cellPadding * 2;\r\n  } else {\r\n    width = tableStyles.cellPadding * 2;\r\n  }\r\n\r\n  return (\r\n    <div className={tableStyles.tableCell}>\r\n      <BarGauge\r\n        width={width}\r\n        height={tableStyles.cellHeightInner}\r\n        field={config}\r\n        value={displayValue}\r\n        orientation={VizOrientation.Horizontal}\r\n        theme={tableStyles.theme}\r\n        itemSpacing={1}\r\n        lcdCellWidth={8}\r\n        displayMode={barGaugeMode}\r\n      />\r\n    </div>\r\n  );\r\n};\r\n","import React, { FC } from 'react';\r\nimport { TableCellProps } from './types';\r\nimport { formattedValueToString } from '@grafana/data';\r\n\r\nexport const DefaultCell: FC<TableCellProps> = props => {\r\n  const { field, cell, tableStyles } = props;\r\n\r\n  if (!field.display) {\r\n    return null;\r\n  }\r\n\r\n  const displayValue = field.display(cell.value);\r\n  return <div className={tableStyles.tableCell}>{formattedValueToString(displayValue)}</div>;\r\n};\r\n","import React, { useMemo } from 'react';\r\nimport { DataFrame } from '@grafana/data';\r\nimport { useSortBy, useTable, useBlockLayout, Cell } from 'react-table';\r\nimport { FixedSizeList } from 'react-window';\r\nimport { getColumns, getTableRows } from './utils';\r\nimport { useTheme } from '../../themes';\r\nimport { TableFilterActionCallback } from './types';\r\nimport { getTableStyles } from './styles';\r\nimport { TableCell } from './TableCell';\r\n\r\nexport interface Props {\r\n  data: DataFrame;\r\n  width: number;\r\n  height: number;\r\n  onCellClick?: TableFilterActionCallback;\r\n}\r\n\r\nexport const Table = ({ data, height, onCellClick, width }: Props) => {\r\n  const theme = useTheme();\r\n  const tableStyles = getTableStyles(theme);\r\n\r\n  const { getTableProps, headerGroups, rows, prepareRow } = useTable(\r\n    {\r\n      columns: useMemo(() => getColumns(data, width), [data]),\r\n      data: useMemo(() => getTableRows(data), [data]),\r\n    },\r\n    useSortBy,\r\n    useBlockLayout\r\n  );\r\n\r\n  const RenderRow = React.useCallback(\r\n    ({ index, style }) => {\r\n      const row = rows[index];\r\n      prepareRow(row);\r\n      return (\r\n        <div {...row.getRowProps({ style })} className={tableStyles.row}>\r\n          {row.cells.map((cell: Cell, index: number) => (\r\n            <TableCell\r\n              key={index}\r\n              field={data.fields[cell.column.index]}\r\n              tableStyles={tableStyles}\r\n              cell={cell}\r\n              onCellClick={onCellClick}\r\n            />\r\n          ))}\r\n        </div>\r\n      );\r\n    },\r\n    [prepareRow, rows]\r\n  );\r\n\r\n  return (\r\n    <div {...getTableProps()} className={tableStyles.table}>\r\n      <div>\r\n        {headerGroups.map((headerGroup: any) => (\r\n          <div className={tableStyles.thead} {...headerGroup.getHeaderGroupProps()}>\r\n            {headerGroup.headers.map((column: any) => renderHeaderCell(column, tableStyles.headerCell))}\r\n          </div>\r\n        ))}\r\n      </div>\r\n      <FixedSizeList height={height} itemCount={rows.length} itemSize={tableStyles.rowHeight} width={width}>\r\n        {RenderRow}\r\n      </FixedSizeList>\r\n    </div>\r\n  );\r\n};\r\n\r\nfunction renderHeaderCell(column: any, className: string) {\r\n  const headerProps = column.getHeaderProps(column.getSortByToggleProps());\r\n\r\n  if (column.textAlign) {\r\n    headerProps.style.textAlign = column.textAlign;\r\n  }\r\n\r\n  return (\r\n    <div className={className} {...headerProps}>\r\n      {column.render('Header')}\r\n      <span>{column.isSorted ? (column.isSortedDesc ? ' ' : ' ') : ''}</span>\r\n    </div>\r\n  );\r\n}\r\n","import React, { FC } from 'react';\r\nimport { Cell } from 'react-table';\r\nimport { Field } from '@grafana/data';\r\nimport { getTextAlign } from './utils';\r\nimport { TableFilterActionCallback } from './types';\r\nimport { TableStyles } from './styles';\r\n\r\ninterface Props {\r\n  cell: Cell;\r\n  field: Field;\r\n  tableStyles: TableStyles;\r\n  onCellClick?: TableFilterActionCallback;\r\n}\r\n\r\nexport const TableCell: FC<Props> = ({ cell, field, tableStyles, onCellClick }) => {\r\n  const filterable = field.config.filterable;\r\n  const cellProps = cell.getCellProps();\r\n\r\n  let onClick: ((event: React.SyntheticEvent) => void) | undefined = undefined;\r\n  if (filterable && onCellClick) {\r\n    if (cellProps.style) {\r\n      cellProps.style.cursor = 'pointer';\r\n    }\r\n\r\n    onClick = () => onCellClick(cell.column.Header as string, cell.value);\r\n  }\r\n  const fieldTextAlign = getTextAlign(field);\r\n  if (fieldTextAlign && cellProps.style) {\r\n    cellProps.style.textAlign = fieldTextAlign;\r\n  }\r\n\r\n  return (\r\n    <div {...cellProps} onClick={onClick}>\r\n      {cell.render('Cell', { field, tableStyles })}\r\n    </div>\r\n  );\r\n};\r\n","import { css } from 'emotion';\r\nimport { GrafanaTheme } from '@grafana/data';\r\nimport { stylesFactory, selectThemeVariant as stv } from '../../themes';\r\n\r\nexport interface TableStyles {\r\n  cellHeight: number;\r\n  cellHeightInner: number;\r\n  cellPadding: number;\r\n  rowHeight: number;\r\n  table: string;\r\n  thead: string;\r\n  headerCell: string;\r\n  tableCell: string;\r\n  row: string;\r\n  theme: GrafanaTheme;\r\n}\r\n\r\nexport const getTableStyles = stylesFactory(\r\n  (theme: GrafanaTheme): TableStyles => {\r\n    const colors = theme.colors;\r\n    const headerBg = stv({ light: colors.gray6, dark: colors.dark7 }, theme.type);\r\n    const padding = 6;\r\n    const lineHeight = theme.typography.lineHeight.md;\r\n    const bodyFontSize = 14;\r\n    const cellHeight = padding * 2 + bodyFontSize * lineHeight;\r\n\r\n    return {\r\n      theme,\r\n      cellHeight,\r\n      cellPadding: padding,\r\n      cellHeightInner: bodyFontSize * lineHeight,\r\n      rowHeight: cellHeight + 2,\r\n      table: css`\r\n        overflow: auto;\r\n        border-spacing: 0;\r\n      `,\r\n      thead: css`\r\n        overflow-y: auto;\r\n        overflow-x: hidden;\r\n        background: ${headerBg};\r\n      `,\r\n      headerCell: css`\r\n        padding: ${padding}px 10px;\r\n        cursor: pointer;\r\n        white-space: nowrap;\r\n        color: ${colors.blue};\r\n      `,\r\n      row: css`\r\n        border-bottom: 2px solid ${colors.bodyBg};\r\n      `,\r\n      tableCell: css`\r\n        padding: ${padding}px 10px;\r\n        text-overflow: ellipsis;\r\n        white-space: nowrap;\r\n        overflow: hidden;\r\n      `,\r\n    };\r\n  }\r\n);\r\n","import { CellProps } from 'react-table';\r\nimport { Field } from '@grafana/data';\r\nimport { TableStyles } from './styles';\r\n\r\nexport interface TableFieldOptions {\r\n  width: number;\r\n  align: FieldTextAlignment;\r\n  displayMode: TableCellDisplayMode;\r\n}\r\n\r\nexport enum TableCellDisplayMode {\r\n  Auto = 'auto',\r\n  ColorText = 'color-text',\r\n  ColorBackground = 'color-background',\r\n  GradientGauge = 'gradient-gauge',\r\n  LcdGauge = 'lcd-gauge',\r\n}\r\n\r\nexport type FieldTextAlignment = 'auto' | 'left' | 'right' | 'center';\r\n\r\nexport interface TableRow {\r\n  [x: string]: any;\r\n}\r\n\r\nexport type TableFilterActionCallback = (key: string, value: string) => void;\r\n\r\nexport interface TableCellProps extends CellProps<any> {\r\n  tableStyles: TableStyles;\r\n  field: Field;\r\n}\r\n","import { TextAlignProperty } from 'csstype';\r\nimport { DataFrame, Field, FieldType } from '@grafana/data';\r\nimport { Column } from 'react-table';\r\nimport { DefaultCell } from './DefaultCell';\r\nimport { BarGaugeCell } from './BarGaugeCell';\r\nimport { BackgroundColoredCell } from './BackgroundColorCell';\r\nimport { TableRow, TableFieldOptions, TableCellDisplayMode } from './types';\r\n\r\nexport function getTableRows(data: DataFrame): TableRow[] {\r\n  const tableData = [];\r\n\r\n  for (let i = 0; i < data.length; i++) {\r\n    const row: { [key: string]: string | number } = {};\r\n    for (let j = 0; j < data.fields.length; j++) {\r\n      const prop = data.fields[j].name;\r\n      row[prop] = data.fields[j].values.get(i);\r\n    }\r\n    tableData.push(row);\r\n  }\r\n\r\n  return tableData;\r\n}\r\n\r\nexport function getTextAlign(field: Field): TextAlignProperty {\r\n  if (field.config.custom) {\r\n    const custom = field.config.custom as TableFieldOptions;\r\n\r\n    switch (custom.align) {\r\n      case 'right':\r\n        return 'right';\r\n      case 'left':\r\n        return 'left';\r\n      case 'center':\r\n        return 'center';\r\n    }\r\n  }\r\n\r\n  if (field.type === FieldType.number) {\r\n    return 'right';\r\n  }\r\n\r\n  return 'left';\r\n}\r\n\r\nexport function getColumns(data: DataFrame, availableWidth: number): Column[] {\r\n  const columns: Column[] = [];\r\n  let fieldCountWithoutWidth = data.fields.length;\r\n\r\n  for (const field of data.fields) {\r\n    const fieldTableOptions = (field.config.custom || {}) as TableFieldOptions;\r\n    if (fieldTableOptions.width) {\r\n      availableWidth -= fieldTableOptions.width;\r\n      fieldCountWithoutWidth -= 1;\r\n    }\r\n\r\n    const Cell = getCellComponent(fieldTableOptions.displayMode);\r\n\r\n    columns.push({\r\n      Cell,\r\n      Header: field.name,\r\n      accessor: field.name,\r\n      width: fieldTableOptions.width,\r\n    });\r\n  }\r\n\r\n  // divide up the rest of the space\r\n  const sharedWidth = availableWidth / fieldCountWithoutWidth;\r\n  for (const column of columns) {\r\n    if (!column.width) {\r\n      column.width = sharedWidth;\r\n    }\r\n  }\r\n\r\n  return columns;\r\n}\r\n\r\nfunction getCellComponent(displayMode: TableCellDisplayMode) {\r\n  switch (displayMode) {\r\n    case TableCellDisplayMode.ColorBackground:\r\n      return BackgroundColoredCell;\r\n    case TableCellDisplayMode.LcdGauge:\r\n    case TableCellDisplayMode.GradientGauge:\r\n      return BarGaugeCell;\r\n    default:\r\n      return DefaultCell;\r\n  }\r\n}\r\n","import React from 'react';\r\nimport debounce from 'lodash/debounce';\r\nimport { DataFrame, CSVConfig, readCSV } from '@grafana/data';\r\n\r\ninterface Props {\r\n  config?: CSVConfig;\r\n  text: string;\r\n  width: string | number;\r\n  height: string | number;\r\n  onSeriesParsed: (data: DataFrame[], text: string) => void;\r\n}\r\n\r\ninterface State {\r\n  text: string;\r\n  data: DataFrame[];\r\n}\r\n\r\n/**\r\n * Expects the container div to have size set and will fill it 100%\r\n */\r\nexport class TableInputCSV extends React.PureComponent<Props, State> {\r\n  constructor(props: Props) {\r\n    super(props);\r\n\r\n    const { text, config } = props;\r\n    this.state = {\r\n      text,\r\n      data: readCSV(text, { config }),\r\n    };\r\n  }\r\n\r\n  readCSV: any = debounce(() => {\r\n    const { config } = this.props;\r\n    const { text } = this.state;\r\n\r\n    this.setState({ data: readCSV(text, { config }) });\r\n  }, 150);\r\n\r\n  componentDidUpdate(prevProps: Props, prevState: State) {\r\n    const { text } = this.state;\r\n\r\n    if (text !== prevState.text || this.props.config !== prevProps.config) {\r\n      this.readCSV();\r\n    }\r\n\r\n    // If the props text has changed, replace our local version\r\n    if (this.props.text !== prevProps.text && this.props.text !== text) {\r\n      this.setState({ text: this.props.text });\r\n    }\r\n\r\n    if (this.state.data !== prevState.data) {\r\n      this.props.onSeriesParsed(this.state.data, this.state.text);\r\n    }\r\n  }\r\n\r\n  onTextChange = (event: any) => {\r\n    this.setState({ text: event.target.value });\r\n  };\r\n\r\n  render() {\r\n    const { width, height } = this.props;\r\n    const { data } = this.state;\r\n    return (\r\n      <div className=\"gf-table-input-csv\">\r\n        <textarea\r\n          style={{ width, height }}\r\n          placeholder=\"Enter CSV here...\"\r\n          value={this.state.text}\r\n          onChange={this.onTextChange}\r\n          className=\"gf-form-input\"\r\n        />\r\n        {data && (\r\n          <footer>\r\n            {data.map((frame, index) => {\r\n              return (\r\n                <span key={index}>\r\n                  Rows:{frame.length}, Columns:{frame.fields.length} &nbsp;\r\n                  <i className=\"fa fa-check-circle\" />\r\n                </span>\r\n              );\r\n            })}\r\n          </footer>\r\n        )}\r\n      </div>\r\n    );\r\n  }\r\n}\r\n\r\nexport default TableInputCSV;\r\n","import React, { FC } from 'react';\r\nimport { css, cx } from 'emotion';\r\nimport { GrafanaTheme } from '@grafana/data';\r\nimport { selectThemeVariant, stylesFactory, useTheme } from '../../themes';\r\n\r\nexport interface TabProps {\r\n  label: string;\r\n  active?: boolean;\r\n  icon?: string;\r\n  onChangeTab: () => void;\r\n}\r\n\r\nconst getTabStyles = stylesFactory((theme: GrafanaTheme) => {\r\n  const colors = theme.colors;\r\n  const tabBorderColor = selectThemeVariant({ dark: colors.dark9, light: colors.gray5 }, theme.type);\r\n\r\n  return {\r\n    tabItem: css`\r\n      list-style: none;\r\n      padding: 10px 15px 9px;\r\n      margin-right: ${theme.spacing.md};\r\n      position: relative;\r\n      display: block;\r\n      border: solid transparent;\r\n      border-width: 0 1px 1px;\r\n      border-radius: ${theme.border.radius.md} ${theme.border.radius.md} 0 0;\r\n      color: ${colors.text};\r\n      cursor: pointer;\r\n\r\n      i {\r\n        margin-right: ${theme.spacing.sm};\r\n      }\r\n\r\n      .gicon {\r\n        position: relative;\r\n        top: -2px;\r\n      }\r\n\r\n      &:hover,\r\n      &:focus {\r\n        color: ${colors.linkHover};\r\n      }\r\n    `,\r\n    activeStyle: css`\r\n      border-color: ${colors.orange} ${tabBorderColor} transparent;\r\n      background: ${colors.pageBg};\r\n      color: ${colors.link};\r\n      overflow: hidden;\r\n      cursor: not-allowed;\r\n\r\n      &::before {\r\n        display: block;\r\n        content: ' ';\r\n        position: absolute;\r\n        left: 0;\r\n        right: 0;\r\n        height: 2px;\r\n        top: 0;\r\n        background-image: linear-gradient(to right, #f05a28 30%, #fbca0a 99%);\r\n      }\r\n    `,\r\n  };\r\n});\r\n\r\nexport const Tab: FC<TabProps> = ({ label, active, icon, onChangeTab }) => {\r\n  const theme = useTheme();\r\n  const tabsStyles = getTabStyles(theme);\r\n\r\n  return (\r\n    <li className={cx(tabsStyles.tabItem, active && tabsStyles.activeStyle)} onClick={onChangeTab}>\r\n      {icon && <i className={icon} />}\r\n      {label}\r\n    </li>\r\n  );\r\n};\r\n","import React, { FC, ReactNode } from 'react';\r\nimport { stylesFactory, useTheme } from '../../themes';\r\nimport { css } from 'emotion';\r\nimport { GrafanaTheme } from '@grafana/data';\r\n\r\ninterface Props {\r\n  children: ReactNode;\r\n}\r\n\r\nconst getTabContentStyle = stylesFactory((theme: GrafanaTheme) => {\r\n  return {\r\n    tabContent: css`\r\n      padding: ${theme.spacing.xs};\r\n      height: 90%;\r\n      overflow: hidden;\r\n    `,\r\n  };\r\n});\r\n\r\nexport const TabContent: FC<Props> = ({ children }) => {\r\n  const theme = useTheme();\r\n  const styles = getTabContentStyle(theme);\r\n\r\n  return <div className={styles.tabContent}>{children}</div>;\r\n};\r\n","import React, { FC, ReactNode } from 'react';\r\nimport { stylesFactory, useTheme } from '../../themes';\r\nimport { GrafanaTheme } from '@grafana/data';\r\nimport { css, cx } from 'emotion';\r\n\r\nexport interface Props {\r\n  /** Children should be a single <Tab /> or an array of <Tab /> */\r\n  children: ReactNode;\r\n  className?: string;\r\n  /** For hiding the bottom border (on PageHeader for example) */\r\n  hideBorder?: boolean;\r\n}\r\n\r\nconst getTabsBarStyles = stylesFactory((theme: GrafanaTheme, hideBorder = false) => {\r\n  const colors = theme.colors;\r\n\r\n  return {\r\n    tabsWrapper:\r\n      !hideBorder &&\r\n      css`\r\n        border-bottom: 1px solid ${colors.pageHeaderBorder};\r\n      `,\r\n    tabs: css`\r\n      position: relative;\r\n      top: 1px;\r\n      display: flex;\r\n    `,\r\n  };\r\n});\r\n\r\nexport const TabsBar: FC<Props> = ({ children, className, hideBorder }) => {\r\n  const theme = useTheme();\r\n  const tabsStyles = getTabsBarStyles(theme, hideBorder);\r\n\r\n  return (\r\n    <div className={cx(tabsStyles.tabsWrapper, className)}>\r\n      <ul className={tabsStyles.tabs}>{children}</ul>\r\n    </div>\r\n  );\r\n};\r\n","import React, { FC } from 'react';\r\nimport { css, cx } from 'emotion';\r\nimport { getTagColorsFromName } from '../../utils';\r\nimport { stylesFactory, useTheme } from '../../themes';\r\nimport { GrafanaTheme } from '@grafana/data';\r\n\r\ninterface Props {\r\n  name: string;\r\n\r\n  onRemove: (tag: string) => void;\r\n}\r\n\r\nconst getStyles = stylesFactory(({ theme, name }: { theme: GrafanaTheme; name: string }) => {\r\n  const { color, borderColor } = getTagColorsFromName(name);\r\n\r\n  return {\r\n    itemStyle: css`\r\n      background-color: ${color};\r\n      color: ${theme.colors.white};\r\n      border: 1px solid ${borderColor};\r\n      border-radius: 3px;\r\n      padding: 3px 6px;\r\n      margin: 3px;\r\n      white-space: nowrap;\r\n      text-shadow: none;\r\n      font-weight: 500;\r\n      line-height: 14px;\r\n      display: flex;\r\n      align-items: center;\r\n    `,\r\n\r\n    nameStyle: css`\r\n      margin-right: 3px;\r\n    `,\r\n\r\n    removeStyle: cx([\r\n      'fa fa-times',\r\n      css`\r\n        cursor: pointer;\r\n      `,\r\n    ]),\r\n  };\r\n});\r\n\r\nexport const TagItem: FC<Props> = ({ name, onRemove }) => {\r\n  const theme = useTheme();\r\n  const styles = getStyles({ theme, name });\r\n\r\n  return (\r\n    <div className={styles.itemStyle}>\r\n      <span className={styles.nameStyle}>{name}</span>\r\n      <i className={styles.removeStyle} onClick={() => onRemove(name)} />\r\n    </div>\r\n  );\r\n};\r\n","import React, { ChangeEvent, KeyboardEvent, PureComponent } from 'react';\r\nimport { css, cx } from 'emotion';\r\nimport { stylesFactory } from '../../themes/stylesFactory';\r\nimport { Button } from '../Button/Button';\r\nimport { Input } from '../Input/Input';\r\nimport { TagItem } from './TagItem';\r\n\r\ninterface Props {\r\n  tags?: string[];\r\n  width?: number;\r\n\r\n  onChange: (tags: string[]) => void;\r\n}\r\n\r\ninterface State {\r\n  newTag: string;\r\n  tags: string[];\r\n}\r\n\r\nexport class TagsInput extends PureComponent<Props, State> {\r\n  constructor(props: Props) {\r\n    super(props);\r\n\r\n    this.state = {\r\n      newTag: '',\r\n      tags: this.props.tags || [],\r\n    };\r\n  }\r\n\r\n  onNameChange = (event: ChangeEvent<HTMLInputElement>) => {\r\n    this.setState({\r\n      newTag: event.target.value,\r\n    });\r\n  };\r\n\r\n  onRemove = (tagToRemove: string) => {\r\n    this.setState(\r\n      (prevState: State) => ({\r\n        ...prevState,\r\n        tags: prevState.tags.filter(tag => tagToRemove !== tag),\r\n      }),\r\n      () => this.onChange()\r\n    );\r\n  };\r\n\r\n  // Using React.MouseEvent to avoid tslint error\r\n  onAdd = (event: React.MouseEvent) => {\r\n    event.preventDefault();\r\n    if (this.state.newTag !== '') {\r\n      this.setNewTags();\r\n    }\r\n  };\r\n\r\n  onKeyboardAdd = (event: KeyboardEvent) => {\r\n    event.preventDefault();\r\n    if (event.key === 'Enter' && this.state.newTag !== '') {\r\n      this.setNewTags();\r\n    }\r\n  };\r\n\r\n  setNewTags = () => {\r\n    // We don't want to duplicate tags, clearing the input if\r\n    // the user is trying to add the same tag.\r\n    if (!this.state.tags.includes(this.state.newTag)) {\r\n      this.setState(\r\n        (prevState: State) => ({\r\n          ...prevState,\r\n          tags: [...prevState.tags, prevState.newTag],\r\n          newTag: '',\r\n        }),\r\n        () => this.onChange()\r\n      );\r\n    } else {\r\n      this.setState({ newTag: '' });\r\n    }\r\n  };\r\n\r\n  onChange = () => {\r\n    this.props.onChange(this.state.tags);\r\n  };\r\n\r\n  render() {\r\n    const { tags, newTag } = this.state;\r\n\r\n    const getStyles = stylesFactory(() => ({\r\n      tagsCloudStyle: css`\r\n        display: flex;\r\n        justify-content: flex-start;\r\n        flex-wrap: wrap;\r\n      `,\r\n\r\n      addButtonStyle: css`\r\n        margin-left: 8px;\r\n        margin-top: 2px;\r\n      `,\r\n    }));\r\n\r\n    return (\r\n      <div className=\"width-20\">\r\n        <div\r\n          className={cx(\r\n            ['gf-form-inline'],\r\n            css`\r\n              margin-bottom: 4px;\r\n            `\r\n          )}\r\n        >\r\n          <Input placeholder=\"Add Name\" onChange={this.onNameChange} value={newTag} onKeyUp={this.onKeyboardAdd} />\r\n          <Button className={getStyles().addButtonStyle} onClick={this.onAdd} variant=\"secondary\" size=\"md\">\r\n            Add\r\n          </Button>\r\n        </div>\r\n        <div className={getStyles().tagsCloudStyle}>\r\n          {tags &&\r\n            tags.map((tag: string, index: number) => {\r\n              return <TagItem key={`${tag}-${index}`} name={tag} onRemove={this.onRemove} />;\r\n            })}\r\n        </div>\r\n      </div>\r\n    );\r\n  }\r\n}\r\n","import React, { PureComponent, ChangeEvent } from 'react';\r\nimport { Threshold, sortThresholds, ThresholdsConfig, ThresholdsMode, SelectableValue } from '@grafana/data';\r\nimport { colors } from '../../utils';\r\nimport { getColorFromHexRgbOrName } from '@grafana/data';\r\nimport { Input } from '../Input/Input';\r\nimport { ColorPicker } from '../ColorPicker/ColorPicker';\r\nimport { Themeable } from '../../types';\r\nimport { css } from 'emotion';\r\nimport Select from '../Select/Select';\r\nimport { PanelOptionsGroup } from '../PanelOptionsGroup/PanelOptionsGroup';\r\n\r\nconst modes: Array<SelectableValue<ThresholdsMode>> = [\r\n  { value: ThresholdsMode.Absolute, label: 'Absolute', description: 'Pick thresholds based on the absolute values' },\r\n  {\r\n    value: ThresholdsMode.Percentage,\r\n    label: 'Percentage',\r\n    description: 'Pick threshold based on the percent between min/max',\r\n  },\r\n];\r\n\r\nexport interface Props extends Themeable {\r\n  showAlphaUI?: boolean;\r\n  thresholds: ThresholdsConfig;\r\n  onChange: (thresholds: ThresholdsConfig) => void;\r\n}\r\n\r\ninterface State {\r\n  steps: ThresholdWithKey[];\r\n}\r\n\r\ninterface ThresholdWithKey extends Threshold {\r\n  key: number;\r\n}\r\n\r\nlet counter = 100;\r\n\r\nfunction toThresholdsWithKey(steps?: Threshold[]): ThresholdWithKey[] {\r\n  if (!steps || steps.length === 0) {\r\n    steps = [{ value: -Infinity, color: 'green' }];\r\n  }\r\n\r\n  return steps.map(t => {\r\n    return {\r\n      color: t.color,\r\n      value: t.value === null ? -Infinity : t.value,\r\n      key: counter++,\r\n    };\r\n  });\r\n}\r\n\r\nexport class ThresholdsEditor extends PureComponent<Props, State> {\r\n  constructor(props: Props) {\r\n    super(props);\r\n\r\n    const steps = toThresholdsWithKey(props.thresholds!.steps);\r\n    steps[0].value = -Infinity;\r\n\r\n    this.state = { steps };\r\n  }\r\n\r\n  onAddThresholdAfter = (threshold: ThresholdWithKey) => {\r\n    const { steps } = this.state;\r\n\r\n    const maxValue = 100;\r\n    const minValue = 0;\r\n\r\n    let prev: ThresholdWithKey | undefined = undefined;\r\n    let next: ThresholdWithKey | undefined = undefined;\r\n    for (const t of steps) {\r\n      if (prev && prev.key === threshold.key) {\r\n        next = t;\r\n        break;\r\n      }\r\n      prev = t;\r\n    }\r\n\r\n    const prevValue = prev && isFinite(prev.value) ? prev.value : minValue;\r\n    const nextValue = next && isFinite(next.value) ? next.value : maxValue;\r\n\r\n    const color = colors.filter(c => !steps.some(t => t.color === c))[1];\r\n    const add = {\r\n      value: prevValue + (nextValue - prevValue) / 2.0,\r\n      color: color,\r\n      key: counter++,\r\n    };\r\n    const newThresholds = [...steps, add];\r\n    sortThresholds(newThresholds);\r\n\r\n    this.setState(\r\n      {\r\n        steps: newThresholds,\r\n      },\r\n      () => this.onChange()\r\n    );\r\n  };\r\n\r\n  onRemoveThreshold = (threshold: ThresholdWithKey) => {\r\n    const { steps } = this.state;\r\n    if (!steps.length) {\r\n      return;\r\n    }\r\n    // Don't remove index 0\r\n    if (threshold.key === steps[0].key) {\r\n      return;\r\n    }\r\n    this.setState(\r\n      {\r\n        steps: steps.filter(t => t.key !== threshold.key),\r\n      },\r\n      () => this.onChange()\r\n    );\r\n  };\r\n\r\n  onChangeThresholdValue = (event: ChangeEvent<HTMLInputElement>, threshold: ThresholdWithKey) => {\r\n    const cleanValue = event.target.value.replace(/,/g, '.');\r\n    const parsedValue = parseFloat(cleanValue);\r\n    const value = isNaN(parsedValue) ? '' : parsedValue;\r\n\r\n    const steps = this.state.steps.map(t => {\r\n      if (t.key === threshold.key) {\r\n        t = { ...t, value: value as number };\r\n      }\r\n      return t;\r\n    });\r\n    if (steps.length) {\r\n      steps[0].value = -Infinity;\r\n    }\r\n    this.setState({ steps });\r\n  };\r\n\r\n  onChangeThresholdColor = (threshold: ThresholdWithKey, color: string) => {\r\n    const { steps } = this.state;\r\n\r\n    const newThresholds = steps.map(t => {\r\n      if (t.key === threshold.key) {\r\n        t = { ...t, color: color };\r\n      }\r\n\r\n      return t;\r\n    });\r\n\r\n    this.setState(\r\n      {\r\n        steps: newThresholds,\r\n      },\r\n      () => this.onChange()\r\n    );\r\n  };\r\n\r\n  onBlur = () => {\r\n    const steps = [...this.state.steps];\r\n    sortThresholds(steps);\r\n    this.setState(\r\n      {\r\n        steps,\r\n      },\r\n      () => this.onChange()\r\n    );\r\n  };\r\n\r\n  onChange = () => {\r\n    this.props.onChange(thresholdsWithoutKey(this.props.thresholds, this.state.steps));\r\n  };\r\n\r\n  onModeChanged = (item: SelectableValue<ThresholdsMode>) => {\r\n    if (item.value) {\r\n      this.props.onChange({\r\n        ...this.props.thresholds,\r\n        mode: item.value,\r\n      });\r\n    }\r\n  };\r\n\r\n  renderInput = (threshold: ThresholdWithKey) => {\r\n    const isPercent = this.props.thresholds.mode === ThresholdsMode.Percentage;\r\n    return (\r\n      <div className=\"thresholds-row-input-inner\">\r\n        <span className=\"thresholds-row-input-inner-arrow\" />\r\n        <div className=\"thresholds-row-input-inner-color\">\r\n          {threshold.color && (\r\n            <div className=\"thresholds-row-input-inner-color-colorpicker\">\r\n              <ColorPicker\r\n                color={threshold.color}\r\n                onChange={color => this.onChangeThresholdColor(threshold, color)}\r\n                enableNamedColors={true}\r\n              />\r\n            </div>\r\n          )}\r\n        </div>\r\n        {!isFinite(threshold.value) ? (\r\n          <div className=\"thresholds-row-input-inner-value\">\r\n            <Input type=\"text\" value=\"Base\" readOnly />\r\n          </div>\r\n        ) : (\r\n          <>\r\n            <div className=\"thresholds-row-input-inner-value\">\r\n              <Input\r\n                type=\"number\"\r\n                step=\"0.0001\"\r\n                onChange={(event: ChangeEvent<HTMLInputElement>) => this.onChangeThresholdValue(event, threshold)}\r\n                value={threshold.value}\r\n                onBlur={this.onBlur}\r\n              />\r\n            </div>\r\n            {isPercent && (\r\n              <div className={css(`margin-left:-20px; margin-top:5px;`)}>\r\n                <i className=\"fa fa-percent\" />\r\n              </div>\r\n            )}\r\n            <div className=\"thresholds-row-input-inner-remove\" onClick={() => this.onRemoveThreshold(threshold)}>\r\n              <i className=\"fa fa-times\" />\r\n            </div>\r\n          </>\r\n        )}\r\n      </div>\r\n    );\r\n  };\r\n\r\n  render() {\r\n    const { steps } = this.state;\r\n    const { theme } = this.props;\r\n    const t = this.props.thresholds;\r\n    return (\r\n      <PanelOptionsGroup title=\"Thresholds\">\r\n        <>\r\n          <div className=\"thresholds\">\r\n            {steps\r\n              .slice(0)\r\n              .reverse()\r\n              .map(threshold => {\r\n                return (\r\n                  <div className=\"thresholds-row\" key={`${threshold.key}`}>\r\n                    <div className=\"thresholds-row-add-button\" onClick={() => this.onAddThresholdAfter(threshold)}>\r\n                      <i className=\"fa fa-plus\" />\r\n                    </div>\r\n                    <div\r\n                      className=\"thresholds-row-color-indicator\"\r\n                      style={{ backgroundColor: getColorFromHexRgbOrName(threshold.color, theme.type) }}\r\n                    />\r\n                    <div className=\"thresholds-row-input\">{this.renderInput(threshold)}</div>\r\n                  </div>\r\n                );\r\n              })}\r\n          </div>\r\n\r\n          {this.props.showAlphaUI && (\r\n            <div>\r\n              <Select options={modes} value={modes.filter(m => m.value === t.mode)} onChange={this.onModeChanged} />\r\n            </div>\r\n          )}\r\n        </>\r\n      </PanelOptionsGroup>\r\n    );\r\n  }\r\n}\r\n\r\nexport function thresholdsWithoutKey(thresholds: ThresholdsConfig, steps: ThresholdWithKey[]): ThresholdsConfig {\r\n  const mode = thresholds.mode ?? ThresholdsMode.Absolute;\r\n  return {\r\n    mode,\r\n    steps: steps.map(t => {\r\n      const { key, ...rest } = t;\r\n      return rest; // everything except key\r\n    }),\r\n  };\r\n}\r\n","import React, { FC } from 'react';\r\nimport RcTimePicker from 'rc-time-picker';\r\nimport { dateTime, DateTime, dateTimeAsMoment } from '@grafana/data';\r\n\r\ninterface Props {\r\n  onChange: (value: DateTime) => void;\r\n  value: DateTime;\r\n  showHour?: boolean;\r\n  minuteStep?: number;\r\n}\r\n\r\nexport const TimeOfDayPicker: FC<Props> = ({ minuteStep = 1, showHour = true, onChange, value }) => {\r\n  return (\r\n    <div>\r\n      <RcTimePicker\r\n        defaultValue={dateTimeAsMoment()}\r\n        onChange={(value: any) => onChange(dateTime(value))}\r\n        allowEmpty={false}\r\n        showSecond={false}\r\n        value={dateTimeAsMoment(value)}\r\n        showHour={showHour}\r\n        minuteStep={minuteStep}\r\n      />\r\n    </div>\r\n  );\r\n};\r\n","// Libraries\r\nimport React, { PureComponent, memo, FormEvent } from 'react';\r\nimport { css, cx } from 'emotion';\r\n\r\n// Components\r\nimport { Tooltip } from '../Tooltip/Tooltip';\r\nimport { TimePickerContent } from './TimePickerContent/TimePickerContent';\r\nimport { ClickOutsideWrapper } from '../ClickOutsideWrapper/ClickOutsideWrapper';\r\n\r\n// Utils & Services\r\nimport { stylesFactory } from '../../themes/stylesFactory';\r\nimport { withTheme, useTheme } from '../../themes/ThemeContext';\r\n\r\n// Types\r\nimport { isDateTime, DateTime, rangeUtil, GrafanaTheme, TIME_FORMAT } from '@grafana/data';\r\nimport { TimeRange, TimeOption, TimeZone, dateMath } from '@grafana/data';\r\nimport { Themeable } from '../../types';\r\n\r\nconst quickOptions: TimeOption[] = [\r\n  { from: 'now-5m', to: 'now', display: 'Last 5 minutes', section: 3 },\r\n  { from: 'now-15m', to: 'now', display: 'Last 15 minutes', section: 3 },\r\n  { from: 'now-30m', to: 'now', display: 'Last 30 minutes', section: 3 },\r\n  { from: 'now-1h', to: 'now', display: 'Last 1 hour', section: 3 },\r\n  { from: 'now-3h', to: 'now', display: 'Last 3 hours', section: 3 },\r\n  { from: 'now-6h', to: 'now', display: 'Last 6 hours', section: 3 },\r\n  { from: 'now-12h', to: 'now', display: 'Last 12 hours', section: 3 },\r\n  { from: 'now-24h', to: 'now', display: 'Last 24 hours', section: 3 },\r\n  { from: 'now-2d', to: 'now', display: 'Last 2 days', section: 3 },\r\n  { from: 'now-7d', to: 'now', display: 'Last 7 days', section: 3 },\r\n  { from: 'now-30d', to: 'now', display: 'Last 30 days', section: 3 },\r\n  { from: 'now-90d', to: 'now', display: 'Last 90 days', section: 3 },\r\n  { from: 'now-6M', to: 'now', display: 'Last 6 months', section: 3 },\r\n  { from: 'now-1y', to: 'now', display: 'Last 1 year', section: 3 },\r\n  { from: 'now-2y', to: 'now', display: 'Last 2 years', section: 3 },\r\n  { from: 'now-5y', to: 'now', display: 'Last 5 years', section: 3 },\r\n];\r\n\r\nconst otherOptions: TimeOption[] = [\r\n  { from: 'now-1d/d', to: 'now-1d/d', display: 'Yesterday', section: 3 },\r\n  { from: 'now-2d/d', to: 'now-2d/d', display: 'Day before yesterday', section: 3 },\r\n  { from: 'now-7d/d', to: 'now-7d/d', display: 'This day last week', section: 3 },\r\n  { from: 'now-1w/w', to: 'now-1w/w', display: 'Previous week', section: 3 },\r\n  { from: 'now-1M/M', to: 'now-1M/M', display: 'Previous month', section: 3 },\r\n  { from: 'now-1y/y', to: 'now-1y/y', display: 'Previous year', section: 3 },\r\n  { from: 'now/d', to: 'now/d', display: 'Today', section: 3 },\r\n  { from: 'now/d', to: 'now', display: 'Today so far', section: 3 },\r\n  { from: 'now/w', to: 'now/w', display: 'This week', section: 3 },\r\n  { from: 'now/w', to: 'now', display: 'This week so far', section: 3 },\r\n  { from: 'now/M', to: 'now/M', display: 'This month', section: 3 },\r\n  { from: 'now/M', to: 'now', display: 'This month so far', section: 3 },\r\n  { from: 'now/y', to: 'now/y', display: 'This year', section: 3 },\r\n  { from: 'now/y', to: 'now', display: 'This year so far', section: 3 },\r\n];\r\n\r\nconst getStyles = stylesFactory((theme: GrafanaTheme) => {\r\n  return {\r\n    container: css`\r\n      position: relative;\r\n      display: flex;\r\n      flex-flow: column nowrap;\r\n    `,\r\n    buttons: css`\r\n      display: flex;\r\n    `,\r\n    caretIcon: css`\r\n      margin-left: 3px;\r\n\r\n      i {\r\n        font-size: ${theme.typography.size.md};\r\n      }\r\n    `,\r\n    syncedTimePicker: css`\r\n      label: syncedTimePicker;\r\n      border-color: ${theme.colors.orangeDark};\r\n      background-image: none;\r\n      background-color: transparent;\r\n      color: ${theme.colors.orangeDark};\r\n      &:focus,\r\n      :hover {\r\n        color: ${theme.colors.orangeDark};\r\n        background-image: none;\r\n        background-color: transparent;\r\n      }\r\n    `,\r\n    noRightBorderStyle: css`\r\n      label: noRightBorderStyle;\r\n      border-right: 0;\r\n    `,\r\n  };\r\n});\r\n\r\nconst getLabelStyles = stylesFactory((theme: GrafanaTheme) => {\r\n  return {\r\n    container: css`\r\n      display: inline-block;\r\n    `,\r\n    utc: css`\r\n      color: ${theme.colors.orange};\r\n      font-size: 75%;\r\n      padding: 3px;\r\n      font-weight: ${theme.typography.weight.semibold};\r\n    `,\r\n  };\r\n});\r\n\r\nexport interface Props extends Themeable {\r\n  hideText?: boolean;\r\n  value: TimeRange;\r\n  timeZone?: TimeZone;\r\n  timeSyncButton?: JSX.Element;\r\n  isSynced?: boolean;\r\n  onChange: (timeRange: TimeRange) => void;\r\n  onMoveBackward: () => void;\r\n  onMoveForward: () => void;\r\n  onZoom: () => void;\r\n  history?: TimeRange[];\r\n}\r\n\r\nexport interface State {\r\n  isOpen: boolean;\r\n}\r\n\r\nexport class UnthemedTimePicker extends PureComponent<Props, State> {\r\n  state: State = {\r\n    isOpen: false,\r\n  };\r\n\r\n  onChange = (timeRange: TimeRange) => {\r\n    this.props.onChange(timeRange);\r\n    this.setState({ isOpen: false });\r\n  };\r\n\r\n  onOpen = (event: FormEvent<HTMLButtonElement>) => {\r\n    const { isOpen } = this.state;\r\n    event.stopPropagation();\r\n    this.setState({ isOpen: !isOpen });\r\n  };\r\n\r\n  onClose = () => {\r\n    this.setState({ isOpen: false });\r\n  };\r\n\r\n  render() {\r\n    const {\r\n      value,\r\n      onMoveBackward,\r\n      onMoveForward,\r\n      onZoom,\r\n      timeZone,\r\n      timeSyncButton,\r\n      isSynced,\r\n      theme,\r\n      history,\r\n    } = this.props;\r\n\r\n    const { isOpen } = this.state;\r\n    const styles = getStyles(theme);\r\n    const hasAbsolute = isDateTime(value.raw.from) || isDateTime(value.raw.to);\r\n    const syncedTimePicker = timeSyncButton && isSynced;\r\n    const timePickerIconClass = cx('fa fa-clock-o fa-fw', { ['icon-brand-gradient']: syncedTimePicker });\r\n    const timePickerButtonClass = cx('btn navbar-button navbar-button--zoom', {\r\n      [`btn--radius-right-0 ${styles.noRightBorderStyle}`]: !!timeSyncButton,\r\n      [`explore-active-button-glow ${styles.syncedTimePicker}`]: syncedTimePicker,\r\n    });\r\n\r\n    return (\r\n      <div className={styles.container}>\r\n        <div className={styles.buttons}>\r\n          {hasAbsolute && (\r\n            <button className=\"btn navbar-button navbar-button--tight\" onClick={onMoveBackward}>\r\n              <i className=\"fa fa-chevron-left\" />\r\n            </button>\r\n          )}\r\n          <div>\r\n            <Tooltip content={<TimePickerTooltip timeRange={value} />} placement=\"bottom\">\r\n              <button aria-label=\"TimePicker Open Button\" className={timePickerButtonClass} onClick={this.onOpen}>\r\n                <i className={timePickerIconClass} />\r\n                <TimePickerButtonLabel {...this.props} />\r\n                <span className={styles.caretIcon}>\r\n                  {isOpen ? <i className=\"fa fa-caret-up fa-fw\" /> : <i className=\"fa fa-caret-down fa-fw\" />}\r\n                </span>\r\n              </button>\r\n            </Tooltip>\r\n            {isOpen && (\r\n              <ClickOutsideWrapper onClick={this.onClose}>\r\n                <TimePickerContent\r\n                  timeZone={timeZone}\r\n                  value={value}\r\n                  onChange={this.onChange}\r\n                  otherOptions={otherOptions}\r\n                  quickOptions={quickOptions}\r\n                  history={history}\r\n                />\r\n              </ClickOutsideWrapper>\r\n            )}\r\n          </div>\r\n\r\n          {timeSyncButton}\r\n\r\n          {hasAbsolute && (\r\n            <button className=\"btn navbar-button navbar-button--tight\" onClick={onMoveForward}>\r\n              <i className=\"fa fa-chevron-right\" />\r\n            </button>\r\n          )}\r\n\r\n          <Tooltip content={ZoomOutTooltip} placement=\"bottom\">\r\n            <button className=\"btn navbar-button navbar-button--zoom\" onClick={onZoom}>\r\n              <i className=\"fa fa-search-minus\" />\r\n            </button>\r\n          </Tooltip>\r\n        </div>\r\n      </div>\r\n    );\r\n  }\r\n}\r\n\r\nconst ZoomOutTooltip = () => (\r\n  <>\r\n    Time range zoom out <br /> CTRL+Z\r\n  </>\r\n);\r\n\r\nconst TimePickerTooltip = ({ timeRange }: { timeRange: TimeRange }) => (\r\n  <>\r\n    {timeRange.from.format(TIME_FORMAT)}\r\n    <div className=\"text-center\">to</div>\r\n    {timeRange.to.format(TIME_FORMAT)}\r\n  </>\r\n);\r\n\r\nconst TimePickerButtonLabel = memo<Props>(props => {\r\n  const theme = useTheme();\r\n  const styles = getLabelStyles(theme);\r\n  const isUTC = props.timeZone === 'utc';\r\n\r\n  if (props.hideText) {\r\n    return null;\r\n  }\r\n\r\n  return (\r\n    <span className={styles.container}>\r\n      <span>{formattedRange(props.value, isUTC)}</span>\r\n      {isUTC && <span className={styles.utc}>UTC</span>}\r\n    </span>\r\n  );\r\n});\r\n\r\nconst formattedRange = (value: TimeRange, isUTC: boolean) => {\r\n  const adjustedTimeRange = {\r\n    to: dateMath.isMathString(value.raw.to) ? value.raw.to : adjustedTime(value.to, isUTC),\r\n    from: dateMath.isMathString(value.raw.from) ? value.raw.from : adjustedTime(value.from, isUTC),\r\n  };\r\n  return rangeUtil.describeTimeRange(adjustedTimeRange);\r\n};\r\n\r\nconst adjustedTime = (time: DateTime, isUTC: boolean) => {\r\n  if (isUTC) {\r\n    return time.utc() || null;\r\n  }\r\n  return time.local() || null;\r\n};\r\n\r\nexport const TimePicker = withTheme(UnthemedTimePicker);\r\n","import React, { memo } from 'react';\r\nimport { css, cx } from 'emotion';\r\nimport Calendar from 'react-calendar/dist/entry.nostyle';\r\nimport { GrafanaTheme, dateTime, TIME_FORMAT } from '@grafana/data';\r\nimport { stringToDateTimeType } from '../time';\r\nimport { useTheme, stylesFactory } from '../../../themes';\r\nimport { TimePickerTitle } from './TimePickerTitle';\r\nimport Forms from '../../Forms';\r\nimport { Portal } from '../../Portal/Portal';\r\nimport { getThemeColors } from './colors';\r\nimport { ClickOutsideWrapper } from '../../ClickOutsideWrapper/ClickOutsideWrapper';\r\n\r\nconst getStyles = stylesFactory((theme: GrafanaTheme) => {\r\n  const colors = getThemeColors(theme);\r\n\r\n  return {\r\n    container: css`\r\n      top: 0;\r\n      position: absolute;\r\n      right: 546px;\r\n      box-shadow: 0px 0px 20px ${colors.shadow};\r\n      background-color: ${colors.background};\r\n      z-index: -1;\r\n\r\n      &:after {\r\n        display: block;\r\n        background-color: ${colors.background};\r\n        width: 19px;\r\n        height: 381px;\r\n        content: ' ';\r\n        position: absolute;\r\n        top: 0;\r\n        right: -19px;\r\n        border-left: 1px solid ${colors.border};\r\n      }\r\n    `,\r\n    modal: css`\r\n      position: fixed;\r\n      top: 20%;\r\n      width: 100%;\r\n      z-index: ${theme.zIndex.modal};\r\n    `,\r\n    content: css`\r\n      margin: 0 auto;\r\n      width: 268px;\r\n    `,\r\n    backdrop: css`\r\n      position: fixed;\r\n      top: 0;\r\n      right: 0;\r\n      bottom: 0;\r\n      left: 0;\r\n      background: #202226;\r\n      opacity: 0.7;\r\n      z-index: ${theme.zIndex.modalBackdrop};\r\n      text-align: center;\r\n    `,\r\n  };\r\n});\r\n\r\nconst getFooterStyles = stylesFactory((theme: GrafanaTheme) => {\r\n  const colors = getThemeColors(theme);\r\n\r\n  return {\r\n    container: css`\r\n      background-color: ${colors.background};\r\n      display: flex;\r\n      justify-content: center;\r\n      padding: 10px;\r\n      align-items: stretch;\r\n    `,\r\n    apply: css`\r\n      margin-right: 4px;\r\n      width: 100%;\r\n      justify-content: center;\r\n    `,\r\n  };\r\n});\r\n\r\nconst getBodyStyles = stylesFactory((theme: GrafanaTheme) => {\r\n  const colors = getThemeColors(theme);\r\n\r\n  return {\r\n    title: css`\r\n      color: ${theme.colors.text}\r\n      background-color: ${colors.background};\r\n      line-height: 21px;\r\n      font-size: ${theme.typography.size.md};\r\n      border: 1px solid transparent;\r\n\r\n      &:hover {\r\n        position: relative;\r\n      }\r\n    `,\r\n    body: css`\r\n      z-index: ${theme.zIndex.modal};\r\n      background-color: ${colors.background};\r\n      width: 268px;\r\n\r\n      .react-calendar__navigation__label,\r\n      .react-calendar__navigation__arrow,\r\n      .react-calendar__navigation {\r\n        padding-top: 4px;\r\n        background-color: inherit;\r\n        color: ${theme.colors.text};\r\n        border: 0;\r\n        font-weight: ${theme.typography.weight.semibold};\r\n      }\r\n\r\n      .react-calendar__month-view__weekdays {\r\n        background-color: inherit;\r\n        text-align: center;\r\n        color: ${theme.colors.blueShade};\r\n\r\n        abbr {\r\n          border: 0;\r\n          text-decoration: none;\r\n          cursor: default;\r\n          display: block;\r\n          padding: 4px 0 4px 0;\r\n        }\r\n      }\r\n\r\n      .react-calendar__month-view__days {\r\n        background-color: inherit;\r\n      }\r\n\r\n      .react-calendar__tile,\r\n      .react-calendar__tile--now {\r\n        margin-bottom: 4px;\r\n        background-color: inherit;\r\n      }\r\n\r\n      .react-calendar__navigation__label,\r\n      .react-calendar__navigation > button:focus,\r\n      .time-picker-calendar-tile:focus {\r\n        outline: 0;\r\n      }\r\n\r\n      .react-calendar__tile--active,\r\n      .react-calendar__tile--active:hover {\r\n        color: ${theme.colors.white};\r\n        font-weight: ${theme.typography.weight.semibold};\r\n        background: ${theme.colors.blue95};\r\n        box-shadow: none;\r\n        border: 0px;\r\n      }\r\n\r\n      .react-calendar__tile--rangeEnd,\r\n      .react-calendar__tile--rangeStart {\r\n        padding: 0;\r\n        border: 0px;\r\n        color: ${theme.colors.white};\r\n        font-weight: ${theme.typography.weight.semibold};\r\n        background: ${theme.colors.blue95};\r\n\r\n        abbr {\r\n          background-color: ${theme.colors.blue77};\r\n          border-radius: 100px;\r\n          display: block;\r\n          padding: 2px 7px 3px;\r\n        }\r\n      }\r\n\r\n      .react-calendar__tile--rangeStart {\r\n        border-top-left-radius: 20px;\r\n        border-bottom-left-radius: 20px;\r\n      }\r\n\r\n      .react-calendar__tile--rangeEnd {\r\n        border-top-right-radius: 20px;\r\n        border-bottom-right-radius: 20px;\r\n      }\r\n    `,\r\n  };\r\n});\r\n\r\nconst getHeaderStyles = stylesFactory((theme: GrafanaTheme) => {\r\n  const colors = getThemeColors(theme);\r\n\r\n  return {\r\n    container: css`\r\n      background-color: ${colors.background};\r\n      display: flex;\r\n      justify-content: space-between;\r\n      padding: 7px;\r\n    `,\r\n    close: css`\r\n      cursor: pointer;\r\n      font-size: ${theme.typography.size.lg};\r\n    `,\r\n  };\r\n});\r\n\r\ninterface Props {\r\n  isOpen: boolean;\r\n  from: string;\r\n  to: string;\r\n  onClose: () => void;\r\n  onApply: () => void;\r\n  onChange: (from: string, to: string) => void;\r\n  isFullscreen: boolean;\r\n}\r\n\r\nexport const TimePickerCalendar = memo<Props>(props => {\r\n  const theme = useTheme();\r\n  const styles = getStyles(theme);\r\n  const { isOpen, isFullscreen } = props;\r\n\r\n  if (!isOpen) {\r\n    return null;\r\n  }\r\n\r\n  if (isFullscreen) {\r\n    return (\r\n      <ClickOutsideWrapper onClick={props.onClose}>\r\n        <div className={styles.container}>\r\n          <Body {...props} />\r\n        </div>\r\n      </ClickOutsideWrapper>\r\n    );\r\n  }\r\n\r\n  return (\r\n    <Portal>\r\n      <div className={styles.modal} onClick={event => event.stopPropagation()}>\r\n        <div className={styles.content}>\r\n          <Header {...props} />\r\n          <Body {...props} />\r\n          <Footer {...props} />\r\n        </div>\r\n      </div>\r\n      <div className={styles.backdrop} onClick={event => event.stopPropagation()} />\r\n    </Portal>\r\n  );\r\n});\r\n\r\nconst Header = memo<Props>(({ onClose }) => {\r\n  const theme = useTheme();\r\n  const styles = getHeaderStyles(theme);\r\n\r\n  return (\r\n    <div className={styles.container}>\r\n      <TimePickerTitle>Select a time range</TimePickerTitle>\r\n      <i className={cx(styles.close, 'fa', 'fa-times')} onClick={onClose} />\r\n    </div>\r\n  );\r\n});\r\n\r\nconst Body = memo<Props>(props => {\r\n  const theme = useTheme();\r\n  const styles = getBodyStyles(theme);\r\n  const { from, to, onChange } = props;\r\n\r\n  return (\r\n    <Calendar\r\n      selectRange={true}\r\n      next2Label={null}\r\n      prev2Label={null}\r\n      className={styles.body}\r\n      tileClassName={styles.title}\r\n      value={inputToValue(from, to)}\r\n      nextLabel={<span className=\"fa fa-angle-right\" />}\r\n      prevLabel={<span className=\"fa fa-angle-left\" />}\r\n      onChange={value => valueToInput(value, onChange)}\r\n      locale=\"en\"\r\n    />\r\n  );\r\n});\r\n\r\nconst Footer = memo<Props>(({ onClose, onApply }) => {\r\n  const theme = useTheme();\r\n  const styles = getFooterStyles(theme);\r\n\r\n  return (\r\n    <div className={styles.container}>\r\n      <Forms.Button className={styles.apply} onClick={onApply}>\r\n        Apply time range\r\n      </Forms.Button>\r\n      <Forms.Button variant=\"secondary\" onClick={onClose}>\r\n        Cancel\r\n      </Forms.Button>\r\n    </div>\r\n  );\r\n});\r\n\r\nfunction inputToValue(from: string, to: string): Date[] {\r\n  const fromAsDateTime = stringToDateTimeType(from);\r\n  const toAsDateTime = stringToDateTimeType(to);\r\n  const fromAsDate = fromAsDateTime.isValid() ? fromAsDateTime.toDate() : new Date();\r\n  const toAsDate = toAsDateTime.isValid() ? toAsDateTime.toDate() : new Date();\r\n\r\n  if (fromAsDate > toAsDate) {\r\n    return [toAsDate, fromAsDate];\r\n  }\r\n  return [fromAsDate, toAsDate];\r\n}\r\n\r\nfunction valueToInput(value: Date | Date[], onChange: (from: string, to: string) => void): void {\r\n  const [from, to] = value;\r\n  const fromAsString = dateTime(from).format(TIME_FORMAT);\r\n  const toAsString = dateTime(to).format(TIME_FORMAT);\r\n\r\n  return onChange(fromAsString, toAsString);\r\n}\r\n","import React, { useState, memo } from 'react';\r\nimport { useMedia } from 'react-use';\r\nimport { css } from 'emotion';\r\nimport { useTheme, stylesFactory } from '../../../themes';\r\nimport { GrafanaTheme, TimeOption, TimeRange, TimeZone, isDateTime } from '@grafana/data';\r\nimport { TimePickerTitle } from './TimePickerTitle';\r\nimport { TimeRangeForm } from './TimeRangeForm';\r\nimport { CustomScrollbar } from '../../CustomScrollbar/CustomScrollbar';\r\nimport { TimeRangeList } from './TimeRangeList';\r\nimport { mapRangeToTimeOption } from './mapper';\r\nimport { getThemeColors } from './colors';\r\n\r\nconst getStyles = stylesFactory((theme: GrafanaTheme) => {\r\n  const colors = getThemeColors(theme);\r\n\r\n  return {\r\n    container: css`\r\n      display: flex;\r\n      background: ${colors.background};\r\n      box-shadow: 0px 0px 20px ${colors.shadow};\r\n      position: absolute;\r\n      z-index: ${theme.zIndex.modal};\r\n      width: 546px;\r\n      height: 381px;\r\n      top: 116%;\r\n      margin-left: -322px;\r\n\r\n      @media only screen and (max-width: ${theme.breakpoints.lg}) {\r\n        width: 218px;\r\n        margin-left: 6px;\r\n      }\r\n\r\n      @media only screen and (max-width: ${theme.breakpoints.sm}) {\r\n        width: 264px;\r\n        margin-left: -100px;\r\n      }\r\n    `,\r\n    leftSide: css`\r\n      display: flex;\r\n      flex-direction: column;\r\n      border-right: 1px solid ${colors.border};\r\n      width: 60%;\r\n      overflow: hidden;\r\n\r\n      @media only screen and (max-width: ${theme.breakpoints.lg}) {\r\n        display: none;\r\n      }\r\n    `,\r\n    rightSide: css`\r\n      width: 40% !important;\r\n\r\n      @media only screen and (max-width: ${theme.breakpoints.lg}) {\r\n        width: 100% !important;\r\n      }\r\n    `,\r\n    spacing: css`\r\n      margin-top: 16px;\r\n    `,\r\n  };\r\n});\r\n\r\nconst getNarrowScreenStyles = stylesFactory((theme: GrafanaTheme) => {\r\n  const colors = getThemeColors(theme);\r\n\r\n  return {\r\n    header: css`\r\n      display: flex;\r\n      flex-direction: row;\r\n      justify-content: space-between;\r\n      align-items: center;\r\n      border-bottom: 1px solid ${colors.border};\r\n      padding: 7px 9px 7px 9px;\r\n    `,\r\n    body: css`\r\n      border-bottom: 1px solid ${colors.border};\r\n      background: ${colors.formBackground};\r\n      box-shadow: inset 0px 2px 2px ${colors.shadow};\r\n    `,\r\n    form: css`\r\n      padding: 7px 9px 7px 9px;\r\n    `,\r\n  };\r\n});\r\n\r\nconst getFullScreenStyles = stylesFactory((theme: GrafanaTheme) => {\r\n  return {\r\n    container: css`\r\n      padding-top: 9px;\r\n      padding-left: 11px;\r\n      padding-right: 20%;\r\n    `,\r\n    title: css`\r\n      margin-bottom: 11px;\r\n    `,\r\n    recent: css`\r\n      flex-grow: 1;\r\n      display: flex;\r\n      flex-direction: column;\r\n      justify-content: flex-end;\r\n    `,\r\n  };\r\n});\r\n\r\nconst getEmptyListStyles = stylesFactory((theme: GrafanaTheme) => {\r\n  const colors = getThemeColors(theme);\r\n\r\n  return {\r\n    container: css`\r\n      background-color: ${colors.formBackground};\r\n      padding: 12px;\r\n      margin: 12px;\r\n\r\n      a,\r\n      span {\r\n        font-size: 13px;\r\n      }\r\n    `,\r\n    link: css`\r\n      color: ${theme.colors.linkExternal};\r\n    `,\r\n  };\r\n});\r\n\r\ninterface Props {\r\n  value: TimeRange;\r\n  onChange: (timeRange: TimeRange) => void;\r\n  timeZone?: TimeZone;\r\n  quickOptions?: TimeOption[];\r\n  otherOptions?: TimeOption[];\r\n  history?: TimeRange[];\r\n}\r\n\r\ninterface PropsWithScreenSize extends Props {\r\n  isFullscreen: boolean;\r\n}\r\n\r\ninterface FormProps extends Omit<Props, 'history'> {\r\n  visible: boolean;\r\n  historyOptions?: TimeOption[];\r\n}\r\n\r\nexport const TimePickerContentWithScreenSize: React.FC<PropsWithScreenSize> = props => {\r\n  const theme = useTheme();\r\n  const styles = getStyles(theme);\r\n  const historyOptions = mapToHistoryOptions(props.history, props.timeZone);\r\n  const { quickOptions = [], otherOptions = [], isFullscreen } = props;\r\n\r\n  return (\r\n    <div className={styles.container}>\r\n      <div className={styles.leftSide}>\r\n        <FullScreenForm {...props} visible={isFullscreen} historyOptions={historyOptions} />\r\n      </div>\r\n      <CustomScrollbar className={styles.rightSide}>\r\n        <NarrowScreenForm {...props} visible={!isFullscreen} historyOptions={historyOptions} />\r\n        <TimeRangeList\r\n          title=\"Relative time ranges\"\r\n          options={quickOptions}\r\n          onSelect={props.onChange}\r\n          value={props.value}\r\n          timeZone={props.timeZone}\r\n        />\r\n        <div className={styles.spacing} />\r\n        <TimeRangeList\r\n          title=\"Other quick ranges\"\r\n          options={otherOptions}\r\n          onSelect={props.onChange}\r\n          value={props.value}\r\n          timeZone={props.timeZone}\r\n        />\r\n      </CustomScrollbar>\r\n    </div>\r\n  );\r\n};\r\n\r\nexport const TimePickerContent: React.FC<Props> = props => {\r\n  const theme = useTheme();\r\n  const isFullscreen = useMedia(`(min-width: ${theme.breakpoints.lg})`);\r\n\r\n  return <TimePickerContentWithScreenSize {...props} isFullscreen={isFullscreen} />;\r\n};\r\n\r\nconst NarrowScreenForm: React.FC<FormProps> = props => {\r\n  if (!props.visible) {\r\n    return null;\r\n  }\r\n\r\n  const theme = useTheme();\r\n  const styles = getNarrowScreenStyles(theme);\r\n  const isAbsolute = isDateTime(props.value.raw.from) || isDateTime(props.value.raw.to);\r\n  const [collapsed, setCollapsed] = useState(isAbsolute);\r\n\r\n  return (\r\n    <>\r\n      <div className={styles.header} onClick={() => setCollapsed(!collapsed)}>\r\n        <TimePickerTitle>Absolute time range</TimePickerTitle>\r\n        {collapsed ? <i className=\"fa fa-caret-up\" /> : <i className=\"fa fa-caret-down\" />}\r\n      </div>\r\n      {collapsed && (\r\n        <div className={styles.body}>\r\n          <div className={styles.form}>\r\n            <TimeRangeForm\r\n              value={props.value}\r\n              onApply={props.onChange}\r\n              timeZone={props.timeZone}\r\n              isFullscreen={false}\r\n            />\r\n          </div>\r\n          <TimeRangeList\r\n            title=\"Recently used absolute ranges\"\r\n            options={props.historyOptions || []}\r\n            onSelect={props.onChange}\r\n            value={props.value}\r\n            placeholderEmpty={null}\r\n            timeZone={props.timeZone}\r\n          />\r\n        </div>\r\n      )}\r\n    </>\r\n  );\r\n};\r\n\r\nconst FullScreenForm: React.FC<FormProps> = props => {\r\n  if (!props.visible) {\r\n    return null;\r\n  }\r\n\r\n  const theme = useTheme();\r\n  const styles = getFullScreenStyles(theme);\r\n\r\n  return (\r\n    <>\r\n      <div className={styles.container}>\r\n        <div className={styles.title}>\r\n          <TimePickerTitle>Absolute time range</TimePickerTitle>\r\n        </div>\r\n        <TimeRangeForm value={props.value} timeZone={props.timeZone} onApply={props.onChange} isFullscreen={true} />\r\n      </div>\r\n      <div className={styles.recent}>\r\n        <TimeRangeList\r\n          title=\"Recently used absolute ranges\"\r\n          options={props.historyOptions || []}\r\n          onSelect={props.onChange}\r\n          value={props.value}\r\n          placeholderEmpty={<EmptyRecentList />}\r\n          timeZone={props.timeZone}\r\n        />\r\n      </div>\r\n    </>\r\n  );\r\n};\r\n\r\nconst EmptyRecentList = memo(() => {\r\n  const theme = useTheme();\r\n  const styles = getEmptyListStyles(theme);\r\n\r\n  return (\r\n    <div className={styles.container}>\r\n      <div>\r\n        <span>\r\n          It looks like you haven't used this timer picker before. As soon as you enter some time intervals, recently\r\n          used intervals will appear here.\r\n        </span>\r\n      </div>\r\n      <div>\r\n        <a className={styles.link} href=\"https://grafana.com/docs/grafana/latest/reference/timerange/\" target=\"_new\">\r\n          Read the documentation\r\n        </a>\r\n        <span> to find out more about how to enter custom time ranges.</span>\r\n      </div>\r\n    </div>\r\n  );\r\n});\r\n\r\nfunction mapToHistoryOptions(ranges?: TimeRange[], timeZone?: TimeZone): TimeOption[] {\r\n  if (!Array.isArray(ranges) || ranges.length === 0) {\r\n    return [];\r\n  }\r\n  return ranges.slice(ranges.length - 4).map(range => mapRangeToTimeOption(range, timeZone));\r\n}\r\n","import React, { memo, PropsWithChildren } from 'react';\r\nimport { css } from 'emotion';\r\nimport { GrafanaTheme } from '@grafana/data';\r\nimport { useTheme, stylesFactory } from '../../../themes';\r\n\r\nconst getStyle = stylesFactory((theme: GrafanaTheme) => {\r\n  return {\r\n    text: css`\r\n      font-size: ${theme.typography.size.md};\r\n      font-weight: ${theme.typography.weight.semibold};\r\n      color: ${theme.colors.formLabel};\r\n    `,\r\n  };\r\n});\r\n\r\nexport const TimePickerTitle = memo<PropsWithChildren<{}>>(({ children }) => {\r\n  const theme = useTheme();\r\n  const styles = getStyle(theme);\r\n\r\n  return <span className={styles.text}>{children}</span>;\r\n});\r\n","import React, { FormEvent, useState, useCallback } from 'react';\r\nimport { TIME_FORMAT, TimeZone, isDateTime, TimeRange, DateTime, dateMath } from '@grafana/data';\r\nimport { stringToDateTimeType, isValidTimeString } from '../time';\r\nimport { mapStringsToTimeRange } from './mapper';\r\nimport { TimePickerCalendar } from './TimePickerCalendar';\r\nimport Forms from '../../Forms';\r\n\r\ninterface Props {\r\n  isFullscreen: boolean;\r\n  value: TimeRange;\r\n  onApply: (range: TimeRange) => void;\r\n  timeZone?: TimeZone;\r\n  roundup?: boolean;\r\n}\r\n\r\ninterface InputState {\r\n  value: string;\r\n  invalid: boolean;\r\n}\r\n\r\nconst errorMessage = 'Please enter a past date or \"now\"';\r\n\r\nexport const TimeRangeForm: React.FC<Props> = props => {\r\n  const { value, isFullscreen = false, timeZone, roundup } = props;\r\n\r\n  const [from, setFrom] = useState<InputState>(valueToState(value.raw.from, false, timeZone));\r\n  const [to, setTo] = useState<InputState>(valueToState(value.raw.to, true, timeZone));\r\n  const [isOpen, setOpen] = useState(false);\r\n\r\n  const onOpen = useCallback(\r\n    (event: FormEvent<HTMLElement>) => {\r\n      event.preventDefault();\r\n      setOpen(true);\r\n    },\r\n    [setOpen]\r\n  );\r\n\r\n  const onFocus = useCallback(\r\n    (event: FormEvent<HTMLElement>) => {\r\n      if (!isFullscreen) {\r\n        return;\r\n      }\r\n      onOpen(event);\r\n    },\r\n    [isFullscreen, onOpen]\r\n  );\r\n\r\n  const onApply = useCallback(() => {\r\n    if (to.invalid || from.invalid) {\r\n      return;\r\n    }\r\n    props.onApply(mapStringsToTimeRange(from.value, to.value, roundup, timeZone));\r\n  }, [from, to, roundup, timeZone]);\r\n\r\n  const onChange = useCallback(\r\n    (from: string, to: string) => {\r\n      setFrom(valueToState(from, false, timeZone));\r\n      setTo(valueToState(to, true, timeZone));\r\n    },\r\n    [timeZone]\r\n  );\r\n\r\n  const icon = isFullscreen ? null : <Forms.Button icon=\"fa fa-calendar\" variant=\"secondary\" onClick={onOpen} />;\r\n\r\n  return (\r\n    <>\r\n      <Forms.Field label=\"From\" invalid={from.invalid} error={errorMessage}>\r\n        <Forms.Input\r\n          onClick={event => event.stopPropagation()}\r\n          onFocus={onFocus}\r\n          onChange={event => setFrom(eventToState(event, false, timeZone))}\r\n          addonAfter={icon}\r\n          value={from.value}\r\n        />\r\n      </Forms.Field>\r\n      <Forms.Field label=\"To\" invalid={to.invalid} error={errorMessage}>\r\n        <Forms.Input\r\n          onClick={event => event.stopPropagation()}\r\n          onFocus={onFocus}\r\n          onChange={event => setTo(eventToState(event, true, timeZone))}\r\n          addonAfter={icon}\r\n          value={to.value}\r\n        />\r\n      </Forms.Field>\r\n      <Forms.Button onClick={onApply}>Apply time range</Forms.Button>\r\n\r\n      <TimePickerCalendar\r\n        isFullscreen={isFullscreen}\r\n        isOpen={isOpen}\r\n        from={from.value}\r\n        to={to.value}\r\n        onApply={onApply}\r\n        onClose={() => setOpen(false)}\r\n        onChange={onChange}\r\n      />\r\n    </>\r\n  );\r\n};\r\n\r\nfunction eventToState(event: FormEvent<HTMLInputElement>, roundup?: boolean, timeZone?: TimeZone): InputState {\r\n  return valueToState(event.currentTarget.value, roundup, timeZone);\r\n}\r\n\r\nfunction valueToState(raw: DateTime | string, roundup?: boolean, timeZone?: TimeZone): InputState {\r\n  const value = valueAsString(raw);\r\n  const invalid = !isValid(value, roundup, timeZone);\r\n  return { value, invalid };\r\n}\r\n\r\nfunction valueAsString(value: DateTime | string): string {\r\n  if (isDateTime(value)) {\r\n    return value.format(TIME_FORMAT);\r\n  }\r\n  return value;\r\n}\r\n\r\nfunction isValid(value: string, roundup?: boolean, timeZone?: TimeZone): boolean {\r\n  if (dateMath.isMathString(value)) {\r\n    return isValidTimeString(value);\r\n  }\r\n\r\n  const parsed = stringToDateTimeType(value, roundup, timeZone);\r\n  return parsed.isValid();\r\n}\r\n","import React, { ReactNode } from 'react';\r\nimport { css } from 'emotion';\r\nimport { TimeOption, TimeZone } from '@grafana/data';\r\nimport { TimeRange } from '@grafana/data';\r\nimport { TimePickerTitle } from './TimePickerTitle';\r\nimport { TimeRangeOption } from './TimeRangeOption';\r\nimport { mapOptionToTimeRange } from './mapper';\r\nimport { stylesFactory } from '../../../themes';\r\n\r\nconst getStyles = stylesFactory(() => {\r\n  return {\r\n    title: css`\r\n      display: flex;\r\n      align-items: center;\r\n      justify-content: space-between;\r\n      padding: 8px 16px 5px 9px;\r\n    `,\r\n  };\r\n});\r\n\r\nconst getOptionsStyles = stylesFactory(() => {\r\n  return {\r\n    grow: css`\r\n      flex-grow: 1;\r\n      align-items: flex-start;\r\n    `,\r\n  };\r\n});\r\n\r\ninterface Props {\r\n  title?: string;\r\n  options: TimeOption[];\r\n  value?: TimeRange;\r\n  onSelect: (option: TimeRange) => void;\r\n  placeholderEmpty?: ReactNode;\r\n  timeZone?: TimeZone;\r\n}\r\n\r\nexport const TimeRangeList: React.FC<Props> = props => {\r\n  const styles = getStyles();\r\n  const { title, options, placeholderEmpty } = props;\r\n\r\n  if (typeof placeholderEmpty !== 'undefined' && options.length <= 0) {\r\n    return <>{placeholderEmpty}</>;\r\n  }\r\n\r\n  if (!title) {\r\n    return <Options {...props} />;\r\n  }\r\n\r\n  return (\r\n    <>\r\n      <div className={styles.title}>\r\n        <TimePickerTitle>{title}</TimePickerTitle>\r\n      </div>\r\n      <Options {...props} />\r\n    </>\r\n  );\r\n};\r\n\r\nconst Options: React.FC<Props> = ({ options, value, onSelect, timeZone }) => {\r\n  const styles = getOptionsStyles();\r\n\r\n  return (\r\n    <>\r\n      <div>\r\n        {options.map((option, index) => (\r\n          <TimeRangeOption\r\n            key={keyForOption(option, index)}\r\n            value={option}\r\n            selected={isEqual(option, value)}\r\n            onSelect={option => onSelect(mapOptionToTimeRange(option, timeZone))}\r\n          />\r\n        ))}\r\n      </div>\r\n      <div className={styles.grow}></div>\r\n    </>\r\n  );\r\n};\r\n\r\nfunction keyForOption(option: TimeOption, index: number): string {\r\n  return `${option.from}-${option.to}-${index}`;\r\n}\r\n\r\nfunction isEqual(x: TimeOption, y?: TimeRange): boolean {\r\n  if (!y || !x) {\r\n    return false;\r\n  }\r\n  return y.raw.from === x.from && y.raw.to === x.to;\r\n}\r\n","import React, { memo } from 'react';\r\nimport { css } from 'emotion';\r\nimport { GrafanaTheme, TimeOption } from '@grafana/data';\r\nimport { useTheme, stylesFactory, selectThemeVariant } from '../../../themes';\r\n\r\nconst getStyles = stylesFactory((theme: GrafanaTheme) => {\r\n  const background = selectThemeVariant(\r\n    {\r\n      light: theme.colors.gray7,\r\n      dark: theme.colors.dark3,\r\n    },\r\n    theme.type\r\n  );\r\n\r\n  return {\r\n    container: css`\r\n      display: flex;\r\n      align-items: center;\r\n      justify-content: space-between;\r\n      padding: 7px 9px 7px 9px;\r\n      border-left: 2px solid rgba(255, 255, 255, 0);\r\n\r\n      &:hover {\r\n        background: ${background};\r\n        border-image: linear-gradient(#f05a28 30%, #fbca0a 99%);\r\n        border-image-slice: 1;\r\n        border-style: solid;\r\n        border-top: 0;\r\n        border-right: 0;\r\n        border-bottom: 0;\r\n        border-left-width: 2px;\r\n        cursor: pointer;\r\n      }\r\n    `,\r\n  };\r\n});\r\n\r\ninterface Props {\r\n  value: TimeOption;\r\n  selected?: boolean;\r\n  onSelect: (option: TimeOption) => void;\r\n}\r\n\r\nexport const TimeRangeOption = memo<Props>(({ value, onSelect, selected = false }) => {\r\n  const theme = useTheme();\r\n  const styles = getStyles(theme);\r\n\r\n  return (\r\n    <div className={styles.container} onClick={() => onSelect(value)} tabIndex={-1}>\r\n      <span>{value.display}</span>\r\n      {selected ? <i className=\"fa fa-check\" /> : null}\r\n    </div>\r\n  );\r\n});\r\n","import { GrafanaTheme } from '@grafana/data';\r\nimport { selectThemeVariant } from '../../../themes/selectThemeVariant';\r\n\r\nexport const getThemeColors = (theme: GrafanaTheme) => {\r\n  return {\r\n    border: selectThemeVariant(\r\n      {\r\n        light: theme.colors.gray4,\r\n        dark: theme.colors.gray25,\r\n      },\r\n      theme.type\r\n    ),\r\n    background: selectThemeVariant(\r\n      {\r\n        dark: theme.colors.dark2,\r\n        light: theme.background.dropdown,\r\n      },\r\n      theme.type\r\n    ),\r\n    shadow: selectThemeVariant(\r\n      {\r\n        light: theme.colors.gray85,\r\n        dark: theme.colors.black,\r\n      },\r\n      theme.type\r\n    ),\r\n    formBackground: selectThemeVariant(\r\n      {\r\n        dark: theme.colors.gray15,\r\n        light: theme.colors.gray98,\r\n      },\r\n      theme.type\r\n    ),\r\n  };\r\n};\r\n","import {\r\n  TimeOption,\r\n  TimeRange,\r\n  isDateTime,\r\n  DateTime,\r\n  TimeZone,\r\n  dateMath,\r\n  dateTime,\r\n  dateTimeForTimeZone,\r\n  TIME_FORMAT,\r\n} from '@grafana/data';\r\nimport { stringToDateTimeType } from '../time';\r\n\r\nexport const mapOptionToTimeRange = (option: TimeOption, timeZone?: TimeZone): TimeRange => {\r\n  return {\r\n    from: stringToDateTime(option.from, false, timeZone),\r\n    to: stringToDateTime(option.to, true, timeZone),\r\n    raw: {\r\n      from: option.from,\r\n      to: option.to,\r\n    },\r\n  };\r\n};\r\n\r\nexport const mapRangeToTimeOption = (range: TimeRange, timeZone?: TimeZone): TimeOption => {\r\n  const formattedFrom = stringToDateTime(range.from, false, timeZone).format(TIME_FORMAT);\r\n  const formattedTo = stringToDateTime(range.to, true, timeZone).format(TIME_FORMAT);\r\n  const from = dateTimeToString(range.from, timeZone);\r\n  const to = dateTimeToString(range.to, timeZone);\r\n\r\n  return {\r\n    from,\r\n    to,\r\n    section: 3,\r\n    display: `${formattedFrom} to ${formattedTo}`,\r\n  };\r\n};\r\n\r\nexport const mapStringsToTimeRange = (from: string, to: string, roundup?: boolean, timeZone?: TimeZone): TimeRange => {\r\n  const fromDate = stringToDateTimeType(from, roundup, timeZone);\r\n  const toDate = stringToDateTimeType(to, roundup, timeZone);\r\n\r\n  if (dateMath.isMathString(from) || dateMath.isMathString(to)) {\r\n    return {\r\n      from: fromDate,\r\n      to: toDate,\r\n      raw: {\r\n        from,\r\n        to,\r\n      },\r\n    };\r\n  }\r\n\r\n  return {\r\n    from: fromDate,\r\n    to: toDate,\r\n    raw: {\r\n      from: fromDate,\r\n      to: toDate,\r\n    },\r\n  };\r\n};\r\n\r\nconst stringToDateTime = (value: string | DateTime, roundUp?: boolean, timeZone?: TimeZone): DateTime => {\r\n  if (isDateTime(value)) {\r\n    if (timeZone === 'utc') {\r\n      return value.utc();\r\n    }\r\n    return value;\r\n  }\r\n\r\n  if (value.indexOf('now') !== -1) {\r\n    if (!dateMath.isValid(value)) {\r\n      return dateTime();\r\n    }\r\n\r\n    const parsed = dateMath.parse(value, roundUp, timeZone);\r\n    return parsed || dateTime();\r\n  }\r\n\r\n  return dateTimeForTimeZone(timeZone, value, TIME_FORMAT);\r\n};\r\n\r\nconst dateTimeToString = (value: DateTime, timeZone?: TimeZone): string => {\r\n  if (!isDateTime(value)) {\r\n    return value;\r\n  }\r\n\r\n  const isUtc = timeZone === 'utc';\r\n  if (isUtc) {\r\n    return value.utc().format(TIME_FORMAT);\r\n  }\r\n\r\n  return value.format(TIME_FORMAT);\r\n};\r\n","import {\r\n  TimeRange,\r\n  TIME_FORMAT,\r\n  RawTimeRange,\r\n  TimeZone,\r\n  rangeUtil,\r\n  dateMath,\r\n  isDateTime,\r\n  dateTime,\r\n  DateTime,\r\n  dateTimeForTimeZone,\r\n} from '@grafana/data';\r\n\r\nexport const rawToTimeRange = (raw: RawTimeRange, timeZone?: TimeZone): TimeRange => {\r\n  const from = stringToDateTimeType(raw.from, false, timeZone);\r\n  const to = stringToDateTimeType(raw.to, true, timeZone);\r\n\r\n  return { from, to, raw };\r\n};\r\n\r\nexport const stringToDateTimeType = (value: string | DateTime, roundUp?: boolean, timeZone?: TimeZone): DateTime => {\r\n  if (isDateTime(value)) {\r\n    return value;\r\n  }\r\n\r\n  if (value.indexOf('now') !== -1) {\r\n    if (!dateMath.isValid(value)) {\r\n      return dateTime();\r\n    }\r\n\r\n    const parsed = dateMath.parse(value, roundUp, timeZone);\r\n    return parsed || dateTime();\r\n  }\r\n\r\n  return dateTimeForTimeZone(timeZone, value, TIME_FORMAT);\r\n};\r\n\r\nexport const mapTimeRangeToRangeString = (timeRange: RawTimeRange): string => {\r\n  return rangeUtil.describeTimeRange(timeRange);\r\n};\r\n\r\nexport const isValidTimeString = (text: string) => dateMath.isValid(text);\r\n","import React, { FC, ReactNode, PureComponent } from 'react';\r\nimport { Tooltip } from '../Tooltip/Tooltip';\r\n\r\ninterface ToggleButtonGroupProps {\r\n  label?: string;\r\n  children: JSX.Element[];\r\n  transparent?: boolean;\r\n}\r\n\r\nexport class ToggleButtonGroup extends PureComponent<ToggleButtonGroupProps> {\r\n  render() {\r\n    const { children, label, transparent } = this.props;\r\n\r\n    return (\r\n      <div className=\"gf-form gf-form--align-center\">\r\n        {label && <label className={`gf-form-label ${transparent ? 'gf-form-label--transparent' : ''}`}>{label}</label>}\r\n        <div className={`toggle-button-group ${transparent ? 'toggle-button-group--transparent' : ''}`}>{children}</div>\r\n      </div>\r\n    );\r\n  }\r\n}\r\n\r\ninterface ToggleButtonProps {\r\n  onChange?: (value: any) => void;\r\n  selected?: boolean;\r\n  value: any;\r\n  className?: string;\r\n  children: ReactNode;\r\n  tooltip?: string;\r\n}\r\n\r\nexport const ToggleButton: FC<ToggleButtonProps> = ({\r\n  children,\r\n  selected,\r\n  className = '',\r\n  value = null,\r\n  tooltip,\r\n  onChange,\r\n}) => {\r\n  const onClick = (event: React.SyntheticEvent) => {\r\n    event.stopPropagation();\r\n    if (!selected && onChange) {\r\n      onChange(value);\r\n    }\r\n  };\r\n\r\n  const btnClassName = `btn ${className}${selected ? ' active' : ''}`;\r\n  const button = (\r\n    <button className={btnClassName} onClick={onClick}>\r\n      <span>{children}</span>\r\n    </button>\r\n  );\r\n\r\n  if (tooltip) {\r\n    return (\r\n      <Tooltip content={tooltip} placement=\"bottom\">\r\n        {button}\r\n      </Tooltip>\r\n    );\r\n  } else {\r\n    return button;\r\n  }\r\n};\r\n","import React, { PureComponent } from 'react';\r\nimport * as PopperJS from 'popper.js';\r\nimport { Manager, Popper as ReactPopper, PopperArrowProps } from 'react-popper';\r\nimport { Portal } from '../Portal/Portal';\r\nimport Transition from 'react-transition-group/Transition';\r\nimport { PopoverContent } from './Tooltip';\r\n\r\nconst defaultTransitionStyles = {\r\n  transition: 'opacity 200ms linear',\r\n  opacity: 0,\r\n};\r\n\r\nconst transitionStyles: { [key: string]: object } = {\r\n  exited: { opacity: 0 },\r\n  entering: { opacity: 0 },\r\n  entered: { opacity: 1, transitionDelay: '0s' },\r\n  exiting: { opacity: 0, transitionDelay: '500ms' },\r\n};\r\n\r\nexport type RenderPopperArrowFn = (props: { arrowProps: PopperArrowProps; placement: string }) => JSX.Element;\r\n\r\ninterface Props extends React.HTMLAttributes<HTMLDivElement> {\r\n  show: boolean;\r\n  placement?: PopperJS.Placement;\r\n  content: PopoverContent;\r\n  referenceElement: PopperJS.ReferenceObject;\r\n  wrapperClassName?: string;\r\n  renderArrow?: RenderPopperArrowFn;\r\n  eventsEnabled?: boolean;\r\n}\r\n\r\nclass Popover extends PureComponent<Props> {\r\n  static defaultProps: Partial<Props> = {\r\n    eventsEnabled: true,\r\n  };\r\n\r\n  render() {\r\n    const {\r\n      content,\r\n      show,\r\n      placement,\r\n      onMouseEnter,\r\n      onMouseLeave,\r\n      className,\r\n      wrapperClassName,\r\n      renderArrow,\r\n      referenceElement,\r\n      eventsEnabled,\r\n    } = this.props;\r\n\r\n    return (\r\n      <Manager>\r\n        <Transition in={show} timeout={100} mountOnEnter={true} unmountOnExit={true}>\r\n          {transitionState => {\r\n            return (\r\n              <Portal>\r\n                <ReactPopper\r\n                  placement={placement}\r\n                  referenceElement={referenceElement}\r\n                  eventsEnabled={eventsEnabled}\r\n                  // TODO: move modifiers config to popper controller\r\n                  modifiers={{ preventOverflow: { enabled: true, boundariesElement: 'window' } }}\r\n                >\r\n                  {({ ref, style, placement, arrowProps, scheduleUpdate }) => {\r\n                    return (\r\n                      <div\r\n                        onMouseEnter={onMouseEnter}\r\n                        onMouseLeave={onMouseLeave}\r\n                        ref={ref}\r\n                        style={{\r\n                          ...style,\r\n                          ...defaultTransitionStyles,\r\n                          ...transitionStyles[transitionState],\r\n                        }}\r\n                        data-placement={placement}\r\n                        className={`${wrapperClassName}`}\r\n                      >\r\n                        <div className={className}>\r\n                          {typeof content === 'string' && content}\r\n                          {React.isValidElement(content) && React.cloneElement(content)}\r\n                          {typeof content === 'function' &&\r\n                            content({\r\n                              updatePopperPosition: scheduleUpdate,\r\n                            })}\r\n                          {renderArrow &&\r\n                            renderArrow({\r\n                              arrowProps,\r\n                              placement,\r\n                            })}\r\n                        </div>\r\n                      </div>\r\n                    );\r\n                  }}\r\n                </ReactPopper>\r\n              </Portal>\r\n            );\r\n          }}\r\n        </Transition>\r\n      </Manager>\r\n    );\r\n  }\r\n}\r\n\r\nexport { Popover };\r\n","import React from 'react';\r\nimport * as PopperJS from 'popper.js';\r\nimport { PopoverContent } from './Tooltip';\r\n\r\n// This API allows popovers to update Popper's position when e.g. popover content changes\r\n// updatePopperPosition is delivered to content by react-popper\r\n\r\nexport interface UsingPopperProps {\r\n  show?: boolean;\r\n  placement?: PopperJS.Placement;\r\n  content: PopoverContent;\r\n  children: JSX.Element;\r\n}\r\n\r\ntype PopperControllerRenderProp = (\r\n  showPopper: () => void,\r\n  hidePopper: () => void,\r\n  popperProps: {\r\n    show: boolean;\r\n    placement: PopperJS.Placement;\r\n    content: PopoverContent;\r\n  }\r\n) => JSX.Element;\r\n\r\ninterface Props {\r\n  placement?: PopperJS.Placement;\r\n  content: PopoverContent;\r\n  className?: string;\r\n  children: PopperControllerRenderProp;\r\n  hideAfter?: number;\r\n}\r\n\r\ninterface State {\r\n  placement: PopperJS.Placement;\r\n  show: boolean;\r\n}\r\n\r\nclass PopoverController extends React.Component<Props, State> {\r\n  private hideTimeout: any;\r\n\r\n  constructor(props: Props) {\r\n    super(props);\r\n\r\n    this.state = {\r\n      placement: this.props.placement || 'auto',\r\n      show: false,\r\n    };\r\n  }\r\n\r\n  UNSAFE_componentWillReceiveProps(nextProps: Props) {\r\n    if (nextProps.placement && nextProps.placement !== this.state.placement) {\r\n      this.setState((prevState: State) => {\r\n        return {\r\n          ...prevState,\r\n          placement: nextProps.placement || 'auto',\r\n        };\r\n      });\r\n    }\r\n  }\r\n\r\n  showPopper = () => {\r\n    if (this.hideTimeout) {\r\n      clearTimeout(this.hideTimeout);\r\n    }\r\n\r\n    this.setState(prevState => ({\r\n      ...prevState,\r\n      show: true,\r\n    }));\r\n  };\r\n\r\n  hidePopper = () => {\r\n    if (this.props.hideAfter !== 0) {\r\n      this.hideTimeout = setTimeout(() => {\r\n        this.setState(prevState => ({\r\n          ...prevState,\r\n          show: false,\r\n        }));\r\n      }, this.props.hideAfter);\r\n      return;\r\n    }\r\n    this.setState(prevState => ({\r\n      ...prevState,\r\n      show: false,\r\n    }));\r\n  };\r\n\r\n  render() {\r\n    const { children, content } = this.props;\r\n    const { show, placement } = this.state;\r\n\r\n    return children(this.showPopper, this.hidePopper, {\r\n      show,\r\n      placement,\r\n      content,\r\n    });\r\n  }\r\n}\r\n\r\nexport { PopoverController };\r\n","import React, { createRef } from 'react';\r\nimport * as PopperJS from 'popper.js';\r\nimport { Popover } from './Popover';\r\nimport { PopoverController, UsingPopperProps } from './PopoverController';\r\n\r\nexport interface TooltipProps extends UsingPopperProps {\r\n  theme?: 'info' | 'error';\r\n}\r\n\r\nexport interface PopoverContentProps {\r\n  updatePopperPosition?: () => void;\r\n}\r\n\r\nexport type PopoverContent = string | React.ReactElement<any> | ((props: PopoverContentProps) => JSX.Element);\r\n\r\nexport const Tooltip = ({ children, theme, ...controllerProps }: TooltipProps) => {\r\n  const tooltipTriggerRef = createRef<PopperJS.ReferenceObject>();\r\n  const popperBackgroundClassName = 'popper__background' + (theme ? ' popper__background--' + theme : '');\r\n\r\n  return (\r\n    <PopoverController {...controllerProps}>\r\n      {(showPopper, hidePopper, popperProps) => {\r\n        {\r\n          /* Override internal 'show' state if passed in as prop */\r\n        }\r\n        const payloadProps = {\r\n          ...popperProps,\r\n          show: controllerProps.show !== undefined ? controllerProps.show : popperProps.show,\r\n        };\r\n        return (\r\n          <>\r\n            {tooltipTriggerRef.current && (\r\n              <Popover\r\n                {...payloadProps}\r\n                onMouseEnter={showPopper}\r\n                onMouseLeave={hidePopper}\r\n                referenceElement={tooltipTriggerRef.current}\r\n                wrapperClassName=\"popper\"\r\n                className={popperBackgroundClassName}\r\n                renderArrow={({ arrowProps, placement }) => (\r\n                  <div className=\"popper__arrow\" data-placement={placement} {...arrowProps} />\r\n                )}\r\n              />\r\n            )}\r\n            {React.cloneElement(children, {\r\n              ref: tooltipTriggerRef,\r\n              onMouseEnter: showPopper,\r\n              onMouseLeave: hidePopper,\r\n            })}\r\n          </>\r\n        );\r\n      }}\r\n    </PopoverController>\r\n  );\r\n};\r\n","import React, { useContext } from 'react';\r\nimport { FilterFieldsByNameTransformerOptions, DataTransformerID, transformersRegistry, KeyValue } from '@grafana/data';\r\nimport { TransformerUIProps, TransformerUIRegistyItem } from './types';\r\nimport { ThemeContext } from '../../themes/ThemeContext';\r\nimport { css, cx } from 'emotion';\r\nimport { InlineList } from '../List/InlineList';\r\n\r\ninterface FilterByNameTransformerEditorProps extends TransformerUIProps<FilterFieldsByNameTransformerOptions> {}\r\n\r\ninterface FilterByNameTransformerEditorState {\r\n  include: string;\r\n  options: FieldNameInfo[];\r\n  selected: string[];\r\n}\r\n\r\ninterface FieldNameInfo {\r\n  name: string;\r\n  count: number;\r\n}\r\nexport class FilterByNameTransformerEditor extends React.PureComponent<\r\n  FilterByNameTransformerEditorProps,\r\n  FilterByNameTransformerEditorState\r\n> {\r\n  constructor(props: FilterByNameTransformerEditorProps) {\r\n    super(props);\r\n    this.state = {\r\n      include: props.options.include || '',\r\n      options: [],\r\n      selected: [],\r\n    };\r\n  }\r\n\r\n  componentDidMount() {\r\n    this.initOptions();\r\n  }\r\n\r\n  private initOptions() {\r\n    const { input, options } = this.props;\r\n    const configuredOptions = options.include ? options.include.split('|') : [];\r\n\r\n    const allNames: FieldNameInfo[] = [];\r\n    const byName: KeyValue<FieldNameInfo> = {};\r\n    for (const frame of input) {\r\n      for (const field of frame.fields) {\r\n        let v = byName[field.name];\r\n        if (!v) {\r\n          v = byName[field.name] = {\r\n            name: field.name,\r\n            count: 0,\r\n          };\r\n          allNames.push(v);\r\n        }\r\n        v.count++;\r\n      }\r\n    }\r\n\r\n    if (configuredOptions.length) {\r\n      const options: FieldNameInfo[] = [];\r\n      const selected: FieldNameInfo[] = [];\r\n      for (const v of allNames) {\r\n        if (configuredOptions.includes(v.name)) {\r\n          selected.push(v);\r\n        }\r\n        options.push(v);\r\n      }\r\n\r\n      this.setState({\r\n        options,\r\n        selected: selected.map(s => s.name),\r\n      });\r\n    } else {\r\n      this.setState({ options: allNames, selected: [] });\r\n    }\r\n  }\r\n\r\n  onFieldToggle = (fieldName: string) => {\r\n    const { selected } = this.state;\r\n    if (selected.indexOf(fieldName) > -1) {\r\n      this.onChange(selected.filter(s => s !== fieldName));\r\n    } else {\r\n      this.onChange([...selected, fieldName]);\r\n    }\r\n  };\r\n\r\n  onChange = (selected: string[]) => {\r\n    this.setState({ selected });\r\n    this.props.onChange({\r\n      ...this.props.options,\r\n      include: selected.join('|'),\r\n    });\r\n  };\r\n\r\n  render() {\r\n    const { options, selected } = this.state;\r\n    return (\r\n      <>\r\n        <InlineList\r\n          items={options}\r\n          renderItem={(o, i) => {\r\n            const label = `${o.name}${o.count > 1 ? ' (' + o.count + ')' : ''}`;\r\n            return (\r\n              <span\r\n                className={css`\r\n                  margin-right: ${i === options.length - 1 ? '0' : '10px'};\r\n                `}\r\n              >\r\n                <FilterPill\r\n                  onClick={() => {\r\n                    this.onFieldToggle(o.name);\r\n                  }}\r\n                  label={label}\r\n                  selected={selected.indexOf(o.name) > -1}\r\n                />\r\n              </span>\r\n            );\r\n          }}\r\n        />\r\n      </>\r\n    );\r\n  }\r\n}\r\n\r\ninterface FilterPillProps {\r\n  selected: boolean;\r\n  label: string;\r\n  onClick: React.MouseEventHandler<HTMLElement>;\r\n}\r\nconst FilterPill: React.FC<FilterPillProps> = ({ label, selected, onClick }) => {\r\n  const theme = useContext(ThemeContext);\r\n  return (\r\n    <div\r\n      className={css`\r\n        padding: ${theme.spacing.xxs} ${theme.spacing.sm};\r\n        color: white;\r\n        background: ${selected ? theme.colors.blueLight : theme.colors.blueShade};\r\n        border-radius: 16px;\r\n        display: inline-block;\r\n        cursor: pointer;\r\n      `}\r\n      onClick={onClick}\r\n    >\r\n      {selected && (\r\n        <i\r\n          className={cx(\r\n            'fa fa-check',\r\n            css`\r\n              margin-right: 4px;\r\n            `\r\n          )}\r\n        />\r\n      )}\r\n      {label}\r\n    </div>\r\n  );\r\n};\r\n\r\nexport const filterFieldsByNameTransformRegistryItem: TransformerUIRegistyItem<FilterFieldsByNameTransformerOptions> = {\r\n  id: DataTransformerID.filterFieldsByName,\r\n  component: FilterByNameTransformerEditor,\r\n  transformer: transformersRegistry.get(DataTransformerID.filterFieldsByName),\r\n  name: 'Filter by name',\r\n  description: 'UI for filter by name transformation',\r\n};\r\n","import React, { useContext } from 'react';\r\nimport {\r\n  FilterFramesByRefIdTransformerOptions,\r\n  DataTransformerID,\r\n  transformersRegistry,\r\n  KeyValue,\r\n} from '@grafana/data';\r\nimport { TransformerUIProps, TransformerUIRegistyItem } from './types';\r\nimport { ThemeContext } from '../../themes/ThemeContext';\r\nimport { css, cx } from 'emotion';\r\nimport { InlineList } from '../List/InlineList';\r\n\r\ninterface FilterByRefIdTransformerEditorProps extends TransformerUIProps<FilterFramesByRefIdTransformerOptions> {}\r\n\r\ninterface FilterByRefIdTransformerEditorState {\r\n  include: string;\r\n  options: RefIdInfo[];\r\n  selected: string[];\r\n}\r\n\r\ninterface RefIdInfo {\r\n  refId: string;\r\n  count: number;\r\n}\r\nexport class FilterByRefIdTransformerEditor extends React.PureComponent<\r\n  FilterByRefIdTransformerEditorProps,\r\n  FilterByRefIdTransformerEditorState\r\n> {\r\n  constructor(props: FilterByRefIdTransformerEditorProps) {\r\n    super(props);\r\n    this.state = {\r\n      include: props.options.include || '',\r\n      options: [],\r\n      selected: [],\r\n    };\r\n  }\r\n\r\n  componentDidMount() {\r\n    this.initOptions();\r\n  }\r\n\r\n  private initOptions() {\r\n    const { input, options } = this.props;\r\n    const configuredOptions = options.include ? options.include.split('|') : [];\r\n\r\n    const allNames: RefIdInfo[] = [];\r\n    const byName: KeyValue<RefIdInfo> = {};\r\n    for (const frame of input) {\r\n      if (frame.refId) {\r\n        let v = byName[frame.refId];\r\n        if (!v) {\r\n          v = byName[frame.refId] = {\r\n            refId: frame.refId,\r\n            count: 0,\r\n          };\r\n          allNames.push(v);\r\n        }\r\n        v.count++;\r\n      }\r\n    }\r\n\r\n    if (configuredOptions.length) {\r\n      const options: RefIdInfo[] = [];\r\n      const selected: RefIdInfo[] = [];\r\n      for (const v of allNames) {\r\n        if (configuredOptions.includes(v.refId)) {\r\n          selected.push(v);\r\n        }\r\n        options.push(v);\r\n      }\r\n\r\n      this.setState({\r\n        options,\r\n        selected: selected.map(s => s.refId),\r\n      });\r\n    } else {\r\n      this.setState({ options: allNames, selected: [] });\r\n    }\r\n  }\r\n\r\n  onFieldToggle = (fieldName: string) => {\r\n    const { selected } = this.state;\r\n    if (selected.indexOf(fieldName) > -1) {\r\n      this.onChange(selected.filter(s => s !== fieldName));\r\n    } else {\r\n      this.onChange([...selected, fieldName]);\r\n    }\r\n  };\r\n\r\n  onChange = (selected: string[]) => {\r\n    this.setState({ selected });\r\n    this.props.onChange({\r\n      ...this.props.options,\r\n      include: selected.join('|'),\r\n    });\r\n  };\r\n\r\n  render() {\r\n    const { options, selected } = this.state;\r\n    return (\r\n      <>\r\n        <InlineList\r\n          items={options}\r\n          renderItem={(o, i) => {\r\n            const label = `${o.refId}${o.count > 1 ? ' (' + o.count + ')' : ''}`;\r\n            return (\r\n              <span\r\n                className={css`\r\n                  margin-right: ${i === options.length - 1 ? '0' : '10px'};\r\n                `}\r\n              >\r\n                <FilterPill\r\n                  onClick={() => {\r\n                    this.onFieldToggle(o.refId);\r\n                  }}\r\n                  label={label}\r\n                  selected={selected.indexOf(o.refId) > -1}\r\n                />\r\n              </span>\r\n            );\r\n          }}\r\n        />\r\n      </>\r\n    );\r\n  }\r\n}\r\n\r\ninterface FilterPillProps {\r\n  selected: boolean;\r\n  label: string;\r\n  onClick: React.MouseEventHandler<HTMLElement>;\r\n}\r\nconst FilterPill: React.FC<FilterPillProps> = ({ label, selected, onClick }) => {\r\n  const theme = useContext(ThemeContext);\r\n  return (\r\n    <div\r\n      className={css`\r\n        padding: ${theme.spacing.xxs} ${theme.spacing.sm};\r\n        color: white;\r\n        background: ${selected ? theme.colors.blueLight : theme.colors.blueShade};\r\n        border-radius: 16px;\r\n        display: inline-block;\r\n        cursor: pointer;\r\n      `}\r\n      onClick={onClick}\r\n    >\r\n      {selected && (\r\n        <i\r\n          className={cx(\r\n            'fa fa-check',\r\n            css`\r\n              margin-right: 4px;\r\n            `\r\n          )}\r\n        />\r\n      )}\r\n      {label}\r\n    </div>\r\n  );\r\n};\r\n\r\nexport const filterFramesByRefIdTransformRegistryItem: TransformerUIRegistyItem<FilterFramesByRefIdTransformerOptions> = {\r\n  id: DataTransformerID.filterByRefId,\r\n  component: FilterByRefIdTransformerEditor,\r\n  transformer: transformersRegistry.get(DataTransformerID.filterByRefId),\r\n  name: 'Filter by refId',\r\n  description: 'Filter results by refId',\r\n};\r\n","import React from 'react';\r\nimport { StatsPicker } from '../StatsPicker/StatsPicker';\r\nimport { ReduceTransformerOptions, DataTransformerID, ReducerID, transformersRegistry } from '@grafana/data';\r\nimport { TransformerUIRegistyItem, TransformerUIProps } from './types';\r\n\r\n// TODO:  Minimal implementation, needs some <3\r\nexport const ReduceTransformerEditor: React.FC<TransformerUIProps<ReduceTransformerOptions>> = ({\r\n  options,\r\n  onChange,\r\n  input,\r\n}) => {\r\n  return (\r\n    <StatsPicker\r\n      width={25}\r\n      placeholder=\"Choose Stat\"\r\n      allowMultiple\r\n      stats={options.reducers || []}\r\n      onChange={stats => {\r\n        onChange({\r\n          ...options,\r\n          reducers: stats as ReducerID[],\r\n        });\r\n      }}\r\n    />\r\n  );\r\n};\r\n\r\nexport const reduceTransformRegistryItem: TransformerUIRegistyItem<ReduceTransformerOptions> = {\r\n  id: DataTransformerID.reduce,\r\n  component: ReduceTransformerEditor,\r\n  transformer: transformersRegistry.get(DataTransformerID.reduce),\r\n  name: 'Reduce',\r\n  description: 'UI for reduce transformation',\r\n};\r\n","import React, { useContext, useState } from 'react';\r\nimport { ThemeContext } from '../../themes/ThemeContext';\r\nimport { css } from 'emotion';\r\nimport { DataFrame } from '@grafana/data';\r\nimport { JSONFormatter } from '../JSONFormatter/JSONFormatter';\r\nimport { GrafanaTheme } from '@grafana/data';\r\n\r\ninterface TransformationRowProps {\r\n  name: string;\r\n  description: string;\r\n  editor?: JSX.Element;\r\n  onRemove: () => void;\r\n  input: DataFrame[];\r\n}\r\n\r\nconst getStyles = (theme: GrafanaTheme) => ({\r\n  title: css`\r\n    display: flex;\r\n    padding: 4px 8px 4px 8px;\r\n    position: relative;\r\n    height: 35px;\r\n    background: ${theme.colors.textFaint};\r\n    border-radius: 4px 4px 0 0;\r\n    flex-wrap: nowrap;\r\n    justify-content: space-between;\r\n    align-items: center;\r\n  `,\r\n  name: css`\r\n    font-weight: ${theme.typography.weight.semibold};\r\n    color: ${theme.colors.blue};\r\n  `,\r\n  iconRow: css`\r\n    display: flex;\r\n  `,\r\n  icon: css`\r\n    background: transparent;\r\n    border: none;\r\n    box-shadow: none;\r\n    cursor: pointer;\r\n    color: ${theme.colors.textWeak};\r\n    margin-left: ${theme.spacing.sm};\r\n    &:hover {\r\n      color: ${theme.colors.text};\r\n    }\r\n  `,\r\n  editor: css`\r\n    border: 2px dashed ${theme.colors.textFaint};\r\n    border-top: none;\r\n    border-radius: 0 0 4px 4px;\r\n    padding: 8px;\r\n  `,\r\n});\r\n\r\nexport const TransformationRow = ({ onRemove, editor, name, input }: TransformationRowProps) => {\r\n  const theme = useContext(ThemeContext);\r\n  const [viewDebug, setViewDebug] = useState(false);\r\n  const styles = getStyles(theme);\r\n  return (\r\n    <div\r\n      className={css`\r\n        margin-bottom: 10px;\r\n      `}\r\n    >\r\n      <div className={styles.title}>\r\n        <div className={styles.name}>{name}</div>\r\n        <div className={styles.iconRow}>\r\n          <div onClick={() => setViewDebug(!viewDebug)} className={styles.icon}>\r\n            <i className=\"fa fa-fw fa-bug\" />\r\n          </div>\r\n          <div onClick={onRemove} className={styles.icon}>\r\n            <i className=\"fa fa-fw fa-trash\" />\r\n          </div>\r\n        </div>\r\n      </div>\r\n      <div className={styles.editor}>\r\n        {editor}\r\n        {viewDebug && (\r\n          <div>\r\n            <JSONFormatter json={input} />\r\n          </div>\r\n        )}\r\n      </div>\r\n    </div>\r\n  );\r\n};\r\n","import { DataTransformerID, DataTransformerConfig, DataFrame, transformDataFrame } from '@grafana/data';\r\nimport { Select } from '../Select/Select';\r\nimport { transformersUIRegistry } from './transformers';\r\nimport React from 'react';\r\nimport { TransformationRow } from './TransformationRow';\r\nimport { Button } from '../Button/Button';\r\nimport { css } from 'emotion';\r\n\r\ninterface TransformationsEditorState {\r\n  updateCounter: number;\r\n}\r\n\r\ninterface TransformationsEditorProps {\r\n  onChange: (transformations: DataTransformerConfig[]) => void;\r\n  transformations: DataTransformerConfig[];\r\n  dataFrames: DataFrame[];\r\n}\r\n\r\nexport class TransformationsEditor extends React.PureComponent<TransformationsEditorProps, TransformationsEditorState> {\r\n  state = { updateCounter: 0 };\r\n\r\n  onTransformationAdd = () => {\r\n    const { transformations, onChange } = this.props;\r\n    onChange([\r\n      ...transformations,\r\n      {\r\n        id: DataTransformerID.noop,\r\n        options: {},\r\n      },\r\n    ]);\r\n    this.setState({ updateCounter: this.state.updateCounter + 1 });\r\n  };\r\n\r\n  onTransformationChange = (idx: number, config: DataTransformerConfig) => {\r\n    const { transformations, onChange } = this.props;\r\n    transformations[idx] = config;\r\n    onChange(transformations);\r\n    this.setState({ updateCounter: this.state.updateCounter + 1 });\r\n  };\r\n\r\n  onTransformationRemove = (idx: number) => {\r\n    const { transformations, onChange } = this.props;\r\n    transformations.splice(idx, 1);\r\n    onChange(transformations);\r\n    this.setState({ updateCounter: this.state.updateCounter + 1 });\r\n  };\r\n\r\n  renderTransformationEditors = () => {\r\n    const { transformations, dataFrames } = this.props;\r\n    const hasTransformations = transformations.length > 0;\r\n    const preTransformData = dataFrames;\r\n\r\n    if (!hasTransformations) {\r\n      return undefined;\r\n    }\r\n\r\n    const availableTransformers = transformersUIRegistry.list().map(t => {\r\n      return {\r\n        value: t.transformer.id,\r\n        label: t.transformer.name,\r\n      };\r\n    });\r\n\r\n    return (\r\n      <>\r\n        {transformations.map((t, i) => {\r\n          let editor, input;\r\n          if (t.id === DataTransformerID.noop) {\r\n            return (\r\n              <Select\r\n                className={css`\r\n                  margin-bottom: 10px;\r\n                `}\r\n                key={`${t.id}-${i}`}\r\n                options={availableTransformers}\r\n                placeholder=\"Select transformation\"\r\n                onChange={v => {\r\n                  this.onTransformationChange(i, {\r\n                    id: v.value as string,\r\n                    options: {},\r\n                  });\r\n                }}\r\n              />\r\n            );\r\n          }\r\n          const transformationUI = transformersUIRegistry.getIfExists(t.id);\r\n          input = transformDataFrame(transformations.slice(0, i), preTransformData);\r\n\r\n          if (transformationUI) {\r\n            editor = React.createElement(transformationUI.component, {\r\n              options: { ...transformationUI.transformer.defaultOptions, ...t.options },\r\n              input,\r\n              onChange: (options: any) => {\r\n                this.onTransformationChange(i, {\r\n                  id: t.id,\r\n                  options,\r\n                });\r\n              },\r\n            });\r\n          }\r\n\r\n          return (\r\n            <TransformationRow\r\n              key={`${t.id}-${i}`}\r\n              input={input || []}\r\n              onRemove={() => this.onTransformationRemove(i)}\r\n              editor={editor}\r\n              name={transformationUI ? transformationUI.name : ''}\r\n              description={transformationUI ? transformationUI.description : ''}\r\n            />\r\n          );\r\n        })}\r\n      </>\r\n    );\r\n  };\r\n\r\n  render() {\r\n    return (\r\n      <>\r\n        {this.renderTransformationEditors()}\r\n        <Button variant=\"inverse\" icon=\"fa fa-plus\" onClick={this.onTransformationAdd}>\r\n          Add transformation\r\n        </Button>\r\n      </>\r\n    );\r\n  }\r\n}\r\n","import { Registry } from '@grafana/data';\r\nimport { reduceTransformRegistryItem } from './ReduceTransformerEditor';\r\nimport { filterFieldsByNameTransformRegistryItem } from './FilterByNameTransformerEditor';\r\nimport { filterFramesByRefIdTransformRegistryItem } from './FilterByRefIdTransformerEditor';\r\nimport { TransformerUIRegistyItem } from './types';\r\n\r\nexport const transformersUIRegistry = new Registry<TransformerUIRegistyItem<any>>(() => {\r\n  return [\r\n    reduceTransformRegistryItem,\r\n    filterFieldsByNameTransformRegistryItem,\r\n    filterFramesByRefIdTransformRegistryItem,\r\n  ];\r\n});\r\n","import React, { createRef } from 'react';\r\nimport ReactDOM from 'react-dom';\r\nimport _ from 'lodash';\r\nimport { FixedSizeList } from 'react-window';\r\n\r\nimport { TypeaheadInfo } from './TypeaheadInfo';\r\nimport { TypeaheadItem } from './TypeaheadItem';\r\nimport { flattenGroupItems, calculateLongestLabel, calculateListSizes } from '../../utils/typeahead';\r\nimport { ThemeContext } from '../../themes/ThemeContext';\r\nimport { CompletionItem, CompletionItemGroup, CompletionItemKind } from '../../types/completion';\r\n\r\nconst modulo = (a: number, n: number) => a - n * Math.floor(a / n);\r\n\r\ninterface Props {\r\n  origin: string;\r\n  groupedItems: CompletionItemGroup[];\r\n  prefix?: string;\r\n  menuRef?: (el: Typeahead) => void;\r\n  onSelectSuggestion?: (suggestion: CompletionItem) => void;\r\n  isOpen?: boolean;\r\n}\r\n\r\ninterface State {\r\n  allItems: CompletionItem[];\r\n  listWidth: number;\r\n  listHeight: number;\r\n  itemHeight: number;\r\n  hoveredItem: number | null;\r\n  typeaheadIndex: number;\r\n}\r\n\r\nexport class Typeahead extends React.PureComponent<Props, State> {\r\n  static contextType = ThemeContext;\r\n  context!: React.ContextType<typeof ThemeContext>;\r\n  listRef = createRef<FixedSizeList>();\r\n\r\n  state: State = { hoveredItem: null, typeaheadIndex: 1, allItems: [], listWidth: -1, listHeight: -1, itemHeight: -1 };\r\n\r\n  componentDidMount = () => {\r\n    if (this.props.menuRef) {\r\n      this.props.menuRef(this);\r\n    }\r\n\r\n    document.addEventListener('selectionchange', this.handleSelectionChange);\r\n\r\n    const allItems = flattenGroupItems(this.props.groupedItems);\r\n    const longestLabel = calculateLongestLabel(allItems);\r\n    const { listWidth, listHeight, itemHeight } = calculateListSizes(this.context, allItems, longestLabel);\r\n    this.setState({\r\n      listWidth,\r\n      listHeight,\r\n      itemHeight,\r\n      allItems,\r\n    });\r\n  };\r\n\r\n  componentWillUnmount = () => {\r\n    document.removeEventListener('selectionchange', this.handleSelectionChange);\r\n  };\r\n\r\n  handleSelectionChange = () => {\r\n    this.forceUpdate();\r\n  };\r\n\r\n  componentDidUpdate = (prevProps: Readonly<Props>, prevState: Readonly<State>) => {\r\n    if (prevState.typeaheadIndex !== this.state.typeaheadIndex && this.listRef && this.listRef.current) {\r\n      if (this.state.typeaheadIndex === 1) {\r\n        this.listRef.current.scrollToItem(0); // special case for handling the first group label\r\n        return;\r\n      }\r\n      this.listRef.current.scrollToItem(this.state.typeaheadIndex);\r\n    }\r\n\r\n    if (_.isEqual(prevProps.groupedItems, this.props.groupedItems) === false) {\r\n      const allItems = flattenGroupItems(this.props.groupedItems);\r\n      const longestLabel = calculateLongestLabel(allItems);\r\n      const { listWidth, listHeight, itemHeight } = calculateListSizes(this.context, allItems, longestLabel);\r\n      this.setState({ listWidth, listHeight, itemHeight, allItems });\r\n    }\r\n  };\r\n\r\n  onMouseEnter = (index: number) => {\r\n    this.setState({\r\n      hoveredItem: index,\r\n    });\r\n  };\r\n\r\n  onMouseLeave = () => {\r\n    this.setState({\r\n      hoveredItem: null,\r\n    });\r\n  };\r\n\r\n  moveMenuIndex = (moveAmount: number) => {\r\n    const itemCount = this.state.allItems.length;\r\n    if (itemCount) {\r\n      // Select next suggestion\r\n      let newTypeaheadIndex = modulo(this.state.typeaheadIndex + moveAmount, itemCount);\r\n\r\n      if (this.state.allItems[newTypeaheadIndex].kind === CompletionItemKind.GroupTitle) {\r\n        newTypeaheadIndex = modulo(newTypeaheadIndex + moveAmount, itemCount);\r\n      }\r\n\r\n      this.setState({\r\n        typeaheadIndex: newTypeaheadIndex,\r\n      });\r\n\r\n      return;\r\n    }\r\n  };\r\n\r\n  insertSuggestion = () => {\r\n    if (this.props.onSelectSuggestion) {\r\n      this.props.onSelectSuggestion(this.state.allItems[this.state.typeaheadIndex]);\r\n    }\r\n  };\r\n\r\n  get menuPosition(): string {\r\n    // Exit for unit tests\r\n    if (!window.getSelection) {\r\n      return '';\r\n    }\r\n\r\n    const selection = window.getSelection();\r\n    const node = selection && selection.anchorNode;\r\n\r\n    // Align menu overlay to editor node\r\n    if (node && node.parentElement) {\r\n      // Read from DOM\r\n      const rect = node.parentElement.getBoundingClientRect();\r\n      const scrollX = window.scrollX;\r\n      const scrollY = window.scrollY;\r\n\r\n      return `position: absolute; display: flex; top: ${rect.top + scrollY + rect.height + 6}px; left: ${rect.left +\r\n        scrollX -\r\n        2}px`;\r\n    }\r\n\r\n    return '';\r\n  }\r\n\r\n  render() {\r\n    const { prefix, isOpen = false, origin } = this.props;\r\n    const { allItems, listWidth, listHeight, itemHeight, hoveredItem, typeaheadIndex } = this.state;\r\n\r\n    const showDocumentation = hoveredItem || typeaheadIndex;\r\n\r\n    return (\r\n      <Portal origin={origin} isOpen={isOpen} style={this.menuPosition}>\r\n        <ul className=\"typeahead\">\r\n          <FixedSizeList\r\n            ref={this.listRef}\r\n            itemCount={allItems.length}\r\n            itemSize={itemHeight}\r\n            itemKey={index => {\r\n              const item = allItems && allItems[index];\r\n              const key = item ? `${index}-${item.label}` : `${index}`;\r\n              return key;\r\n            }}\r\n            width={listWidth}\r\n            height={listHeight}\r\n          >\r\n            {({ index, style }) => {\r\n              const item = allItems && allItems[index];\r\n              if (!item) {\r\n                return null;\r\n              }\r\n\r\n              return (\r\n                <TypeaheadItem\r\n                  onClickItem={() => (this.props.onSelectSuggestion ? this.props.onSelectSuggestion(item) : {})}\r\n                  isSelected={allItems[typeaheadIndex] === item}\r\n                  item={item}\r\n                  prefix={prefix}\r\n                  style={style}\r\n                  onMouseEnter={() => this.onMouseEnter(index)}\r\n                  onMouseLeave={this.onMouseLeave}\r\n                />\r\n              );\r\n            }}\r\n          </FixedSizeList>\r\n        </ul>\r\n\r\n        {showDocumentation && (\r\n          <TypeaheadInfo height={listHeight} item={allItems[hoveredItem ? hoveredItem : typeaheadIndex]} />\r\n        )}\r\n      </Portal>\r\n    );\r\n  }\r\n}\r\n\r\ninterface PortalProps {\r\n  index?: number;\r\n  isOpen: boolean;\r\n  origin: string;\r\n  style: string;\r\n}\r\n\r\nclass Portal extends React.PureComponent<PortalProps, {}> {\r\n  node: HTMLElement;\r\n\r\n  constructor(props: PortalProps) {\r\n    super(props);\r\n    const { index = 0, origin = 'query', style } = props;\r\n    this.node = document.createElement('div');\r\n    this.node.setAttribute('style', style);\r\n    this.node.classList.add(`slate-typeahead`, `slate-typeahead-${origin}-${index}`);\r\n    document.body.appendChild(this.node);\r\n  }\r\n\r\n  componentWillUnmount() {\r\n    document.body.removeChild(this.node);\r\n  }\r\n\r\n  render() {\r\n    if (this.props.isOpen) {\r\n      this.node.setAttribute('style', this.props.style);\r\n      this.node.classList.add(`slate-typeahead--open`);\r\n      return ReactDOM.createPortal(this.props.children, this.node);\r\n    } else {\r\n      this.node.classList.remove(`slate-typeahead--open`);\r\n    }\r\n\r\n    return null;\r\n  }\r\n}\r\n","import React, { useContext } from 'react';\r\nimport { css, cx } from 'emotion';\r\n\r\nimport { CompletionItem, selectThemeVariant, ThemeContext } from '../..';\r\nimport { GrafanaTheme } from '@grafana/data';\r\n\r\nconst getStyles = (theme: GrafanaTheme, height: number, visible: boolean) => {\r\n  return {\r\n    typeaheadItem: css`\r\n      label: type-ahead-item;\r\n      padding: ${theme.spacing.sm} ${theme.spacing.sm} ${theme.spacing.sm} ${theme.spacing.md};\r\n      border-radius: ${theme.border.radius.md};\r\n      border: ${selectThemeVariant(\r\n        { light: `solid 1px ${theme.colors.gray5}`, dark: `solid 1px ${theme.colors.dark1}` },\r\n        theme.type\r\n      )};\r\n      overflow-y: scroll;\r\n      overflow-x: hidden;\r\n      outline: none;\r\n      background: ${selectThemeVariant({ light: theme.colors.white, dark: theme.colors.dark4 }, theme.type)};\r\n      color: ${theme.colors.text};\r\n      box-shadow: ${selectThemeVariant(\r\n        { light: `0 5px 10px 0 ${theme.colors.gray5}`, dark: `0 5px 10px 0 ${theme.colors.black}` },\r\n        theme.type\r\n      )};\r\n      visibility: ${visible === true ? 'visible' : 'hidden'};\r\n      width: 250px;\r\n      height: ${height + parseInt(theme.spacing.xxs, 10)}px;\r\n      position: relative;\r\n    `,\r\n  };\r\n};\r\n\r\ninterface Props {\r\n  item: CompletionItem;\r\n  height: number;\r\n}\r\n\r\nexport const TypeaheadInfo: React.FC<Props> = ({ item, height }) => {\r\n  const visible = item && !!item.documentation;\r\n  const label = item ? item.label : '';\r\n  const documentation = item && item.documentation ? item.documentation : '';\r\n  const theme = useContext(ThemeContext);\r\n  const styles = getStyles(theme, height, visible);\r\n\r\n  return (\r\n    <div className={cx([styles.typeaheadItem])}>\r\n      <b>{label}</b>\r\n      <hr />\r\n      <span>{documentation}</span>\r\n    </div>\r\n  );\r\n};\r\n","import React, { useContext } from 'react';\r\n\r\n// @ts-ignore\r\nimport Highlighter from 'react-highlight-words';\r\nimport { css, cx } from 'emotion';\r\nimport { GrafanaTheme } from '@grafana/data';\r\nimport { selectThemeVariant } from '../../themes/selectThemeVariant';\r\nimport { CompletionItem, CompletionItemKind } from '../../types/completion';\r\nimport { ThemeContext } from '../../themes/ThemeContext';\r\n\r\ninterface Props {\r\n  isSelected: boolean;\r\n  item: CompletionItem;\r\n  style: any;\r\n  prefix?: string;\r\n\r\n  onClickItem?: (event: React.MouseEvent) => void;\r\n  onMouseEnter?: () => void;\r\n  onMouseLeave?: () => void;\r\n}\r\n\r\nconst getStyles = (theme: GrafanaTheme) => ({\r\n  typeaheadItem: css`\r\n    label: type-ahead-item;\r\n    height: auto;\r\n    font-family: ${theme.typography.fontFamily.monospace};\r\n    padding: ${theme.spacing.sm} ${theme.spacing.sm} ${theme.spacing.sm} ${theme.spacing.md};\r\n    font-size: ${theme.typography.size.sm};\r\n    text-overflow: ellipsis;\r\n    overflow: hidden;\r\n    z-index: 1;\r\n    display: block;\r\n    white-space: nowrap;\r\n    cursor: pointer;\r\n    transition: color 0.3s cubic-bezier(0.645, 0.045, 0.355, 1), border-color 0.3s cubic-bezier(0.645, 0.045, 0.355, 1),\r\n      background 0.3s cubic-bezier(0.645, 0.045, 0.355, 1), padding 0.15s cubic-bezier(0.645, 0.045, 0.355, 1);\r\n  `,\r\n\r\n  typeaheadItemSelected: css`\r\n    label: type-ahead-item-selected;\r\n    background-color: ${selectThemeVariant({ light: theme.colors.gray6, dark: theme.colors.dark9 }, theme.type)};\r\n  `,\r\n\r\n  typeaheadItemMatch: css`\r\n    label: type-ahead-item-match;\r\n    color: ${theme.colors.yellow};\r\n    border-bottom: 1px solid ${theme.colors.yellow};\r\n    padding: inherit;\r\n    background: inherit;\r\n  `,\r\n\r\n  typeaheadItemGroupTitle: css`\r\n    label: type-ahead-item-group-title;\r\n    color: ${theme.colors.textWeak};\r\n    font-size: ${theme.typography.size.sm};\r\n    line-height: ${theme.typography.lineHeight.md};\r\n    padding: ${theme.spacing.sm};\r\n  `,\r\n});\r\n\r\nexport const TypeaheadItem: React.FC<Props> = (props: Props) => {\r\n  const theme = useContext(ThemeContext);\r\n  const styles = getStyles(theme);\r\n\r\n  const { isSelected, item, prefix, style, onMouseEnter, onMouseLeave, onClickItem } = props;\r\n  const className = isSelected ? cx([styles.typeaheadItem, styles.typeaheadItemSelected]) : cx([styles.typeaheadItem]);\r\n  const highlightClassName = cx([styles.typeaheadItemMatch]);\r\n  const itemGroupTitleClassName = cx([styles.typeaheadItemGroupTitle]);\r\n  const label = item.label || '';\r\n\r\n  if (item.kind === CompletionItemKind.GroupTitle) {\r\n    return (\r\n      <li className={itemGroupTitleClassName} style={style}>\r\n        <span>{label}</span>\r\n      </li>\r\n    );\r\n  }\r\n\r\n  return (\r\n    <li\r\n      className={className}\r\n      style={style}\r\n      onMouseDown={onClickItem}\r\n      onMouseEnter={onMouseEnter}\r\n      onMouseLeave={onMouseLeave}\r\n    >\r\n      <Highlighter textToHighlight={label} searchWords={[prefix]} highlightClassName={highlightClassName} />\r\n    </li>\r\n  );\r\n};\r\n","import React, { PureComponent } from 'react';\r\n\r\nimport { Select } from '../Select/Select';\r\n\r\nimport { getValueFormats, SelectableValue } from '@grafana/data';\r\n\r\ninterface Props {\r\n  onChange: (item?: string) => void;\r\n  value?: string;\r\n  width?: number;\r\n}\r\n\r\nfunction formatCreateLabel(input: string) {\r\n  return `Custom unit: ${input}`;\r\n}\r\n\r\nexport class UnitPicker extends PureComponent<Props> {\r\n  static defaultProps = {\r\n    width: 12,\r\n  };\r\n\r\n  onChange = (value: SelectableValue<string>) => {\r\n    this.props.onChange(value.value);\r\n  };\r\n\r\n  render() {\r\n    const { value, width } = this.props;\r\n\r\n    // Set the current selection\r\n    let current: SelectableValue<string> | undefined = undefined;\r\n\r\n    // All units\r\n    const unitGroups = getValueFormats();\r\n\r\n    // Need to transform the data structure to work well with Select\r\n    const groupOptions = unitGroups.map(group => {\r\n      const options = group.submenu.map(unit => {\r\n        const sel = {\r\n          label: unit.text,\r\n          value: unit.value,\r\n        };\r\n        if (unit.value === value) {\r\n          current = sel;\r\n        }\r\n        return sel;\r\n      });\r\n\r\n      return {\r\n        label: group.text,\r\n        options,\r\n      };\r\n    });\r\n\r\n    // Show the custom unit\r\n    if (value && !current) {\r\n      current = { value, label: value };\r\n    }\r\n\r\n    return (\r\n      <Select\r\n        width={width}\r\n        defaultValue={current}\r\n        isSearchable={true}\r\n        allowCustomValue={true}\r\n        formatCreateLabel={formatCreateLabel}\r\n        options={groupOptions}\r\n        placeholder=\"Choose\"\r\n        onChange={this.onChange}\r\n      />\r\n    );\r\n  }\r\n}\r\n","import React, { ChangeEvent, PureComponent } from 'react';\r\n\r\nimport { FormField } from '../FormField/FormField';\r\nimport { FormLabel } from '../FormLabel/FormLabel';\r\nimport { Input } from '../Input/Input';\r\nimport { Select } from '../Select/Select';\r\n\r\nimport { MappingType, ValueMapping } from '@grafana/data';\r\n\r\nexport interface Props {\r\n  valueMapping: ValueMapping;\r\n  updateValueMapping: (valueMapping: ValueMapping) => void;\r\n  removeValueMapping: () => void;\r\n}\r\n\r\ninterface State {\r\n  from?: string;\r\n  id: number;\r\n  operator: string;\r\n  text: string;\r\n  to?: string;\r\n  type: MappingType;\r\n  value?: string;\r\n}\r\n\r\nconst mappingOptions = [\r\n  { value: MappingType.ValueToText, label: 'Value' },\r\n  { value: MappingType.RangeToText, label: 'Range' },\r\n];\r\n\r\nexport default class MappingRow extends PureComponent<Props, State> {\r\n  constructor(props: Props) {\r\n    super(props);\r\n\r\n    this.state = { ...props.valueMapping };\r\n  }\r\n\r\n  onMappingValueChange = (event: ChangeEvent<HTMLInputElement>) => {\r\n    this.setState({ value: event.target.value });\r\n  };\r\n\r\n  onMappingFromChange = (event: ChangeEvent<HTMLInputElement>) => {\r\n    this.setState({ from: event.target.value });\r\n  };\r\n\r\n  onMappingToChange = (event: ChangeEvent<HTMLInputElement>) => {\r\n    this.setState({ to: event.target.value });\r\n  };\r\n\r\n  onMappingTextChange = (event: ChangeEvent<HTMLInputElement>) => {\r\n    this.setState({ text: event.target.value });\r\n  };\r\n\r\n  onMappingTypeChange = (mappingType: MappingType) => {\r\n    this.setState({ type: mappingType });\r\n  };\r\n\r\n  updateMapping = () => {\r\n    this.props.updateValueMapping({ ...this.state } as ValueMapping);\r\n  };\r\n\r\n  renderRow() {\r\n    const { from, text, to, type, value } = this.state;\r\n\r\n    if (type === MappingType.RangeToText) {\r\n      return (\r\n        <>\r\n          <FormField\r\n            label=\"From\"\r\n            labelWidth={4}\r\n            inputWidth={8}\r\n            onBlur={this.updateMapping}\r\n            onChange={this.onMappingFromChange}\r\n            value={from}\r\n          />\r\n          <FormField\r\n            label=\"To\"\r\n            labelWidth={4}\r\n            inputWidth={8}\r\n            onBlur={this.updateMapping}\r\n            onChange={this.onMappingToChange}\r\n            value={to}\r\n          />\r\n          <div className=\"gf-form gf-form--grow\">\r\n            <FormLabel width={4}>Text</FormLabel>\r\n            <Input\r\n              className=\"gf-form-input\"\r\n              onBlur={this.updateMapping}\r\n              value={text}\r\n              onChange={this.onMappingTextChange}\r\n            />\r\n          </div>\r\n        </>\r\n      );\r\n    }\r\n\r\n    return (\r\n      <>\r\n        <FormField\r\n          label=\"Value\"\r\n          labelWidth={4}\r\n          onBlur={this.updateMapping}\r\n          onChange={this.onMappingValueChange}\r\n          value={value}\r\n          inputWidth={8}\r\n        />\r\n        <div className=\"gf-form gf-form--grow\">\r\n          <FormLabel width={4}>Text</FormLabel>\r\n          <Input\r\n            className=\"gf-form-input\"\r\n            onBlur={this.updateMapping}\r\n            value={text}\r\n            onChange={this.onMappingTextChange}\r\n          />\r\n        </div>\r\n      </>\r\n    );\r\n  }\r\n\r\n  render() {\r\n    const { type } = this.state;\r\n\r\n    return (\r\n      <div className=\"gf-form-inline\">\r\n        <div className=\"gf-form\">\r\n          <FormLabel width={5}>Type</FormLabel>\r\n          <Select\r\n            placeholder=\"Choose type\"\r\n            isSearchable={false}\r\n            options={mappingOptions}\r\n            value={mappingOptions.find(o => o.value === type)}\r\n            // @ts-ignore\r\n            onChange={type => this.onMappingTypeChange(type.value)}\r\n            width={7}\r\n          />\r\n        </div>\r\n        {this.renderRow()}\r\n        <div className=\"gf-form\">\r\n          <button onClick={this.props.removeValueMapping} className=\"gf-form-label gf-form-label--btn\">\r\n            <i className=\"fa fa-times\" />\r\n          </button>\r\n        </div>\r\n      </div>\r\n    );\r\n  }\r\n}\r\n","import React, { PureComponent } from 'react';\r\n\r\nimport MappingRow from './MappingRow';\r\nimport { MappingType, ValueMapping } from '@grafana/data';\r\nimport { Button } from '../Button/Button';\r\nimport { PanelOptionsGroup } from '../PanelOptionsGroup/PanelOptionsGroup';\r\n\r\nexport interface Props {\r\n  valueMappings?: ValueMapping[];\r\n  onChange: (valueMappings: ValueMapping[]) => void;\r\n}\r\n\r\ninterface State {\r\n  valueMappings: ValueMapping[];\r\n  nextIdToAdd: number;\r\n}\r\n\r\nexport class ValueMappingsEditor extends PureComponent<Props, State> {\r\n  constructor(props: Props) {\r\n    super(props);\r\n\r\n    const mappings = props.valueMappings || [];\r\n\r\n    this.state = {\r\n      valueMappings: mappings,\r\n      nextIdToAdd: mappings.length > 0 ? this.getMaxIdFromValueMappings(mappings) : 1,\r\n    };\r\n  }\r\n\r\n  getMaxIdFromValueMappings(mappings: ValueMapping[]) {\r\n    return (\r\n      Math.max.apply(\r\n        null,\r\n        mappings.map(mapping => mapping.id).map(m => m)\r\n      ) + 1\r\n    );\r\n  }\r\n\r\n  onAddMapping = () =>\r\n    this.setState(prevState => ({\r\n      valueMappings: [\r\n        ...prevState.valueMappings,\r\n        {\r\n          id: prevState.nextIdToAdd,\r\n          operator: '',\r\n          value: '',\r\n          text: '',\r\n          type: MappingType.ValueToText,\r\n          from: '',\r\n          to: '',\r\n        },\r\n      ],\r\n      nextIdToAdd: prevState.nextIdToAdd + 1,\r\n    }));\r\n\r\n  onRemoveMapping = (id: number) => {\r\n    this.setState(\r\n      prevState => ({\r\n        valueMappings: prevState.valueMappings.filter(m => {\r\n          return m.id !== id;\r\n        }),\r\n      }),\r\n      () => {\r\n        this.props.onChange(this.state.valueMappings);\r\n      }\r\n    );\r\n  };\r\n\r\n  updateGauge = (mapping: ValueMapping) => {\r\n    this.setState(\r\n      prevState => ({\r\n        valueMappings: prevState.valueMappings.map(m => {\r\n          if (m.id === mapping.id) {\r\n            return { ...mapping };\r\n          }\r\n\r\n          return m;\r\n        }),\r\n      }),\r\n      () => {\r\n        this.props.onChange(this.state.valueMappings);\r\n      }\r\n    );\r\n  };\r\n\r\n  render() {\r\n    const { valueMappings } = this.state;\r\n\r\n    return (\r\n      <PanelOptionsGroup title=\"Value mappings\">\r\n        <div>\r\n          {valueMappings.length > 0 &&\r\n            valueMappings.map((valueMapping, index) => (\r\n              <MappingRow\r\n                key={`${valueMapping.text}-${index}`}\r\n                valueMapping={valueMapping}\r\n                updateValueMapping={this.updateGauge}\r\n                removeValueMapping={() => this.onRemoveMapping(valueMapping.id)}\r\n              />\r\n            ))}\r\n          <Button variant=\"inverse\" icon=\"fa fa-plus\" onClick={this.onAddMapping}>\r\n            Add mapping\r\n          </Button>\r\n        </div>\r\n      </PanelOptionsGroup>\r\n    );\r\n  }\r\n}\r\n","import React, { PureComponent, CSSProperties } from 'react';\r\nimport { VizOrientation } from '@grafana/data';\r\n\r\ninterface Props<V, D> {\r\n  /**\r\n   * Optionally precalculate dimensions to support consistent behavior between repeated\r\n   * values.  Two typical patterns are:\r\n   * 1) Calculate raw values like font size etc and pass them to each vis\r\n   * 2) find the maximum input values and pass that to the vis\r\n   */\r\n  getAlignmentFactors?: (values: V[], width: number, height: number) => D;\r\n\r\n  /**\r\n   * Render a single value\r\n   */\r\n  renderValue: (value: V, width: number, height: number, dims: D) => JSX.Element;\r\n  height: number;\r\n  width: number;\r\n  source: any; // If this changes, new values will be requested\r\n  getValues: () => V[];\r\n  renderCounter: number; // force update of values & render\r\n  orientation: VizOrientation;\r\n  itemSpacing?: number;\r\n}\r\n\r\ninterface DefaultProps {\r\n  itemSpacing: number;\r\n}\r\n\r\ntype PropsWithDefaults<V, D> = Props<V, D> & DefaultProps;\r\n\r\ninterface State<V> {\r\n  values: V[];\r\n}\r\n\r\nexport class VizRepeater<V, D = {}> extends PureComponent<Props<V, D>, State<V>> {\r\n  static defaultProps: DefaultProps = {\r\n    itemSpacing: 10,\r\n  };\r\n\r\n  constructor(props: Props<V, D>) {\r\n    super(props);\r\n\r\n    this.state = {\r\n      values: props.getValues(),\r\n    };\r\n  }\r\n\r\n  componentDidUpdate(prevProps: Props<V, D>) {\r\n    const { renderCounter, source } = this.props;\r\n    if (renderCounter !== prevProps.renderCounter || source !== prevProps.source) {\r\n      this.setState({ values: this.props.getValues() });\r\n    }\r\n  }\r\n\r\n  getOrientation(): VizOrientation {\r\n    const { orientation, width, height } = this.props;\r\n\r\n    if (orientation === VizOrientation.Auto) {\r\n      if (width > height) {\r\n        return VizOrientation.Vertical;\r\n      } else {\r\n        return VizOrientation.Horizontal;\r\n      }\r\n    }\r\n\r\n    return orientation;\r\n  }\r\n\r\n  render() {\r\n    const { renderValue, height, width, itemSpacing, getAlignmentFactors } = this.props as PropsWithDefaults<V, D>;\r\n    const { values } = this.state;\r\n    const orientation = this.getOrientation();\r\n\r\n    const itemStyles: React.CSSProperties = {\r\n      display: 'flex',\r\n    };\r\n\r\n    const repeaterStyle: React.CSSProperties = {\r\n      display: 'flex',\r\n    };\r\n\r\n    let vizHeight = height;\r\n    let vizWidth = width;\r\n\r\n    if (orientation === VizOrientation.Horizontal) {\r\n      repeaterStyle.flexDirection = 'column';\r\n      itemStyles.marginBottom = `${itemSpacing}px`;\r\n      vizWidth = width;\r\n      vizHeight = height / values.length - itemSpacing + itemSpacing / values.length;\r\n    } else {\r\n      repeaterStyle.flexDirection = 'row';\r\n      repeaterStyle.justifyContent = 'space-between';\r\n      itemStyles.marginRight = `${itemSpacing}px`;\r\n      vizHeight = height;\r\n      vizWidth = width / values.length - itemSpacing + itemSpacing / values.length;\r\n    }\r\n\r\n    itemStyles.width = `${vizWidth}px`;\r\n    itemStyles.height = `${vizHeight}px`;\r\n\r\n    const dims = getAlignmentFactors ? getAlignmentFactors(values, vizWidth, vizHeight) : ({} as D);\r\n    return (\r\n      <div style={repeaterStyle}>\r\n        {values.map((value, index) => {\r\n          return (\r\n            <div key={index} style={getItemStylesForIndex(itemStyles, index, values.length)}>\r\n              {renderValue(value, vizWidth, vizHeight, dims)}\r\n            </div>\r\n          );\r\n        })}\r\n      </div>\r\n    );\r\n  }\r\n}\r\n\r\n/*\r\n * Removes any padding on the last item\r\n */\r\nfunction getItemStylesForIndex(itemStyles: CSSProperties, index: number, length: number): CSSProperties {\r\n  if (index === length - 1) {\r\n    return {\r\n      ...itemStyles,\r\n      marginRight: 0,\r\n      marginBottom: 0,\r\n    };\r\n  }\r\n  return itemStyles;\r\n}\r\n","export { ConfirmButton } from './ConfirmButton/ConfirmButton';\r\nexport { DeleteButton } from './ConfirmButton/DeleteButton';\r\nexport { Tooltip, PopoverContent } from './Tooltip/Tooltip';\r\nexport { PopoverController } from './Tooltip/PopoverController';\r\nexport { Popover } from './Tooltip/Popover';\r\nexport { Portal } from './Portal/Portal';\r\nexport { CustomScrollbar } from './CustomScrollbar/CustomScrollbar';\r\n\r\nexport * from './Button/Button';\r\n\r\n// Select\r\nexport { Select, AsyncSelect } from './Select/Select';\r\nexport { IndicatorsContainer } from './Select/IndicatorsContainer';\r\nexport { NoOptionsMessage } from './Select/NoOptionsMessage';\r\nexport { default as resetSelectStyles } from './Forms/Select/resetSelectStyles';\r\nexport { ButtonSelect } from './Select/ButtonSelect';\r\nexport { ButtonCascader } from './ButtonCascader/ButtonCascader';\r\nexport { Cascader, CascaderOption } from './Cascader/Cascader';\r\n\r\n// Forms\r\nexport { FormLabel } from './FormLabel/FormLabel';\r\nexport { FormField } from './FormField/FormField';\r\nexport { SecretFormField } from './SecretFormFied/SecretFormField';\r\n\r\nexport { LoadingPlaceholder } from './LoadingPlaceholder/LoadingPlaceholder';\r\nexport { ColorPicker, SeriesColorPicker } from './ColorPicker/ColorPicker';\r\nexport { SeriesColorPickerPopover, SeriesColorPickerPopoverWithTheme } from './ColorPicker/SeriesColorPickerPopover';\r\n\r\nexport { PanelOptionsGroup } from './PanelOptionsGroup/PanelOptionsGroup';\r\nexport { PanelOptionsGrid } from './PanelOptionsGrid/PanelOptionsGrid';\r\nexport { ValueMappingsEditor } from './ValueMappingsEditor/ValueMappingsEditor';\r\nexport { Switch } from './Switch/Switch';\r\nexport { EmptySearchResult } from './EmptySearchResult/EmptySearchResult';\r\nexport { PieChart, PieChartType } from './PieChart/PieChart';\r\nexport { UnitPicker } from './UnitPicker/UnitPicker';\r\nexport { StatsPicker } from './StatsPicker/StatsPicker';\r\nexport { Input, InputStatus } from './Input/Input';\r\nexport { RefreshPicker } from './RefreshPicker/RefreshPicker';\r\nexport { TimePicker } from './TimePicker/TimePicker';\r\nexport { TimeOfDayPicker } from './TimePicker/TimeOfDayPicker';\r\nexport { List } from './List/List';\r\nexport { TagsInput } from './TagsInput/TagsInput';\r\nexport { Modal } from './Modal/Modal';\r\nexport { ConfirmModal } from './ConfirmModal/ConfirmModal';\r\nexport { QueryField } from './QueryField/QueryField';\r\n\r\n// Renderless\r\nexport { SetInterval } from './SetInterval/SetInterval';\r\n\r\nexport { Table } from './Table/Table';\r\nexport { TableInputCSV } from './TableInputCSV/TableInputCSV';\r\nexport { TabsBar } from './Tabs/TabsBar';\r\nexport { Tab } from './Tabs/Tab';\r\nexport { TabContent } from './Tabs/TabContent';\r\n\r\n// Visualizations\r\nexport {\r\n  BigValue,\r\n  BigValueColorMode,\r\n  BigValueSparkline,\r\n  BigValueGraphMode,\r\n  BigValueJustifyMode,\r\n} from './BigValue/BigValue';\r\n\r\nexport { Gauge } from './Gauge/Gauge';\r\nexport { Graph } from './Graph/Graph';\r\nexport { GraphLegend } from './Graph/GraphLegend';\r\nexport { GraphWithLegend } from './Graph/GraphWithLegend';\r\nexport { GraphContextMenu } from './Graph/GraphContextMenu';\r\nexport { BarGauge, BarGaugeDisplayMode } from './BarGauge/BarGauge';\r\nexport { GraphTooltipOptions } from './Graph/GraphTooltip/types';\r\nexport { VizRepeater } from './VizRepeater/VizRepeater';\r\n\r\nexport {\r\n  LegendOptions,\r\n  LegendBasicOptions,\r\n  LegendRenderOptions,\r\n  LegendList,\r\n  LegendTable,\r\n  LegendItem,\r\n  LegendPlacement,\r\n  LegendDisplayMode,\r\n} from './Legend/Legend';\r\n\r\nexport { Alert, AlertVariant } from './Alert/Alert';\r\nexport { GraphSeriesToggler, GraphSeriesTogglerAPI } from './Graph/GraphSeriesToggler';\r\nexport { Collapse } from './Collapse/Collapse';\r\nexport { LogLabels } from './Logs/LogLabels';\r\nexport { LogRows } from './Logs/LogRows';\r\nexport { getLogRowStyles } from './Logs/getLogRowStyles';\r\nexport { ToggleButtonGroup, ToggleButton } from './ToggleButtonGroup/ToggleButtonGroup';\r\n// Panel editors\r\nexport { ThresholdsEditor } from './ThresholdsEditor/ThresholdsEditor';\r\nexport { ClickOutsideWrapper } from './ClickOutsideWrapper/ClickOutsideWrapper';\r\nexport * from './SingleStatShared/index';\r\nexport { CallToActionCard } from './CallToActionCard/CallToActionCard';\r\nexport { ContextMenu, ContextMenuItem, ContextMenuGroup, ContextMenuProps } from './ContextMenu/ContextMenu';\r\nexport { VariableSuggestion, VariableOrigin } from './DataLinks/DataLinkSuggestions';\r\nexport { DataLinksEditor } from './DataLinks/DataLinksEditor';\r\nexport { DataLinkInput } from './DataLinks/DataLinkInput';\r\nexport { DataLinksContextMenu } from './DataLinks/DataLinksContextMenu';\r\nexport { SeriesIcon } from './Legend/SeriesIcon';\r\nexport { transformersUIRegistry } from './TransformersUI/transformers';\r\nexport { TransformationRow } from './TransformersUI/TransformationRow';\r\nexport { TransformationsEditor } from './TransformersUI/TransformationsEditor';\r\nexport { JSONFormatter } from './JSONFormatter/JSONFormatter';\r\nexport { JsonExplorer } from './JSONFormatter/json_explorer/json_explorer';\r\nexport { ErrorBoundary, ErrorBoundaryAlert } from './ErrorBoundary/ErrorBoundary';\r\nexport { ErrorWithStack } from './ErrorBoundary/ErrorWithStack';\r\nexport { AlphaNotice } from './AlphaNotice/AlphaNotice';\r\nexport { DataSourceHttpSettings } from './DataSourceSettings/DataSourceHttpSettings';\r\nexport { Spinner } from './Spinner/Spinner';\r\nexport { FadeTransition } from './transitions/FadeTransition';\r\nexport { SlideOutTransition } from './transitions/SlideOutTransition';\r\nexport { Segment, SegmentAsync, SegmentInput, SegmentSelect } from './Segment/';\r\nexport { default as Chart } from './Chart';\r\nexport { Icon } from './Icon/Icon';\r\nexport { Drawer } from './Drawer/Drawer';\r\n\r\n// Next-gen forms\r\nexport { default as Forms } from './Forms';\r\n","import React from 'react';\r\nimport { css } from 'emotion';\r\nimport { CSSTransition } from 'react-transition-group';\r\nimport { stylesFactory } from '../../themes';\r\n\r\nconst getStyles = stylesFactory((duration: number) => {\r\n  return {\r\n    enter: css`\r\n      label: enter;\r\n      opacity: 0;\r\n    `,\r\n    enterActive: css`\r\n      label: enterActive;\r\n      opacity: 1;\r\n      transition: opacity ${duration}ms ease-out;\r\n    `,\r\n    exit: css`\r\n      label: exit;\r\n      opacity: 1;\r\n    `,\r\n    exitActive: css`\r\n      label: exitActive;\r\n      opacity: 0;\r\n      transition: opacity ${duration}ms ease-out;\r\n    `,\r\n  };\r\n});\r\n\r\ntype Props = {\r\n  children: React.ReactNode;\r\n  visible: boolean;\r\n  duration?: number;\r\n};\r\n\r\nexport function FadeTransition(props: Props) {\r\n  const { visible, children, duration = 250 } = props;\r\n  const styles = getStyles(duration);\r\n  return (\r\n    <CSSTransition in={visible} mountOnEnter={true} unmountOnExit={true} timeout={duration} classNames={styles}>\r\n      {children}\r\n    </CSSTransition>\r\n  );\r\n}\r\n","import React from 'react';\r\nimport { css } from 'emotion';\r\nimport { CSSTransition } from 'react-transition-group';\r\nimport { stylesFactory } from '../../themes';\r\n\r\nconst getStyles = stylesFactory((duration: number, measurement: 'width' | 'height', size: number) => {\r\n  return {\r\n    enter: css`\r\n      label: enter;\r\n      ${measurement}: 0;\r\n      opacity: 0;\r\n    `,\r\n    enterActive: css`\r\n      label: enterActive;\r\n      ${measurement}: ${size}px;\r\n      opacity: 1;\r\n      transition: opacity ${duration}ms ease-out, ${measurement} ${duration}ms ease-out;\r\n    `,\r\n    exit: css`\r\n      label: exit;\r\n      ${measurement}: ${size}px;\r\n      opacity: 1;\r\n    `,\r\n    exitActive: css`\r\n      label: exitActive;\r\n      opacity: 0;\r\n      ${measurement}: 0;\r\n      transition: opacity ${duration}ms ease-out, ${measurement} ${duration}ms ease-out;\r\n    `,\r\n  };\r\n});\r\n\r\ntype Props = {\r\n  children: React.ReactNode;\r\n  visible: boolean;\r\n  size: number;\r\n\r\n  duration?: number;\r\n  horizontal?: boolean;\r\n};\r\n\r\nexport function SlideOutTransition(props: Props) {\r\n  const { visible, children, duration = 250, horizontal, size } = props;\r\n  const styles = getStyles(duration, horizontal ? 'width' : 'height', size);\r\n  return (\r\n    <CSSTransition in={visible} mountOnEnter={true} unmountOnExit={true} timeout={duration} classNames={styles}>\r\n      {children}\r\n    </CSSTransition>\r\n  );\r\n}\r\n","export * from './components';\r\nexport * from './types';\r\nexport * from './utils';\r\nexport * from './themes';\r\nexport * from './slate-plugins';\r\n","import { Plugin } from '@grafana/slate-react';\r\nimport { Editor as CoreEditor, Annotation } from 'slate';\r\n\r\nconst BRACES: any = {\r\n  '[': ']',\r\n  '{': '}',\r\n  '(': ')',\r\n};\r\n\r\nconst MATCH_MARK = 'brace_match';\r\n\r\nexport function BracesPlugin(): Plugin {\r\n  return {\r\n    onKeyDown(event: Event, editor: CoreEditor, next: Function) {\r\n      const keyEvent = event as KeyboardEvent;\r\n      const { value } = editor;\r\n\r\n      switch (keyEvent.key) {\r\n        case '(':\r\n        case '{':\r\n        case '[': {\r\n          const {\r\n            start: { offset: startOffset, key: startKey },\r\n            end: { offset: endOffset, key: endKey },\r\n            focus: { offset: focusOffset },\r\n          } = value.selection;\r\n          const text = value.focusText.text;\r\n\r\n          // If text is selected, wrap selected text in parens\r\n          if (value.selection.isExpanded) {\r\n            keyEvent.preventDefault();\r\n            editor\r\n              .insertTextByKey(startKey, startOffset, keyEvent.key)\r\n              .insertTextByKey(endKey, endOffset + 1, BRACES[keyEvent.key])\r\n              .moveEndBackward(1);\r\n            return true;\r\n          } else if (\r\n            // Insert matching brace when there is no input after caret\r\n            focusOffset === text.length ||\r\n            text[focusOffset] === ' ' ||\r\n            Object.values(BRACES).includes(text[focusOffset])\r\n          ) {\r\n            keyEvent.preventDefault();\r\n            const complement = BRACES[keyEvent.key];\r\n            const matchAnnotation = {\r\n              key: `${MATCH_MARK}-${Date.now()}`,\r\n              type: `${MATCH_MARK}-${complement}`,\r\n              anchor: {\r\n                key: startKey,\r\n                offset: startOffset,\r\n                object: 'point',\r\n              },\r\n              focus: {\r\n                key: endKey,\r\n                offset: endOffset + 1,\r\n                object: 'point',\r\n              },\r\n              object: 'annotation',\r\n            } as Annotation;\r\n            editor\r\n              .insertText(keyEvent.key)\r\n              .insertText(complement)\r\n              .addAnnotation(matchAnnotation)\r\n              .moveBackward(1);\r\n\r\n            return true;\r\n          }\r\n          break;\r\n        }\r\n\r\n        case ')':\r\n        case '}':\r\n        case ']': {\r\n          const text = value.anchorText.text;\r\n          const offset = value.selection.anchor.offset;\r\n          const nextChar = text[offset];\r\n          // Handle closing brace when it's already the next character\r\n          const complement = keyEvent.key;\r\n          const annotationType = `${MATCH_MARK}-${complement}`;\r\n          const annotation = value.annotations.find(\r\n            a => a?.type === annotationType && a.anchor.key === value.anchorText.key\r\n          );\r\n          if (annotation && nextChar === complement && !value.selection.isExpanded) {\r\n            keyEvent.preventDefault();\r\n            editor\r\n              .moveFocusForward(1)\r\n              .removeAnnotation(annotation)\r\n              .moveAnchorForward(1);\r\n            return true;\r\n          }\r\n          break;\r\n        }\r\n\r\n        case 'Backspace': {\r\n          const text = value.anchorText.text;\r\n          const offset = value.selection.anchor.offset;\r\n          const previousChar = text[offset - 1];\r\n          const nextChar = text[offset];\r\n          if (BRACES[previousChar] && BRACES[previousChar] === nextChar) {\r\n            keyEvent.preventDefault();\r\n            // Remove closing brace if directly following\r\n            editor\r\n              .deleteBackward(1)\r\n              .deleteForward(1)\r\n              .focus();\r\n            return true;\r\n          }\r\n        }\r\n\r\n        default: {\r\n          break;\r\n        }\r\n      }\r\n\r\n      return next();\r\n    },\r\n  };\r\n}\r\n","import { Plugin } from '@grafana/slate-react';\nimport { Editor as CoreEditor } from 'slate';\n\n// Clears the rest of the line after the caret\nexport function ClearPlugin(): Plugin {\n  return {\n    onKeyDown(event: Event, editor: CoreEditor, next: Function) {\n      const keyEvent = event as KeyboardEvent;\n      const value = editor.value;\n\n      if (value.selection.isExpanded) {\n        return next();\n      }\n\n      if (keyEvent.key === 'k' && keyEvent.ctrlKey) {\n        keyEvent.preventDefault();\n        const text = value.anchorText.text;\n        const offset = value.selection.anchor.offset;\n        const length = text.length;\n        const forward = length - offset;\n        editor.deleteForward(forward);\n        return true;\n      }\n\n      return next();\n    },\n  };\n}\n","import { Plugin } from '@grafana/slate-react';\r\nimport { Editor as CoreEditor } from 'slate';\r\n\r\nconst getCopiedText = (textBlocks: string[], startOffset: number, endOffset: number) => {\r\n  if (!textBlocks.length) {\r\n    return undefined;\r\n  }\r\n\r\n  const excludingLastLineLength = textBlocks.slice(0, -1).join('').length + textBlocks.length - 1;\r\n  return textBlocks.join('\\n').slice(startOffset, excludingLastLineLength + endOffset);\r\n};\r\n\r\nexport function ClipboardPlugin(): Plugin {\r\n  const clipboardPlugin: Plugin = {\r\n    onCopy(event: Event, editor: CoreEditor, next: () => any) {\r\n      const clipEvent = event as ClipboardEvent;\r\n      clipEvent.preventDefault();\r\n\r\n      const { document, selection } = editor.value;\r\n      const {\r\n        start: { offset: startOffset },\r\n        end: { offset: endOffset },\r\n      } = selection;\r\n      const selectedBlocks = document\r\n        .getLeafBlocksAtRange(selection)\r\n        .toArray()\r\n        .map(block => block.text);\r\n\r\n      const copiedText = getCopiedText(selectedBlocks, startOffset, endOffset);\r\n      if (copiedText && clipEvent.clipboardData) {\r\n        clipEvent.clipboardData.setData('Text', copiedText);\r\n      }\r\n\r\n      return true;\r\n    },\r\n\r\n    onPaste(event: Event, editor: CoreEditor, next: () => any) {\r\n      const clipEvent = event as ClipboardEvent;\r\n      clipEvent.preventDefault();\r\n      if (clipEvent.clipboardData) {\r\n        const pastedValue = clipEvent.clipboardData.getData('Text');\r\n        const lines = pastedValue.split('\\n');\r\n\r\n        if (lines.length) {\r\n          editor.insertText(lines[0]);\r\n          for (const line of lines.slice(1)) {\r\n            editor.splitBlock().insertText(line);\r\n          }\r\n        }\r\n      }\r\n\r\n      return true;\r\n    },\r\n  };\r\n\r\n  return {\r\n    ...clipboardPlugin,\r\n    onCut(event: Event, editor: CoreEditor, next: () => any) {\r\n      const clipEvent = event as ClipboardEvent;\r\n      clipboardPlugin.onCopy!(clipEvent, editor, next);\r\n      editor.deleteAtRange(editor.value.selection);\r\n\r\n      return true;\r\n    },\r\n  };\r\n}\r\n","import { RangeJSON, Range as SlateRange, Editor as CoreEditor } from 'slate';\nimport { Plugin } from '@grafana/slate-react';\nimport { isKeyHotkey } from 'is-hotkey';\n\nconst isIndentLeftHotkey = isKeyHotkey('mod+[');\nconst isShiftTabHotkey = isKeyHotkey('shift+tab');\nconst isIndentRightHotkey = isKeyHotkey('mod+]');\n\nconst SLATE_TAB = '  ';\n\nconst handleTabKey = (event: KeyboardEvent, editor: CoreEditor, next: Function): void => {\n  const {\n    startBlock,\n    endBlock,\n    selection: {\n      start: { offset: startOffset, key: startKey },\n      end: { offset: endOffset, key: endKey },\n    },\n  } = editor.value;\n\n  const first = startBlock.getFirstText();\n\n  const startBlockIsSelected =\n    first && startOffset === 0 && startKey === first.key && endOffset === first.text.length && endKey === first.key;\n\n  if (startBlockIsSelected || !startBlock.equals(endBlock)) {\n    handleIndent(editor, 'right');\n  } else {\n    editor.insertText(SLATE_TAB);\n  }\n};\n\nconst handleIndent = (editor: CoreEditor, indentDirection: 'left' | 'right') => {\n  const curSelection = editor.value.selection;\n  const selectedBlocks = editor.value.document.getLeafBlocksAtRange(curSelection).toArray();\n\n  if (indentDirection === 'left') {\n    for (const block of selectedBlocks) {\n      const blockWhitespace = block.text.length - block.text.trimLeft().length;\n\n      const textKey = block.getFirstText()!.key;\n\n      const rangeProperties: RangeJSON = {\n        anchor: {\n          key: textKey,\n          offset: blockWhitespace,\n          path: [],\n        },\n        focus: {\n          key: textKey,\n          offset: blockWhitespace,\n          path: [],\n        },\n      };\n\n      editor.deleteBackwardAtRange(SlateRange.create(rangeProperties), Math.min(SLATE_TAB.length, blockWhitespace));\n    }\n  } else {\n    const { startText } = editor.value;\n    const textBeforeCaret = startText.text.slice(0, curSelection.start.offset);\n    const isWhiteSpace = /^\\s*$/.test(textBeforeCaret);\n\n    for (const block of selectedBlocks) {\n      editor.insertTextByKey(block.getFirstText()!.key, 0, SLATE_TAB);\n    }\n\n    if (isWhiteSpace) {\n      editor.moveStartBackward(SLATE_TAB.length);\n    }\n  }\n};\n\n// Clears the rest of the line after the caret\nexport function IndentationPlugin(): Plugin {\n  return {\n    onKeyDown(event: Event, editor: CoreEditor, next: Function) {\n      const keyEvent = event as KeyboardEvent;\n      if (isIndentLeftHotkey(keyEvent) || isShiftTabHotkey(keyEvent)) {\n        keyEvent.preventDefault();\n        handleIndent(editor, 'left');\n      } else if (isIndentRightHotkey(keyEvent)) {\n        keyEvent.preventDefault();\n        handleIndent(editor, 'right');\n      } else if (keyEvent.key === 'Tab') {\n        keyEvent.preventDefault();\n        handleTabKey(keyEvent, editor, next);\n      } else {\n        return next();\n      }\n\n      return true;\n    },\n  };\n}\n","export { BracesPlugin } from './braces';\r\nexport { ClearPlugin } from './clear';\r\nexport { ClipboardPlugin } from './clipboard';\r\nexport { IndentationPlugin } from './indentation';\r\nexport { NewlinePlugin } from './newline';\r\nexport { RunnerPlugin } from './runner';\r\nexport { SelectionShortcutsPlugin } from './selection_shortcuts';\r\nexport { SlatePrism } from './slate-prism';\r\nexport { SuggestionsPlugin } from './suggestions';\r\n","import { Plugin } from '@grafana/slate-react';\r\nimport { Editor as CoreEditor } from 'slate';\r\n\r\nfunction getIndent(text: string) {\r\n  let offset = text.length - text.trimLeft().length;\r\n  if (offset) {\r\n    let indent = text[0];\r\n    while (--offset) {\r\n      indent += text[0];\r\n    }\r\n    return indent;\r\n  }\r\n  return '';\r\n}\r\n\r\nexport function NewlinePlugin(): Plugin {\r\n  return {\r\n    onKeyDown(event: Event, editor: CoreEditor, next: Function) {\r\n      const keyEvent = event as KeyboardEvent;\r\n      const value = editor.value;\r\n\r\n      if (value.selection.isExpanded) {\r\n        return next();\r\n      }\r\n\r\n      if (keyEvent.key === 'Enter' && keyEvent.shiftKey) {\r\n        keyEvent.preventDefault();\r\n\r\n        const { startBlock } = value;\r\n        const currentLineText = startBlock.text;\r\n        const indent = getIndent(currentLineText);\r\n\r\n        return editor\r\n          .splitBlock()\r\n          .insertText(indent)\r\n          .focus();\r\n      }\r\n\r\n      return next();\r\n    },\r\n  };\r\n}\r\n","import { Plugin } from '@grafana/slate-react';\r\nimport { Editor as CoreEditor } from 'slate';\r\n\r\nexport function RunnerPlugin({ handler }: any): Plugin {\r\n  return {\r\n    onKeyDown(event: Event, editor: CoreEditor, next: Function) {\r\n      const keyEvent = event as KeyboardEvent;\r\n\r\n      // Handle enter\r\n      if (handler && keyEvent.key === 'Enter' && !keyEvent.shiftKey) {\r\n        // Submit on Enter\r\n        keyEvent.preventDefault();\r\n        handler(keyEvent);\r\n        return true;\r\n      }\r\n\r\n      return next();\r\n    },\r\n  };\r\n}\r\n","import { Plugin } from '@grafana/slate-react';\nimport { Editor as CoreEditor } from 'slate';\n\nimport { isKeyHotkey } from 'is-hotkey';\n\nconst isSelectLineHotkey = isKeyHotkey('mod+l');\n\n// Clears the rest of the line after the caret\nexport function SelectionShortcutsPlugin(): Plugin {\n  return {\n    onKeyDown(event: Event, editor: CoreEditor, next: () => any) {\n      const keyEvent = event as KeyboardEvent;\n      if (isSelectLineHotkey(keyEvent)) {\n        keyEvent.preventDefault();\n        const { focusBlock, document } = editor.value;\n\n        editor.moveAnchorToStartOfBlock();\n\n        const nextBlock = document.getNextBlock(focusBlock.key);\n        if (nextBlock) {\n          editor.moveFocusToStartOfNextBlock();\n        } else {\n          editor.moveFocusToEndOfText();\n        }\n      } else {\n        return next();\n      }\n\n      return true;\n    },\n  };\n}\n","const TOKEN_MARK = 'prism-token';\n\nexport default TOKEN_MARK;\n","import Prism from 'prismjs';\r\nimport { Block, Text, Decoration } from 'slate';\r\nimport { Plugin } from '@grafana/slate-react';\r\nimport Options, { OptionsFormat } from './options';\r\nimport TOKEN_MARK from './TOKEN_MARK';\r\n\r\n/**\r\n * A Slate plugin to highlight code syntax.\r\n */\r\nexport function SlatePrism(optsParam: OptionsFormat = {}): Plugin {\r\n  const opts: Options = new Options(optsParam);\r\n\r\n  return {\r\n    decorateNode: (node, editor, next) => {\r\n      if (!opts.onlyIn(node)) {\r\n        return next();\r\n      }\r\n      return decorateNode(opts, Block.create(node as Block));\r\n    },\r\n\r\n    renderDecoration: (props, editor, next) =>\r\n      opts.renderDecoration(\r\n        {\r\n          children: props.children,\r\n          decoration: props.decoration,\r\n        },\r\n        editor as any,\r\n        next\r\n      ),\r\n  };\r\n}\r\n\r\n/**\r\n * Returns the decoration for a node\r\n */\r\nfunction decorateNode(opts: Options, block: Block) {\r\n  const grammarName = opts.getSyntax(block);\r\n  const grammar = Prism.languages[grammarName];\r\n  if (!grammar) {\r\n    // Grammar not loaded\r\n    return [];\r\n  }\r\n\r\n  // Tokenize the whole block text\r\n  const texts = block.getTexts();\r\n  const blockText = texts.map(text => text && text.getText()).join('\\n');\r\n  const tokens = Prism.tokenize(blockText, grammar);\r\n\r\n  // The list of decorations to return\r\n  const decorations: Decoration[] = [];\r\n  let textStart = 0;\r\n  let textEnd = 0;\r\n\r\n  texts.forEach(text => {\r\n    textEnd = textStart + text!.getText().length;\r\n\r\n    let offset = 0;\r\n    function processToken(token: string | Prism.Token, accu?: string | number) {\r\n      if (typeof token === 'string') {\r\n        if (accu) {\r\n          const decoration = createDecoration({\r\n            text: text!,\r\n            textStart,\r\n            textEnd,\r\n            start: offset,\r\n            end: offset + token.length,\r\n            className: `prism-token token ${accu}`,\r\n            block,\r\n          });\r\n          if (decoration) {\r\n            decorations.push(decoration);\r\n          }\r\n        }\r\n        offset += token.length;\r\n      } else {\r\n        accu = `${accu} ${token.type} ${token.alias || ''}`;\r\n\r\n        if (typeof token.content === 'string') {\r\n          const decoration = createDecoration({\r\n            text: text!,\r\n            textStart,\r\n            textEnd,\r\n            start: offset,\r\n            end: offset + token.content.length,\r\n            className: `prism-token token ${accu}`,\r\n            block,\r\n          });\r\n          if (decoration) {\r\n            decorations.push(decoration);\r\n          }\r\n\r\n          offset += token.content.length;\r\n        } else {\r\n          // When using token.content instead of token.matchedStr, token can be deep\r\n          for (let i = 0; i < token.content.length; i += 1) {\r\n            // @ts-ignore\r\n            processToken(token.content[i], accu);\r\n          }\r\n        }\r\n      }\r\n    }\r\n\r\n    tokens.forEach(processToken);\r\n    textStart = textEnd + 1; // account for added `\\n`\r\n  });\r\n\r\n  return decorations;\r\n}\r\n\r\n/**\r\n * Return a decoration range for the given text.\r\n */\r\nfunction createDecoration({\r\n  text,\r\n  textStart,\r\n  textEnd,\r\n  start,\r\n  end,\r\n  className,\r\n  block,\r\n}: {\r\n  text: Text; // The text being decorated\r\n  textStart: number; // Its start position in the whole text\r\n  textEnd: number; // Its end position in the whole text\r\n  start: number; // The position in the whole text where the token starts\r\n  end: number; // The position in the whole text where the token ends\r\n  className: string; // The prism token classname\r\n  block: Block;\r\n}): Decoration | null {\r\n  if (start >= textEnd || end <= textStart) {\r\n    // Ignore, the token is not in the text\r\n    return null;\r\n  }\r\n\r\n  // Shrink to this text boundaries\r\n  start = Math.max(start, textStart);\r\n  end = Math.min(end, textEnd);\r\n\r\n  // Now shift offsets to be relative to this text\r\n  start -= textStart;\r\n  end -= textStart;\r\n\r\n  const myDec = block.createDecoration({\r\n    object: 'decoration',\r\n    anchor: {\r\n      key: text.key,\r\n      offset: start,\r\n      object: 'point',\r\n    },\r\n    focus: {\r\n      key: text.key,\r\n      offset: end,\r\n      object: 'point',\r\n    },\r\n    type: TOKEN_MARK,\r\n    data: { className },\r\n  });\r\n\r\n  return myDec;\r\n}\r\n","import React from 'react';\r\nimport { Mark, Node, Decoration } from 'slate';\r\nimport { Editor } from '@grafana/slate-react';\r\nimport { Record } from 'immutable';\r\n\r\nimport TOKEN_MARK from './TOKEN_MARK';\r\n\r\nexport interface OptionsFormat {\r\n  // Determine which node should be highlighted\r\n  onlyIn?: (node: Node) => boolean;\r\n  // Returns the syntax for a node that should be highlighted\r\n  getSyntax?: (node: Node) => string;\r\n  // Render a highlighting mark in a highlighted node\r\n  renderMark?: ({ mark, children }: { mark: Mark; children: React.ReactNode }) => void | React.ReactNode;\r\n}\r\n\r\n/**\r\n * Default filter for code blocks\r\n */\r\nfunction defaultOnlyIn(node: Node): boolean {\r\n  return node.object === 'block' && node.type === 'code_block';\r\n}\r\n\r\n/**\r\n * Default getter for syntax\r\n */\r\nfunction defaultGetSyntax(node: Node): string {\r\n  return 'javascript';\r\n}\r\n\r\n/**\r\n * Default rendering for decorations\r\n */\r\nfunction defaultRenderDecoration(\r\n  props: { children: React.ReactNode; decoration: Decoration },\r\n  editor: Editor,\r\n  next: () => any\r\n): void | React.ReactNode {\r\n  const { decoration } = props;\r\n  if (decoration.type !== TOKEN_MARK) {\r\n    return next();\r\n  }\r\n\r\n  const className = decoration.data.get('className');\r\n  return <span className={className}>{props.children}</span>;\r\n}\r\n\r\n/**\r\n * The plugin options\r\n */\r\nclass Options\r\n  extends Record({\r\n    onlyIn: defaultOnlyIn,\r\n    getSyntax: defaultGetSyntax,\r\n    renderDecoration: defaultRenderDecoration,\r\n  })\r\n  implements OptionsFormat {\r\n  readonly onlyIn!: (node: Node) => boolean;\r\n  readonly getSyntax!: (node: Node) => string;\r\n  readonly renderDecoration!: (\r\n    {\r\n      decoration,\r\n      children,\r\n    }: {\r\n      decoration: Decoration;\r\n      children: React.ReactNode;\r\n    },\r\n    editor: Editor,\r\n    next: () => any\r\n  ) => void | React.ReactNode;\r\n\r\n  constructor(props: OptionsFormat) {\r\n    super(props);\r\n  }\r\n}\r\n\r\nexport default Options;\r\n","import React from 'react';\r\nimport debounce from 'lodash/debounce';\r\nimport sortBy from 'lodash/sortBy';\r\n\r\nimport { Editor as CoreEditor } from 'slate';\r\nimport { Plugin as SlatePlugin } from '@grafana/slate-react';\r\n\r\nimport TOKEN_MARK from './slate-prism/TOKEN_MARK';\r\nimport { Typeahead } from '../components/Typeahead/Typeahead';\r\nimport { CompletionItem, TypeaheadOutput, TypeaheadInput, SuggestionsState } from '../types/completion';\r\nimport { makeFragment } from '../utils/slate';\r\n\r\nexport const TYPEAHEAD_DEBOUNCE = 250;\r\n\r\n// Commands added to the editor by this plugin.\r\ninterface SuggestionsPluginCommands {\r\n  selectSuggestion: (suggestion: CompletionItem) => CoreEditor;\r\n  applyTypeahead: (suggestion: CompletionItem) => CoreEditor;\r\n}\r\n\r\nexport function SuggestionsPlugin({\r\n  onTypeahead,\r\n  cleanText,\r\n  onWillApplySuggestion,\r\n  portalOrigin,\r\n}: {\r\n  onTypeahead?: (typeahead: TypeaheadInput) => Promise<TypeaheadOutput>;\r\n  cleanText?: (text: string) => string;\r\n  onWillApplySuggestion?: (suggestion: string, state: SuggestionsState) => string;\r\n  portalOrigin: string;\r\n}): SlatePlugin {\r\n  let typeaheadRef: Typeahead;\r\n  let state: SuggestionsState = {\r\n    groupedItems: [],\r\n    typeaheadPrefix: '',\r\n    typeaheadContext: '',\r\n    typeaheadText: '',\r\n  };\r\n  const handleTypeaheadDebounced = debounce(handleTypeahead, TYPEAHEAD_DEBOUNCE);\r\n\r\n  const setState = (update: Partial<SuggestionsState>) => {\r\n    state = {\r\n      ...state,\r\n      ...update,\r\n    };\r\n  };\r\n\r\n  return {\r\n    onBlur: (event, editor, next) => {\r\n      state = {\r\n        ...state,\r\n        groupedItems: [],\r\n      };\r\n\r\n      return next();\r\n    },\r\n\r\n    onClick: (event, editor, next) => {\r\n      state = {\r\n        ...state,\r\n        groupedItems: [],\r\n      };\r\n\r\n      return next();\r\n    },\r\n\r\n    onKeyDown: (event: Event, editor, next) => {\r\n      const keyEvent = event as KeyboardEvent;\r\n      const currentSuggestions = state.groupedItems;\r\n\r\n      const hasSuggestions = currentSuggestions.length;\r\n\r\n      switch (keyEvent.key) {\r\n        case 'Escape': {\r\n          if (hasSuggestions) {\r\n            keyEvent.preventDefault();\r\n\r\n            state = {\r\n              ...state,\r\n              groupedItems: [],\r\n            };\r\n\r\n            // Bogus edit to re-render editor\r\n            return editor.insertText('');\r\n          }\r\n\r\n          break;\r\n        }\r\n\r\n        case 'ArrowDown':\r\n        case 'ArrowUp':\r\n          if (hasSuggestions) {\r\n            keyEvent.preventDefault();\r\n            typeaheadRef.moveMenuIndex(keyEvent.key === 'ArrowDown' ? 1 : -1);\r\n            return;\r\n          }\r\n\r\n          break;\r\n\r\n        case 'Enter':\r\n        case 'Tab': {\r\n          if (hasSuggestions) {\r\n            keyEvent.preventDefault();\r\n            return typeaheadRef.insertSuggestion();\r\n          }\r\n\r\n          break;\r\n        }\r\n\r\n        default: {\r\n          handleTypeaheadDebounced(editor, setState, onTypeahead, cleanText);\r\n          break;\r\n        }\r\n      }\r\n\r\n      return next();\r\n    },\r\n\r\n    commands: {\r\n      selectSuggestion: (editor: CoreEditor, suggestion: CompletionItem): CoreEditor => {\r\n        const suggestions = state.groupedItems;\r\n        if (!suggestions || !suggestions.length) {\r\n          return editor;\r\n        }\r\n\r\n        // @ts-ignore\r\n        const ed = editor.applyTypeahead(suggestion);\r\n        handleTypeaheadDebounced(editor, setState, onTypeahead, cleanText);\r\n        return ed;\r\n      },\r\n\r\n      applyTypeahead: (editor: CoreEditor, suggestion: CompletionItem): CoreEditor => {\r\n        let suggestionText = suggestion.insertText || suggestion.label;\r\n\r\n        const preserveSuffix = suggestion.kind === 'function';\r\n        const move = suggestion.move || 0;\r\n\r\n        const { typeaheadPrefix, typeaheadText, typeaheadContext } = state;\r\n\r\n        if (onWillApplySuggestion) {\r\n          suggestionText = onWillApplySuggestion(suggestionText, {\r\n            groupedItems: state.groupedItems,\r\n            typeaheadContext,\r\n            typeaheadPrefix,\r\n            typeaheadText,\r\n          });\r\n        }\r\n\r\n        // Remove the current, incomplete text and replace it with the selected suggestion\r\n        const backward = suggestion.deleteBackwards || typeaheadPrefix.length;\r\n        const text = cleanText ? cleanText(typeaheadText) : typeaheadText;\r\n        const suffixLength = text.length - typeaheadPrefix.length;\r\n        const offset = typeaheadText.indexOf(typeaheadPrefix);\r\n        const midWord = typeaheadPrefix && ((suffixLength > 0 && offset > -1) || suggestionText === typeaheadText);\r\n        const forward = midWord && !preserveSuffix ? suffixLength + offset : 0;\r\n\r\n        // If new-lines, apply suggestion as block\r\n        if (suggestionText.match(/\\n/)) {\r\n          const fragment = makeFragment(suggestionText);\r\n          return editor\r\n            .deleteBackward(backward)\r\n            .deleteForward(forward)\r\n            .insertFragment(fragment)\r\n            .focus();\r\n        }\r\n\r\n        state = {\r\n          ...state,\r\n          groupedItems: [],\r\n        };\r\n\r\n        return editor\r\n          .deleteBackward(backward)\r\n          .deleteForward(forward)\r\n          .insertText(suggestionText)\r\n          .moveForward(move)\r\n          .focus();\r\n      },\r\n    },\r\n\r\n    renderEditor: (props, editor, next) => {\r\n      if (editor.value.selection.isExpanded) {\r\n        return next();\r\n      }\r\n\r\n      const children = next();\r\n\r\n      return (\r\n        <>\r\n          {children}\r\n          <Typeahead\r\n            menuRef={(menu: Typeahead) => (typeaheadRef = menu)}\r\n            origin={portalOrigin}\r\n            prefix={state.typeaheadPrefix}\r\n            isOpen={!!state.groupedItems.length}\r\n            groupedItems={state.groupedItems}\r\n            onSelectSuggestion={(editor as CoreEditor & SuggestionsPluginCommands).selectSuggestion}\r\n          />\r\n        </>\r\n      );\r\n    },\r\n  };\r\n}\r\n\r\nconst handleTypeahead = async (\r\n  editor: CoreEditor,\r\n  onStateChange: (state: Partial<SuggestionsState>) => void,\r\n  onTypeahead?: (typeahead: TypeaheadInput) => Promise<TypeaheadOutput>,\r\n  cleanText?: (text: string) => string\r\n): Promise<void> => {\r\n  if (!onTypeahead) {\r\n    return;\r\n  }\r\n\r\n  const { value } = editor;\r\n  const { selection } = value;\r\n\r\n  // Get decorations associated with the current line\r\n  const parentBlock = value.document.getClosestBlock(value.focusBlock.key);\r\n  const myOffset = value.selection.start.offset - 1;\r\n  const decorations = parentBlock && parentBlock.getDecorations(editor as any);\r\n\r\n  const filteredDecorations = decorations\r\n    ? decorations\r\n        .filter(\r\n          decoration =>\r\n            decoration!.start.offset <= myOffset && decoration!.end.offset > myOffset && decoration!.type === TOKEN_MARK\r\n        )\r\n        .toArray()\r\n    : [];\r\n\r\n  // Find the first label key to the left of the cursor\r\n  const labelKeyDec =\r\n    decorations &&\r\n    decorations\r\n      .filter(\r\n        decoration =>\r\n          decoration!.end.offset <= myOffset &&\r\n          decoration!.type === TOKEN_MARK &&\r\n          decoration!.data.get('className').includes('label-key')\r\n      )\r\n      .last();\r\n\r\n  const labelKey = labelKeyDec && value.focusText.text.slice(labelKeyDec.start.offset, labelKeyDec.end.offset);\r\n\r\n  const wrapperClasses = filteredDecorations\r\n    .map(decoration => decoration.data.get('className'))\r\n    .join(' ')\r\n    .split(' ')\r\n    .filter(className => className.length);\r\n\r\n  let text = value.focusText.text;\r\n  let prefix = text.slice(0, selection.focus.offset);\r\n\r\n  if (filteredDecorations.length) {\r\n    text = value.focusText.text.slice(filteredDecorations[0].start.offset, filteredDecorations[0].end.offset);\r\n    prefix = value.focusText.text.slice(filteredDecorations[0].start.offset, selection.focus.offset);\r\n  }\r\n\r\n  // Label values could have valid characters erased if `cleanText()` is\r\n  // blindly applied, which would undesirably interfere with suggestions\r\n  const labelValueMatch = prefix.match(/(?:!?=~?\"?|\")(.*)/);\r\n  if (labelValueMatch) {\r\n    prefix = labelValueMatch[1];\r\n  } else if (cleanText) {\r\n    prefix = cleanText(prefix);\r\n  }\r\n\r\n  const { suggestions, context } = await onTypeahead({\r\n    prefix,\r\n    text,\r\n    value,\r\n    wrapperClasses,\r\n    labelKey: labelKey || undefined,\r\n  });\r\n\r\n  const filteredSuggestions = suggestions\r\n    .map(group => {\r\n      if (!group.items) {\r\n        return group;\r\n      }\r\n\r\n      if (prefix) {\r\n        // Filter groups based on prefix\r\n        if (!group.skipFilter) {\r\n          group.items = group.items.filter(c => (c.filterText || c.label).length >= prefix.length);\r\n          if (group.prefixMatch) {\r\n            group.items = group.items.filter(c => (c.filterText || c.label).startsWith(prefix));\r\n          } else {\r\n            group.items = group.items.filter(c => (c.filterText || c.label).includes(prefix));\r\n          }\r\n        }\r\n\r\n        // Filter out the already typed value (prefix) unless it inserts custom text\r\n        group.items = group.items.filter(c => c.insertText || (c.filterText || c.label) !== prefix);\r\n      }\r\n\r\n      if (!group.skipSort) {\r\n        group.items = sortBy(group.items, (item: CompletionItem) => item.sortText || item.label);\r\n      }\r\n\r\n      return group;\r\n    })\r\n    .filter(group => group.items && group.items.length); // Filter out empty groups\r\n\r\n  onStateChange({\r\n    groupedItems: filteredSuggestions,\r\n    typeaheadPrefix: prefix,\r\n    typeaheadContext: context,\r\n    typeaheadText: text,\r\n  });\r\n\r\n  // Bogus edit to force re-render\r\n  editor.blur().focus();\r\n};\r\n","import React, { useContext } from 'react';\r\nimport hoistNonReactStatics from 'hoist-non-react-statics';\r\n\r\nimport { getTheme } from './getTheme';\r\nimport { Themeable } from '../types/theme';\r\nimport { GrafanaTheme, GrafanaThemeType } from '@grafana/data';\r\n\r\ntype Omit<T, K> = Pick<T, Exclude<keyof T, K>>;\r\ntype Subtract<T, K> = Omit<T, keyof K>;\r\n\r\n/**\r\n * Mock used in tests\r\n */\r\nlet ThemeContextMock: React.Context<GrafanaTheme> | null = null;\r\n\r\n// Use Grafana Dark theme by default\r\nexport const ThemeContext = React.createContext(getTheme(GrafanaThemeType.Dark));\r\nThemeContext.displayName = 'ThemeContext';\r\n\r\nexport const withTheme = <P extends Themeable, S extends {} = {}>(Component: React.ComponentType<P>) => {\r\n  const WithTheme: React.FunctionComponent<Subtract<P, Themeable>> = props => {\r\n    /**\r\n     * If theme context is mocked, let's use it instead of the original context\r\n     * This is used in tests when mocking theme using mockThemeContext function defined below\r\n     */\r\n    const ContextComponent = ThemeContextMock || ThemeContext;\r\n    // @ts-ignore\r\n    return <ContextComponent.Consumer>{theme => <Component {...props} theme={theme} />}</ContextComponent.Consumer>;\r\n  };\r\n\r\n  WithTheme.displayName = `WithTheme(${Component.displayName})`;\r\n  hoistNonReactStatics(WithTheme, Component);\r\n  type Hoisted = typeof WithTheme & S;\r\n  return WithTheme as Hoisted;\r\n};\r\n\r\nexport function useTheme() {\r\n  return useContext(ThemeContextMock || ThemeContext);\r\n}\r\n\r\n/**\r\n * Enables theme context  mocking\r\n */\r\nexport const mockThemeContext = (theme: Partial<GrafanaTheme>) => {\r\n  ThemeContextMock = React.createContext(theme as GrafanaTheme);\r\n  return () => {\r\n    ThemeContextMock = null;\r\n  };\r\n};\r\n","import defaultTheme, { commonColorsPalette } from './default';\r\nimport { GrafanaThemeType, GrafanaTheme } from '@grafana/data';\r\n\r\nconst basicColors = {\r\n  ...commonColorsPalette,\r\n  black: '#000000',\r\n  white: '#ffffff',\r\n  dark1: '#141414',\r\n  dark2: '#161719',\r\n  dark3: '#1f1f20',\r\n  dark4: '#212124',\r\n  dark5: '#222426',\r\n  dark6: '#262628',\r\n  dark7: '#292a2d',\r\n  dark8: '#2f2f32',\r\n  dark9: '#343436',\r\n  dark10: '#424345',\r\n  gray1: '#555555',\r\n  gray2: '#8e8e8e',\r\n  gray3: '#b3b3b3',\r\n  gray4: '#d8d9da',\r\n  gray5: '#ececec',\r\n  gray6: '#f4f5f8', // not used in dark theme\r\n  gray7: '#fbfbfb', // not used in dark theme\r\n  grayBlue: '#212327',\r\n  blueBase: '#3274d9',\r\n  blueShade: '#1f60c4',\r\n  blueLight: '#5794f2',\r\n  blueFaint: '#041126',\r\n  redBase: '#e02f44',\r\n  redShade: '#c4162a',\r\n  greenBase: '#299c46',\r\n  greenShade: '#23843b',\r\n  blue: '#33b5e5',\r\n  red: '#d44a3a',\r\n  yellow: '#ecbb13',\r\n  purple: '#9933cc',\r\n  variable: '#32d1df',\r\n  orange: '#eb7b18',\r\n  orangeDark: '#ff780a',\r\n};\r\n\r\nconst darkTheme: GrafanaTheme = {\r\n  ...defaultTheme,\r\n  type: GrafanaThemeType.Dark,\r\n  isDark: true,\r\n  isLight: false,\r\n  name: 'Grafana Dark',\r\n  colors: {\r\n    ...basicColors,\r\n    inputBlack: '#09090b',\r\n    brandPrimary: basicColors.orange,\r\n    brandSuccess: basicColors.greenBase,\r\n    brandWarning: basicColors.orange,\r\n    brandDanger: basicColors.redBase,\r\n    queryRed: basicColors.redBase,\r\n    queryGreen: '#74e680',\r\n    queryPurple: '#fe85fc',\r\n    queryKeyword: '#66d9ef',\r\n    queryOrange: basicColors.orange,\r\n    online: basicColors.greenBase,\r\n    warn: '#f79520',\r\n    critical: basicColors.redBase,\r\n    bodyBg: basicColors.dark2,\r\n    pageBg: basicColors.dark2,\r\n    body: basicColors.gray4,\r\n    text: basicColors.gray4,\r\n    textStrong: basicColors.white,\r\n    textWeak: basicColors.gray2,\r\n    textEmphasis: basicColors.gray5,\r\n    textFaint: basicColors.dark5,\r\n    link: basicColors.gray4,\r\n    linkDisabled: basicColors.gray2,\r\n    linkHover: basicColors.white,\r\n    linkExternal: basicColors.blue,\r\n    headingColor: basicColors.gray4,\r\n    pageHeaderBorder: basicColors.dark9,\r\n    panelBg: basicColors.dark4,\r\n\r\n    // Next-gen forms functional colors\r\n    formLabel: basicColors.gray70,\r\n    formDescription: basicColors.gray70,\r\n    formLegend: basicColors.gray85,\r\n    formInputBg: basicColors.gray15,\r\n    formInputBgDisabled: basicColors.gray10,\r\n    formInputBorder: basicColors.gray25,\r\n    formInputBorderHover: basicColors.gray33,\r\n    formInputBorderActive: basicColors.blue95,\r\n    formInputBorderInvalid: basicColors.red88,\r\n    formInputText: basicColors.gray85,\r\n    formInputDisabledText: basicColors.gray70,\r\n    formInputTextStrong: basicColors.gray85,\r\n    formInputTextWhite: basicColors.white,\r\n    formFocusOutline: basicColors.blueShade,\r\n    formValidationMessageText: basicColors.white,\r\n    formValidationMessageBg: basicColors.red88,\r\n    formSwitchBg: basicColors.gray25,\r\n    formSwitchBgActive: basicColors.blueLight,\r\n    formSwitchBgHover: basicColors.gray33,\r\n    formSwitchBgActiveHover: basicColors.blueBase,\r\n    formSwitchBgDisabled: basicColors.gray25,\r\n    formSwitchDot: basicColors.gray15,\r\n    formCheckboxBg: basicColors.dark5,\r\n    formCheckboxBgChecked: basicColors.blueLight,\r\n    formCheckboxBgCheckedHover: basicColors.blueBase,\r\n    formCheckboxCheckmark: basicColors.gray25,\r\n  },\r\n  background: {\r\n    dropdown: basicColors.dark3,\r\n    scrollbar: basicColors.dark9,\r\n    scrollbar2: basicColors.dark9,\r\n    pageHeader: `linear-gradient(90deg, ${basicColors.dark7}, ${basicColors.black})`,\r\n  },\r\n  shadow: {\r\n    pageHeader: `inset 0px -4px 14px ${basicColors.dark3}`,\r\n  },\r\n};\r\n\r\nexport default darkTheme;\r\n","import { GrafanaThemeCommons } from '@grafana/data';\r\n\r\nexport const commonColorsPalette = {\r\n  // New greys palette used by next-gen form elements\r\n  gray98: '#f7f8fa',\r\n  gray95: '#e9edf2',\r\n  gray85: '#c7d0d9',\r\n  gray70: '#9fa7b3',\r\n  gray33: '#464c54',\r\n  gray25: '#343b40',\r\n  gray15: '#202226',\r\n  gray10: '#141619',\r\n  gray05: '#0b0c0e',\r\n\r\n  // New blues palette used by next-gen form elements\r\n  blue95: '#5794f2',\r\n  blue85: '#3274d9',\r\n  blue77: '#1f60c4',\r\n\r\n  // New reds palette used by next-gen form elements\r\n  red88: '#e02f44',\r\n};\r\n\r\nconst SPACING_BASE = 8;\r\n\r\nconst theme: GrafanaThemeCommons = {\r\n  name: 'Grafana Default',\r\n  typography: {\r\n    fontFamily: {\r\n      sansSerif: \"'Roboto', 'Helvetica Neue', Arial, sans-serif\",\r\n      monospace: \"Menlo, Monaco, Consolas, 'Courier New', monospace\",\r\n    },\r\n    size: {\r\n      base: '14px',\r\n      xs: '10px',\r\n      sm: '12px',\r\n      md: '14px',\r\n      lg: '18px',\r\n    },\r\n    heading: {\r\n      h1: '28px',\r\n      h2: '24px',\r\n      h3: '21px',\r\n      h4: '18px',\r\n      h5: '16px',\r\n      h6: '14px',\r\n    },\r\n    weight: {\r\n      light: 300,\r\n      regular: 400,\r\n      semibold: 500,\r\n      bold: 600,\r\n    },\r\n    lineHeight: {\r\n      xs: 1,\r\n      sm: 1.1,\r\n      md: 1.5,\r\n      lg: 2,\r\n    },\r\n    link: {\r\n      decoration: 'none',\r\n      hoverDecoration: 'none',\r\n    },\r\n  },\r\n  breakpoints: {\r\n    xs: '0',\r\n    sm: '544px',\r\n    md: '769px', // 1 more than regular ipad in portrait\r\n    lg: '992px',\r\n    xl: '1200px',\r\n  },\r\n  spacing: {\r\n    insetSquishMd: '4px 8px',\r\n    d: '14px',\r\n    xxs: '2px',\r\n    xs: '4px',\r\n    sm: '8px',\r\n    md: '16px',\r\n    lg: '24px',\r\n    xl: '32px',\r\n    gutter: '30px',\r\n\r\n    // Next-gen forms spacing variables\r\n    // TODO: Move variables definition to respective components when implementing\r\n    formSpacingBase: SPACING_BASE,\r\n    formMargin: `${SPACING_BASE * 4}px`,\r\n    formFieldsetMargin: `${SPACING_BASE * 2}px`,\r\n    formLegendMargin: `0 0 ${SPACING_BASE * 2}px 0`,\r\n    formInputHeight: `${SPACING_BASE * 4}px`,\r\n    formButtonHeight: SPACING_BASE * 4,\r\n    formInputPaddingHorizontal: `${SPACING_BASE}px`,\r\n\r\n    // Used for icons do define spacing between icon and input field\r\n    // Applied on the right(prefix) or left(suffix)\r\n    formInputAffixPaddingHorizontal: `${SPACING_BASE / 2}px`,\r\n\r\n    formInputMargin: `${SPACING_BASE * 2}px`,\r\n    formLabelPadding: '0 0 0 2px',\r\n    formLabelMargin: `0 0 ${SPACING_BASE / 2 + 'px'} 0`,\r\n    formValidationMessagePadding: '4px 8px',\r\n    formValidationMessageMargin: '4px 0 0 0',\r\n  },\r\n  border: {\r\n    radius: {\r\n      sm: '2px',\r\n      md: '3px',\r\n      lg: '5px',\r\n    },\r\n    width: {\r\n      sm: '1px',\r\n    },\r\n  },\r\n  height: {\r\n    sm: '24px',\r\n    md: '32px',\r\n    lg: '48px',\r\n  },\r\n  panelPadding: 8,\r\n  panelHeaderHeight: 28,\r\n  zIndex: {\r\n    dropdown: '1000',\r\n    navbarFixed: '1020',\r\n    sidemenu: '1025',\r\n    tooltip: '1030',\r\n    modalBackdrop: '1040',\r\n    modal: '1050',\r\n    typeahead: '1060',\r\n  },\r\n};\r\n\r\nexport default theme;\r\n","import darkTheme from './dark';\r\nimport lightTheme from './light';\r\nimport { GrafanaTheme } from '@grafana/data';\r\n\r\nlet themeMock: ((name?: string) => GrafanaTheme) | null;\r\n\r\nexport const getTheme = (name?: string) =>\r\n  (themeMock && themeMock(name)) || (name === 'light' ? lightTheme : darkTheme);\r\n\r\nexport const mockTheme = (mock: (name?: string) => GrafanaTheme) => {\r\n  themeMock = mock;\r\n  return () => {\r\n    themeMock = null;\r\n  };\r\n};\r\n","import { ThemeContext, withTheme, useTheme, mockThemeContext } from './ThemeContext';\r\nimport { getTheme, mockTheme } from './getTheme';\r\nimport { selectThemeVariant } from './selectThemeVariant';\r\nexport { stylesFactory } from './stylesFactory';\r\nexport { ThemeContext, withTheme, mockTheme, getTheme, selectThemeVariant, useTheme, mockThemeContext };\r\n\r\nimport * as styleMixins from './mixins';\r\nexport { styleMixins };\r\n","import defaultTheme, { commonColorsPalette } from './default';\r\nimport { GrafanaThemeType, GrafanaTheme } from '@grafana/data';\r\n\r\nconst basicColors = {\r\n  ...commonColorsPalette,\r\n  black: '#000000',\r\n  white: '#ffffff',\r\n  dark1: '#1e2028',\r\n  dark2: '#41444b',\r\n  dark3: '#303133', // not used in light theme\r\n  dark4: '#35373f', // not used in light theme\r\n  dark5: '#41444b', // not used in light theme\r\n  dark6: '#41444b', // not used in light theme\r\n  dark7: '#41444b', // not used in light theme\r\n  dark8: '#2f2f32', // not used in light theme\r\n  dark9: '#343436', // not used in light theme\r\n  dark10: '#424345', // not used in light theme\r\n  gray1: '#52545c',\r\n  gray2: '#767980',\r\n  gray3: '#acb6bf',\r\n  gray4: '#c7d0d9',\r\n  gray5: '#dde4ed',\r\n  gray6: '#e9edf2',\r\n  gray7: '#f7f8fa',\r\n  grayBlue: '#212327', // not used in light theme\r\n  blueBase: '#3274d9',\r\n  blueShade: '#1f60c4',\r\n  blueLight: '#5794f2',\r\n  blueFaint: '#f5f9ff',\r\n  redBase: '#e02f44',\r\n  redShade: '#c4162a',\r\n  greenBase: '#3eb15b',\r\n  greenShade: '#369b4f',\r\n  blue: '#0083b3',\r\n  red: '#d44939',\r\n  yellow: '#ff851b',\r\n  purple: '#9954bb',\r\n  variable: '#007580',\r\n  orange: '#ff7941',\r\n  orangeDark: '#ed5700',\r\n};\r\n\r\nconst lightTheme: GrafanaTheme = {\r\n  ...defaultTheme,\r\n  type: GrafanaThemeType.Light,\r\n  isDark: false,\r\n  isLight: true,\r\n  name: 'Grafana Light',\r\n  colors: {\r\n    ...basicColors,\r\n    variable: basicColors.blue,\r\n    inputBlack: '#09090b',\r\n    brandPrimary: basicColors.orange,\r\n    brandSuccess: basicColors.greenBase,\r\n    brandWarning: basicColors.orange,\r\n    brandDanger: basicColors.redBase,\r\n    queryRed: basicColors.redBase,\r\n    queryGreen: basicColors.greenBase,\r\n    queryPurple: basicColors.purple,\r\n    queryKeyword: basicColors.blueBase,\r\n    queryOrange: basicColors.orange,\r\n    online: basicColors.greenShade,\r\n    warn: '#f79520',\r\n    critical: basicColors.redShade,\r\n    bodyBg: basicColors.gray7,\r\n    pageBg: basicColors.gray7,\r\n\r\n    // Text colors\r\n    body: basicColors.gray1,\r\n    text: basicColors.gray1,\r\n    textStrong: basicColors.dark2,\r\n    textWeak: basicColors.gray2,\r\n    textEmphasis: basicColors.dark5,\r\n    textFaint: basicColors.dark4,\r\n\r\n    // Link colors\r\n    link: basicColors.gray1,\r\n    linkDisabled: basicColors.gray3,\r\n    linkHover: basicColors.dark1,\r\n    linkExternal: basicColors.blueLight,\r\n    headingColor: basicColors.gray1,\r\n    pageHeaderBorder: basicColors.gray4,\r\n\r\n    // panel\r\n    panelBg: basicColors.white,\r\n\r\n    // Next-gen forms functional colors\r\n    formLabel: basicColors.gray33,\r\n    formDescription: basicColors.gray33,\r\n    formLegend: basicColors.gray25,\r\n    formInputBg: basicColors.white,\r\n    formInputBgDisabled: basicColors.gray95,\r\n    formInputBorder: basicColors.gray85,\r\n    formInputBorderHover: basicColors.gray70,\r\n    formInputBorderActive: basicColors.blue77,\r\n    formInputBorderInvalid: basicColors.red88,\r\n    formInputText: basicColors.gray25,\r\n    formInputDisabledText: basicColors.gray33,\r\n    formInputTextStrong: basicColors.gray25,\r\n    formInputTextWhite: basicColors.white,\r\n    formFocusOutline: basicColors.blueLight,\r\n    formValidationMessageText: basicColors.white,\r\n    formValidationMessageBg: basicColors.red88,\r\n    formSwitchBg: basicColors.gray85,\r\n    formSwitchBgActive: basicColors.blueShade,\r\n    formSwitchBgHover: basicColors.gray3,\r\n    formSwitchBgActiveHover: basicColors.blueBase,\r\n    formSwitchBgDisabled: basicColors.gray4,\r\n    formSwitchDot: basicColors.white,\r\n    formCheckboxBg: basicColors.white,\r\n    formCheckboxBgChecked: basicColors.blueShade,\r\n    formCheckboxBgCheckedHover: basicColors.blueBase,\r\n    formCheckboxCheckmark: basicColors.white,\r\n  },\r\n  background: {\r\n    dropdown: basicColors.white,\r\n    scrollbar: basicColors.gray5,\r\n    scrollbar2: basicColors.gray5,\r\n    pageHeader: `linear-gradient(90deg, ${basicColors.white}, ${basicColors.gray7})`,\r\n  },\r\n  shadow: {\r\n    pageHeader: `inset 0px -3px 10px ${basicColors.gray6}`,\r\n  },\r\n};\r\n\r\nexport default lightTheme;\r\n","import { GrafanaTheme } from '@grafana/data';\r\n\r\nexport function cardChrome(theme: GrafanaTheme): string {\r\n  if (theme.isDark) {\r\n    return `\r\n       background: linear-gradient(135deg, ${theme.colors.dark8}, ${theme.colors.dark6});\r\n       &:hover {\r\n         background: linear-gradient(135deg, ${theme.colors.dark9}, ${theme.colors.dark6});\r\n       }\r\n       box-shadow: -1px -1px 0 0 hsla(0, 0%, 100%, 0.1), 1px 1px 0 0 rgba(0, 0, 0, 0.3);\r\n       border-radius: ${theme.border.radius.md};\r\n    `;\r\n  }\r\n\r\n  return `\r\n       background: linear-gradient(135deg, ${theme.colors.gray6}, ${theme.colors.gray7});\r\n       &:hover {\r\n         background: linear-gradient(135deg, ${theme.colors.gray7}, ${theme.colors.gray6});\r\n       }\r\n       box-shadow: -1px -1px 0 0 hsla(0, 0%, 100%, 0.1), 1px 1px 0 0 rgba(0, 0, 0, 0.1);\r\n       border-radius: ${theme.border.radius.md};\r\n    `;\r\n}\r\n\r\nexport function listItem(theme: GrafanaTheme): string {\r\n  if (theme.isDark) {\r\n    return `\r\n       background: ${theme.colors.dark7};\r\n       &:hover {\r\n         background: ${theme.colors.dark9};\r\n       }\r\n       box-shadow: -1px -1px 0 0 hsla(0, 0%, 100%, 0.1), 1px 1px 0 0 rgba(0, 0, 0, 0.3);\r\n       border-radius: ${theme.border.radius.md};\r\n    `;\r\n  }\r\n\r\n  return `\r\n       background: ${theme.colors.gray7};\r\n       &:hover {\r\n         background: ${theme.colors.gray6};\r\n       }\r\n       box-shadow: -1px -1px 0 0 hsla(0, 0%, 100%, 0.1), 1px 1px 0 0 rgba(0, 0, 0, 0.1);\r\n       border-radius: ${theme.border.radius.md};\r\n    `;\r\n}\r\n","import { GrafanaThemeType } from '@grafana/data';\r\n\r\ntype VariantDescriptor = { [key in GrafanaThemeType]: string | number };\r\n\r\nexport const selectThemeVariant = (variants: VariantDescriptor, currentTheme?: GrafanaThemeType) => {\r\n  return variants[currentTheme || GrafanaThemeType.Dark];\r\n};\r\n","import memoizeOne from 'memoize-one';\r\n// import { KeyValue } from '@grafana/data';\r\n\r\n/**\r\n *  Creates memoized version of styles creator\r\n * @param stylesCreator function accepting dependencies based on which styles are created\r\n */\r\nexport function stylesFactory<ResultFn extends (this: any, ...newArgs: any[]) => ReturnType<ResultFn>>(\r\n  stylesCreator: ResultFn\r\n) {\r\n  return memoizeOne(stylesCreator);\r\n}\r\n","import { Value } from 'slate';\r\nimport { Editor } from '@grafana/slate-react';\r\n\r\nexport interface CompletionItemGroup {\r\n  /**\r\n   * Label that will be displayed for all entries of this group.\r\n   */\r\n  label: string;\r\n\r\n  /**\r\n   * List of suggestions of this group.\r\n   */\r\n  items: CompletionItem[];\r\n\r\n  /**\r\n   * If true, match only by prefix (and not mid-word).\r\n   */\r\n  prefixMatch?: boolean;\r\n\r\n  /**\r\n   * If true, do not filter items in this group based on the search.\r\n   */\r\n  skipFilter?: boolean;\r\n\r\n  /**\r\n   * If true, do not sort items.\r\n   */\r\n  skipSort?: boolean;\r\n}\r\n\r\nexport enum CompletionItemKind {\r\n  GroupTitle = 'GroupTitle',\r\n}\r\n\r\nexport interface CompletionItem {\r\n  /**\r\n   * The label of this completion item. By default\r\n   * this is also the text that is inserted when selecting\r\n   * this completion.\r\n   */\r\n  label: string;\r\n\r\n  /**\r\n   * The kind of this completion item. An icon is chosen\r\n   * by the editor based on the kind.\r\n   */\r\n  kind?: CompletionItemKind | string;\r\n\r\n  /**\r\n   * A human-readable string with additional information\r\n   * about this item, like type or symbol information.\r\n   */\r\n  detail?: string;\r\n\r\n  /**\r\n   * A human-readable string, can be Markdown, that represents a doc-comment.\r\n   */\r\n  documentation?: string;\r\n\r\n  /**\r\n   * A string that should be used when comparing this item\r\n   * with other items. When `falsy` the `label` is used.\r\n   */\r\n  sortText?: string;\r\n\r\n  /**\r\n   * A string that should be used when filtering a set of\r\n   * completion items. When `falsy` the `label` is used.\r\n   */\r\n  filterText?: string;\r\n\r\n  /**\r\n   * A string or snippet that should be inserted in a document when selecting\r\n   * this completion. When `falsy` the `label` is used.\r\n   */\r\n  insertText?: string;\r\n\r\n  /**\r\n   * Delete number of characters before the caret position,\r\n   * by default the letters from the beginning of the word.\r\n   */\r\n  deleteBackwards?: number;\r\n\r\n  /**\r\n   * Number of steps to move after the insertion, can be negative.\r\n   */\r\n  move?: number;\r\n}\r\n\r\nexport interface TypeaheadOutput {\r\n  context?: string;\r\n  suggestions: CompletionItemGroup[];\r\n}\r\n\r\nexport interface TypeaheadInput {\r\n  text: string;\r\n  prefix: string;\r\n  wrapperClasses: string[];\r\n  labelKey?: string;\r\n  value?: Value;\r\n  editor?: Editor;\r\n}\r\n\r\nexport interface SuggestionsState {\r\n  groupedItems: CompletionItemGroup[];\r\n  typeaheadPrefix: string;\r\n  typeaheadContext: string;\r\n  typeaheadText: string;\r\n}\r\n","export * from './theme';\r\nexport * from './input';\r\nexport * from './completion';\r\n","// Vendored and converted to TS, source: https://github.com/xpl/ansicolor/blob/b82360563ed29de444dc7618b9236191e0a77096/ansicolor.js\r\n// License: Unlicense, author: https://github.com/xpl\r\n\r\nconst O = Object;\r\n\r\n/*  See https://misc.flogisoft.com/bash/tip_colors_and_formatting\r\n    ------------------------------------------------------------------------ */\r\n\r\nconst colorCodes = ['black', 'red', 'green', 'yellow', 'blue', 'magenta', 'cyan', 'lightGray', '', 'default'],\r\n  colorCodesLight = [\r\n    'darkGray',\r\n    'lightRed',\r\n    'lightGreen',\r\n    'lightYellow',\r\n    'lightBlue',\r\n    'lightMagenta',\r\n    'lightCyan',\r\n    'white',\r\n    '',\r\n  ],\r\n  styleCodes = ['', 'bright', 'dim', 'italic', 'underline', '', '', 'inverse'],\r\n  asBright = {\r\n    red: 'lightRed',\r\n    green: 'lightGreen',\r\n    yellow: 'lightYellow',\r\n    blue: 'lightBlue',\r\n    magenta: 'lightMagenta',\r\n    cyan: 'lightCyan',\r\n    black: 'darkGray',\r\n    lightGray: 'white',\r\n  },\r\n  types = {\r\n    0: 'style',\r\n    2: 'unstyle',\r\n    3: 'color',\r\n    9: 'colorLight',\r\n    4: 'bgColor',\r\n    10: 'bgColorLight',\r\n  },\r\n  subtypes = {\r\n    color: colorCodes,\r\n    colorLight: colorCodesLight,\r\n    bgColor: colorCodes,\r\n    bgColorLight: colorCodesLight,\r\n    style: styleCodes,\r\n    unstyle: styleCodes,\r\n  };\r\n\r\n/*  ------------------------------------------------------------------------ */\r\n\r\nconst clean = (obj: any) => {\r\n  for (const k in obj) {\r\n    if (!obj[k]) {\r\n      delete obj[k];\r\n    }\r\n  }\r\n  return O.keys(obj).length === 0 ? undefined : obj;\r\n};\r\n\r\n/*  ------------------------------------------------------------------------ */\r\n\r\nclass Color {\r\n  background?: boolean;\r\n  name?: string;\r\n  brightness?: number;\r\n\r\n  constructor(background?: boolean, name?: string, brightness?: number) {\r\n    this.background = background;\r\n    this.name = name;\r\n    this.brightness = brightness;\r\n  }\r\n\r\n  get inverse() {\r\n    return new Color(!this.background, this.name || (this.background ? 'black' : 'white'), this.brightness);\r\n  }\r\n\r\n  get clean() {\r\n    return clean({\r\n      name: this.name === 'default' ? '' : this.name,\r\n      bright: this.brightness === Code.bright,\r\n      dim: this.brightness === Code.dim,\r\n    });\r\n  }\r\n\r\n  defaultBrightness(value?: number) {\r\n    return new Color(this.background, this.name, this.brightness || value);\r\n  }\r\n\r\n  css(inverted: boolean) {\r\n    const color = inverted ? this.inverse : this;\r\n\r\n    // @ts-ignore\r\n    const rgbName = (color.brightness === Code.bright && asBright[color.name]) || color.name;\r\n\r\n    const prop = color.background ? 'background:' : 'color:';\r\n\r\n    // @ts-ignore\r\n    const rgb = Colors.rgb[rgbName];\r\n    const alpha = this.brightness === Code.dim ? 0.5 : 1;\r\n\r\n    return rgb\r\n      ? prop + 'rgba(' + [...rgb, alpha].join(',') + ');'\r\n      : !color.background && alpha < 1\r\n      ? 'color:rgba(0,0,0,0.5);'\r\n      : ''; // Chrome does not support 'opacity' property...\r\n  }\r\n}\r\n\r\n/*  ------------------------------------------------------------------------ */\r\n\r\nclass Code {\r\n  static reset = 0;\r\n  static bright = 1;\r\n  static dim = 2;\r\n  static inverse = 7;\r\n  static noBrightness = 22;\r\n  static noItalic = 23;\r\n  static noUnderline = 24;\r\n  static noInverse = 27;\r\n  static noColor = 39;\r\n  static noBgColor = 49;\r\n\r\n  value: number | undefined;\r\n\r\n  constructor(n?: string | number) {\r\n    if (n !== undefined) {\r\n      this.value = Number(n);\r\n    } else {\r\n      this.value = undefined;\r\n    }\r\n  }\r\n\r\n  get type() {\r\n    // @ts-ignore\r\n    return types[Math.floor(this.value / 10)];\r\n  }\r\n\r\n  get subtype() {\r\n    // @ts-ignore\r\n    return subtypes[this.type][this.value % 10];\r\n  }\r\n\r\n  get str() {\r\n    return this.value ? '\\u001b[' + this.value + 'm' : '';\r\n  }\r\n\r\n  static str(x: string | number) {\r\n    return new Code(x).str;\r\n  }\r\n\r\n  get isBrightness() {\r\n    return this.value === Code.noBrightness || this.value === Code.bright || this.value === Code.dim;\r\n  }\r\n}\r\n\r\n/*  ------------------------------------------------------------------------ */\r\n\r\nconst replaceAll = (str: string, a: string, b: string) => str.split(a).join(b);\r\n\r\n/*  ANSI brightness codes do not overlap, e.g. \"{bright}{dim}foo\" will be rendered bright (not dim).\r\n    So we fix it by adding brightness canceling before each brightness code, so the former example gets\r\n    converted to \"{noBrightness}{bright}{noBrightness}{dim}foo\"  this way it gets rendered as expected.\r\n */\r\n\r\nconst denormalizeBrightness = (s: string) => s.replace(/(\\u001b\\[(1|2)m)/g, '\\u001b[22m$1');\r\nconst normalizeBrightness = (s: string) => s.replace(/\\u001b\\[22m(\\u001b\\[(1|2)m)/g, '$1');\r\n\r\n// @ts-ignore\r\nconst wrap = (x, openCode, closeCode) => {\r\n  const open = Code.str(openCode),\r\n    close = Code.str(closeCode);\r\n\r\n  return String(x)\r\n    .split('\\n')\r\n    .map(line => denormalizeBrightness(open + replaceAll(normalizeBrightness(line), close, open) + close))\r\n    .join('\\n');\r\n};\r\n\r\n/*  ------------------------------------------------------------------------ */\r\n\r\nconst camel = (a: string, b: string) => a + b.charAt(0).toUpperCase() + b.slice(1);\r\n\r\nconst stringWrappingMethods = (() =>\r\n  [\r\n    ...colorCodes.map((k, i) =>\r\n      !k\r\n        ? []\r\n        : [\r\n            // color methods\r\n\r\n            [k, 30 + i, Code.noColor],\r\n            [camel('bg', k), 40 + i, Code.noBgColor],\r\n          ]\r\n    ),\r\n\r\n    ...colorCodesLight.map((k, i) =>\r\n      !k\r\n        ? []\r\n        : [\r\n            // light color methods\r\n\r\n            [k, 90 + i, Code.noColor],\r\n            [camel('bg', k), 100 + i, Code.noBgColor],\r\n          ]\r\n    ),\r\n\r\n    /* THIS ONE IS FOR BACKWARDS COMPATIBILITY WITH PREVIOUS VERSIONS (had 'bright' instead of 'light' for backgrounds)\r\n     */\r\n    ...['', 'BrightRed', 'BrightGreen', 'BrightYellow', 'BrightBlue', 'BrightMagenta', 'BrightCyan'].map((k, i) =>\r\n      !k ? [] : [['bg' + k, 100 + i, Code.noBgColor]]\r\n    ),\r\n\r\n    ...styleCodes.map((k, i) =>\r\n      !k\r\n        ? []\r\n        : [\r\n            // style methods\r\n\r\n            [k, i, k === 'bright' || k === 'dim' ? Code.noBrightness : 20 + i],\r\n          ]\r\n    ),\r\n  ].reduce((a, b) => a.concat(b)))();\r\n\r\n/*  ------------------------------------------------------------------------ */\r\n\r\n// @ts-ignore\r\nconst assignStringWrappingAPI = (target, wrapBefore = target) =>\r\n  stringWrappingMethods.reduce(\r\n    (memo, [k, open, close]) =>\r\n      O.defineProperty(memo, k, {\r\n        // @ts-ignore\r\n        get: () => assignStringWrappingAPI(str => wrapBefore(wrap(str, open, close))),\r\n      }),\r\n\r\n    target\r\n  );\r\n\r\n/*  ------------------------------------------------------------------------ */\r\n\r\nconst TEXT = 0,\r\n  BRACKET = 1,\r\n  CODE = 2;\r\n\r\nfunction rawParse(s: string) {\r\n  let state = TEXT,\r\n    buffer = '',\r\n    text = '',\r\n    code = '',\r\n    codes = [];\r\n  const spans = [];\r\n\r\n  for (let i = 0, n = s.length; i < n; i++) {\r\n    const c = s[i];\r\n\r\n    buffer += c;\r\n\r\n    switch (state) {\r\n      case TEXT: {\r\n        if (c === '\\u001b') {\r\n          state = BRACKET;\r\n          buffer = c;\r\n        } else {\r\n          text += c;\r\n        }\r\n        break;\r\n      }\r\n      case BRACKET:\r\n        if (c === '[') {\r\n          state = CODE;\r\n          code = '';\r\n          codes = [];\r\n        } else {\r\n          state = TEXT;\r\n          text += buffer;\r\n        }\r\n        break;\r\n\r\n      case CODE:\r\n        if (c >= '0' && c <= '9') {\r\n          code += c;\r\n        } else if (c === ';') {\r\n          codes.push(new Code(code));\r\n          code = '';\r\n        } else if (c === 'm' && code.length) {\r\n          codes.push(new Code(code));\r\n          for (const code of codes) {\r\n            spans.push({ text, code });\r\n            text = '';\r\n          }\r\n          state = TEXT;\r\n        } else {\r\n          state = TEXT;\r\n          text += buffer;\r\n        }\r\n    }\r\n  }\r\n\r\n  if (state !== TEXT) {\r\n    text += buffer;\r\n  }\r\n\r\n  if (text) {\r\n    spans.push({ text, code: new Code() });\r\n  }\r\n\r\n  return spans;\r\n}\r\n\r\n/*  ------------------------------------------------------------------------ */\r\n\r\n/**\r\n * Represents an ANSI-escaped string.\r\n */\r\nexport default class Colors {\r\n  spans: any[];\r\n  static names = stringWrappingMethods.map(([k]) => k);\r\n  static rgb = {\r\n    black: [0, 0, 0],\r\n    darkGray: [100, 100, 100],\r\n    lightGray: [200, 200, 200],\r\n    white: [255, 255, 255],\r\n\r\n    red: [204, 0, 0],\r\n    lightRed: [255, 51, 0],\r\n\r\n    green: [0, 204, 0],\r\n    lightGreen: [51, 204, 51],\r\n\r\n    yellow: [204, 102, 0],\r\n    lightYellow: [255, 153, 51],\r\n\r\n    blue: [0, 0, 255],\r\n    lightBlue: [26, 140, 255],\r\n\r\n    magenta: [204, 0, 204],\r\n    lightMagenta: [255, 0, 255],\r\n\r\n    cyan: [0, 153, 255],\r\n    lightCyan: [0, 204, 255],\r\n  };\r\n\r\n  /**\r\n   * @param {string} s a string containing ANSI escape codes.\r\n   */\r\n  constructor(s?: string) {\r\n    this.spans = s ? rawParse(s) : [];\r\n  }\r\n\r\n  get str() {\r\n    return this.spans.reduce((str, p) => str + p.text + p.code.str, '');\r\n  }\r\n\r\n  get parsed() {\r\n    let styles: Set<string>;\r\n    let brightness: number | undefined;\r\n    let color: Color;\r\n    let bgColor: Color;\r\n\r\n    function reset() {\r\n      (color = new Color()),\r\n        (bgColor = new Color(true /* background */)),\r\n        (brightness = undefined),\r\n        (styles = new Set());\r\n    }\r\n\r\n    reset();\r\n\r\n    return O.assign(new Colors(), {\r\n      spans: this.spans\r\n        .map(span => {\r\n          const c = span.code;\r\n\r\n          const inverted = styles.has('inverse'),\r\n            underline = styles.has('underline') ? 'text-decoration: underline;' : '',\r\n            italic = styles.has('italic') ? 'font-style: italic;' : '',\r\n            bold = brightness === Code.bright ? 'font-weight: bold;' : '';\r\n\r\n          const foreColor = color.defaultBrightness(brightness);\r\n\r\n          const styledSpan = O.assign(\r\n            { css: bold + italic + underline + foreColor.css(inverted) + bgColor.css(inverted) },\r\n            clean({ bold: !!bold, color: foreColor.clean, bgColor: bgColor.clean }),\r\n            span\r\n          );\r\n\r\n          for (const k of styles) {\r\n            styledSpan[k] = true;\r\n          }\r\n\r\n          if (c.isBrightness) {\r\n            brightness = c.value;\r\n          } else if (span.code.value !== undefined) {\r\n            if (span.code.value === Code.reset) {\r\n              reset();\r\n            } else {\r\n              switch (span.code.type) {\r\n                case 'color':\r\n                case 'colorLight':\r\n                  color = new Color(false, c.subtype);\r\n                  break;\r\n\r\n                case 'bgColor':\r\n                case 'bgColorLight':\r\n                  bgColor = new Color(true, c.subtype);\r\n                  break;\r\n\r\n                case 'style':\r\n                  styles.add(c.subtype);\r\n                  break;\r\n                case 'unstyle':\r\n                  styles.delete(c.subtype);\r\n                  break;\r\n              }\r\n            }\r\n          }\r\n\r\n          return styledSpan;\r\n        })\r\n        .filter(s => s.text.length > 0),\r\n    });\r\n  }\r\n\r\n  /*  Outputs with Chrome DevTools-compatible format     */\r\n\r\n  get asChromeConsoleLogArguments() {\r\n    const spans = this.parsed.spans;\r\n\r\n    return [spans.map(s => '%c' + s.text).join(''), ...spans.map(s => s.css)];\r\n  }\r\n\r\n  get browserConsoleArguments() /* LEGACY, DEPRECATED */ {\r\n    return this.asChromeConsoleLogArguments;\r\n  }\r\n\r\n  /**\r\n   * @desc installs String prototype extensions\r\n   * @example\r\n   * require ('ansicolor').nice\r\n   * console.log ('foo'.bright.red)\r\n   */\r\n  static get nice() {\r\n    Colors.names.forEach(k => {\r\n      if (!(k in String.prototype)) {\r\n        O.defineProperty(String.prototype, k, {\r\n          get: function() {\r\n            // @ts-ignore\r\n            return Colors[k](this);\r\n          },\r\n        });\r\n      }\r\n    });\r\n\r\n    return Colors;\r\n  }\r\n\r\n  /**\r\n   * @desc parses a string containing ANSI escape codes\r\n   * @return {Colors} parsed representation.\r\n   */\r\n  static parse(s: string) {\r\n    return new Colors(s).parsed;\r\n  }\r\n\r\n  /**\r\n   * @desc strips ANSI codes from a string\r\n   * @param {string} s a string containing ANSI escape codes.\r\n   * @return {string} clean string.\r\n   */\r\n  static strip(s: string) {\r\n    return s.replace(/[\\u001b\\u009b][[()#;?]*(?:[0-9]{1,4}(?:;[0-9]{0,4})*)?[0-9A-PRZcf-nqry=><]/g, ''); // hope V8 caches the regexp\r\n  }\r\n\r\n  /**\r\n   * @example\r\n   * const spans = [...ansi.parse ('\\u001b[7m\\u001b[7mfoo\\u001b[7mbar\\u001b[27m')]\r\n   */\r\n  [Symbol.iterator]() {\r\n    return this.spans[Symbol.iterator]();\r\n  }\r\n}\r\n\r\n/*  ------------------------------------------------------------------------ */\r\n\r\nassignStringWrappingAPI(Colors, (str: string) => str);\r\n","import map from 'lodash/map';\r\nimport sortBy from 'lodash/sortBy';\r\nimport flattenDeep from 'lodash/flattenDeep';\r\nimport chunk from 'lodash/chunk';\r\nimport zip from 'lodash/zip';\r\nimport tinycolor from 'tinycolor2';\r\n\r\nexport const PALETTE_ROWS = 4;\r\nexport const PALETTE_COLUMNS = 14;\r\nexport const DEFAULT_ANNOTATION_COLOR = 'rgba(0, 211, 255, 1)';\r\nexport const OK_COLOR = 'rgba(11, 237, 50, 1)';\r\nexport const ALERTING_COLOR = 'rgba(237, 46, 24, 1)';\r\nexport const NO_DATA_COLOR = 'rgba(150, 150, 150, 1)';\r\nexport const PENDING_COLOR = 'rgba(247, 149, 32, 1)';\r\nexport const REGION_FILL_ALPHA = 0.09;\r\nexport const colors = [\r\n  '#7EB26D', // 0: pale green\r\n  '#EAB839', // 1: mustard\r\n  '#6ED0E0', // 2: light blue\r\n  '#EF843C', // 3: orange\r\n  '#E24D42', // 4: red\r\n  '#1F78C1', // 5: ocean\r\n  '#BA43A9', // 6: purple\r\n  '#705DA0', // 7: violet\r\n  '#508642', // 8: dark green\r\n  '#CCA300', // 9: dark sand\r\n  '#447EBC',\r\n  '#C15C17',\r\n  '#890F02',\r\n  '#0A437C',\r\n  '#6D1F62',\r\n  '#584477',\r\n  '#B7DBAB',\r\n  '#F4D598',\r\n  '#70DBED',\r\n  '#F9BA8F',\r\n  '#F29191',\r\n  '#82B5D8',\r\n  '#E5A8E2',\r\n  '#AEA2E0',\r\n  '#629E51',\r\n  '#E5AC0E',\r\n  '#64B0C8',\r\n  '#E0752D',\r\n  '#BF1B00',\r\n  '#0A50A1',\r\n  '#962D82',\r\n  '#614D93',\r\n  '#9AC48A',\r\n  '#F2C96D',\r\n  '#65C5DB',\r\n  '#F9934E',\r\n  '#EA6460',\r\n  '#5195CE',\r\n  '#D683CE',\r\n  '#806EB7',\r\n  '#3F6833',\r\n  '#967302',\r\n  '#2F575E',\r\n  '#99440A',\r\n  '#58140C',\r\n  '#052B51',\r\n  '#511749',\r\n  '#3F2B5B',\r\n  '#E0F9D7',\r\n  '#FCEACA',\r\n  '#CFFAFF',\r\n  '#F9E2D2',\r\n  '#FCE2DE',\r\n  '#BADFF4',\r\n  '#F9D9F9',\r\n  '#DEDAF7',\r\n];\r\n\r\nfunction sortColorsByHue(hexColors: string[]) {\r\n  const hslColors = map(hexColors, hexToHsl);\r\n\r\n  const sortedHSLColors = sortBy(hslColors, ['h']);\r\n  const chunkedHSLColors = chunk(sortedHSLColors, PALETTE_ROWS);\r\n  const sortedChunkedHSLColors = map(chunkedHSLColors, chunk => {\r\n    return sortBy(chunk, 'l');\r\n  });\r\n  const flattenedZippedSortedChunkedHSLColors = flattenDeep(zip(...sortedChunkedHSLColors));\r\n\r\n  return map(flattenedZippedSortedChunkedHSLColors, hslToHex);\r\n}\r\n\r\nfunction hexToHsl(color: string) {\r\n  return tinycolor(color).toHsl();\r\n}\r\n\r\nfunction hslToHex(color: any) {\r\n  return tinycolor(color).toHexString();\r\n}\r\n\r\nexport let sortedColors = sortColorsByHue(colors);\r\n","import { ContextMenuItem } from '../components/ContextMenu/ContextMenu';\r\nimport { LinkModelSupplier } from '@grafana/data';\r\n\r\nexport const DataLinkBuiltInVars = {\r\n  keepTime: '__url_time_range',\r\n  timeRangeFrom: '__from',\r\n  timeRangeTo: '__to',\r\n  includeVars: '__all_variables',\r\n  seriesName: '__series.name',\r\n  fieldName: '__field.name',\r\n  valueTime: '__value.time',\r\n  valueNumeric: '__value.numeric',\r\n  valueText: '__value.text',\r\n  valueRaw: '__value.raw',\r\n  // name of the calculation represented by the value\r\n  valueCalc: '__value.calc',\r\n};\r\n\r\n/**\r\n * Delays creating links until we need to open the ContextMenu\r\n */\r\nexport const linkModelToContextMenuItems: (links: LinkModelSupplier<any>) => ContextMenuItem[] = links => {\r\n  return links.getLinks().map(link => {\r\n    return {\r\n      label: link.title,\r\n      // TODO: rename to href\r\n      url: link.href,\r\n      target: link.target,\r\n      icon: `fa ${link.target === '_self' ? 'fa-link' : 'fa-external-link'}`,\r\n      onClick: link.onClick,\r\n    };\r\n  });\r\n};\r\n","// Node.closest() polyfill\r\nif ('Element' in window && !Element.prototype.closest) {\r\n  Element.prototype.closest = function(this: any, s: string) {\r\n    const matches = (this.document || this.ownerDocument).querySelectorAll(s);\r\n    let el = this;\r\n    let i;\r\n    // eslint-disable-next-line\r\n    do {\r\n      i = matches.length;\r\n      // eslint-disable-next-line\r\n      while (--i >= 0 && matches.item(i) !== el) {}\r\n      el = el.parentElement;\r\n    } while (i < 0 && el);\r\n    return el;\r\n  };\r\n}\r\n\r\nexport function getPreviousCousin(node: any, selector: string) {\r\n  let sibling = node.parentElement.previousSibling;\r\n  let el;\r\n  while (sibling) {\r\n    el = sibling.querySelector(selector);\r\n    if (el) {\r\n      return el;\r\n    }\r\n    sibling = sibling.previousSibling;\r\n  }\r\n  return undefined;\r\n}\r\n\r\nexport function getNextCharacter(global = window) {\r\n  const selection = global.getSelection();\r\n  if (!selection || !selection.anchorNode) {\r\n    return null;\r\n  }\r\n\r\n  const range = selection.getRangeAt(0);\r\n  const text = selection.anchorNode.textContent;\r\n  const offset = range.startOffset;\r\n  return text!.substr(offset, 1);\r\n}\r\n","export * from './colors';\r\nexport * from './validate';\r\nexport * from './slate';\r\nexport * from './dataLinks';\r\nexport * from './tags';\r\nexport * from './measureText';\r\nexport { default as ansicolor } from './ansicolor';\r\n\r\n// Export with a namespace\r\nimport * as DOMUtil from './dom'; // includes Element.closest polyfil\r\nexport { DOMUtil };\r\n","let canvas: HTMLCanvasElement | null = null;\r\nconst cache: Record<string, TextMetrics> = {};\r\n\r\nexport function measureText(text: string, fontSize: number): TextMetrics {\r\n  const fontStyle = `${fontSize}px 'Roboto'`;\r\n  const cacheKey = text + fontStyle;\r\n  const fromCache = cache[cacheKey];\r\n\r\n  if (fromCache) {\r\n    return fromCache;\r\n  }\r\n\r\n  if (canvas === null) {\r\n    canvas = document.createElement('canvas');\r\n  }\r\n\r\n  const context = canvas.getContext('2d');\r\n  if (!context) {\r\n    throw new Error('Could not create context');\r\n  }\r\n\r\n  context.font = fontStyle;\r\n  const metrics = context.measureText(text);\r\n\r\n  cache[cacheKey] = metrics;\r\n  return metrics;\r\n}\r\n\r\nexport function calculateFontSize(text: string, width: number, height: number, lineHeight: number, maxSize?: number) {\r\n  // calculate width in 14px\r\n  const textSize = measureText(text, 14);\r\n  // how much bigger than 14px can we make it while staying within our width constraints\r\n  const fontSizeBasedOnWidth = (width / (textSize.width + 2)) * 14;\r\n  const fontSizeBasedOnHeight = height / lineHeight;\r\n\r\n  // final fontSize\r\n  const optimialSize = Math.min(fontSizeBasedOnHeight, fontSizeBasedOnWidth);\r\n  return Math.min(optimialSize, maxSize ?? optimialSize);\r\n}\r\n","import { Block, Document, Text, Value, SchemaProperties } from 'slate';\r\n\r\nexport const SCHEMA: SchemaProperties = {\r\n  document: {\r\n    nodes: [\r\n      {\r\n        match: [{ type: 'paragraph' }, { type: 'code_block' }, { type: 'code_line' }],\r\n      },\r\n    ],\r\n  },\r\n  inlines: {},\r\n};\r\n\r\nexport const makeFragment = (text: string, syntax?: string): Document => {\r\n  const lines = text.split('\\n').map(line =>\r\n    Block.create({\r\n      type: 'code_line',\r\n      nodes: [Text.create(line)],\r\n    })\r\n  );\r\n\r\n  const block = Block.create({\r\n    data: {\r\n      syntax,\r\n    },\r\n    type: 'code_block',\r\n    nodes: lines,\r\n  });\r\n\r\n  return Document.create({\r\n    nodes: [block],\r\n  });\r\n};\r\n\r\nexport const makeValue = (text: string, syntax?: string): Value => {\r\n  const fragment = makeFragment(text, syntax);\r\n\r\n  return Value.create({\r\n    document: fragment,\r\n  });\r\n};\r\n","const TAG_COLORS = [\r\n  '#E24D42',\r\n  '#1F78C1',\r\n  '#BA43A9',\r\n  '#705DA0',\r\n  '#466803',\r\n  '#508642',\r\n  '#447EBC',\r\n  '#C15C17',\r\n  '#890F02',\r\n  '#757575',\r\n  '#0A437C',\r\n  '#6D1F62',\r\n  '#584477',\r\n  '#629E51',\r\n  '#2F4F4F',\r\n  '#BF1B00',\r\n  '#806EB7',\r\n  '#8a2eb8',\r\n  '#699e00',\r\n  '#000000',\r\n  '#3F6833',\r\n  '#2F575E',\r\n  '#99440A',\r\n  '#E0752D',\r\n  '#0E4AB4',\r\n  '#58140C',\r\n  '#052B51',\r\n  '#511749',\r\n  '#3F2B5B',\r\n];\r\n\r\nconst TAG_BORDER_COLORS = [\r\n  '#FF7368',\r\n  '#459EE7',\r\n  '#E069CF',\r\n  '#9683C6',\r\n  '#6C8E29',\r\n  '#76AC68',\r\n  '#6AA4E2',\r\n  '#E7823D',\r\n  '#AF3528',\r\n  '#9B9B9B',\r\n  '#3069A2',\r\n  '#934588',\r\n  '#7E6A9D',\r\n  '#88C477',\r\n  '#557575',\r\n  '#E54126',\r\n  '#A694DD',\r\n  '#B054DE',\r\n  '#8FC426',\r\n  '#262626',\r\n  '#658E59',\r\n  '#557D84',\r\n  '#BF6A30',\r\n  '#FF9B53',\r\n  '#3470DA',\r\n  '#7E3A32',\r\n  '#2B5177',\r\n  '#773D6F',\r\n  '#655181',\r\n];\r\n\r\n/**\r\n * Returns tag badge background and border colors based on hashed tag name.\r\n * @param name tag name\r\n */\r\nexport function getTagColorsFromName(name: string): { color: string; borderColor: string } {\r\n  const hash = djb2(name.toLowerCase());\r\n  const color = TAG_COLORS[Math.abs(hash % TAG_COLORS.length)];\r\n  const borderColor = TAG_BORDER_COLORS[Math.abs(hash % TAG_BORDER_COLORS.length)];\r\n  return { color, borderColor };\r\n}\r\n\r\nfunction djb2(str: string) {\r\n  let hash = 5381;\r\n  for (let i = 0; i < str.length; i++) {\r\n    hash = (hash << 5) + hash + str.charCodeAt(i); /* hash * 33 + c */\r\n  }\r\n  return hash;\r\n}\r\n\r\nexport default {\r\n  getTagColorsFromName,\r\n};\r\n","import { default as calculateSize } from 'calculate-size';\r\nimport { CompletionItemGroup, CompletionItem, CompletionItemKind } from '../types/completion';\r\nimport { GrafanaTheme } from '@grafana/data';\r\n\r\nexport const flattenGroupItems = (groupedItems: CompletionItemGroup[]): CompletionItem[] => {\r\n  return groupedItems.reduce((all, current) => {\r\n    const titleItem: CompletionItem = {\r\n      label: current.label,\r\n      kind: CompletionItemKind.GroupTitle,\r\n    };\r\n    return all.concat(titleItem, current.items);\r\n  }, new Array<CompletionItem>());\r\n};\r\n\r\nexport const calculateLongestLabel = (allItems: CompletionItem[]): string => {\r\n  return allItems.reduce((longest, current) => {\r\n    return longest.length < current.label.length ? current.label : longest;\r\n  }, '');\r\n};\r\n\r\nexport const calculateListSizes = (theme: GrafanaTheme, allItems: CompletionItem[], longestLabel: string) => {\r\n  const size = calculateSize(longestLabel, {\r\n    font: theme.typography.fontFamily.monospace,\r\n    fontSize: theme.typography.size.sm,\r\n    fontWeight: 'normal',\r\n  });\r\n\r\n  const listWidth = calculateListWidth(size.width, theme);\r\n  const itemHeight = calculateItemHeight(size.height, theme);\r\n  const listHeight = calculateListHeight(itemHeight, allItems);\r\n\r\n  return {\r\n    listWidth,\r\n    listHeight,\r\n    itemHeight,\r\n  };\r\n};\r\n\r\nexport const calculateItemHeight = (longestLabelHeight: number, theme: GrafanaTheme) => {\r\n  const horizontalPadding = parseInt(theme.spacing.sm, 10) * 2;\r\n  const itemHeight = longestLabelHeight + horizontalPadding;\r\n\r\n  return itemHeight;\r\n};\r\n\r\nexport const calculateListWidth = (longestLabelWidth: number, theme: GrafanaTheme) => {\r\n  const verticalPadding = parseInt(theme.spacing.sm, 10) + parseInt(theme.spacing.md, 10);\r\n  const maxWidth = 800;\r\n  const listWidth = Math.min(Math.max(longestLabelWidth + verticalPadding, 200), maxWidth);\r\n\r\n  return listWidth;\r\n};\r\n\r\nexport const calculateListHeight = (itemHeight: number, allItems: CompletionItem[]) => {\r\n  const numberOfItemsToShow = Math.min(allItems.length, 10);\r\n  const minHeight = 100;\r\n  const totalHeight = numberOfItemsToShow * itemHeight;\r\n  const listHeight = Math.max(totalHeight, minHeight);\r\n\r\n  return listHeight;\r\n};\r\n","import { useState, useCallback } from 'react';\r\n\r\nexport const useClientRect = <T extends HTMLElement>(): [{ width: number; height: number } | null, React.Ref<T>] => {\r\n  const [rect, setRect] = useState<{ width: number; height: number } | null>(null);\r\n  const ref = useCallback((node: T) => {\r\n    if (node !== null) {\r\n      setRect(node.getBoundingClientRect());\r\n    }\r\n  }, []);\r\n  return [rect, ref];\r\n};\r\n","import { useEffect, useRef, useState } from 'react';\r\n\r\ntype DelayOptions = {\r\n  // Minimal amount of time the switch will be on.\r\n  duration?: number;\r\n  // Delay after which switch will turn on.\r\n  delay?: number;\r\n};\r\n\r\n/**\r\n * Hook that delays changing of boolean switch to prevent too much time spent in \"on\" state. It is kind of a throttle\r\n * but you can specify different time for on and off throttling so this only allows a boolean values and also prefers\r\n * to stay \"off\" so turning \"on\" is always delayed while turning \"off\" is throttled.\r\n *\r\n * This is useful for showing loading elements to prevent it flashing too much in case of quick loading time or\r\n * prevent it flash if loaded state comes right after switch to loading.\r\n */\r\nexport function useDelayedSwitch(value: boolean, options: DelayOptions = {}): boolean {\r\n  const { duration = 250, delay = 250 } = options;\r\n\r\n  const [delayedValue, setDelayedValue] = useState(value);\r\n  const onStartTime = useRef<Date | undefined>();\r\n\r\n  useEffect(() => {\r\n    let timeout: number | undefined;\r\n    if (value) {\r\n      // If toggling to \"on\" state we always setTimout no matter how long we have been \"off\".\r\n      timeout = setTimeout(() => {\r\n        onStartTime.current = new Date();\r\n        setDelayedValue(value);\r\n      }, delay) as any;\r\n    } else {\r\n      // If toggling to \"off\" state we check how much time we were already \"on\".\r\n      const timeSpent = onStartTime.current ? Date.now() - onStartTime.current.valueOf() : 0;\r\n      const turnOff = () => {\r\n        onStartTime.current = undefined;\r\n        setDelayedValue(value);\r\n      };\r\n      if (timeSpent >= duration) {\r\n        // We already spent enough time \"on\" so change right away.\r\n        turnOff();\r\n      } else {\r\n        timeout = setTimeout(turnOff, duration - timeSpent) as any;\r\n      }\r\n    }\r\n    return () => {\r\n      if (timeout) {\r\n        clearTimeout(timeout);\r\n        timeout = undefined;\r\n      }\r\n    };\r\n  }, [value, duration, delay]);\r\n\r\n  return delayedValue;\r\n}\r\n","import { ValidationRule, ValidationEvents } from '../types/input';\n\nexport enum EventsWithValidation {\n  onBlur = 'onBlur',\n  onFocus = 'onFocus',\n  onChange = 'onChange',\n}\n\nexport const validate = (value: string, validationRules: ValidationRule[]) => {\n  const errors = validationRules.reduce((acc, currRule) => {\n    if (!currRule.rule(value)) {\n      return acc.concat(currRule.errorMessage);\n    }\n    return acc;\n  }, [] as string[]);\n  return errors.length > 0 ? errors : null;\n};\n\nexport const hasValidationEvent = (event: EventsWithValidation, validationEvents: ValidationEvents | undefined) => {\n  return validationEvents && validationEvents[event];\n};\n\nexport const regexValidation = (pattern: string | RegExp, errorMessage?: string): ValidationRule => {\n  return {\n    rule: (valueToValidate: string) => {\n      return !!valueToValidate.match(pattern);\n    },\n    errorMessage: errorMessage || 'Value is not valid',\n  };\n};\n","import '@babel/polyfill';\r\nimport 'url-search-params-polyfill'; // fetch polyfill needed for PhantomJs rendering\r\nimport 'file-saver';\r\nimport 'lodash';\r\nimport 'jquery';\r\nimport 'angular';\r\nimport 'angular-route';\r\nimport 'angular-sanitize';\r\nimport 'angular-native-dragdrop';\r\nimport 'angular-bindonce';\r\nimport 'react';\r\nimport 'react-dom';\r\n\r\nimport 'vendor/bootstrap/bootstrap';\r\nimport 'vendor/angular-other/angular-strap';\r\n\r\nimport $ from 'jquery';\r\nimport angular from 'angular';\r\nimport config from 'app/core/config';\r\n// @ts-ignore\r\nimport ttiPolyfill from 'tti-polyfill';\r\n// @ts-ignore ignoring this for now, otherwise we would have to extend _ interface with move\r\nimport _ from 'lodash';\r\nimport { AppEvents, setMarkdownOptions, setLocale } from '@grafana/data';\r\nimport appEvents from 'app/core/app_events';\r\nimport { addClassIfNoOverlayScrollbar } from 'app/core/utils/scrollbar';\r\nimport { checkBrowserCompatibility } from 'app/core/utils/browser';\r\nimport { importPluginModule } from 'app/features/plugins/plugin_loader';\r\n\r\n// add move to lodash for backward compatabiltiy\r\n// @ts-ignore\r\n_.move = (array: [], fromIndex: number, toIndex: number) => {\r\n  array.splice(toIndex, 0, array.splice(fromIndex, 1)[0]);\r\n  return array;\r\n};\r\n\r\nimport { coreModule, angularModules } from 'app/core/core_module';\r\nimport { registerAngularDirectives } from 'app/core/core';\r\nimport { setupAngularRoutes } from 'app/routes/routes';\r\nimport { setEchoSrv, registerEchoBackend } from '@grafana/runtime';\r\nimport { Echo } from './core/services/echo/Echo';\r\nimport { reportPerformance } from './core/services/echo/EchoSrv';\r\nimport { PerformanceBackend } from './core/services/echo/backends/PerformanceBackend';\r\n\r\nimport 'app/routes/GrafanaCtrl';\r\nimport 'app/features/all';\r\n\r\n// import symlinked extensions\r\nconst extensionsIndex = (require as any).context('.', true, /extensions\\/index.ts/);\r\nextensionsIndex.keys().forEach((key: any) => {\r\n  extensionsIndex(key);\r\n});\r\n\r\nexport class GrafanaApp {\r\n  registerFunctions: any;\r\n  ngModuleDependencies: any[];\r\n  preBootModules: any[] | null;\r\n\r\n  constructor() {\r\n    addClassIfNoOverlayScrollbar('no-overlay-scrollbar');\r\n    this.preBootModules = [];\r\n    this.registerFunctions = {};\r\n    this.ngModuleDependencies = [];\r\n  }\r\n\r\n  useModule(module: angular.IModule) {\r\n    if (this.preBootModules) {\r\n      this.preBootModules.push(module);\r\n    } else {\r\n      _.extend(module, this.registerFunctions);\r\n    }\r\n    this.ngModuleDependencies.push(module.name);\r\n    return module;\r\n  }\r\n\r\n  init() {\r\n    const app = angular.module('grafana', []);\r\n\r\n    setLocale(config.bootData.user.locale);\r\n\r\n    setMarkdownOptions({ sanitize: !config.disableSanitizeHtml });\r\n\r\n    app.config(\r\n      (\r\n        $locationProvider: angular.ILocationProvider,\r\n        $controllerProvider: angular.IControllerProvider,\r\n        $compileProvider: angular.ICompileProvider,\r\n        $filterProvider: angular.IFilterProvider,\r\n        $httpProvider: angular.IHttpProvider,\r\n        $provide: angular.auto.IProvideService\r\n      ) => {\r\n        // pre assing bindings before constructor calls\r\n        $compileProvider.preAssignBindingsEnabled(true);\r\n\r\n        if (config.buildInfo.env !== 'development') {\r\n          $compileProvider.debugInfoEnabled(false);\r\n        }\r\n\r\n        $httpProvider.useApplyAsync(true);\r\n\r\n        this.registerFunctions.controller = $controllerProvider.register;\r\n        this.registerFunctions.directive = $compileProvider.directive;\r\n        this.registerFunctions.factory = $provide.factory;\r\n        this.registerFunctions.service = $provide.service;\r\n        this.registerFunctions.filter = $filterProvider.register;\r\n\r\n        $provide.decorator('$http', [\r\n          '$delegate',\r\n          '$templateCache',\r\n          ($delegate: any, $templateCache: any) => {\r\n            const get = $delegate.get;\r\n            $delegate.get = (url: string, config: any) => {\r\n              if (url.match(/\\.html$/)) {\r\n                // some template's already exist in the cache\r\n                if (!$templateCache.get(url)) {\r\n                  url += '?v=' + new Date().getTime();\r\n                }\r\n              }\r\n              return get(url, config);\r\n            };\r\n            return $delegate;\r\n          },\r\n        ]);\r\n      }\r\n    );\r\n\r\n    this.ngModuleDependencies = [\r\n      'grafana.core',\r\n      'ngRoute',\r\n      'ngSanitize',\r\n      '$strap.directives',\r\n      'ang-drag-drop',\r\n      'grafana',\r\n      'pasvaz.bindonce',\r\n      'react',\r\n    ];\r\n\r\n    // makes it possible to add dynamic stuff\r\n    _.each(angularModules, (m: angular.IModule) => {\r\n      this.useModule(m);\r\n    });\r\n\r\n    // register react angular wrappers\r\n    coreModule.config(setupAngularRoutes);\r\n    registerAngularDirectives();\r\n\r\n    // disable tool tip animation\r\n    $.fn.tooltip.defaults.animation = false;\r\n\r\n    // bootstrap the app\r\n    angular.bootstrap(document, this.ngModuleDependencies).invoke(() => {\r\n      _.each(this.preBootModules, (module: angular.IModule) => {\r\n        _.extend(module, this.registerFunctions);\r\n      });\r\n\r\n      this.preBootModules = null;\r\n\r\n      if (!checkBrowserCompatibility()) {\r\n        setTimeout(() => {\r\n          appEvents.emit(AppEvents.alertWarning, [\r\n            'Your browser is not fully supported',\r\n            'A newer browser version is recommended',\r\n          ]);\r\n        }, 1000);\r\n      }\r\n    });\r\n\r\n    // Preload selected app plugins\r\n    for (const modulePath of config.pluginsToPreload) {\r\n      importPluginModule(modulePath);\r\n    }\r\n  }\r\n\r\n  initEchoSrv() {\r\n    setEchoSrv(new Echo({ debug: process.env.NODE_ENV === 'development' }));\r\n\r\n    ttiPolyfill.getFirstConsistentlyInteractive().then((tti: any) => {\r\n      // Collecting paint metrics first\r\n      const paintMetrics = performance && performance.getEntriesByType ? performance.getEntriesByType('paint') : [];\r\n\r\n      for (const metric of paintMetrics) {\r\n        reportPerformance(metric.name, Math.round(metric.startTime + metric.duration));\r\n      }\r\n      reportPerformance('tti', tti);\r\n    });\r\n\r\n    registerEchoBackend(new PerformanceBackend({}));\r\n\r\n    window.addEventListener('DOMContentLoaded', () => {\r\n      reportPerformance('dcl', Math.round(performance.now()));\r\n    });\r\n  }\r\n}\r\n\r\nexport default new GrafanaApp();\r\n","import { createAction } from '@reduxjs/toolkit';\n\nimport { StoreState } from '../../types';\n\nexport type StateSelector<T> = (state: StoreState) => T;\n\nexport interface CleanUp<T> {\n  stateSelector: (state: StoreState) => T;\n}\n\nexport const cleanUpAction = createAction<CleanUp<{}>>('core/cleanUpState');\n","import { clearAppNotification, notifyApp } from '../reducers/appNotification';\r\nimport { updateLocation } from '../reducers/location';\r\nimport { updateNavIndex } from '../reducers/navModel';\r\n\r\nexport { updateLocation, updateNavIndex, notifyApp, clearAppNotification };\r\n","import { react2AngularDirective } from 'app/core/utils/react2angular';\r\nimport { QueryEditor as StackdriverQueryEditor } from 'app/plugins/datasource/stackdriver/components/QueryEditor';\r\nimport { AnnotationQueryEditor as StackdriverAnnotationQueryEditor } from 'app/plugins/datasource/stackdriver/components/AnnotationQueryEditor';\r\nimport { AnnotationQueryEditor as CloudWatchAnnotationQueryEditor } from 'app/plugins/datasource/cloudwatch/components/AnnotationQueryEditor';\r\nimport PageHeader from './components/PageHeader/PageHeader';\r\nimport EmptyListCTA from './components/EmptyListCTA/EmptyListCTA';\r\nimport { TagFilter } from './components/TagFilter/TagFilter';\r\nimport { SideMenu } from './components/sidemenu/SideMenu';\r\nimport { MetricSelect } from './components/Select/MetricSelect';\r\nimport AppNotificationList from './components/AppNotifications/AppNotificationList';\r\nimport {\r\n  ColorPicker,\r\n  SeriesColorPickerPopoverWithTheme,\r\n  SecretFormField,\r\n  UnitPicker,\r\n  DataLinksEditor,\r\n  DataSourceHttpSettings,\r\n  GraphContextMenu,\r\n} from '@grafana/ui';\r\nimport { FunctionEditor } from 'app/plugins/datasource/graphite/FunctionEditor';\r\nimport { SearchField } from './components/search/SearchField';\r\nimport ReactProfileWrapper from 'app/features/profile/ReactProfileWrapper';\r\nimport { LokiAnnotationsQueryEditor } from '../plugins/datasource/loki/components/AnnotationsQueryEditor';\r\nimport { HelpModal } from './components/help/HelpModal';\r\nimport { Footer } from './components/Footer/Footer';\r\n\r\nexport function registerAngularDirectives() {\r\n  react2AngularDirective('footer', Footer, []);\r\n  react2AngularDirective('helpModal', HelpModal, []);\r\n  react2AngularDirective('sidemenu', SideMenu, []);\r\n  react2AngularDirective('functionEditor', FunctionEditor, ['func', 'onRemove', 'onMoveLeft', 'onMoveRight']);\r\n  react2AngularDirective('appNotificationsList', AppNotificationList, []);\r\n  react2AngularDirective('pageHeader', PageHeader, ['model', 'noTabs']);\r\n  react2AngularDirective('emptyListCta', EmptyListCTA, [\r\n    'title',\r\n    'buttonIcon',\r\n    'buttonLink',\r\n    'buttonTitle',\r\n    ['onClick', { watchDepth: 'reference', wrapApply: true }],\r\n    'proTip',\r\n    'proTipLink',\r\n    'proTipLinkTitle',\r\n    'proTipTarget',\r\n    'infoBox',\r\n    'infoBoxTitle',\r\n  ]);\r\n  react2AngularDirective('searchField', SearchField, [\r\n    'query',\r\n    'autoFocus',\r\n    ['onChange', { watchDepth: 'reference' }],\r\n    ['onKeyDown', { watchDepth: 'reference' }],\r\n  ]);\r\n  react2AngularDirective('tagFilter', TagFilter, [\r\n    'tags',\r\n    ['onChange', { watchDepth: 'reference' }],\r\n    ['tagOptions', { watchDepth: 'reference' }],\r\n  ]);\r\n  react2AngularDirective('colorPicker', ColorPicker, [\r\n    'color',\r\n    ['onChange', { watchDepth: 'reference', wrapApply: true }],\r\n  ]);\r\n  react2AngularDirective('seriesColorPickerPopover', SeriesColorPickerPopoverWithTheme, [\r\n    'color',\r\n    'series',\r\n    'onColorChange',\r\n    'onToggleAxis',\r\n  ]);\r\n  react2AngularDirective('unitPicker', UnitPicker, [\r\n    'value',\r\n    'width',\r\n    ['onChange', { watchDepth: 'reference', wrapApply: true }],\r\n  ]);\r\n  react2AngularDirective('metricSelect', MetricSelect, [\r\n    'options',\r\n    'onChange',\r\n    'value',\r\n    'isSearchable',\r\n    'className',\r\n    'placeholder',\r\n    ['variables', { watchDepth: 'reference' }],\r\n  ]);\r\n  react2AngularDirective('stackdriverQueryEditor', StackdriverQueryEditor, [\r\n    'target',\r\n    'onQueryChange',\r\n    'onExecuteQuery',\r\n    ['events', { watchDepth: 'reference' }],\r\n    ['datasource', { watchDepth: 'reference' }],\r\n    ['templateSrv', { watchDepth: 'reference' }],\r\n  ]);\r\n  react2AngularDirective('stackdriverAnnotationQueryEditor', StackdriverAnnotationQueryEditor, [\r\n    'target',\r\n    'onQueryChange',\r\n    ['datasource', { watchDepth: 'reference' }],\r\n    ['templateSrv', { watchDepth: 'reference' }],\r\n  ]);\r\n  react2AngularDirective('cloudwatchAnnotationQueryEditor', CloudWatchAnnotationQueryEditor, [\r\n    'query',\r\n    'onChange',\r\n    ['datasource', { watchDepth: 'reference' }],\r\n  ]);\r\n  react2AngularDirective('secretFormField', SecretFormField, [\r\n    'value',\r\n    'isConfigured',\r\n    'inputWidth',\r\n    'labelWidth',\r\n    ['onReset', { watchDepth: 'reference', wrapApply: true }],\r\n    ['onChange', { watchDepth: 'reference', wrapApply: true }],\r\n  ]);\r\n  react2AngularDirective('graphContextMenu', GraphContextMenu, [\r\n    'x',\r\n    'y',\r\n    'items',\r\n    ['onClose', { watchDepth: 'reference', wrapApply: true }],\r\n    ['getContextMenuSource', { watchDepth: 'reference', wrapApply: true }],\r\n    ['formatSourceDate', { watchDepth: 'reference', wrapApply: true }],\r\n  ]);\r\n\r\n  // We keep the drilldown terminology here because of as using data-* directive\r\n  // being in conflict with HTML data attributes\r\n  react2AngularDirective('drilldownLinksEditor', DataLinksEditor, [\r\n    'value',\r\n    'suggestions',\r\n    ['onChange', { watchDepth: 'reference', wrapApply: true }],\r\n  ]);\r\n\r\n  react2AngularDirective('reactProfileWrapper', ReactProfileWrapper, []);\r\n\r\n  react2AngularDirective('lokiAnnotationsQueryEditor', LokiAnnotationsQueryEditor, [\r\n    'expr',\r\n    'onChange',\r\n    ['datasource', { watchDepth: 'reference' }],\r\n  ]);\r\n  react2AngularDirective('datasourceHttpSettingsNext', DataSourceHttpSettings, [\r\n    'defaultUrl',\r\n    'showAccessOptions',\r\n    'dataSourceConfig',\r\n    ['onChange', { watchDepth: 'reference', wrapApply: true }],\r\n  ]);\r\n}\r\n","import { Emitter } from './utils/emitter';\r\n\r\nexport const appEvents = new Emitter();\r\n\r\nexport default appEvents;\r\n","import React, { CSSProperties, FC } from 'react';\r\nimport Transition from 'react-transition-group/Transition';\r\n\r\ninterface Style {\r\n  transition?: string;\r\n  overflow?: string;\r\n}\r\n\r\n// When animating using max-height we need to use a static value.\r\n// If this is not enough, pass in <SlideDown maxHeight=\"....\r\nconst defaultMaxHeight = '200px';\r\nconst defaultDuration = 200;\r\n\r\nexport const defaultStyle: Style = {\r\n  transition: `max-height ${defaultDuration}ms ease-in-out`,\r\n  overflow: 'hidden',\r\n};\r\n\r\nexport interface Props {\r\n  children: React.ReactNode;\r\n  in: boolean;\r\n  maxHeight?: number;\r\n  style?: CSSProperties;\r\n}\r\n\r\nexport const SlideDown: FC<Props> = ({ children, in: inProp, maxHeight = defaultMaxHeight, style = defaultStyle }) => {\r\n  // There are 4 main states a Transition can be in:\r\n  // ENTERING, ENTERED, EXITING, EXITED\r\n  // https://reactcommunity.or[g/react-transition-group/\r\n  const transitionStyles: { [str: string]: CSSProperties } = {\r\n    exited: { maxHeight: 0 },\r\n    entering: { maxHeight: maxHeight },\r\n    entered: { maxHeight: 'unset', overflow: 'visible' },\r\n    exiting: { maxHeight: 0 },\r\n  };\r\n\r\n  return (\r\n    <Transition in={inProp} timeout={defaultDuration}>\r\n      {state => (\r\n        <div\r\n          style={{\r\n            ...style,\r\n            ...transitionStyles[state],\r\n          }}\r\n        >\r\n          {children}\r\n        </div>\r\n      )}\r\n    </Transition>\r\n  );\r\n};\r\n","import React, { Component } from 'react';\r\nimport { AppNotification } from 'app/types';\r\nimport { Alert } from '@grafana/ui';\r\n\r\ninterface Props {\r\n  appNotification: AppNotification;\r\n  onClearNotification: (id: number) => void;\r\n}\r\n\r\nexport default class AppNotificationItem extends Component<Props> {\r\n  shouldComponentUpdate(nextProps: Props) {\r\n    return this.props.appNotification.id !== nextProps.appNotification.id;\r\n  }\r\n\r\n  componentDidMount() {\r\n    const { appNotification, onClearNotification } = this.props;\r\n    setTimeout(() => {\r\n      onClearNotification(appNotification.id);\r\n    }, appNotification.timeout);\r\n  }\r\n\r\n  render() {\r\n    const { appNotification, onClearNotification } = this.props;\r\n\r\n    return (\r\n      <Alert\r\n        severity={appNotification.severity}\r\n        title={appNotification.title}\r\n        children={appNotification.component || appNotification.text}\r\n        onRemove={() => onClearNotification(appNotification.id)}\r\n      />\r\n    );\r\n  }\r\n}\r\n","import React, { PureComponent } from 'react';\r\nimport appEvents from 'app/core/app_events';\r\nimport AppNotificationItem from './AppNotificationItem';\r\nimport { notifyApp, clearAppNotification } from 'app/core/actions';\r\nimport { connectWithStore } from 'app/core/utils/connectWithReduxStore';\r\nimport { AppNotification, StoreState } from 'app/types';\r\n\r\nimport {\r\n  createErrorNotification,\r\n  createSuccessNotification,\r\n  createWarningNotification,\r\n} from '../../copy/appNotification';\r\nimport { AppEvents } from '@grafana/data';\r\n\r\nexport interface Props {\r\n  appNotifications: AppNotification[];\r\n  notifyApp: typeof notifyApp;\r\n  clearAppNotification: typeof clearAppNotification;\r\n}\r\n\r\nexport class AppNotificationList extends PureComponent<Props> {\r\n  componentDidMount() {\r\n    const { notifyApp } = this.props;\r\n\r\n    appEvents.on(AppEvents.alertWarning, payload => notifyApp(createWarningNotification(...payload)));\r\n    appEvents.on(AppEvents.alertSuccess, payload => notifyApp(createSuccessNotification(...payload)));\r\n    appEvents.on(AppEvents.alertError, payload => notifyApp(createErrorNotification(...payload)));\r\n  }\r\n\r\n  onClearAppNotification = (id: number) => {\r\n    this.props.clearAppNotification(id);\r\n  };\r\n\r\n  render() {\r\n    const { appNotifications } = this.props;\r\n\r\n    return (\r\n      <div>\r\n        {appNotifications.map((appNotification, index) => {\r\n          return (\r\n            <AppNotificationItem\r\n              key={`${appNotification.id}-${index}`}\r\n              appNotification={appNotification}\r\n              onClearNotification={id => this.onClearAppNotification(id)}\r\n            />\r\n          );\r\n        })}\r\n      </div>\r\n    );\r\n  }\r\n}\r\n\r\nconst mapStateToProps = (state: StoreState) => ({\r\n  appNotifications: state.appNotifications.appNotifications,\r\n});\r\n\r\nconst mapDispatchToProps = {\r\n  notifyApp,\r\n  clearAppNotification,\r\n};\r\n\r\nexport default connectWithStore(AppNotificationList, mapStateToProps, mapDispatchToProps);\r\n","import React, { FC } from 'react';\r\nimport { css, cx } from 'emotion';\r\n\r\nexport interface BrandComponentProps {\r\n  className?: string;\r\n  children?: JSX.Element | JSX.Element[];\r\n}\r\n\r\nexport const LoginLogo: FC<BrandComponentProps> = ({ className }) => {\r\n  const maxSize = css`\r\n    max-width: 150px;\r\n  `;\r\n\r\n  return (\r\n    <>\r\n      <img className={cx(className, maxSize)} src=\"public/img/grafana_icon.svg\" alt=\"Grafana\" />\r\n      <div className=\"logo-wordmark\" />\r\n    </>\r\n  );\r\n};\r\n\r\nexport const LoginBackground: FC<BrandComponentProps> = ({ className, children }) => {\r\n  const background = css`\r\n    background: url(public/img/heatmap_bg_test.svg);\r\n    background-size: cover;\r\n  `;\r\n\r\n  return <div className={cx(background, className)}>{children}</div>;\r\n};\r\n\r\nexport const MenuLogo: FC<BrandComponentProps> = ({ className }) => {\r\n  return <img className={className} src=\"public/img/grafana_icon.svg\" alt=\"Grafana\" />;\r\n};\r\n\r\nexport class Branding {\r\n  static LoginLogo = LoginLogo;\r\n  static LoginBackground = LoginBackground;\r\n  static MenuLogo = MenuLogo;\r\n}\r\n","import React, { FunctionComponent } from 'react';\r\nimport { Button, stylesFactory } from '@grafana/ui';\r\nimport { css } from 'emotion';\r\n\r\nconst getStyles = stylesFactory(() => {\r\n  return css`\r\n    width: 508px;\r\n    margin: 128px auto;\r\n  `;\r\n});\r\n\r\ninterface Props {\r\n  error: Error | null;\r\n}\r\n\r\nexport const ErrorLoadingChunk: FunctionComponent<Props> = ({ error }) => (\r\n  <div className={getStyles()}>\r\n    <h2>Unable to find application file</h2>\r\n    <br />\r\n    <h2 className=\"page-heading\">Grafana has likely been updated. Please try reloading the page.</h2>\r\n    <br />\r\n    <div className=\"gf-form-group\">\r\n      <Button size=\"md\" variant=\"secondary\" icon=\"fa fa-repeat\" onClick={() => window.location.reload()}>\r\n        Reload\r\n      </Button>\r\n    </div>\r\n    <details style={{ whiteSpace: 'pre-wrap' }}>\r\n      {error && error.message ? error.message : 'Unexpected error occurred'}\r\n      <br />\r\n      {error && error.stack ? error.stack : null}\r\n    </details>\r\n  </div>\r\n);\r\n\r\nErrorLoadingChunk.displayName = 'ErrorLoadingChunk';\r\n","import React, { FunctionComponent } from 'react';\nimport { LoadingPlaceholder } from '@grafana/ui';\n\nexport const LoadingChunkPlaceHolder: FunctionComponent = React.memo(() => (\n  <div className=\"preloader\">\n    <LoadingPlaceholder text={'Loading...'} />\n  </div>\n));\n\nLoadingChunkPlaceHolder.displayName = 'LoadingChunkPlaceHolder';\n","import React from 'react';\r\nimport Loadable from 'react-loadable';\r\nimport { LoadingChunkPlaceHolder } from './LoadingChunkPlaceHolder';\r\nimport { ErrorLoadingChunk } from './ErrorLoadingChunk';\r\n\r\nexport const loadComponentHandler = (props: { error: Error; pastDelay: boolean }) => {\r\n  const { error, pastDelay } = props;\r\n\r\n  if (error) {\r\n    return <ErrorLoadingChunk error={error} />;\r\n  }\r\n\r\n  if (pastDelay) {\r\n    return <LoadingChunkPlaceHolder />;\r\n  }\r\n\r\n  return null;\r\n};\r\n\r\nexport const SafeDynamicImport = (importStatement: Promise<any>) => ({ ...props }) => {\r\n  const LoadableComponent = Loadable({\r\n    loader: () => importStatement,\r\n    loading: loadComponentHandler,\r\n  });\r\n\r\n  return <LoadableComponent {...props} />;\r\n};\r\n","import React, { MouseEvent, useContext } from 'react';\r\nimport { CallToActionCard, LinkButton, ThemeContext } from '@grafana/ui';\r\nimport { css } from 'emotion';\r\n\r\nexport interface Props {\r\n  title: string;\r\n  buttonIcon: string;\r\n  buttonLink?: string;\r\n  buttonTitle: string;\r\n  onClick?: (event: MouseEvent) => void;\r\n  proTip?: string;\r\n  proTipLink?: string;\r\n  proTipLinkTitle?: string;\r\n  proTipTarget?: string;\r\n  infoBox?: { __html: string };\r\n  infoBoxTitle?: string;\r\n}\r\n\r\nconst ctaStyle = css`\r\n  text-align: center;\r\n`;\r\n\r\nconst infoBoxStyles = css`\r\n  max-width: 700px;\r\n  margin: 0 auto;\r\n`;\r\n\r\nconst EmptyListCTA: React.FunctionComponent<Props> = ({\r\n  title,\r\n  buttonIcon,\r\n  buttonLink,\r\n  buttonTitle,\r\n  onClick,\r\n  proTip,\r\n  proTipLink,\r\n  proTipLinkTitle,\r\n  proTipTarget,\r\n  infoBox,\r\n  infoBoxTitle,\r\n}) => {\r\n  const theme = useContext(ThemeContext);\r\n\r\n  const footer = () => {\r\n    return (\r\n      <>\r\n        {proTip ? (\r\n          <span key=\"proTipFooter\">\r\n            <i className=\"fa fa-rocket\" />\r\n            <> ProTip: {proTip} </>\r\n            <a href={proTipLink} target={proTipTarget} className=\"text-link\">\r\n              {proTipLinkTitle}\r\n            </a>\r\n          </span>\r\n        ) : (\r\n          ''\r\n        )}\r\n        {infoBox ? (\r\n          <div key=\"infoBoxHtml\" className={`grafana-info-box ${infoBoxStyles}`}>\r\n            {infoBoxTitle && <h5>{infoBoxTitle}</h5>}\r\n            <div dangerouslySetInnerHTML={infoBox} />\r\n          </div>\r\n        ) : (\r\n          ''\r\n        )}\r\n      </>\r\n    );\r\n  };\r\n\r\n  const ctaElementClassName = !footer()\r\n    ? css`\r\n        margin-bottom: 20px;\r\n      `\r\n    : '';\r\n\r\n  const ctaElement = (\r\n    <LinkButton\r\n      size=\"lg\"\r\n      onClick={onClick}\r\n      href={buttonLink}\r\n      icon={buttonIcon}\r\n      className={ctaElementClassName}\r\n      aria-label={`Call to action button ${buttonTitle}`}\r\n    >\r\n      {buttonTitle}\r\n    </LinkButton>\r\n  );\r\n\r\n  return (\r\n    <CallToActionCard\r\n      className={ctaStyle}\r\n      message={title}\r\n      footer={footer()}\r\n      callToActionElement={ctaElement}\r\n      theme={theme}\r\n    />\r\n  );\r\n};\r\n\r\nexport default EmptyListCTA;\r\n","import React, { FC } from 'react';\r\nimport config from 'app/core/config';\r\n\r\nexport interface FooterLink {\r\n  text: string;\r\n  icon?: string;\r\n  url?: string;\r\n  target?: string;\r\n}\r\n\r\nexport let getFooterLinks = (): FooterLink[] => {\r\n  return [\r\n    {\r\n      text: 'Documentation',\r\n      icon: 'fa fa-file-code-o',\r\n      url: 'https://grafana.com/docs/grafana/latest/?utm_source=grafana_footer',\r\n      target: '_blank',\r\n    },\r\n    {\r\n      text: 'Support',\r\n      icon: 'fa fa-support',\r\n      url: 'https://grafana.com/products/enterprise/?utm_source=grafana_footer',\r\n      target: '_blank',\r\n    },\r\n    {\r\n      text: 'Community',\r\n      icon: 'fa fa-comments-o',\r\n      url: 'https://community.grafana.com/?utm_source=grafana_footer',\r\n      target: '_blank',\r\n    },\r\n  ];\r\n};\r\n\r\nexport let getVersionLinks = (): FooterLink[] => {\r\n  const { buildInfo, licenseInfo } = config;\r\n  const links: FooterLink[] = [];\r\n  const stateInfo = licenseInfo.stateInfo ? ` (${licenseInfo.stateInfo})` : '';\r\n\r\n  links.push({ text: `${buildInfo.edition}${stateInfo}`, url: licenseInfo.licenseUrl });\r\n  links.push({ text: `v${buildInfo.version} (${buildInfo.commit})` });\r\n\r\n  if (buildInfo.hasUpdate) {\r\n    links.push({\r\n      text: `New version available!`,\r\n      icon: 'fa fa-download',\r\n      url: 'https://grafana.com/grafana/download?utm_source=grafana_footer',\r\n      target: '_blank',\r\n    });\r\n  }\r\n\r\n  return links;\r\n};\r\n\r\nexport function setFooterLinksFn(fn: typeof getFooterLinks) {\r\n  getFooterLinks = fn;\r\n}\r\n\r\nexport function setVersionLinkFn(fn: typeof getFooterLinks) {\r\n  getVersionLinks = fn;\r\n}\r\n\r\nexport const Footer: FC = React.memo(() => {\r\n  const links = getFooterLinks().concat(getVersionLinks());\r\n\r\n  return (\r\n    <footer className=\"footer\">\r\n      <div className=\"text-center\">\r\n        <ul>\r\n          {links.map(link => (\r\n            <li key={link.text}>\r\n              <a href={link.url} target=\"_blank\" rel=\"noopener\">\r\n                <i className={link.icon} /> {link.text}\r\n              </a>\r\n            </li>\r\n          ))}\r\n        </ul>\r\n      </div>\r\n    </footer>\r\n  );\r\n});\r\n","import React, { FC } from 'react';\r\n\r\nexport type LayoutMode = LayoutModes.Grid | LayoutModes.List;\r\n\r\nexport enum LayoutModes {\r\n  Grid = 'grid',\r\n  List = 'list',\r\n}\r\n\r\ninterface Props {\r\n  mode: LayoutMode;\r\n  onLayoutModeChanged: (mode: LayoutMode) => {};\r\n}\r\n\r\nconst LayoutSelector: FC<Props> = props => {\r\n  const { mode, onLayoutModeChanged } = props;\r\n  return (\r\n    <div className=\"layout-selector\">\r\n      <button\r\n        onClick={() => {\r\n          onLayoutModeChanged(LayoutModes.List);\r\n        }}\r\n        className={mode === LayoutModes.List ? 'active' : ''}\r\n      >\r\n        <i className=\"fa fa-list\" />\r\n      </button>\r\n      <button\r\n        onClick={() => {\r\n          onLayoutModeChanged(LayoutModes.Grid);\r\n        }}\r\n        className={mode === LayoutModes.Grid ? 'active' : ''}\r\n      >\r\n        <i className=\"fa fa-th\" />\r\n      </button>\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default LayoutSelector;\r\n","import React, { PureComponent } from 'react';\r\nimport store from '../../store';\r\n\r\nexport interface Props<T> {\r\n  storageKey: string;\r\n  defaultValue?: T;\r\n  children: (value: T, onSaveToStore: (value: T) => void) => React.ReactNode;\r\n}\r\n\r\ninterface State<T> {\r\n  value: T;\r\n}\r\n\r\nexport class LocalStorageValueProvider<T> extends PureComponent<Props<T>, State<T>> {\r\n  constructor(props: Props<T>) {\r\n    super(props);\r\n\r\n    const { storageKey, defaultValue } = props;\r\n\r\n    this.state = {\r\n      value: store.getObject(storageKey, defaultValue),\r\n    };\r\n  }\r\n\r\n  onSaveToStore = (value: T) => {\r\n    const { storageKey } = this.props;\r\n    store.setObject(storageKey, value);\r\n    this.setState({ value });\r\n  };\r\n\r\n  render() {\r\n    const { children } = this.props;\r\n    const { value } = this.state;\r\n\r\n    return <>{children(value, this.onSaveToStore)}</>;\r\n  }\r\n}\r\n","export { LocalStorageValueProvider } from './LocalStorageValueProvider';\n","import React, { ChangeEvent, PureComponent, SyntheticEvent } from 'react';\r\nimport { Tooltip } from '@grafana/ui';\r\nimport { AppEvents } from '@grafana/data';\r\nimport { e2e } from '@grafana/e2e';\r\n\r\nimport appEvents from 'app/core/app_events';\r\n\r\ninterface Props {\r\n  onSubmit: (pw: string) => void;\r\n  onSkip: Function;\r\n  focus?: boolean;\r\n}\r\n\r\ninterface State {\r\n  newPassword: string;\r\n  confirmNew: string;\r\n  valid: boolean;\r\n}\r\n\r\nexport class ChangePassword extends PureComponent<Props, State> {\r\n  private userInput: HTMLInputElement;\r\n  constructor(props: Props) {\r\n    super(props);\r\n    this.state = {\r\n      newPassword: '',\r\n      confirmNew: '',\r\n      valid: false,\r\n    };\r\n  }\r\n\r\n  componentDidUpdate(prevProps: Props) {\r\n    if (!prevProps.focus && this.props.focus) {\r\n      this.focus();\r\n    }\r\n  }\r\n\r\n  focus() {\r\n    this.userInput.focus();\r\n  }\r\n\r\n  onSubmit = (e: SyntheticEvent) => {\r\n    e.preventDefault();\r\n\r\n    const { newPassword, valid } = this.state;\r\n    if (valid) {\r\n      this.props.onSubmit(newPassword);\r\n    } else {\r\n      appEvents.emit(AppEvents.alertWarning, ['New passwords do not match']);\r\n    }\r\n  };\r\n\r\n  onNewPasswordChange = (e: ChangeEvent<HTMLInputElement>) => {\r\n    this.setState({\r\n      newPassword: e.target.value,\r\n      valid: this.validate('newPassword', e.target.value),\r\n    });\r\n  };\r\n\r\n  onConfirmPasswordChange = (e: ChangeEvent<HTMLInputElement>) => {\r\n    this.setState({\r\n      confirmNew: e.target.value,\r\n      valid: this.validate('confirmNew', e.target.value),\r\n    });\r\n  };\r\n\r\n  onSkip = (e: SyntheticEvent) => {\r\n    this.props.onSkip();\r\n  };\r\n\r\n  validate(changed: string, pw: string) {\r\n    if (changed === 'newPassword') {\r\n      return this.state.confirmNew === pw;\r\n    } else if (changed === 'confirmNew') {\r\n      return this.state.newPassword === pw;\r\n    }\r\n    return false;\r\n  }\r\n\r\n  render() {\r\n    return (\r\n      <div className=\"login-inner-box\" id=\"change-password-view\">\r\n        <div className=\"text-left login-change-password-info\">\r\n          <h5>Change Password</h5>\r\n          Before you can get started with awesome dashboards we need you to make your account more secure by changing\r\n          your password.\r\n          <br />\r\n          You can change your password again later.\r\n        </div>\r\n        <form className=\"login-form-group gf-form-group\">\r\n          <div className=\"login-form\">\r\n            <input\r\n              type=\"password\"\r\n              id=\"newPassword\"\r\n              name=\"newPassword\"\r\n              className=\"gf-form-input login-form-input\"\r\n              required\r\n              placeholder=\"New password\"\r\n              onChange={this.onNewPasswordChange}\r\n              ref={input => {\r\n                this.userInput = input;\r\n              }}\r\n            />\r\n          </div>\r\n          <div className=\"login-form\">\r\n            <input\r\n              type=\"password\"\r\n              name=\"confirmNew\"\r\n              className=\"gf-form-input login-form-input\"\r\n              required\r\n              ng-model=\"command.confirmNew\"\r\n              placeholder=\"Confirm new password\"\r\n              onChange={this.onConfirmPasswordChange}\r\n            />\r\n          </div>\r\n          <div className=\"login-button-group login-button-group--right text-right\">\r\n            <Tooltip\r\n              placement=\"bottom\"\r\n              content=\"If you skip you will be prompted to change password next time you login.\"\r\n            >\r\n              <a className=\"btn btn-link\" onClick={this.onSkip} aria-label={e2e.pages.Login.selectors.skip}>\r\n                Skip\r\n              </a>\r\n            </Tooltip>\r\n\r\n            <button\r\n              type=\"submit\"\r\n              className={`btn btn-large p-x-2 ${this.state.valid ? 'btn-primary' : 'btn-inverse'}`}\r\n              onClick={this.onSubmit}\r\n              disabled={!this.state.valid}\r\n            >\r\n              Save\r\n            </button>\r\n          </div>\r\n        </form>\r\n      </div>\r\n    );\r\n  }\r\n}\r\n","import React from 'react';\r\nimport config from 'app/core/config';\r\n\r\nimport { updateLocation } from 'app/core/actions';\r\nimport { connect } from 'react-redux';\r\nimport { StoreState } from 'app/types';\r\nimport { PureComponent } from 'react';\r\nimport { getBackendSrv } from '@grafana/runtime';\r\nimport { hot } from 'react-hot-loader';\r\nimport appEvents from 'app/core/app_events';\r\nimport { AppEvents } from '@grafana/data';\r\n\r\nconst isOauthEnabled = () => {\r\n  return !!config.oauth && Object.keys(config.oauth).length > 0;\r\n};\r\n\r\nexport interface FormModel {\r\n  user: string;\r\n  password: string;\r\n  email: string;\r\n}\r\ninterface Props {\r\n  routeParams?: any;\r\n  updateLocation?: typeof updateLocation;\r\n  children: (props: {\r\n    isLoggingIn: boolean;\r\n    changePassword: (pw: string) => void;\r\n    isChangingPassword: boolean;\r\n    skipPasswordChange: Function;\r\n    login: (data: FormModel) => void;\r\n    disableLoginForm: boolean;\r\n    ldapEnabled: boolean;\r\n    authProxyEnabled: boolean;\r\n    disableUserSignUp: boolean;\r\n    isOauthEnabled: boolean;\r\n    loginHint: string;\r\n    passwordHint: string;\r\n  }) => JSX.Element;\r\n}\r\n\r\ninterface State {\r\n  isLoggingIn: boolean;\r\n  isChangingPassword: boolean;\r\n}\r\n\r\nexport class LoginCtrl extends PureComponent<Props, State> {\r\n  result: any = {};\r\n  constructor(props: Props) {\r\n    super(props);\r\n    this.state = {\r\n      isLoggingIn: false,\r\n      isChangingPassword: false,\r\n    };\r\n\r\n    if (config.loginError) {\r\n      appEvents.emit(AppEvents.alertWarning, ['Login Failed', config.loginError]);\r\n    }\r\n  }\r\n\r\n  changePassword = (password: string) => {\r\n    const pw = {\r\n      newPassword: password,\r\n      confirmNew: password,\r\n      oldPassword: 'admin',\r\n    };\r\n    getBackendSrv()\r\n      .put('/api/user/password', pw)\r\n      .then(() => {\r\n        this.toGrafana();\r\n      })\r\n      .catch((err: any) => console.log(err));\r\n  };\r\n\r\n  login = (formModel: FormModel) => {\r\n    this.setState({\r\n      isLoggingIn: true,\r\n    });\r\n\r\n    getBackendSrv()\r\n      .post('/login', formModel)\r\n      .then((result: any) => {\r\n        this.result = result;\r\n        if (formModel.password !== 'admin' || config.ldapEnabled || config.authProxyEnabled) {\r\n          this.toGrafana();\r\n          return;\r\n        } else {\r\n          this.changeView();\r\n        }\r\n      })\r\n      .catch(() => {\r\n        this.setState({\r\n          isLoggingIn: false,\r\n        });\r\n      });\r\n  };\r\n\r\n  changeView = () => {\r\n    this.setState({\r\n      isChangingPassword: true,\r\n    });\r\n  };\r\n\r\n  toGrafana = () => {\r\n    const params = this.props.routeParams;\r\n    // Use window.location.href to force page reload\r\n    if (params.redirect && params.redirect[0] === '/') {\r\n      window.location.href = config.appSubUrl + params.redirect;\r\n    } else if (this.result.redirectUrl) {\r\n      window.location.href = config.appSubUrl + this.result.redirectUrl;\r\n    } else {\r\n      window.location.href = config.appSubUrl + '/';\r\n    }\r\n  };\r\n\r\n  render() {\r\n    const { children } = this.props;\r\n    const { isLoggingIn, isChangingPassword } = this.state;\r\n    const { login, toGrafana, changePassword } = this;\r\n    const { loginHint, passwordHint, disableLoginForm, ldapEnabled, authProxyEnabled, disableUserSignUp } = config;\r\n\r\n    return (\r\n      <>\r\n        {children({\r\n          isOauthEnabled: isOauthEnabled(),\r\n          loginHint,\r\n          passwordHint,\r\n          disableLoginForm,\r\n          ldapEnabled,\r\n          authProxyEnabled,\r\n          disableUserSignUp,\r\n          login,\r\n          isLoggingIn,\r\n          changePassword,\r\n          skipPasswordChange: toGrafana,\r\n          isChangingPassword,\r\n        })}\r\n      </>\r\n    );\r\n  }\r\n}\r\n\r\nexport const mapStateToProps = (state: StoreState) => ({\r\n  routeParams: state.location.routeParams,\r\n});\r\n\r\nconst mapDispatchToProps = { updateLocation };\r\n\r\nexport default hot(module)(connect(mapStateToProps, mapDispatchToProps)(LoginCtrl));\r\n","import React, { ChangeEvent, PureComponent, SyntheticEvent } from 'react';\r\nimport { e2e } from '@grafana/e2e';\r\n\r\nimport { FormModel } from './LoginCtrl';\r\n\r\ninterface Props {\r\n  displayForgotPassword: boolean;\r\n  onChange?: (valid: boolean) => void;\r\n  onSubmit: (data: FormModel) => void;\r\n  isLoggingIn: boolean;\r\n  passwordHint: string;\r\n  loginHint: string;\r\n}\r\n\r\ninterface State {\r\n  user: string;\r\n  password: string;\r\n  email: string;\r\n  valid: boolean;\r\n}\r\n\r\nexport class LoginForm extends PureComponent<Props, State> {\r\n  private userInput: HTMLInputElement;\r\n  constructor(props: Props) {\r\n    super(props);\r\n    this.state = {\r\n      user: '',\r\n      password: '',\r\n      email: '',\r\n      valid: false,\r\n    };\r\n  }\r\n\r\n  componentDidMount() {\r\n    this.userInput.focus();\r\n  }\r\n  onSubmit = (e: SyntheticEvent) => {\r\n    e.preventDefault();\r\n\r\n    const { user, password, email } = this.state;\r\n    if (this.state.valid) {\r\n      this.props.onSubmit({ user, password, email });\r\n    }\r\n  };\r\n\r\n  onChangePassword = (e: ChangeEvent<HTMLInputElement>) => {\r\n    this.setState({\r\n      password: e.target.value,\r\n      valid: this.validate(this.state.user, e.target.value),\r\n    });\r\n  };\r\n\r\n  onChangeUsername = (e: ChangeEvent<HTMLInputElement>) => {\r\n    this.setState({\r\n      user: e.target.value,\r\n      valid: this.validate(e.target.value, this.state.password),\r\n    });\r\n  };\r\n\r\n  validate(user: string, password: string) {\r\n    return user.length > 0 && password.length > 0;\r\n  }\r\n\r\n  render() {\r\n    return (\r\n      <form name=\"loginForm\" className=\"login-form-group gf-form-group\">\r\n        <div className=\"login-form\">\r\n          <input\r\n            ref={input => {\r\n              this.userInput = input;\r\n            }}\r\n            type=\"text\"\r\n            name=\"user\"\r\n            className=\"gf-form-input login-form-input\"\r\n            required\r\n            placeholder={this.props.loginHint}\r\n            aria-label={e2e.pages.Login.selectors.username}\r\n            onChange={this.onChangeUsername}\r\n          />\r\n        </div>\r\n        <div className=\"login-form\">\r\n          <input\r\n            type=\"password\"\r\n            name=\"password\"\r\n            className=\"gf-form-input login-form-input\"\r\n            required\r\n            ng-model=\"formModel.password\"\r\n            id=\"inputPassword\"\r\n            placeholder={this.props.passwordHint}\r\n            aria-label={e2e.pages.Login.selectors.password}\r\n            onChange={this.onChangePassword}\r\n          />\r\n        </div>\r\n        <div className=\"login-button-group\">\r\n          {!this.props.isLoggingIn ? (\r\n            <button\r\n              type=\"submit\"\r\n              aria-label={e2e.pages.Login.selectors.submit}\r\n              className={`btn btn-large p-x-2 ${this.state.valid ? 'btn-primary' : 'btn-inverse'}`}\r\n              onClick={this.onSubmit}\r\n              disabled={!this.state.valid}\r\n            >\r\n              Log In\r\n            </button>\r\n          ) : (\r\n            <button type=\"submit\" className=\"btn btn-large p-x-2 btn-inverse btn-loading\">\r\n              Logging In<span>.</span>\r\n              <span>.</span>\r\n              <span>.</span>\r\n            </button>\r\n          )}\r\n\r\n          {this.props.displayForgotPassword ? (\r\n            <div className=\"small login-button-forgot-password\">\r\n              <a href=\"user/password/send-reset-email\">Forgot your password?</a>\r\n            </div>\r\n          ) : null}\r\n        </div>\r\n      </form>\r\n    );\r\n  }\r\n}\r\n","// Libraries\r\nimport React, { FC } from 'react';\r\nimport { CSSTransition } from 'react-transition-group';\r\n\r\n// Components\r\nimport { UserSignup } from './UserSignup';\r\nimport { LoginServiceButtons } from './LoginServiceButtons';\r\nimport LoginCtrl from './LoginCtrl';\r\nimport { LoginForm } from './LoginForm';\r\nimport { ChangePassword } from './ChangePassword';\r\nimport { Branding } from 'app/core/components/Branding/Branding';\r\nimport { Footer } from 'app/core/components/Footer/Footer';\r\n\r\nexport const LoginPage: FC = () => {\r\n  return (\r\n    <Branding.LoginBackground className=\"login container\">\r\n      <div className=\"login-content\">\r\n        <div className=\"login-branding\">\r\n          <Branding.LoginLogo className=\"login-logo\" />\r\n        </div>\r\n        <LoginCtrl>\r\n          {({\r\n            loginHint,\r\n            passwordHint,\r\n            isOauthEnabled,\r\n            ldapEnabled,\r\n            authProxyEnabled,\r\n            disableLoginForm,\r\n            disableUserSignUp,\r\n            login,\r\n            isLoggingIn,\r\n            changePassword,\r\n            skipPasswordChange,\r\n            isChangingPassword,\r\n          }) => (\r\n            <div className=\"login-outer-box\">\r\n              <div className={`login-inner-box ${isChangingPassword ? 'hidden' : ''}`} id=\"login-view\">\r\n                {!disableLoginForm ? (\r\n                  <LoginForm\r\n                    displayForgotPassword={!(ldapEnabled || authProxyEnabled)}\r\n                    onSubmit={login}\r\n                    loginHint={loginHint}\r\n                    passwordHint={passwordHint}\r\n                    isLoggingIn={isLoggingIn}\r\n                  />\r\n                ) : null}\r\n\r\n                <LoginServiceButtons />\r\n                {!disableUserSignUp ? <UserSignup /> : null}\r\n              </div>\r\n              <CSSTransition\r\n                appear={true}\r\n                mountOnEnter={true}\r\n                in={isChangingPassword}\r\n                timeout={250}\r\n                classNames=\"login-inner-box\"\r\n              >\r\n                <ChangePassword onSubmit={changePassword} onSkip={skipPasswordChange} focus={isChangingPassword} />\r\n              </CSSTransition>\r\n            </div>\r\n          )}\r\n        </LoginCtrl>\r\n\r\n        <div className=\"clearfix\" />\r\n      </div>\r\n      <Footer />\r\n    </Branding.LoginBackground>\r\n  );\r\n};\r\n","import React from 'react';\r\nimport config from 'app/core/config';\r\n\r\nconst loginServices: () => LoginServices = () => {\r\n  const oauthEnabled = !!config.oauth;\r\n\r\n  return {\r\n    saml: {\r\n      enabled: config.samlEnabled,\r\n      name: 'SAML',\r\n      className: 'github',\r\n      icon: 'key',\r\n    },\r\n    google: {\r\n      enabled: oauthEnabled && config.oauth.google,\r\n      name: 'Google',\r\n    },\r\n    github: {\r\n      enabled: oauthEnabled && config.oauth.github,\r\n      name: 'GitHub',\r\n    },\r\n    gitlab: {\r\n      enabled: oauthEnabled && config.oauth.gitlab,\r\n      name: 'GitLab',\r\n    },\r\n    grafanacom: {\r\n      enabled: oauthEnabled && config.oauth.grafana_com,\r\n      name: 'Grafana.com',\r\n      hrefName: 'grafana_com',\r\n      icon: 'grafana_com',\r\n    },\r\n    oauth: {\r\n      enabled: oauthEnabled && config.oauth.generic_oauth,\r\n      name: oauthEnabled && config.oauth.generic_oauth ? config.oauth.generic_oauth.name : 'OAuth',\r\n      icon: 'sign-in',\r\n      hrefName: 'generic_oauth',\r\n    },\r\n  };\r\n};\r\n\r\nexport interface LoginService {\r\n  enabled: boolean;\r\n  name: string;\r\n  hrefName?: string;\r\n  icon?: string;\r\n  className?: string;\r\n}\r\n\r\nexport interface LoginServices {\r\n  [key: string]: LoginService;\r\n}\r\n\r\nconst LoginDivider = () => {\r\n  return (\r\n    <>\r\n      <div className=\"text-center login-divider\">\r\n        <div>\r\n          <div className=\"login-divider-line\" />\r\n        </div>\r\n        <div>\r\n          <span className=\"login-divider-text\">{config.disableLoginForm ? null : <span>or</span>}</span>\r\n        </div>\r\n        <div>\r\n          <div className=\"login-divider-line\" />\r\n        </div>\r\n      </div>\r\n      <div className=\"clearfix\" />\r\n    </>\r\n  );\r\n};\r\n\r\nexport const LoginServiceButtons = () => {\r\n  const keyNames = Object.keys(loginServices());\r\n  const serviceElementsEnabled = keyNames.filter(key => {\r\n    const service: LoginService = loginServices()[key];\r\n    return service.enabled;\r\n  });\r\n\r\n  if (serviceElementsEnabled.length === 0) {\r\n    return null;\r\n  }\r\n\r\n  const serviceElements = serviceElementsEnabled.map(key => {\r\n    const service: LoginService = loginServices()[key];\r\n    const showbutton = false; //\r\n    if (showbutton) {\r\n      //\r\n      return (\r\n        <a\r\n          key={key}\r\n          className={`btn btn-medium btn-service btn-service--${service.className || key} login-btn`}\r\n          href={`login/${service.hrefName ? service.hrefName : key}`}\r\n          target=\"_self\"\r\n        >\r\n          <i className={`btn-service-icon fa fa-${service.icon ? service.icon : key}`} />\r\n          Sign in with {service.name}\r\n        </a>\r\n      );\r\n    } else {\r\n      //\r\n      return null; //\r\n    } //\r\n  });\r\n\r\n  const divider = LoginDivider();\r\n  return (\r\n    <>\r\n      {divider}\r\n      <div className=\"login-oauth text-center\">{serviceElements}</div>\r\n    </>\r\n  );\r\n};\r\n","import React, { FC } from 'react';\r\n\r\nexport const UserSignup: FC<{}> = () => {\r\n  return (\r\n    <div className=\"login-signup-box\">\r\n      <div className=\"login-signup-title p-r-1\">New to Grafana?</div>\r\n      <a href=\"signup\" className=\"btn btn-medium btn-signup btn-p-x-2\">\r\n        Sign Up\r\n      </a>\r\n    </div>\r\n  );\r\n};\r\n","import React from 'react';\r\n\r\nimport { getBackendSrv } from '@grafana/runtime';\r\nimport { UserOrgDTO } from '@grafana/data';\r\nimport { Modal, Button } from '@grafana/ui';\r\n\r\nimport { contextSrv } from 'app/core/services/context_srv';\r\nimport config from 'app/core/config';\r\n\r\ninterface Props {\r\n  onDismiss: () => void;\r\n}\r\n\r\ninterface State {\r\n  orgs: UserOrgDTO[];\r\n}\r\n\r\nexport class OrgSwitcher extends React.PureComponent<Props, State> {\r\n  state: State = {\r\n    orgs: [],\r\n  };\r\n\r\n  componentDidMount() {\r\n    this.getUserOrgs();\r\n  }\r\n\r\n  getUserOrgs = async () => {\r\n    const orgs: UserOrgDTO[] = await getBackendSrv().get('/api/user/orgs');\r\n    this.setState({\r\n      orgs: orgs.sort((a, b) => a.orgId - b.orgId),\r\n    });\r\n  };\r\n\r\n  setCurrentOrg = async (org: UserOrgDTO) => {\r\n    await getBackendSrv().post(`/api/user/using/${org.orgId}`);\r\n    this.setWindowLocation(`${config.appSubUrl}${config.appSubUrl.endsWith('/') ? '' : '/'}?orgId=${org.orgId}`);\r\n  };\r\n\r\n  setWindowLocation(href: string) {\r\n    window.location.href = href;\r\n  }\r\n\r\n  render() {\r\n    const { onDismiss } = this.props;\r\n    const { orgs } = this.state;\r\n\r\n    const currentOrgId = contextSrv.user.orgId;\r\n\r\n    return (\r\n      <Modal title=\"Switch Organization\" icon=\"random\" onDismiss={onDismiss} isOpen={true}>\r\n        <table className=\"filter-table form-inline\">\r\n          <thead>\r\n            <tr>\r\n              <th>Name</th>\r\n              <th>Role</th>\r\n              <th />\r\n            </tr>\r\n          </thead>\r\n          <tbody>\r\n            {orgs.map(org => (\r\n              <tr key={org.orgId}>\r\n                <td>{org.name}</td>\r\n                <td>{org.role}</td>\r\n                <td className=\"text-right\">\r\n                  {org.orgId === currentOrgId ? (\r\n                    <Button size=\"sm\">Current</Button>\r\n                  ) : (\r\n                    <Button variant=\"inverse\" size=\"sm\" onClick={() => this.setCurrentOrg(org)}>\r\n                      Switch to\r\n                    </Button>\r\n                  )}\r\n                </td>\r\n              </tr>\r\n            ))}\r\n          </tbody>\r\n        </table>\r\n      </Modal>\r\n    );\r\n  }\r\n}\r\n","// Libraries\r\nimport React, { Component } from 'react';\r\nimport { getTitleFromNavModel } from 'app/core/selectors/navModel';\r\n\r\n// Components\r\nimport PageHeader from '../PageHeader/PageHeader';\r\nimport { Footer } from '../Footer/Footer';\r\nimport PageContents from './PageContents';\r\nimport { CustomScrollbar } from '@grafana/ui';\r\nimport { NavModel } from '@grafana/data';\r\nimport { isEqual } from 'lodash';\r\n\r\ninterface Props {\r\n  children: JSX.Element[] | JSX.Element;\r\n  navModel: NavModel;\r\n}\r\n\r\nclass Page extends Component<Props> {\r\n  static Header = PageHeader;\r\n  static Contents = PageContents;\r\n\r\n  componentDidMount() {\r\n    this.updateTitle();\r\n  }\r\n\r\n  componentDidUpdate(prevProps: Props) {\r\n    if (!isEqual(prevProps.navModel, this.props.navModel)) {\r\n      this.updateTitle();\r\n    }\r\n  }\r\n\r\n  updateTitle = () => {\r\n    const title = this.getPageTitle;\r\n    document.title = title ? title + ' - Grafana' : 'Grafana';\r\n  };\r\n\r\n  get getPageTitle() {\r\n    const { navModel } = this.props;\r\n    if (navModel) {\r\n      return getTitleFromNavModel(navModel) || undefined;\r\n    }\r\n    return undefined;\r\n  }\r\n\r\n  render() {\r\n    const { navModel } = this.props;\r\n    return (\r\n      <div className=\"page-scrollbar-wrapper\">\r\n        <CustomScrollbar autoHeightMin={'100%'} className=\"custom-scrollbar--page\">\r\n          <div className=\"page-scrollbar-content\">\r\n            <PageHeader model={navModel} />\r\n            {this.props.children}\r\n            <Footer />\r\n          </div>\r\n        </CustomScrollbar>\r\n      </div>\r\n    );\r\n  }\r\n}\r\n\r\nexport default Page;\r\n","// Libraries\r\nimport React, { Component } from 'react';\r\n\r\n// Components\r\nimport PageLoader from '../PageLoader/PageLoader';\r\n\r\ninterface Props {\r\n  isLoading?: boolean;\r\n  children: JSX.Element[] | JSX.Element;\r\n}\r\n\r\nclass PageContents extends Component<Props> {\r\n  render() {\r\n    const { isLoading } = this.props;\r\n\r\n    return <div className=\"page-container page-body\">{isLoading ? <PageLoader /> : this.props.children}</div>;\r\n  }\r\n}\r\n\r\nexport default PageContents;\r\n","import React, { FormEvent } from 'react';\r\nimport { Tab, TabsBar } from '@grafana/ui';\r\nimport appEvents from 'app/core/app_events';\r\nimport { NavModel, NavModelItem, NavModelBreadcrumb } from '@grafana/data';\r\nimport { CoreEvents } from 'app/types';\r\n\r\nexport interface Props {\r\n  model: NavModel;\r\n}\r\n\r\nconst SelectNav = ({ main, customCss }: { main: NavModelItem; customCss: string }) => {\r\n  const defaultSelectedItem = main.children.find(navItem => {\r\n    return navItem.active === true;\r\n  });\r\n\r\n  const gotoUrl = (evt: FormEvent) => {\r\n    const element = evt.target as HTMLSelectElement;\r\n    const url = element.options[element.selectedIndex].value;\r\n    appEvents.emit(CoreEvents.locationChange, { href: url });\r\n  };\r\n\r\n  return (\r\n    <div className={`gf-form-select-wrapper width-20 ${customCss}`}>\r\n      <label className={`gf-form-select-icon ${defaultSelectedItem.icon}`} htmlFor=\"page-header-select-nav\" />\r\n      {/* Label to make it clickable */}\r\n      <select\r\n        className=\"gf-select-nav gf-form-input\"\r\n        value={defaultSelectedItem.url}\r\n        onChange={gotoUrl}\r\n        id=\"page-header-select-nav\"\r\n      >\r\n        {main.children.map((navItem: NavModelItem) => {\r\n          if (navItem.hideFromTabs) {\r\n            // TODO: Rename hideFromTabs => hideFromNav\r\n            return null;\r\n          }\r\n          return (\r\n            <option key={navItem.url} value={navItem.url}>\r\n              {navItem.text}\r\n            </option>\r\n          );\r\n        })}\r\n      </select>\r\n    </div>\r\n  );\r\n};\r\n\r\nconst Navigation = ({ main }: { main: NavModelItem }) => {\r\n  const goToUrl = (index: number) => {\r\n    main.children.forEach((child, i) => {\r\n      if (i === index) {\r\n        appEvents.emit(CoreEvents.locationChange, { href: child.url });\r\n      }\r\n    });\r\n  };\r\n\r\n  return (\r\n    <nav>\r\n      <SelectNav customCss=\"page-header__select-nav\" main={main} />\r\n      <TabsBar className=\"page-header__tabs\" hideBorder={true}>\r\n        {main.children.map((child, index) => {\r\n          return (\r\n            <Tab\r\n              label={child.text}\r\n              active={child.active}\r\n              key={`${child.url}-${index}`}\r\n              icon={child.icon}\r\n              onChangeTab={() => goToUrl(index)}\r\n            />\r\n          );\r\n        })}\r\n      </TabsBar>\r\n    </nav>\r\n  );\r\n};\r\n\r\nexport default class PageHeader extends React.Component<Props, any> {\r\n  constructor(props: Props) {\r\n    super(props);\r\n  }\r\n\r\n  shouldComponentUpdate() {\r\n    //Hack to re-render on changed props from angular with the @observer decorator\r\n    return true;\r\n  }\r\n\r\n  renderTitle(title: string, breadcrumbs: NavModelBreadcrumb[]) {\r\n    if (!title && (!breadcrumbs || breadcrumbs.length === 0)) {\r\n      return null;\r\n    }\r\n\r\n    if (!breadcrumbs || breadcrumbs.length === 0) {\r\n      return <h1 className=\"page-header__title\">{title}</h1>;\r\n    }\r\n\r\n    const breadcrumbsResult = [];\r\n    for (const bc of breadcrumbs) {\r\n      if (bc.url) {\r\n        breadcrumbsResult.push(\r\n          <a className=\"text-link\" key={breadcrumbsResult.length} href={bc.url}>\r\n            {bc.title}\r\n          </a>\r\n        );\r\n      } else {\r\n        breadcrumbsResult.push(<span key={breadcrumbsResult.length}> / {bc.title}</span>);\r\n      }\r\n    }\r\n    breadcrumbsResult.push(<span key={breadcrumbs.length + 1}> / {title}</span>);\r\n\r\n    return <h1 className=\"page-header__title\">{breadcrumbsResult}</h1>;\r\n  }\r\n\r\n  renderHeaderTitle(main: NavModelItem) {\r\n    return (\r\n      <div className=\"page-header__inner\">\r\n        <span className=\"page-header__logo\">\r\n          {main.icon && <i className={`page-header__icon ${main.icon}`} />}\r\n          {main.img && <img className=\"page-header__img\" src={main.img} />}\r\n        </span>\r\n\r\n        <div className=\"page-header__info-block\">\r\n          {this.renderTitle(main.text, main.breadcrumbs)}\r\n          {main.subTitle && <div className=\"page-header__sub-title\">{main.subTitle}</div>}\r\n        </div>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  render() {\r\n    const { model } = this.props;\r\n\r\n    if (!model) {\r\n      return null;\r\n    }\r\n\r\n    const main = model.main;\r\n\r\n    return (\r\n      <div className=\"page-header-canvas\">\r\n        <div className=\"page-container\">\r\n          <div className=\"page-header\">\r\n            {this.renderHeaderTitle(main)}\r\n            {main.children && <Navigation main={main} />}\r\n          </div>\r\n        </div>\r\n      </div>\r\n    );\r\n  }\r\n}\r\n","import React, { FC } from 'react';\nimport { LoadingPlaceholder } from '@grafana/ui';\n\ninterface Props {\n  pageName?: string;\n}\n\nconst PageLoader: FC<Props> = ({ pageName = '' }) => {\n  const loadingText = `Loading ${pageName}...`;\n  return (\n    <div className=\"page-loader-wrapper\">\n      <LoadingPlaceholder text={loadingText} />\n    </div>\n  );\n};\n\nexport default PageLoader;\n","import React, { Component } from 'react';\r\nimport { UserPicker } from 'app/core/components/Select/UserPicker';\r\nimport { TeamPicker, Team } from 'app/core/components/Select/TeamPicker';\r\nimport { Select } from '@grafana/ui';\r\nimport { SelectableValue } from '@grafana/data';\r\nimport { User } from 'app/types';\r\nimport {\r\n  dashboardPermissionLevels,\r\n  dashboardAclTargets,\r\n  AclTarget,\r\n  PermissionLevel,\r\n  NewDashboardAclItem,\r\n  OrgRole,\r\n} from 'app/types/acl';\r\n\r\nexport interface Props {\r\n  onAddPermission: (item: NewDashboardAclItem) => void;\r\n  onCancel: () => void;\r\n}\r\n\r\nclass AddPermissions extends Component<Props, NewDashboardAclItem> {\r\n  static defaultProps = {\r\n    showPermissionLevels: true,\r\n  };\r\n\r\n  constructor(props: Props) {\r\n    super(props);\r\n    this.state = this.getCleanState();\r\n  }\r\n\r\n  getCleanState() {\r\n    return {\r\n      userId: 0,\r\n      teamId: 0,\r\n      type: AclTarget.Team,\r\n      permission: PermissionLevel.View,\r\n    };\r\n  }\r\n\r\n  onTypeChanged = (evt: any) => {\r\n    const type = evt.target.value as AclTarget;\r\n\r\n    switch (type) {\r\n      case AclTarget.User:\r\n      case AclTarget.Team:\r\n        this.setState({ type: type, userId: 0, teamId: 0, role: undefined });\r\n        break;\r\n      case AclTarget.Editor:\r\n        this.setState({ type: type, userId: 0, teamId: 0, role: OrgRole.Editor });\r\n        break;\r\n      case AclTarget.Viewer:\r\n        this.setState({ type: type, userId: 0, teamId: 0, role: OrgRole.Viewer });\r\n        break;\r\n    }\r\n  };\r\n\r\n  onUserSelected = (user: User) => {\r\n    this.setState({ userId: user && !Array.isArray(user) ? user.id : 0 });\r\n  };\r\n\r\n  onTeamSelected = (team: Team) => {\r\n    this.setState({ teamId: team && !Array.isArray(team) ? team.id : 0 });\r\n  };\r\n\r\n  onPermissionChanged = (permission: SelectableValue<PermissionLevel>) => {\r\n    this.setState({ permission: permission.value });\r\n  };\r\n\r\n  onSubmit = async (evt: React.SyntheticEvent) => {\r\n    evt.preventDefault();\r\n    await this.props.onAddPermission(this.state);\r\n    this.setState(this.getCleanState());\r\n  };\r\n\r\n  isValid() {\r\n    switch (this.state.type) {\r\n      case AclTarget.Team:\r\n        return this.state.teamId > 0;\r\n      case AclTarget.User:\r\n        return this.state.userId > 0;\r\n    }\r\n    return true;\r\n  }\r\n\r\n  render() {\r\n    const { onCancel } = this.props;\r\n    const newItem = this.state;\r\n    const pickerClassName = 'min-width-20';\r\n    const isValid = this.isValid();\r\n    return (\r\n      <div className=\"gf-form-inline cta-form\">\r\n        <button className=\"cta-form__close btn btn-transparent\" onClick={onCancel}>\r\n          <i className=\"fa fa-close\" />\r\n        </button>\r\n        <form name=\"addPermission\" onSubmit={this.onSubmit}>\r\n          <h5>Add Permission For</h5>\r\n          <div className=\"gf-form-inline\">\r\n            <div className=\"gf-form\">\r\n              <div className=\"gf-form-select-wrapper\">\r\n                <select className=\"gf-form-input gf-size-auto\" value={newItem.type} onChange={this.onTypeChanged}>\r\n                  {dashboardAclTargets.map((option, idx) => {\r\n                    return (\r\n                      <option key={idx} value={option.value}>\r\n                        {option.text}\r\n                      </option>\r\n                    );\r\n                  })}\r\n                </select>\r\n              </div>\r\n            </div>\r\n\r\n            {newItem.type === AclTarget.User ? (\r\n              <div className=\"gf-form\">\r\n                <UserPicker onSelected={this.onUserSelected} className={pickerClassName} />\r\n              </div>\r\n            ) : null}\r\n\r\n            {newItem.type === AclTarget.Team ? (\r\n              <div className=\"gf-form\">\r\n                <TeamPicker onSelected={this.onTeamSelected} className={pickerClassName} />\r\n              </div>\r\n            ) : null}\r\n\r\n            <div className=\"gf-form\">\r\n              <Select\r\n                isSearchable={false}\r\n                options={dashboardPermissionLevels}\r\n                onChange={this.onPermissionChanged}\r\n                className=\"gf-form-select-box__control--menu-right\"\r\n              />\r\n            </div>\r\n\r\n            <div className=\"gf-form\">\r\n              <button data-save-permission className=\"btn btn-primary\" type=\"submit\" disabled={!isValid}>\r\n                Save\r\n              </button>\r\n            </div>\r\n          </div>\r\n        </form>\r\n      </div>\r\n    );\r\n  }\r\n}\r\n\r\nexport default AddPermissions;\r\n","import React, { Component } from 'react';\r\nimport { Select } from '@grafana/ui';\r\nimport { dashboardPermissionLevels } from 'app/types/acl';\r\n\r\nexport interface Props {\r\n  item: any;\r\n}\r\n\r\nexport default class DisabledPermissionListItem extends Component<Props, any> {\r\n  render() {\r\n    const { item } = this.props;\r\n    const currentPermissionLevel = dashboardPermissionLevels.find(dp => dp.value === item.permission);\r\n\r\n    return (\r\n      <tr className=\"gf-form-disabled\">\r\n        <td style={{ width: '1%' }}>\r\n          <i style={{ width: '25px', height: '25px' }} className=\"gicon gicon-shield\" />\r\n        </td>\r\n        <td style={{ width: '90%' }}>\r\n          {item.name}\r\n          <span className=\"filter-table__weak-italic\"> (Role)</span>\r\n        </td>\r\n        <td />\r\n        <td className=\"query-keyword\">Can</td>\r\n        <td>\r\n          <div className=\"gf-form\">\r\n            <Select\r\n              options={dashboardPermissionLevels}\r\n              onChange={() => {}}\r\n              isDisabled={true}\r\n              className=\"gf-form-select-box__control--menu-right\"\r\n              value={currentPermissionLevel}\r\n            />\r\n          </div>\r\n        </td>\r\n        <td>\r\n          <button className=\"btn btn-inverse btn-small\">\r\n            <i className=\"fa fa-lock\" />\r\n          </button>\r\n        </td>\r\n      </tr>\r\n    );\r\n  }\r\n}\r\n","import React, { PureComponent } from 'react';\r\nimport PermissionsListItem from './PermissionListItem';\r\nimport DisabledPermissionsListItem from './DisabledPermissionListItem';\r\nimport { FolderInfo } from 'app/types';\r\nimport { DashboardAcl } from 'app/types/acl';\r\n\r\nexport interface Props {\r\n  items: DashboardAcl[];\r\n  onRemoveItem: (item: DashboardAcl) => void;\r\n  onPermissionChanged: any;\r\n  isFetching: boolean;\r\n  folderInfo?: FolderInfo;\r\n}\r\n\r\nclass PermissionList extends PureComponent<Props> {\r\n  render() {\r\n    const { items, onRemoveItem, onPermissionChanged, isFetching, folderInfo } = this.props;\r\n\r\n    return (\r\n      <table className=\"filter-table gf-form-group\">\r\n        <tbody>\r\n          <DisabledPermissionsListItem\r\n            key={0}\r\n            item={{\r\n              name: 'Admin',\r\n              permission: 4,\r\n              icon: 'fa fa-fw fa-street-view',\r\n            }}\r\n          />\r\n          {items.map((item, idx) => {\r\n            return (\r\n              <PermissionsListItem\r\n                key={idx + 1}\r\n                item={item}\r\n                onRemoveItem={onRemoveItem}\r\n                onPermissionChanged={onPermissionChanged}\r\n                folderInfo={folderInfo}\r\n              />\r\n            );\r\n          })}\r\n          {isFetching === true && items.length < 1 ? (\r\n            <tr>\r\n              <td colSpan={4}>\r\n                <em>Loading permissions...</em>\r\n              </td>\r\n            </tr>\r\n          ) : null}\r\n\r\n          {isFetching === false && items.length < 1 ? (\r\n            <tr>\r\n              <td colSpan={4}>\r\n                <em>No permissions are set. Will only be accessible by admins.</em>\r\n              </td>\r\n            </tr>\r\n          ) : null}\r\n        </tbody>\r\n      </table>\r\n    );\r\n  }\r\n}\r\n\r\nexport default PermissionList;\r\n","import React, { PureComponent } from 'react';\r\nimport { Select } from '@grafana/ui';\r\nimport { SelectableValue } from '@grafana/data';\r\nimport { dashboardPermissionLevels, DashboardAcl, PermissionLevel } from 'app/types/acl';\r\nimport { FolderInfo } from 'app/types';\r\n\r\nconst setClassNameHelper = (inherited: boolean) => {\r\n  return inherited ? 'gf-form-disabled' : '';\r\n};\r\n\r\nfunction ItemAvatar({ item }: { item: DashboardAcl }) {\r\n  if (item.userAvatarUrl) {\r\n    return <img className=\"filter-table__avatar\" src={item.userAvatarUrl} />;\r\n  }\r\n  if (item.teamAvatarUrl) {\r\n    return <img className=\"filter-table__avatar\" src={item.teamAvatarUrl} />;\r\n  }\r\n  if (item.role === 'Editor') {\r\n    return <i style={{ width: '25px', height: '25px' }} className=\"gicon gicon-editor\" />;\r\n  }\r\n\r\n  return <i style={{ width: '25px', height: '25px' }} className=\"gicon gicon-viewer\" />;\r\n}\r\n\r\nfunction ItemDescription({ item }: { item: DashboardAcl }) {\r\n  if (item.userId) {\r\n    return <span className=\"filter-table__weak-italic\">(User)</span>;\r\n  }\r\n  if (item.teamId) {\r\n    return <span className=\"filter-table__weak-italic\">(Team)</span>;\r\n  }\r\n  return <span className=\"filter-table__weak-italic\">(Role)</span>;\r\n}\r\n\r\ninterface Props {\r\n  item: DashboardAcl;\r\n  onRemoveItem: (item: DashboardAcl) => void;\r\n  onPermissionChanged: (item: DashboardAcl, level: PermissionLevel) => void;\r\n  folderInfo?: FolderInfo;\r\n}\r\n\r\nexport default class PermissionsListItem extends PureComponent<Props> {\r\n  onPermissionChanged = (option: SelectableValue<PermissionLevel>) => {\r\n    this.props.onPermissionChanged(this.props.item, option.value);\r\n  };\r\n\r\n  onRemoveItem = () => {\r\n    this.props.onRemoveItem(this.props.item);\r\n  };\r\n\r\n  render() {\r\n    const { item, folderInfo } = this.props;\r\n    const inheritedFromRoot = item.dashboardId === -1 && !item.inherited;\r\n    const currentPermissionLevel = dashboardPermissionLevels.find(dp => dp.value === item.permission);\r\n\r\n    return (\r\n      <tr className={setClassNameHelper(item.inherited)}>\r\n        <td style={{ width: '1%' }}>\r\n          <ItemAvatar item={item} />\r\n        </td>\r\n        <td style={{ width: '90%' }}>\r\n          {item.name} <ItemDescription item={item} />\r\n        </td>\r\n        <td>\r\n          {item.inherited && folderInfo && (\r\n            <em className=\"muted no-wrap\">\r\n              Inherited from folder{' '}\r\n              <a className=\"text-link\" href={`${folderInfo.url}/permissions`}>\r\n                {folderInfo.title}\r\n              </a>{' '}\r\n            </em>\r\n          )}\r\n          {inheritedFromRoot && <em className=\"muted no-wrap\">Default Permission</em>}\r\n        </td>\r\n        <td className=\"query-keyword\">Can</td>\r\n        <td>\r\n          <div className=\"gf-form\">\r\n            <Select\r\n              isSearchable={false}\r\n              options={dashboardPermissionLevels}\r\n              onChange={this.onPermissionChanged}\r\n              isDisabled={item.inherited}\r\n              className=\"gf-form-select-box__control--menu-right\"\r\n              value={currentPermissionLevel}\r\n            />\r\n          </div>\r\n        </td>\r\n        <td>\r\n          {!item.inherited ? (\r\n            <a className=\"btn btn-danger btn-small\" onClick={this.onRemoveItem}>\r\n              <i className=\"fa fa-remove\" />\r\n            </a>\r\n          ) : (\r\n            <button className=\"btn btn-inverse btn-small\">\r\n              <i className=\"fa fa-lock\" />\r\n            </button>\r\n          )}\r\n        </td>\r\n      </tr>\r\n    );\r\n  }\r\n}\r\n","import React from 'react';\r\n\r\nexport default () => {\r\n  return (\r\n    <div className=\"\">\r\n      <h5>What are Permissions?</h5>\r\n      <p>\r\n        An Access Control List (ACL) model is used to limit access to Dashboard Folders. A user or a Team can be\r\n        assigned permissions for a folder or for a single dashboard.\r\n      </p>\r\n    </div>\r\n  );\r\n};\r\n","import React from 'react';\r\nimport _ from 'lodash';\r\n\r\nimport { Select } from '@grafana/ui';\r\nimport { SelectableValue } from '@grafana/data';\r\nimport { Variable } from 'app/types/templates';\r\n\r\nexport interface Props {\r\n  onChange: (value: string) => void;\r\n  options: Array<SelectableValue<string>>;\r\n  isSearchable: boolean;\r\n  value: string;\r\n  placeholder?: string;\r\n  className?: string;\r\n  variables?: Variable[];\r\n}\r\n\r\ninterface State {\r\n  options: Array<SelectableValue<string>>;\r\n}\r\n\r\nexport class MetricSelect extends React.Component<Props, State> {\r\n  static defaultProps: Partial<Props> = {\r\n    variables: [],\r\n    options: [],\r\n    isSearchable: true,\r\n  };\r\n\r\n  constructor(props: Props) {\r\n    super(props);\r\n    this.state = { options: [] };\r\n  }\r\n\r\n  componentDidMount() {\r\n    this.setState({ options: this.buildOptions(this.props) });\r\n  }\r\n\r\n  UNSAFE_componentWillReceiveProps(nextProps: Props) {\r\n    if (nextProps.options.length > 0 || nextProps.variables.length) {\r\n      this.setState({ options: this.buildOptions(nextProps) });\r\n    }\r\n  }\r\n\r\n  shouldComponentUpdate(nextProps: Props) {\r\n    const nextOptions = this.buildOptions(nextProps);\r\n    return nextProps.value !== this.props.value || !_.isEqual(nextOptions, this.state.options);\r\n  }\r\n\r\n  buildOptions({ variables = [], options }: Props) {\r\n    return variables.length > 0 ? [this.getVariablesGroup(), ...options] : options;\r\n  }\r\n\r\n  getVariablesGroup() {\r\n    return {\r\n      label: 'Template Variables',\r\n      options: this.props.variables.map(v => ({\r\n        label: `$${v.name}`,\r\n        value: `$${v.name}`,\r\n      })),\r\n    };\r\n  }\r\n\r\n  getSelectedOption() {\r\n    const { options } = this.state;\r\n    const allOptions = options.every(o => o.options) ? _.flatten(options.map(o => o.options)) : options;\r\n    return allOptions.find(option => option.value === this.props.value);\r\n  }\r\n\r\n  render() {\r\n    const { placeholder, className, isSearchable, onChange } = this.props;\r\n    const { options } = this.state;\r\n    const selectedOption = this.getSelectedOption();\r\n\r\n    return (\r\n      <Select\r\n        className={className}\r\n        isMulti={false}\r\n        isClearable={false}\r\n        backspaceRemovesValue={false}\r\n        onChange={item => onChange(item.value)}\r\n        options={options}\r\n        isSearchable={isSearchable}\r\n        maxMenuHeight={500}\r\n        placeholder={placeholder}\r\n        noOptionsMessage={() => 'No options found'}\r\n        value={selectedOption}\r\n      />\r\n    );\r\n  }\r\n}\r\n","import React, { PureComponent } from 'react';\r\nimport { AsyncSelect } from '@grafana/ui';\r\nimport { getBackendSrv } from 'app/core/services/backend_srv';\r\nimport { Organization } from 'app/types';\r\nimport { SelectableValue } from '@grafana/data';\r\n\r\nexport interface OrgSelectItem {\r\n  id: number;\r\n  value: number;\r\n  label: string;\r\n  name: string;\r\n}\r\n\r\nexport interface Props {\r\n  onSelected: (org: OrgSelectItem) => void;\r\n  className?: string;\r\n}\r\n\r\nexport interface State {\r\n  isLoading: boolean;\r\n}\r\n\r\nexport class OrgPicker extends PureComponent<Props, State> {\r\n  orgs: Organization[];\r\n\r\n  state: State = {\r\n    isLoading: false,\r\n  };\r\n\r\n  async loadOrgs() {\r\n    this.setState({ isLoading: true });\r\n    const orgs = await getBackendSrv().get('/api/orgs');\r\n    this.orgs = orgs;\r\n    this.setState({ isLoading: false });\r\n    return orgs;\r\n  }\r\n\r\n  getOrgOptions = async (query: string): Promise<Array<SelectableValue<number>>> => {\r\n    if (!this.orgs) {\r\n      await this.loadOrgs();\r\n    }\r\n    return this.orgs.map(\r\n      (org: Organization): SelectableValue<number> => ({\r\n        id: org.id,\r\n        value: org.id,\r\n        label: org.name,\r\n        name: org.name,\r\n      })\r\n    );\r\n  };\r\n\r\n  render() {\r\n    const { className, onSelected } = this.props;\r\n    const { isLoading } = this.state;\r\n\r\n    return (\r\n      <div className=\"org-picker\">\r\n        <AsyncSelect\r\n          className={className}\r\n          isLoading={isLoading}\r\n          defaultOptions={true}\r\n          isSearchable={false}\r\n          loadOptions={this.getOrgOptions}\r\n          onChange={onSelected}\r\n          placeholder=\"Select organization\"\r\n          noOptionsMessage={() => 'No organizations found'}\r\n        />\r\n      </div>\r\n    );\r\n  }\r\n}\r\n","import React, { Component } from 'react';\r\nimport _ from 'lodash';\r\nimport { AsyncSelect } from '@grafana/ui';\r\nimport { debounce } from 'lodash';\r\nimport { getBackendSrv } from 'app/core/services/backend_srv';\r\n\r\nexport interface Team {\r\n  id: number;\r\n  label: string;\r\n  name: string;\r\n  avatarUrl: string;\r\n}\r\n\r\nexport interface Props {\r\n  onSelected: (team: Team) => void;\r\n  className?: string;\r\n}\r\n\r\nexport interface State {\r\n  isLoading: boolean;\r\n}\r\n\r\nexport class TeamPicker extends Component<Props, State> {\r\n  debouncedSearch: any;\r\n\r\n  constructor(props: Props) {\r\n    super(props);\r\n    this.state = { isLoading: false };\r\n    this.search = this.search.bind(this);\r\n\r\n    this.debouncedSearch = debounce(this.search, 300, {\r\n      leading: true,\r\n      trailing: true,\r\n    });\r\n  }\r\n\r\n  search(query?: string) {\r\n    const backendSrv = getBackendSrv();\r\n    this.setState({ isLoading: true });\r\n\r\n    if (_.isNil(query)) {\r\n      query = '';\r\n    }\r\n\r\n    return backendSrv.get(`/api/teams/search?perpage=100&page=1&query=${query}`).then((result: any) => {\r\n      const teams = result.teams.map((team: any) => {\r\n        return {\r\n          id: team.id,\r\n          value: team.id,\r\n          label: team.name,\r\n          name: team.name,\r\n          imgUrl: team.avatarUrl,\r\n        };\r\n      });\r\n\r\n      this.setState({ isLoading: false });\r\n      return teams;\r\n    });\r\n  }\r\n\r\n  render() {\r\n    const { onSelected, className } = this.props;\r\n    const { isLoading } = this.state;\r\n    return (\r\n      <div className=\"user-picker\">\r\n        <AsyncSelect\r\n          isLoading={isLoading}\r\n          defaultOptions={true}\r\n          loadOptions={this.debouncedSearch}\r\n          onChange={onSelected}\r\n          className={className}\r\n          placeholder=\"Select a team\"\r\n          noOptionsMessage={() => 'No teams found'}\r\n        />\r\n      </div>\r\n    );\r\n  }\r\n}\r\n","// Libraries\r\nimport React, { Component } from 'react';\r\nimport _ from 'lodash';\r\n\r\n// Components\r\nimport { AsyncSelect } from '@grafana/ui';\r\n\r\n// Utils & Services\r\nimport { debounce } from 'lodash';\r\nimport { getBackendSrv } from 'app/core/services/backend_srv';\r\n\r\n// Types\r\nimport { User } from 'app/types';\r\n\r\nexport interface Props {\r\n  onSelected: (user: User) => void;\r\n  className?: string;\r\n}\r\n\r\nexport interface State {\r\n  isLoading: boolean;\r\n}\r\n\r\nexport class UserPicker extends Component<Props, State> {\r\n  debouncedSearch: any;\r\n\r\n  constructor(props: Props) {\r\n    super(props);\r\n    this.state = { isLoading: false };\r\n    this.search = this.search.bind(this);\r\n\r\n    this.debouncedSearch = debounce(this.search, 300, {\r\n      leading: true,\r\n      trailing: true,\r\n    });\r\n  }\r\n\r\n  search(query?: string) {\r\n    const backendSrv = getBackendSrv();\r\n    this.setState({ isLoading: true });\r\n\r\n    if (_.isNil(query)) {\r\n      query = '';\r\n    }\r\n\r\n    return backendSrv\r\n      .get(`/api/org/users/lookup?query=${query}&limit=10`)\r\n      .then((result: any) => {\r\n        return result.map((user: any) => ({\r\n          id: user.userId,\r\n          value: user.userId,\r\n          label: user.login,\r\n          imgUrl: user.avatarUrl,\r\n          login: user.login,\r\n        }));\r\n      })\r\n      .finally(() => {\r\n        this.setState({ isLoading: false });\r\n      });\r\n  }\r\n\r\n  render() {\r\n    const { className, onSelected } = this.props;\r\n    const { isLoading } = this.state;\r\n\r\n    return (\r\n      <div className=\"user-picker\">\r\n        <AsyncSelect\r\n          className={className}\r\n          isLoading={isLoading}\r\n          defaultOptions={true}\r\n          loadOptions={this.debouncedSearch}\r\n          onChange={onSelected}\r\n          placeholder=\"Select user\"\r\n          noOptionsMessage={() => 'No users found'}\r\n        />\r\n      </div>\r\n    );\r\n  }\r\n}\r\n","import React, { PureComponent } from 'react';\r\n\r\nimport { FormLabel, Select } from '@grafana/ui';\r\n\r\nimport { DashboardSearchHit, DashboardSearchHitType } from 'app/types';\r\nimport { getBackendSrv } from 'app/core/services/backend_srv';\r\n\r\nexport interface Props {\r\n  resourceUri: string;\r\n}\r\n\r\nexport interface State {\r\n  homeDashboardId: number;\r\n  theme: string;\r\n  timezone: string;\r\n  dashboards: DashboardSearchHit[];\r\n}\r\n\r\nconst themes = [\r\n  { value: '', label: 'Default' },\r\n  { value: 'dark', label: 'Dark' },\r\n  { value: 'light', label: 'Light' },\r\n];\r\n\r\nconst timezones = [\r\n  { value: '', label: 'Default' },\r\n  { value: 'browser', label: 'Local browser time' },\r\n  { value: 'utc', label: 'UTC' },\r\n];\r\n\r\nexport class SharedPreferences extends PureComponent<Props, State> {\r\n  backendSrv = getBackendSrv();\r\n\r\n  constructor(props: Props) {\r\n    super(props);\r\n\r\n    this.state = {\r\n      homeDashboardId: 0,\r\n      theme: '',\r\n      timezone: '',\r\n      dashboards: [],\r\n    };\r\n  }\r\n\r\n  async componentDidMount() {\r\n    const prefs = await this.backendSrv.get(`/api/${this.props.resourceUri}/preferences`);\r\n    const dashboards = await this.backendSrv.search({ starred: true });\r\n    const defaultDashboardHit: DashboardSearchHit = {\r\n      id: 0,\r\n      title: 'Default',\r\n      tags: [],\r\n      type: '' as DashboardSearchHitType,\r\n      uid: '',\r\n      uri: '',\r\n      url: '',\r\n      folderId: 0,\r\n      folderTitle: '',\r\n      folderUid: '',\r\n      folderUrl: '',\r\n      isStarred: false,\r\n      slug: '',\r\n    };\r\n\r\n    if (prefs.homeDashboardId > 0 && !dashboards.find(d => d.id === prefs.homeDashboardId)) {\r\n      const missing = await this.backendSrv.search({ dashboardIds: [prefs.homeDashboardId] });\r\n      if (missing && missing.length > 0) {\r\n        dashboards.push(missing[0]);\r\n      }\r\n    }\r\n\r\n    this.setState({\r\n      homeDashboardId: prefs.homeDashboardId,\r\n      theme: prefs.theme,\r\n      timezone: prefs.timezone,\r\n      dashboards: [defaultDashboardHit, ...dashboards],\r\n    });\r\n  }\r\n\r\n  onSubmitForm = async (event: React.SyntheticEvent) => {\r\n    event.preventDefault();\r\n\r\n    const { homeDashboardId, theme, timezone } = this.state;\r\n\r\n    await this.backendSrv.put(`/api/${this.props.resourceUri}/preferences`, {\r\n      homeDashboardId,\r\n      theme,\r\n      timezone,\r\n    });\r\n    window.location.reload();\r\n  };\r\n\r\n  onThemeChanged = (theme: string) => {\r\n    this.setState({ theme });\r\n  };\r\n\r\n  onTimeZoneChanged = (timezone: string) => {\r\n    this.setState({ timezone });\r\n  };\r\n\r\n  onHomeDashboardChanged = (dashboardId: number) => {\r\n    this.setState({ homeDashboardId: dashboardId });\r\n  };\r\n\r\n  getFullDashName = (dashboard: DashboardSearchHit) => {\r\n    if (typeof dashboard.folderTitle === 'undefined' || dashboard.folderTitle === '') {\r\n      return dashboard.title;\r\n    }\r\n    return dashboard.folderTitle + ' / ' + dashboard.title;\r\n  };\r\n\r\n  render() {\r\n    const { theme, timezone, homeDashboardId, dashboards } = this.state;\r\n\r\n    return (\r\n      <form className=\"section gf-form-group\" onSubmit={this.onSubmitForm}>\r\n        <h3 className=\"page-heading\">Preferences</h3>\r\n        <div className=\"gf-form\">\r\n          <span className=\"gf-form-label width-11\">UI Theme</span>\r\n          <Select\r\n            isSearchable={false}\r\n            value={themes.find(item => item.value === theme)}\r\n            options={themes}\r\n            onChange={theme => this.onThemeChanged(theme.value)}\r\n            width={20}\r\n          />\r\n        </div>\r\n        <div className=\"gf-form\">\r\n          <FormLabel\r\n            width={11}\r\n            tooltip=\"Not finding dashboard you want? Star it first, then it should appear in this select box.\"\r\n          >\r\n            Home Dashboard\r\n          </FormLabel>\r\n          <Select\r\n            value={dashboards.find(dashboard => dashboard.id === homeDashboardId)}\r\n            getOptionValue={i => i.id}\r\n            getOptionLabel={this.getFullDashName}\r\n            onChange={(dashboard: DashboardSearchHit) => this.onHomeDashboardChanged(dashboard.id)}\r\n            options={dashboards}\r\n            placeholder=\"Choose default dashboard\"\r\n            width={20}\r\n          />\r\n        </div>\r\n        <div className=\"gf-form\">\r\n          <label className=\"gf-form-label width-11\">Timezone</label>\r\n          <Select\r\n            isSearchable={false}\r\n            value={timezones.find(item => item.value === timezone)}\r\n            onChange={timezone => this.onTimeZoneChanged(timezone.value)}\r\n            options={timezones}\r\n            width={20}\r\n          />\r\n        </div>\r\n        <div className=\"gf-form-button-row\">\r\n          <button type=\"submit\" className=\"btn btn-primary\">\r\n            Save\r\n          </button>\r\n        </div>\r\n      </form>\r\n    );\r\n  }\r\n}\r\n\r\nexport default SharedPreferences;\r\n","import React from 'react';\r\nimport { getTagColorsFromName } from '@grafana/ui';\r\n\r\nexport interface Props {\r\n  label: string;\r\n  removeIcon: boolean;\r\n  count: number;\r\n  onClick?: any;\r\n}\r\n\r\nexport class TagBadge extends React.Component<Props, any> {\r\n  constructor(props: Props) {\r\n    super(props);\r\n  }\r\n\r\n  render() {\r\n    const { label, removeIcon, count } = this.props;\r\n    const { color, borderColor } = getTagColorsFromName(label);\r\n    const tagStyle = {\r\n      backgroundColor: color,\r\n      borderColor: borderColor,\r\n    };\r\n    const countLabel = count !== 0 && <span className=\"tag-count-label\">{`(${count})`}</span>;\r\n\r\n    return (\r\n      <span className={`label label-tag`} style={tagStyle}>\r\n        {removeIcon && <i className=\"fa fa-remove\" />}\r\n        {label} {countLabel}\r\n      </span>\r\n    );\r\n  }\r\n}\r\n","// Libraries\r\nimport React from 'react';\r\n// @ts-ignore\r\nimport { components } from '@torkelo/react-select';\r\n// @ts-ignore\r\nimport AsyncSelect from '@torkelo/react-select/lib/Async';\r\nimport { escapeStringForRegex } from '@grafana/data';\r\n// Components\r\nimport { TagOption } from './TagOption';\r\nimport { TagBadge } from './TagBadge';\r\nimport { IndicatorsContainer, NoOptionsMessage, resetSelectStyles } from '@grafana/ui';\r\n\r\nexport interface TermCount {\r\n  term: string;\r\n  count: number;\r\n}\r\n\r\nexport interface Props {\r\n  tags: string[];\r\n  tagOptions: () => Promise<TermCount[]>;\r\n  onChange: (tags: string[]) => void;\r\n}\r\n\r\nexport class TagFilter extends React.Component<Props, any> {\r\n  inlineTags: boolean;\r\n\r\n  constructor(props: Props) {\r\n    super(props);\r\n  }\r\n\r\n  onLoadOptions = (query: string) => {\r\n    return this.props.tagOptions().then(options => {\r\n      return options.map(option => ({\r\n        value: option.term,\r\n        label: option.term,\r\n        count: option.count,\r\n      }));\r\n    });\r\n  };\r\n\r\n  onChange = (newTags: any[]) => {\r\n    this.props.onChange(newTags.map(tag => tag.value));\r\n  };\r\n\r\n  render() {\r\n    const tags = this.props.tags.map(tag => ({ value: tag, label: tag, count: 0 }));\r\n\r\n    const selectOptions = {\r\n      classNamePrefix: 'gf-form-select-box',\r\n      isMulti: true,\r\n      defaultOptions: true,\r\n      loadOptions: this.onLoadOptions,\r\n      onChange: this.onChange,\r\n      className: 'gf-form-input gf-form-input--form-dropdown',\r\n      placeholder: 'Tags',\r\n      loadingMessage: () => 'Loading...',\r\n      noOptionsMessage: () => 'No tags found',\r\n      getOptionValue: (i: any) => i.value,\r\n      getOptionLabel: (i: any) => i.label,\r\n      value: tags,\r\n      styles: resetSelectStyles(),\r\n      filterOption: (option: any, searchQuery: string) => {\r\n        const regex = RegExp(escapeStringForRegex(searchQuery), 'i');\r\n        return regex.test(option.value);\r\n      },\r\n      components: {\r\n        Option: TagOption,\r\n        IndicatorsContainer,\r\n        NoOptionsMessage,\r\n        MultiValueLabel: (): any => {\r\n          return null; // We want the whole tag to be clickable so we use MultiValueRemove instead\r\n        },\r\n        MultiValueRemove: (props: any) => {\r\n          const { data } = props;\r\n\r\n          return (\r\n            <components.MultiValueRemove {...props}>\r\n              <TagBadge key={data.label} label={data.label} removeIcon={true} count={data.count} />\r\n            </components.MultiValueRemove>\r\n          );\r\n        },\r\n      },\r\n    };\r\n\r\n    return (\r\n      <div className=\"gf-form gf-form--has-input-icon gf-form--grow\">\r\n        <div className=\"tag-filter\">\r\n          <AsyncSelect {...selectOptions} />\r\n        </div>\r\n        <i className=\"gf-form-input-icon fa fa-tag\" />\r\n      </div>\r\n    );\r\n  }\r\n}\r\n","// Libraries\r\nimport React from 'react';\r\n// @ts-ignore\r\nimport { components } from '@torkelo/react-select';\r\nimport { OptionProps } from 'react-select/lib/components/Option';\r\nimport { TagBadge } from './TagBadge';\r\n\r\n// https://github.com/JedWatson/react-select/issues/3038\r\ninterface ExtendedOptionProps extends OptionProps<any> {\r\n  data: any;\r\n}\r\n\r\nexport const TagOption = (props: ExtendedOptionProps) => {\r\n  const { data, className, label } = props;\r\n  return (\r\n    <components.Option {...props}>\r\n      <div className={`tag-filter-option btn btn-link ${className || ''}`}>\r\n        <TagBadge label={label} removeIcon={false} count={data.count} />\r\n      </div>\r\n    </components.Option>\r\n  );\r\n};\r\n\r\nexport default TagOption;\r\n","import React from 'react';\r\nimport { LocalStorageValueProvider } from '../LocalStorageValueProvider';\r\nimport { TimeRange, isDateTime } from '@grafana/data';\r\nimport { Props as TimePickerProps, TimePicker } from '@grafana/ui/src/components/TimePicker/TimePicker';\r\n\r\nconst LOCAL_STORAGE_KEY = 'grafana.dashboard.timepicker.history';\r\n\r\ninterface Props extends Omit<TimePickerProps, 'history' | 'theme'> {}\r\n\r\nexport const TimePickerWithHistory: React.FC<Props> = props => {\r\n  return (\r\n    <LocalStorageValueProvider<TimeRange[]> storageKey={LOCAL_STORAGE_KEY} defaultValue={[]}>\r\n      {(values, onSaveToStore) => {\r\n        return (\r\n          <TimePicker\r\n            {...props}\r\n            history={values}\r\n            onChange={value => {\r\n              onAppendToHistory(value, values, onSaveToStore);\r\n              props.onChange(value);\r\n            }}\r\n          />\r\n        );\r\n      }}\r\n    </LocalStorageValueProvider>\r\n  );\r\n};\r\nfunction onAppendToHistory(toAppend: TimeRange, values: TimeRange[], onSaveToStore: (values: TimeRange[]) => void) {\r\n  if (!isAbsolute(toAppend)) {\r\n    return;\r\n  }\r\n  const toStore = limit([toAppend, ...values]);\r\n  onSaveToStore(toStore);\r\n}\r\n\r\nfunction isAbsolute(value: TimeRange): boolean {\r\n  return isDateTime(value.raw.from) || isDateTime(value.raw.to);\r\n}\r\n\r\nfunction limit(value: TimeRange[]): TimeRange[] {\r\n  return value.slice(0, 4);\r\n}\r\n","/**\r\n * codeEditor directive based on Ace code editor\r\n * https://github.com/ajaxorg/ace\r\n *\r\n * Basic usage:\r\n * <code-editor content=\"ctrl.target.query\" on-change=\"ctrl.panelCtrl.refresh()\"\r\n *  data-mode=\"sql\" data-show-gutter>\r\n * </code-editor>\r\n *\r\n * Params:\r\n * content:      Editor content.\r\n * onChange:     Function called on content change (invoked on editor blur, ctrl+enter, not on every change).\r\n * getCompleter: Function returned external completer. Completer is an object implemented getCompletions() method,\r\n *               see Prometheus Data Source implementation for details.\r\n *\r\n * Some Ace editor options available via data-* attributes:\r\n * data-mode               - Language mode (text, sql, javascript, etc.). Default is 'text'.\r\n * data-theme              - Editor theme (eg 'solarized_dark').\r\n * data-max-lines          - Max editor height in lines. Editor grows automatically from 1 to maxLines.\r\n * data-show-gutter        - Show gutter (contains line numbers and additional info).\r\n * data-tab-size           - Tab size, default is 2.\r\n * data-behaviours-enabled - Specifies whether to use behaviors or not. \"Behaviors\" in this case is the auto-pairing of\r\n *                           special characters, like quotation marks, parenthesis, or brackets.\r\n * data-snippets-enabled   - Specifies whether to use snippets or not. \"Snippets\" are small pieces of code that can be\r\n *                           inserted via the completion box.\r\n *\r\n * Keybindings:\r\n * Ctrl-Enter (Command-Enter): run onChange() function\r\n */\r\n\r\nimport coreModule from 'app/core/core_module';\r\nimport config from 'app/core/config';\r\n\r\nconst DEFAULT_THEME_DARK = 'ace/theme/grafana-dark';\r\nconst DEFAULT_THEME_LIGHT = 'ace/theme/textmate';\r\nconst DEFAULT_MODE = 'text';\r\nconst DEFAULT_MAX_LINES = 10;\r\nconst DEFAULT_TAB_SIZE = 2;\r\nconst DEFAULT_BEHAVIORS = true;\r\nconst DEFAULT_SNIPPETS = true;\r\n\r\nconst editorTemplate = `<div></div>`;\r\n\r\nasync function link(scope: any, elem: any, attrs: any) {\r\n  // Options\r\n  const langMode = attrs.mode || DEFAULT_MODE;\r\n  const maxLines = attrs.maxLines || DEFAULT_MAX_LINES;\r\n  const showGutter = attrs.showGutter !== undefined;\r\n  const tabSize = attrs.tabSize || DEFAULT_TAB_SIZE;\r\n  const behavioursEnabled = attrs.behavioursEnabled ? attrs.behavioursEnabled === 'true' : DEFAULT_BEHAVIORS;\r\n  const snippetsEnabled = attrs.snippetsEnabled ? attrs.snippetsEnabled === 'true' : DEFAULT_SNIPPETS;\r\n\r\n  // Initialize editor\r\n  const aceElem = elem.get(0);\r\n  const { default: ace } = await import(/* webpackChunkName: \"brace\" */ 'brace');\r\n  await import('brace/ext/language_tools');\r\n  await import('brace/theme/textmate');\r\n  await import('brace/mode/text');\r\n  await import('brace/snippets/text');\r\n  await import('brace/mode/sql');\r\n  await import('brace/snippets/sql');\r\n  await import('brace/mode/sqlserver');\r\n  await import('brace/snippets/sqlserver');\r\n  await import('brace/mode/markdown');\r\n  await import('brace/snippets/markdown');\r\n  await import('brace/mode/json');\r\n  await import('brace/snippets/json');\r\n\r\n  // @ts-ignore\r\n  await import('./theme-grafana-dark');\r\n\r\n  const codeEditor = ace.edit(aceElem);\r\n  const editorSession = codeEditor.getSession();\r\n\r\n  const editorOptions = {\r\n    maxLines: maxLines,\r\n    showGutter: showGutter,\r\n    tabSize: tabSize,\r\n    behavioursEnabled: behavioursEnabled,\r\n    highlightActiveLine: false,\r\n    showPrintMargin: false,\r\n    autoScrollEditorIntoView: true, // this is needed if editor is inside scrollable page\r\n  };\r\n\r\n  // Set options\r\n  codeEditor.setOptions(editorOptions);\r\n  // disable depreacation warning\r\n  codeEditor.$blockScrolling = Infinity;\r\n  // Padding hacks\r\n  (codeEditor.renderer as any).setScrollMargin(10, 10);\r\n  codeEditor.renderer.setPadding(10);\r\n\r\n  setThemeMode();\r\n  setLangMode(langMode);\r\n  setEditorContent(scope.content);\r\n\r\n  // Add classes\r\n  elem.addClass('gf-code-editor');\r\n  const textarea = elem.find('textarea');\r\n  textarea.addClass('gf-form-input');\r\n\r\n  if (scope.codeEditorFocus) {\r\n    setTimeout(() => {\r\n      textarea.focus();\r\n      const domEl = textarea[0];\r\n      if (domEl.setSelectionRange) {\r\n        const pos = textarea.val().length * 2;\r\n        domEl.setSelectionRange(pos, pos);\r\n      }\r\n    }, 100);\r\n  }\r\n\r\n  // Event handlers\r\n  editorSession.on('change', e => {\r\n    scope.$apply(() => {\r\n      const newValue = codeEditor.getValue();\r\n      scope.content = newValue;\r\n    });\r\n  });\r\n\r\n  // Sync with outer scope - update editor content if model has been changed from outside of directive.\r\n  scope.$watch('content', (newValue: any, oldValue: any) => {\r\n    const editorValue = codeEditor.getValue();\r\n    if (newValue !== editorValue && newValue !== oldValue) {\r\n      scope.$$postDigest(() => {\r\n        setEditorContent(newValue);\r\n      });\r\n    }\r\n  });\r\n\r\n  codeEditor.on('blur', () => {\r\n    scope.onChange();\r\n  });\r\n\r\n  scope.$on('$destroy', () => {\r\n    codeEditor.destroy();\r\n  });\r\n\r\n  // Keybindings\r\n  codeEditor.commands.addCommand({\r\n    name: 'executeQuery',\r\n    bindKey: { win: 'Ctrl-Enter', mac: 'Command-Enter' },\r\n    exec: () => {\r\n      scope.onChange();\r\n    },\r\n  });\r\n\r\n  function setLangMode(lang: string) {\r\n    ace.acequire('ace/ext/language_tools');\r\n    codeEditor.setOptions({\r\n      enableBasicAutocompletion: true,\r\n      enableLiveAutocompletion: true,\r\n      enableSnippets: snippetsEnabled,\r\n    });\r\n\r\n    if (scope.getCompleter()) {\r\n      // make copy of array as ace seems to share completers array between instances\r\n      const anyEditor = codeEditor as any;\r\n      anyEditor.completers = anyEditor.completers.slice();\r\n      anyEditor.completers.push(scope.getCompleter());\r\n    }\r\n\r\n    const aceModeName = `ace/mode/${lang}`;\r\n    editorSession.setMode(aceModeName);\r\n  }\r\n\r\n  function setThemeMode() {\r\n    let theme = DEFAULT_THEME_DARK;\r\n    if (config.bootData.user.lightTheme) {\r\n      theme = DEFAULT_THEME_LIGHT;\r\n    }\r\n\r\n    codeEditor.setTheme(theme);\r\n  }\r\n\r\n  function setEditorContent(value: string) {\r\n    codeEditor.setValue(value);\r\n    codeEditor.clearSelection();\r\n  }\r\n}\r\n\r\nexport function codeEditorDirective() {\r\n  return {\r\n    restrict: 'E',\r\n    template: editorTemplate,\r\n    scope: {\r\n      content: '=',\r\n      datasource: '=',\r\n      codeEditorFocus: '<',\r\n      onChange: '&',\r\n      getCompleter: '&',\r\n    },\r\n    link: link,\r\n  };\r\n}\r\n\r\ncoreModule.directive('codeEditor', codeEditorDirective);\r\n","/**\r\n * Wrapper for the new ngReact <color-picker> directive for backward compatibility.\r\n * Allows remaining <spectrum-picker> untouched in outdated plugins.\r\n * Technically, it's just a wrapper for react component with two-way data binding support.\r\n */\r\nimport coreModule from '../../core_module';\r\n\r\n/** @ngInject */\r\nexport function spectrumPicker() {\r\n  return {\r\n    restrict: 'E',\r\n    require: 'ngModel',\r\n    scope: true,\r\n    replace: true,\r\n    template: '<color-picker color=\"ngModel.$viewValue\" onChange=\"onColorChange\"></color-picker>',\r\n    link: (scope: any, element: any, attrs: any, ngModel: any) => {\r\n      scope.ngModel = ngModel;\r\n      scope.onColorChange = (color: string) => {\r\n        ngModel.$setViewValue(color);\r\n      };\r\n    },\r\n  };\r\n}\r\ncoreModule.directive('spectrumPicker', spectrumPicker);\r\n","import coreModule from 'app/core/core_module';\r\nimport { BackendSrv } from '../services/backend_srv';\r\n\r\nconst template = `\r\n<select class=\"gf-form-input\" ng-model=\"ctrl.model\" ng-options=\"f.value as f.text for f in ctrl.options\"></select>\r\n`;\r\n\r\nexport class DashboardSelectorCtrl {\r\n  model: any;\r\n  options: any;\r\n\r\n  /** @ngInject */\r\n  constructor(private backendSrv: BackendSrv) {}\r\n\r\n  $onInit() {\r\n    this.options = [{ value: 0, text: 'Default' }];\r\n\r\n    return this.backendSrv.search({ starred: true }).then(res => {\r\n      res.forEach(dash => {\r\n        this.options.push({ value: dash.id, text: dash.title });\r\n      });\r\n    });\r\n  }\r\n}\r\n\r\nexport function dashboardSelector() {\r\n  return {\r\n    restrict: 'E',\r\n    controller: DashboardSelectorCtrl,\r\n    bindToController: true,\r\n    controllerAs: 'ctrl',\r\n    template: template,\r\n    scope: {\r\n      model: '=',\r\n    },\r\n  };\r\n}\r\n\r\ncoreModule.directive('dashboardSelector', dashboardSelector);\r\n","import _ from 'lodash';\r\nimport coreModule from '../../core_module';\r\nimport { ISCEService } from 'angular';\r\n\r\nfunction typeaheadMatcher(this: any, item: string) {\r\n  let str = this.query;\r\n  if (str === '') {\r\n    return true;\r\n  }\r\n  if (str[0] === '/') {\r\n    str = str.substring(1);\r\n  }\r\n  if (str[str.length - 1] === '/') {\r\n    str = str.substring(0, str.length - 1);\r\n  }\r\n  return item.toLowerCase().match(str.toLowerCase());\r\n}\r\n\r\nexport class FormDropdownCtrl {\r\n  inputElement: JQLite;\r\n  linkElement: JQLite;\r\n  model: any;\r\n  display: any;\r\n  text: any;\r\n  options: any;\r\n  cssClass: any;\r\n  cssClasses: any;\r\n  allowCustom: any;\r\n  labelMode: boolean;\r\n  linkMode: boolean;\r\n  cancelBlur: any;\r\n  onChange: any;\r\n  getOptions: any;\r\n  optionCache: any;\r\n  lookupText: boolean;\r\n  placeholder: any;\r\n  startOpen: any;\r\n  debounce: number;\r\n\r\n  /** @ngInject */\r\n  constructor(private $scope: any, $element: JQLite, private $sce: ISCEService, private templateSrv: any) {\r\n    this.inputElement = $element.find('input').first();\r\n    this.linkElement = $element.find('a').first();\r\n    this.linkMode = true;\r\n    this.cancelBlur = null;\r\n\r\n    // listen to model changes\r\n    $scope.$watch('ctrl.model', this.modelChanged.bind(this));\r\n\r\n    if (this.labelMode) {\r\n      this.cssClasses = 'gf-form-label ' + this.cssClass;\r\n    } else {\r\n      this.cssClasses = 'gf-form-input gf-form-input--dropdown ' + this.cssClass;\r\n    }\r\n\r\n    if (this.placeholder) {\r\n      this.inputElement.attr('placeholder', this.placeholder);\r\n    }\r\n\r\n    this.inputElement.attr('data-provide', 'typeahead');\r\n    this.inputElement.typeahead({\r\n      source: this.typeaheadSource.bind(this),\r\n      minLength: 0,\r\n      items: 10000,\r\n      updater: this.typeaheadUpdater.bind(this),\r\n      matcher: typeaheadMatcher,\r\n    });\r\n\r\n    // modify typeahead lookup\r\n    // this = typeahead\r\n    const typeahead = this.inputElement.data('typeahead');\r\n    typeahead.lookup = function() {\r\n      this.query = this.$element.val() || '';\r\n      this.source(this.query, this.process.bind(this));\r\n    };\r\n\r\n    if (this.debounce) {\r\n      typeahead.lookup = _.debounce(typeahead.lookup, 500, { leading: true });\r\n    }\r\n\r\n    this.linkElement.keydown(evt => {\r\n      // trigger typeahead on down arrow or enter key\r\n      if (evt.keyCode === 40 || evt.keyCode === 13) {\r\n        this.linkElement.click();\r\n      }\r\n    });\r\n\r\n    this.inputElement.keydown(evt => {\r\n      if (evt.keyCode === 13) {\r\n        setTimeout(() => {\r\n          this.inputElement.blur();\r\n        }, 300);\r\n      }\r\n    });\r\n\r\n    this.inputElement.blur(this.inputBlur.bind(this));\r\n\r\n    if (this.startOpen) {\r\n      setTimeout(this.open.bind(this), 0);\r\n    }\r\n  }\r\n\r\n  getOptionsInternal(query: string) {\r\n    const result = this.getOptions({ $query: query });\r\n    return Promise.resolve(result);\r\n  }\r\n\r\n  isPromiseLike(obj: any) {\r\n    return obj && typeof obj.then === 'function';\r\n  }\r\n\r\n  modelChanged() {\r\n    if (_.isObject(this.model)) {\r\n      this.updateDisplay((this.model as any).text);\r\n    } else {\r\n      // if we have text use it\r\n      if (this.lookupText) {\r\n        this.getOptionsInternal('').then((options: any) => {\r\n          const item: any = _.find(options, { value: this.model });\r\n          this.updateDisplay(item ? item.text : this.model);\r\n        });\r\n      } else {\r\n        this.updateDisplay(this.model);\r\n      }\r\n    }\r\n  }\r\n\r\n  typeaheadSource(query: string, callback: (res: any) => void) {\r\n    this.getOptionsInternal(query).then((options: any) => {\r\n      this.optionCache = options;\r\n\r\n      // extract texts\r\n      const optionTexts = _.map(options, (op: any) => {\r\n        return _.escape(op.text);\r\n      });\r\n\r\n      // add custom values\r\n      if (this.allowCustom && this.text !== '') {\r\n        if (_.indexOf(optionTexts, this.text) === -1) {\r\n          optionTexts.unshift(this.text);\r\n        }\r\n      }\r\n\r\n      callback(optionTexts);\r\n    });\r\n  }\r\n\r\n  typeaheadUpdater(text: string) {\r\n    if (text === this.text) {\r\n      clearTimeout(this.cancelBlur);\r\n      this.inputElement.focus();\r\n      return text;\r\n    }\r\n\r\n    this.inputElement.val(text);\r\n    this.switchToLink(true);\r\n    return text;\r\n  }\r\n\r\n  switchToLink(fromClick: boolean) {\r\n    if (this.linkMode && !fromClick) {\r\n      return;\r\n    }\r\n\r\n    clearTimeout(this.cancelBlur);\r\n    this.cancelBlur = null;\r\n    this.linkMode = true;\r\n    this.inputElement.hide();\r\n    this.linkElement.show();\r\n    this.updateValue(this.inputElement.val());\r\n  }\r\n\r\n  inputBlur() {\r\n    // happens long before the click event on the typeahead options\r\n    // need to have long delay because the blur\r\n    this.cancelBlur = setTimeout(this.switchToLink.bind(this), 200);\r\n  }\r\n\r\n  updateValue(text: string) {\r\n    text = _.unescape(text);\r\n\r\n    if (text === '' || this.text === text) {\r\n      return;\r\n    }\r\n\r\n    this.$scope.$apply(() => {\r\n      const option: any = _.find(this.optionCache, { text: text });\r\n\r\n      if (option) {\r\n        if (_.isObject(this.model)) {\r\n          this.model = option;\r\n        } else {\r\n          this.model = option.value;\r\n        }\r\n        this.text = option.text;\r\n      } else if (this.allowCustom) {\r\n        if (_.isObject(this.model)) {\r\n          (this.model as any).text = (this.model as any).value = text;\r\n        } else {\r\n          this.model = text;\r\n        }\r\n        this.text = text;\r\n      }\r\n\r\n      // needs to call this after digest so\r\n      // property is synced with outerscope\r\n      this.$scope.$$postDigest(() => {\r\n        this.$scope.$apply(() => {\r\n          this.onChange({ $option: option });\r\n        });\r\n      });\r\n    });\r\n  }\r\n\r\n  updateDisplay(text: string) {\r\n    this.text = text;\r\n    this.display = this.$sce.trustAsHtml(this.templateSrv.highlightVariablesAsHtml(text));\r\n  }\r\n\r\n  open() {\r\n    this.inputElement.css('width', Math.max(this.linkElement.width(), 80) + 16 + 'px');\r\n\r\n    this.inputElement.show();\r\n    this.inputElement.focus();\r\n\r\n    this.linkElement.hide();\r\n    this.linkMode = false;\r\n\r\n    const typeahead = this.inputElement.data('typeahead');\r\n    if (typeahead) {\r\n      this.inputElement.val('');\r\n      typeahead.lookup();\r\n    }\r\n  }\r\n}\r\n\r\nconst template = `\r\n<input type=\"text\"\r\n  data-provide=\"typeahead\"\r\n  class=\"gf-form-input\"\r\n  spellcheck=\"false\"\r\n  style=\"display:none\">\r\n</input>\r\n<a ng-class=\"ctrl.cssClasses\"\r\n   tabindex=\"1\"\r\n   ng-click=\"ctrl.open()\"\r\n   give-focus=\"ctrl.focus\"\r\n   ng-bind-html=\"ctrl.display || '&nbsp;'\">\r\n</a>\r\n`;\r\n\r\nexport function formDropdownDirective() {\r\n  return {\r\n    restrict: 'E',\r\n    template: template,\r\n    controller: FormDropdownCtrl,\r\n    bindToController: true,\r\n    controllerAs: 'ctrl',\r\n    scope: {\r\n      model: '=',\r\n      getOptions: '&',\r\n      onChange: '&',\r\n      cssClass: '@',\r\n      allowCustom: '@',\r\n      labelMode: '@',\r\n      lookupText: '@',\r\n      placeholder: '@',\r\n      startOpen: '@',\r\n      debounce: '@',\r\n    },\r\n  };\r\n}\r\n\r\ncoreModule.directive('gfFormDropdown', formDropdownDirective);\r\n","import React from 'react';\r\nimport { appEvents } from 'app/core/core';\r\n\r\nexport class HelpModal extends React.PureComponent {\r\n  static tabIndex = 0;\r\n  static shortcuts = {\r\n    Global: [\r\n      { keys: ['g', 'h'], description: 'Go to Home Dashboard' },\r\n      { keys: ['g', 'p'], description: 'Go to Profile' },\r\n      { keys: ['s', 'o'], description: 'Open search' },\r\n      { keys: ['esc'], description: 'Exit edit/setting views' },\r\n    ],\r\n    Dashboard: [\r\n      { keys: ['mod+s'], description: 'Save dashboard' },\r\n      { keys: ['d', 'r'], description: 'Refresh all panels' },\r\n      { keys: ['d', 's'], description: 'Dashboard settings' },\r\n      { keys: ['d', 'v'], description: 'Toggle in-active / view mode' },\r\n      { keys: ['d', 'k'], description: 'Toggle kiosk mode (hides top nav)' },\r\n      { keys: ['d', 'E'], description: 'Expand all rows' },\r\n      { keys: ['d', 'C'], description: 'Collapse all rows' },\r\n      { keys: ['d', 'a'], description: 'Toggle auto fit panels (experimental feature)' },\r\n      { keys: ['mod+o'], description: 'Toggle shared graph crosshair' },\r\n      { keys: ['d', 'l'], description: 'Toggle all panel legends' },\r\n    ],\r\n    'Focused Panel': [\r\n      { keys: ['e'], description: 'Toggle panel edit view' },\r\n      { keys: ['v'], description: 'Toggle panel fullscreen view' },\r\n      { keys: ['p', 's'], description: 'Open Panel Share Modal' },\r\n      { keys: ['p', 'd'], description: 'Duplicate Panel' },\r\n      { keys: ['p', 'r'], description: 'Remove Panel' },\r\n      { keys: ['p', 'l'], description: 'Toggle panel legend' },\r\n    ],\r\n    'Time Range': [\r\n      { keys: ['t', 'z'], description: 'Zoom out time range' },\r\n      {\r\n        keys: ['t', <i className=\"fa fa-long-arrow-left\" />],\r\n        description: 'Move time range back',\r\n      },\r\n      {\r\n        keys: ['t', <i className=\"fa fa-long-arrow-right\" />],\r\n        description: 'Move time range forward',\r\n      },\r\n    ],\r\n  };\r\n\r\n  dismiss() {\r\n    appEvents.emit('hide-modal');\r\n  }\r\n\r\n  render() {\r\n    return (\r\n      <div className=\"modal-body\">\r\n        <div className=\"modal-header\">\r\n          <h2 className=\"modal-header-title\">\r\n            <i className=\"fa fa-keyboard-o\" />\r\n            <span className=\"p-l-1\">Shortcuts</span>\r\n          </h2>\r\n          <a className=\"modal-header-close\" onClick={this.dismiss}>\r\n            <i className=\"fa fa-remove\" />\r\n          </a>\r\n        </div>\r\n\r\n        <div className=\"modal-content help-modal\">\r\n          <p className=\"small\" style={{ position: 'absolute', top: '13px', right: '44px' }}>\r\n            <span className=\"shortcut-table-key\">mod</span> =\r\n            <span className=\"muted\"> CTRL on windows or linux and CMD key on Mac</span>\r\n          </p>\r\n\r\n          {Object.entries(HelpModal.shortcuts).map(([category, shortcuts], i) => (\r\n            <div className=\"shortcut-category\" key={i}>\r\n              <table className=\"shortcut-table\">\r\n                <tbody>\r\n                  <tr>\r\n                    <th className=\"shortcut-table-category-header\" colSpan={2}>\r\n                      {category}\r\n                    </th>\r\n                  </tr>\r\n                  {shortcuts.map((shortcut, j) => (\r\n                    <tr key={`${i}-${j}`}>\r\n                      <td className=\"shortcut-table-keys\">\r\n                        {shortcut.keys.map((key, k) => (\r\n                          <span className=\"shortcut-table-key\" key={`${i}-${j}-${k}`}>\r\n                            {key}\r\n                          </span>\r\n                        ))}\r\n                      </td>\r\n                      <td className=\"shortcut-table-description\">{shortcut.description}</td>\r\n                    </tr>\r\n                  ))}\r\n                </tbody>\r\n              </table>\r\n            </div>\r\n          ))}\r\n\r\n          <div className=\"clearfix\" />\r\n        </div>\r\n      </div>\r\n    );\r\n  }\r\n}\r\n","import _ from 'lodash';\r\nimport coreModule from 'app/core/core_module';\r\n// @ts-ignore\r\nimport Drop from 'tether-drop';\r\n\r\nexport function infoPopover() {\r\n  return {\r\n    restrict: 'E',\r\n    template: '<i class=\"fa fa-info-circle\"></i>',\r\n    transclude: true,\r\n    link: (scope: any, elem: any, attrs: any, ctrl: any, transclude: any) => {\r\n      const offset = attrs.offset || '0 -10px';\r\n      const position = attrs.position || 'right middle';\r\n      let classes = 'drop-help drop-hide-out-of-bounds';\r\n      const openOn = 'hover';\r\n\r\n      elem.addClass('gf-form-help-icon');\r\n\r\n      if (attrs.wide) {\r\n        classes += ' drop-wide';\r\n      }\r\n\r\n      if (attrs.mode) {\r\n        elem.addClass('gf-form-help-icon--' + attrs.mode);\r\n      }\r\n\r\n      transclude((clone: any, newScope: any) => {\r\n        const content = document.createElement('div');\r\n        content.className = 'markdown-html';\r\n\r\n        _.each(clone, node => {\r\n          content.appendChild(node);\r\n        });\r\n\r\n        const dropOptions = {\r\n          target: elem[0],\r\n          content: content,\r\n          position: position,\r\n          classes: classes,\r\n          openOn: openOn,\r\n          hoverOpenDelay: 400,\r\n          tetherOptions: {\r\n            offset: offset,\r\n            constraints: [\r\n              {\r\n                to: 'window',\r\n                attachment: 'together',\r\n                pin: true,\r\n              },\r\n            ],\r\n          },\r\n        };\r\n\r\n        // Create drop in next digest after directive content is rendered.\r\n        scope.$applyAsync(() => {\r\n          const drop = new Drop(dropOptions);\r\n\r\n          const unbind = scope.$on('$destroy', () => {\r\n            drop.destroy();\r\n            unbind();\r\n          });\r\n        });\r\n      });\r\n    },\r\n  };\r\n}\r\n\r\ncoreModule.directive('infoPopover', infoPopover);\r\n","import coreModule from 'app/core/core_module';\nimport { JsonExplorer } from '@grafana/ui';\n\ncoreModule.directive('jsonTree', [\n  function jsonTreeDirective() {\n    return {\n      restrict: 'E',\n      scope: {\n        object: '=',\n        startExpanded: '@',\n        rootName: '@',\n      },\n      link: (scope: any, elem) => {\n        let expansionLevel = scope.startExpanded;\n        if (scope.startExpanded === 'true') {\n          expansionLevel = 2;\n        } else if (scope.startExpanded === 'false') {\n          expansionLevel = 1;\n        }\n        const jsonObject = { [scope.rootName]: scope.object };\n        const jsonExp = new JsonExplorer(jsonObject, expansionLevel, {\n          animateOpen: true,\n        });\n        const html = jsonExp.render(true);\n        elem.append(html);\n      },\n    };\n  },\n]);\n","import store from 'app/core/store';\r\nimport coreModule from 'app/core/core_module';\r\nimport { GrafanaRootScope } from 'app/routes/GrafanaCtrl';\r\nimport { CoreEvents } from 'app/types';\r\n\r\nconst template = `\r\n<div class=\"layout-selector\">\r\n  <button ng-click=\"ctrl.listView()\" ng-class=\"{active: ctrl.mode === 'list'}\">\r\n    <i class=\"fa fa-list\"></i>\r\n  </button>\r\n  <button ng-click=\"ctrl.gridView()\" ng-class=\"{active: ctrl.mode === 'grid'}\">\r\n    <i class=\"fa fa-th\"></i>\r\n  </button>\r\n</div>\r\n`;\r\n\r\nexport class LayoutSelectorCtrl {\r\n  mode: string;\r\n\r\n  /** @ngInject */\r\n  constructor(private $rootScope: GrafanaRootScope) {\r\n    this.mode = store.get('grafana.list.layout.mode') || 'grid';\r\n  }\r\n\r\n  listView() {\r\n    this.mode = 'list';\r\n    store.set('grafana.list.layout.mode', 'list');\r\n    this.$rootScope.appEvent(CoreEvents.layoutModeChanged, 'list');\r\n  }\r\n\r\n  gridView() {\r\n    this.mode = 'grid';\r\n    store.set('grafana.list.layout.mode', 'grid');\r\n    this.$rootScope.appEvent(CoreEvents.layoutModeChanged, 'grid');\r\n  }\r\n}\r\n\r\n/** @ngInject */\r\nexport function layoutSelector() {\r\n  return {\r\n    restrict: 'E',\r\n    controller: LayoutSelectorCtrl,\r\n    bindToController: true,\r\n    controllerAs: 'ctrl',\r\n    scope: {},\r\n    template: template,\r\n  };\r\n}\r\n\r\n/** @ngInject */\r\nexport function layoutMode($rootScope: GrafanaRootScope) {\r\n  return {\r\n    restrict: 'A',\r\n    scope: {},\r\n    link: (scope: any, elem: any) => {\r\n      const layout = store.get('grafana.list.layout.mode') || 'grid';\r\n      let className = 'card-list-layout-' + layout;\r\n      elem.addClass(className);\r\n\r\n      $rootScope.onAppEvent(\r\n        CoreEvents.layoutModeChanged,\r\n        (evt: any, newLayout: any) => {\r\n          elem.removeClass(className);\r\n          className = 'card-list-layout-' + newLayout;\r\n          elem.addClass(className);\r\n        },\r\n        scope\r\n      );\r\n    },\r\n  };\r\n}\r\n\r\ncoreModule.directive('layoutSelector', layoutSelector);\r\ncoreModule.directive('layoutMode', layoutMode);\r\n","import { IScope } from 'angular';\r\nimport _ from 'lodash';\r\nimport coreModule from 'app/core/core_module';\r\nimport appEvents from 'app/core/app_events';\r\nimport { SearchSrv } from 'app/core/services/search_srv';\r\nimport { BackendSrv } from 'app/core/services/backend_srv';\r\nimport { ContextSrv } from 'app/core/services/context_srv';\r\nimport { CoreEvents } from 'app/types';\r\n\r\nexport interface Section {\r\n  id: number;\r\n  uid: string;\r\n  title: string;\r\n  expanded: boolean;\r\n  removable: boolean;\r\n  items: any[];\r\n  url: string;\r\n  icon: string;\r\n  score: number;\r\n  checked: boolean;\r\n  hideHeader: boolean;\r\n  toggle: Function;\r\n}\r\n\r\nexport interface FoldersAndDashboardUids {\r\n  folderUids: string[];\r\n  dashboardUids: string[];\r\n}\r\n\r\nclass Query {\r\n  query: string;\r\n  mode: string;\r\n  tag: any[];\r\n  starred: boolean;\r\n  skipRecent: boolean;\r\n  skipStarred: boolean;\r\n  folderIds: number[];\r\n}\r\n\r\nexport class ManageDashboardsCtrl {\r\n  sections: Section[];\r\n\r\n  query: Query;\r\n  navModel: any;\r\n\r\n  selectAllChecked = false;\r\n\r\n  // enable/disable actions depending on the folders or dashboards selected\r\n  canDelete = false;\r\n  canMove = false;\r\n\r\n  // filter variables\r\n  hasFilters = false;\r\n  tagFilterOptions: any[];\r\n  selectedTagFilter: any;\r\n  starredFilterOptions = [{ text: 'Filter by Starred', disabled: true }, { text: 'Yes' }, { text: 'No' }];\r\n  selectedStarredFilter: any;\r\n\r\n  // used when managing dashboards for a specific folder\r\n  folderId?: number;\r\n  folderUid?: string;\r\n\r\n  // if user can add new folders and/or add new dashboards\r\n  canSave = false;\r\n\r\n  // if user has editor role or higher\r\n  isEditor: boolean;\r\n\r\n  hasEditPermissionInFolders: boolean;\r\n\r\n  /** @ngInject */\r\n  constructor(\r\n    private $scope: IScope,\r\n    private backendSrv: BackendSrv,\r\n    private searchSrv: SearchSrv,\r\n    private contextSrv: ContextSrv\r\n  ) {\r\n    this.isEditor = this.contextSrv.isEditor;\r\n    this.hasEditPermissionInFolders = this.contextSrv.hasEditPermissionInFolders;\r\n\r\n    this.query = {\r\n      query: '',\r\n      mode: 'tree',\r\n      tag: [],\r\n      starred: false,\r\n      skipRecent: true,\r\n      skipStarred: true,\r\n      folderIds: [],\r\n    };\r\n\r\n    if (this.folderId) {\r\n      this.query.folderIds = [this.folderId];\r\n    }\r\n\r\n    this.selectedStarredFilter = this.starredFilterOptions[0];\r\n\r\n    this.refreshList().then(() => {\r\n      this.initTagFilter();\r\n    });\r\n  }\r\n\r\n  refreshList() {\r\n    return this.searchSrv\r\n      .search(this.query)\r\n      .then((result: Section[]) => {\r\n        return this.initDashboardList(result);\r\n      })\r\n      .then(() => {\r\n        if (!this.folderUid) {\r\n          this.$scope.$digest();\r\n          return;\r\n        }\r\n\r\n        return this.backendSrv.getFolderByUid(this.folderUid).then((folder: any) => {\r\n          this.canSave = folder.canSave;\r\n          if (!this.canSave) {\r\n            this.hasEditPermissionInFolders = false;\r\n          }\r\n          this.$scope.$digest();\r\n        });\r\n      });\r\n  }\r\n\r\n  initDashboardList(result: Section[]) {\r\n    this.canMove = false;\r\n    this.canDelete = false;\r\n    this.selectAllChecked = false;\r\n    this.hasFilters = this.query.query.length > 0 || this.query.tag.length > 0 || this.query.starred;\r\n\r\n    if (!result) {\r\n      this.sections = [];\r\n      return;\r\n    }\r\n\r\n    this.sections = result;\r\n\r\n    for (const section of this.sections) {\r\n      section.checked = false;\r\n\r\n      for (const dashboard of section.items) {\r\n        dashboard.checked = false;\r\n      }\r\n    }\r\n\r\n    if (this.folderId && this.sections.length > 0) {\r\n      this.sections[0].hideHeader = true;\r\n    }\r\n  }\r\n\r\n  selectionChanged() {\r\n    let selectedDashboards = 0;\r\n\r\n    for (const section of this.sections) {\r\n      selectedDashboards += _.filter(section.items, { checked: true } as any).length;\r\n    }\r\n\r\n    const selectedFolders = _.filter(this.sections, { checked: true }).length;\r\n    this.canMove = selectedDashboards > 0;\r\n    this.canDelete = selectedDashboards > 0 || selectedFolders > 0;\r\n  }\r\n\r\n  getFoldersAndDashboardsToDelete(): FoldersAndDashboardUids {\r\n    const selectedDashboards: FoldersAndDashboardUids = {\r\n      folderUids: [],\r\n      dashboardUids: [],\r\n    };\r\n\r\n    for (const section of this.sections) {\r\n      if (section.checked && section.id !== 0) {\r\n        selectedDashboards.folderUids.push(section.uid);\r\n      } else {\r\n        const selected = _.filter(section.items, { checked: true } as any);\r\n        selectedDashboards.dashboardUids.push(..._.map(selected, 'uid'));\r\n      }\r\n    }\r\n\r\n    return selectedDashboards;\r\n  }\r\n\r\n  getFolderIds(sections: Section[]) {\r\n    const ids = [];\r\n    for (const s of sections) {\r\n      if (s.checked) {\r\n        ids.push(s.id);\r\n      }\r\n    }\r\n    return ids;\r\n  }\r\n\r\n  delete() {\r\n    const data = this.getFoldersAndDashboardsToDelete();\r\n    const folderCount = data.folderUids.length;\r\n    const dashCount = data.dashboardUids.length;\r\n    let text = 'Do you want to delete the ';\r\n    let text2;\r\n\r\n    if (folderCount > 0 && dashCount > 0) {\r\n      text += `selected folder${folderCount === 1 ? '' : 's'} and dashboard${dashCount === 1 ? '' : 's'}?`;\r\n      text2 = `All dashboards of the selected folder${folderCount === 1 ? '' : 's'} will also be deleted`;\r\n    } else if (folderCount > 0) {\r\n      text += `selected folder${folderCount === 1 ? '' : 's'} and all its dashboards?`;\r\n    } else {\r\n      text += `selected dashboard${dashCount === 1 ? '' : 's'}?`;\r\n    }\r\n\r\n    appEvents.emit(CoreEvents.showConfirmModal, {\r\n      title: 'Delete',\r\n      text: text,\r\n      text2: text2,\r\n      icon: 'fa-trash',\r\n      yesText: 'Delete',\r\n      onConfirm: () => {\r\n        this.deleteFoldersAndDashboards(data.folderUids, data.dashboardUids);\r\n      },\r\n    });\r\n  }\r\n\r\n  private deleteFoldersAndDashboards(folderUids: string[], dashboardUids: string[]) {\r\n    this.backendSrv.deleteFoldersAndDashboards(folderUids, dashboardUids).then(() => {\r\n      this.refreshList();\r\n    });\r\n  }\r\n\r\n  getDashboardsToMove() {\r\n    const selectedDashboards = [];\r\n\r\n    for (const section of this.sections) {\r\n      const selected = _.filter(section.items, { checked: true } as any);\r\n      selectedDashboards.push(..._.map(selected, 'uid'));\r\n    }\r\n\r\n    return selectedDashboards;\r\n  }\r\n\r\n  moveTo() {\r\n    const selectedDashboards = this.getDashboardsToMove();\r\n\r\n    const template =\r\n      '<move-to-folder-modal dismiss=\"dismiss()\" ' +\r\n      'dashboards=\"model.dashboards\" after-save=\"model.afterSave()\">' +\r\n      '</move-to-folder-modal>';\r\n    appEvents.emit(CoreEvents.showModal, {\r\n      templateHtml: template,\r\n      modalClass: 'modal--narrow',\r\n      model: {\r\n        dashboards: selectedDashboards,\r\n        afterSave: this.refreshList.bind(this),\r\n      },\r\n    });\r\n  }\r\n\r\n  initTagFilter() {\r\n    return this.searchSrv.getDashboardTags().then((results: any) => {\r\n      this.tagFilterOptions = [{ term: 'Filter By Tag', disabled: true }].concat(results);\r\n      this.selectedTagFilter = this.tagFilterOptions[0];\r\n    });\r\n  }\r\n\r\n  filterByTag(tag: any) {\r\n    if (_.indexOf(this.query.tag, tag) === -1) {\r\n      this.query.tag.push(tag);\r\n    }\r\n\r\n    return this.refreshList();\r\n  }\r\n\r\n  onQueryChange() {\r\n    return this.refreshList();\r\n  }\r\n\r\n  onTagFilterChange() {\r\n    const res = this.filterByTag(this.selectedTagFilter.term);\r\n    this.selectedTagFilter = this.tagFilterOptions[0];\r\n    return res;\r\n  }\r\n\r\n  removeTag(tag: any, evt: Event) {\r\n    this.query.tag = _.without(this.query.tag, tag);\r\n    this.refreshList();\r\n    if (evt) {\r\n      evt.stopPropagation();\r\n      evt.preventDefault();\r\n    }\r\n  }\r\n\r\n  removeStarred() {\r\n    this.query.starred = false;\r\n    return this.refreshList();\r\n  }\r\n\r\n  onStarredFilterChange() {\r\n    this.query.starred = this.selectedStarredFilter.text === 'Yes';\r\n    this.selectedStarredFilter = this.starredFilterOptions[0];\r\n    return this.refreshList();\r\n  }\r\n\r\n  onSelectAllChanged() {\r\n    for (const section of this.sections) {\r\n      if (!section.hideHeader) {\r\n        section.checked = this.selectAllChecked;\r\n      }\r\n\r\n      section.items = _.map(section.items, (item: any) => {\r\n        item.checked = this.selectAllChecked;\r\n        return item;\r\n      });\r\n    }\r\n\r\n    this.selectionChanged();\r\n  }\r\n\r\n  clearFilters() {\r\n    this.query.query = '';\r\n    this.query.tag = [];\r\n    this.query.starred = false;\r\n    this.refreshList();\r\n  }\r\n\r\n  createDashboardUrl() {\r\n    let url = 'dashboard/new';\r\n\r\n    if (this.folderId) {\r\n      url += `?folderId=${this.folderId}`;\r\n    }\r\n\r\n    return url;\r\n  }\r\n\r\n  importDashboardUrl() {\r\n    let url = 'dashboard/import';\r\n\r\n    if (this.folderId) {\r\n      url += `?folderId=${this.folderId}`;\r\n    }\r\n\r\n    return url;\r\n  }\r\n}\r\n\r\nexport function manageDashboardsDirective() {\r\n  return {\r\n    restrict: 'E',\r\n    templateUrl: 'public/app/core/components/manage_dashboards/manage_dashboards.html',\r\n    controller: ManageDashboardsCtrl,\r\n    bindToController: true,\r\n    controllerAs: 'ctrl',\r\n    scope: {\r\n      folderId: '=',\r\n      folderUid: '=',\r\n    },\r\n  };\r\n}\r\n\r\ncoreModule.directive('manageDashboards', manageDashboardsDirective);\r\n","import _ from 'lodash';\r\n\r\nexport class QueryPartDef {\r\n  type: string;\r\n  params: any[];\r\n  defaultParams: any[];\r\n  renderer: any;\r\n  category: any;\r\n  addStrategy: any;\r\n\r\n  constructor(options: any) {\r\n    this.type = options.type;\r\n    this.params = options.params;\r\n    this.defaultParams = options.defaultParams;\r\n    this.renderer = options.renderer;\r\n    this.category = options.category;\r\n    this.addStrategy = options.addStrategy;\r\n  }\r\n}\r\n\r\nexport class QueryPart {\r\n  part: any;\r\n  def: QueryPartDef;\r\n  params: any[];\r\n  text: string;\r\n\r\n  constructor(part: any, def: any) {\r\n    this.part = part;\r\n    this.def = def;\r\n    if (!this.def) {\r\n      throw { message: 'Could not find query part ' + part.type };\r\n    }\r\n\r\n    part.params = part.params || _.clone(this.def.defaultParams);\r\n    this.params = part.params;\r\n    this.updateText();\r\n  }\r\n\r\n  render(innerExpr: string) {\r\n    return this.def.renderer(this, innerExpr);\r\n  }\r\n\r\n  hasMultipleParamsInString(strValue: string, index: number) {\r\n    if (strValue.indexOf(',') === -1) {\r\n      return false;\r\n    }\r\n\r\n    return this.def.params[index + 1] && this.def.params[index + 1].optional;\r\n  }\r\n\r\n  updateParam(strValue: string, index: number) {\r\n    // handle optional parameters\r\n    // if string contains ',' and next param is optional, split and update both\r\n    if (this.hasMultipleParamsInString(strValue, index)) {\r\n      _.each(strValue.split(','), (partVal, idx) => {\r\n        this.updateParam(partVal.trim(), idx);\r\n      });\r\n      return;\r\n    }\r\n\r\n    if (strValue === '' && this.def.params[index].optional) {\r\n      this.params.splice(index, 1);\r\n    } else {\r\n      this.params[index] = strValue;\r\n    }\r\n\r\n    this.part.params = this.params;\r\n    this.updateText();\r\n  }\r\n\r\n  updateText() {\r\n    if (this.params.length === 0) {\r\n      this.text = this.def.type + '()';\r\n      return;\r\n    }\r\n\r\n    let text = this.def.type + '(';\r\n    text += this.params.join(', ');\r\n    text += ')';\r\n    this.text = text;\r\n  }\r\n}\r\n\r\nexport function functionRenderer(part: any, innerExpr: string) {\r\n  const str = part.def.type + '(';\r\n  const parameters = _.map(part.params, (value, index) => {\r\n    const paramType = part.def.params[index];\r\n    if (paramType.type === 'time') {\r\n      if (value === 'auto') {\r\n        value = '$__interval';\r\n      }\r\n    }\r\n    if (paramType.quote === 'single') {\r\n      return \"'\" + value + \"'\";\r\n    } else if (paramType.quote === 'double') {\r\n      return '\"' + value + '\"';\r\n    }\r\n\r\n    return value;\r\n  });\r\n\r\n  if (innerExpr) {\r\n    parameters.unshift(innerExpr);\r\n  }\r\n  return str + parameters.join(', ') + ')';\r\n}\r\n\r\nexport function suffixRenderer(part: QueryPartDef, innerExpr: string) {\r\n  return innerExpr + ' ' + part.params[0];\r\n}\r\n\r\nexport function identityRenderer(part: QueryPartDef, innerExpr: string) {\r\n  return part.params[0];\r\n}\r\n\r\nexport function quotedIdentityRenderer(part: QueryPartDef, innerExpr: string) {\r\n  return '\"' + part.params[0] + '\"';\r\n}\r\n","import _ from 'lodash';\r\nimport $ from 'jquery';\r\nimport coreModule from 'app/core/core_module';\r\n\r\nconst template = `\r\n<div class=\"dropdown cascade-open\">\r\n<a ng-click=\"showActionsMenu()\" class=\"query-part-name pointer dropdown-toggle\" data-toggle=\"dropdown\">{{part.def.type}}</a>\r\n<span>(</span><span class=\"query-part-parameters\"></span><span>)</span>\r\n<ul class=\"dropdown-menu\">\r\n  <li ng-repeat=\"action in partActions\">\r\n    <a ng-click=\"triggerPartAction(action)\">{{action.text}}</a>\r\n  </li>\r\n</ul>\r\n`;\r\n\r\n/** @ngInject */\r\nexport function queryPartEditorDirective(templateSrv: any) {\r\n  const paramTemplate = '<input type=\"text\" class=\"hide input-mini tight-form-func-param\"></input>';\r\n\r\n  return {\r\n    restrict: 'E',\r\n    template: template,\r\n    scope: {\r\n      part: '=',\r\n      handleEvent: '&',\r\n      debounce: '@',\r\n    },\r\n    link: function postLink($scope: any, elem: any) {\r\n      const part = $scope.part;\r\n      const partDef = part.def;\r\n      const $paramsContainer = elem.find('.query-part-parameters');\r\n      const debounceLookup = $scope.debounce;\r\n\r\n      $scope.partActions = [];\r\n\r\n      function clickFuncParam(this: any, paramIndex: number) {\r\n        /*jshint validthis:true */\r\n        const $link = $(this);\r\n        const $input = $link.next();\r\n\r\n        $input.val(part.params[paramIndex]);\r\n        $input.css('width', $link.width() + 16 + 'px');\r\n\r\n        $link.hide();\r\n        $input.show();\r\n        $input.focus();\r\n        $input.select();\r\n\r\n        const typeahead = $input.data('typeahead');\r\n        if (typeahead) {\r\n          $input.val('');\r\n          typeahead.lookup();\r\n        }\r\n      }\r\n\r\n      function inputBlur(this: any, paramIndex: number) {\r\n        /*jshint validthis:true */\r\n        const $input = $(this);\r\n        const $link = $input.prev();\r\n        const newValue = $input.val();\r\n\r\n        if (newValue !== '' || part.def.params[paramIndex].optional) {\r\n          $link.html(templateSrv.highlightVariablesAsHtml(newValue));\r\n\r\n          part.updateParam($input.val(), paramIndex);\r\n          $scope.$apply(() => {\r\n            $scope.handleEvent({ $event: { name: 'part-param-changed' } });\r\n          });\r\n        }\r\n\r\n        $input.hide();\r\n        $link.show();\r\n      }\r\n\r\n      function inputKeyPress(this: any, paramIndex: number, e: any) {\r\n        /*jshint validthis:true */\r\n        if (e.which === 13) {\r\n          inputBlur.call(this, paramIndex);\r\n        }\r\n      }\r\n\r\n      function inputKeyDown(this: any) {\r\n        /*jshint validthis:true */\r\n        this.style.width = (3 + this.value.length) * 8 + 'px';\r\n      }\r\n\r\n      function addTypeahead($input: JQuery, param: any, paramIndex: number) {\r\n        if (!param.options && !param.dynamicLookup) {\r\n          return;\r\n        }\r\n\r\n        const typeaheadSource = (query: string, callback: any) => {\r\n          if (param.options) {\r\n            let options = param.options;\r\n            if (param.type === 'int') {\r\n              options = _.map(options, val => {\r\n                return val.toString();\r\n              });\r\n            }\r\n            return options;\r\n          }\r\n\r\n          $scope.$apply(() => {\r\n            $scope.handleEvent({ $event: { name: 'get-param-options' } }).then((result: any) => {\r\n              const dynamicOptions = _.map(result, op => {\r\n                return _.escape(op.value);\r\n              });\r\n              callback(dynamicOptions);\r\n            });\r\n          });\r\n        };\r\n\r\n        $input.attr('data-provide', 'typeahead');\r\n\r\n        $input.typeahead({\r\n          source: typeaheadSource,\r\n          minLength: 0,\r\n          items: 1000,\r\n          updater: (value: string) => {\r\n            value = _.unescape(value);\r\n            setTimeout(() => {\r\n              inputBlur.call($input[0], paramIndex);\r\n            }, 0);\r\n            return value;\r\n          },\r\n        });\r\n\r\n        const typeahead = $input.data('typeahead');\r\n        typeahead.lookup = function() {\r\n          this.query = this.$element.val() || '';\r\n          const items = this.source(this.query, $.proxy(this.process, this));\r\n          return items ? this.process(items) : items;\r\n        };\r\n\r\n        if (debounceLookup) {\r\n          typeahead.lookup = _.debounce(typeahead.lookup, 500, { leading: true });\r\n        }\r\n      }\r\n\r\n      $scope.showActionsMenu = () => {\r\n        $scope.handleEvent({ $event: { name: 'get-part-actions' } }).then((res: any) => {\r\n          $scope.partActions = res;\r\n        });\r\n      };\r\n\r\n      $scope.triggerPartAction = (action: string) => {\r\n        $scope.handleEvent({ $event: { name: 'action', action: action } });\r\n      };\r\n\r\n      function addElementsAndCompile() {\r\n        _.each(partDef.params, (param: any, index: number) => {\r\n          if (param.optional && part.params.length <= index) {\r\n            return;\r\n          }\r\n\r\n          if (index > 0) {\r\n            $('<span>, </span>').appendTo($paramsContainer);\r\n          }\r\n\r\n          const paramValue = templateSrv.highlightVariablesAsHtml(part.params[index]);\r\n          const $paramLink = $('<a class=\"graphite-func-param-link pointer\">' + paramValue + '</a>');\r\n          const $input = $(paramTemplate);\r\n\r\n          $paramLink.appendTo($paramsContainer);\r\n          $input.appendTo($paramsContainer);\r\n\r\n          $input.blur(_.partial(inputBlur, index));\r\n          $input.keyup(inputKeyDown);\r\n          $input.keypress(_.partial(inputKeyPress, index));\r\n          $paramLink.click(_.partial(clickFuncParam, index));\r\n\r\n          addTypeahead($input, param, index);\r\n        });\r\n      }\r\n\r\n      function relink() {\r\n        $paramsContainer.empty();\r\n        addElementsAndCompile();\r\n      }\r\n\r\n      relink();\r\n    },\r\n  };\r\n}\r\n\r\ncoreModule.directive('queryPartEditor', queryPartEditorDirective);\r\n","import $ from 'jquery';\r\n// @ts-ignore\r\nimport baron from 'baron';\r\nimport coreModule from 'app/core/core_module';\r\n\r\nconst scrollBarHTML = `\r\n<div class=\"baron__track\">\r\n  <div class=\"baron__bar\"></div>\r\n</div>\r\n`;\r\n\r\nconst scrollRootClass = 'baron baron__root';\r\nconst scrollerClass = 'baron__scroller';\r\n\r\nexport function geminiScrollbar() {\r\n  return {\r\n    restrict: 'A',\r\n    link: (scope: any, elem: any, attrs: any) => {\r\n      let scrollRoot = elem.parent();\r\n      const scroller = elem;\r\n\r\n      console.log('scroll');\r\n      if (attrs.grafanaScrollbar && attrs.grafanaScrollbar === 'scrollonroot') {\r\n        scrollRoot = scroller;\r\n      }\r\n\r\n      scrollRoot.addClass(scrollRootClass);\r\n      $(scrollBarHTML).appendTo(scrollRoot);\r\n      elem.addClass(scrollerClass);\r\n\r\n      const scrollParams = {\r\n        root: scrollRoot[0],\r\n        scroller: scroller[0],\r\n        bar: '.baron__bar',\r\n        barOnCls: '_scrollbar',\r\n        scrollingCls: '_scrolling',\r\n        track: '.baron__track',\r\n        direction: 'v',\r\n      };\r\n\r\n      const scrollbar = baron(scrollParams);\r\n\r\n      scope.$on('$destroy', () => {\r\n        scrollbar.dispose();\r\n      });\r\n    },\r\n  };\r\n}\r\n\r\ncoreModule.directive('grafanaScrollbar', geminiScrollbar);\r\n","import React, { useContext } from 'react';\r\n// @ts-ignore\r\nimport tinycolor from 'tinycolor2';\r\nimport { SearchQuery } from './search';\r\nimport { css, cx } from 'emotion';\r\nimport { ThemeContext, selectThemeVariant } from '@grafana/ui';\r\nimport { GrafanaTheme } from '@grafana/data';\r\n\r\ntype Omit<T, K extends keyof T> = Pick<T, Exclude<keyof T, K>>;\r\n\r\ninterface SearchFieldProps extends Omit<React.HTMLAttributes<HTMLInputElement>, 'onChange'> {\r\n  query: SearchQuery;\r\n  onChange: (query: string) => void;\r\n  onKeyDown: (e: React.KeyboardEvent<HTMLInputElement>) => void;\r\n}\r\n\r\nconst getSearchFieldStyles = (theme: GrafanaTheme) => ({\r\n  wrapper: css`\r\n    width: 100%;\r\n    height: 55px; /* this variable is not part of GrafanaTheme yet*/\r\n    display: flex;\r\n    background-color: ${selectThemeVariant(\r\n      {\r\n        light: theme.colors.white,\r\n        dark: theme.colors.dark4,\r\n      },\r\n      theme.type\r\n    )};\r\n    position: relative;\r\n  `,\r\n  input: css`\r\n    max-width: 653px;\r\n    padding: ${theme.spacing.md} ${theme.spacing.md} ${theme.spacing.sm} ${theme.spacing.md};\r\n    height: 51px;\r\n    box-sizing: border-box;\r\n    outline: none;\r\n    background: ${selectThemeVariant(\r\n      {\r\n        light: theme.colors.dark1,\r\n        dark: theme.colors.black,\r\n      },\r\n      theme.type\r\n    )};\r\n    background-color: ${selectThemeVariant(\r\n      {\r\n        light: tinycolor(theme.colors.white)\r\n          .lighten(4)\r\n          .toString(),\r\n        dark: theme.colors.dark4,\r\n      },\r\n      theme.type\r\n    )};\r\n    flex-grow: 10;\r\n  `,\r\n  spacer: css`\r\n    flex-grow: 1;\r\n  `,\r\n  icon: cx(\r\n    css`\r\n      font-size: ${theme.typography.size.lg};\r\n      padding: ${theme.spacing.md} ${theme.spacing.md} ${theme.spacing.sm} ${theme.spacing.md};\r\n    `,\r\n    'pointer'\r\n  ),\r\n});\r\n\r\nexport const SearchField: React.FunctionComponent<SearchFieldProps> = ({ query, onChange, ...inputProps }) => {\r\n  const theme = useContext(ThemeContext);\r\n  const styles = getSearchFieldStyles(theme);\r\n\r\n  return (\r\n    <>\r\n      {/* search-field-wrapper class name left on purpose until we migrate entire search to React */}\r\n      {/* based on it GrafanaCtrl (L256) decides whether or not hide search */}\r\n      <div className={`${styles.wrapper} search-field-wrapper`}>\r\n        <div className={styles.icon}>\r\n          <i className=\"fa fa-search\" />\r\n        </div>\r\n\r\n        <input\r\n          type=\"text\"\r\n          placeholder=\"Find dashboards by name\"\r\n          value={query.query}\r\n          onChange={(event: React.ChangeEvent<HTMLInputElement>) => {\r\n            onChange(event.currentTarget.value);\r\n          }}\r\n          tabIndex={1}\r\n          spellCheck={false}\r\n          {...inputProps}\r\n          className={styles.input}\r\n        />\r\n\r\n        <div className={styles.spacer} />\r\n      </div>\r\n    </>\r\n  );\r\n};\r\n","import _, { debounce } from 'lodash';\r\nimport coreModule from '../../core_module';\r\nimport { SearchSrv } from 'app/core/services/search_srv';\r\nimport { contextSrv } from 'app/core/services/context_srv';\r\n\r\nimport appEvents from 'app/core/app_events';\r\nimport { parse, SearchParserOptions, SearchParserResult } from 'search-query-parser';\r\nimport { getDashboardSrv } from 'app/features/dashboard/services/DashboardSrv';\r\nimport { CoreEvents } from 'app/types';\r\n\r\nexport interface SearchQuery {\r\n  query: string;\r\n  parsedQuery: SearchParserResult;\r\n  tags: string[];\r\n  starred: boolean;\r\n}\r\n\r\nclass SearchQueryParser {\r\n  config: SearchParserOptions;\r\n  constructor(config: SearchParserOptions) {\r\n    this.config = config;\r\n  }\r\n\r\n  parse(query: string) {\r\n    const parsedQuery = parse(query, this.config);\r\n\r\n    if (typeof parsedQuery === 'string') {\r\n      return {\r\n        text: parsedQuery,\r\n      } as SearchParserResult;\r\n    }\r\n\r\n    return parsedQuery;\r\n  }\r\n}\r\n\r\ninterface SelectedIndicies {\r\n  dashboardIndex?: number;\r\n  folderIndex?: number;\r\n}\r\n\r\ninterface OpenSearchParams {\r\n  query?: string;\r\n}\r\n\r\nexport class SearchCtrl {\r\n  isOpen: boolean;\r\n  query: SearchQuery;\r\n  giveSearchFocus: boolean;\r\n  selectedIndex: number;\r\n  results: any;\r\n  currentSearchId: number;\r\n  showImport: boolean;\r\n  dismiss: any;\r\n  ignoreClose: any;\r\n  isLoading: boolean;\r\n  initialFolderFilterTitle: string;\r\n  isEditor: string;\r\n  hasEditPermissionInFolders: boolean;\r\n  queryParser: SearchQueryParser;\r\n\r\n  /** @ngInject */\r\n  constructor(private $scope: any, private $location: any, private $timeout: any, private searchSrv: SearchSrv) {\r\n    appEvents.on(CoreEvents.showDashSearch, this.openSearch.bind(this), $scope);\r\n    appEvents.on(CoreEvents.hideDashSearch, this.closeSearch.bind(this), $scope);\r\n    appEvents.on(CoreEvents.searchQuery, debounce(this.search.bind(this), 500), $scope);\r\n\r\n    this.initialFolderFilterTitle = 'All';\r\n    this.isEditor = contextSrv.isEditor;\r\n    this.hasEditPermissionInFolders = contextSrv.hasEditPermissionInFolders;\r\n    this.onQueryChange = this.onQueryChange.bind(this);\r\n    this.onKeyDown = this.onKeyDown.bind(this);\r\n    this.query = {\r\n      query: '',\r\n      parsedQuery: { text: '' },\r\n      tags: [],\r\n      starred: false,\r\n    };\r\n\r\n    this.queryParser = new SearchQueryParser({\r\n      keywords: ['folder'],\r\n    });\r\n  }\r\n\r\n  closeSearch() {\r\n    this.isOpen = this.ignoreClose;\r\n  }\r\n\r\n  onQueryChange(query: SearchQuery | string) {\r\n    if (typeof query === 'string') {\r\n      this.query = {\r\n        ...this.query,\r\n        parsedQuery: this.queryParser.parse(query),\r\n        query: query,\r\n      };\r\n    } else {\r\n      this.query = query;\r\n    }\r\n    appEvents.emit(CoreEvents.searchQuery);\r\n  }\r\n\r\n  openSearch(payload: OpenSearchParams = {}) {\r\n    if (this.isOpen) {\r\n      this.closeSearch();\r\n      return;\r\n    }\r\n\r\n    this.isOpen = true;\r\n    this.giveSearchFocus = true;\r\n    this.selectedIndex = -1;\r\n    this.results = [];\r\n    this.query = {\r\n      query: payload.query ? `${payload.query} ` : '',\r\n      parsedQuery: this.queryParser.parse(payload.query),\r\n      tags: [],\r\n      starred: false,\r\n    };\r\n\r\n    this.currentSearchId = 0;\r\n    this.ignoreClose = true;\r\n    this.isLoading = true;\r\n\r\n    this.$timeout(() => {\r\n      this.ignoreClose = false;\r\n      this.giveSearchFocus = true;\r\n      this.search();\r\n    }, 100);\r\n  }\r\n\r\n  onKeyDown(evt: KeyboardEvent) {\r\n    if (evt.keyCode === 27) {\r\n      this.closeSearch();\r\n    }\r\n    if (evt.keyCode === 40) {\r\n      this.moveSelection(1);\r\n    }\r\n    if (evt.keyCode === 38) {\r\n      this.moveSelection(-1);\r\n    }\r\n    if (evt.keyCode === 13) {\r\n      const flattenedResult = this.getFlattenedResultForNavigation();\r\n      const currentItem = flattenedResult[this.selectedIndex];\r\n\r\n      if (currentItem) {\r\n        if (currentItem.dashboardIndex !== undefined) {\r\n          const selectedDash = this.results[currentItem.folderIndex].items[currentItem.dashboardIndex];\r\n\r\n          if (selectedDash) {\r\n            this.$location.search({});\r\n            this.$location.path(selectedDash.url);\r\n            this.closeSearch();\r\n          }\r\n        } else {\r\n          const selectedFolder = this.results[currentItem.folderIndex];\r\n\r\n          if (selectedFolder) {\r\n            selectedFolder.toggle(selectedFolder);\r\n          }\r\n        }\r\n      }\r\n    }\r\n  }\r\n\r\n  onFilterboxClick() {\r\n    this.giveSearchFocus = false;\r\n    this.preventClose();\r\n  }\r\n\r\n  preventClose() {\r\n    this.ignoreClose = true;\r\n\r\n    this.$timeout(() => {\r\n      this.ignoreClose = false;\r\n    }, 100);\r\n  }\r\n\r\n  moveSelection(direction: number) {\r\n    if (this.results.length === 0) {\r\n      return;\r\n    }\r\n\r\n    const flattenedResult = this.getFlattenedResultForNavigation();\r\n    const currentItem = flattenedResult[this.selectedIndex];\r\n\r\n    if (currentItem) {\r\n      if (currentItem.dashboardIndex !== undefined) {\r\n        this.results[currentItem.folderIndex].items[currentItem.dashboardIndex].selected = false;\r\n      } else {\r\n        this.results[currentItem.folderIndex].selected = false;\r\n      }\r\n    }\r\n\r\n    if (direction === 0) {\r\n      this.selectedIndex = -1;\r\n      return;\r\n    }\r\n\r\n    const max = flattenedResult.length;\r\n    const newIndex = (this.selectedIndex + direction) % max;\r\n    this.selectedIndex = newIndex < 0 ? newIndex + max : newIndex;\r\n    const selectedItem = flattenedResult[this.selectedIndex];\r\n\r\n    if (selectedItem.dashboardIndex === undefined && this.results[selectedItem.folderIndex].id === 0) {\r\n      this.moveSelection(direction);\r\n      return;\r\n    }\r\n\r\n    if (selectedItem.dashboardIndex !== undefined) {\r\n      if (!this.results[selectedItem.folderIndex].expanded) {\r\n        this.moveSelection(direction);\r\n        return;\r\n      }\r\n\r\n      this.results[selectedItem.folderIndex].items[selectedItem.dashboardIndex].selected = true;\r\n      return;\r\n    }\r\n\r\n    if (this.results[selectedItem.folderIndex].hideHeader) {\r\n      this.moveSelection(direction);\r\n      return;\r\n    }\r\n\r\n    this.results[selectedItem.folderIndex].selected = true;\r\n  }\r\n\r\n  searchDashboards(folderContext?: string) {\r\n    this.currentSearchId = this.currentSearchId + 1;\r\n    const localSearchId = this.currentSearchId;\r\n    const folderIds = [];\r\n\r\n    const { parsedQuery } = this.query;\r\n\r\n    if (folderContext === 'current') {\r\n      folderIds.push(getDashboardSrv().getCurrent().meta.folderId);\r\n    }\r\n\r\n    const query = {\r\n      ...this.query,\r\n      query: parsedQuery.text,\r\n      tag: this.query.tags,\r\n      folderIds,\r\n    };\r\n\r\n    return this.searchSrv\r\n      .search({\r\n        ...query,\r\n      })\r\n      .then(results => {\r\n        if (localSearchId < this.currentSearchId) {\r\n          return;\r\n        }\r\n        this.results = results || [];\r\n        this.isLoading = false;\r\n        this.moveSelection(1);\r\n        this.$scope.$digest();\r\n      });\r\n  }\r\n\r\n  queryHasNoFilters() {\r\n    const query = this.query;\r\n    return query.query === '' && query.starred === false && query.tags.length === 0;\r\n  }\r\n\r\n  filterByTag(tag: string) {\r\n    if (_.indexOf(this.query.tags, tag) === -1) {\r\n      this.query.tags.push(tag);\r\n      this.search();\r\n    }\r\n  }\r\n\r\n  removeTag(tag: string, evt: any) {\r\n    this.query.tags = _.without(this.query.tags, tag);\r\n    this.search();\r\n    this.giveSearchFocus = true;\r\n    evt.stopPropagation();\r\n    evt.preventDefault();\r\n  }\r\n\r\n  getTags = () => {\r\n    return this.searchSrv.getDashboardTags();\r\n  };\r\n\r\n  onTagFiltersChanged = (tags: string[]) => {\r\n    this.query.tags = tags;\r\n    this.search();\r\n  };\r\n\r\n  clearSearchFilter() {\r\n    this.query.query = '';\r\n    this.query.tags = [];\r\n    this.search();\r\n  }\r\n\r\n  showStarred() {\r\n    this.query.starred = !this.query.starred;\r\n    this.giveSearchFocus = true;\r\n    this.search();\r\n  }\r\n\r\n  search() {\r\n    this.showImport = false;\r\n    this.selectedIndex = -1;\r\n    this.searchDashboards(this.query.parsedQuery['folder']);\r\n  }\r\n\r\n  folderExpanding() {\r\n    this.moveSelection(0);\r\n  }\r\n\r\n  private getFlattenedResultForNavigation(): SelectedIndicies[] {\r\n    let folderIndex = 0;\r\n\r\n    return _.flatMap(this.results, (s: any) => {\r\n      let result: SelectedIndicies[] = [];\r\n\r\n      result.push({\r\n        folderIndex: folderIndex,\r\n      });\r\n\r\n      let dashboardIndex = 0;\r\n\r\n      result = result.concat(\r\n        _.map(s.items || [], i => {\r\n          return {\r\n            folderIndex: folderIndex,\r\n            dashboardIndex: dashboardIndex++,\r\n          };\r\n        })\r\n      );\r\n\r\n      folderIndex++;\r\n      return result;\r\n    });\r\n  }\r\n}\r\n\r\nexport function searchDirective() {\r\n  return {\r\n    restrict: 'E',\r\n    templateUrl: 'public/app/core/components/search/search.html',\r\n    controller: SearchCtrl,\r\n    bindToController: true,\r\n    controllerAs: 'ctrl',\r\n    scope: {},\r\n  };\r\n}\r\n\r\ncoreModule.directive('dashboardSearch', searchDirective);\r\n","import _ from 'lodash';\r\nimport { e2e } from '@grafana/e2e';\r\n\r\nimport coreModule from '../../core_module';\r\nimport appEvents from 'app/core/app_events';\r\nimport { CoreEvents } from 'app/types';\r\n\r\nexport class SearchResultsCtrl {\r\n  results: any;\r\n  onSelectionChanged: any;\r\n  onTagSelected: any;\r\n  onFolderExpanding: any;\r\n  editable: boolean;\r\n  selectors: typeof e2e.pages.Dashboards.selectors;\r\n\r\n  /** @ngInject */\r\n  constructor(private $location: any) {\r\n    this.selectors = e2e.pages.Dashboards.selectors;\r\n  }\r\n\r\n  toggleFolderExpand(section: any) {\r\n    if (section.toggle) {\r\n      if (!section.expanded && this.onFolderExpanding) {\r\n        this.onFolderExpanding();\r\n      }\r\n\r\n      section.toggle(section).then((f: any) => {\r\n        if (this.editable && f.expanded) {\r\n          if (f.items) {\r\n            _.each(f.items, i => {\r\n              i.checked = f.checked;\r\n            });\r\n\r\n            if (this.onSelectionChanged) {\r\n              this.onSelectionChanged();\r\n            }\r\n          }\r\n        }\r\n      });\r\n    }\r\n  }\r\n\r\n  navigateToFolder(section: any, evt: any) {\r\n    this.$location.path(section.url);\r\n\r\n    if (evt) {\r\n      evt.stopPropagation();\r\n      evt.preventDefault();\r\n    }\r\n  }\r\n\r\n  toggleSelection(item: any, evt: any) {\r\n    item.checked = !item.checked;\r\n\r\n    if (item.items) {\r\n      _.each(item.items, i => {\r\n        i.checked = item.checked;\r\n      });\r\n    }\r\n\r\n    if (this.onSelectionChanged) {\r\n      this.onSelectionChanged();\r\n    }\r\n\r\n    if (evt) {\r\n      evt.stopPropagation();\r\n      evt.preventDefault();\r\n    }\r\n  }\r\n\r\n  onItemClick(item: any) {\r\n    //Check if one string can be found in the other\r\n    if (this.$location.path().indexOf(item.url) > -1 || item.url.indexOf(this.$location.path()) > -1) {\r\n      appEvents.emit(CoreEvents.hideDashSearch);\r\n    }\r\n  }\r\n\r\n  selectTag(tag: any, evt: any) {\r\n    if (this.onTagSelected) {\r\n      this.onTagSelected({ $tag: tag });\r\n    }\r\n\r\n    if (evt) {\r\n      evt.stopPropagation();\r\n      evt.preventDefault();\r\n    }\r\n  }\r\n}\r\n\r\nexport function searchResultsDirective() {\r\n  return {\r\n    restrict: 'E',\r\n    templateUrl: 'public/app/core/components/search/search_results.html',\r\n    controller: SearchResultsCtrl,\r\n    bindToController: true,\r\n    controllerAs: 'ctrl',\r\n    scope: {\r\n      editable: '@',\r\n      results: '=',\r\n      onSelectionChanged: '&',\r\n      onTagSelected: '&',\r\n      onFolderExpanding: '&',\r\n    },\r\n  };\r\n}\r\n\r\ncoreModule.directive('dashboardSearchResults', searchResultsDirective);\r\n","import React, { PureComponent } from 'react';\r\nimport appEvents from '../../app_events';\r\nimport { User } from '../../services/context_srv';\r\nimport { NavModelItem } from '@grafana/data';\r\nimport { CoreEvents } from 'app/types';\r\nimport { OrgSwitcher } from '../OrgSwitcher';\r\nimport { getFooterLinks } from '../Footer/Footer';\r\n\r\nexport interface Props {\r\n  link: NavModelItem;\r\n  user: User;\r\n}\r\n\r\ninterface State {\r\n  showSwitcherModal: boolean;\r\n}\r\n\r\nclass BottomNavLinks extends PureComponent<Props, State> {\r\n  state: State = {\r\n    showSwitcherModal: false,\r\n  };\r\n\r\n  onOpenShortcuts = () => {\r\n    appEvents.emit(CoreEvents.showModal, {\r\n      templateHtml: '<help-modal></help-modal>',\r\n    });\r\n  };\r\n\r\n  toggleSwitcherModal = () => {\r\n    this.setState(prevState => ({\r\n      showSwitcherModal: !prevState.showSwitcherModal,\r\n    }));\r\n  };\r\n\r\n  render() {\r\n    const { link, user } = this.props;\r\n    const { showSwitcherModal } = this.state;\r\n\r\n    let children = link.children || [];\r\n\r\n    if (link.id === 'help') {\r\n      children = getFooterLinks();\r\n    }\r\n\r\n    return (\r\n      <div className=\"sidemenu-item dropdown dropup\">\r\n        <a href={link.url} className=\"sidemenu-link\" target={link.target}>\r\n          <span className=\"icon-circle sidemenu-icon\">\r\n            {link.icon && <i className={link.icon} />}\r\n            {link.img && <img src={link.img} />}\r\n          </span>\r\n        </a>\r\n        <ul className=\"dropdown-menu dropdown-menu--sidemenu\" role=\"menu\">\r\n          {link.subTitle && (\r\n            <li className=\"sidemenu-subtitle\">\r\n              <span className=\"sidemenu-item-text\">{link.subTitle}</span>\r\n            </li>\r\n          )}\r\n          {link.showOrgSwitcher && (\r\n            <li className=\"sidemenu-org-switcher\">\r\n              <a onClick={this.toggleSwitcherModal}>\r\n                <div>\r\n                  <div className=\"sidemenu-org-switcher__org-name\">{user.orgName}</div>\r\n                  <div className=\"sidemenu-org-switcher__org-current\">Current Org:</div>\r\n                </div>\r\n                <div className=\"sidemenu-org-switcher__switch\">\r\n                  <i className=\"fa fa-fw fa-random\" />\r\n                  Switch\r\n                </div>\r\n              </a>\r\n            </li>\r\n          )}\r\n\r\n          {showSwitcherModal && <OrgSwitcher onDismiss={this.toggleSwitcherModal} />}\r\n\r\n          {children.map((child, index) => {\r\n            return (\r\n              <li key={`${child.text}-${index}`}>\r\n                <a href={child.url} target={child.target} rel=\"noopener\">\r\n                  {child.icon && <i className={child.icon} />}\r\n                  {child.text}\r\n                </a>\r\n              </li>\r\n            );\r\n          })}\r\n\r\n          {link.id === 'help' && (\r\n            <li key=\"keyboard-shortcuts\">\r\n              <a onClick={() => this.onOpenShortcuts()}>\r\n                <i className=\"fa fa-keyboard-o\" /> Keyboard shortcuts\r\n              </a>\r\n            </li>\r\n          )}\r\n\r\n          <li className=\"side-menu-header\">\r\n            <span className=\"sidemenu-item-text\">{link.text}</span>\r\n          </li>\r\n        </ul>\r\n      </div>\r\n    );\r\n  }\r\n}\r\n\r\nexport default BottomNavLinks;\r\n","import React from 'react';\r\nimport _ from 'lodash';\r\nimport SignIn from './SignIn';\r\nimport BottomNavLinks from './BottomNavLinks';\r\nimport { contextSrv } from 'app/core/services/context_srv';\r\nimport config from '../../config';\r\nimport { NavModelItem } from '@grafana/data';\r\n\r\nexport default function BottomSection() {\r\n  const navTree: NavModelItem[] = _.cloneDeep(config.bootData.navTree);\r\n  const bottomNav: NavModelItem[] = _.filter(navTree, item => item.hideFromMenu);\r\n  const isSignedIn = contextSrv.isSignedIn;\r\n  const user = contextSrv.user;\r\n\r\n  if (user && user.orgCount > 1) {\r\n    const profileNode: any = _.find(bottomNav, { id: 'profile' });\r\n    if (profileNode) {\r\n      profileNode.showOrgSwitcher = true;\r\n    }\r\n  }\r\n\r\n  return (\r\n    <div className=\"sidemenu__bottom\">\r\n      {!isSignedIn && <SignIn />}\r\n      {bottomNav.map((link, index) => {\r\n        return <BottomNavLinks link={link} user={user} key={`${link.url}-${index}`} />;\r\n      })}\r\n    </div>\r\n  );\r\n}\r\n","import React, { FC } from 'react';\r\n\r\nexport interface Props {\r\n  child: any;\r\n}\r\n\r\nconst DropDownChild: FC<Props> = props => {\r\n  const { child } = props;\r\n  const listItemClassName = child.divider ? 'divider' : '';\r\n\r\n  return (\r\n    <li className={listItemClassName}>\r\n      <a href={child.url}>\r\n        {child.icon && <i className={child.icon} />}\r\n        {child.text}\r\n      </a>\r\n    </li>\r\n  );\r\n};\r\n\r\nexport default DropDownChild;\r\n","import React, { PureComponent } from 'react';\r\nimport appEvents from '../../app_events';\r\nimport TopSection from './TopSection';\r\nimport BottomSection from './BottomSection';\r\nimport config from 'app/core/config';\r\nimport { CoreEvents } from 'app/types';\r\nimport { Branding } from 'app/core/components/Branding/Branding';\r\n\r\nconst homeUrl = config.appSubUrl || '/';\r\n\r\nexport class SideMenu extends PureComponent {\r\n  toggleSideMenuSmallBreakpoint = () => {\r\n    appEvents.emit(CoreEvents.toggleSidemenuMobile);\r\n  };\r\n\r\n  render() {\r\n    return [\r\n      <a href={homeUrl} className=\"sidemenu__logo\" key=\"logo\">\r\n        <Branding.MenuLogo />\r\n      </a>,\r\n      <div className=\"sidemenu__logo_small_breakpoint\" onClick={this.toggleSideMenuSmallBreakpoint} key=\"hamburger\">\r\n        <i className=\"fa fa-bars\" />\r\n        <span className=\"sidemenu__close\">\r\n          <i className=\"fa fa-times\" />\r\n          &nbsp;Close\r\n        </span>\r\n      </div>,\r\n      <TopSection key=\"topsection\" />,\r\n      <BottomSection key=\"bottomsection\" />,\r\n    ];\r\n  }\r\n}\r\n","import React, { FC } from 'react';\r\nimport DropDownChild from './DropDownChild';\r\nimport { NavModelItem } from '@grafana/data';\r\n\r\ninterface Props {\r\n  link: NavModelItem;\r\n}\r\n\r\nconst SideMenuDropDown: FC<Props> = props => {\r\n  const { link } = props;\r\n  return (\r\n    <ul className=\"dropdown-menu dropdown-menu--sidemenu\" role=\"menu\">\r\n      <li className=\"side-menu-header\">\r\n        <a className=\"side-menu-header-link\" href={link.url}>\r\n          <span className=\"sidemenu-item-text\">{link.text}</span>\r\n        </a>\r\n      </li>\r\n      {link.children &&\r\n        link.children.map((child, index) => {\r\n          return <DropDownChild child={child} key={`${child.url}-${index}`} />;\r\n        })}\r\n    </ul>\r\n  );\r\n};\r\n\r\nexport default SideMenuDropDown;\r\n","import React, { FC } from 'react';\r\nimport { connectWithStore } from 'app/core/utils/connectWithReduxStore';\r\nimport { StoreState } from 'app/types';\r\n\r\nexport const SignIn: FC<any> = ({ url }) => {\r\n  const loginUrl = `login?redirect=${encodeURIComponent(url)}`;\r\n  return (\r\n    <div className=\"sidemenu-item\">\r\n      <a href={loginUrl} className=\"sidemenu-link\" target=\"_self\">\r\n        <span className=\"icon-circle sidemenu-icon\">\r\n          <i className=\"fa fa-fw fa-sign-in\" />\r\n        </span>\r\n      </a>\r\n      <a href={loginUrl} target=\"_self\">\r\n        <ul className=\"dropdown-menu dropdown-menu--sidemenu\" role=\"menu\">\r\n          <li className=\"side-menu-header\">\r\n            <span className=\"sidemenu-item-text\">Sign In</span>\r\n          </li>\r\n        </ul>\r\n      </a>\r\n    </div>\r\n  );\r\n};\r\n\r\nconst mapStateToProps = (state: StoreState) => ({\r\n  url: state.location.url,\r\n});\r\n\r\nexport default connectWithStore(SignIn, mapStateToProps);\r\n","import React, { FC } from 'react';\r\nimport _ from 'lodash';\r\nimport TopSectionItem from './TopSectionItem';\r\nimport config from '../../config';\r\n\r\nconst TopSection: FC<any> = () => {\r\n  const navTree = _.cloneDeep(config.bootData.navTree);\r\n  const mainLinks = _.filter(navTree, item => !item.hideFromMenu);\r\n\r\n  return (\r\n    <div className=\"sidemenu__top\">\r\n      {mainLinks.map((link, index) => {\r\n        return <TopSectionItem link={link} key={`${link.id}-${index}`} />;\r\n      })}\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default TopSection;\r\n","import React, { FC } from 'react';\r\nimport SideMenuDropDown from './SideMenuDropDown';\r\n\r\nexport interface Props {\r\n  link: any;\r\n}\r\n\r\nconst TopSectionItem: FC<Props> = props => {\r\n  const { link } = props;\r\n  return (\r\n    <div className=\"sidemenu-item dropdown\">\r\n      <a className=\"sidemenu-link\" href={link.url} target={link.target}>\r\n        <span className=\"icon-circle sidemenu-icon\">\r\n          <i className={link.icon} />\r\n          {link.img && <img src={link.img} />}\r\n        </span>\r\n      </a>\r\n      <SideMenuDropDown link={link} />\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default TopSectionItem;\r\n","import _ from 'lodash';\r\nimport $ from 'jquery';\r\nimport coreModule from 'app/core/core_module';\r\n\r\nconst template = `\r\n<div class=\"dropdown cascade-open\">\r\n<a ng-click=\"showActionsMenu()\" class=\"query-part-name pointer dropdown-toggle\" data-toggle=\"dropdown\">{{part.label}}</a>\r\n<span>{{part.def.wrapOpen}}</span><span class=\"query-part-parameters\"></span><span>{{part.def.wrapClose}}</span>\r\n<ul class=\"dropdown-menu\">\r\n  <li ng-repeat=\"action in partActions\">\r\n    <a ng-click=\"triggerPartAction(action)\">{{action.text}}</a>\r\n  </li>\r\n</ul>\r\n`;\r\n\r\n/** @ngInject */\r\nexport function sqlPartEditorDirective(templateSrv: any) {\r\n  const paramTemplate = '<input type=\"text\" class=\"hide input-mini\"></input>';\r\n\r\n  return {\r\n    restrict: 'E',\r\n    template: template,\r\n    scope: {\r\n      part: '=',\r\n      handleEvent: '&',\r\n      debounce: '@',\r\n    },\r\n    link: function postLink($scope: any, elem: any) {\r\n      const part = $scope.part;\r\n      const partDef = part.def;\r\n      const $paramsContainer = elem.find('.query-part-parameters');\r\n      const debounceLookup = $scope.debounce;\r\n      let cancelBlur: any = null;\r\n\r\n      $scope.partActions = [];\r\n\r\n      function clickFuncParam(this: any, paramIndex: number) {\r\n        /*jshint validthis:true */\r\n        const $link = $(this);\r\n        const $input = $link.next();\r\n\r\n        $input.val(part.params[paramIndex]);\r\n        $input.css('width', $link.width() + 16 + 'px');\r\n\r\n        $link.hide();\r\n        $input.show();\r\n        $input.focus();\r\n        $input.select();\r\n\r\n        const typeahead = $input.data('typeahead');\r\n        if (typeahead) {\r\n          $input.val('');\r\n          typeahead.lookup();\r\n        }\r\n      }\r\n\r\n      function inputBlur($input: JQuery, paramIndex: number) {\r\n        cancelBlur = setTimeout(() => {\r\n          switchToLink($input, paramIndex);\r\n        }, 200);\r\n      }\r\n\r\n      function switchToLink($input: JQuery, paramIndex: number) {\r\n        /*jshint validthis:true */\r\n        const $link = $input.prev();\r\n        const newValue = $input.val();\r\n\r\n        if (newValue !== '' || part.def.params[paramIndex].optional) {\r\n          $link.html(templateSrv.highlightVariablesAsHtml(newValue));\r\n\r\n          part.updateParam($input.val(), paramIndex);\r\n          $scope.$apply(() => {\r\n            $scope.handleEvent({ $event: { name: 'part-param-changed' } });\r\n          });\r\n        }\r\n\r\n        $input.hide();\r\n        $link.show();\r\n      }\r\n\r\n      function inputKeyPress(this: any, paramIndex: number, e: any) {\r\n        /*jshint validthis:true */\r\n        if (e.which === 13) {\r\n          switchToLink($(this), paramIndex);\r\n        }\r\n      }\r\n\r\n      function inputKeyDown(this: any) {\r\n        /*jshint validthis:true */\r\n        this.style.width = (3 + this.value.length) * 8 + 'px';\r\n      }\r\n\r\n      function addTypeahead($input: JQuery, param: any, paramIndex: number) {\r\n        if (!param.options && !param.dynamicLookup) {\r\n          return;\r\n        }\r\n\r\n        const typeaheadSource = (query: string, callback: any) => {\r\n          if (param.options) {\r\n            let options = param.options;\r\n            if (param.type === 'int') {\r\n              options = _.map(options, val => {\r\n                return val.toString();\r\n              });\r\n            }\r\n            return options;\r\n          }\r\n\r\n          $scope.$apply(() => {\r\n            $scope.handleEvent({ $event: { name: 'get-param-options', param: param } }).then((result: any) => {\r\n              const dynamicOptions = _.map(result, op => {\r\n                return _.escape(op.value);\r\n              });\r\n\r\n              // add current value to dropdown if it's not in dynamicOptions\r\n              if (_.indexOf(dynamicOptions, part.params[paramIndex]) === -1) {\r\n                dynamicOptions.unshift(_.escape(part.params[paramIndex]));\r\n              }\r\n\r\n              callback(dynamicOptions);\r\n            });\r\n          });\r\n        };\r\n\r\n        $input.attr('data-provide', 'typeahead');\r\n\r\n        $input.typeahead({\r\n          source: typeaheadSource,\r\n          minLength: 0,\r\n          items: 1000,\r\n          updater: (value: string) => {\r\n            value = _.unescape(value);\r\n            if (value === part.params[paramIndex]) {\r\n              clearTimeout(cancelBlur);\r\n              $input.focus();\r\n              return value;\r\n            }\r\n            return value;\r\n          },\r\n        });\r\n\r\n        const typeahead = $input.data('typeahead');\r\n        typeahead.lookup = function() {\r\n          this.query = this.$element.val() || '';\r\n          const items = this.source(this.query, $.proxy(this.process, this));\r\n          return items ? this.process(items) : items;\r\n        };\r\n\r\n        if (debounceLookup) {\r\n          typeahead.lookup = _.debounce(typeahead.lookup, 500, { leading: true });\r\n        }\r\n      }\r\n\r\n      $scope.showActionsMenu = () => {\r\n        $scope.handleEvent({ $event: { name: 'get-part-actions' } }).then((res: any) => {\r\n          $scope.partActions = res;\r\n        });\r\n      };\r\n\r\n      $scope.triggerPartAction = (action: string) => {\r\n        $scope.handleEvent({ $event: { name: 'action', action: action } });\r\n      };\r\n\r\n      function addElementsAndCompile() {\r\n        _.each(partDef.params, (param: any, index: number) => {\r\n          if (param.optional && part.params.length <= index) {\r\n            return;\r\n          }\r\n\r\n          if (index > 0) {\r\n            $('<span>' + partDef.separator + '</span>').appendTo($paramsContainer);\r\n          }\r\n\r\n          const paramValue = templateSrv.highlightVariablesAsHtml(part.params[index]);\r\n          const $paramLink = $('<a class=\"graphite-func-param-link pointer\">' + paramValue + '</a>');\r\n          const $input = $(paramTemplate);\r\n\r\n          $paramLink.appendTo($paramsContainer);\r\n          $input.appendTo($paramsContainer);\r\n\r\n          $input.blur(_.partial(inputBlur, $input, index));\r\n          $input.keyup(inputKeyDown);\r\n          $input.keypress(_.partial(inputKeyPress, index));\r\n          $paramLink.click(_.partial(clickFuncParam, index));\r\n\r\n          addTypeahead($input, param, index);\r\n        });\r\n      }\r\n\r\n      function relink() {\r\n        $paramsContainer.empty();\r\n        addElementsAndCompile();\r\n      }\r\n\r\n      relink();\r\n    },\r\n  };\r\n}\r\n\r\ncoreModule.directive('sqlPartEditor', sqlPartEditorDirective);\r\n","import coreModule from 'app/core/core_module';\r\n\r\nconst template = `\r\n<label for=\"check-{{ctrl.id}}\" class=\"gf-form-switch-container\">\r\n  <div class=\"gf-form-label {{ctrl.labelClass}}\" ng-show=\"ctrl.label\">\r\n    {{ctrl.label}}\r\n    <info-popover mode=\"right-normal\" ng-if=\"ctrl.tooltip\" position=\"top center\">\r\n      {{ctrl.tooltip}}\r\n    </info-popover>\r\n  </div>\r\n  <div class=\"gf-form-switch {{ctrl.switchClass}}\" ng-if=\"ctrl.show\">\r\n    <input id=\"check-{{ctrl.id}}\" type=\"checkbox\" ng-model=\"ctrl.checked\" ng-change=\"ctrl.internalOnChange()\">\r\n    <span class=\"gf-form-switch__slider\"></span>\r\n  </div>\r\n</label>\r\n`;\r\n\r\nconst checkboxTemplate = `\r\n<label for=\"check-{{ctrl.id}}\" class=\"gf-form-switch-container\">\r\n   <div class=\"gf-form-label {{ctrl.labelClass}}\" ng-show=\"ctrl.label\">\r\n    {{ctrl.label}}\r\n    <info-popover mode=\"right-normal\" ng-if=\"ctrl.tooltip\" position=\"top center\">\r\n      {{ctrl.tooltip}}\r\n    </info-popover>\r\n  </div>\r\n  <div class=\"gf-form-checkbox {{ctrl.switchClass}}\" ng-if=\"ctrl.show\">\r\n    <input id=\"check-{{ctrl.id}}\" type=\"checkbox\" ng-model=\"ctrl.checked\" ng-change=\"ctrl.internalOnChange()\">\r\n    <span class=\"gf-form-switch__checkbox\"></span>\r\n  </div>\r\n</label>\r\n`;\r\n\r\nexport class SwitchCtrl {\r\n  onChange: any;\r\n  checked: any;\r\n  show: any;\r\n  id: any;\r\n  label: string;\r\n\r\n  /** @ngInject */\r\n  constructor($scope: any, private $timeout: any) {\r\n    this.show = true;\r\n    this.id = $scope.$id;\r\n  }\r\n\r\n  internalOnChange() {\r\n    return this.$timeout(() => {\r\n      return this.onChange();\r\n    });\r\n  }\r\n}\r\n\r\nexport function switchDirective() {\r\n  return {\r\n    restrict: 'E',\r\n    controller: SwitchCtrl,\r\n    controllerAs: 'ctrl',\r\n    bindToController: true,\r\n    scope: {\r\n      checked: '=',\r\n      label: '@',\r\n      labelClass: '@',\r\n      tooltip: '@',\r\n      switchClass: '@',\r\n      onChange: '&',\r\n    },\r\n    template: template,\r\n  };\r\n}\r\n\r\nexport function checkboxDirective() {\r\n  return {\r\n    restrict: 'E',\r\n    controller: SwitchCtrl,\r\n    controllerAs: 'ctrl',\r\n    bindToController: true,\r\n    scope: {\r\n      checked: '=',\r\n      label: '@',\r\n      labelClass: '@',\r\n      tooltip: '@',\r\n      switchClass: '@',\r\n      onChange: '&',\r\n    },\r\n    template: checkboxTemplate,\r\n  };\r\n}\r\n\r\ncoreModule.directive('gfFormSwitch', switchDirective);\r\ncoreModule.directive('gfFormCheckbox', checkboxDirective);\r\n","import { config, GrafanaBootConfig } from '@grafana/runtime';\r\n// Legacy binding paths\r\nexport { config, GrafanaBootConfig as Settings };\r\n\r\nlet grafanaConfig: GrafanaBootConfig = config;\r\n\r\nexport default grafanaConfig;\r\n\r\nexport const getConfig = () => {\r\n  return grafanaConfig;\r\n};\r\n\r\nexport const updateConfig = (update: Partial<GrafanaBootConfig>) => {\r\n  grafanaConfig = {\r\n    ...grafanaConfig,\r\n    ...update,\r\n  };\r\n};\r\n","export const GRID_CELL_HEIGHT = 30;\r\nexport const GRID_CELL_VMARGIN = 8;\r\nexport const GRID_COLUMN_COUNT = 24;\r\nexport const REPEAT_DIR_VERTICAL = 'v';\r\n\r\nexport const DEFAULT_PANEL_SPAN = 4;\r\nexport const DEFAULT_ROW_HEIGHT = 250;\r\nexport const MIN_PANEL_HEIGHT = GRID_CELL_HEIGHT * 3;\r\n\r\nexport const LS_PANEL_COPY_KEY = 'panel-copy';\r\n\r\nexport const PANEL_BORDER = 2;\r\n","import './json_editor_ctrl';\r\nimport './invited_ctrl';\r\nimport './signup_ctrl';\r\nimport './reset_password_ctrl';\r\nimport './error_ctrl';\r\n","import config from 'app/core/config';\r\nimport coreModule from '../core_module';\r\nimport appEvents from 'app/core/app_events';\r\nimport { CoreEvents } from 'app/types';\r\n\r\nexport class ErrorCtrl {\r\n  /** @ngInject */\r\n  constructor($scope: any, contextSrv: any, navModelSrv: any) {\r\n    $scope.navModel = navModelSrv.getNotFoundNav();\r\n    $scope.appSubUrl = config.appSubUrl;\r\n\r\n    if (!contextSrv.isSignedIn) {\r\n      appEvents.emit(CoreEvents.toggleSidemenuHidden);\r\n    }\r\n\r\n    $scope.$on('destroy', () => {\r\n      if (!contextSrv.isSignedIn) {\r\n        appEvents.emit(CoreEvents.toggleSidemenuHidden);\r\n      }\r\n    });\r\n  }\r\n}\r\n\r\ncoreModule.controller('ErrorCtrl', ErrorCtrl);\r\n","import coreModule from '../core_module';\r\nimport config from 'app/core/config';\r\n\r\nexport class InvitedCtrl {\r\n  /** @ngInject */\r\n  constructor($scope: any, $routeParams: any, contextSrv: any, backendSrv: any) {\r\n    contextSrv.sidemenu = false;\r\n    $scope.formModel = {};\r\n\r\n    $scope.navModel = {\r\n      main: {\r\n        icon: 'gicon gicon-branding',\r\n        text: 'Invite',\r\n        subTitle: 'Register your Grafana account',\r\n        breadcrumbs: [{ title: 'Login', url: 'login' }],\r\n      },\r\n    };\r\n\r\n    $scope.init = () => {\r\n      backendSrv.get('/api/user/invite/' + $routeParams.code).then((invite: any) => {\r\n        $scope.formModel.name = invite.name;\r\n        $scope.formModel.email = invite.email;\r\n        $scope.formModel.username = invite.email;\r\n        $scope.formModel.inviteCode = $routeParams.code;\r\n\r\n        $scope.greeting = invite.name || invite.email || invite.username;\r\n        $scope.invitedBy = invite.invitedBy;\r\n      });\r\n    };\r\n\r\n    $scope.submit = () => {\r\n      if (!$scope.inviteForm.$valid) {\r\n        return;\r\n      }\r\n\r\n      backendSrv.post('/api/user/invite/complete', $scope.formModel).then(() => {\r\n        window.location.href = config.appSubUrl + '/';\r\n      });\r\n    };\r\n\r\n    $scope.init();\r\n  }\r\n}\r\n\r\ncoreModule.controller('InvitedCtrl', InvitedCtrl);\r\n","import angular from 'angular';\r\nimport coreModule from '../core_module';\r\n\r\nexport class JsonEditorCtrl {\r\n  /** @ngInject */\r\n  constructor($scope: any) {\r\n    $scope.json = angular.toJson($scope.model.object, true);\r\n    $scope.canUpdate = $scope.model.updateHandler !== void 0 && $scope.model.canUpdate;\r\n    $scope.canCopy = $scope.model.enableCopy;\r\n\r\n    $scope.update = () => {\r\n      const newObject = angular.fromJson($scope.json);\r\n      $scope.model.updateHandler(newObject, $scope.model.object);\r\n    };\r\n\r\n    $scope.getContentForClipboard = () => $scope.json;\r\n  }\r\n}\r\n\r\ncoreModule.controller('JsonEditorCtrl', JsonEditorCtrl);\r\n","import coreModule from '../core_module';\r\nimport config from 'app/core/config';\r\nimport { BackendSrv } from '../services/backend_srv';\r\nimport { AppEvents } from '@grafana/data';\r\n\r\nexport class ResetPasswordCtrl {\r\n  /** @ngInject */\r\n  constructor($scope: any, backendSrv: BackendSrv, $location: any) {\r\n    $scope.formModel = {};\r\n    $scope.mode = 'send';\r\n    $scope.ldapEnabled = config.ldapEnabled;\r\n    $scope.authProxyEnabled = config.authProxyEnabled;\r\n    $scope.disableLoginForm = config.disableLoginForm;\r\n\r\n    const params = $location.search();\r\n    if (params.code) {\r\n      $scope.mode = 'reset';\r\n      $scope.formModel.code = params.code;\r\n    }\r\n\r\n    $scope.navModel = {\r\n      main: {\r\n        icon: 'gicon gicon-branding',\r\n        text: 'Reset Password',\r\n        subTitle: 'Reset your Grafana password',\r\n        breadcrumbs: [{ title: 'Login', url: 'login' }],\r\n      },\r\n    };\r\n\r\n    $scope.sendResetEmail = () => {\r\n      if (!$scope.sendResetForm.$valid) {\r\n        return;\r\n      }\r\n      backendSrv.post('/api/user/password/send-reset-email', $scope.formModel).then(() => {\r\n        $scope.mode = 'email-sent';\r\n      });\r\n    };\r\n\r\n    $scope.submitReset = () => {\r\n      if (!$scope.resetForm.$valid) {\r\n        return;\r\n      }\r\n\r\n      if ($scope.formModel.newPassword !== $scope.formModel.confirmPassword) {\r\n        $scope.appEvent(AppEvents.alertWarning, ['New passwords do not match']);\r\n        return;\r\n      }\r\n\r\n      backendSrv.post('/api/user/password/reset', $scope.formModel).then(() => {\r\n        $location.path('login');\r\n      });\r\n    };\r\n  }\r\n}\r\n\r\ncoreModule.controller('ResetPasswordCtrl', ResetPasswordCtrl);\r\n","import config from 'app/core/config';\r\nimport coreModule from '../core_module';\r\n\r\nexport class SignUpCtrl {\r\n  /** @ngInject */\r\n  constructor(private $scope: any, private backendSrv: any, $location: any, contextSrv: any) {\r\n    contextSrv.sidemenu = false;\r\n    $scope.ctrl = this;\r\n\r\n    $scope.formModel = {};\r\n\r\n    const params = $location.search();\r\n\r\n    // validate email is semi ok\r\n    if (params.email && !params.email.match(/^\\S+@\\S+$/)) {\r\n      console.log('invalid email');\r\n      return;\r\n    }\r\n\r\n    $scope.formModel.orgName = params.email;\r\n    $scope.formModel.email = params.email;\r\n    $scope.formModel.username = params.email;\r\n    $scope.formModel.code = params.code;\r\n\r\n    $scope.verifyEmailEnabled = false;\r\n    $scope.autoAssignOrg = false;\r\n\r\n    $scope.navModel = {\r\n      main: {\r\n        icon: 'gicon gicon-branding',\r\n        text: 'Sign Up',\r\n        subTitle: 'Register your Grafana account',\r\n        breadcrumbs: [{ title: 'Login', url: 'login' }],\r\n      },\r\n    };\r\n\r\n    backendSrv.get('/api/user/signup/options').then((options: any) => {\r\n      $scope.verifyEmailEnabled = options.verifyEmailEnabled;\r\n      $scope.autoAssignOrg = options.autoAssignOrg;\r\n    });\r\n  }\r\n\r\n  submit() {\r\n    if (!this.$scope.signUpForm.$valid) {\r\n      return;\r\n    }\r\n\r\n    this.backendSrv.post('/api/user/signup/step2', this.$scope.formModel).then((rsp: any) => {\r\n      if (rsp.code === 'redirect-to-select-org') {\r\n        window.location.href = config.appSubUrl + '/profile/select-org?signup=1';\r\n      } else {\r\n        window.location.href = config.appSubUrl + '/';\r\n      }\r\n    });\r\n  }\r\n}\r\n\r\ncoreModule.controller('SignUpCtrl', SignUpCtrl);\r\n","import { AppNotification, AppNotificationSeverity, AppNotificationTimeout } from 'app/types';\r\nimport { getMessageFromError } from 'app/core/utils/errors';\r\n\r\nconst defaultSuccessNotification = {\r\n  title: '',\r\n  text: '',\r\n  severity: AppNotificationSeverity.Success,\r\n  icon: 'fa fa-check',\r\n  timeout: AppNotificationTimeout.Success,\r\n};\r\n\r\nconst defaultWarningNotification = {\r\n  title: '',\r\n  text: '',\r\n  severity: AppNotificationSeverity.Warning,\r\n  icon: 'fa fa-exclamation',\r\n  timeout: AppNotificationTimeout.Warning,\r\n};\r\n\r\nconst defaultErrorNotification = {\r\n  title: '',\r\n  text: '',\r\n  severity: AppNotificationSeverity.Error,\r\n  icon: 'fa fa-exclamation-triangle',\r\n  timeout: AppNotificationTimeout.Error,\r\n};\r\n\r\nexport const createSuccessNotification = (title: string, text = ''): AppNotification => ({\r\n  ...defaultSuccessNotification,\r\n  title: title,\r\n  text: text,\r\n  id: Date.now(),\r\n});\r\n\r\nexport const createErrorNotification = (title: string, text = '', component?: React.ReactElement): AppNotification => {\r\n  return {\r\n    ...defaultErrorNotification,\r\n    text: getMessageFromError(text),\r\n    title,\r\n    id: Date.now(),\r\n    component,\r\n  };\r\n};\r\n\r\nexport const createWarningNotification = (title: string, text = ''): AppNotification => ({\r\n  ...defaultWarningNotification,\r\n  title: title,\r\n  text: text,\r\n  id: Date.now(),\r\n});\r\n","import './directives/dropdown_typeahead';\r\nimport './directives/autofill_event_fix';\r\nimport './directives/metric_segment';\r\nimport './directives/misc';\r\nimport './directives/ng_model_on_blur';\r\nimport './directives/tags';\r\nimport './directives/value_select_dropdown';\r\nimport './directives/rebuild_on_change';\r\nimport './directives/give_focus';\r\nimport './directives/diff-view';\r\nimport './jquery_extended';\r\nimport './partials';\r\nimport './components/jsontree/jsontree';\r\nimport './components/code_editor/code_editor';\r\nimport './utils/outline';\r\nimport './components/colorpicker/spectrum_picker';\r\nimport './services/search_srv';\r\nimport './services/ng_react';\r\nimport { colors, JsonExplorer } from '@grafana/ui/';\r\n\r\nimport { searchDirective } from './components/search/search';\r\nimport { infoPopover } from './components/info_popover';\r\nimport { arrayJoin } from './directives/array_join';\r\nimport { liveSrv } from './live/live_srv';\r\nimport { Emitter } from './utils/emitter';\r\nimport { layoutSelector } from './components/layout_selector/layout_selector';\r\nimport { switchDirective } from './components/switch';\r\nimport { dashboardSelector } from './components/dashboard_selector';\r\nimport { queryPartEditorDirective } from './components/query_part/query_part_editor';\r\nimport { sqlPartEditorDirective } from './components/sql_part/sql_part_editor';\r\nimport { formDropdownDirective } from './components/form_dropdown/form_dropdown';\r\nimport 'app/core/controllers/all';\r\nimport 'app/core/services/all';\r\nimport './filters/filters';\r\nimport coreModule from './core_module';\r\nimport appEvents from './app_events';\r\nimport { assignModelProperties } from './utils/model_utils';\r\nimport { contextSrv } from './services/context_srv';\r\nimport { KeybindingSrv } from './services/keybindingSrv';\r\nimport { NavModelSrv } from './nav_model_srv';\r\nimport { geminiScrollbar } from './components/scroll/scroll';\r\nimport { profiler } from './profiler';\r\nimport { registerAngularDirectives } from './angular_wrappers';\r\nimport { updateLegendValues } from './time_series2';\r\nimport TimeSeries from './time_series2';\r\nimport { searchResultsDirective } from './components/search/search_results';\r\nimport { manageDashboardsDirective } from './components/manage_dashboards/manage_dashboards';\r\nimport { NavModel } from '@grafana/data';\r\n\r\nexport {\r\n  profiler,\r\n  registerAngularDirectives,\r\n  arrayJoin,\r\n  coreModule,\r\n  searchDirective,\r\n  liveSrv,\r\n  layoutSelector,\r\n  switchDirective,\r\n  infoPopover,\r\n  Emitter,\r\n  appEvents,\r\n  dashboardSelector,\r\n  queryPartEditorDirective,\r\n  sqlPartEditorDirective,\r\n  colors,\r\n  formDropdownDirective,\r\n  assignModelProperties,\r\n  contextSrv,\r\n  KeybindingSrv,\r\n  JsonExplorer,\r\n  NavModelSrv,\r\n  NavModel,\r\n  geminiScrollbar,\r\n  manageDashboardsDirective,\r\n  TimeSeries,\r\n  updateLegendValues,\r\n  searchResultsDirective,\r\n};\r\n","import angular from 'angular';\n\nconst coreModule = angular.module('grafana.core', ['ngRoute']);\n\n// legacy modules\nconst angularModules = [\n  coreModule,\n  angular.module('grafana.controllers', []),\n  angular.module('grafana.directives', []),\n  angular.module('grafana.factories', []),\n  angular.module('grafana.services', []),\n  angular.module('grafana.filters', []),\n  angular.module('grafana.routes', []),\n];\n\nexport { angularModules, coreModule };\n\nexport default coreModule;\n","import _ from 'lodash';\r\nimport coreModule from '../core_module';\r\n\r\nexport function arrayJoin() {\r\n  'use strict';\r\n\r\n  return {\r\n    restrict: 'A',\r\n    require: 'ngModel',\r\n    link: (scope: any, element: any, attr: any, ngModel: any) => {\r\n      function split_array(text: string) {\r\n        return (text || '').split(',');\r\n      }\r\n\r\n      function join_array(text: string) {\r\n        if (_.isArray(text)) {\r\n          return ((text || '') as any).join(',');\r\n        } else {\r\n          return text;\r\n        }\r\n      }\r\n\r\n      ngModel.$parsers.push(split_array);\r\n      ngModel.$formatters.push(join_array);\r\n    },\r\n  };\r\n}\r\n\r\ncoreModule.directive('arrayJoin', arrayJoin);\r\n","import coreModule from '../core_module';\r\n\r\n/** @ngInject */\r\nexport function autofillEventFix($compile: any) {\r\n  return {\r\n    link: ($scope: any, elem: any) => {\r\n      const input = elem[0];\r\n      const dispatchChangeEvent = () => {\r\n        const event = new Event('change');\r\n        return input.dispatchEvent(event);\r\n      };\r\n      const onAnimationStart = ({ animationName }: AnimationEvent) => {\r\n        switch (animationName) {\r\n          case 'onAutoFillStart':\r\n            return dispatchChangeEvent();\r\n          case 'onAutoFillCancel':\r\n            return dispatchChangeEvent();\r\n        }\r\n        return null;\r\n      };\r\n\r\n      // const onChange = (evt: Event) => console.log(evt);\r\n\r\n      input.addEventListener('animationstart', onAnimationStart);\r\n      // input.addEventListener('change', onChange);\r\n\r\n      $scope.$on('$destroy', () => {\r\n        input.removeEventListener('animationstart', onAnimationStart);\r\n        // input.removeEventListener('change', onChange);\r\n      });\r\n    },\r\n  };\r\n}\r\n\r\ncoreModule.directive('autofillEventFix', autofillEventFix);\r\n","import angular from 'angular';\r\nimport coreModule from '../core_module';\r\nimport { GrafanaRootScope } from 'app/routes/GrafanaCtrl';\r\nimport { CoreEvents } from 'app/types';\r\n\r\nexport class DeltaCtrl {\r\n  observer: any;\r\n\r\n  /** @ngInject */\r\n  constructor(private $rootScope: GrafanaRootScope) {\r\n    const waitForCompile = (mutations: any) => {\r\n      if (mutations.length === 1) {\r\n        this.$rootScope.appEvent(CoreEvents.jsonDiffReady);\r\n      }\r\n    };\r\n\r\n    this.observer = new MutationObserver(waitForCompile);\r\n\r\n    const observerConfig = {\r\n      attributes: true,\r\n      attributeFilter: ['class'],\r\n      characterData: false,\r\n      childList: true,\r\n      subtree: false,\r\n    };\r\n\r\n    this.observer.observe(angular.element('.delta-html')[0], observerConfig);\r\n  }\r\n\r\n  $onDestroy() {\r\n    this.observer.disconnect();\r\n  }\r\n}\r\n\r\nexport function delta() {\r\n  return {\r\n    controller: DeltaCtrl,\r\n    replace: false,\r\n    restrict: 'A',\r\n  };\r\n}\r\ncoreModule.directive('diffDelta', delta);\r\n\r\n// Link to JSON line number\r\nexport class LinkJSONCtrl {\r\n  /** @ngInject */\r\n  constructor(private $scope: any, private $rootScope: GrafanaRootScope, private $anchorScroll: any) {}\r\n\r\n  goToLine(line: number) {\r\n    let unbind: () => void;\r\n\r\n    const scroll = () => {\r\n      this.$anchorScroll(`l${line}`);\r\n      unbind();\r\n    };\r\n\r\n    this.$scope.switchView().then(() => {\r\n      unbind = this.$rootScope.$on('json-diff-ready', scroll.bind(this));\r\n    });\r\n  }\r\n}\r\n\r\nexport function linkJson() {\r\n  return {\r\n    controller: LinkJSONCtrl,\r\n    controllerAs: 'ctrl',\r\n    replace: true,\r\n    restrict: 'E',\r\n    scope: {\r\n      line: '@lineDisplay',\r\n      link: '@lineLink',\r\n      switchView: '&',\r\n    },\r\n    template: `<a class=\"diff-linenum btn btn-inverse btn-small\" ng-click=\"ctrl.goToLine(link)\">Line {{ line }}</a>`,\r\n  };\r\n}\r\ncoreModule.directive('diffLinkJson', linkJson);\r\n","import _ from 'lodash';\r\nimport $ from 'jquery';\r\nimport coreModule from '../core_module';\r\n\r\n/** @ngInject */\r\nexport function dropdownTypeahead($compile: any) {\r\n  const inputTemplate =\r\n    '<input type=\"text\"' +\r\n    ' class=\"gf-form-input input-medium tight-form-input\"' +\r\n    ' spellcheck=\"false\" style=\"display:none\"></input>';\r\n\r\n  const buttonTemplate =\r\n    '<a class=\"gf-form-label tight-form-func dropdown-toggle\"' +\r\n    ' tabindex=\"1\" gf-dropdown=\"menuItems\" data-toggle=\"dropdown\"' +\r\n    ' ><i class=\"fa fa-plus\"></i></a>';\r\n\r\n  return {\r\n    scope: {\r\n      menuItems: '=dropdownTypeahead',\r\n      dropdownTypeaheadOnSelect: '&dropdownTypeaheadOnSelect',\r\n      model: '=ngModel',\r\n    },\r\n    link: ($scope: any, elem: any, attrs: any) => {\r\n      const $input = $(inputTemplate);\r\n      const $button = $(buttonTemplate);\r\n      $input.appendTo(elem);\r\n      $button.appendTo(elem);\r\n\r\n      if (attrs.linkText) {\r\n        $button.html(attrs.linkText);\r\n      }\r\n\r\n      if (attrs.ngModel) {\r\n        $scope.$watch('model', (newValue: any) => {\r\n          _.each($scope.menuItems, item => {\r\n            _.each(item.submenu, subItem => {\r\n              if (subItem.value === newValue) {\r\n                $button.html(subItem.text);\r\n              }\r\n            });\r\n          });\r\n        });\r\n      }\r\n\r\n      const typeaheadValues = _.reduce(\r\n        $scope.menuItems,\r\n        (memo, value, index) => {\r\n          if (!value.submenu) {\r\n            value.click = 'menuItemSelected(' + index + ')';\r\n            memo.push(value.text);\r\n          } else {\r\n            _.each(value.submenu, (item, subIndex) => {\r\n              item.click = 'menuItemSelected(' + index + ',' + subIndex + ')';\r\n              memo.push(value.text + ' ' + item.text);\r\n            });\r\n          }\r\n          return memo;\r\n        },\r\n        []\r\n      );\r\n\r\n      const closeDropdownMenu = () => {\r\n        $input.hide();\r\n        $input.val('');\r\n        $button.show();\r\n        $button.focus();\r\n        elem.removeClass('open');\r\n      };\r\n\r\n      $scope.menuItemSelected = (index: number, subIndex: number) => {\r\n        const menuItem = $scope.menuItems[index];\r\n        const payload: any = { $item: menuItem };\r\n        if (menuItem.submenu && subIndex !== void 0) {\r\n          payload.$subItem = menuItem.submenu[subIndex];\r\n        }\r\n        $scope.dropdownTypeaheadOnSelect(payload);\r\n        closeDropdownMenu();\r\n      };\r\n\r\n      $input.attr('data-provide', 'typeahead');\r\n      $input.typeahead({\r\n        source: typeaheadValues,\r\n        minLength: 1,\r\n        items: 10,\r\n        updater: (value: string) => {\r\n          const result: any = {};\r\n          _.each($scope.menuItems, menuItem => {\r\n            _.each(menuItem.submenu, submenuItem => {\r\n              if (value === menuItem.text + ' ' + submenuItem.text) {\r\n                result.$subItem = submenuItem;\r\n                result.$item = menuItem;\r\n              }\r\n            });\r\n          });\r\n\r\n          if (result.$item) {\r\n            $scope.$apply(() => {\r\n              $scope.dropdownTypeaheadOnSelect(result);\r\n            });\r\n          }\r\n\r\n          $input.trigger('blur');\r\n          return '';\r\n        },\r\n      });\r\n\r\n      $button.click(() => {\r\n        $button.hide();\r\n        $input.show();\r\n        $input.focus();\r\n      });\r\n\r\n      $input.keyup(() => {\r\n        elem.toggleClass('open', $input.val() === '');\r\n      });\r\n\r\n      elem.mousedown((evt: Event) => {\r\n        evt.preventDefault();\r\n      });\r\n\r\n      $input.blur(() => {\r\n        $input.hide();\r\n        $input.val('');\r\n        $button.show();\r\n        $button.focus();\r\n        // clicking the function dropdown menu won't\r\n        // work if you remove class at once\r\n        setTimeout(() => {\r\n          elem.removeClass('open');\r\n        }, 200);\r\n      });\r\n\r\n      $compile(elem.contents())($scope);\r\n    },\r\n  };\r\n}\r\n\r\n/** @ngInject */\r\nexport function dropdownTypeahead2($compile: any) {\r\n  const inputTemplate =\r\n    '<input type=\"text\"' + ' class=\"gf-form-input\"' + ' spellcheck=\"false\" style=\"display:none\"></input>';\r\n\r\n  const buttonTemplate =\r\n    '<a class=\"{{buttonTemplateClass}} dropdown-toggle\"' +\r\n    ' tabindex=\"1\" gf-dropdown=\"menuItems\" data-toggle=\"dropdown\"' +\r\n    ' ><i class=\"fa fa-plus\"></i></a>';\r\n\r\n  return {\r\n    scope: {\r\n      menuItems: '=dropdownTypeahead2',\r\n      dropdownTypeaheadOnSelect: '&dropdownTypeaheadOnSelect',\r\n      model: '=ngModel',\r\n      buttonTemplateClass: '@',\r\n    },\r\n    link: ($scope: any, elem: any, attrs: any) => {\r\n      const $input = $(inputTemplate);\r\n\r\n      if (!$scope.buttonTemplateClass) {\r\n        $scope.buttonTemplateClass = 'gf-form-input';\r\n      }\r\n\r\n      const $button = $(buttonTemplate);\r\n      const timeoutId = {\r\n        blur: null as any,\r\n      };\r\n      $input.appendTo(elem);\r\n      $button.appendTo(elem);\r\n\r\n      if (attrs.linkText) {\r\n        $button.html(attrs.linkText);\r\n      }\r\n\r\n      if (attrs.ngModel) {\r\n        $scope.$watch('model', (newValue: any) => {\r\n          _.each($scope.menuItems, item => {\r\n            _.each(item.submenu, subItem => {\r\n              if (subItem.value === newValue) {\r\n                $button.html(subItem.text);\r\n              }\r\n            });\r\n          });\r\n        });\r\n      }\r\n\r\n      const typeaheadValues = _.reduce(\r\n        $scope.menuItems,\r\n        (memo, value, index) => {\r\n          if (!value.submenu) {\r\n            value.click = 'menuItemSelected(' + index + ')';\r\n            memo.push(value.text);\r\n          } else {\r\n            _.each(value.submenu, (item, subIndex) => {\r\n              item.click = 'menuItemSelected(' + index + ',' + subIndex + ')';\r\n              memo.push(value.text + ' ' + item.text);\r\n            });\r\n          }\r\n          return memo;\r\n        },\r\n        []\r\n      );\r\n\r\n      const closeDropdownMenu = () => {\r\n        $input.hide();\r\n        $input.val('');\r\n        $button.show();\r\n        $button.focus();\r\n        elem.removeClass('open');\r\n      };\r\n\r\n      $scope.menuItemSelected = (index: number, subIndex: number) => {\r\n        const menuItem = $scope.menuItems[index];\r\n        const payload: any = { $item: menuItem };\r\n        if (menuItem.submenu && subIndex !== void 0) {\r\n          payload.$subItem = menuItem.submenu[subIndex];\r\n        }\r\n        $scope.dropdownTypeaheadOnSelect(payload);\r\n        closeDropdownMenu();\r\n      };\r\n\r\n      $input.attr('data-provide', 'typeahead');\r\n      $input.typeahead({\r\n        source: typeaheadValues,\r\n        minLength: 1,\r\n        items: 10,\r\n        updater: (value: string) => {\r\n          const result: any = {};\r\n          _.each($scope.menuItems, menuItem => {\r\n            _.each(menuItem.submenu, submenuItem => {\r\n              if (value === menuItem.text + ' ' + submenuItem.text) {\r\n                result.$subItem = submenuItem;\r\n                result.$item = menuItem;\r\n              }\r\n            });\r\n          });\r\n\r\n          if (result.$item) {\r\n            $scope.$apply(() => {\r\n              $scope.dropdownTypeaheadOnSelect(result);\r\n            });\r\n          }\r\n\r\n          $input.trigger('blur');\r\n          return '';\r\n        },\r\n      });\r\n\r\n      $button.click(() => {\r\n        $button.hide();\r\n        $input.show();\r\n        $input.focus();\r\n      });\r\n\r\n      $input.keyup(() => {\r\n        elem.toggleClass('open', $input.val() === '');\r\n      });\r\n\r\n      elem.mousedown((evt: Event) => {\r\n        evt.preventDefault();\r\n        timeoutId.blur = null;\r\n      });\r\n\r\n      $input.blur(() => {\r\n        timeoutId.blur = setTimeout(() => {\r\n          closeDropdownMenu();\r\n        }, 1);\r\n      });\r\n\r\n      $compile(elem.contents())($scope);\r\n    },\r\n  };\r\n}\r\n\r\ncoreModule.directive('dropdownTypeahead', dropdownTypeahead);\r\ncoreModule.directive('dropdownTypeahead2', dropdownTypeahead2);\r\n","import coreModule from '../core_module';\r\n\r\ncoreModule.directive('giveFocus', () => {\r\n  return (scope: any, element: any, attrs: any) => {\r\n    element.click((e: any) => {\r\n      e.stopPropagation();\r\n    });\r\n\r\n    scope.$watch(\r\n      attrs.giveFocus,\r\n      (newValue: any) => {\r\n        if (!newValue) {\r\n          return;\r\n        }\r\n        setTimeout(() => {\r\n          element.focus();\r\n          const domEl: any = element[0];\r\n          if (domEl.setSelectionRange) {\r\n            const pos = element.val().length * 2;\r\n            domEl.setSelectionRange(pos, pos);\r\n          }\r\n        }, 200);\r\n      },\r\n      true\r\n    );\r\n  };\r\n});\r\n\r\nexport default {};\r\n","import _ from 'lodash';\r\nimport $ from 'jquery';\r\nimport coreModule from '../core_module';\r\nimport { TemplateSrv } from 'app/features/templating/template_srv';\r\n\r\n/** @ngInject */\r\nexport function metricSegment($compile: any, $sce: any, templateSrv: TemplateSrv) {\r\n  const inputTemplate =\r\n    '<input type=\"text\" data-provide=\"typeahead\" ' +\r\n    ' class=\"gf-form-input input-medium\"' +\r\n    ' spellcheck=\"false\" style=\"display:none\"></input>';\r\n\r\n  const linkTemplate =\r\n    '<a class=\"gf-form-label\" ng-class=\"segment.cssClass\" ' +\r\n    'tabindex=\"1\" give-focus=\"segment.focus\" ng-bind-html=\"segment.html\"></a>';\r\n\r\n  const selectTemplate =\r\n    '<a class=\"gf-form-input gf-form-input--dropdown\" ng-class=\"segment.cssClass\" ' +\r\n    'tabindex=\"1\" give-focus=\"segment.focus\" ng-bind-html=\"segment.html\"></a>';\r\n\r\n  return {\r\n    scope: {\r\n      segment: '=',\r\n      getOptions: '&',\r\n      onChange: '&',\r\n      debounce: '@',\r\n    },\r\n    link: ($scope: any, elem: any) => {\r\n      const $input = $(inputTemplate);\r\n      const segment = $scope.segment;\r\n      const $button = $(segment.selectMode ? selectTemplate : linkTemplate);\r\n      let options = null;\r\n      let cancelBlur: any = null;\r\n      let linkMode = true;\r\n      const debounceLookup = $scope.debounce;\r\n\r\n      $input.appendTo(elem);\r\n      $button.appendTo(elem);\r\n\r\n      $scope.updateVariableValue = (value: string) => {\r\n        if (value === '' || segment.value === value) {\r\n          return;\r\n        }\r\n\r\n        $scope.$apply(() => {\r\n          const selected: any = _.find($scope.altSegments, { value: value });\r\n          if (selected) {\r\n            segment.value = selected.value;\r\n            segment.html = selected.html || $sce.trustAsHtml(templateSrv.highlightVariablesAsHtml(selected.value));\r\n            segment.fake = false;\r\n            segment.expandable = selected.expandable;\r\n\r\n            if (selected.type) {\r\n              segment.type = selected.type;\r\n            }\r\n          } else if (segment.custom !== 'false') {\r\n            segment.value = value;\r\n            segment.html = $sce.trustAsHtml(templateSrv.highlightVariablesAsHtml(value));\r\n            segment.expandable = true;\r\n            segment.fake = false;\r\n          }\r\n\r\n          $scope.onChange();\r\n        });\r\n      };\r\n\r\n      $scope.switchToLink = (fromClick: boolean) => {\r\n        if (linkMode && !fromClick) {\r\n          return;\r\n        }\r\n\r\n        clearTimeout(cancelBlur);\r\n        cancelBlur = null;\r\n        linkMode = true;\r\n        $input.hide();\r\n        $button.show();\r\n        $scope.updateVariableValue($input.val());\r\n      };\r\n\r\n      $scope.inputBlur = () => {\r\n        // happens long before the click event on the typeahead options\r\n        // need to have long delay because the blur\r\n        cancelBlur = setTimeout($scope.switchToLink, 200);\r\n      };\r\n\r\n      $scope.source = (query: string, callback: any) => {\r\n        $scope.$apply(() => {\r\n          $scope.getOptions({ $query: query }).then((altSegments: any) => {\r\n            $scope.altSegments = altSegments;\r\n            options = _.map($scope.altSegments, alt => {\r\n              return _.escape(alt.value);\r\n            });\r\n\r\n            // add custom values\r\n            if (segment.custom !== 'false') {\r\n              if (!segment.fake && _.indexOf(options, segment.value) === -1) {\r\n                options.unshift(_.escape(segment.value));\r\n              }\r\n            }\r\n\r\n            callback(options);\r\n          });\r\n        });\r\n      };\r\n\r\n      $scope.updater = (value: string) => {\r\n        value = _.unescape(value);\r\n        if (value === segment.value) {\r\n          clearTimeout(cancelBlur);\r\n          $input.focus();\r\n          return value;\r\n        }\r\n\r\n        $input.val(value);\r\n        $scope.switchToLink(true);\r\n\r\n        return value;\r\n      };\r\n\r\n      $scope.matcher = function(item: string) {\r\n        if (linkMode) {\r\n          return false;\r\n        }\r\n        let str = this.query;\r\n        if (str[0] === '/') {\r\n          str = str.substring(1);\r\n        }\r\n        if (str[str.length - 1] === '/') {\r\n          str = str.substring(0, str.length - 1);\r\n        }\r\n        try {\r\n          return item.toLowerCase().match(str.toLowerCase());\r\n        } catch (e) {\r\n          return false;\r\n        }\r\n      };\r\n\r\n      $input.attr('data-provide', 'typeahead');\r\n      $input.typeahead({\r\n        source: $scope.source,\r\n        minLength: 0,\r\n        items: 10000,\r\n        updater: $scope.updater,\r\n        matcher: $scope.matcher,\r\n      });\r\n\r\n      const typeahead = $input.data('typeahead');\r\n      typeahead.lookup = function() {\r\n        this.query = this.$element.val() || '';\r\n        const items = this.source(this.query, $.proxy(this.process, this));\r\n        return items ? this.process(items) : items;\r\n      };\r\n\r\n      if (debounceLookup) {\r\n        typeahead.lookup = _.debounce(typeahead.lookup, 500, { leading: true });\r\n      }\r\n\r\n      $button.keydown(evt => {\r\n        // trigger typeahead on down arrow or enter key\r\n        if (evt.keyCode === 40 || evt.keyCode === 13) {\r\n          $button.click();\r\n        }\r\n      });\r\n\r\n      $button.click(() => {\r\n        options = null;\r\n        $input.css('width', Math.max($button.width(), 80) + 16 + 'px');\r\n\r\n        $button.hide();\r\n        $input.show();\r\n        $input.focus();\r\n\r\n        linkMode = false;\r\n\r\n        const typeahead = $input.data('typeahead');\r\n        if (typeahead) {\r\n          $input.val('');\r\n          typeahead.lookup();\r\n        }\r\n      });\r\n\r\n      $input.blur($scope.inputBlur);\r\n\r\n      $compile(elem.contents())($scope);\r\n    },\r\n  };\r\n}\r\n\r\n/** @ngInject */\r\nexport function metricSegmentModel(uiSegmentSrv: any) {\r\n  return {\r\n    template:\r\n      '<metric-segment segment=\"segment\" get-options=\"getOptionsInternal()\" on-change=\"onSegmentChange()\"></metric-segment>',\r\n    restrict: 'E',\r\n    scope: {\r\n      property: '=',\r\n      options: '=',\r\n      getOptions: '&',\r\n      onChange: '&',\r\n    },\r\n    link: {\r\n      pre: function postLink($scope: any, elem: any, attrs: any) {\r\n        let cachedOptions: any;\r\n\r\n        $scope.valueToSegment = (value: any) => {\r\n          const option: any = _.find($scope.options, { value: value });\r\n          const segment = {\r\n            cssClass: attrs.cssClass,\r\n            custom: attrs.custom,\r\n            value: option ? option.text : value,\r\n            selectMode: attrs.selectMode,\r\n          };\r\n\r\n          return uiSegmentSrv.newSegment(segment);\r\n        };\r\n\r\n        $scope.getOptionsInternal = () => {\r\n          if ($scope.options) {\r\n            cachedOptions = $scope.options;\r\n            return Promise.resolve(\r\n              _.map($scope.options, option => {\r\n                return { value: option.text };\r\n              })\r\n            );\r\n          } else {\r\n            return $scope.getOptions().then((options: any) => {\r\n              cachedOptions = options;\r\n              return _.map(options, option => {\r\n                if (option.html) {\r\n                  return option;\r\n                }\r\n                return { value: option.text };\r\n              });\r\n            });\r\n          }\r\n        };\r\n\r\n        $scope.onSegmentChange = () => {\r\n          if (cachedOptions) {\r\n            const option: any = _.find(cachedOptions, { text: $scope.segment.value });\r\n            if (option && option.value !== $scope.property) {\r\n              $scope.property = option.value;\r\n            } else if (attrs.custom !== 'false') {\r\n              $scope.property = $scope.segment.value;\r\n            }\r\n          } else {\r\n            $scope.property = $scope.segment.value;\r\n          }\r\n\r\n          // needs to call this after digest so\r\n          // property is synced with outerscope\r\n          $scope.$$postDigest(() => {\r\n            $scope.$apply(() => {\r\n              $scope.onChange();\r\n            });\r\n          });\r\n        };\r\n\r\n        $scope.segment = $scope.valueToSegment($scope.property);\r\n      },\r\n    },\r\n  };\r\n}\r\n\r\ncoreModule.directive('metricSegment', metricSegment);\r\ncoreModule.directive('metricSegmentModel', metricSegmentModel);\r\n","import angular from 'angular';\r\nimport Clipboard from 'clipboard';\r\nimport coreModule from '../core_module';\r\nimport kbn from 'app/core/utils/kbn';\r\nimport { appEvents } from 'app/core/core';\r\nimport { AppEvents } from '@grafana/data';\r\n\r\n/** @ngInject */\r\nfunction tip($compile: any) {\r\n  return {\r\n    restrict: 'E',\r\n    link: (scope: any, elem: any, attrs: any) => {\r\n      let _t =\r\n        '<i class=\"grafana-tip fa fa-' +\r\n        (attrs.icon || 'question-circle') +\r\n        '\" bs-tooltip=\"\\'' +\r\n        kbn.addslashes(elem.text()) +\r\n        '\\'\"></i>';\r\n      _t = _t.replace(/{/g, '\\\\{').replace(/}/g, '\\\\}');\r\n      elem.replaceWith($compile(angular.element(_t))(scope));\r\n    },\r\n  };\r\n}\r\n\r\nfunction clipboardButton() {\r\n  return {\r\n    scope: {\r\n      getText: '&clipboardButton',\r\n    },\r\n    link: (scope: any, elem: any) => {\r\n      scope.clipboard = new Clipboard(elem[0], {\r\n        text: () => {\r\n          return scope.getText();\r\n        },\r\n      });\r\n\r\n      scope.clipboard.on('success', () => {\r\n        appEvents.emit(AppEvents.alertSuccess, ['Content copied to clipboard']);\r\n      });\r\n\r\n      scope.$on('$destroy', () => {\r\n        if (scope.clipboard) {\r\n          scope.clipboard.destroy();\r\n        }\r\n      });\r\n    },\r\n  };\r\n}\r\n\r\n/** @ngInject */\r\nfunction compile($compile: any) {\r\n  return {\r\n    restrict: 'A',\r\n    link: (scope: any, element: any, attrs: any) => {\r\n      scope.$watch(\r\n        (scope: any) => {\r\n          return scope.$eval(attrs.compile);\r\n        },\r\n        (value: any) => {\r\n          element.html(value);\r\n          $compile(element.contents())(scope);\r\n        }\r\n      );\r\n    },\r\n  };\r\n}\r\n\r\nfunction watchChange() {\r\n  return {\r\n    scope: { onchange: '&watchChange' },\r\n    link: (scope: any, element: any) => {\r\n      element.on('input', () => {\r\n        scope.$apply(() => {\r\n          scope.onchange({ inputValue: element.val() });\r\n        });\r\n      });\r\n    },\r\n  };\r\n}\r\n\r\n/** @ngInject */\r\nfunction editorOptBool($compile: any) {\r\n  return {\r\n    restrict: 'E',\r\n    link: (scope: any, elem: any, attrs: any) => {\r\n      const ngchange = attrs.change ? ' ng-change=\"' + attrs.change + '\"' : '';\r\n      const tip = attrs.tip ? ' <tip>' + attrs.tip + '</tip>' : '';\r\n      const showIf = attrs.showIf ? ' ng-show=\"' + attrs.showIf + '\" ' : '';\r\n\r\n      const template =\r\n        '<div class=\"editor-option gf-form-checkbox text-center\"' +\r\n        showIf +\r\n        '>' +\r\n        ' <label for=\"' +\r\n        attrs.model +\r\n        '\" class=\"small\">' +\r\n        attrs.text +\r\n        tip +\r\n        '</label>' +\r\n        '<input class=\"cr1\" id=\"' +\r\n        attrs.model +\r\n        '\" type=\"checkbox\" ' +\r\n        '       ng-model=\"' +\r\n        attrs.model +\r\n        '\"' +\r\n        ngchange +\r\n        '       ng-checked=\"' +\r\n        attrs.model +\r\n        '\"></input>' +\r\n        ' <label for=\"' +\r\n        attrs.model +\r\n        '\" class=\"cr1\"></label>';\r\n      elem.replaceWith($compile(angular.element(template))(scope));\r\n    },\r\n  };\r\n}\r\n\r\n/** @ngInject */\r\nfunction editorCheckbox($compile: any, $interpolate: any) {\r\n  return {\r\n    restrict: 'E',\r\n    link: (scope: any, elem: any, attrs: any) => {\r\n      const text = $interpolate(attrs.text)(scope);\r\n      const model = $interpolate(attrs.model)(scope);\r\n      const ngchange = attrs.change ? ' ng-change=\"' + attrs.change + '\"' : '';\r\n      const tip = attrs.tip ? ' <tip>' + attrs.tip + '</tip>' : '';\r\n      const label = '<label for=\"' + scope.$id + model + '\" class=\"checkbox-label\">' + text + tip + '</label>';\r\n\r\n      let template =\r\n        '<input class=\"cr1\" id=\"' +\r\n        scope.$id +\r\n        model +\r\n        '\" type=\"checkbox\" ' +\r\n        '       ng-model=\"' +\r\n        model +\r\n        '\"' +\r\n        ngchange +\r\n        '       ng-checked=\"' +\r\n        model +\r\n        '\"></input>' +\r\n        ' <label for=\"' +\r\n        scope.$id +\r\n        model +\r\n        '\" class=\"cr1\"></label>';\r\n\r\n      template = template + label;\r\n      elem.addClass('gf-form-checkbox');\r\n      elem.html($compile(angular.element(template))(scope));\r\n    },\r\n  };\r\n}\r\n\r\n/** @ngInject */\r\nfunction gfDropdown($parse: any, $compile: any, $timeout: any) {\r\n  function buildTemplate(items: any, placement?: any) {\r\n    const upclass = placement === 'top' ? 'dropup' : '';\r\n    const ul = ['<ul class=\"dropdown-menu ' + upclass + '\" role=\"menu\" aria-labelledby=\"drop1\">', '</ul>'];\r\n\r\n    for (let index = 0; index < items.length; index++) {\r\n      const item = items[index];\r\n\r\n      if (item.divider) {\r\n        ul.splice(index + 1, 0, '<li class=\"divider\"></li>');\r\n        continue;\r\n      }\r\n\r\n      let li =\r\n        '<li' +\r\n        (item.submenu && item.submenu.length ? ' class=\"dropdown-submenu\"' : '') +\r\n        '>' +\r\n        '<a tabindex=\"-1\" ng-href=\"' +\r\n        (item.href || '') +\r\n        '\"' +\r\n        (item.click ? ' ng-click=\"' + item.click + '\"' : '') +\r\n        (item.target ? ' target=\"' + item.target + '\"' : '') +\r\n        (item.method ? ' data-method=\"' + item.method + '\"' : '') +\r\n        '>' +\r\n        (item.text || '') +\r\n        '</a>';\r\n\r\n      if (item.submenu && item.submenu.length) {\r\n        li += buildTemplate(item.submenu).join('\\n');\r\n      }\r\n\r\n      li += '</li>';\r\n      ul.splice(index + 1, 0, li);\r\n    }\r\n\r\n    return ul;\r\n  }\r\n\r\n  return {\r\n    restrict: 'EA',\r\n    scope: true,\r\n    link: function postLink(scope: any, iElement: any, iAttrs: any) {\r\n      const getter = $parse(iAttrs.gfDropdown),\r\n        items = getter(scope);\r\n      $timeout(() => {\r\n        const placement = iElement.data('placement');\r\n        const dropdown = angular.element(buildTemplate(items, placement).join(''));\r\n        dropdown.insertAfter(iElement);\r\n        $compile(iElement.next('ul.dropdown-menu'))(scope);\r\n      });\r\n\r\n      iElement.addClass('dropdown-toggle').attr('data-toggle', 'dropdown');\r\n    },\r\n  };\r\n}\r\n\r\ncoreModule.directive('tip', tip);\r\ncoreModule.directive('clipboardButton', clipboardButton);\r\ncoreModule.directive('compile', compile);\r\ncoreModule.directive('watchChange', watchChange);\r\ncoreModule.directive('editorOptBool', editorOptBool);\r\ncoreModule.directive('editorCheckbox', editorCheckbox);\r\ncoreModule.directive('gfDropdown', gfDropdown);\r\n","import coreModule from '../core_module';\r\nimport { rangeUtil } from '@grafana/data';\r\n\r\nfunction ngModelOnBlur() {\r\n  return {\r\n    restrict: 'A',\r\n    priority: 1,\r\n    require: 'ngModel',\r\n    link: (scope: any, elm: any, attr: any, ngModelCtrl: any) => {\r\n      if (attr.type === 'radio' || attr.type === 'checkbox') {\r\n        return;\r\n      }\r\n\r\n      elm.off('input keydown change');\r\n      elm.bind('blur', () => {\r\n        scope.$apply(() => {\r\n          ngModelCtrl.$setViewValue(elm.val());\r\n        });\r\n      });\r\n    },\r\n  };\r\n}\r\n\r\nfunction emptyToNull() {\r\n  return {\r\n    restrict: 'A',\r\n    require: 'ngModel',\r\n    link: (scope: any, elm: any, attrs: any, ctrl: any) => {\r\n      ctrl.$parsers.push((viewValue: any) => {\r\n        if (viewValue === '') {\r\n          return null;\r\n        }\r\n        return viewValue;\r\n      });\r\n    },\r\n  };\r\n}\r\n\r\nfunction validTimeSpan() {\r\n  return {\r\n    require: 'ngModel',\r\n    link: (scope: any, elm: any, attrs: any, ctrl: any) => {\r\n      ctrl.$validators.integer = (modelValue: any, viewValue: any) => {\r\n        if (ctrl.$isEmpty(modelValue)) {\r\n          return true;\r\n        }\r\n        if (viewValue.indexOf('$') === 0 || viewValue.indexOf('+$') === 0) {\r\n          return true; // allow template variable\r\n        }\r\n        const info = rangeUtil.describeTextRange(viewValue);\r\n        return info.invalid !== true;\r\n      };\r\n    },\r\n  };\r\n}\r\n\r\ncoreModule.directive('ngModelOnblur', ngModelOnBlur);\r\ncoreModule.directive('emptyToNull', emptyToNull);\r\ncoreModule.directive('validTimeSpan', validTimeSpan);\r\n","import $ from 'jquery';\r\nimport coreModule from '../core_module';\r\n\r\nfunction getBlockNodes(nodes: any[]) {\r\n  let node = nodes[0];\r\n  const endNode = nodes[nodes.length - 1];\r\n  let blockNodes: any[];\r\n  node = node.nextSibling;\r\n\r\n  for (let i = 1; node !== endNode && node; i++) {\r\n    if (blockNodes || nodes[i] !== node) {\r\n      if (!blockNodes) {\r\n        blockNodes = $([].slice.call(nodes, 0, i)) as any;\r\n      }\r\n      blockNodes.push(node);\r\n    }\r\n    node = node.nextSibling;\r\n  }\r\n\r\n  return blockNodes || nodes;\r\n}\r\n\r\n/** @ngInject */\r\nfunction rebuildOnChange($animate: any) {\r\n  return {\r\n    multiElement: true,\r\n    terminal: true,\r\n    transclude: true,\r\n    priority: 600,\r\n    restrict: 'E',\r\n    link: (scope: any, elem: any, attrs: any, ctrl: any, transclude: any) => {\r\n      let block: any, childScope: any, previousElements: any;\r\n\r\n      function cleanUp() {\r\n        if (previousElements) {\r\n          previousElements.remove();\r\n          previousElements = null;\r\n        }\r\n        if (childScope) {\r\n          childScope.$destroy();\r\n          childScope = null;\r\n        }\r\n        if (block) {\r\n          previousElements = getBlockNodes(block.clone);\r\n          $animate.leave(previousElements).then(() => {\r\n            previousElements = null;\r\n          });\r\n          block = null;\r\n        }\r\n      }\r\n\r\n      scope.$watch(attrs.property, function rebuildOnChangeAction(value: any, oldValue: any) {\r\n        if (childScope && value !== oldValue) {\r\n          cleanUp();\r\n        }\r\n\r\n        if (!childScope && (value || attrs.showNull)) {\r\n          transclude((clone: any, newScope: any) => {\r\n            childScope = newScope;\r\n            clone[clone.length++] = document.createComment(' end rebuild on change ');\r\n            block = { clone: clone };\r\n            $animate.enter(clone, elem.parent(), elem);\r\n          });\r\n        } else {\r\n          cleanUp();\r\n        }\r\n      });\r\n    },\r\n  };\r\n}\r\n\r\ncoreModule.directive('rebuildOnChange', rebuildOnChange);\r\n","import angular from 'angular';\r\nimport { getTagColorsFromName } from '@grafana/ui';\r\nimport $ from 'jquery';\r\nimport coreModule from '../core_module';\r\nimport 'vendor/tagsinput/bootstrap-tagsinput.js';\r\n\r\nfunction setColor(name: string, element: JQuery) {\r\n  const { color, borderColor } = getTagColorsFromName(name);\r\n  element.css('background-color', color);\r\n  element.css('border-color', borderColor);\r\n}\r\n\r\nfunction tagColorFromName() {\r\n  return {\r\n    scope: { tagColorFromName: '=' },\r\n    link: (scope: any, element: any) => {\r\n      setColor(scope.tagColorFromName, element);\r\n    },\r\n  };\r\n}\r\n\r\nfunction bootstrapTagsinput() {\r\n  function getItemProperty(scope: any, property: any) {\r\n    if (!property) {\r\n      return undefined;\r\n    }\r\n\r\n    if (angular.isFunction(scope.$parent[property])) {\r\n      return scope.$parent[property];\r\n    }\r\n\r\n    return (item: any) => {\r\n      return item[property];\r\n    };\r\n  }\r\n\r\n  return {\r\n    restrict: 'EA',\r\n    scope: {\r\n      model: '=ngModel',\r\n      onTagsUpdated: '&',\r\n    },\r\n    template: '<select multiple></select>',\r\n    replace: false,\r\n    link: function(scope: any, element: any, attrs: any) {\r\n      if (!angular.isArray(scope.model)) {\r\n        scope.model = [];\r\n      }\r\n\r\n      const select = $('select', element);\r\n\r\n      if (attrs.placeholder) {\r\n        select.attr('placeholder', attrs.placeholder);\r\n      }\r\n\r\n      select.tagsinput({\r\n        typeahead: {\r\n          source: angular.isFunction(scope.$parent[attrs.typeaheadSource])\r\n            ? scope.$parent[attrs.typeaheadSource]\r\n            : null,\r\n        },\r\n        widthClass: attrs.widthClass,\r\n        itemValue: getItemProperty(scope, attrs.itemvalue),\r\n        itemText: getItemProperty(scope, attrs.itemtext),\r\n        tagClass: angular.isFunction(scope.$parent[attrs.tagclass])\r\n          ? scope.$parent[attrs.tagclass]\r\n          : () => {\r\n              return attrs.tagclass;\r\n            },\r\n      });\r\n\r\n      select.on('itemAdded', (event: any) => {\r\n        if (scope.model.indexOf(event.item) === -1) {\r\n          scope.model.push(event.item);\r\n          if (scope.onTagsUpdated) {\r\n            scope.onTagsUpdated();\r\n          }\r\n        }\r\n        const tagElement = select\r\n          .next()\r\n          .children('span')\r\n          .filter(() => {\r\n            return $(this).text() === event.item;\r\n          });\r\n        setColor(event.item, tagElement);\r\n      });\r\n\r\n      select.on('itemRemoved', (event: any) => {\r\n        const idx = scope.model.indexOf(event.item);\r\n        if (idx !== -1) {\r\n          scope.model.splice(idx, 1);\r\n          if (scope.onTagsUpdated) {\r\n            scope.onTagsUpdated();\r\n          }\r\n        }\r\n      });\r\n\r\n      scope.$watch(\r\n        'model',\r\n        () => {\r\n          if (!angular.isArray(scope.model)) {\r\n            scope.model = [];\r\n          }\r\n\r\n          select.tagsinput('removeAll');\r\n\r\n          for (let i = 0; i < scope.model.length; i++) {\r\n            select.tagsinput('add', scope.model[i]);\r\n          }\r\n        },\r\n        true\r\n      );\r\n    },\r\n  };\r\n}\r\n\r\ncoreModule.directive('tagColorFromName', tagColorFromName);\r\ncoreModule.directive('bootstrapTagsinput', bootstrapTagsinput);\r\n","import angular, { IScope } from 'angular';\r\nimport debounce from 'lodash/debounce';\r\nimport each from 'lodash/each';\r\nimport filter from 'lodash/filter';\r\nimport find from 'lodash/find';\r\nimport indexOf from 'lodash/indexOf';\r\nimport map from 'lodash/map';\r\nimport { e2e } from '@grafana/e2e';\r\n\r\nimport coreModule from '../core_module';\r\nimport { GrafanaRootScope } from 'app/routes/GrafanaCtrl';\r\nimport { containsSearchFilter } from '../../features/templating/variable';\r\n\r\nexport class ValueSelectDropdownCtrl {\r\n  dropdownVisible: any;\r\n  highlightIndex: any;\r\n  linkText: any;\r\n  oldVariableText: any;\r\n  options: any;\r\n  search: any;\r\n  selectedTags: any;\r\n  selectedValues: any;\r\n  tags: any;\r\n  variable: any;\r\n\r\n  hide: any;\r\n  onUpdated: any;\r\n  queryHasSearchFilter: boolean;\r\n  debouncedQueryChanged: Function;\r\n  selectors: typeof e2e.pages.Dashboard.SubMenu.selectors;\r\n\r\n  /** @ngInject */\r\n  constructor(private $scope: IScope) {\r\n    this.queryHasSearchFilter = this.variable ? containsSearchFilter(this.variable.query) : false;\r\n    this.debouncedQueryChanged = debounce(this.queryChanged.bind(this), 200);\r\n    this.selectors = e2e.pages.Dashboard.SubMenu.selectors;\r\n  }\r\n\r\n  show() {\r\n    this.oldVariableText = this.variable.current.text;\r\n    this.highlightIndex = -1;\r\n\r\n    this.options = this.variable.options;\r\n    this.selectedValues = filter(this.options, { selected: true });\r\n\r\n    this.tags = map(this.variable.tags, value => {\r\n      let tag = { text: value, selected: false };\r\n      each(this.variable.current.tags, tagObj => {\r\n        if (tagObj.text === value) {\r\n          tag = tagObj;\r\n        }\r\n      });\r\n      return tag;\r\n    });\r\n\r\n    // new behaviour, if this is a query that uses searchfilter it might be a nicer\r\n    // user experience to show the last typed search query in the input field\r\n    const query = this.queryHasSearchFilter && this.search && this.search.query ? this.search.query : '';\r\n\r\n    this.search = {\r\n      query,\r\n      options: this.options.slice(0, Math.min(this.options.length, 1000)),\r\n    };\r\n\r\n    this.dropdownVisible = true;\r\n  }\r\n\r\n  updateLinkText() {\r\n    const current = this.variable.current;\r\n\r\n    if (current.tags && current.tags.length) {\r\n      // filer out values that are in selected tags\r\n      const selectedAndNotInTag = filter(this.variable.options, option => {\r\n        if (!option.selected) {\r\n          return false;\r\n        }\r\n        for (let i = 0; i < current.tags.length; i++) {\r\n          const tag = current.tags[i];\r\n          if (indexOf(tag.values, option.value) !== -1) {\r\n            return false;\r\n          }\r\n        }\r\n        return true;\r\n      });\r\n\r\n      // convert values to text\r\n      const currentTexts = map(selectedAndNotInTag, 'text');\r\n\r\n      // join texts\r\n      this.linkText = currentTexts.join(' + ');\r\n      if (this.linkText.length > 0) {\r\n        this.linkText += ' + ';\r\n      }\r\n    } else {\r\n      this.linkText = this.variable.current.text;\r\n    }\r\n  }\r\n\r\n  clearSelections() {\r\n    this.selectedValues = filter(this.options, { selected: true });\r\n\r\n    if (this.selectedValues.length) {\r\n      each(this.options, option => {\r\n        option.selected = false;\r\n      });\r\n    } else {\r\n      each(this.search.options, option => {\r\n        option.selected = true;\r\n      });\r\n    }\r\n    this.selectionsChanged(false);\r\n  }\r\n\r\n  selectTag(tag: any) {\r\n    tag.selected = !tag.selected;\r\n    let tagValuesPromise;\r\n    if (!tag.values) {\r\n      tagValuesPromise = this.variable.getValuesForTag(tag.text);\r\n    } else {\r\n      tagValuesPromise = Promise.resolve(tag.values);\r\n    }\r\n\r\n    return tagValuesPromise.then((values: any) => {\r\n      tag.values = values;\r\n      tag.valuesText = values.join(' + ');\r\n      each(this.options, option => {\r\n        if (indexOf(tag.values, option.value) !== -1) {\r\n          option.selected = tag.selected;\r\n        }\r\n      });\r\n\r\n      this.selectionsChanged(false);\r\n    });\r\n  }\r\n\r\n  keyDown(evt: any) {\r\n    if (evt.keyCode === 27) {\r\n      this.hide();\r\n    }\r\n    if (evt.keyCode === 40) {\r\n      this.moveHighlight(1);\r\n    }\r\n    if (evt.keyCode === 38) {\r\n      this.moveHighlight(-1);\r\n    }\r\n    if (evt.keyCode === 13) {\r\n      if (this.search.options.length === 0) {\r\n        this.commitChanges();\r\n      } else {\r\n        this.selectValue(this.search.options[this.highlightIndex], {}, true);\r\n      }\r\n    }\r\n    if (evt.keyCode === 32) {\r\n      this.selectValue(this.search.options[this.highlightIndex], {}, false);\r\n    }\r\n  }\r\n\r\n  moveHighlight(direction: number) {\r\n    this.highlightIndex = (this.highlightIndex + direction) % this.search.options.length;\r\n  }\r\n\r\n  selectValue(option: any, event: any, commitChange?: boolean) {\r\n    if (!option) {\r\n      return;\r\n    }\r\n\r\n    option.selected = this.variable.multi ? !option.selected : true;\r\n\r\n    commitChange = commitChange || false;\r\n\r\n    const setAllExceptCurrentTo = (newValue: any) => {\r\n      each(this.options, other => {\r\n        if (option !== other) {\r\n          other.selected = newValue;\r\n        }\r\n      });\r\n    };\r\n\r\n    // commit action (enter key), should not deselect it\r\n    if (commitChange) {\r\n      option.selected = true;\r\n    }\r\n\r\n    if (option.text === 'All') {\r\n      // always clear search query if all is marked\r\n      this.search.query = '';\r\n      setAllExceptCurrentTo(false);\r\n      commitChange = true;\r\n    } else if (!this.variable.multi) {\r\n      setAllExceptCurrentTo(false);\r\n      commitChange = true;\r\n    } else if (event.ctrlKey || event.metaKey || event.shiftKey) {\r\n      commitChange = true;\r\n      setAllExceptCurrentTo(false);\r\n    }\r\n\r\n    this.selectionsChanged(commitChange);\r\n  }\r\n\r\n  selectionsChanged(commitChange: boolean) {\r\n    this.selectedValues = filter(this.options, { selected: true });\r\n\r\n    if (this.selectedValues.length > 1) {\r\n      if (this.selectedValues[0].text === 'All') {\r\n        this.selectedValues[0].selected = false;\r\n        this.selectedValues = this.selectedValues.slice(1, this.selectedValues.length);\r\n      }\r\n    }\r\n\r\n    // validate selected tags\r\n    each(this.tags, tag => {\r\n      if (tag.selected) {\r\n        each(tag.values, value => {\r\n          if (!find(this.selectedValues, { value: value })) {\r\n            tag.selected = false;\r\n          }\r\n        });\r\n      }\r\n    });\r\n\r\n    this.selectedTags = filter(this.tags, { selected: true });\r\n    this.variable.current.value = map(this.selectedValues, 'value');\r\n    this.variable.current.text = map(this.selectedValues, 'text').join(' + ');\r\n    this.variable.current.tags = this.selectedTags;\r\n\r\n    if (!this.variable.multi) {\r\n      this.variable.current.value = this.selectedValues[0].value;\r\n    }\r\n\r\n    if (commitChange) {\r\n      this.commitChanges();\r\n    }\r\n  }\r\n\r\n  commitChanges() {\r\n    // if we have a search query and no options use that\r\n    if (this.search.options.length === 0 && this.search.query.length > 0) {\r\n      this.variable.current = { text: this.search.query, value: this.search.query };\r\n    } else if (this.selectedValues.length === 0) {\r\n      // make sure one option is selected\r\n      this.options[0].selected = true;\r\n      this.selectionsChanged(false);\r\n    }\r\n\r\n    this.dropdownVisible = false;\r\n    this.updateLinkText();\r\n    if (this.queryHasSearchFilter) {\r\n      this.updateLazyLoadedOptions();\r\n    }\r\n\r\n    if (this.variable.current.text !== this.oldVariableText) {\r\n      this.onUpdated();\r\n    }\r\n  }\r\n\r\n  async queryChanged() {\r\n    if (this.queryHasSearchFilter) {\r\n      await this.updateLazyLoadedOptions();\r\n      return;\r\n    }\r\n\r\n    const options = filter(this.options, option => {\r\n      return option.text.toLowerCase().indexOf(this.search.query.toLowerCase()) !== -1;\r\n    });\r\n\r\n    this.updateUIBoundOptions(this.$scope, options);\r\n  }\r\n\r\n  init() {\r\n    this.selectedTags = this.variable.current.tags || [];\r\n    this.updateLinkText();\r\n  }\r\n\r\n  async updateLazyLoadedOptions() {\r\n    this.options = await this.lazyLoadOptions(this.search.query);\r\n    this.updateUIBoundOptions(this.$scope, this.options);\r\n  }\r\n\r\n  async lazyLoadOptions(query: string): Promise<any[]> {\r\n    await this.variable.updateOptions(query);\r\n    return this.variable.options;\r\n  }\r\n\r\n  updateUIBoundOptions($scope: IScope, options: any[]) {\r\n    this.highlightIndex = 0;\r\n    this.search.options = options.slice(0, Math.min(options.length, 1000));\r\n    $scope.$apply();\r\n  }\r\n}\r\n\r\n/** @ngInject */\r\nexport function valueSelectDropdown($compile: any, $window: any, $timeout: any, $rootScope: GrafanaRootScope) {\r\n  return {\r\n    scope: { dashboard: '=', variable: '=', onUpdated: '&' },\r\n    templateUrl: 'public/app/partials/valueSelectDropdown.html',\r\n    controller: 'ValueSelectDropdownCtrl',\r\n    controllerAs: 'vm',\r\n    bindToController: true,\r\n    link: (scope: any, elem: any) => {\r\n      const bodyEl = angular.element($window.document.body);\r\n      const linkEl = elem.find('.variable-value-link');\r\n      const inputEl = elem.find('input');\r\n\r\n      function openDropdown() {\r\n        inputEl.css('width', Math.max(linkEl.width(), 80) + 'px');\r\n\r\n        inputEl.show();\r\n        linkEl.hide();\r\n\r\n        inputEl.focus();\r\n        $timeout(\r\n          () => {\r\n            bodyEl.on('click', bodyOnClick);\r\n          },\r\n          0,\r\n          false\r\n        );\r\n      }\r\n\r\n      function switchToLink() {\r\n        inputEl.hide();\r\n        linkEl.show();\r\n        bodyEl.off('click', bodyOnClick);\r\n      }\r\n\r\n      function bodyOnClick(e: any) {\r\n        if (elem.has(e.target).length === 0) {\r\n          scope.$apply(() => {\r\n            scope.vm.commitChanges();\r\n          });\r\n        }\r\n      }\r\n\r\n      scope.$watch('vm.dropdownVisible', (newValue: any) => {\r\n        if (newValue) {\r\n          openDropdown();\r\n        } else {\r\n          switchToLink();\r\n        }\r\n      });\r\n\r\n      scope.vm.dashboard.on(\r\n        'template-variable-value-updated',\r\n        () => {\r\n          scope.vm.updateLinkText();\r\n        },\r\n        scope\r\n      );\r\n\r\n      scope.vm.init();\r\n    },\r\n  };\r\n}\r\n\r\ncoreModule.controller('ValueSelectDropdownCtrl', ValueSelectDropdownCtrl);\r\ncoreModule.directive('valueSelectDropdown', valueSelectDropdown);\r\n","import _ from 'lodash';\r\nimport angular from 'angular';\r\nimport coreModule from '../core_module';\r\nimport { TemplateSrv } from 'app/features/templating/template_srv';\r\nimport { dateTime } from '@grafana/data';\r\n\r\ncoreModule.filter('stringSort', () => {\r\n  return (input: any) => {\r\n    return input.sort();\r\n  };\r\n});\r\n\r\ncoreModule.filter('slice', () => {\r\n  return (arr: any[], start: any, end: any) => {\r\n    if (!_.isUndefined(arr)) {\r\n      return arr.slice(start, end);\r\n    }\r\n    return arr;\r\n  };\r\n});\r\n\r\ncoreModule.filter('stringify', () => {\r\n  return (arr: any[]) => {\r\n    if (_.isObject(arr) && !_.isArray(arr)) {\r\n      return angular.toJson(arr);\r\n    } else {\r\n      return _.isNull(arr) ? null : arr.toString();\r\n    }\r\n  };\r\n});\r\n\r\ncoreModule.filter('moment', () => {\r\n  return (date: string, mode: string) => {\r\n    switch (mode) {\r\n      case 'ago':\r\n        return dateTime(date).fromNow();\r\n    }\r\n    return dateTime(date).fromNow();\r\n  };\r\n});\r\n\r\n/** @ngInject */\r\nfunction interpolateTemplateVars(templateSrv: TemplateSrv) {\r\n  const filterFunc: any = (text: string, scope: any) => {\r\n    let scopedVars;\r\n    if (scope.ctrl) {\r\n      scopedVars = (scope.ctrl.panel || scope.ctrl.row).scopedVars;\r\n    } else {\r\n      scopedVars = scope.row.scopedVars;\r\n    }\r\n\r\n    return templateSrv.replaceWithText(text, scopedVars);\r\n  };\r\n\r\n  filterFunc.$stateful = true;\r\n  return filterFunc;\r\n}\r\n\r\ncoreModule.filter('interpolateTemplateVars', interpolateTemplateVars);\r\nexport default {};\r\n","import { useRef, useEffect } from 'react';\n\nexport const useRefMounted = () => {\n  const refMounted = useRef(false);\n  useEffect(() => {\n    refMounted.current = true;\n    return () => {\n      refMounted.current = false;\n    };\n  });\n  return refMounted;\n};\n","import $ from 'jquery';\r\nimport angular from 'angular';\r\nimport _ from 'lodash';\r\n\r\nconst $win = $(window);\r\n\r\n$.fn.place_tt = (() => {\r\n  const defaults = {\r\n    offset: 5,\r\n  };\r\n\r\n  return function(this: any, x: number, y: number, opts: any) {\r\n    opts = $.extend(true, {}, defaults, opts);\r\n\r\n    return this.each(() => {\r\n      const $tooltip = $(this);\r\n      let width, height;\r\n\r\n      $tooltip.addClass('grafana-tooltip');\r\n\r\n      $('#tooltip').remove();\r\n      $tooltip.appendTo(document.body);\r\n\r\n      if (opts.compile) {\r\n        angular\r\n          .element(document)\r\n          .injector()\r\n          .invoke([\r\n            '$compile',\r\n            '$rootScope',\r\n            ($compile, $rootScope) => {\r\n              const tmpScope = $rootScope.$new(true);\r\n              _.extend(tmpScope, opts.scopeData);\r\n\r\n              $compile($tooltip)(tmpScope);\r\n              tmpScope.$digest();\r\n              tmpScope.$destroy();\r\n            },\r\n          ]);\r\n      }\r\n\r\n      width = $tooltip.outerWidth(true);\r\n      height = $tooltip.outerHeight(true);\r\n\r\n      const left = x + opts.offset + width > $win.width() ? x - opts.offset - width : x + opts.offset;\r\n      const top = y + opts.offset + height > $win.height() ? y - opts.offset - height : y + opts.offset;\r\n\r\n      $tooltip.css('left', left > 0 ? left : 0);\r\n      $tooltip.css('top', top > 0 ? top : 0);\r\n    });\r\n  };\r\n})();\r\n","import _ from 'lodash';\r\nimport config from 'app/core/config';\r\n\r\nimport { Observable } from 'rxjs';\r\n\r\nexport class LiveSrv {\r\n  conn: any;\r\n  observers: any;\r\n  initPromise: any;\r\n\r\n  constructor() {\r\n    this.observers = {};\r\n  }\r\n\r\n  getWebSocketUrl() {\r\n    const l = window.location;\r\n    return (l.protocol === 'https:' ? 'wss://' : 'ws://') + l.host + config.appSubUrl + '/ws';\r\n  }\r\n\r\n  getConnection() {\r\n    if (this.initPromise) {\r\n      return this.initPromise;\r\n    }\r\n\r\n    if (this.conn && this.conn.readyState === 1) {\r\n      return Promise.resolve(this.conn);\r\n    }\r\n\r\n    this.initPromise = new Promise((resolve, reject) => {\r\n      console.log('Live: connecting...');\r\n      this.conn = new WebSocket(this.getWebSocketUrl());\r\n\r\n      this.conn.onclose = (evt: any) => {\r\n        console.log('Live: websocket onclose', evt);\r\n        reject({ message: 'Connection closed' });\r\n\r\n        this.initPromise = null;\r\n        setTimeout(this.reconnect.bind(this), 2000);\r\n      };\r\n\r\n      this.conn.onmessage = (evt: any) => {\r\n        this.handleMessage(evt.data);\r\n      };\r\n\r\n      this.conn.onerror = (evt: any) => {\r\n        this.initPromise = null;\r\n        reject({ message: 'Connection error' });\r\n        console.log('Live: websocket error', evt);\r\n      };\r\n\r\n      this.conn.onopen = (evt: any) => {\r\n        console.log('opened');\r\n        this.initPromise = null;\r\n        resolve(this.conn);\r\n      };\r\n    });\r\n\r\n    return this.initPromise;\r\n  }\r\n\r\n  handleMessage(message: any) {\r\n    message = JSON.parse(message);\r\n\r\n    if (!message.stream) {\r\n      console.log('Error: stream message without stream!', message);\r\n      return;\r\n    }\r\n\r\n    const observer = this.observers[message.stream];\r\n    if (!observer) {\r\n      this.removeObserver(message.stream, null);\r\n      return;\r\n    }\r\n\r\n    observer.next(message);\r\n  }\r\n\r\n  reconnect() {\r\n    // no need to reconnect if no one cares\r\n    if (_.keys(this.observers).length === 0) {\r\n      return;\r\n    }\r\n\r\n    console.log('LiveSrv: Reconnecting');\r\n\r\n    this.getConnection().then((conn: any) => {\r\n      _.each(this.observers, (value, key) => {\r\n        this.send({ action: 'subscribe', stream: key });\r\n      });\r\n    });\r\n  }\r\n\r\n  send(data: any) {\r\n    this.conn.send(JSON.stringify(data));\r\n  }\r\n\r\n  addObserver(stream: any, observer: any) {\r\n    this.observers[stream] = observer;\r\n\r\n    this.getConnection().then((conn: any) => {\r\n      this.send({ action: 'subscribe', stream: stream });\r\n    });\r\n  }\r\n\r\n  removeObserver(stream: any, observer: any) {\r\n    console.log('unsubscribe', stream);\r\n    delete this.observers[stream];\r\n\r\n    this.getConnection().then((conn: any) => {\r\n      this.send({ action: 'unsubscribe', stream: stream });\r\n    });\r\n  }\r\n\r\n  subscribe(streamName: string) {\r\n    console.log('LiveSrv.subscribe: ' + streamName);\r\n\r\n    return Observable.create((observer: any) => {\r\n      this.addObserver(streamName, observer);\r\n\r\n      return () => {\r\n        this.removeObserver(streamName, observer);\r\n      };\r\n    });\r\n\r\n    // return this.init().then(() =>  {\r\n    //   this.send({action: 'subscribe', stream: name});\r\n    // });\r\n  }\r\n}\r\n\r\nconst instance = new LiveSrv();\r\nexport { instance as liveSrv };\r\n","import _ from 'lodash';\r\nimport { colors, ansicolor } from '@grafana/ui';\r\n\r\nimport {\r\n  Labels,\r\n  LogLevel,\r\n  DataFrame,\r\n  findCommonLabels,\r\n  findUniqueLabels,\r\n  getLogLevel,\r\n  FieldType,\r\n  getLogLevelFromKey,\r\n  LogRowModel,\r\n  LogsModel,\r\n  LogsMetaItem,\r\n  LogsMetaKind,\r\n  LogsDedupStrategy,\r\n  GraphSeriesXY,\r\n  dateTime,\r\n  toUtc,\r\n  NullValueMode,\r\n  toDataFrame,\r\n  FieldCache,\r\n  FieldWithIndex,\r\n  getFlotPairs,\r\n  TimeZone,\r\n  getDisplayProcessor,\r\n} from '@grafana/data';\r\nimport { getThemeColor } from 'app/core/utils/colors';\r\nimport { hasAnsiCodes } from 'app/core/utils/text';\r\nimport { sortInAscendingOrder, deduplicateLogRowsById } from 'app/core/utils/explore';\r\nimport { getGraphSeriesModel } from 'app/plugins/panel/graph2/getGraphSeriesModel';\r\n\r\nexport const LogLevelColor = {\r\n  [LogLevel.critical]: colors[7],\r\n  [LogLevel.warning]: colors[1],\r\n  [LogLevel.error]: colors[4],\r\n  [LogLevel.info]: colors[0],\r\n  [LogLevel.debug]: colors[5],\r\n  [LogLevel.trace]: colors[2],\r\n  [LogLevel.unknown]: getThemeColor('#8e8e8e', '#dde4ed'),\r\n};\r\n\r\nconst isoDateRegexp = /\\d{4}-[01]\\d-[0-3]\\dT[0-2]\\d:[0-5]\\d:[0-6]\\d[,\\.]\\d+([+-][0-2]\\d:[0-5]\\d|Z)/g;\r\nfunction isDuplicateRow(row: LogRowModel, other: LogRowModel, strategy?: LogsDedupStrategy): boolean {\r\n  switch (strategy) {\r\n    case LogsDedupStrategy.exact:\r\n      // Exact still strips dates\r\n      return row.entry.replace(isoDateRegexp, '') === other.entry.replace(isoDateRegexp, '');\r\n\r\n    case LogsDedupStrategy.numbers:\r\n      return row.entry.replace(/\\d/g, '') === other.entry.replace(/\\d/g, '');\r\n\r\n    case LogsDedupStrategy.signature:\r\n      return row.entry.replace(/\\w/g, '') === other.entry.replace(/\\w/g, '');\r\n\r\n    default:\r\n      return false;\r\n  }\r\n}\r\n\r\nexport function dedupLogRows(rows: LogRowModel[], strategy?: LogsDedupStrategy): LogRowModel[] {\r\n  if (strategy === LogsDedupStrategy.none) {\r\n    return rows;\r\n  }\r\n\r\n  return rows.reduce((result: LogRowModel[], row: LogRowModel, index) => {\r\n    const rowCopy = { ...row };\r\n    const previous = result[result.length - 1];\r\n    if (index > 0 && isDuplicateRow(row, previous, strategy)) {\r\n      previous.duplicates!++;\r\n    } else {\r\n      rowCopy.duplicates = 0;\r\n      result.push(rowCopy);\r\n    }\r\n    return result;\r\n  }, []);\r\n}\r\n\r\nexport function filterLogLevels(logRows: LogRowModel[], hiddenLogLevels: Set<LogLevel>): LogRowModel[] {\r\n  if (hiddenLogLevels.size === 0) {\r\n    return logRows;\r\n  }\r\n\r\n  return logRows.filter((row: LogRowModel) => {\r\n    return !hiddenLogLevels.has(row.logLevel);\r\n  });\r\n}\r\n\r\nexport function makeSeriesForLogs(rows: LogRowModel[], intervalMs: number, timeZone: TimeZone): GraphSeriesXY[] {\r\n  // currently interval is rangeMs / resolution, which is too low for showing series as bars.\r\n  // need at least 10px per bucket, so we multiply interval by 10. Should be solved higher up the chain\r\n  // when executing queries & interval calculated and not here but this is a temporary fix.\r\n  // intervalMs = intervalMs * 10;\r\n\r\n  // Graph time series by log level\r\n  const seriesByLevel: any = {};\r\n  const bucketSize = intervalMs * 10;\r\n  const seriesList: any[] = [];\r\n\r\n  const sortedRows = rows.sort(sortInAscendingOrder);\r\n  for (const row of sortedRows) {\r\n    let series = seriesByLevel[row.logLevel];\r\n\r\n    if (!series) {\r\n      seriesByLevel[row.logLevel] = series = {\r\n        lastTs: null,\r\n        datapoints: [],\r\n        alias: row.logLevel,\r\n        target: row.logLevel,\r\n        color: LogLevelColor[row.logLevel],\r\n      };\r\n\r\n      seriesList.push(series);\r\n    }\r\n\r\n    // align time to bucket size - used Math.floor for calculation as time of the bucket\r\n    // must be in the past (before Date.now()) to be displayed on the graph\r\n    const time = Math.floor(row.timeEpochMs / bucketSize) * bucketSize;\r\n\r\n    // Entry for time\r\n    if (time === series.lastTs) {\r\n      series.datapoints[series.datapoints.length - 1][0]++;\r\n    } else {\r\n      series.datapoints.push([1, time]);\r\n      series.lastTs = time;\r\n    }\r\n\r\n    // add zero to other levels to aid stacking so each level series has same number of points\r\n    for (const other of seriesList) {\r\n      if (other !== series && other.lastTs !== time) {\r\n        other.datapoints.push([0, time]);\r\n        other.lastTs = time;\r\n      }\r\n    }\r\n  }\r\n\r\n  return seriesList.map((series, i) => {\r\n    series.datapoints.sort((a: number[], b: number[]) => {\r\n      return a[1] - b[1];\r\n    });\r\n\r\n    // EEEP: converts GraphSeriesXY to DataFrame and back again!\r\n    const data = toDataFrame(series);\r\n    const points = getFlotPairs({\r\n      xField: data.fields[1],\r\n      yField: data.fields[0],\r\n      nullValueMode: NullValueMode.Null,\r\n    });\r\n\r\n    const timeField = data.fields[1];\r\n    timeField.display = getDisplayProcessor({\r\n      field: timeField,\r\n      timeZone,\r\n    });\r\n\r\n    const valueField = data.fields[0];\r\n    valueField.config = {\r\n      ...valueField.config,\r\n      color: series.color,\r\n    };\r\n\r\n    const graphSeries: GraphSeriesXY = {\r\n      color: series.color,\r\n      label: series.alias,\r\n      data: points,\r\n      isVisible: true,\r\n      yAxis: {\r\n        index: 1,\r\n        min: 0,\r\n        tickDecimals: 0,\r\n      },\r\n      seriesIndex: i,\r\n      timeField,\r\n      valueField,\r\n      // for now setting the time step to be 0,\r\n      // and handle the bar width by setting lineWidth instead of barWidth in flot options\r\n      timeStep: 0,\r\n    };\r\n\r\n    return graphSeries;\r\n  });\r\n}\r\n\r\nfunction isLogsData(series: DataFrame) {\r\n  return series.fields.some(f => f.type === FieldType.time) && series.fields.some(f => f.type === FieldType.string);\r\n}\r\n\r\n/**\r\n * Convert dataFrame into LogsModel which consists of creating separate array of log rows and metrics series. Metrics\r\n * series can be either already included in the dataFrame or will be computed from the log rows.\r\n * @param dataFrame\r\n * @param intervalMs In case there are no metrics series, we use this for computing it from log rows.\r\n */\r\nexport function dataFrameToLogsModel(dataFrame: DataFrame[], intervalMs: number, timeZone: TimeZone): LogsModel {\r\n  const { logSeries, metricSeries } = separateLogsAndMetrics(dataFrame);\r\n  const logsModel = logSeriesToLogsModel(logSeries);\r\n\r\n  if (logsModel) {\r\n    if (metricSeries.length === 0) {\r\n      // Create metrics from logs\r\n      logsModel.series = makeSeriesForLogs(logsModel.rows, intervalMs, timeZone);\r\n    } else {\r\n      // We got metrics in the dataFrame so process those\r\n      logsModel.series = getGraphSeriesModel(\r\n        metricSeries,\r\n        timeZone,\r\n        {},\r\n        { showBars: true, showLines: false, showPoints: false },\r\n        {\r\n          asTable: false,\r\n          isVisible: true,\r\n          placement: 'under',\r\n        }\r\n      );\r\n    }\r\n\r\n    return logsModel;\r\n  }\r\n\r\n  return {\r\n    hasUniqueLabels: false,\r\n    rows: [],\r\n    meta: [],\r\n    series: [],\r\n  };\r\n}\r\n\r\nfunction separateLogsAndMetrics(dataFrame: DataFrame[]) {\r\n  const metricSeries: DataFrame[] = [];\r\n  const logSeries: DataFrame[] = [];\r\n\r\n  for (const series of dataFrame) {\r\n    if (isLogsData(series)) {\r\n      logSeries.push(series);\r\n      continue;\r\n    }\r\n\r\n    metricSeries.push(series);\r\n  }\r\n\r\n  return { logSeries, metricSeries };\r\n}\r\n\r\nconst logTimeFormat = 'YYYY-MM-DD HH:mm:ss';\r\n\r\ninterface LogFields {\r\n  series: DataFrame;\r\n\r\n  timeField: FieldWithIndex;\r\n  stringField: FieldWithIndex;\r\n  logLevelField?: FieldWithIndex;\r\n  idField?: FieldWithIndex;\r\n}\r\n\r\n/**\r\n * Converts dataFrames into LogsModel. This involves merging them into one list, sorting them and computing metadata\r\n * like common labels.\r\n */\r\nexport function logSeriesToLogsModel(logSeries: DataFrame[]): LogsModel | undefined {\r\n  if (logSeries.length === 0) {\r\n    return undefined;\r\n  }\r\n  const allLabels: Labels[] = [];\r\n\r\n  // Find the fields we care about and collect all labels\r\n  const allSeries: LogFields[] = logSeries.map(series => {\r\n    const fieldCache = new FieldCache(series);\r\n\r\n    // Assume the first string field in the dataFrame is the message. This was right so far but probably needs some\r\n    // more explicit checks.\r\n    const stringField = fieldCache.getFirstFieldOfType(FieldType.string);\r\n    if (stringField.labels) {\r\n      allLabels.push(stringField.labels);\r\n    }\r\n    return {\r\n      series,\r\n      timeField: fieldCache.getFirstFieldOfType(FieldType.time),\r\n      stringField,\r\n      logLevelField: fieldCache.getFieldByName('level'),\r\n      idField: getIdField(fieldCache),\r\n    };\r\n  });\r\n\r\n  const commonLabels = allLabels.length > 0 ? findCommonLabels(allLabels) : {};\r\n\r\n  const rows: LogRowModel[] = [];\r\n  let hasUniqueLabels = false;\r\n\r\n  for (const info of allSeries) {\r\n    const { timeField, stringField, logLevelField, idField, series } = info;\r\n    const labels = stringField.labels;\r\n    const uniqueLabels = findUniqueLabels(labels, commonLabels);\r\n    if (Object.keys(uniqueLabels).length > 0) {\r\n      hasUniqueLabels = true;\r\n    }\r\n\r\n    let seriesLogLevel: LogLevel | undefined = undefined;\r\n    if (labels && Object.keys(labels).indexOf('level') !== -1) {\r\n      seriesLogLevel = getLogLevelFromKey(labels['level']);\r\n    }\r\n\r\n    for (let j = 0; j < series.length; j++) {\r\n      const ts = timeField.values.get(j);\r\n      const time = dateTime(ts);\r\n\r\n      const messageValue: unknown = stringField.values.get(j);\r\n      // This should be string but sometimes isn't (eg elastic) because the dataFrame is not strongly typed.\r\n      const message: string = typeof messageValue === 'string' ? messageValue : JSON.stringify(messageValue);\r\n\r\n      const hasAnsi = hasAnsiCodes(message);\r\n      const searchWords = series.meta && series.meta.searchWords ? series.meta.searchWords : [];\r\n\r\n      let logLevel = LogLevel.unknown;\r\n      if (logLevelField) {\r\n        logLevel = getLogLevelFromKey(logLevelField.values.get(j));\r\n      } else if (seriesLogLevel) {\r\n        logLevel = seriesLogLevel;\r\n      } else {\r\n        logLevel = getLogLevel(message);\r\n      }\r\n\r\n      rows.push({\r\n        entryFieldIndex: stringField.index,\r\n        rowIndex: j,\r\n        dataFrame: series,\r\n        logLevel,\r\n        timeFromNow: time.fromNow(),\r\n        timeEpochMs: time.valueOf(),\r\n        timeLocal: time.format(logTimeFormat),\r\n        timeUtc: toUtc(time.valueOf()).format(logTimeFormat),\r\n        uniqueLabels,\r\n        hasAnsi,\r\n        searchWords,\r\n        entry: hasAnsi ? ansicolor.strip(message) : message,\r\n        raw: message,\r\n        labels: stringField.labels,\r\n        uid: idField ? idField.values.get(j) : j.toString(),\r\n      });\r\n    }\r\n  }\r\n\r\n  const deduplicatedLogRows = deduplicateLogRowsById(rows);\r\n\r\n  // Meta data to display in status\r\n  const meta: LogsMetaItem[] = [];\r\n  if (_.size(commonLabels) > 0) {\r\n    meta.push({\r\n      label: 'Common labels',\r\n      value: commonLabels,\r\n      kind: LogsMetaKind.LabelsMap,\r\n    });\r\n  }\r\n\r\n  const limits = logSeries.filter(series => series.meta && series.meta.limit);\r\n\r\n  if (limits.length > 0) {\r\n    meta.push({\r\n      label: 'Limit',\r\n      value: `${limits[0].meta.limit} (${deduplicatedLogRows.length} returned)`,\r\n      kind: LogsMetaKind.String,\r\n    });\r\n  }\r\n\r\n  return {\r\n    hasUniqueLabels,\r\n    meta,\r\n    rows: deduplicatedLogRows,\r\n  };\r\n}\r\n\r\nfunction getIdField(fieldCache: FieldCache): FieldWithIndex | undefined {\r\n  const idFieldNames = ['id'];\r\n  for (const fieldName of idFieldNames) {\r\n    const idField = fieldCache.getFieldByName(fieldName);\r\n    if (idField) {\r\n      return idField;\r\n    }\r\n  }\r\n  return undefined;\r\n}\r\n","import { AnyAction, Dispatch, Store } from 'redux';\r\n\r\nimport { StoreState } from 'app/types/store';\r\nimport { toggleLogActions } from '../reducers/application';\r\n\r\nexport const toggleLogActionsMiddleware = (store: Store<StoreState>) => (next: Dispatch) => (action: AnyAction) => {\r\n  const isLogActionsAction = action.type === toggleLogActions.type;\r\n  if (isLogActionsAction) {\r\n    return next(action);\r\n  }\r\n\r\n  const logActionsTrue =\r\n    window && window.location && window.location.search && window.location.search.indexOf('logActions=true') !== -1;\r\n  const logActionsFalse =\r\n    window && window.location && window.location.search && window.location.search.indexOf('logActions=false') !== -1;\r\n  const logActions = store.getState().application.logActions;\r\n\r\n  if (logActionsTrue && !logActions) {\r\n    store.dispatch(toggleLogActions());\r\n  }\r\n\r\n  if (logActionsFalse && logActions) {\r\n    store.dispatch(toggleLogActions());\r\n  }\r\n\r\n  return next(action);\r\n};\r\n","import coreModule from 'app/core/core_module';\r\nimport config from 'app/core/config';\r\nimport _ from 'lodash';\r\nimport { NavModel } from '@grafana/data';\r\n\r\nexport class NavModelSrv {\r\n  navItems: any;\r\n\r\n  /** @ngInject */\r\n  constructor() {\r\n    this.navItems = config.bootData.navTree;\r\n  }\r\n\r\n  getCfgNode() {\r\n    return _.find(this.navItems, { id: 'cfg' });\r\n  }\r\n\r\n  getNav(...args: Array<string | number>) {\r\n    let children = this.navItems;\r\n    const nav = {\r\n      breadcrumbs: [],\r\n    } as NavModel;\r\n\r\n    for (const id of args) {\r\n      // if its a number then it's the index to use for main\r\n      if (_.isNumber(id)) {\r\n        nav.main = nav.breadcrumbs[id];\r\n        break;\r\n      }\r\n\r\n      const node: any = _.find(children, { id: id });\r\n      nav.breadcrumbs.push(node);\r\n      nav.node = node;\r\n      nav.main = node;\r\n      children = node.children;\r\n    }\r\n\r\n    if (nav.main.children) {\r\n      for (const item of nav.main.children) {\r\n        item.active = false;\r\n\r\n        if (item.url === nav.node.url) {\r\n          item.active = true;\r\n        }\r\n      }\r\n    }\r\n\r\n    return nav;\r\n  }\r\n\r\n  getNotFoundNav() {\r\n    return getNotFoundNav(); // the exported function\r\n  }\r\n}\r\n\r\nexport function getNotFoundNav(): NavModel {\r\n  return getWarningNav('Page not found', '404 Error');\r\n}\r\n\r\nexport function getWarningNav(text: string, subTitle?: string): NavModel {\r\n  const node = {\r\n    text,\r\n    subTitle,\r\n    icon: 'fa fa-fw fa-warning',\r\n  };\r\n  return {\r\n    breadcrumbs: [node],\r\n    node: node,\r\n    main: node,\r\n  };\r\n}\r\n\r\ncoreModule.service('navModelSrv', NavModelSrv);\r\n","let templates = (require as any).context('../', true, /\\.html$/);\ntemplates.keys().forEach((key: string) => {\n  templates(key);\n});\n","import { GrafanaRootScope } from 'app/routes/GrafanaCtrl';\r\n\r\nexport class Profiler {\r\n  panelsRendered: number;\r\n  enabled: boolean;\r\n  $rootScope: GrafanaRootScope;\r\n  window: any;\r\n\r\n  init(config: any, $rootScope: GrafanaRootScope) {\r\n    this.$rootScope = $rootScope;\r\n    this.window = window;\r\n\r\n    if (!this.enabled) {\r\n      return;\r\n    }\r\n  }\r\n\r\n  renderingCompleted() {\r\n    // add render counter to root scope\r\n    // used by phantomjs render.js to know when panel has rendered\r\n    this.panelsRendered = (this.panelsRendered || 0) + 1;\r\n\r\n    // this window variable is used by backend rendering tools to know\r\n    // all panels have completed rendering\r\n    this.window.panelsRendered = this.panelsRendered;\r\n  }\r\n}\r\n\r\nconst profiler = new Profiler();\r\nexport { profiler };\r\n","import { createSlice, PayloadAction } from '@reduxjs/toolkit';\r\nimport { AppNotification, AppNotificationsState } from 'app/types/';\r\n\r\nexport const initialState: AppNotificationsState = {\r\n  appNotifications: [] as AppNotification[],\r\n};\r\n\r\nconst appNotificationsSlice = createSlice({\r\n  name: 'appNotifications',\r\n  initialState,\r\n  reducers: {\r\n    notifyApp: (state, action: PayloadAction<AppNotification>): AppNotificationsState => ({\r\n      ...state,\r\n      appNotifications: state.appNotifications.concat([action.payload]),\r\n    }),\r\n    clearAppNotification: (state, action: PayloadAction<number>): AppNotificationsState => ({\r\n      ...state,\r\n      appNotifications: state.appNotifications.filter(appNotification => appNotification.id !== action.payload),\r\n    }),\r\n  },\r\n});\r\n\r\nexport const { notifyApp, clearAppNotification } = appNotificationsSlice.actions;\r\n\r\nexport const appNotificationsReducer = appNotificationsSlice.reducer;\r\n","import { createSlice } from '@reduxjs/toolkit';\r\nimport { ApplicationState } from 'app/types/application';\r\n\r\nexport const initialState: ApplicationState = {\r\n  logActions: false,\r\n};\r\n\r\nconst applicationSlice = createSlice({\r\n  name: 'application',\r\n  initialState,\r\n  reducers: {\r\n    toggleLogActions: state => ({ ...state, logActions: !state.logActions }),\r\n  },\r\n});\r\n\r\nexport const { toggleLogActions } = applicationSlice.actions;\r\nexport const applicationReducer = applicationSlice.reducer;\r\n","import { navIndexReducer as navIndex } from './navModel';\r\nimport { locationReducer as location } from './location';\r\nimport { appNotificationsReducer as appNotifications } from './appNotification';\r\nimport { applicationReducer as application } from './application';\r\n\r\nexport default {\r\n  navIndex,\r\n  location,\r\n  appNotifications,\r\n  application,\r\n};\r\n","import _ from 'lodash';\r\nimport { Action, createAction } from '@reduxjs/toolkit';\r\nimport { LocationUpdate } from '@grafana/runtime';\r\n\r\nimport { LocationState } from 'app/types';\r\nimport { renderUrl } from 'app/core/utils/url';\r\n\r\nexport const initialState: LocationState = {\r\n  url: '',\r\n  path: '',\r\n  query: {},\r\n  routeParams: {},\r\n  replace: false,\r\n  lastUpdated: 0,\r\n};\r\n\r\nexport const updateLocation = createAction<LocationUpdate>('location/updateLocation');\r\n\r\n// Redux Toolkit uses ImmerJs as part of their solution to ensure that state objects are not mutated.\r\n// ImmerJs has an autoFreeze option that freezes objects from change which means this reducer can't be migrated to createSlice\r\n// because the state would become frozen and during run time we would get errors because Angular would try to mutate\r\n// the frozen state.\r\n// https://github.com/reduxjs/redux-toolkit/issues/242\r\nexport const locationReducer = (state: LocationState = initialState, action: Action<unknown>) => {\r\n  if (updateLocation.match(action)) {\r\n    const payload: LocationUpdate = action.payload;\r\n    const { path, routeParams, replace } = payload;\r\n    let query = payload.query || state.query;\r\n\r\n    if (payload.partial) {\r\n      query = _.defaults(query, state.query);\r\n      query = _.omitBy(query, _.isNull);\r\n    }\r\n\r\n    return {\r\n      url: renderUrl(path || state.path, query),\r\n      path: path || state.path,\r\n      query: { ...query },\r\n      routeParams: routeParams || state.routeParams,\r\n      replace: replace === true,\r\n      lastUpdated: new Date().getTime(),\r\n    };\r\n  }\r\n\r\n  return state;\r\n};\r\n","import { AnyAction, createAction } from '@reduxjs/toolkit';\r\nimport { NavIndex, NavModelItem } from '@grafana/data';\r\n\r\nimport config from 'app/core/config';\r\n\r\nexport function buildInitialState(): NavIndex {\r\n  const navIndex: NavIndex = {};\r\n  const rootNodes = config.bootData.navTree as NavModelItem[];\r\n  buildNavIndex(navIndex, rootNodes);\r\n  return navIndex;\r\n}\r\n\r\nfunction buildNavIndex(navIndex: NavIndex, children: NavModelItem[], parentItem?: NavModelItem) {\r\n  for (const node of children) {\r\n    navIndex[node.id] = {\r\n      ...node,\r\n      parentItem: parentItem,\r\n    };\r\n\r\n    if (node.children) {\r\n      buildNavIndex(navIndex, node.children, node);\r\n    }\r\n  }\r\n}\r\n\r\nexport const initialState: NavIndex = {};\r\n\r\nexport const updateNavIndex = createAction<NavModelItem>('navIndex/updateNavIndex');\r\n\r\n// Redux Toolkit uses ImmerJs as part of their solution to ensure that state objects are not mutated.\r\n// ImmerJs has an autoFreeze option that freezes objects from change which means this reducer can't be migrated to createSlice\r\n// because the state would become frozen and during run time we would get errors because Angular would try to mutate\r\n// the frozen state.\r\n// https://github.com/reduxjs/redux-toolkit/issues/242\r\nexport const navIndexReducer = (state: NavIndex = initialState, action: AnyAction): NavIndex => {\r\n  if (updateNavIndex.match(action)) {\r\n    const newPages: NavIndex = {};\r\n    const payload = action.payload;\r\n\r\n    for (const node of payload.children) {\r\n      newPages[node.id] = {\r\n        ...node,\r\n        parentItem: payload,\r\n      };\r\n    }\r\n\r\n    return { ...state, ...newPages };\r\n  }\r\n\r\n  return state;\r\n};\r\n","import { AnyAction, combineReducers } from 'redux';\r\nimport { CleanUp, cleanUpAction } from '../actions/cleanUp';\r\nimport sharedReducers from 'app/core/reducers';\r\nimport alertingReducers from 'app/features/alerting/state/reducers';\r\nimport teamsReducers from 'app/features/teams/state/reducers';\r\nimport apiKeysReducers from 'app/features/api-keys/state/reducers';\r\nimport foldersReducers from 'app/features/folders/state/reducers';\r\nimport dashboardReducers from 'app/features/dashboard/state/reducers';\r\nimport exploreReducers from 'app/features/explore/state/reducers';\r\nimport pluginReducers from 'app/features/plugins/state/reducers';\r\nimport dataSourcesReducers from 'app/features/datasources/state/reducers';\r\nimport usersReducers from 'app/features/users/state/reducers';\r\nimport userReducers from 'app/features/profile/state/reducers';\r\nimport organizationReducers from 'app/features/org/state/reducers';\r\nimport ldapReducers from 'app/features/admin/state/reducers';\r\n\r\nconst rootReducers = {\r\n  ...sharedReducers,\r\n  ...alertingReducers,\r\n  ...teamsReducers,\r\n  ...apiKeysReducers,\r\n  ...foldersReducers,\r\n  ...dashboardReducers,\r\n  ...exploreReducers,\r\n  ...pluginReducers,\r\n  ...dataSourcesReducers,\r\n  ...usersReducers,\r\n  ...userReducers,\r\n  ...organizationReducers,\r\n  ...ldapReducers,\r\n};\r\n\r\nconst addedReducers = {};\r\n\r\nexport const addReducer = (newReducers: any) => {\r\n  Object.assign(addedReducers, newReducers);\r\n};\r\n\r\nexport const createRootReducer = () => {\r\n  const appReducer = combineReducers({\r\n    ...rootReducers,\r\n    ...addedReducers,\r\n  });\r\n\r\n  return (state: any, action: AnyAction): any => {\r\n    if (action.type !== cleanUpAction.type) {\r\n      return appReducer(state, action);\r\n    }\r\n\r\n    const { stateSelector } = action.payload as CleanUp<any>;\r\n    const stateSlice = stateSelector(state);\r\n    recursiveCleanState(state, stateSlice);\r\n\r\n    return appReducer(state, action);\r\n  };\r\n};\r\n\r\nexport const recursiveCleanState = (state: any, stateSlice: any): boolean => {\r\n  for (const stateKey in state) {\r\n    if (!state.hasOwnProperty(stateKey)) {\r\n      continue;\r\n    }\r\n\r\n    const slice = state[stateKey];\r\n    if (slice === stateSlice) {\r\n      state[stateKey] = undefined;\r\n      return true;\r\n    }\r\n\r\n    if (typeof slice === 'object') {\r\n      const cleaned = recursiveCleanState(slice, stateSlice);\r\n      if (cleaned) {\r\n        return true;\r\n      }\r\n    }\r\n  }\r\n\r\n  return false;\r\n};\r\n","import { LocationState } from 'app/types';\r\n\r\nexport const getRouteParamsId = (state: LocationState) => state.routeParams.id;\r\nexport const getRouteParamsPage = (state: LocationState) => state.routeParams.page;\r\n","import { NavModel, NavModelItem, NavIndex } from '@grafana/data';\r\n\r\nfunction getNotFoundModel(): NavModel {\r\n  const node: NavModelItem = {\r\n    id: 'not-found',\r\n    text: 'Page not found',\r\n    icon: 'fa fa-fw fa-warning',\r\n    subTitle: '404 Error',\r\n    url: 'not-found',\r\n  };\r\n\r\n  return {\r\n    node: node,\r\n    main: node,\r\n  };\r\n}\r\n\r\nexport function getNavModel(navIndex: NavIndex, id: string, fallback?: NavModel): NavModel {\r\n  if (navIndex[id]) {\r\n    const node = navIndex[id];\r\n    const main = {\r\n      ...node.parentItem,\r\n    };\r\n\r\n    main.children = main.children.map(item => {\r\n      return {\r\n        ...item,\r\n        active: item.url === node.url,\r\n      };\r\n    });\r\n\r\n    return {\r\n      node: node,\r\n      main: main,\r\n    };\r\n  }\r\n\r\n  if (fallback) {\r\n    return fallback;\r\n  }\r\n\r\n  return getNotFoundModel();\r\n}\r\n\r\nexport const getTitleFromNavModel = (navModel: NavModel) => {\r\n  return `${navModel.main.text}${navModel.node.text ? ': ' + navModel.node.text : ''}`;\r\n};\r\n","import angular from 'angular';\r\nimport coreModule from 'app/core/core_module';\r\nimport _ from 'lodash';\r\n\r\nimport {\r\n  AngularComponent,\r\n  AngularLoader as AngularLoaderInterface,\r\n  setAngularLoader as setAngularLoaderInterface,\r\n} from '@grafana/runtime';\r\nimport { GrafanaRootScope } from 'app/routes/GrafanaCtrl';\r\n\r\nexport class AngularLoader implements AngularLoaderInterface {\r\n  /** @ngInject */\r\n  constructor(private $compile: any, private $rootScope: GrafanaRootScope) {}\r\n\r\n  load(elem: any, scopeProps: any, template: string): AngularComponent {\r\n    const scope = this.$rootScope.$new();\r\n\r\n    _.assign(scope, scopeProps);\r\n\r\n    const compiledElem = this.$compile(template)(scope);\r\n    const rootNode = angular.element(elem);\r\n    rootNode.append(compiledElem);\r\n\r\n    return {\r\n      destroy: () => {\r\n        scope.$destroy();\r\n        compiledElem.remove();\r\n      },\r\n      digest: () => {\r\n        if (!scope.$$phase) {\r\n          scope.$digest();\r\n        }\r\n      },\r\n      getScope: () => {\r\n        return scope;\r\n      },\r\n    };\r\n  }\r\n}\r\n\r\nexport function setAngularLoader(v: AngularLoader) {\r\n  setAngularLoaderInterface(v);\r\n}\r\n\r\ncoreModule.service('angularLoader', AngularLoader);\r\n","import coreModule from 'app/core/core_module';\r\n\r\nexport class AlertSrv {\r\n  constructor() {}\r\n\r\n  set() {\r\n    console.log('old depricated alert srv being used');\r\n  }\r\n}\r\n\r\n// this is just added to not break old plugins that might be using it\r\ncoreModule.service('alertSrv', AlertSrv);\r\n","import './alert_srv';\r\nimport './util_srv';\r\nimport './context_srv';\r\nimport './timer';\r\nimport './analytics';\r\nimport './popover_srv';\r\nimport './segment_srv';\r\nimport './backend_srv';\r\nimport './dynamic_directive_srv';\r\nimport './bridge_srv';\r\n","import $ from 'jquery';\r\nimport coreModule from 'app/core/core_module';\r\nimport config from 'app/core/config';\r\nimport { GrafanaRootScope } from 'app/routes/GrafanaCtrl';\r\n\r\nexport class Analytics {\r\n  /** @ngInject */\r\n  constructor(private $rootScope: GrafanaRootScope, private $location: any) {}\r\n\r\n  gaInit() {\r\n    $.ajax({\r\n      url: 'https://www.google-analytics.com/analytics.js',\r\n      dataType: 'script',\r\n      cache: true,\r\n    });\r\n    const ga = ((window as any).ga =\r\n      (window as any).ga ||\r\n      //tslint:disable-next-line:only-arrow-functions\r\n      function() {\r\n        (ga.q = ga.q || []).push(arguments);\r\n      });\r\n    ga.l = +new Date();\r\n    ga('create', (config as any).googleAnalyticsId, 'auto');\r\n    ga('set', 'anonymizeIp', true);\r\n    return ga;\r\n  }\r\n\r\n  init() {\r\n    this.$rootScope.$on('$viewContentLoaded', () => {\r\n      const track = { page: this.$location.url() };\r\n      const ga = (window as any).ga || this.gaInit();\r\n      ga('set', track);\r\n      ga('send', 'pageview');\r\n    });\r\n  }\r\n}\r\n\r\n/** @ngInject */\r\nfunction startAnalytics(googleAnalyticsSrv: Analytics) {\r\n  if ((config as any).googleAnalyticsId) {\r\n    googleAnalyticsSrv.init();\r\n  }\r\n}\r\n\r\ncoreModule.service('googleAnalyticsSrv', Analytics).run(startAnalytics);\r\n","import _ from 'lodash';\r\nimport angular from 'angular';\r\nimport coreModule from 'app/core/core_module';\r\nimport appEvents from 'app/core/app_events';\r\nimport config from 'app/core/config';\r\nimport { DashboardModel } from 'app/features/dashboard/state/DashboardModel';\r\nimport { DashboardSearchHit } from 'app/types/search';\r\nimport { ContextSrv } from './context_srv';\r\nimport { FolderInfo, DashboardDTO, CoreEvents } from 'app/types';\r\nimport { BackendSrv as BackendService, getBackendSrv as getBackendService, BackendSrvRequest } from '@grafana/runtime';\r\nimport { AppEvents } from '@grafana/data';\r\n\r\nexport interface DatasourceRequestOptions {\r\n  retry?: number;\r\n  method?: string;\r\n  requestId?: string;\r\n  timeout?: angular.IPromise<any>;\r\n  url?: string;\r\n  headers?: { [key: string]: any };\r\n  silent?: boolean;\r\n  data?: { [key: string]: any };\r\n}\r\n\r\nexport class BackendSrv implements BackendService {\r\n  private inFlightRequests: { [key: string]: Array<angular.IDeferred<any>> } = {};\r\n  private HTTP_REQUEST_CANCELED = -1;\r\n  private noBackendCache: boolean;\r\n\r\n  /** @ngInject */\r\n  constructor(\r\n    private $http: any,\r\n    private $q: angular.IQService,\r\n    private $timeout: angular.ITimeoutService,\r\n    private contextSrv: ContextSrv\r\n  ) {}\r\n\r\n  get(url: string, params?: any) {\r\n    return this.request({ method: 'GET', url, params });\r\n  }\r\n\r\n  delete(url: string) {\r\n    return this.request({ method: 'DELETE', url });\r\n  }\r\n\r\n  post(url: string, data?: any) {\r\n    return this.request({ method: 'POST', url, data });\r\n  }\r\n\r\n  patch(url: string, data: any) {\r\n    return this.request({ method: 'PATCH', url, data });\r\n  }\r\n\r\n  put(url: string, data: any) {\r\n    return this.request({ method: 'PUT', url, data });\r\n  }\r\n\r\n  withNoBackendCache(callback: any) {\r\n    this.noBackendCache = true;\r\n    return callback().finally(() => {\r\n      this.noBackendCache = false;\r\n    });\r\n  }\r\n\r\n  requestErrorHandler(err: any) {\r\n    if (err.isHandled) {\r\n      return;\r\n    }\r\n\r\n    let data = err.data || { message: 'Unexpected error' };\r\n    if (_.isString(data)) {\r\n      data = { message: data };\r\n    }\r\n\r\n    if (err.status === 422) {\r\n      appEvents.emit(AppEvents.alertWarning, ['Validation failed', data.message]);\r\n      throw data;\r\n    }\r\n\r\n    if (data.message) {\r\n      let description = '';\r\n      let message = data.message;\r\n      if (message.length > 80) {\r\n        description = message;\r\n        message = 'Error';\r\n      }\r\n\r\n      appEvents.emit(err.status < 500 ? AppEvents.alertWarning : AppEvents.alertError, [message, description]);\r\n    }\r\n\r\n    throw data;\r\n  }\r\n\r\n  request(options: BackendSrvRequest) {\r\n    options.retry = options.retry || 0;\r\n    const requestIsLocal = !options.url.match(/^http/);\r\n    const firstAttempt = options.retry === 0;\r\n\r\n    if (requestIsLocal) {\r\n      if (this.contextSrv.user && this.contextSrv.user.orgId) {\r\n        options.headers = options.headers || {};\r\n        options.headers['X-Grafana-Org-Id'] = this.contextSrv.user.orgId;\r\n      }\r\n\r\n      if (options.url.indexOf('/') === 0) {\r\n        options.url = options.url.substring(1);\r\n      }\r\n    }\r\n\r\n    return this.$http(options).then(\r\n      (results: any) => {\r\n        if (options.method !== 'GET') {\r\n          if (results && results.data.message) {\r\n            if (options.showSuccessAlert !== false) {\r\n              appEvents.emit(AppEvents.alertSuccess, [results.data.message]);\r\n            }\r\n          }\r\n        }\r\n        return results.data;\r\n      },\r\n      (err: any) => {\r\n        // handle unauthorized\r\n        if (err.status === 401 && this.contextSrv.user.isSignedIn && firstAttempt) {\r\n          return this.loginPing()\r\n            .then(() => {\r\n              options.retry = 1;\r\n              return this.request(options);\r\n            })\r\n            .catch((err: any) => {\r\n              if (err.status === 401) {\r\n                window.location.href = config.appSubUrl + '/logout';\r\n                throw err;\r\n              }\r\n            });\r\n        }\r\n\r\n        this.$timeout(this.requestErrorHandler.bind(this, err), 50);\r\n        throw err;\r\n      }\r\n    );\r\n  }\r\n\r\n  addCanceler(requestId: string, canceler: angular.IDeferred<any>) {\r\n    if (requestId in this.inFlightRequests) {\r\n      this.inFlightRequests[requestId].push(canceler);\r\n    } else {\r\n      this.inFlightRequests[requestId] = [canceler];\r\n    }\r\n  }\r\n\r\n  resolveCancelerIfExists(requestId: string) {\r\n    const cancelers = this.inFlightRequests[requestId];\r\n    if (!_.isUndefined(cancelers) && cancelers.length) {\r\n      cancelers[0].resolve();\r\n    }\r\n  }\r\n\r\n  datasourceRequest(options: BackendSrvRequest) {\r\n    let canceler: angular.IDeferred<any> = null;\r\n    options.retry = options.retry || 0;\r\n\r\n    // A requestID is provided by the datasource as a unique identifier for a\r\n    // particular query. If the requestID exists, the promise it is keyed to\r\n    // is canceled, canceling the previous datasource request if it is still\r\n    // in-flight.\r\n    const requestId = options.requestId;\r\n\r\n    if (requestId) {\r\n      this.resolveCancelerIfExists(requestId);\r\n      // create new canceler\r\n      canceler = this.$q.defer();\r\n      options.timeout = canceler.promise;\r\n      this.addCanceler(requestId, canceler);\r\n    }\r\n\r\n    const requestIsLocal = !options.url.match(/^http/);\r\n    const firstAttempt = options.retry === 0;\r\n\r\n    if (requestIsLocal) {\r\n      if (this.contextSrv.user && this.contextSrv.user.orgId) {\r\n        options.headers = options.headers || {};\r\n        options.headers['X-Grafana-Org-Id'] = this.contextSrv.user.orgId;\r\n      }\r\n\r\n      if (options.url.indexOf('/') === 0) {\r\n        options.url = options.url.substring(1);\r\n      }\r\n\r\n      if (options.headers && options.headers.Authorization) {\r\n        options.headers['X-DS-Authorization'] = options.headers.Authorization;\r\n        delete options.headers.Authorization;\r\n      }\r\n\r\n      if (this.noBackendCache) {\r\n        options.headers['X-Grafana-NoCache'] = 'true';\r\n      }\r\n    }\r\n\r\n    return this.$http(options)\r\n      .then((response: any) => {\r\n        if (!options.silent) {\r\n          appEvents.emit(CoreEvents.dsRequestResponse, response);\r\n        }\r\n        return response;\r\n      })\r\n      .catch((err: any) => {\r\n        if (err.status === this.HTTP_REQUEST_CANCELED) {\r\n          throw { err, cancelled: true };\r\n        }\r\n\r\n        // handle unauthorized for backend requests\r\n        if (requestIsLocal && firstAttempt && err.status === 401) {\r\n          return this.loginPing()\r\n            .then(() => {\r\n              options.retry = 1;\r\n              if (canceler) {\r\n                canceler.resolve();\r\n              }\r\n              return this.datasourceRequest(options);\r\n            })\r\n            .catch((err: any) => {\r\n              if (err.status === 401) {\r\n                window.location.href = config.appSubUrl + '/logout';\r\n                throw err;\r\n              }\r\n            });\r\n        }\r\n\r\n        // populate error obj on Internal Error\r\n        if (_.isString(err.data) && err.status === 500) {\r\n          err.data = {\r\n            error: err.statusText,\r\n            response: err.data,\r\n          };\r\n        }\r\n\r\n        // for Prometheus\r\n        if (err.data && !err.data.message && _.isString(err.data.error)) {\r\n          err.data.message = err.data.error;\r\n        }\r\n        if (!options.silent) {\r\n          appEvents.emit(CoreEvents.dsRequestError, err);\r\n        }\r\n        throw err;\r\n      })\r\n      .finally(() => {\r\n        // clean up\r\n        if (options.requestId) {\r\n          this.inFlightRequests[options.requestId].shift();\r\n        }\r\n      });\r\n  }\r\n\r\n  loginPing() {\r\n    return this.request({ url: '/api/login/ping', method: 'GET', retry: 1 });\r\n  }\r\n\r\n  search(query: any): Promise<DashboardSearchHit[]> {\r\n    return this.get('/api/search', query);\r\n  }\r\n\r\n  getDashboardBySlug(slug: string) {\r\n    return this.get(`/api/dashboards/db/${slug}`);\r\n  }\r\n\r\n  getDashboardByUid(uid: string) {\r\n    return this.get(`/api/dashboards/uid/${uid}`);\r\n  }\r\n\r\n  getFolderByUid(uid: string) {\r\n    return this.get(`/api/folders/${uid}`);\r\n  }\r\n\r\n  saveDashboard(\r\n    dash: DashboardModel,\r\n    { message = '', folderId, overwrite = false }: { message?: string; folderId?: number; overwrite?: boolean } = {}\r\n  ) {\r\n    return this.post('/api/dashboards/db/', {\r\n      dashboard: dash,\r\n      folderId,\r\n      overwrite,\r\n      message,\r\n    });\r\n  }\r\n\r\n  createFolder(payload: any) {\r\n    return this.post('/api/folders', payload);\r\n  }\r\n\r\n  deleteFolder(uid: string, showSuccessAlert: boolean) {\r\n    return this.request({ method: 'DELETE', url: `/api/folders/${uid}`, showSuccessAlert: showSuccessAlert === true });\r\n  }\r\n\r\n  deleteDashboard(uid: string, showSuccessAlert: boolean) {\r\n    return this.request({\r\n      method: 'DELETE',\r\n      url: `/api/dashboards/uid/${uid}`,\r\n      showSuccessAlert: showSuccessAlert === true,\r\n    });\r\n  }\r\n\r\n  deleteFoldersAndDashboards(folderUids: string[], dashboardUids: string[]) {\r\n    const tasks = [];\r\n\r\n    for (const folderUid of folderUids) {\r\n      tasks.push(this.createTask(this.deleteFolder.bind(this), true, folderUid, true));\r\n    }\r\n\r\n    for (const dashboardUid of dashboardUids) {\r\n      tasks.push(this.createTask(this.deleteDashboard.bind(this), true, dashboardUid, true));\r\n    }\r\n\r\n    return this.executeInOrder(tasks, []);\r\n  }\r\n\r\n  moveDashboards(dashboardUids: string[], toFolder: FolderInfo) {\r\n    const tasks = [];\r\n\r\n    for (const uid of dashboardUids) {\r\n      tasks.push(this.createTask(this.moveDashboard.bind(this), true, uid, toFolder));\r\n    }\r\n\r\n    return this.executeInOrder(tasks, []).then((result: any) => {\r\n      return {\r\n        totalCount: result.length,\r\n        successCount: _.filter(result, { succeeded: true }).length,\r\n        alreadyInFolderCount: _.filter(result, { alreadyInFolder: true }).length,\r\n      };\r\n    });\r\n  }\r\n\r\n  private moveDashboard(uid: string, toFolder: FolderInfo) {\r\n    const deferred = this.$q.defer();\r\n\r\n    this.getDashboardByUid(uid).then((fullDash: DashboardDTO) => {\r\n      const model = new DashboardModel(fullDash.dashboard, fullDash.meta);\r\n\r\n      if ((!fullDash.meta.folderId && toFolder.id === 0) || fullDash.meta.folderId === toFolder.id) {\r\n        deferred.resolve({ alreadyInFolder: true });\r\n        return;\r\n      }\r\n\r\n      const clone = model.getSaveModelClone();\r\n      const options = {\r\n        folderId: toFolder.id,\r\n        overwrite: false,\r\n      };\r\n\r\n      this.saveDashboard(clone, options)\r\n        .then(() => {\r\n          deferred.resolve({ succeeded: true });\r\n        })\r\n        .catch((err: any) => {\r\n          if (err.data && err.data.status === 'plugin-dashboard') {\r\n            err.isHandled = true;\r\n            options.overwrite = true;\r\n\r\n            this.saveDashboard(clone, options)\r\n              .then(() => {\r\n                deferred.resolve({ succeeded: true });\r\n              })\r\n              .catch((err: any) => {\r\n                deferred.resolve({ succeeded: false });\r\n              });\r\n          } else {\r\n            deferred.resolve({ succeeded: false });\r\n          }\r\n        });\r\n    });\r\n\r\n    return deferred.promise;\r\n  }\r\n\r\n  private createTask(fn: Function, ignoreRejections: boolean, ...args: any[]) {\r\n    return (result: any) => {\r\n      return fn\r\n        .apply(null, args)\r\n        .then((res: any) => {\r\n          return Array.prototype.concat(result, [res]);\r\n        })\r\n        .catch((err: any) => {\r\n          if (ignoreRejections) {\r\n            return result;\r\n          }\r\n\r\n          throw err;\r\n        });\r\n    };\r\n  }\r\n\r\n  private executeInOrder(tasks: any[], initialValue: any[]) {\r\n    return tasks.reduce(this.$q.when, initialValue);\r\n  }\r\n}\r\n\r\ncoreModule.service('backendSrv', BackendSrv);\r\n\r\n// Used for testing and things that really need BackendSrv\r\nexport function getBackendSrv(): BackendSrv {\r\n  return getBackendService() as BackendSrv;\r\n}\r\n","import coreModule from 'app/core/core_module';\r\nimport appEvents from 'app/core/app_events';\r\nimport { store } from 'app/store/store';\r\nimport locationUtil from 'app/core/utils/location_util';\r\nimport { updateLocation } from 'app/core/actions';\r\nimport { ITimeoutService, ILocationService, IWindowService } from 'angular';\r\nimport { CoreEvents } from 'app/types';\r\nimport { GrafanaRootScope } from 'app/routes/GrafanaCtrl';\r\nimport { UrlQueryMap } from '@grafana/runtime';\r\nimport { getDashboardSrv } from 'app/features/dashboard/services/DashboardSrv';\r\nimport { VariableSrv } from 'app/features/templating/all';\r\n\r\n// Services that handles angular -> redux store sync & other react <-> angular sync\r\nexport class BridgeSrv {\r\n  private fullPageReloadRoutes: string[];\r\n  private lastQuery: UrlQueryMap = {};\r\n  private lastPath = '';\r\n\r\n  /** @ngInject */\r\n  constructor(\r\n    private $location: ILocationService,\r\n    private $timeout: ITimeoutService,\r\n    private $window: IWindowService,\r\n    private $rootScope: GrafanaRootScope,\r\n    private $route: any,\r\n    private variableSrv: VariableSrv\r\n  ) {\r\n    this.fullPageReloadRoutes = ['/logout'];\r\n  }\r\n\r\n  init() {\r\n    this.$rootScope.$on('$routeUpdate', (evt, data) => {\r\n      const angularUrl = this.$location.url();\r\n      const state = store.getState();\r\n      if (state.location.url !== angularUrl) {\r\n        store.dispatch(\r\n          updateLocation({\r\n            path: this.$location.path(),\r\n            query: this.$location.search(),\r\n            routeParams: this.$route.current.params,\r\n          })\r\n        );\r\n      }\r\n    });\r\n\r\n    this.$rootScope.$on('$routeChangeSuccess', (evt, data) => {\r\n      store.dispatch(\r\n        updateLocation({\r\n          path: this.$location.path(),\r\n          query: this.$location.search(),\r\n          routeParams: this.$route.current.params,\r\n        })\r\n      );\r\n    });\r\n\r\n    // Listen for changes in redux location -> update angular location\r\n    store.subscribe(() => {\r\n      const state = store.getState();\r\n      const angularUrl = this.$location.url();\r\n      const url = state.location.url;\r\n      if (angularUrl !== url) {\r\n        this.$timeout(() => {\r\n          this.$location.url(url);\r\n          // some state changes should not trigger new browser history\r\n          if (state.location.replace) {\r\n            this.$location.replace();\r\n          }\r\n        });\r\n        console.log('store updating angular $location.url', url);\r\n      }\r\n\r\n      // Check for template variable changes on a dashboard\r\n      if (state.location.path === this.lastPath) {\r\n        const changes = findTemplateVarChanges(state.location.query, this.lastQuery);\r\n        if (changes) {\r\n          const dash = getDashboardSrv().getCurrent();\r\n          if (dash) {\r\n            this.variableSrv.templateVarsChangedInUrl(changes);\r\n          }\r\n        }\r\n        this.lastQuery = state.location.query;\r\n      } else {\r\n        this.lastQuery = {};\r\n      }\r\n      this.lastPath = state.location.path;\r\n    });\r\n\r\n    appEvents.on(CoreEvents.locationChange, payload => {\r\n      const urlWithoutBase = locationUtil.stripBaseFromUrl(payload.href);\r\n      if (this.fullPageReloadRoutes.indexOf(urlWithoutBase) > -1) {\r\n        this.$window.location.href = payload.href;\r\n        return;\r\n      }\r\n\r\n      this.$timeout(() => {\r\n        // A hack to use timeout when we're changing things (in this case the url) from outside of Angular.\r\n        this.$location.url(urlWithoutBase);\r\n      });\r\n    });\r\n  }\r\n}\r\n\r\nexport function findTemplateVarChanges(query: UrlQueryMap, old: UrlQueryMap): UrlQueryMap | undefined {\r\n  let count = 0;\r\n  const changes: UrlQueryMap = {};\r\n  for (const key in query) {\r\n    if (!key.startsWith('var-')) {\r\n      continue;\r\n    }\r\n    if (query[key] !== old[key]) {\r\n      changes[key] = query[key];\r\n      count++;\r\n    }\r\n  }\r\n  for (const key in old) {\r\n    if (!key.startsWith('var-')) {\r\n      continue;\r\n    }\r\n    if (!query[key]) {\r\n      changes[key] = ''; // removed\r\n      count++;\r\n    }\r\n  }\r\n  return count ? changes : undefined;\r\n}\r\n\r\ncoreModule.service('bridgeSrv', BridgeSrv);\r\n","import config from 'app/core/config';\r\nimport _ from 'lodash';\r\nimport coreModule from 'app/core/core_module';\r\n\r\nexport class User {\r\n  id: number;\r\n  isGrafanaAdmin: any;\r\n  isSignedIn: any;\r\n  orgRole: any;\r\n  orgId: number;\r\n  orgName: string;\r\n  login: string;\r\n  orgCount: number;\r\n  timezone: string;\r\n  helpFlags1: number;\r\n  lightTheme: boolean;\r\n  hasEditPermissionInFolders: boolean;\r\n\r\n  constructor() {\r\n    if (config.bootData.user) {\r\n      _.extend(this, config.bootData.user);\r\n    }\r\n  }\r\n}\r\n\r\nexport class ContextSrv {\r\n  pinned: any;\r\n  version: any;\r\n  user: User;\r\n  isSignedIn: any;\r\n  isGrafanaAdmin: any;\r\n  isEditor: any;\r\n  sidemenuSmallBreakpoint = false;\r\n  hasEditPermissionInFolders: boolean;\r\n\r\n  constructor() {\r\n    if (!config.bootData) {\r\n      config.bootData = { user: {}, settings: {} };\r\n    }\r\n\r\n    this.user = new User();\r\n    this.isSignedIn = this.user.isSignedIn;\r\n    this.isGrafanaAdmin = this.user.isGrafanaAdmin;\r\n    this.isEditor = this.hasRole('Editor') || this.hasRole('Admin');\r\n    this.hasEditPermissionInFolders = this.user.hasEditPermissionInFolders;\r\n  }\r\n\r\n  hasRole(role: string) {\r\n    return this.user.orgRole === role;\r\n  }\r\n\r\n  isGrafanaVisible() {\r\n    return !!(document.visibilityState === undefined || document.visibilityState === 'visible');\r\n  }\r\n\r\n  hasAccessToExplore() {\r\n    return (this.isEditor || config.viewersCanEdit) && config.exploreEnabled;\r\n  }\r\n}\r\n\r\nconst contextSrv = new ContextSrv();\r\nexport { contextSrv };\r\n\r\ncoreModule.factory('contextSrv', () => {\r\n  return contextSrv;\r\n});\r\n","import angular from 'angular';\nimport coreModule from '../core_module';\n\nclass DynamicDirectiveSrv {\n  /** @ngInject */\n  constructor(private $compile: angular.ICompileService) {}\n\n  addDirective(element: any, name: string, scope: any) {\n    const child = angular.element(document.createElement(name));\n    this.$compile(child)(scope);\n\n    element.empty();\n    element.append(child);\n  }\n\n  link(scope: any, elem: JQLite, attrs: any, options: any) {\n    const directiveInfo = options.directive(scope);\n    if (!directiveInfo || !directiveInfo.fn) {\n      elem.empty();\n      return;\n    }\n\n    if (!directiveInfo.fn.registered) {\n      coreModule.directive(attrs.$normalize(directiveInfo.name), directiveInfo.fn);\n      directiveInfo.fn.registered = true;\n    }\n\n    this.addDirective(elem, directiveInfo.name, scope);\n  }\n\n  create(options: any) {\n    const directiveDef = {\n      restrict: 'E',\n      scope: options.scope,\n      link: (scope: any, elem: JQLite, attrs: any) => {\n        if (options.watchPath) {\n          let childScope: any = null;\n          scope.$watch(options.watchPath, () => {\n            if (childScope) {\n              childScope.$destroy();\n            }\n            childScope = scope.$new();\n            this.link(childScope, elem, attrs, options);\n          });\n        } else {\n          this.link(scope, elem, attrs, options);\n        }\n      },\n    };\n\n    return directiveDef;\n  }\n}\n\ncoreModule.service('dynamicDirectiveSrv', DynamicDirectiveSrv);\n","import { EchoBackend, EchoMeta, EchoEvent, EchoSrv } from '@grafana/runtime';\r\nimport { contextSrv } from '../context_srv';\r\n\r\ninterface EchoConfig {\r\n  // How often should metrics be reported\r\n  flushInterval: number;\r\n  // Enables debug mode\r\n  debug: boolean;\r\n}\r\n\r\n/**\r\n * Echo is a service for collecting events from Grafana client-app\r\n * It collects events, distributes them across registered backend and flushes once per configured interval\r\n * It's up to the registered backend to decide what to do with a given type of metric\r\n */\r\nexport class Echo implements EchoSrv {\r\n  private config: EchoConfig = {\r\n    flushInterval: 10000, // By default Echo flushes every 10s\r\n    debug: false,\r\n  };\r\n\r\n  private backends: EchoBackend[] = [];\r\n  // meta data added to every event collected\r\n\r\n  constructor(config?: Partial<EchoConfig>) {\r\n    this.config = {\r\n      ...this.config,\r\n      ...config,\r\n    };\r\n    setInterval(this.flush, this.config.flushInterval);\r\n  }\r\n\r\n  logDebug = (...msg: any) => {\r\n    if (this.config.debug) {\r\n      // tslint:disable-next-line\r\n      // console.debug('ECHO:', ...msg);\r\n    }\r\n  };\r\n\r\n  flush = () => {\r\n    for (const backend of this.backends) {\r\n      backend.flush();\r\n    }\r\n  };\r\n\r\n  addBackend = (backend: EchoBackend) => {\r\n    this.logDebug('Adding backend', backend);\r\n    this.backends.push(backend);\r\n  };\r\n\r\n  addEvent = <T extends EchoEvent>(event: Omit<T, 'meta'>, _meta?: {}) => {\r\n    const meta = this.getMeta();\r\n    const _event = {\r\n      ...event,\r\n      meta: {\r\n        ...meta,\r\n        ..._meta,\r\n      },\r\n    };\r\n\r\n    for (const backend of this.backends) {\r\n      if (backend.supportedEvents.length === 0 || backend.supportedEvents.indexOf(_event.type) > -1) {\r\n        backend.addEvent(_event);\r\n      }\r\n    }\r\n\r\n    this.logDebug('Adding event', _event);\r\n  };\r\n\r\n  getMeta = (): EchoMeta => {\r\n    return {\r\n      sessionId: '',\r\n      userId: contextSrv.user.id,\r\n      userLogin: contextSrv.user.login,\r\n      userSignedIn: contextSrv.user.isSignedIn,\r\n      screenSize: {\r\n        width: window.innerWidth,\r\n        height: window.innerHeight,\r\n      },\r\n      windowSize: {\r\n        width: window.screen.width,\r\n        height: window.screen.height,\r\n      },\r\n      userAgent: window.navigator.userAgent,\r\n      ts: new Date().getTime(),\r\n      timeSinceNavigationStart: performance.now(),\r\n      url: window.location.href,\r\n    };\r\n  };\r\n}\r\n","import { getEchoSrv, EchoEventType } from '@grafana/runtime';\r\nimport { PerformanceEvent } from './backends/PerformanceBackend';\r\n\r\nexport const reportPerformance = (metric: string, value: number) => {\r\n  getEchoSrv().addEvent<PerformanceEvent>({\r\n    type: EchoEventType.Performance,\r\n    payload: {\r\n      metricName: metric,\r\n      duration: value,\r\n    },\r\n  });\r\n};\r\n","import { EchoBackend, EchoEvent, EchoEventType } from '@grafana/runtime';\r\n\r\nexport interface PerformanceEventPayload {\r\n  metricName: string;\r\n  duration: number;\r\n}\r\n\r\nexport interface PerformanceEvent extends EchoEvent<EchoEventType.Performance, PerformanceEventPayload> {}\r\n\r\nexport interface PerformanceBackendOptions {\r\n  url?: string;\r\n}\r\n\r\n/**\r\n * Echo's performance metrics consumer\r\n * Reports performance metrics to given url (TODO)\r\n */\r\nexport class PerformanceBackend implements EchoBackend<PerformanceEvent, PerformanceBackendOptions> {\r\n  private buffer: PerformanceEvent[] = [];\r\n  supportedEvents = [EchoEventType.Performance];\r\n\r\n  constructor(public options: PerformanceBackendOptions) {}\r\n\r\n  addEvent = (e: EchoEvent) => {\r\n    this.buffer.push(e);\r\n  };\r\n\r\n  flush = () => {\r\n    if (this.buffer.length === 0) {\r\n      return;\r\n    }\r\n\r\n    const result = {\r\n      metrics: this.buffer,\r\n    };\r\n\r\n    // Currently we don have API for sending the metrics hence loging to console in dev environment\r\n    if (process.env.NODE_ENV === 'development') {\r\n      console.log('PerformanceBackend flushing:', result);\r\n    }\r\n\r\n    this.buffer = [];\r\n\r\n    // TODO: Enable backend request when we have metrics API\r\n    // if (this.options.url) {\r\n    // getBackendSrv().post(this.options.url, result);\r\n    // }\r\n  };\r\n}\r\n","import store from 'app/core/store';\r\nimport _ from 'lodash';\r\nimport config from 'app/core/config';\r\n\r\nexport class ImpressionSrv {\r\n  constructor() {}\r\n\r\n  addDashboardImpression(dashboardId: number) {\r\n    const impressionsKey = this.impressionKey();\r\n    let impressions = [];\r\n    if (store.exists(impressionsKey)) {\r\n      impressions = JSON.parse(store.get(impressionsKey));\r\n      if (!_.isArray(impressions)) {\r\n        impressions = [];\r\n      }\r\n    }\r\n\r\n    impressions = impressions.filter(imp => {\r\n      return dashboardId !== imp;\r\n    });\r\n\r\n    impressions.unshift(dashboardId);\r\n\r\n    if (impressions.length > 50) {\r\n      impressions.pop();\r\n    }\r\n    store.set(impressionsKey, JSON.stringify(impressions));\r\n  }\r\n\r\n  getDashboardOpened() {\r\n    let impressions = store.get(this.impressionKey()) || '[]';\r\n\r\n    impressions = JSON.parse(impressions);\r\n\r\n    impressions = _.filter(impressions, el => {\r\n      return _.isNumber(el);\r\n    });\r\n\r\n    return impressions;\r\n  }\r\n\r\n  impressionKey() {\r\n    return 'dashboard_impressions-' + config.bootData.user.orgId;\r\n  }\r\n}\r\n\r\nconst impressionSrv = new ImpressionSrv();\r\nexport default impressionSrv;\r\n","import _ from 'lodash';\r\n\r\nimport coreModule from 'app/core/core_module';\r\nimport appEvents from 'app/core/app_events';\r\nimport { getExploreUrl } from 'app/core/utils/explore';\r\nimport locationUtil from 'app/core/utils/location_util';\r\nimport { store } from 'app/store/store';\r\nimport { AppEventEmitter, CoreEvents } from 'app/types';\r\n\r\nimport Mousetrap from 'mousetrap';\r\nimport { PanelEvents } from '@grafana/data';\r\nimport 'mousetrap-global-bind';\r\nimport { ContextSrv } from './context_srv';\r\nimport { ILocationService, IRootScopeService, ITimeoutService } from 'angular';\r\nimport { GrafanaRootScope } from 'app/routes/GrafanaCtrl';\r\nimport { getLocationSrv } from '@grafana/runtime';\r\nimport { DashboardModel } from '../../features/dashboard/state';\r\n\r\nexport class KeybindingSrv {\r\n  helpModal: boolean;\r\n  modalOpen = false;\r\n  timepickerOpen = false;\r\n\r\n  /** @ngInject */\r\n  constructor(\r\n    private $rootScope: GrafanaRootScope,\r\n    private $location: ILocationService,\r\n    private $timeout: ITimeoutService,\r\n    private datasourceSrv: any,\r\n    private timeSrv: any,\r\n    private contextSrv: ContextSrv\r\n  ) {\r\n    // clear out all shortcuts on route change\r\n    $rootScope.$on('$routeChangeSuccess', () => {\r\n      Mousetrap.reset();\r\n      // rebind global shortcuts\r\n      this.setupGlobal();\r\n    });\r\n\r\n    this.setupGlobal();\r\n    appEvents.on(CoreEvents.showModal, () => (this.modalOpen = true));\r\n    appEvents.on(CoreEvents.timepickerOpen, () => (this.timepickerOpen = true));\r\n    appEvents.on(CoreEvents.timepickerClosed, () => (this.timepickerOpen = false));\r\n  }\r\n\r\n  setupGlobal() {\r\n    if (!(this.$location.path() === '/login')) {\r\n      this.bind(['?', 'h'], this.showHelpModal);\r\n      this.bind('g h', this.goToHome);\r\n      this.bind('g a', this.openAlerting);\r\n      this.bind('g p', this.goToProfile);\r\n      this.bind('s o', this.openSearch);\r\n      this.bind('f', this.openSearch);\r\n      this.bind('esc', this.exit);\r\n      this.bindGlobal('esc', this.globalEsc);\r\n    }\r\n  }\r\n\r\n  globalEsc() {\r\n    const anyDoc = document as any;\r\n    const activeElement = anyDoc.activeElement;\r\n\r\n    // typehead needs to handle it\r\n    const typeaheads = document.querySelectorAll('.slate-typeahead--open');\r\n    if (typeaheads.length > 0) {\r\n      return;\r\n    }\r\n\r\n    // second check if we are in an input we can blur\r\n    if (activeElement && activeElement.blur) {\r\n      if (\r\n        activeElement.nodeName === 'INPUT' ||\r\n        activeElement.nodeName === 'TEXTAREA' ||\r\n        activeElement.hasAttribute('data-slate-editor')\r\n      ) {\r\n        anyDoc.activeElement.blur();\r\n        return;\r\n      }\r\n    }\r\n\r\n    // ok no focused input or editor that should block this, let exist!\r\n    this.exit();\r\n  }\r\n\r\n  openSearch() {\r\n    appEvents.emit(CoreEvents.showDashSearch);\r\n  }\r\n\r\n  openAlerting() {\r\n    this.$location.url('/alerting');\r\n  }\r\n\r\n  goToHome() {\r\n    this.$location.url('/');\r\n  }\r\n\r\n  goToProfile() {\r\n    this.$location.url('/profile');\r\n  }\r\n\r\n  showHelpModal() {\r\n    appEvents.emit(CoreEvents.showModal, { templateHtml: '<help-modal></help-modal>' });\r\n  }\r\n\r\n  exit() {\r\n    appEvents.emit(CoreEvents.hideModal);\r\n\r\n    if (this.modalOpen) {\r\n      this.modalOpen = false;\r\n      return;\r\n    }\r\n\r\n    if (this.timepickerOpen) {\r\n      this.$rootScope.appEvent(CoreEvents.closeTimepicker);\r\n      this.timepickerOpen = false;\r\n      return;\r\n    }\r\n\r\n    // close settings view\r\n    const search = this.$location.search();\r\n    if (search.editview) {\r\n      delete search.editview;\r\n      this.$location.search(search);\r\n      return;\r\n    }\r\n\r\n    if (search.editPanel) {\r\n      delete search.editPanel;\r\n      this.$location.search(search);\r\n      return;\r\n    }\r\n\r\n    if (search.fullscreen) {\r\n      appEvents.emit(PanelEvents.panelChangeView, { fullscreen: false, edit: false });\r\n      return;\r\n    }\r\n\r\n    if (search.kiosk) {\r\n      this.$rootScope.appEvent(CoreEvents.toggleKioskMode, { exit: true });\r\n    }\r\n  }\r\n\r\n  bind(keyArg: string | string[], fn: () => void) {\r\n    Mousetrap.bind(\r\n      keyArg,\r\n      (evt: any) => {\r\n        evt.preventDefault();\r\n        evt.stopPropagation();\r\n        evt.returnValue = false;\r\n        return this.$rootScope.$apply(fn.bind(this));\r\n      },\r\n      'keydown'\r\n    );\r\n  }\r\n\r\n  bindGlobal(keyArg: string, fn: () => void) {\r\n    Mousetrap.bindGlobal(\r\n      keyArg,\r\n      (evt: any) => {\r\n        evt.preventDefault();\r\n        evt.stopPropagation();\r\n        evt.returnValue = false;\r\n        return this.$rootScope.$apply(fn.bind(this));\r\n      },\r\n      'keydown'\r\n    );\r\n  }\r\n\r\n  unbind(keyArg: string, keyType?: string) {\r\n    Mousetrap.unbind(keyArg, keyType);\r\n  }\r\n\r\n  showDashEditView() {\r\n    const search = _.extend(this.$location.search(), { editview: 'settings' });\r\n    this.$location.search(search);\r\n  }\r\n\r\n  setupDashboardBindings(scope: IRootScopeService & AppEventEmitter, dashboard: DashboardModel) {\r\n    this.bind('mod+o', () => {\r\n      dashboard.graphTooltip = (dashboard.graphTooltip + 1) % 3;\r\n      appEvents.emit(CoreEvents.graphHoverClear);\r\n      dashboard.startRefresh();\r\n    });\r\n\r\n    this.bind('mod+s', () => {\r\n      scope.appEvent(CoreEvents.saveDashboard);\r\n    });\r\n\r\n    this.bind('t z', () => {\r\n      scope.appEvent(CoreEvents.zoomOut, 2);\r\n    });\r\n\r\n    this.bind('ctrl+z', () => {\r\n      scope.appEvent(CoreEvents.zoomOut, 2);\r\n    });\r\n\r\n    this.bind('t left', () => {\r\n      scope.appEvent(CoreEvents.shiftTime, -1);\r\n    });\r\n\r\n    this.bind('t right', () => {\r\n      scope.appEvent(CoreEvents.shiftTime, 1);\r\n    });\r\n\r\n    // edit panel\r\n    this.bind('e', () => {\r\n      if (dashboard.canEditPanelById(dashboard.meta.focusPanelId)) {\r\n        appEvents.emit(PanelEvents.panelChangeView, {\r\n          fullscreen: true,\r\n          edit: true,\r\n          panelId: dashboard.meta.focusPanelId,\r\n          toggle: true,\r\n        });\r\n      }\r\n    });\r\n\r\n    // view panel\r\n    this.bind('v', () => {\r\n      if (dashboard.meta.focusPanelId) {\r\n        appEvents.emit(PanelEvents.panelChangeView, {\r\n          fullscreen: true,\r\n          panelId: dashboard.meta.focusPanelId,\r\n          toggle: true,\r\n        });\r\n      }\r\n    });\r\n\r\n    // jump to explore if permissions allow\r\n    if (this.contextSrv.hasAccessToExplore()) {\r\n      this.bind('x', async () => {\r\n        if (dashboard.meta.focusPanelId) {\r\n          const panel = dashboard.getPanelById(dashboard.meta.focusPanelId);\r\n          const datasource = await this.datasourceSrv.get(panel.datasource);\r\n          const url = await getExploreUrl({\r\n            panel,\r\n            panelTargets: panel.targets,\r\n            panelDatasource: datasource,\r\n            datasourceSrv: this.datasourceSrv,\r\n            timeSrv: this.timeSrv,\r\n          });\r\n          const urlWithoutBase = locationUtil.stripBaseFromUrl(url);\r\n\r\n          if (urlWithoutBase) {\r\n            this.$timeout(() => this.$location.url(urlWithoutBase));\r\n          }\r\n        }\r\n      });\r\n    }\r\n\r\n    // delete panel\r\n    this.bind('p r', () => {\r\n      if (dashboard.canEditPanelById(dashboard.meta.focusPanelId)) {\r\n        appEvents.emit(CoreEvents.removePanel, dashboard.meta.focusPanelId);\r\n        dashboard.meta.focusPanelId = 0;\r\n      }\r\n    });\r\n\r\n    // duplicate panel\r\n    this.bind('p d', () => {\r\n      if (dashboard.canEditPanelById(dashboard.meta.focusPanelId)) {\r\n        const panelIndex = dashboard.getPanelInfoById(dashboard.meta.focusPanelId).index;\r\n        dashboard.duplicatePanel(dashboard.panels[panelIndex]);\r\n      }\r\n    });\r\n\r\n    // share panel\r\n    this.bind('p s', () => {\r\n      if (dashboard.meta.focusPanelId) {\r\n        const shareScope: any = scope.$new();\r\n        const panelInfo = dashboard.getPanelInfoById(dashboard.meta.focusPanelId);\r\n        shareScope.panel = panelInfo.panel;\r\n        shareScope.dashboard = dashboard;\r\n\r\n        appEvents.emit(CoreEvents.showModal, {\r\n          src: 'public/app/features/dashboard/components/ShareModal/template.html',\r\n          scope: shareScope,\r\n        });\r\n      }\r\n    });\r\n\r\n    // inspect panel\r\n    this.bind('p i', () => {\r\n      if (dashboard.meta.focusPanelId) {\r\n        getLocationSrv().update({ partial: true, query: { inspect: dashboard.meta.focusPanelId } });\r\n      }\r\n    });\r\n\r\n    // toggle panel legend\r\n    this.bind('p l', () => {\r\n      if (dashboard.meta.focusPanelId) {\r\n        const panelInfo = dashboard.getPanelInfoById(dashboard.meta.focusPanelId);\r\n        if (panelInfo.panel.legend) {\r\n          const panelRef = dashboard.getPanelById(dashboard.meta.focusPanelId);\r\n          panelRef.legend.show = !panelRef.legend.show;\r\n          panelRef.render();\r\n        }\r\n      }\r\n    });\r\n\r\n    // toggle all panel legends\r\n    this.bind('d l', () => {\r\n      dashboard.toggleLegendsForAll();\r\n    });\r\n\r\n    // collapse all rows\r\n    this.bind('d shift+c', () => {\r\n      dashboard.collapseRows();\r\n    });\r\n\r\n    // expand all rows\r\n    this.bind('d shift+e', () => {\r\n      dashboard.expandRows();\r\n    });\r\n\r\n    this.bind('d n', () => {\r\n      this.$location.url('/dashboard/new');\r\n    });\r\n\r\n    this.bind('d r', () => {\r\n      dashboard.startRefresh();\r\n    });\r\n\r\n    this.bind('d s', () => {\r\n      this.showDashEditView();\r\n    });\r\n\r\n    this.bind('d k', () => {\r\n      appEvents.emit(CoreEvents.toggleKioskMode);\r\n    });\r\n\r\n    this.bind('d v', () => {\r\n      appEvents.emit(CoreEvents.toggleViewMode);\r\n    });\r\n\r\n    //Autofit panels\r\n    this.bind('d a', () => {\r\n      // this has to be a full page reload\r\n      const queryParams = store.getState().location.query;\r\n      const newUrlParam = queryParams.autofitpanels ? '' : '&autofitpanels';\r\n      window.location.href = window.location.href + newUrlParam;\r\n    });\r\n  }\r\n}\r\n\r\ncoreModule.service('keybindingSrv', KeybindingSrv);\r\n\r\n/**\r\n * Code below exports the service to react components\r\n */\r\n\r\nlet singletonInstance: KeybindingSrv;\r\n\r\nexport function setKeybindingSrv(instance: KeybindingSrv) {\r\n  singletonInstance = instance;\r\n}\r\n\r\nexport function getKeybindingSrv(): KeybindingSrv {\r\n  return singletonInstance;\r\n}\r\n","//\r\n// This is using ng-react with this PR applied https://github.com/ngReact/ngReact/pull/199\r\n//\r\n\r\n// # ngReact\r\n// ### Use React Components inside of your Angular applications\r\n//\r\n// Composed of\r\n// - reactComponent (generic directive for delegating off to React Components)\r\n// - reactDirective (factory for creating specific directives that correspond to reactComponent directives)\r\n\r\nimport { kebabCase } from 'lodash';\r\nimport React from 'react';\r\nimport ReactDOM from 'react-dom';\r\nimport angular, { auto } from 'angular';\r\n\r\n// get a react component from name (components can be an angular injectable e.g. value, factory or\r\n// available on window\r\nfunction getReactComponent(name: string, $injector: auto.IInjectorService) {\r\n  // if name is a function assume it is component and return it\r\n  if (angular.isFunction(name)) {\r\n    return name;\r\n  }\r\n\r\n  // a React component name must be specified\r\n  if (!name) {\r\n    throw new Error('ReactComponent name attribute must be specified');\r\n  }\r\n\r\n  // ensure the specified React component is accessible, and fail fast if it's not\r\n  let reactComponent;\r\n  try {\r\n    reactComponent = $injector.get(name);\r\n  } catch (e) {}\r\n\r\n  if (!reactComponent) {\r\n    try {\r\n      reactComponent = name.split('.').reduce((current, namePart) => {\r\n        // @ts-ignore\r\n        return current[namePart];\r\n      }, window);\r\n    } catch (e) {}\r\n  }\r\n\r\n  if (!reactComponent) {\r\n    throw Error('Cannot find react component ' + name);\r\n  }\r\n\r\n  return reactComponent;\r\n}\r\n\r\n// wraps a function with scope.$apply, if already applied just return\r\nfunction applied(fn: any, scope: any) {\r\n  if (fn.wrappedInApply) {\r\n    return fn;\r\n  }\r\n  //tslint:disable-next-line:only-arrow-functions\r\n  const wrapped: any = function() {\r\n    const args = arguments;\r\n    const phase = scope.$root.$$phase;\r\n    if (phase === '$apply' || phase === '$digest') {\r\n      return fn.apply(null, args);\r\n    } else {\r\n      return scope.$apply(() => {\r\n        return fn.apply(null, args);\r\n      });\r\n    }\r\n  };\r\n  wrapped.wrappedInApply = true;\r\n  return wrapped;\r\n}\r\n\r\n/**\r\n * wraps functions on obj in scope.$apply\r\n *\r\n * keeps backwards compatibility, as if propsConfig is not passed, it will\r\n * work as before, wrapping all functions and won't wrap only when specified.\r\n *\r\n * @version 0.4.1\r\n * @param obj react component props\r\n * @param scope current scope\r\n * @param propsConfig configuration object for all properties\r\n * @returns {Object} props with the functions wrapped in scope.$apply\r\n */\r\nfunction applyFunctions(obj: any, scope: any, propsConfig?: any): object {\r\n  return Object.keys(obj || {}).reduce((prev, key) => {\r\n    const value = obj[key];\r\n    const config = (propsConfig || {})[key] || {};\r\n    /**\r\n     * wrap functions in a function that ensures they are scope.$applied\r\n     * ensures that when function is called from a React component\r\n     * the Angular digest cycle is run\r\n     */\r\n    // @ts-ignore\r\n    prev[key] = angular.isFunction(value) && config.wrapApply !== false ? applied(value, scope) : value;\r\n\r\n    return prev;\r\n  }, {});\r\n}\r\n\r\n/**\r\n *\r\n * @param watchDepth (value of HTML watch-depth attribute)\r\n * @param scope (angular scope)\r\n *\r\n * Uses the watchDepth attribute to determine how to watch props on scope.\r\n * If watchDepth attribute is NOT reference or collection, watchDepth defaults to deep watching by value\r\n */\r\nfunction watchProps(watchDepth: string, scope: any, watchExpressions: any[], listener: any) {\r\n  const supportsWatchCollection = angular.isFunction(scope.$watchCollection);\r\n  const supportsWatchGroup = angular.isFunction(scope.$watchGroup);\r\n\r\n  const watchGroupExpressions = [];\r\n\r\n  for (const expr of watchExpressions) {\r\n    const actualExpr = getPropExpression(expr);\r\n    const exprWatchDepth = getPropWatchDepth(watchDepth, expr);\r\n\r\n    // ignore empty expressions & expressions with functions\r\n    if (!actualExpr || actualExpr.match(/\\(.*\\)/) || exprWatchDepth === 'one-time') {\r\n      continue;\r\n    }\r\n\r\n    if (exprWatchDepth === 'collection' && supportsWatchCollection) {\r\n      scope.$watchCollection(actualExpr, listener);\r\n    } else if (exprWatchDepth === 'reference' && supportsWatchGroup) {\r\n      watchGroupExpressions.push(actualExpr);\r\n    } else {\r\n      scope.$watch(actualExpr, listener, exprWatchDepth !== 'reference');\r\n    }\r\n  }\r\n\r\n  if (watchDepth === 'one-time') {\r\n    listener();\r\n  }\r\n\r\n  if (watchGroupExpressions.length) {\r\n    scope.$watchGroup(watchGroupExpressions, listener);\r\n  }\r\n}\r\n\r\n// render React component, with scope[attrs.props] being passed in as the component props\r\nfunction renderComponent(component: any, props: object, scope: any, elem: Element[]) {\r\n  scope.$evalAsync(() => {\r\n    ReactDOM.render(React.createElement(component, props), elem[0]);\r\n  });\r\n}\r\n\r\n// get prop name from prop (string or array)\r\nfunction getPropName(prop: any) {\r\n  return Array.isArray(prop) ? prop[0] : prop;\r\n}\r\n\r\n// get prop name from prop (string or array)\r\nfunction getPropConfig(prop: any) {\r\n  return Array.isArray(prop) ? prop[1] : {};\r\n}\r\n\r\n// get prop expression from prop (string or array)\r\nfunction getPropExpression(prop: any) {\r\n  return Array.isArray(prop) ? prop[0] : prop;\r\n}\r\n\r\n/**\r\n * Finds the normalized attribute knowing that React props accept any type of capitalization and it also handles\r\n * kabab case attributes which can be used in case the attribute would also be a standard html attribute and would be\r\n * evaluated by the browser as such.\r\n * @param attrs All attributes of the component.\r\n * @param propName Name of the prop that react component expects.\r\n */\r\nfunction findAttribute(attrs: string, propName: string): string {\r\n  const index = Object.keys(attrs).find(attr => {\r\n    return attr.toLowerCase() === propName.toLowerCase() || attr.toLowerCase() === kebabCase(propName);\r\n  });\r\n  // @ts-ignore\r\n  return attrs[index];\r\n}\r\n\r\n// get watch depth of prop (string or array)\r\nfunction getPropWatchDepth(defaultWatch: string, prop: string | any[]) {\r\n  const customWatchDepth = Array.isArray(prop) && angular.isObject(prop[1]) && prop[1].watchDepth;\r\n  return customWatchDepth || defaultWatch;\r\n}\r\n\r\n// # reactComponent\r\n// Directive that allows React components to be used in Angular templates.\r\n//\r\n// Usage:\r\n//     <react-component name=\"Hello\" props=\"name\"/>\r\n//\r\n// This requires that there exists an injectable or globally available 'Hello' React component.\r\n// The 'props' attribute is optional and is passed to the component.\r\n//\r\n// The following would would create and register the component:\r\n//\r\n//     var module = angular.module('ace.react.components');\r\n//     module.value('Hello', React.createClass({\r\n//         render: function() {\r\n//             return <div>Hello {this.props.name}</div>;\r\n//         }\r\n//     }));\r\n//\r\nconst reactComponent = ($injector: any): any => {\r\n  return {\r\n    restrict: 'E',\r\n    replace: true,\r\n    link: function(scope: any, elem: Element[], attrs: any) {\r\n      const reactComponent = getReactComponent(attrs.name, $injector);\r\n\r\n      const renderMyComponent = () => {\r\n        const scopeProps = scope.$eval(attrs.props);\r\n        const props = applyFunctions(scopeProps, scope);\r\n\r\n        renderComponent(reactComponent, props, scope, elem);\r\n      };\r\n\r\n      // If there are props, re-render when they change\r\n      attrs.props ? watchProps(attrs.watchDepth, scope, [attrs.props], renderMyComponent) : renderMyComponent();\r\n\r\n      // cleanup when scope is destroyed\r\n      scope.$on('$destroy', () => {\r\n        if (!attrs.onScopeDestroy) {\r\n          ReactDOM.unmountComponentAtNode(elem[0]);\r\n        } else {\r\n          scope.$eval(attrs.onScopeDestroy, {\r\n            unmountComponent: ReactDOM.unmountComponentAtNode.bind(this, elem[0]),\r\n          });\r\n        }\r\n      });\r\n    },\r\n  };\r\n};\r\n\r\n// # reactDirective\r\n// Factory function to create directives for React components.\r\n//\r\n// With a component like this:\r\n//\r\n//     var module = angular.module('ace.react.components');\r\n//     module.value('Hello', React.createClass({\r\n//         render: function() {\r\n//             return <div>Hello {this.props.name}</div>;\r\n//         }\r\n//     }));\r\n//\r\n// A directive can be created and registered with:\r\n//\r\n//     module.directive('hello', function(reactDirective) {\r\n//         return reactDirective('Hello', ['name']);\r\n//     });\r\n//\r\n// Where the first argument is the injectable or globally accessible name of the React component\r\n// and the second argument is an array of property names to be watched and passed to the React component\r\n// as props.\r\n//\r\n// This directive can then be used like this:\r\n//\r\n//     <hello name=\"name\"/>\r\n//\r\nconst reactDirective = ($injector: auto.IInjectorService) => {\r\n  return (reactComponentName: string, props: string[], conf: any, injectableProps: any) => {\r\n    const directive = {\r\n      restrict: 'E',\r\n      replace: true,\r\n      link: function(scope: any, elem: Element[], attrs: any) {\r\n        const reactComponent = getReactComponent(reactComponentName, $injector);\r\n\r\n        // if props is not defined, fall back to use the React component's propTypes if present\r\n        props = props || Object.keys(reactComponent.propTypes || {});\r\n\r\n        // for each of the properties, get their scope value and set it to scope.props\r\n        const renderMyComponent = () => {\r\n          let scopeProps: any = {};\r\n          const config: any = {};\r\n\r\n          props.forEach(prop => {\r\n            const propName = getPropName(prop);\r\n            scopeProps[propName] = scope.$eval(findAttribute(attrs, propName));\r\n            config[propName] = getPropConfig(prop);\r\n          });\r\n\r\n          scopeProps = applyFunctions(scopeProps, scope, config);\r\n          scopeProps = angular.extend({}, scopeProps, injectableProps);\r\n          renderComponent(reactComponent, scopeProps, scope, elem);\r\n        };\r\n\r\n        // watch each property name and trigger an update whenever something changes,\r\n        // to update scope.props with new values\r\n        const propExpressions = props.map(prop => {\r\n          return Array.isArray(prop)\r\n            ? [findAttribute(attrs, prop[0]), getPropConfig(prop)]\r\n            : findAttribute(attrs, prop);\r\n        });\r\n\r\n        // If we don't have any props, then our watch statement won't fire.\r\n        props.length ? watchProps(attrs.watchDepth, scope, propExpressions, renderMyComponent) : renderMyComponent();\r\n\r\n        // cleanup when scope is destroyed\r\n        scope.$on('$destroy', () => {\r\n          if (!attrs.onScopeDestroy) {\r\n            ReactDOM.unmountComponentAtNode(elem[0]);\r\n          } else {\r\n            scope.$eval(attrs.onScopeDestroy, {\r\n              unmountComponent: ReactDOM.unmountComponentAtNode.bind(this, elem[0]),\r\n            });\r\n          }\r\n        });\r\n      },\r\n    };\r\n    return angular.extend(directive, conf);\r\n  };\r\n};\r\n\r\nconst ngModule = angular.module('react', []);\r\nngModule.directive('reactComponent', ['$injector', reactComponent]);\r\nngModule.factory('reactDirective', ['$injector', reactDirective]);\r\n","import _ from 'lodash';\r\nimport coreModule from 'app/core/core_module';\r\n// @ts-ignore\r\nimport Drop from 'tether-drop';\r\nimport { GrafanaRootScope } from 'app/routes/GrafanaCtrl';\r\n\r\n/** @ngInject */\r\nfunction popoverSrv(this: any, $compile: any, $rootScope: GrafanaRootScope, $timeout: any) {\r\n  let openDrop: any = null;\r\n\r\n  this.close = () => {\r\n    if (openDrop) {\r\n      openDrop.close();\r\n    }\r\n  };\r\n\r\n  this.show = (options: any) => {\r\n    if (openDrop) {\r\n      openDrop.close();\r\n      openDrop = null;\r\n    }\r\n\r\n    const scope = _.extend($rootScope.$new(true), options.model);\r\n    let drop: any;\r\n\r\n    const cleanUp = () => {\r\n      setTimeout(() => {\r\n        scope.$destroy();\r\n\r\n        if (drop.tether) {\r\n          drop.destroy();\r\n        }\r\n\r\n        if (options.onClose) {\r\n          options.onClose();\r\n        }\r\n      });\r\n\r\n      openDrop = null;\r\n    };\r\n\r\n    scope.dismiss = () => {\r\n      drop.close();\r\n    };\r\n\r\n    const contentElement = document.createElement('div');\r\n    contentElement.innerHTML = options.template;\r\n\r\n    $compile(contentElement)(scope);\r\n\r\n    $timeout(() => {\r\n      drop = new Drop({\r\n        target: options.element,\r\n        content: contentElement,\r\n        position: options.position,\r\n        classes: options.classNames || 'drop-popover',\r\n        openOn: options.openOn,\r\n        hoverCloseDelay: 200,\r\n        tetherOptions: {\r\n          constraints: [{ to: 'scrollParent', attachment: 'together' }],\r\n        },\r\n      });\r\n\r\n      drop.on('close', () => {\r\n        cleanUp();\r\n      });\r\n\r\n      openDrop = drop;\r\n      openDrop.open();\r\n    }, 100);\r\n\r\n    // return close function\r\n    return () => {\r\n      if (drop) {\r\n        drop.close();\r\n      }\r\n    };\r\n  };\r\n}\r\n\r\ncoreModule.service('popoverSrv', popoverSrv);\r\n","import _ from 'lodash';\r\n\r\nimport coreModule from 'app/core/core_module';\r\nimport impressionSrv from 'app/core/services/impression_srv';\r\nimport store from 'app/core/store';\r\nimport { contextSrv } from 'app/core/services/context_srv';\r\nimport { BackendSrv } from './backend_srv';\r\nimport { Section } from '../components/manage_dashboards/manage_dashboards';\r\nimport { DashboardSearchHit } from 'app/types/search';\r\n\r\ninterface Sections {\r\n  [key: string]: Partial<Section>;\r\n}\r\n\r\nexport class SearchSrv {\r\n  recentIsOpen: boolean;\r\n  starredIsOpen: boolean;\r\n\r\n  /** @ngInject */\r\n  constructor(private backendSrv: BackendSrv) {\r\n    this.recentIsOpen = store.getBool('search.sections.recent', true);\r\n    this.starredIsOpen = store.getBool('search.sections.starred', true);\r\n  }\r\n\r\n  private getRecentDashboards(sections: Sections) {\r\n    return this.queryForRecentDashboards().then((result: any[]) => {\r\n      if (result.length > 0) {\r\n        sections['recent'] = {\r\n          title: 'Recent',\r\n          icon: 'fa fa-clock-o',\r\n          score: -1,\r\n          removable: true,\r\n          expanded: this.recentIsOpen,\r\n          toggle: this.toggleRecent.bind(this),\r\n          items: result,\r\n        };\r\n      }\r\n    });\r\n  }\r\n\r\n  private queryForRecentDashboards(): Promise<DashboardSearchHit[]> {\r\n    const dashIds: number[] = _.take(impressionSrv.getDashboardOpened(), 30);\r\n    if (dashIds.length === 0) {\r\n      return Promise.resolve([]);\r\n    }\r\n\r\n    return this.backendSrv.search({ dashboardIds: dashIds }).then(result => {\r\n      return dashIds\r\n        .map(orderId => {\r\n          return _.find(result, { id: orderId });\r\n        })\r\n        .filter(hit => hit && !hit.isStarred);\r\n    });\r\n  }\r\n\r\n  private toggleRecent(section: Section) {\r\n    this.recentIsOpen = section.expanded = !section.expanded;\r\n    store.set('search.sections.recent', this.recentIsOpen);\r\n\r\n    if (!section.expanded || section.items.length) {\r\n      return Promise.resolve(section);\r\n    }\r\n\r\n    return this.queryForRecentDashboards().then(result => {\r\n      section.items = result;\r\n      return Promise.resolve(section);\r\n    });\r\n  }\r\n\r\n  private toggleStarred(section: Section) {\r\n    this.starredIsOpen = section.expanded = !section.expanded;\r\n    store.set('search.sections.starred', this.starredIsOpen);\r\n    return Promise.resolve(section);\r\n  }\r\n\r\n  private getStarred(sections: Sections) {\r\n    if (!contextSrv.isSignedIn) {\r\n      return Promise.resolve();\r\n    }\r\n\r\n    return this.backendSrv.search({ starred: true, limit: 30 }).then(result => {\r\n      if (result.length > 0) {\r\n        sections['starred'] = {\r\n          title: 'Starred',\r\n          icon: 'fa fa-star-o',\r\n          score: -2,\r\n          expanded: this.starredIsOpen,\r\n          toggle: this.toggleStarred.bind(this),\r\n          items: result,\r\n        };\r\n      }\r\n    });\r\n  }\r\n\r\n  search(options: any) {\r\n    const sections: any = {};\r\n    const promises = [];\r\n    const query = _.clone(options);\r\n    const hasFilters =\r\n      options.query ||\r\n      (options.tag && options.tag.length > 0) ||\r\n      options.starred ||\r\n      (options.folderIds && options.folderIds.length > 0);\r\n\r\n    if (!options.skipRecent && !hasFilters) {\r\n      promises.push(this.getRecentDashboards(sections));\r\n    }\r\n\r\n    if (!options.skipStarred && !hasFilters) {\r\n      promises.push(this.getStarred(sections));\r\n    }\r\n\r\n    query.folderIds = query.folderIds || [];\r\n    if (!hasFilters) {\r\n      query.folderIds = [0];\r\n    }\r\n\r\n    promises.push(\r\n      this.backendSrv.search(query).then(results => {\r\n        return this.handleSearchResult(sections, results);\r\n      })\r\n    );\r\n\r\n    return Promise.all(promises).then(() => {\r\n      return _.sortBy(_.values(sections), 'score');\r\n    });\r\n  }\r\n\r\n  private handleSearchResult(sections: Sections, results: DashboardSearchHit[]): any {\r\n    if (results.length === 0) {\r\n      return sections;\r\n    }\r\n\r\n    // create folder index\r\n    for (const hit of results) {\r\n      if (hit.type === 'dash-folder') {\r\n        sections[hit.id] = {\r\n          id: hit.id,\r\n          uid: hit.uid,\r\n          title: hit.title,\r\n          expanded: false,\r\n          items: [],\r\n          toggle: this.toggleFolder.bind(this),\r\n          url: hit.url,\r\n          icon: 'fa fa-folder',\r\n          score: _.keys(sections).length,\r\n        };\r\n      }\r\n    }\r\n\r\n    for (const hit of results) {\r\n      if (hit.type === 'dash-folder') {\r\n        continue;\r\n      }\r\n\r\n      let section = sections[hit.folderId || 0];\r\n      if (!section) {\r\n        if (hit.folderId) {\r\n          section = {\r\n            id: hit.folderId,\r\n            uid: hit.folderUid,\r\n            title: hit.folderTitle,\r\n            url: hit.folderUrl,\r\n            items: [],\r\n            icon: 'fa fa-folder-open',\r\n            toggle: this.toggleFolder.bind(this),\r\n            score: _.keys(sections).length,\r\n          };\r\n        } else {\r\n          section = {\r\n            id: 0,\r\n            title: 'General',\r\n            items: [],\r\n            icon: 'fa fa-folder-open',\r\n            toggle: this.toggleFolder.bind(this),\r\n            score: _.keys(sections).length,\r\n          };\r\n        }\r\n        // add section\r\n        sections[hit.folderId || 0] = section;\r\n      }\r\n\r\n      section.expanded = true;\r\n      section.items.push(hit);\r\n    }\r\n  }\r\n\r\n  private toggleFolder(section: Section) {\r\n    section.expanded = !section.expanded;\r\n    section.icon = section.expanded ? 'fa fa-folder-open' : 'fa fa-folder';\r\n\r\n    if (section.items.length) {\r\n      return Promise.resolve(section);\r\n    }\r\n\r\n    const query = {\r\n      folderIds: [section.id],\r\n    };\r\n\r\n    return this.backendSrv.search(query).then(results => {\r\n      section.items = results;\r\n      return Promise.resolve(section);\r\n    });\r\n  }\r\n\r\n  getDashboardTags() {\r\n    return this.backendSrv.get('/api/dashboards/tags');\r\n  }\r\n}\r\n\r\ncoreModule.service('searchSrv', SearchSrv);\r\n","import _ from 'lodash';\r\nimport coreModule from '../core_module';\r\n\r\n/** @ngInject */\r\nexport function uiSegmentSrv(this: any, $sce: any, templateSrv: any) {\r\n  const self = this;\r\n\r\n  class MetricSegment {\r\n    value: string;\r\n    html: any;\r\n    type: any;\r\n    expandable: boolean;\r\n    text: string;\r\n    cssClass: string;\r\n    fake: boolean;\r\n    custom: boolean;\r\n    selectMode: any;\r\n\r\n    constructor(options: any) {\r\n      if (options === '*' || options.value === '*') {\r\n        this.value = '*';\r\n        this.html = $sce.trustAsHtml('<i class=\"fa fa-asterisk\"><i>');\r\n        this.type = options.type;\r\n        this.expandable = true;\r\n        return;\r\n      }\r\n\r\n      if (_.isString(options)) {\r\n        this.value = options;\r\n        this.html = $sce.trustAsHtml(templateSrv.highlightVariablesAsHtml(this.value));\r\n        return;\r\n      }\r\n\r\n      // temp hack to work around legacy inconsistency in segment model\r\n      this.text = options.value;\r\n\r\n      this.cssClass = options.cssClass;\r\n      this.custom = options.custom;\r\n      this.type = options.type;\r\n      this.fake = options.fake;\r\n      this.value = options.value;\r\n      this.selectMode = options.selectMode;\r\n      this.type = options.type;\r\n      this.expandable = options.expandable;\r\n      this.html = options.html || $sce.trustAsHtml(templateSrv.highlightVariablesAsHtml(this.value));\r\n    }\r\n  }\r\n\r\n  this.getSegmentForValue = function(value: string, fallbackText: string) {\r\n    if (value) {\r\n      return this.newSegment(value);\r\n    } else {\r\n      return this.newSegment({ value: fallbackText, fake: true });\r\n    }\r\n  };\r\n\r\n  this.newSelectMeasurement = () => {\r\n    return new MetricSegment({ value: 'select measurement', fake: true });\r\n  };\r\n\r\n  this.newFake = (text: string, type: string, cssClass: string) => {\r\n    return new MetricSegment({ value: text, fake: true, type: type, cssClass: cssClass });\r\n  };\r\n\r\n  this.newSegment = (options: any) => {\r\n    return new MetricSegment(options);\r\n  };\r\n\r\n  this.newKey = (key: string) => {\r\n    return new MetricSegment({ value: key, type: 'key', cssClass: 'query-segment-key' });\r\n  };\r\n\r\n  this.newKeyValue = (value: string) => {\r\n    return new MetricSegment({ value: value, type: 'value', cssClass: 'query-segment-value' });\r\n  };\r\n\r\n  this.newCondition = (condition: string) => {\r\n    return new MetricSegment({ value: condition, type: 'condition', cssClass: 'query-keyword' });\r\n  };\r\n\r\n  this.newOperator = (op: string) => {\r\n    return new MetricSegment({ value: op, type: 'operator', cssClass: 'query-segment-operator' });\r\n  };\r\n\r\n  this.newOperators = (ops: string[]) => {\r\n    return _.map(ops, op => {\r\n      return new MetricSegment({ value: op, type: 'operator', cssClass: 'query-segment-operator' });\r\n    });\r\n  };\r\n\r\n  this.transformToSegments = (addTemplateVars: boolean, variableTypeFilter: string) => {\r\n    return (results: any[]) => {\r\n      const segments = _.map(results, segment => {\r\n        return self.newSegment({ value: segment.text, expandable: segment.expandable });\r\n      });\r\n\r\n      if (addTemplateVars) {\r\n        _.each(templateSrv.variables, variable => {\r\n          if (variableTypeFilter === void 0 || variableTypeFilter === variable.type) {\r\n            segments.unshift(self.newSegment({ type: 'value', value: '$' + variable.name, expandable: true }));\r\n          }\r\n        });\r\n      }\r\n\r\n      return segments;\r\n    };\r\n  };\r\n\r\n  this.newSelectMetric = () => {\r\n    return new MetricSegment({ value: 'select metric', fake: true });\r\n  };\r\n\r\n  this.newPlusButton = () => {\r\n    return new MetricSegment({\r\n      fake: true,\r\n      html: '<i class=\"fa fa-plus \"></i>',\r\n      type: 'plus-button',\r\n      cssClass: 'query-part',\r\n    });\r\n  };\r\n}\r\n\r\ncoreModule.service('uiSegmentSrv', uiSegmentSrv);\r\n","import _ from 'lodash';\r\nimport coreModule from 'app/core/core_module';\r\nimport { ITimeoutService } from 'angular';\r\n\r\n// This service really just tracks a list of $timeout promises to give us a\r\n// method for canceling them all when we need to\r\nexport class Timer {\r\n  timers: Array<angular.IPromise<any>> = [];\r\n\r\n  /** @ngInject */\r\n  constructor(private $timeout: ITimeoutService) {}\r\n\r\n  register(promise: angular.IPromise<any>) {\r\n    this.timers.push(promise);\r\n    return promise;\r\n  }\r\n\r\n  cancel(promise: angular.IPromise<any>) {\r\n    this.timers = _.without(this.timers, promise);\r\n    this.$timeout.cancel(promise);\r\n  }\r\n\r\n  cancelAll() {\r\n    _.each(this.timers, t => {\r\n      this.$timeout.cancel(t);\r\n    });\r\n    this.timers = [];\r\n  }\r\n}\r\n\r\ncoreModule.service('timer', Timer);\r\n","import { e2e } from '@grafana/e2e';\r\n\r\nimport coreModule from 'app/core/core_module';\r\nimport appEvents from 'app/core/app_events';\r\nimport { CoreEvents } from 'app/types';\r\nimport { GrafanaRootScope } from 'app/routes/GrafanaCtrl';\r\n\r\nexport class UtilSrv {\r\n  modalScope: any;\r\n\r\n  /** @ngInject */\r\n  constructor(private $rootScope: GrafanaRootScope, private $modal: any) {}\r\n\r\n  init() {\r\n    appEvents.on(CoreEvents.showModal, this.showModal.bind(this), this.$rootScope);\r\n    appEvents.on(CoreEvents.hideModal, this.hideModal.bind(this), this.$rootScope);\r\n    appEvents.on(CoreEvents.showConfirmModal, this.showConfirmModal.bind(this), this.$rootScope);\r\n  }\r\n\r\n  hideModal() {\r\n    if (this.modalScope && this.modalScope.dismiss) {\r\n      this.modalScope.dismiss();\r\n    }\r\n  }\r\n\r\n  showModal(options: any) {\r\n    if (this.modalScope && this.modalScope.dismiss) {\r\n      this.modalScope.dismiss();\r\n    }\r\n\r\n    this.modalScope = options.scope;\r\n\r\n    if (options.model) {\r\n      this.modalScope = this.$rootScope.$new();\r\n      this.modalScope.model = options.model;\r\n    } else if (!this.modalScope) {\r\n      this.modalScope = this.$rootScope.$new();\r\n    }\r\n\r\n    const modal = this.$modal({\r\n      modalClass: options.modalClass,\r\n      template: options.src,\r\n      templateHtml: options.templateHtml,\r\n      persist: false,\r\n      show: false,\r\n      scope: this.modalScope,\r\n      keyboard: false,\r\n      backdrop: options.backdrop,\r\n    });\r\n\r\n    Promise.resolve(modal).then(modalEl => {\r\n      modalEl.modal('show');\r\n    });\r\n  }\r\n\r\n  showConfirmModal(payload: any) {\r\n    const scope: any = this.$rootScope.$new();\r\n\r\n    scope.updateConfirmText = (value: any) => {\r\n      scope.confirmTextValid = payload.confirmText.toLowerCase() === value.toLowerCase();\r\n    };\r\n\r\n    scope.title = payload.title;\r\n    scope.text = payload.text;\r\n    scope.text2 = payload.text2;\r\n    scope.text2htmlBind = payload.text2htmlBind;\r\n    scope.confirmText = payload.confirmText;\r\n\r\n    scope.onConfirm = payload.onConfirm;\r\n    scope.onAltAction = payload.onAltAction;\r\n    scope.altActionText = payload.altActionText;\r\n    scope.icon = payload.icon || 'fa-check';\r\n    scope.yesText = payload.yesText || 'Yes';\r\n    scope.noText = payload.noText || 'Cancel';\r\n    scope.confirmTextValid = scope.confirmText ? false : true;\r\n    scope.selectors = e2e.pages.ConfirmModal.selectors;\r\n\r\n    appEvents.emit(CoreEvents.showModal, {\r\n      src: 'public/app/partials/confirm_modal.html',\r\n      scope: scope,\r\n      modalClass: 'confirm-modal',\r\n    });\r\n  }\r\n}\r\n\r\ncoreModule.service('utilSrv', UtilSrv);\r\n","type StoreValue = string | number | boolean | null;\r\n\r\nexport class Store {\r\n  get(key: string) {\r\n    return window.localStorage[key];\r\n  }\r\n\r\n  set(key: string, value: StoreValue) {\r\n    window.localStorage[key] = value;\r\n  }\r\n\r\n  getBool(key: string, def: boolean): boolean {\r\n    if (def !== void 0 && !this.exists(key)) {\r\n      return def;\r\n    }\r\n    return window.localStorage[key] === 'true';\r\n  }\r\n\r\n  getObject(key: string, def?: any) {\r\n    let ret = def;\r\n    if (this.exists(key)) {\r\n      const json = window.localStorage[key];\r\n      try {\r\n        ret = JSON.parse(json);\r\n      } catch (error) {\r\n        console.error(`Error parsing store object: ${key}. Returning default: ${def}. [${error}]`);\r\n      }\r\n    }\r\n    return ret;\r\n  }\r\n\r\n  // Returns true when successfully stored\r\n  setObject(key: string, value: any): boolean {\r\n    let json;\r\n    try {\r\n      json = JSON.stringify(value);\r\n    } catch (error) {\r\n      console.error(`Could not stringify object: ${key}. [${error}]`);\r\n      return false;\r\n    }\r\n    try {\r\n      this.set(key, json);\r\n    } catch (error) {\r\n      // Likely hitting storage quota\r\n      console.error(`Could not save item in localStorage: ${key}. [${error}]`);\r\n      return false;\r\n    }\r\n    return true;\r\n  }\r\n\r\n  exists(key: string) {\r\n    return window.localStorage[key] !== void 0;\r\n  }\r\n\r\n  delete(key: string) {\r\n    window.localStorage.removeItem(key);\r\n  }\r\n}\r\n\r\nconst store = new Store();\r\nexport default store;\r\n","import _ from 'lodash';\r\nimport { Column, TableData } from '@grafana/data';\r\n\r\n/**\r\n * Extends the standard Column class with variables that get\r\n * mutated in the angular table panel.\r\n */\r\ninterface MutableColumn extends Column {\r\n  title?: string;\r\n  sort?: boolean;\r\n  desc?: boolean;\r\n  type?: string;\r\n}\r\n\r\nexport default class TableModel implements TableData {\r\n  columns: MutableColumn[];\r\n  rows: any[];\r\n  type: string;\r\n  columnMap: any;\r\n  refId: string;\r\n\r\n  constructor(table?: any) {\r\n    this.columns = [];\r\n    this.columnMap = {};\r\n    this.rows = [];\r\n    this.type = 'table';\r\n\r\n    if (table) {\r\n      if (table.columns) {\r\n        for (const col of table.columns) {\r\n          this.addColumn(col);\r\n        }\r\n      }\r\n      if (table.rows) {\r\n        for (const row of table.rows) {\r\n          this.addRow(row);\r\n        }\r\n      }\r\n    }\r\n  }\r\n\r\n  sort(options: { col: number; desc: boolean }) {\r\n    if (options.col === null || this.columns.length <= options.col) {\r\n      return;\r\n    }\r\n\r\n    this.rows.sort((a, b) => {\r\n      a = a[options.col];\r\n      b = b[options.col];\r\n      // Sort null or undefined separately from comparable values\r\n      return +(a == null) - +(b == null) || +(a > b) || -(a < b);\r\n    });\r\n\r\n    if (options.desc) {\r\n      this.rows.reverse();\r\n    }\r\n\r\n    this.columns[options.col].sort = true;\r\n    this.columns[options.col].desc = options.desc;\r\n  }\r\n\r\n  addColumn(col: Column) {\r\n    if (!this.columnMap[col.text]) {\r\n      this.columns.push(col);\r\n      this.columnMap[col.text] = col;\r\n    }\r\n  }\r\n\r\n  addRow(row: any[]) {\r\n    this.rows.push(row);\r\n  }\r\n}\r\n\r\n// Returns true if both rows have matching non-empty fields as well as matching\r\n// indexes where one field is empty and the other is not\r\nfunction areRowsMatching(columns: Column[], row: any[], otherRow: any[]) {\r\n  let foundFieldToMatch = false;\r\n  for (let columnIndex = 0; columnIndex < columns.length; columnIndex++) {\r\n    if (row[columnIndex] !== undefined && otherRow[columnIndex] !== undefined) {\r\n      if (row[columnIndex] !== otherRow[columnIndex]) {\r\n        return false;\r\n      }\r\n    } else if (row[columnIndex] === undefined || otherRow[columnIndex] === undefined) {\r\n      foundFieldToMatch = true;\r\n    }\r\n  }\r\n  return foundFieldToMatch;\r\n}\r\n\r\nexport function mergeTablesIntoModel(dst?: TableModel, ...tables: TableModel[]): TableModel {\r\n  const model = dst || new TableModel();\r\n\r\n  if (arguments.length === 1) {\r\n    return model;\r\n  }\r\n  // Single query returns data columns and rows as is\r\n  if (arguments.length === 2) {\r\n    model.columns = tables[0].hasOwnProperty('columns') ? [...tables[0].columns] : [];\r\n    model.rows = tables[0].hasOwnProperty('rows') ? [...tables[0].rows] : [];\r\n    return model;\r\n  }\r\n\r\n  // Filter out any tables that are not of TableData format\r\n  const tableDataTables = tables.filter(table => !!table.columns);\r\n\r\n  // Track column indexes of union: name -> index\r\n  const columnNames: { [key: string]: any } = {};\r\n\r\n  // Union of all non-value columns\r\n  const columnsUnion = tableDataTables.slice().reduce((acc, series) => {\r\n    series.columns.forEach(col => {\r\n      const { text } = col;\r\n      if (columnNames[text] === undefined) {\r\n        columnNames[text] = acc.length;\r\n        acc.push(col);\r\n      }\r\n    });\r\n    return acc;\r\n  }, [] as MutableColumn[]);\r\n\r\n  // Map old column index to union index per series, e.g.,\r\n  // given columnNames {A: 0, B: 1} and\r\n  // data [{columns: [{ text: 'A' }]}, {columns: [{ text: 'B' }]}] => [[0], [1]]\r\n  const columnIndexMapper = tableDataTables.map(series => series.columns.map(col => columnNames[col.text]));\r\n\r\n  // Flatten rows of all series and adjust new column indexes\r\n  const flattenedRows = tableDataTables.reduce((acc, series, seriesIndex) => {\r\n    const mapper = columnIndexMapper[seriesIndex];\r\n    series.rows.forEach(row => {\r\n      const alteredRow: MutableColumn[] = [];\r\n      // Shifting entries according to index mapper\r\n      mapper.forEach((to, from) => {\r\n        alteredRow[to] = row[from];\r\n      });\r\n      acc.push(alteredRow);\r\n    });\r\n    return acc;\r\n  }, [] as MutableColumn[][]);\r\n\r\n  // Merge rows that have same values for columns\r\n  const mergedRows: { [key: string]: any } = {};\r\n\r\n  const compactedRows = flattenedRows.reduce((acc, row, rowIndex) => {\r\n    if (!mergedRows[rowIndex]) {\r\n      // Look from current row onwards\r\n      let offset = rowIndex + 1;\r\n      // More than one row can be merged into current row\r\n      while (offset < flattenedRows.length) {\r\n        // Find next row that could be merged\r\n        const match = _.findIndex(flattenedRows, otherRow => areRowsMatching(columnsUnion, row, otherRow), offset);\r\n        if (match > -1) {\r\n          const matchedRow = flattenedRows[match];\r\n          // Merge values from match into current row if there is a gap in the current row\r\n          for (let columnIndex = 0; columnIndex < columnsUnion.length; columnIndex++) {\r\n            if (row[columnIndex] === undefined && matchedRow[columnIndex] !== undefined) {\r\n              row[columnIndex] = matchedRow[columnIndex];\r\n            }\r\n          }\r\n          // Don't visit this row again\r\n          mergedRows[match] = matchedRow;\r\n          // Keep looking for more rows to merge\r\n          offset = match + 1;\r\n        } else {\r\n          // No match found, stop looking\r\n          break;\r\n        }\r\n      }\r\n      acc.push(row);\r\n    }\r\n    return acc;\r\n  }, [] as MutableColumn[][]);\r\n\r\n  model.columns = columnsUnion;\r\n  model.rows = compactedRows;\r\n  return model;\r\n}\r\n","import { getFlotTickDecimals } from 'app/core/utils/ticks';\r\nimport _ from 'lodash';\r\nimport { getValueFormat, ValueFormatter, stringToJsRegex, DecimalCount, formattedValueToString } from '@grafana/data';\r\n\r\nfunction matchSeriesOverride(aliasOrRegex: string, seriesAlias: string) {\r\n  if (!aliasOrRegex) {\r\n    return false;\r\n  }\r\n\r\n  if (aliasOrRegex[0] === '/') {\r\n    const regex = stringToJsRegex(aliasOrRegex);\r\n    return seriesAlias.match(regex) != null;\r\n  }\r\n\r\n  return aliasOrRegex === seriesAlias;\r\n}\r\n\r\nfunction translateFillOption(fill: number) {\r\n  return fill === 0 ? 0.001 : fill / 10;\r\n}\r\n\r\nfunction getFillGradient(amount: number) {\r\n  if (!amount) {\r\n    return null;\r\n  }\r\n\r\n  return {\r\n    colors: [{ opacity: 0.0 }, { opacity: amount / 10 }],\r\n  };\r\n}\r\n\r\n/**\r\n * Calculate decimals for legend and update values for each series.\r\n * @param data series data\r\n * @param panel\r\n * @param height\r\n */\r\nexport function updateLegendValues(data: TimeSeries[], panel: any, height: number) {\r\n  for (let i = 0; i < data.length; i++) {\r\n    const series = data[i];\r\n    const yaxes = panel.yaxes;\r\n    const seriesYAxis = series.yaxis || 1;\r\n    const axis = yaxes[seriesYAxis - 1];\r\n    const formatter = getValueFormat(axis.format);\r\n\r\n    // decimal override\r\n    if (_.isNumber(panel.decimals)) {\r\n      series.updateLegendValues(formatter, panel.decimals, null);\r\n    } else if (_.isNumber(axis.decimals)) {\r\n      series.updateLegendValues(formatter, axis.decimals + 1, null);\r\n    } else {\r\n      // auto decimals\r\n      // legend and tooltip gets one more decimal precision\r\n      // than graph legend ticks\r\n      const { datamin, datamax } = getDataMinMax(data);\r\n      const { tickDecimals, scaledDecimals } = getFlotTickDecimals(datamin, datamax, axis, height);\r\n      const tickDecimalsPlusOne = (tickDecimals || -1) + 1;\r\n      series.updateLegendValues(formatter, tickDecimalsPlusOne, scaledDecimals + 2);\r\n    }\r\n  }\r\n}\r\n\r\nexport function getDataMinMax(data: TimeSeries[]) {\r\n  let datamin = null;\r\n  let datamax = null;\r\n\r\n  for (const series of data) {\r\n    if (datamax === null || datamax < series.stats.max) {\r\n      datamax = series.stats.max;\r\n    }\r\n    if (datamin === null || datamin > series.stats.min) {\r\n      datamin = series.stats.min;\r\n    }\r\n  }\r\n\r\n  return { datamin, datamax };\r\n}\r\n\r\n/**\r\n * @deprecated: This class should not be used in new panels\r\n *\r\n * Use DataFrame and helpers instead\r\n */\r\nexport default class TimeSeries {\r\n  datapoints: any;\r\n  id: string;\r\n  // Represents index of original data frame in the quey response\r\n  dataFrameIndex: number;\r\n  // Represents index of field in the data frame\r\n  fieldIndex: number;\r\n  label: string;\r\n  alias: string;\r\n  aliasEscaped: string;\r\n  color: string;\r\n  valueFormater: any;\r\n  stats: any;\r\n  legend: boolean;\r\n  hideTooltip: boolean;\r\n  allIsNull: boolean;\r\n  allIsZero: boolean;\r\n  decimals: number;\r\n  scaledDecimals: number;\r\n  hasMsResolution: boolean;\r\n  isOutsideRange: boolean;\r\n\r\n  lines: any;\r\n  hiddenSeries: boolean;\r\n  dashes: any;\r\n  bars: any;\r\n  points: any;\r\n  yaxis: any;\r\n  zindex: any;\r\n  stack: any;\r\n  nullPointMode: any;\r\n  fillBelowTo: any;\r\n  transform: any;\r\n  flotpairs: any;\r\n  unit: any;\r\n\r\n  constructor(opts: any) {\r\n    this.datapoints = opts.datapoints;\r\n    this.label = opts.alias;\r\n    this.id = opts.alias;\r\n    this.alias = opts.alias;\r\n    this.aliasEscaped = _.escape(opts.alias);\r\n    this.color = opts.color;\r\n    this.bars = { fillColor: opts.color };\r\n    this.valueFormater = getValueFormat('none');\r\n    this.stats = {};\r\n    this.legend = true;\r\n    this.unit = opts.unit;\r\n    this.dataFrameIndex = opts.dataFrameIndex;\r\n    this.fieldIndex = opts.fieldIndex;\r\n    this.hasMsResolution = this.isMsResolutionNeeded();\r\n  }\r\n\r\n  applySeriesOverrides(overrides: any[]) {\r\n    this.lines = {};\r\n    this.dashes = {\r\n      dashLength: [],\r\n    };\r\n    this.points = {};\r\n    this.yaxis = 1;\r\n    this.zindex = 0;\r\n    this.nullPointMode = null;\r\n    delete this.stack;\r\n    delete this.bars.show;\r\n\r\n    for (let i = 0; i < overrides.length; i++) {\r\n      const override = overrides[i];\r\n      if (!matchSeriesOverride(override.alias, this.alias)) {\r\n        continue;\r\n      }\r\n      if (override.lines !== void 0) {\r\n        this.lines.show = override.lines;\r\n      }\r\n      if (override.dashes !== void 0) {\r\n        this.dashes.show = override.dashes;\r\n        this.lines.lineWidth = 0;\r\n      }\r\n      if (override.points !== void 0) {\r\n        this.points.show = override.points;\r\n      }\r\n      if (override.bars !== void 0) {\r\n        this.bars.show = override.bars;\r\n      }\r\n      if (override.fill !== void 0) {\r\n        this.lines.fill = translateFillOption(override.fill);\r\n      }\r\n      if (override.fillGradient !== void 0) {\r\n        this.lines.fillColor = getFillGradient(override.fillGradient);\r\n      }\r\n      if (override.stack !== void 0) {\r\n        this.stack = override.stack;\r\n      }\r\n      if (override.linewidth !== void 0) {\r\n        this.lines.lineWidth = this.dashes.show ? 0 : override.linewidth;\r\n        this.dashes.lineWidth = override.linewidth;\r\n      }\r\n      if (override.dashLength !== void 0) {\r\n        this.dashes.dashLength[0] = override.dashLength;\r\n      }\r\n      if (override.spaceLength !== void 0) {\r\n        this.dashes.dashLength[1] = override.spaceLength;\r\n      }\r\n      if (override.nullPointMode !== void 0) {\r\n        this.nullPointMode = override.nullPointMode;\r\n      }\r\n      if (override.pointradius !== void 0) {\r\n        this.points.radius = override.pointradius;\r\n      }\r\n      if (override.steppedLine !== void 0) {\r\n        this.lines.steps = override.steppedLine;\r\n      }\r\n      if (override.zindex !== void 0) {\r\n        this.zindex = override.zindex;\r\n      }\r\n      if (override.fillBelowTo !== void 0) {\r\n        this.fillBelowTo = override.fillBelowTo;\r\n      }\r\n      if (override.color !== void 0) {\r\n        this.setColor(override.color);\r\n      }\r\n      if (override.transform !== void 0) {\r\n        this.transform = override.transform;\r\n      }\r\n      if (override.legend !== void 0) {\r\n        this.legend = override.legend;\r\n      }\r\n      if (override.hideTooltip !== void 0) {\r\n        this.hideTooltip = override.hideTooltip;\r\n      }\r\n\r\n      if (override.yaxis !== void 0) {\r\n        this.yaxis = override.yaxis;\r\n      }\r\n      if (override.hiddenSeries !== void 0) {\r\n        this.hiddenSeries = override.hiddenSeries;\r\n      }\r\n    }\r\n  }\r\n\r\n  getFlotPairs(fillStyle: string) {\r\n    const result = [];\r\n\r\n    this.stats.total = 0;\r\n    this.stats.max = -Number.MAX_VALUE;\r\n    this.stats.min = Number.MAX_VALUE;\r\n    this.stats.logmin = Number.MAX_VALUE;\r\n    this.stats.avg = null;\r\n    this.stats.current = null;\r\n    this.stats.first = null;\r\n    this.stats.delta = 0;\r\n    this.stats.diff = null;\r\n    this.stats.range = null;\r\n    this.stats.timeStep = Number.MAX_VALUE;\r\n    this.allIsNull = true;\r\n    this.allIsZero = true;\r\n\r\n    const ignoreNulls = fillStyle === 'connected';\r\n    const nullAsZero = fillStyle === 'null as zero';\r\n    let currentTime;\r\n    let currentValue;\r\n    let nonNulls = 0;\r\n    let previousTime;\r\n    let previousValue = 0;\r\n    let previousDeltaUp = true;\r\n\r\n    for (let i = 0; i < this.datapoints.length; i++) {\r\n      currentValue = this.datapoints[i][0];\r\n      currentTime = this.datapoints[i][1];\r\n\r\n      // Due to missing values we could have different timeStep all along the series\r\n      // so we have to find the minimum one (could occur with aggregators such as ZimSum)\r\n      if (previousTime !== undefined) {\r\n        const timeStep = currentTime - previousTime;\r\n        if (timeStep < this.stats.timeStep) {\r\n          this.stats.timeStep = timeStep;\r\n        }\r\n      }\r\n      previousTime = currentTime;\r\n\r\n      if (currentValue === null) {\r\n        if (ignoreNulls) {\r\n          continue;\r\n        }\r\n        if (nullAsZero) {\r\n          currentValue = 0;\r\n        }\r\n      }\r\n\r\n      if (currentValue !== null) {\r\n        if (_.isNumber(currentValue)) {\r\n          this.stats.total += currentValue;\r\n          this.allIsNull = false;\r\n          nonNulls++;\r\n        }\r\n\r\n        if (currentValue > this.stats.max) {\r\n          this.stats.max = currentValue;\r\n        }\r\n\r\n        if (currentValue < this.stats.min) {\r\n          this.stats.min = currentValue;\r\n        }\r\n\r\n        if (this.stats.first === null) {\r\n          this.stats.first = currentValue;\r\n        } else {\r\n          if (previousValue > currentValue) {\r\n            // counter reset\r\n            previousDeltaUp = false;\r\n            if (i === this.datapoints.length - 1) {\r\n              // reset on last\r\n              this.stats.delta += currentValue;\r\n            }\r\n          } else {\r\n            if (previousDeltaUp) {\r\n              this.stats.delta += currentValue - previousValue; // normal increment\r\n            } else {\r\n              this.stats.delta += currentValue; // account for counter reset\r\n            }\r\n            previousDeltaUp = true;\r\n          }\r\n        }\r\n        previousValue = currentValue;\r\n\r\n        if (currentValue < this.stats.logmin && currentValue > 0) {\r\n          this.stats.logmin = currentValue;\r\n        }\r\n\r\n        if (currentValue !== 0) {\r\n          this.allIsZero = false;\r\n        }\r\n      }\r\n\r\n      result.push([currentTime, currentValue]);\r\n    }\r\n\r\n    if (this.stats.max === -Number.MAX_VALUE) {\r\n      this.stats.max = null;\r\n    }\r\n    if (this.stats.min === Number.MAX_VALUE) {\r\n      this.stats.min = null;\r\n    }\r\n\r\n    if (result.length && !this.allIsNull) {\r\n      this.stats.avg = this.stats.total / nonNulls;\r\n      this.stats.current = result[result.length - 1][1];\r\n      if (this.stats.current === null && result.length > 1) {\r\n        this.stats.current = result[result.length - 2][1];\r\n      }\r\n    }\r\n    if (this.stats.max !== null && this.stats.min !== null) {\r\n      this.stats.range = this.stats.max - this.stats.min;\r\n    }\r\n    if (this.stats.current !== null && this.stats.first !== null) {\r\n      this.stats.diff = this.stats.current - this.stats.first;\r\n    }\r\n\r\n    this.stats.count = result.length;\r\n    return result;\r\n  }\r\n\r\n  updateLegendValues(formater: ValueFormatter, decimals: DecimalCount, scaledDecimals: DecimalCount) {\r\n    this.valueFormater = formater;\r\n    this.decimals = decimals;\r\n    this.scaledDecimals = scaledDecimals;\r\n  }\r\n\r\n  formatValue(value: number) {\r\n    if (!_.isFinite(value)) {\r\n      value = null; // Prevent NaN formatting\r\n    }\r\n    return formattedValueToString(this.valueFormater(value, this.decimals, this.scaledDecimals));\r\n  }\r\n\r\n  isMsResolutionNeeded() {\r\n    for (let i = 0; i < this.datapoints.length; i++) {\r\n      if (this.datapoints[i][1] !== null && this.datapoints[i][1] !== undefined) {\r\n        const timestamp = this.datapoints[i][1].toString();\r\n        if (timestamp.length === 13 && timestamp % 1000 !== 0) {\r\n          return true;\r\n        }\r\n      }\r\n    }\r\n    return false;\r\n  }\r\n\r\n  hideFromLegend(options: any) {\r\n    if (options.hideEmpty && this.allIsNull) {\r\n      return true;\r\n    }\r\n    // ignore series excluded via override\r\n    if (!this.legend) {\r\n      return true;\r\n    }\r\n\r\n    // ignore zero series\r\n    if (options.hideZero && this.allIsZero) {\r\n      return true;\r\n    }\r\n\r\n    return false;\r\n  }\r\n\r\n  setColor(color: string) {\r\n    this.color = color;\r\n    this.bars.fillColor = color;\r\n  }\r\n}\r\n","import React from 'react';\r\nimport { config, GrafanaBootConfig } from '@grafana/runtime';\r\nimport { ThemeContext, getTheme } from '@grafana/ui';\r\nimport { GrafanaThemeType } from '@grafana/data';\r\n\r\nexport const ConfigContext = React.createContext<GrafanaBootConfig>(config);\r\nexport const ConfigConsumer = ConfigContext.Consumer;\r\n\r\nexport const provideConfig = (component: React.ComponentType<any>) => {\r\n  const ConfigProvider = (props: any) => (\r\n    <ConfigContext.Provider value={config}>{React.createElement(component, { ...props })}</ConfigContext.Provider>\r\n  );\r\n\r\n  return ConfigProvider;\r\n};\r\n\r\nexport const getCurrentThemeName = () =>\r\n  config.bootData.user.lightTheme ? GrafanaThemeType.Light : GrafanaThemeType.Dark;\r\n\r\nexport const getCurrentTheme = () => getTheme(getCurrentThemeName());\r\n\r\nexport const ThemeProvider = ({ children }: { children: React.ReactNode }) => {\r\n  return (\r\n    <ConfigConsumer>\r\n      {config => {\r\n        return <ThemeContext.Provider value={getCurrentTheme()}>{children}</ThemeContext.Provider>;\r\n      }}\r\n    </ConfigConsumer>\r\n  );\r\n};\r\n\r\nexport const provideTheme = (component: React.ComponentType<any>) => {\r\n  return provideConfig((props: any) => <ThemeProvider>{React.createElement(component, { ...props })}</ThemeProvider>);\r\n};\r\n","import React, { PureComponent } from 'react';\r\nimport { getBackendSrv } from '@grafana/runtime';\r\nimport { User, Team } from 'app/types';\r\nimport { config } from 'app/core/config';\r\n\r\nexport interface UserAPI {\r\n  changePassword: (changePassword: ChangePasswordFields) => void;\r\n  updateUserProfile: (profile: ProfileUpdateFields) => void;\r\n  loadUser: () => void;\r\n  loadTeams: () => void;\r\n  loadOrgs: () => void;\r\n  setUserOrg: (org: UserOrg) => void;\r\n}\r\n\r\ninterface LoadingStates {\r\n  changePassword: boolean;\r\n  loadUser: boolean;\r\n  loadTeams: boolean;\r\n  loadOrgs: boolean;\r\n  updateUserProfile: boolean;\r\n  updateUserOrg: boolean;\r\n}\r\n\r\nexport interface ChangePasswordFields {\r\n  oldPassword: string;\r\n  newPassword: string;\r\n  confirmNew: string;\r\n}\r\n\r\nexport interface ProfileUpdateFields {\r\n  name: string;\r\n  email: string;\r\n  login: string;\r\n}\r\n\r\nexport interface UserOrg {\r\n  orgId: number;\r\n  name: string;\r\n  role: string;\r\n}\r\n\r\nexport interface Props {\r\n  userId?: number; // passed, will load user on mount\r\n  children: (api: UserAPI, states: LoadingStates, teams: Team[], orgs: UserOrg[], user?: User) => JSX.Element;\r\n}\r\n\r\nexport interface State {\r\n  user?: User;\r\n  teams: Team[];\r\n  orgs: UserOrg[];\r\n  loadingStates: LoadingStates;\r\n}\r\n\r\nexport class UserProvider extends PureComponent<Props, State> {\r\n  state: State = {\r\n    teams: [] as Team[],\r\n    orgs: [] as UserOrg[],\r\n    loadingStates: {\r\n      changePassword: false,\r\n      loadUser: true,\r\n      loadTeams: false,\r\n      loadOrgs: false,\r\n      updateUserProfile: false,\r\n      updateUserOrg: false,\r\n    },\r\n  };\r\n\r\n  componentWillMount() {\r\n    if (this.props.userId) {\r\n      this.loadUser();\r\n    }\r\n  }\r\n\r\n  changePassword = async (payload: ChangePasswordFields) => {\r\n    this.setState({ loadingStates: { ...this.state.loadingStates, changePassword: true } });\r\n    await getBackendSrv().put('/api/user/password', payload);\r\n    this.setState({ loadingStates: { ...this.state.loadingStates, changePassword: false } });\r\n  };\r\n\r\n  loadUser = async () => {\r\n    this.setState({\r\n      loadingStates: { ...this.state.loadingStates, loadUser: true },\r\n    });\r\n    const user = await getBackendSrv().get('/api/user');\r\n    this.setState({ user, loadingStates: { ...this.state.loadingStates, loadUser: Object.keys(user).length === 0 } });\r\n  };\r\n\r\n  loadTeams = async () => {\r\n    this.setState({\r\n      loadingStates: { ...this.state.loadingStates, loadTeams: true },\r\n    });\r\n    const teams = await getBackendSrv().get('/api/user/teams');\r\n    this.setState({ teams, loadingStates: { ...this.state.loadingStates, loadTeams: false } });\r\n  };\r\n\r\n  loadOrgs = async () => {\r\n    this.setState({\r\n      loadingStates: { ...this.state.loadingStates, loadOrgs: true },\r\n    });\r\n    const orgs = await getBackendSrv().get('/api/user/orgs');\r\n    this.setState({ orgs, loadingStates: { ...this.state.loadingStates, loadOrgs: false } });\r\n  };\r\n\r\n  setUserOrg = async (org: UserOrg) => {\r\n    this.setState({\r\n      loadingStates: { ...this.state.loadingStates, updateUserOrg: true },\r\n    });\r\n    await getBackendSrv()\r\n      .post('/api/user/using/' + org.orgId, {})\r\n      .then(() => {\r\n        window.location.href = config.appSubUrl + '/profile';\r\n      })\r\n      .finally(() => {\r\n        this.setState({ loadingStates: { ...this.state.loadingStates, updateUserOrg: false } });\r\n      });\r\n  };\r\n\r\n  updateUserProfile = async (payload: ProfileUpdateFields) => {\r\n    this.setState({ loadingStates: { ...this.state.loadingStates, updateUserProfile: true } });\r\n    await getBackendSrv()\r\n      .put('/api/user', payload)\r\n      .then(() => {\r\n        this.loadUser();\r\n      })\r\n      .catch(e => console.log(e))\r\n      .finally(() => {\r\n        this.setState({ loadingStates: { ...this.state.loadingStates, updateUserProfile: false } });\r\n      });\r\n  };\r\n\r\n  render() {\r\n    const { children } = this.props;\r\n    const { loadingStates, teams, orgs, user } = this.state;\r\n\r\n    const api = {\r\n      changePassword: this.changePassword,\r\n      loadUser: this.loadUser,\r\n      loadTeams: this.loadTeams,\r\n      loadOrgs: this.loadOrgs,\r\n      updateUserProfile: this.updateUserProfile,\r\n      setUserOrg: this.setUserOrg,\r\n    };\r\n\r\n    return <>{children(api, loadingStates, teams, orgs, user)}</>;\r\n  }\r\n}\r\n\r\nexport default UserProvider;\r\n","import { DashboardAcl, DashboardAclDTO } from 'app/types/acl';\r\n\r\nexport function processAclItems(items: DashboardAclDTO[]): DashboardAcl[] {\r\n  return items.map(processAclItem).sort((a, b) => b.sortRank - a.sortRank || a.name.localeCompare(b.name));\r\n}\r\n\r\nfunction processAclItem(dto: DashboardAclDTO): DashboardAcl {\r\n  const item = dto as DashboardAcl;\r\n\r\n  item.sortRank = 0;\r\n  if (item.userId > 0) {\r\n    item.name = item.userLogin;\r\n    item.sortRank = 10;\r\n  } else if (item.teamId > 0) {\r\n    item.name = item.team;\r\n    item.sortRank = 20;\r\n  } else if (item.role) {\r\n    item.icon = 'fa fa-fw fa-street-view';\r\n    item.name = item.role;\r\n    item.sortRank = 30;\r\n    if (item.role === 'Editor') {\r\n      item.sortRank += 1;\r\n    }\r\n  }\r\n\r\n  if (item.inherited) {\r\n    item.sortRank += 100;\r\n  }\r\n\r\n  return item;\r\n}\r\n","// Check to see if browser is not supported by Grafana\r\nexport function checkBrowserCompatibility() {\r\n  const isIE = navigator.userAgent.indexOf('MSIE') > -1;\r\n  const isEdge = navigator.userAgent.indexOf('Edge/') > -1 || navigator.userAgent.indexOf('Edg/') > -1;\r\n  const isFirefox = navigator.userAgent.toLowerCase().indexOf('firefox') > -1;\r\n  const isChrome = /Chrome/.test(navigator.userAgent) && /Google Inc/.test(navigator.vendor);\r\n\r\n  /* Check for\r\n   <= IE11 (Trident 7)\r\n   Edge <= 16\r\n   Firefox <= 64\r\n   Chrome <= 54\r\n  */\r\n  const isEdgeVersion = /Edge\\/([0-9.]+)/.exec(navigator.userAgent);\r\n\r\n  if (isIE && parseFloat(/Trident\\/([0-9.]+)/.exec(navigator.userAgent)[1]) <= 7) {\r\n    return false;\r\n  } else if (\r\n    isEdge &&\r\n    ((isEdgeVersion && parseFloat(isEdgeVersion[1]) <= 16) ||\r\n      parseFloat(/Edg\\/([0-9.]+)/.exec(navigator.userAgent)[1]) <= 16)\r\n  ) {\r\n    return false;\r\n  } else if (isFirefox && parseFloat(/Firefox\\/([0-9.]+)/.exec(navigator.userAgent)[1]) <= 64) {\r\n    return false;\r\n  } else if (isChrome && parseFloat(/Chrome\\/([0-9.]+)/.exec(navigator.userAgent)[1]) <= 54) {\r\n    return false;\r\n  }\r\n\r\n  return true;\r\n}\r\n","import config from 'app/core/config';\n\nexport function getThemeColor(dark: string, light: string): string {\n  return config.bootData.user.lightTheme ? light : dark;\n}\n","import React from 'react';\r\nimport { connect } from 'react-redux';\r\nimport { store } from '../../store/store';\r\n\r\nexport function connectWithStore(WrappedComponent: any, ...args: any[]) {\r\n  const ConnectedWrappedComponent = (connect as any)(...args)(WrappedComponent);\r\n\r\n  return (props: any) => {\r\n    return <ConnectedWrappedComponent {...props} store={store} />;\r\n  };\r\n}\r\n","export class Edge {\r\n  inputNode: Node;\r\n  outputNode: Node;\r\n\r\n  _linkTo(node: Node, direction: number) {\r\n    if (direction <= 0) {\r\n      node.inputEdges.push(this);\r\n    }\r\n\r\n    if (direction >= 0) {\r\n      node.outputEdges.push(this);\r\n    }\r\n\r\n    node.edges.push(this);\r\n  }\r\n\r\n  link(inputNode: Node, outputNode: Node) {\r\n    if (!inputNode) {\r\n      throw Error('inputNode is required');\r\n    }\r\n\r\n    if (!outputNode) {\r\n      throw Error('outputNode is required');\r\n    }\r\n\r\n    this.unlink();\r\n    this.inputNode = inputNode;\r\n    this.outputNode = outputNode;\r\n\r\n    this._linkTo(inputNode, 1);\r\n    this._linkTo(outputNode, -1);\r\n    return this;\r\n  }\r\n\r\n  unlink() {\r\n    let pos;\r\n    const inode = this.inputNode;\r\n    const onode = this.outputNode;\r\n\r\n    if (!(inode && onode)) {\r\n      return;\r\n    }\r\n\r\n    pos = inode.edges.indexOf(this);\r\n    if (pos > -1) {\r\n      inode.edges.splice(pos, 1);\r\n    }\r\n\r\n    pos = onode.edges.indexOf(this);\r\n    if (pos > -1) {\r\n      onode.edges.splice(pos, 1);\r\n    }\r\n\r\n    pos = inode.outputEdges.indexOf(this);\r\n    if (pos > -1) {\r\n      inode.outputEdges.splice(pos, 1);\r\n    }\r\n\r\n    pos = onode.inputEdges.indexOf(this);\r\n    if (pos > -1) {\r\n      onode.inputEdges.splice(pos, 1);\r\n    }\r\n\r\n    this.inputNode = null;\r\n    this.outputNode = null;\r\n  }\r\n}\r\n\r\nexport class Node {\r\n  name: string;\r\n  edges: Edge[];\r\n  inputEdges: Edge[];\r\n  outputEdges: Edge[];\r\n\r\n  constructor(name: string) {\r\n    this.name = name;\r\n    this.edges = [];\r\n    this.inputEdges = [];\r\n    this.outputEdges = [];\r\n  }\r\n\r\n  getEdgeFrom(from: string | Node): Edge {\r\n    if (!from) {\r\n      return null;\r\n    }\r\n\r\n    if (typeof from === 'object') {\r\n      return this.inputEdges.find(e => e.inputNode.name === from.name);\r\n    }\r\n\r\n    return this.inputEdges.find(e => e.inputNode.name === from);\r\n  }\r\n\r\n  getEdgeTo(to: string | Node): Edge {\r\n    if (!to) {\r\n      return null;\r\n    }\r\n\r\n    if (typeof to === 'object') {\r\n      return this.outputEdges.find(e => e.outputNode.name === to.name);\r\n    }\r\n\r\n    return this.outputEdges.find(e => e.outputNode.name === to);\r\n  }\r\n\r\n  getOptimizedInputEdges(): Edge[] {\r\n    const toBeRemoved: any[] = [];\r\n    this.inputEdges.forEach(e => {\r\n      const inputEdgesNodes = e.inputNode.inputEdges.map(e => e.inputNode);\r\n\r\n      inputEdgesNodes.forEach(n => {\r\n        const edgeToRemove = n.getEdgeTo(this.name);\r\n        if (edgeToRemove) {\r\n          toBeRemoved.push(edgeToRemove);\r\n        }\r\n      });\r\n    });\r\n\r\n    return this.inputEdges.filter(e => toBeRemoved.indexOf(e) === -1);\r\n  }\r\n}\r\n\r\nexport class Graph {\r\n  nodes: any = {};\r\n\r\n  constructor() {}\r\n\r\n  createNode(name: string): Node {\r\n    const n = new Node(name);\r\n    this.nodes[name] = n;\r\n    return n;\r\n  }\r\n\r\n  createNodes(names: string[]): Node[] {\r\n    const nodes: Node[] = [];\r\n    names.forEach(name => {\r\n      nodes.push(this.createNode(name));\r\n    });\r\n    return nodes;\r\n  }\r\n\r\n  link(input: string | string[] | Node | Node[], output: string | string[] | Node | Node[]): Edge[] {\r\n    let inputArr = [];\r\n    let outputArr = [];\r\n    const inputNodes: Node[] = [];\r\n    const outputNodes: Node[] = [];\r\n\r\n    if (input instanceof Array) {\r\n      inputArr = input;\r\n    } else {\r\n      inputArr = [input];\r\n    }\r\n\r\n    if (output instanceof Array) {\r\n      outputArr = output;\r\n    } else {\r\n      outputArr = [output];\r\n    }\r\n\r\n    for (let n = 0; n < inputArr.length; n++) {\r\n      const i = inputArr[n];\r\n      if (typeof i === 'string') {\r\n        const n = this.getNode(i);\r\n        if (!n) {\r\n          throw Error(`cannot link input node named ${i} since it doesn't exist in graph`);\r\n        }\r\n        inputNodes.push(n);\r\n      } else {\r\n        inputNodes.push(i);\r\n      }\r\n    }\r\n\r\n    for (let n = 0; n < outputArr.length; n++) {\r\n      const i = outputArr[n];\r\n      if (typeof i === 'string') {\r\n        const n = this.getNode(i);\r\n        if (!n) {\r\n          throw Error(`cannot link output node named ${i} since it doesn't exist in graph`);\r\n        }\r\n        outputNodes.push(n);\r\n      } else {\r\n        outputNodes.push(i);\r\n      }\r\n    }\r\n\r\n    const edges: Edge[] = [];\r\n    inputNodes.forEach(input => {\r\n      outputNodes.forEach(output => {\r\n        edges.push(this.createEdge().link(input, output));\r\n      });\r\n    });\r\n    return edges;\r\n  }\r\n\r\n  createEdge(): Edge {\r\n    return new Edge();\r\n  }\r\n\r\n  getNode(name: string): Node {\r\n    return this.nodes[name];\r\n  }\r\n}\r\n\r\nexport const printGraph = (g: Graph) => {\r\n  Object.keys(g.nodes).forEach(name => {\r\n    const n = g.nodes[name];\r\n    let outputEdges = n.outputEdges.map((e: Edge) => e.outputNode.name).join(', ');\r\n    if (!outputEdges) {\r\n      outputEdges = '<none>';\r\n    }\r\n    let inputEdges = n.inputEdges.map((e: Edge) => e.inputNode.name).join(', ');\r\n    if (!inputEdges) {\r\n      inputEdges = '<none>';\r\n    }\r\n    console.log(`${n.name}:\\n - links to:   ${outputEdges}\\n - links from: ${inputEdges}`);\r\n  });\r\n};\r\n","import { EventEmitter } from 'eventemitter3';\r\nimport { AppEvent } from '@grafana/data';\r\n\r\nexport class Emitter {\r\n  private emitter: EventEmitter;\r\n\r\n  constructor() {\r\n    this.emitter = new EventEmitter();\r\n  }\r\n\r\n  /**\r\n   * DEPRECATED.\r\n   */\r\n  emit(name: string, data?: any): void;\r\n\r\n  /**\r\n   * Emits an `event` with `payload`.\r\n   */\r\n  emit<T extends undefined>(event: AppEvent<T>): void;\r\n  emit<T extends Partial<T> extends T ? Partial<T> : never>(event: AppEvent<T>): void;\r\n  emit<T>(event: AppEvent<T>, payload: T): void;\r\n  emit<T>(event: AppEvent<T> | string, payload?: T | any): void {\r\n    if (typeof event === 'string') {\r\n      console.log(`Using strings as events is deprecated and will be removed in a future version. (${event})`);\r\n      this.emitter.emit(event, payload);\r\n    } else {\r\n      this.emitter.emit(event.name, payload);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * DEPRECATED.\r\n   */\r\n  on(name: string, handler: (payload?: any) => void, scope?: any): void;\r\n\r\n  /**\r\n   * Handles `event` with `handler()` when emitted.\r\n   */\r\n  on<T extends undefined>(event: AppEvent<T>, handler: () => void, scope?: any): void;\r\n  on<T extends Partial<T> extends T ? Partial<T> : never>(event: AppEvent<T>, handler: () => void, scope?: any): void;\r\n  on<T>(event: AppEvent<T>, handler: (payload: T) => void, scope?: any): void;\r\n  on<T>(event: AppEvent<T> | string, handler: (payload?: T | any) => void, scope?: any) {\r\n    if (typeof event === 'string') {\r\n      console.log(`Using strings as events is deprecated and will be removed in a future version. (${event})`);\r\n      this.emitter.on(event, handler);\r\n\r\n      if (scope) {\r\n        const unbind = scope.$on('$destroy', () => {\r\n          this.emitter.off(event, handler);\r\n          unbind();\r\n        });\r\n      }\r\n      return;\r\n    }\r\n\r\n    this.emitter.on(event.name, handler);\r\n\r\n    if (scope) {\r\n      const unbind = scope.$on('$destroy', () => {\r\n        this.emitter.off(event.name, handler);\r\n        unbind();\r\n      });\r\n    }\r\n  }\r\n\r\n  /**\r\n   * DEPRECATED.\r\n   */\r\n  off(name: string, handler: (payload?: any) => void): void;\r\n\r\n  off<T extends undefined>(event: AppEvent<T>, handler: () => void): void;\r\n  off<T extends Partial<T> extends T ? Partial<T> : never>(event: AppEvent<T>, handler: () => void, scope?: any): void;\r\n  off<T>(event: AppEvent<T>, handler: (payload: T) => void): void;\r\n  off<T>(event: AppEvent<T> | string, handler: (payload?: T | any) => void) {\r\n    if (typeof event === 'string') {\r\n      console.log(`Using strings as events is deprecated and will be removed in a future version. (${event})`);\r\n      this.emitter.off(event, handler);\r\n      return;\r\n    }\r\n\r\n    this.emitter.off(event.name, handler);\r\n  }\r\n\r\n  removeAllListeners(evt?: string) {\r\n    this.emitter.removeAllListeners(evt);\r\n  }\r\n\r\n  getEventCount(): number {\r\n    return (this.emitter as any)._eventsCount;\r\n  }\r\n}\r\n","import _ from 'lodash';\r\n\r\nexport function getMessageFromError(err: any): string | null {\r\n  if (err && !_.isString(err)) {\r\n    if (err.message) {\r\n      return err.message;\r\n    } else if (err.data && err.data.message) {\r\n      return err.data.message;\r\n    } else if (err.statusText) {\r\n      return err.statusText;\r\n    } else {\r\n      return JSON.stringify(err);\r\n    }\r\n  }\r\n\r\n  return err;\r\n}\r\n","// Libraries\r\nimport _ from 'lodash';\r\nimport { Unsubscribable } from 'rxjs';\r\n// Services & Utils\r\nimport {\r\n  DataQuery,\r\n  CoreApp,\r\n  DataQueryError,\r\n  DataQueryRequest,\r\n  DataSourceApi,\r\n  dateMath,\r\n  DefaultTimeZone,\r\n  HistoryItem,\r\n  IntervalValues,\r\n  LogRowModel,\r\n  LogsDedupStrategy,\r\n  LogsModel,\r\n  PanelModel,\r\n  RawTimeRange,\r\n  TimeFragment,\r\n  TimeRange,\r\n  TimeZone,\r\n  toUtc,\r\n} from '@grafana/data';\r\nimport { renderUrl } from 'app/core/utils/url';\r\nimport store from 'app/core/store';\r\nimport kbn from 'app/core/utils/kbn';\r\nimport { getNextRefIdChar } from './query';\r\n// Types\r\nimport { RefreshPicker } from '@grafana/ui';\r\nimport { ExploreMode, ExploreUrlState, QueryOptions, QueryTransaction } from 'app/types/explore';\r\nimport { config } from '../config';\r\nimport { TimeSrv } from 'app/features/dashboard/services/TimeSrv';\r\nimport { DataSourceSrv } from '@grafana/runtime';\r\n\r\nexport const DEFAULT_RANGE = {\r\n  from: 'now-1h',\r\n  to: 'now',\r\n};\r\n\r\nexport const DEFAULT_UI_STATE = {\r\n  showingTable: true,\r\n  showingGraph: true,\r\n  showingLogs: true,\r\n  dedupStrategy: LogsDedupStrategy.none,\r\n};\r\n\r\nconst MAX_HISTORY_ITEMS = 100;\r\n\r\nexport const LAST_USED_DATASOURCE_KEY = 'grafana.explore.datasource';\r\nexport const lastUsedDatasourceKeyForOrgId = (orgId: number) => `${LAST_USED_DATASOURCE_KEY}.${orgId}`;\r\n\r\n/**\r\n * Returns an Explore-URL that contains a panel's queries and the dashboard time range.\r\n *\r\n * @param panelTargets The origin panel's query targets\r\n * @param panelDatasource The origin panel's datasource\r\n * @param datasourceSrv Datasource service to query other datasources in case the panel datasource is mixed\r\n * @param timeSrv Time service to get the current dashboard range from\r\n */\r\nexport interface GetExploreUrlArguments {\r\n  panel: PanelModel;\r\n  panelTargets: DataQuery[];\r\n  panelDatasource: DataSourceApi;\r\n  datasourceSrv: DataSourceSrv;\r\n  timeSrv: TimeSrv;\r\n}\r\nexport async function getExploreUrl(args: GetExploreUrlArguments) {\r\n  const { panel, panelTargets, panelDatasource, datasourceSrv, timeSrv } = args;\r\n  let exploreDatasource = panelDatasource;\r\n  let exploreTargets: DataQuery[] = panelTargets;\r\n  let url: string;\r\n\r\n  // Mixed datasources need to choose only one datasource\r\n  if (panelDatasource.meta.id === 'mixed' && exploreTargets) {\r\n    // Find first explore datasource among targets\r\n    for (const t of exploreTargets) {\r\n      const datasource = await datasourceSrv.get(t.datasource);\r\n      if (datasource) {\r\n        exploreDatasource = datasource;\r\n        exploreTargets = panelTargets.filter(t => t.datasource === datasource.name);\r\n        break;\r\n      }\r\n    }\r\n  }\r\n\r\n  if (exploreDatasource) {\r\n    const range = timeSrv.timeRangeForUrl();\r\n    let state: Partial<ExploreUrlState> = { range };\r\n    if (exploreDatasource.interpolateVariablesInQueries) {\r\n      const scopedVars = panel.scopedVars || {};\r\n      state = {\r\n        ...state,\r\n        datasource: exploreDatasource.name,\r\n        context: 'explore',\r\n        queries: exploreDatasource.interpolateVariablesInQueries(exploreTargets, scopedVars),\r\n      };\r\n    } else {\r\n      state = {\r\n        ...state,\r\n        datasource: exploreDatasource.name,\r\n        context: 'explore',\r\n        queries: exploreTargets.map(t => ({ ...t, datasource: exploreDatasource.name })),\r\n      };\r\n    }\r\n\r\n    const exploreState = JSON.stringify({ ...state, originPanelId: panel.id });\r\n    url = renderUrl('/explore', { left: exploreState });\r\n  }\r\n  const finalUrl = config.appSubUrl + url;\r\n  return finalUrl;\r\n}\r\n\r\nexport function buildQueryTransaction(\r\n  queries: DataQuery[],\r\n  queryOptions: QueryOptions,\r\n  range: TimeRange,\r\n  scanning: boolean\r\n): QueryTransaction {\r\n  const configuredQueries = queries.map(query => ({ ...query, ...queryOptions }));\r\n  const key = queries.reduce((combinedKey, query) => {\r\n    combinedKey += query.key;\r\n    return combinedKey;\r\n  }, '');\r\n\r\n  const { interval, intervalMs } = getIntervals(range, queryOptions.minInterval, queryOptions.maxDataPoints);\r\n\r\n  // Most datasource is using `panelId + query.refId` for cancellation logic.\r\n  // Using `format` here because it relates to the view panel that the request is for.\r\n  // However, some datasources don't use `panelId + query.refId`, but only `panelId`.\r\n  // Therefore panel id has to be unique.\r\n  const panelId = `${key}`;\r\n\r\n  const request: DataQueryRequest = {\r\n    app: CoreApp.Explore,\r\n    dashboardId: 0,\r\n    // TODO probably should be taken from preferences but does not seem to be used anyway.\r\n    timezone: DefaultTimeZone,\r\n    startTime: Date.now(),\r\n    interval,\r\n    intervalMs,\r\n    // TODO: the query request expects number and we are using string here. Seems like it works so far but can create\r\n    // issues down the road.\r\n    panelId: panelId as any,\r\n    targets: configuredQueries, // Datasources rely on DataQueries being passed under the targets key.\r\n    range,\r\n    requestId: 'explore',\r\n    rangeRaw: range.raw,\r\n    scopedVars: {\r\n      __interval: { text: interval, value: interval },\r\n      __interval_ms: { text: intervalMs, value: intervalMs },\r\n    },\r\n    maxDataPoints: queryOptions.maxDataPoints,\r\n    exploreMode: queryOptions.mode,\r\n  };\r\n\r\n  return {\r\n    queries,\r\n    request,\r\n    scanning,\r\n    id: generateKey(), // reusing for unique ID\r\n    done: false,\r\n    latency: 0,\r\n  };\r\n}\r\n\r\nexport const clearQueryKeys: (query: DataQuery) => object = ({ key, refId, ...rest }) => rest;\r\n\r\nconst isSegment = (segment: { [key: string]: string }, ...props: string[]) =>\r\n  props.some(prop => segment.hasOwnProperty(prop));\r\n\r\nenum ParseUrlStateIndex {\r\n  RangeFrom = 0,\r\n  RangeTo = 1,\r\n  Datasource = 2,\r\n  SegmentsStart = 3,\r\n}\r\n\r\nenum ParseUiStateIndex {\r\n  Graph = 0,\r\n  Logs = 1,\r\n  Table = 2,\r\n  Strategy = 3,\r\n}\r\n\r\nexport const safeParseJson = (text: string) => {\r\n  if (!text) {\r\n    return;\r\n  }\r\n\r\n  try {\r\n    return JSON.parse(decodeURI(text));\r\n  } catch (error) {\r\n    console.error(error);\r\n  }\r\n};\r\n\r\nexport const safeStringifyValue = (value: any, space?: number) => {\r\n  if (!value) {\r\n    return '';\r\n  }\r\n\r\n  try {\r\n    return JSON.stringify(value, null, space);\r\n  } catch (error) {\r\n    console.error(error);\r\n  }\r\n\r\n  return '';\r\n};\r\n\r\nexport function parseUrlState(initial: string | undefined): ExploreUrlState {\r\n  const parsed = safeParseJson(initial);\r\n  const errorResult: any = {\r\n    datasource: null,\r\n    queries: [],\r\n    range: DEFAULT_RANGE,\r\n    ui: DEFAULT_UI_STATE,\r\n    mode: null,\r\n    originPanelId: null,\r\n  };\r\n\r\n  if (!parsed) {\r\n    return errorResult;\r\n  }\r\n\r\n  if (!Array.isArray(parsed)) {\r\n    return parsed;\r\n  }\r\n\r\n  if (parsed.length <= ParseUrlStateIndex.SegmentsStart) {\r\n    console.error('Error parsing compact URL state for Explore.');\r\n    return errorResult;\r\n  }\r\n\r\n  const range = {\r\n    from: parsed[ParseUrlStateIndex.RangeFrom],\r\n    to: parsed[ParseUrlStateIndex.RangeTo],\r\n  };\r\n  const datasource = parsed[ParseUrlStateIndex.Datasource];\r\n  const parsedSegments = parsed.slice(ParseUrlStateIndex.SegmentsStart);\r\n  const metricProperties = ['expr', 'target', 'datasource', 'query'];\r\n  const queries = parsedSegments.filter(segment => isSegment(segment, ...metricProperties));\r\n  const modeObj = parsedSegments.filter(segment => isSegment(segment, 'mode'))[0];\r\n  const mode = modeObj ? modeObj.mode : ExploreMode.Metrics;\r\n\r\n  const uiState = parsedSegments.filter(segment => isSegment(segment, 'ui'))[0];\r\n  const ui = uiState\r\n    ? {\r\n        showingGraph: uiState.ui[ParseUiStateIndex.Graph],\r\n        showingLogs: uiState.ui[ParseUiStateIndex.Logs],\r\n        showingTable: uiState.ui[ParseUiStateIndex.Table],\r\n        dedupStrategy: uiState.ui[ParseUiStateIndex.Strategy],\r\n      }\r\n    : DEFAULT_UI_STATE;\r\n\r\n  const originPanelId = parsedSegments.filter(segment => isSegment(segment, 'originPanelId'))[0];\r\n  return { datasource, queries, range, ui, mode, originPanelId };\r\n}\r\n\r\nexport function serializeStateToUrlParam(urlState: ExploreUrlState, compact?: boolean): string {\r\n  if (compact) {\r\n    return JSON.stringify([\r\n      urlState.range.from,\r\n      urlState.range.to,\r\n      urlState.datasource,\r\n      ...urlState.queries,\r\n      { mode: urlState.mode },\r\n      {\r\n        ui: [\r\n          !!urlState.ui.showingGraph,\r\n          !!urlState.ui.showingLogs,\r\n          !!urlState.ui.showingTable,\r\n          urlState.ui.dedupStrategy,\r\n        ],\r\n      },\r\n    ]);\r\n  }\r\n  return JSON.stringify(urlState);\r\n}\r\n\r\nexport function generateKey(index = 0): string {\r\n  return `Q-${Date.now()}-${Math.random()}-${index}`;\r\n}\r\n\r\nexport function generateEmptyQuery(queries: DataQuery[], index = 0): DataQuery {\r\n  return { refId: getNextRefIdChar(queries), key: generateKey(index) };\r\n}\r\n\r\nexport const generateNewKeyAndAddRefIdIfMissing = (target: DataQuery, queries: DataQuery[], index = 0): DataQuery => {\r\n  const key = generateKey(index);\r\n  const refId = target.refId || getNextRefIdChar(queries);\r\n\r\n  return { ...target, refId, key };\r\n};\r\n\r\n/**\r\n * Ensure at least one target exists and that targets have the necessary keys\r\n */\r\nexport function ensureQueries(queries?: DataQuery[]): DataQuery[] {\r\n  if (queries && typeof queries === 'object' && queries.length > 0) {\r\n    const allQueries = [];\r\n    for (let index = 0; index < queries.length; index++) {\r\n      const query = queries[index];\r\n      const key = generateKey(index);\r\n      let refId = query.refId;\r\n      if (!refId) {\r\n        refId = getNextRefIdChar(allQueries);\r\n      }\r\n\r\n      allQueries.push({\r\n        ...query,\r\n        refId,\r\n        key,\r\n      });\r\n    }\r\n    return allQueries;\r\n  }\r\n  return [{ ...generateEmptyQuery(queries) }];\r\n}\r\n\r\n/**\r\n * A target is non-empty when it has keys (with non-empty values) other than refId, key and context.\r\n */\r\nconst validKeys = ['refId', 'key', 'context'];\r\nexport function hasNonEmptyQuery<TQuery extends DataQuery = any>(queries: TQuery[]): boolean {\r\n  return (\r\n    queries &&\r\n    queries.some((query: any) => {\r\n      const keys = Object.keys(query)\r\n        .filter(key => validKeys.indexOf(key) === -1)\r\n        .map(k => query[k])\r\n        .filter(v => v);\r\n      return keys.length > 0;\r\n    })\r\n  );\r\n}\r\n\r\n/**\r\n * Update the query history. Side-effect: store history in local storage\r\n */\r\nexport function updateHistory<T extends DataQuery = any>(\r\n  history: Array<HistoryItem<T>>,\r\n  datasourceId: string,\r\n  queries: T[]\r\n): Array<HistoryItem<T>> {\r\n  const ts = Date.now();\r\n  queries.forEach(query => {\r\n    history = [{ query, ts }, ...history];\r\n  });\r\n\r\n  if (history.length > MAX_HISTORY_ITEMS) {\r\n    history = history.slice(0, MAX_HISTORY_ITEMS);\r\n  }\r\n\r\n  // Combine all queries of a datasource type into one history\r\n  const historyKey = `grafana.explore.history.${datasourceId}`;\r\n  store.setObject(historyKey, history);\r\n  return history;\r\n}\r\n\r\nexport function clearHistory(datasourceId: string) {\r\n  const historyKey = `grafana.explore.history.${datasourceId}`;\r\n  store.delete(historyKey);\r\n}\r\n\r\nexport const getQueryKeys = (queries: DataQuery[], datasourceInstance: DataSourceApi): string[] => {\r\n  const queryKeys = queries.reduce((newQueryKeys, query, index) => {\r\n    const primaryKey = datasourceInstance && datasourceInstance.name ? datasourceInstance.name : query.key;\r\n    return newQueryKeys.concat(`${primaryKey}-${index}`);\r\n  }, []);\r\n\r\n  return queryKeys;\r\n};\r\n\r\nexport const getTimeRange = (timeZone: TimeZone, rawRange: RawTimeRange): TimeRange => {\r\n  return {\r\n    from: dateMath.parse(rawRange.from, false, timeZone as any),\r\n    to: dateMath.parse(rawRange.to, true, timeZone as any),\r\n    raw: rawRange,\r\n  };\r\n};\r\n\r\nconst parseRawTime = (value: any): TimeFragment => {\r\n  if (value === null) {\r\n    return null;\r\n  }\r\n\r\n  if (value.indexOf('now') !== -1) {\r\n    return value;\r\n  }\r\n  if (value.length === 8) {\r\n    return toUtc(value, 'YYYYMMDD');\r\n  }\r\n  if (value.length === 15) {\r\n    return toUtc(value, 'YYYYMMDDTHHmmss');\r\n  }\r\n  // Backward compatibility\r\n  if (value.length === 19) {\r\n    return toUtc(value, 'YYYY-MM-DD HH:mm:ss');\r\n  }\r\n\r\n  if (!isNaN(value)) {\r\n    const epoch = parseInt(value, 10);\r\n    return toUtc(epoch);\r\n  }\r\n\r\n  return null;\r\n};\r\n\r\nexport const getTimeRangeFromUrl = (range: RawTimeRange, timeZone: TimeZone): TimeRange => {\r\n  const raw = {\r\n    from: parseRawTime(range.from),\r\n    to: parseRawTime(range.to),\r\n  };\r\n\r\n  return {\r\n    from: dateMath.parse(raw.from, false, timeZone as any),\r\n    to: dateMath.parse(raw.to, true, timeZone as any),\r\n    raw,\r\n  };\r\n};\r\n\r\nexport const getValueWithRefId = (value?: any): any => {\r\n  if (!value || typeof value !== 'object') {\r\n    return undefined;\r\n  }\r\n\r\n  if (value.refId) {\r\n    return value;\r\n  }\r\n\r\n  const keys = Object.keys(value);\r\n  for (let index = 0; index < keys.length; index++) {\r\n    const key = keys[index];\r\n    const refId = getValueWithRefId(value[key]);\r\n    if (refId) {\r\n      return refId;\r\n    }\r\n  }\r\n\r\n  return undefined;\r\n};\r\n\r\nexport const getFirstQueryErrorWithoutRefId = (errors?: DataQueryError[]) => {\r\n  if (!errors) {\r\n    return undefined;\r\n  }\r\n\r\n  return errors.filter(error => (error && error.refId ? false : true))[0];\r\n};\r\n\r\nexport const getRefIds = (value: any): string[] => {\r\n  if (!value) {\r\n    return [];\r\n  }\r\n\r\n  if (typeof value !== 'object') {\r\n    return [];\r\n  }\r\n\r\n  const keys = Object.keys(value);\r\n  const refIds = [];\r\n  for (let index = 0; index < keys.length; index++) {\r\n    const key = keys[index];\r\n    if (key === 'refId') {\r\n      refIds.push(value[key]);\r\n      continue;\r\n    }\r\n    refIds.push(getRefIds(value[key]));\r\n  }\r\n\r\n  return _.uniq(_.flatten(refIds));\r\n};\r\n\r\nexport const sortInAscendingOrder = (a: LogRowModel, b: LogRowModel) => {\r\n  if (a.timeEpochMs < b.timeEpochMs) {\r\n    return -1;\r\n  }\r\n\r\n  if (a.timeEpochMs > b.timeEpochMs) {\r\n    return 1;\r\n  }\r\n\r\n  return 0;\r\n};\r\n\r\nconst sortInDescendingOrder = (a: LogRowModel, b: LogRowModel) => {\r\n  if (a.timeEpochMs > b.timeEpochMs) {\r\n    return -1;\r\n  }\r\n\r\n  if (a.timeEpochMs < b.timeEpochMs) {\r\n    return 1;\r\n  }\r\n\r\n  return 0;\r\n};\r\n\r\nexport enum SortOrder {\r\n  Descending = 'Descending',\r\n  Ascending = 'Ascending',\r\n}\r\n\r\nexport const refreshIntervalToSortOrder = (refreshInterval?: string) =>\r\n  RefreshPicker.isLive(refreshInterval) ? SortOrder.Ascending : SortOrder.Descending;\r\n\r\nexport const sortLogsResult = (logsResult: LogsModel, sortOrder: SortOrder): LogsModel => {\r\n  const rows = logsResult ? logsResult.rows : [];\r\n  sortOrder === SortOrder.Ascending ? rows.sort(sortInAscendingOrder) : rows.sort(sortInDescendingOrder);\r\n  const result: LogsModel = logsResult ? { ...logsResult, rows } : { hasUniqueLabels: false, rows };\r\n\r\n  return result;\r\n};\r\n\r\nexport const convertToWebSocketUrl = (url: string) => {\r\n  const protocol = window.location.protocol === 'https:' ? 'wss://' : 'ws://';\r\n  let backend = `${protocol}${window.location.host}${config.appSubUrl}`;\r\n  if (backend.endsWith('/')) {\r\n    backend = backend.slice(0, -1);\r\n  }\r\n  return `${backend}${url}`;\r\n};\r\n\r\nexport const stopQueryState = (querySubscription: Unsubscribable) => {\r\n  if (querySubscription) {\r\n    querySubscription.unsubscribe();\r\n  }\r\n};\r\n\r\nexport function getIntervals(range: TimeRange, lowLimit: string, resolution: number): IntervalValues {\r\n  if (!resolution) {\r\n    return { interval: '1s', intervalMs: 1000 };\r\n  }\r\n\r\n  return kbn.calculateInterval(range, resolution, lowLimit);\r\n}\r\n\r\nexport function deduplicateLogRowsById(rows: LogRowModel[]) {\r\n  return _.uniqBy(rows, 'uid');\r\n}\r\n","// Returns the factors of a number\r\n// Example getFactors(12) -> [1, 2, 3, 4, 6, 12]\r\nexport default function getFactors(num: number): number[] {\r\n  return Array.from(new Array(num + 1), (_, i) => i).filter(i => num % i === 0);\r\n}\r\n","import { isBoolean, isNumber, sortedUniq, sortedIndexOf, unescape as htmlUnescaped } from 'lodash';\r\nimport { saveAs } from 'file-saver';\r\nimport { isNullOrUndefined } from 'util';\r\nimport { dateTime, TimeZone, TableData } from '@grafana/data';\r\n\r\nconst DEFAULT_DATETIME_FORMAT = 'YYYY-MM-DDTHH:mm:ssZ';\r\nconst POINT_TIME_INDEX = 1;\r\nconst POINT_VALUE_INDEX = 0;\r\n\r\nconst END_COLUMN = ';';\r\nconst END_ROW = '\\r\\n';\r\nconst QUOTE = '\"';\r\nconst EXPORT_FILENAME = 'grafana_data_export.csv';\r\n\r\ninterface SeriesListToCsvColumnsOptions {\r\n  dateTimeFormat: string;\r\n  excel: boolean;\r\n  timezone: TimeZone;\r\n}\r\n\r\ntype SeriesList = Array<{\r\n  datapoints: any;\r\n  alias: any;\r\n}>;\r\n\r\nconst defaultOptions: SeriesListToCsvColumnsOptions = {\r\n  dateTimeFormat: DEFAULT_DATETIME_FORMAT,\r\n  excel: false,\r\n  timezone: '',\r\n};\r\n\r\nfunction csvEscaped(text: string) {\r\n  if (!text) {\r\n    return text;\r\n  }\r\n\r\n  return text\r\n    .split(QUOTE)\r\n    .join(QUOTE + QUOTE)\r\n    .replace(/^([-+=@])/, \"'$1\")\r\n    .replace(/\\s+$/, '');\r\n}\r\n\r\nconst domParser = new DOMParser();\r\nfunction htmlDecoded(text: string) {\r\n  if (!text) {\r\n    return text;\r\n  }\r\n\r\n  const regexp = /&[^;]+;/g;\r\n  function htmlDecoded(value: string) {\r\n    const parsedDom = domParser.parseFromString(value, 'text/html');\r\n    return parsedDom.body.textContent;\r\n  }\r\n  return text.replace(regexp, htmlDecoded).replace(regexp, htmlDecoded);\r\n}\r\n\r\nfunction formatSpecialHeader(useExcelHeader: boolean) {\r\n  return useExcelHeader ? `sep=${END_COLUMN}${END_ROW}` : '';\r\n}\r\n\r\nfunction formatRow(row: any[], addEndRowDelimiter = true) {\r\n  let text = '';\r\n  for (let i = 0; i < row.length; i += 1) {\r\n    if (isBoolean(row[i]) || isNumber(row[i]) || isNullOrUndefined(row[i])) {\r\n      text += row[i];\r\n    } else {\r\n      text += `${QUOTE}${csvEscaped(htmlUnescaped(htmlDecoded(row[i])))}${QUOTE}`;\r\n    }\r\n\r\n    if (i < row.length - 1) {\r\n      text += END_COLUMN;\r\n    }\r\n  }\r\n  return addEndRowDelimiter ? text + END_ROW : text;\r\n}\r\n\r\nexport function convertSeriesListToCsv(seriesList: SeriesList, options: Partial<SeriesListToCsvColumnsOptions>) {\r\n  const { dateTimeFormat, excel, timezone } = { ...defaultOptions, ...options };\r\n  let text = formatSpecialHeader(excel) + formatRow(['Series', 'Time', 'Value']);\r\n  for (let seriesIndex = 0; seriesIndex < seriesList.length; seriesIndex += 1) {\r\n    for (let i = 0; i < seriesList[seriesIndex].datapoints.length; i += 1) {\r\n      text += formatRow(\r\n        [\r\n          seriesList[seriesIndex].alias,\r\n          timezone === 'utc'\r\n            ? dateTime(seriesList[seriesIndex].datapoints[i][POINT_TIME_INDEX])\r\n                .utc()\r\n                .format(dateTimeFormat)\r\n            : dateTime(seriesList[seriesIndex].datapoints[i][POINT_TIME_INDEX]).format(dateTimeFormat),\r\n          seriesList[seriesIndex].datapoints[i][POINT_VALUE_INDEX],\r\n        ],\r\n        i < seriesList[seriesIndex].datapoints.length - 1 || seriesIndex < seriesList.length - 1\r\n      );\r\n    }\r\n  }\r\n  return text;\r\n}\r\n\r\nexport function exportSeriesListToCsv(seriesList: SeriesList, options: Partial<SeriesListToCsvColumnsOptions>) {\r\n  const text = convertSeriesListToCsv(seriesList, options);\r\n  saveSaveBlob(text, EXPORT_FILENAME);\r\n}\r\n\r\nexport function convertSeriesListToCsvColumns(seriesList: SeriesList, options: Partial<SeriesListToCsvColumnsOptions>) {\r\n  const { dateTimeFormat, excel, timezone } = { ...defaultOptions, ...options };\r\n  // add header\r\n  let text =\r\n    formatSpecialHeader(excel) +\r\n    formatRow(\r\n      ['Time'].concat(\r\n        seriesList.map(val => {\r\n          return val.alias;\r\n        })\r\n      )\r\n    );\r\n  // process data\r\n  const extendedDatapointsList = mergeSeriesByTime(seriesList);\r\n\r\n  // make text\r\n  for (let i = 0; i < extendedDatapointsList[0].length; i += 1) {\r\n    const timestamp =\r\n      timezone === 'utc'\r\n        ? dateTime(extendedDatapointsList[0][i][POINT_TIME_INDEX])\r\n            .utc()\r\n            .format(dateTimeFormat)\r\n        : dateTime(extendedDatapointsList[0][i][POINT_TIME_INDEX]).format(dateTimeFormat);\r\n\r\n    text += formatRow(\r\n      [timestamp].concat(\r\n        extendedDatapointsList.map(datapoints => {\r\n          return datapoints[i][POINT_VALUE_INDEX];\r\n        })\r\n      ),\r\n      i < extendedDatapointsList[0].length - 1\r\n    );\r\n  }\r\n\r\n  return text;\r\n}\r\n\r\n/**\r\n * Collect all unique timestamps from series list and use it to fill\r\n * missing points by null.\r\n */\r\nfunction mergeSeriesByTime(seriesList: SeriesList) {\r\n  let timestamps = [];\r\n  for (let i = 0; i < seriesList.length; i++) {\r\n    const seriesPoints = seriesList[i].datapoints;\r\n    for (let j = 0; j < seriesPoints.length; j++) {\r\n      timestamps.push(seriesPoints[j][POINT_TIME_INDEX]);\r\n    }\r\n  }\r\n  timestamps = sortedUniq(timestamps.sort());\r\n\r\n  const result = [];\r\n  for (let i = 0; i < seriesList.length; i++) {\r\n    const seriesPoints = seriesList[i].datapoints;\r\n    const seriesTimestamps = seriesPoints.map((p: any) => p[POINT_TIME_INDEX]);\r\n    const extendedDatapoints = [];\r\n    for (let j = 0; j < timestamps.length; j++) {\r\n      const timestamp = timestamps[j];\r\n      const pointIndex = sortedIndexOf(seriesTimestamps, timestamp);\r\n      if (pointIndex !== -1) {\r\n        extendedDatapoints.push(seriesPoints[pointIndex]);\r\n      } else {\r\n        extendedDatapoints.push([null, timestamp]);\r\n      }\r\n    }\r\n    result.push(extendedDatapoints);\r\n  }\r\n  return result;\r\n}\r\n\r\nexport function exportSeriesListToCsvColumns(seriesList: SeriesList, options: Partial<SeriesListToCsvColumnsOptions>) {\r\n  const text = convertSeriesListToCsvColumns(seriesList, options);\r\n  saveSaveBlob(text, EXPORT_FILENAME);\r\n}\r\n\r\nexport function convertTableDataToCsv(table: TableData, excel = false) {\r\n  let text = formatSpecialHeader(excel);\r\n  // add headline\r\n  text += formatRow(table.columns.map((val: any) => val.title || val.text));\r\n  // process data\r\n  for (let i = 0; i < table.rows.length; i += 1) {\r\n    text += formatRow(table.rows[i], i < table.rows.length - 1);\r\n  }\r\n  return text;\r\n}\r\n\r\nexport function exportTableDataToCsv(table: TableData, excel = false) {\r\n  const text = convertTableDataToCsv(table, excel);\r\n  saveSaveBlob(text, EXPORT_FILENAME);\r\n}\r\n\r\nexport function saveSaveBlob(payload: any, fname: string) {\r\n  const blob = new Blob([payload], { type: 'text/csv;charset=utf-8;header=present;' });\r\n  saveAs(blob, fname);\r\n}\r\n","// Copyright (c) 2014, Hugh Kennedy\r\n// Based on code from https://github.com/hughsk/flat/blob/master/index.js\r\n//\r\nexport default function flatten(target: object, opts?: { delimiter?: any; maxDepth?: any; safe?: any }): any {\r\n  opts = opts || {};\r\n\r\n  const delimiter = opts.delimiter || '.';\r\n  let maxDepth = opts.maxDepth || 3;\r\n  let currentDepth = 1;\r\n  const output: any = {};\r\n\r\n  function step(object: any, prev: string) {\r\n    Object.keys(object).forEach(key => {\r\n      const value = object[key];\r\n      const isarray = opts.safe && Array.isArray(value);\r\n      const type = Object.prototype.toString.call(value);\r\n      const isobject = type === '[object Object]';\r\n\r\n      const newKey = prev ? prev + delimiter + key : key;\r\n\r\n      if (!opts.maxDepth) {\r\n        maxDepth = currentDepth + 1;\r\n      }\r\n\r\n      if (!isarray && isobject && Object.keys(value).length && currentDepth < maxDepth) {\r\n        ++currentDepth;\r\n        return step(value, newKey);\r\n      }\r\n\r\n      output[newKey] = value;\r\n    });\r\n  }\r\n\r\n  step(target, null);\r\n\r\n  return output;\r\n}\r\n","import { has } from 'lodash';\r\nimport {\r\n  getValueFormat,\r\n  getValueFormatterIndex,\r\n  getValueFormats,\r\n  stringToJsRegex,\r\n  TimeRange,\r\n  deprecationWarning,\r\n  DecimalCount,\r\n  formattedValueToString,\r\n} from '@grafana/data';\r\n\r\nconst kbn: any = {};\r\n\r\nkbn.valueFormats = {};\r\n\r\nkbn.regexEscape = (value: string) => {\r\n  return value.replace(/[\\\\^$*+?.()|[\\]{}\\/]/g, '\\\\$&');\r\n};\r\n\r\n///// HELPER FUNCTIONS /////\r\n\r\nkbn.round_interval = (interval: number) => {\r\n  switch (true) {\r\n    // 0.015s\r\n    case interval < 15:\r\n      return 10; // 0.01s\r\n    // 0.035s\r\n    case interval < 35:\r\n      return 20; // 0.02s\r\n    // 0.075s\r\n    case interval < 75:\r\n      return 50; // 0.05s\r\n    // 0.15s\r\n    case interval < 150:\r\n      return 100; // 0.1s\r\n    // 0.35s\r\n    case interval < 350:\r\n      return 200; // 0.2s\r\n    // 0.75s\r\n    case interval < 750:\r\n      return 500; // 0.5s\r\n    // 1.5s\r\n    case interval < 1500:\r\n      return 1000; // 1s\r\n    // 3.5s\r\n    case interval < 3500:\r\n      return 2000; // 2s\r\n    // 7.5s\r\n    case interval < 7500:\r\n      return 5000; // 5s\r\n    // 12.5s\r\n    case interval < 12500:\r\n      return 10000; // 10s\r\n    // 17.5s\r\n    case interval < 17500:\r\n      return 15000; // 15s\r\n    // 25s\r\n    case interval < 25000:\r\n      return 20000; // 20s\r\n    // 45s\r\n    case interval < 45000:\r\n      return 30000; // 30s\r\n    // 1.5m\r\n    case interval < 90000:\r\n      return 60000; // 1m\r\n    // 3.5m\r\n    case interval < 210000:\r\n      return 120000; // 2m\r\n    // 7.5m\r\n    case interval < 450000:\r\n      return 300000; // 5m\r\n    // 12.5m\r\n    case interval < 750000:\r\n      return 600000; // 10m\r\n    // 12.5m\r\n    case interval < 1050000:\r\n      return 900000; // 15m\r\n    // 25m\r\n    case interval < 1500000:\r\n      return 1200000; // 20m\r\n    // 45m\r\n    case interval < 2700000:\r\n      return 1800000; // 30m\r\n    // 1.5h\r\n    case interval < 5400000:\r\n      return 3600000; // 1h\r\n    // 2.5h\r\n    case interval < 9000000:\r\n      return 7200000; // 2h\r\n    // 4.5h\r\n    case interval < 16200000:\r\n      return 10800000; // 3h\r\n    // 9h\r\n    case interval < 32400000:\r\n      return 21600000; // 6h\r\n    // 1d\r\n    case interval < 86400000:\r\n      return 43200000; // 12h\r\n    // 1w\r\n    case interval < 604800000:\r\n      return 86400000; // 1d\r\n    // 3w\r\n    case interval < 1814400000:\r\n      return 604800000; // 1w\r\n    // 6w\r\n    case interval < 3628800000:\r\n      return 2592000000; // 30d\r\n    default:\r\n      return 31536000000; // 1y\r\n  }\r\n};\r\n\r\nkbn.secondsToHms = (seconds: number) => {\r\n  const numyears = Math.floor(seconds / 31536000);\r\n  if (numyears) {\r\n    return numyears + 'y';\r\n  }\r\n  const numdays = Math.floor((seconds % 31536000) / 86400);\r\n  if (numdays) {\r\n    return numdays + 'd';\r\n  }\r\n  const numhours = Math.floor(((seconds % 31536000) % 86400) / 3600);\r\n  if (numhours) {\r\n    return numhours + 'h';\r\n  }\r\n  const numminutes = Math.floor((((seconds % 31536000) % 86400) % 3600) / 60);\r\n  if (numminutes) {\r\n    return numminutes + 'm';\r\n  }\r\n  const numseconds = Math.floor((((seconds % 31536000) % 86400) % 3600) % 60);\r\n  if (numseconds) {\r\n    return numseconds + 's';\r\n  }\r\n  const nummilliseconds = Math.floor(seconds * 1000.0);\r\n  if (nummilliseconds) {\r\n    return nummilliseconds + 'ms';\r\n  }\r\n\r\n  return 'less than a millisecond'; //'just now' //or other string you like;\r\n};\r\n\r\nkbn.secondsToHhmmss = (seconds: number) => {\r\n  const strings: string[] = [];\r\n  const numhours = Math.floor(seconds / 3600);\r\n  const numminutes = Math.floor((seconds % 3600) / 60);\r\n  const numseconds = Math.floor((seconds % 3600) % 60);\r\n  numhours > 9 ? strings.push('' + numhours) : strings.push('0' + numhours);\r\n  numminutes > 9 ? strings.push('' + numminutes) : strings.push('0' + numminutes);\r\n  numseconds > 9 ? strings.push('' + numseconds) : strings.push('0' + numseconds);\r\n  return strings.join(':');\r\n};\r\n\r\nkbn.to_percent = (nr: number, outof: number) => {\r\n  return Math.floor((nr / outof) * 10000) / 100 + '%';\r\n};\r\n\r\nkbn.addslashes = (str: string) => {\r\n  str = str.replace(/\\\\/g, '\\\\\\\\');\r\n  str = str.replace(/\\'/g, \"\\\\'\");\r\n  str = str.replace(/\\\"/g, '\\\\\"');\r\n  str = str.replace(/\\0/g, '\\\\0');\r\n  return str;\r\n};\r\n\r\nkbn.interval_regex = /(\\d+(?:\\.\\d+)?)(ms|[Mwdhmsy])/;\r\n\r\n// histogram & trends\r\nkbn.intervals_in_seconds = {\r\n  y: 31536000,\r\n  M: 2592000,\r\n  w: 604800,\r\n  d: 86400,\r\n  h: 3600,\r\n  m: 60,\r\n  s: 1,\r\n  ms: 0.001,\r\n};\r\n\r\nkbn.calculateInterval = (range: TimeRange, resolution: number, lowLimitInterval: string[]) => {\r\n  let lowLimitMs = 1; // 1 millisecond default low limit\r\n  let intervalMs;\r\n\r\n  if (lowLimitInterval) {\r\n    if (lowLimitInterval[0] === '>') {\r\n      lowLimitInterval = lowLimitInterval.slice(1);\r\n    }\r\n    lowLimitMs = kbn.interval_to_ms(lowLimitInterval);\r\n  }\r\n\r\n  intervalMs = kbn.round_interval((range.to.valueOf() - range.from.valueOf()) / resolution);\r\n  if (lowLimitMs > intervalMs) {\r\n    intervalMs = lowLimitMs;\r\n  }\r\n\r\n  return {\r\n    intervalMs: intervalMs,\r\n    interval: kbn.secondsToHms(intervalMs / 1000),\r\n  };\r\n};\r\n\r\nkbn.describe_interval = (str: string) => {\r\n  const matches = str.match(kbn.interval_regex);\r\n  if (!matches || !has(kbn.intervals_in_seconds, matches[2])) {\r\n    throw new Error('Invalid interval string, expecting a number followed by one of \"Mwdhmsy\"');\r\n  } else {\r\n    return {\r\n      sec: kbn.intervals_in_seconds[matches[2]],\r\n      type: matches[2],\r\n      count: parseInt(matches[1], 10),\r\n    };\r\n  }\r\n};\r\n\r\nkbn.interval_to_ms = (str: string) => {\r\n  const info = kbn.describe_interval(str);\r\n  return info.sec * 1000 * info.count;\r\n};\r\n\r\nkbn.interval_to_seconds = (str: string) => {\r\n  const info = kbn.describe_interval(str);\r\n  return info.sec * info.count;\r\n};\r\n\r\nkbn.query_color_dot = (color: string, diameter: string) => {\r\n  return (\r\n    '<div class=\"icon-circle\" style=\"' +\r\n    ['display:inline-block', 'color:' + color, 'font-size:' + diameter + 'px'].join(';') +\r\n    '\"></div>'\r\n  );\r\n};\r\n\r\nkbn.slugifyForUrl = (str: string) => {\r\n  return str\r\n    .toLowerCase()\r\n    .replace(/[^\\w ]+/g, '')\r\n    .replace(/ +/g, '-');\r\n};\r\n\r\n/** deprecated since 6.1, use grafana/data */\r\nkbn.stringToJsRegex = (str: string) => {\r\n  deprecationWarning('kbn.ts', 'kbn.stringToJsRegex()', '@grafana/data');\r\n  return stringToJsRegex(str);\r\n};\r\n\r\nkbn.toFixed = (value: number | null, decimals: number) => {\r\n  if (value === null) {\r\n    return '';\r\n  }\r\n\r\n  const factor = decimals ? Math.pow(10, Math.max(0, decimals)) : 1;\r\n  const formatted = String(Math.round(value * factor) / factor);\r\n\r\n  // if exponent return directly\r\n  if (formatted.indexOf('e') !== -1 || value === 0) {\r\n    return formatted;\r\n  }\r\n\r\n  // If tickDecimals was specified, ensure that we have exactly that\r\n  // much precision; otherwise default to the value's own precision.\r\n  if (decimals != null) {\r\n    const decimalPos = formatted.indexOf('.');\r\n    const precision = decimalPos === -1 ? 0 : formatted.length - decimalPos - 1;\r\n    if (precision < decimals) {\r\n      return (precision ? formatted : formatted + '.') + String(factor).substr(1, decimals - precision);\r\n    }\r\n  }\r\n\r\n  return formatted;\r\n};\r\n\r\nkbn.toFixedScaled = (\r\n  value: number,\r\n  decimals: number,\r\n  scaledDecimals: number | null,\r\n  additionalDecimals: number,\r\n  ext: number\r\n) => {\r\n  if (scaledDecimals === null) {\r\n    return kbn.toFixed(value, decimals) + ext;\r\n  } else {\r\n    return kbn.toFixed(value, scaledDecimals + additionalDecimals) + ext;\r\n  }\r\n};\r\n\r\nkbn.roundValue = (num: number, decimals: number) => {\r\n  if (num === null) {\r\n    return null;\r\n  }\r\n  const n = Math.pow(10, decimals);\r\n  const formatted = (n * num).toFixed(decimals);\r\n  return Math.round(parseFloat(formatted)) / n;\r\n};\r\n\r\n///// FORMAT MENU /////\r\n\r\nkbn.getUnitFormats = () => {\r\n  return getValueFormats();\r\n};\r\n\r\n//\r\n// Backward compatible layer for value formats to support old plugins\r\n//\r\nif (typeof Proxy !== 'undefined') {\r\n  kbn.valueFormats = new Proxy(kbn.valueFormats, {\r\n    get(target, name, receiver) {\r\n      if (typeof name !== 'string') {\r\n        throw { message: `Value format ${String(name)} is not a string` };\r\n      }\r\n\r\n      const formatter = getValueFormat(name);\r\n      if (formatter) {\r\n        // Return the results as a simple string\r\n        return (value: number, decimals?: DecimalCount, scaledDecimals?: DecimalCount, isUtc?: boolean) => {\r\n          return formattedValueToString(formatter(value, decimals, scaledDecimals, isUtc ? 'utc' : 'browser'));\r\n        };\r\n      }\r\n\r\n      // default to look here\r\n      return Reflect.get(target, name, receiver);\r\n    },\r\n  });\r\n} else {\r\n  kbn.valueFormats = getValueFormatterIndex();\r\n}\r\n\r\nexport default kbn;\r\n","import config from 'app/core/config';\r\n\r\nexport const stripBaseFromUrl = (url: string): string => {\r\n  const appSubUrl = config.appSubUrl;\r\n  const stripExtraChars = appSubUrl.endsWith('/') ? 1 : 0;\r\n  const urlWithoutBase =\r\n    url.length > 0 && url.indexOf(appSubUrl) === 0 ? url.slice(appSubUrl.length - stripExtraChars) : url;\r\n\r\n  return urlWithoutBase;\r\n};\r\n\r\nexport default { stripBaseFromUrl };\r\n","export function assignModelProperties(target: any, source: any, defaults: any, removeDefaults?: undefined) {\n  for (const key in defaults) {\n    if (!defaults.hasOwnProperty(key)) {\n      continue;\n    }\n\n    target[key] = source[key] === undefined ? defaults[key] : source[key];\n  }\n}\n","// based on http://www.paciellogroup.com/blog/2012/04/how-to-remove-css-outlines-in-an-accessible-manner/\r\nfunction outlineFixer() {\r\n  const d: any = document;\r\n\r\n  const styleElement = d.createElement('STYLE');\r\n  const domEvents = 'addEventListener' in d;\r\n\r\n  const addEventListener = (type: string, callback: { (): void; (): void }) => {\r\n    // Basic cross-browser event handling\r\n    if (domEvents) {\r\n      d.addEventListener(type, callback);\r\n    } else {\r\n      d.attachEvent('on' + type, callback);\r\n    }\r\n  };\r\n\r\n  const setCss = (cssText: string) => {\r\n    // Handle setting of <style> element contents in IE8\r\n    !!styleElement.styleSheet ? (styleElement.styleSheet.cssText = cssText) : (styleElement.innerHTML = cssText);\r\n  };\r\n\r\n  d.getElementsByTagName('HEAD')[0].appendChild(styleElement);\r\n\r\n  // Using mousedown instead of mouseover, so that previously focused elements don't lose focus ring on mouse move\r\n  addEventListener('mousedown', () => {\r\n    setCss(':focus{outline:0 !important}::-moz-focus-inner{border:0;}');\r\n  });\r\n\r\n  addEventListener('keydown', () => {\r\n    setCss('');\r\n  });\r\n}\r\n\r\noutlineFixer();\r\n","import { IScope } from 'angular';\n\nexport const promiseToDigest = ($scope: IScope) => (promise: Promise<any>) => promise.finally($scope.$evalAsync);\n","import _ from 'lodash';\r\nimport { DataQuery } from '@grafana/data';\r\n\r\nexport const getNextRefIdChar = (queries: DataQuery[]): string => {\r\n  const letters = 'ABCDEFGHIJKLMNOPQRSTUVWXYZ';\r\n\r\n  return _.find(letters, refId => {\r\n    return _.every(queries, other => {\r\n      return other.refId !== refId;\r\n    });\r\n  });\r\n};\r\n\r\nexport function addQuery(queries: DataQuery[], query?: Partial<DataQuery>): DataQuery[] {\r\n  const q = query || {};\r\n  q.refId = getNextRefIdChar(queries);\r\n  return [...queries, q as DataQuery];\r\n}\r\n","import coreModule from 'app/core/core_module';\r\nimport { provideTheme } from 'app/core/utils/ConfigProvider';\r\n\r\nexport function react2AngularDirective(name: string, component: any, options: any) {\r\n  coreModule.directive(name, [\r\n    'reactDirective',\r\n    reactDirective => {\r\n      return reactDirective(provideTheme(component), options);\r\n    },\r\n  ]);\r\n}\r\n","// Slightly modified, but without dependancies:\r\n// https://raw.githubusercontent.com/malte-wessel/react-custom-scrollbars/master/src/utils/getScrollbarWidth.js\r\nlet scrollbarWidth: number | null = null;\r\n\r\nexport default function getScrollbarWidth() {\r\n  if (scrollbarWidth !== null) {\r\n    return scrollbarWidth;\r\n  }\r\n\r\n  if (typeof document !== 'undefined') {\r\n    const div = document.createElement('div');\r\n    const newStyles = {\r\n      width: '100px',\r\n      height: '100px',\r\n      position: 'absolute',\r\n      top: '-9999px',\r\n      overflow: 'scroll',\r\n      MsOverflowStyle: 'scrollbar',\r\n    };\r\n\r\n    Object.keys(newStyles).map(style => {\r\n      // @ts-ignore\r\n      div.style[style] = newStyles[style];\r\n    });\r\n\r\n    document.body.appendChild(div);\r\n    scrollbarWidth = div.offsetWidth - div.clientWidth;\r\n    document.body.removeChild(div);\r\n  } else {\r\n    scrollbarWidth = 0;\r\n  }\r\n  return scrollbarWidth || 0;\r\n}\r\n\r\nconst hasNoOverlayScrollbars = getScrollbarWidth() > 0;\r\n\r\nexport const addClassIfNoOverlayScrollbar = (classname: string, htmlElement: HTMLElement = document.body) => {\r\n  if (hasNoOverlayScrollbars) {\r\n    htmlElement.classList.add(classname);\r\n  }\r\n};\r\n","import _ from 'lodash';\r\n\r\nexport default function sortByKeys(input: any): any {\r\n  if (_.isArray(input)) {\r\n    return input.map(sortByKeys);\r\n  }\r\n\r\n  if (_.isPlainObject(input)) {\r\n    const sortedObject: any = {};\r\n    for (const key of _.keys(input).sort()) {\r\n      sortedObject[key] = sortByKeys(input[key]);\r\n    }\r\n    return sortedObject;\r\n  }\r\n\r\n  return input;\r\n}\r\n","import xss from 'xss';\r\nimport { sanitizeUrl as braintreeSanitizeUrl } from '@braintree/sanitize-url';\r\n\r\nconst XSSWL = Object.keys(xss.whiteList).reduce((acc, element) => {\r\n  // @ts-ignore\r\n  acc[element] = xss.whiteList[element].concat(['class', 'style']);\r\n  return acc;\r\n}, {});\r\n\r\nconst sanitizeXSS = new xss.FilterXSS({\r\n  whiteList: XSSWL,\r\n});\r\n\r\n/**\r\n * Returns string safe from XSS attacks.\r\n *\r\n * Even though we allow the style-attribute, there's still default filtering applied to it\r\n * Info: https://github.com/leizongmin/js-xss#customize-css-filter\r\n * Whitelist: https://github.com/leizongmin/js-css-filter/blob/master/lib/default.js\r\n */\r\nexport function sanitize(unsanitizedString: string): string {\r\n  try {\r\n    return sanitizeXSS.process(unsanitizedString);\r\n  } catch (error) {\r\n    console.log('String could not be sanitized', unsanitizedString);\r\n    return unsanitizedString;\r\n  }\r\n}\r\n\r\nexport function sanitizeUrl(url: string): string {\r\n  return braintreeSanitizeUrl(url);\r\n}\r\n\r\nexport function hasAnsiCodes(input: string): boolean {\r\n  return /\\u001b\\[\\d{1,2}m/.test(input);\r\n}\r\n\r\nexport function escapeHtml(str: string): string {\r\n  return String(str)\r\n    .replace(/&/g, '&amp;')\r\n    .replace(/</g, '&lt;')\r\n    .replace(/>/g, '&gt;')\r\n    .replace(/\"/g, '&quot;');\r\n}\r\n","/**\r\n * Calculate tick step.\r\n * Implementation from d3-array (ticks.js)\r\n * https://github.com/d3/d3-array/blob/master/src/ticks.js\r\n * @param start Start value\r\n * @param stop End value\r\n * @param count Ticks count\r\n */\r\nexport function tickStep(start: number, stop: number, count: number): number {\r\n  const e10 = Math.sqrt(50),\r\n    e5 = Math.sqrt(10),\r\n    e2 = Math.sqrt(2);\r\n\r\n  const step0 = Math.abs(stop - start) / Math.max(0, count);\r\n  let step1 = Math.pow(10, Math.floor(Math.log(step0) / Math.LN10));\r\n  const error = step0 / step1;\r\n\r\n  if (error >= e10) {\r\n    step1 *= 10;\r\n  } else if (error >= e5) {\r\n    step1 *= 5;\r\n  } else if (error >= e2) {\r\n    step1 *= 2;\r\n  }\r\n\r\n  return stop < start ? -step1 : step1;\r\n}\r\n\r\nexport function getScaledDecimals(decimals: number, tickSize: number) {\r\n  return decimals - Math.floor(Math.log(tickSize) / Math.LN10);\r\n}\r\n\r\n/**\r\n * Calculate tick size based on min and max values, number of ticks and precision.\r\n * Implementation from Flot.\r\n * @param min           Axis minimum\r\n * @param max           Axis maximum\r\n * @param noTicks       Number of ticks\r\n * @param tickDecimals  Tick decimal precision\r\n */\r\nexport function getFlotTickSize(min: number, max: number, noTicks: number, tickDecimals: number) {\r\n  const delta = (max - min) / noTicks;\r\n  let dec = -Math.floor(Math.log(delta) / Math.LN10);\r\n  const maxDec = tickDecimals;\r\n\r\n  const magn = Math.pow(10, -dec);\r\n  const norm = delta / magn; // norm is between 1.0 and 10.0\r\n  let size;\r\n\r\n  if (norm < 1.5) {\r\n    size = 1;\r\n  } else if (norm < 3) {\r\n    size = 2;\r\n    // special case for 2.5, requires an extra decimal\r\n    if (norm > 2.25 && (maxDec == null || dec + 1 <= maxDec)) {\r\n      size = 2.5;\r\n      ++dec;\r\n    }\r\n  } else if (norm < 7.5) {\r\n    size = 5;\r\n  } else {\r\n    size = 10;\r\n  }\r\n\r\n  size *= magn;\r\n\r\n  return size;\r\n}\r\n\r\n/**\r\n * Calculate axis range (min and max).\r\n * Implementation from Flot.\r\n */\r\nexport function getFlotRange(panelMin: any, panelMax: any, datamin: number, datamax: number) {\r\n  const autoscaleMargin = 0.02;\r\n\r\n  let min = +(panelMin != null ? panelMin : datamin);\r\n  let max = +(panelMax != null ? panelMax : datamax);\r\n  const delta = max - min;\r\n\r\n  if (delta === 0.0) {\r\n    // Grafana fix: wide Y min and max using increased wideFactor\r\n    // when all series values are the same\r\n    const wideFactor = 0.25;\r\n    const widen = Math.abs(max === 0 ? 1 : max * wideFactor);\r\n\r\n    if (panelMin === null) {\r\n      min -= widen;\r\n    }\r\n    // always widen max if we couldn't widen min to ensure we\r\n    // don't fall into min == max which doesn't work\r\n    if (panelMax == null || panelMin != null) {\r\n      max += widen;\r\n    }\r\n  } else {\r\n    // consider autoscaling\r\n    const margin = autoscaleMargin;\r\n    if (margin != null) {\r\n      if (panelMin == null) {\r\n        min -= delta * margin;\r\n        // make sure we don't go below zero if all values\r\n        // are positive\r\n        if (min < 0 && datamin != null && datamin >= 0) {\r\n          min = 0;\r\n        }\r\n      }\r\n      if (panelMax == null) {\r\n        max += delta * margin;\r\n        if (max > 0 && datamax != null && datamax <= 0) {\r\n          max = 0;\r\n        }\r\n      }\r\n    }\r\n  }\r\n  return { min, max };\r\n}\r\n\r\n/**\r\n * Calculate tick decimals.\r\n * Implementation from Flot.\r\n */\r\nexport function getFlotTickDecimals(datamin: number, datamax: number, axis: { min: any; max: any }, height: number) {\r\n  const { min, max } = getFlotRange(axis.min, axis.max, datamin, datamax);\r\n  const noTicks = 0.3 * Math.sqrt(height);\r\n  const delta = (max - min) / noTicks;\r\n  const dec = -Math.floor(Math.log(delta) / Math.LN10);\r\n\r\n  const magn = Math.pow(10, -dec);\r\n  // norm is between 1.0 and 10.0\r\n  const norm = delta / magn;\r\n  let size;\r\n\r\n  if (norm < 1.5) {\r\n    size = 1;\r\n  } else if (norm < 3) {\r\n    size = 2;\r\n    // special case for 2.5, requires an extra decimal\r\n    if (norm > 2.25) {\r\n      size = 2.5;\r\n    }\r\n  } else if (norm < 7.5) {\r\n    size = 5;\r\n  } else {\r\n    size = 10;\r\n  }\r\n  size *= magn;\r\n\r\n  const tickDecimals = Math.max(0, -Math.floor(Math.log(delta) / Math.LN10) + 1);\r\n  // grafana addition\r\n  const scaledDecimals = tickDecimals - Math.floor(Math.log(size) / Math.LN10);\r\n  return { tickDecimals, scaledDecimals };\r\n}\r\n\r\n/**\r\n * Format timestamp similar to Grafana graph panel.\r\n * @param ticks Number of ticks\r\n * @param min Time from (in milliseconds)\r\n * @param max Time to (in milliseconds)\r\n */\r\nexport function grafanaTimeFormat(ticks: number, min: number, max: number) {\r\n  if (min && max && ticks) {\r\n    const range = max - min;\r\n    const secPerTick = range / ticks / 1000;\r\n    const oneDay = 86400000;\r\n    const oneYear = 31536000000;\r\n\r\n    if (secPerTick <= 45) {\r\n      return '%H:%M:%S';\r\n    }\r\n    if (secPerTick <= 7200 || range <= oneDay) {\r\n      return '%H:%M';\r\n    }\r\n    if (secPerTick <= 80000) {\r\n      return '%m/%d %H:%M';\r\n    }\r\n    if (secPerTick <= 2419200 || range <= oneYear) {\r\n      return '%m/%d';\r\n    }\r\n    return '%Y-%m';\r\n  }\r\n\r\n  return '%H:%M';\r\n}\r\n\r\n/**\r\n * Logarithm of value for arbitrary base.\r\n */\r\nexport function logp(value: number, base: number) {\r\n  return Math.log(value) / Math.log(base);\r\n}\r\n\r\n/**\r\n * Get decimal precision of number (3.14 => 2)\r\n */\r\nexport function getPrecision(num: number): number {\r\n  const str = num.toString();\r\n  return getStringPrecision(str);\r\n}\r\n\r\n/**\r\n * Get decimal precision of number stored as a string (\"3.14\" => 2)\r\n */\r\nexport function getStringPrecision(num: string): number {\r\n  if (isNaN((num as unknown) as number)) {\r\n    return 0;\r\n  }\r\n\r\n  const dotIndex = num.indexOf('.');\r\n  if (dotIndex === -1) {\r\n    return 0;\r\n  } else {\r\n    return num.length - dotIndex - 1;\r\n  }\r\n}\r\n","import { TimeRange, toUtc, AbsoluteTimeRange } from '@grafana/data';\n\nexport const getShiftedTimeRange = (direction: number, origRange: TimeRange): AbsoluteTimeRange => {\n  const range = {\n    from: toUtc(origRange.from),\n    to: toUtc(origRange.to),\n  };\n\n  const timespan = (range.to.valueOf() - range.from.valueOf()) / 2;\n  let to: number, from: number;\n\n  if (direction === -1) {\n    to = range.to.valueOf() - timespan;\n    from = range.from.valueOf() - timespan;\n  } else if (direction === 1) {\n    to = range.to.valueOf() + timespan;\n    from = range.from.valueOf() + timespan;\n    if (to > Date.now() && range.to.valueOf() < Date.now()) {\n      to = Date.now();\n      from = range.from.valueOf();\n    }\n  } else {\n    to = range.to.valueOf();\n    from = range.from.valueOf();\n  }\n\n  return { from, to };\n};\n\nexport const getZoomedTimeRange = (range: TimeRange, factor: number): AbsoluteTimeRange => {\n  const timespan = range.to.valueOf() - range.from.valueOf();\n  const center = range.to.valueOf() - timespan / 2;\n\n  const to = center + (timespan * factor) / 2;\n  const from = center - (timespan * factor) / 2;\n\n  return { from, to };\n};\n","/**\r\n * @preserve jquery-param (c) 2015 KNOWLEDGECODE | MIT\r\n */\r\n\r\nimport { UrlQueryMap } from '@grafana/runtime';\r\n\r\nexport function renderUrl(path: string, query: UrlQueryMap | undefined): string {\r\n  if (query && Object.keys(query).length > 0) {\r\n    path += '?' + toUrlParams(query);\r\n  }\r\n  return path;\r\n}\r\n\r\nexport function encodeURIComponentAsAngularJS(val: string, pctEncodeSpaces?: boolean) {\r\n  return encodeURIComponent(val)\r\n    .replace(/%40/gi, '@')\r\n    .replace(/%3A/gi, ':')\r\n    .replace(/%24/g, '$')\r\n    .replace(/%2C/gi, ',')\r\n    .replace(/%3B/gi, ';')\r\n    .replace(/%20/g, pctEncodeSpaces ? '%20' : '+');\r\n}\r\n\r\nexport function toUrlParams(a: any) {\r\n  const s: any[] = [];\r\n  const rbracket = /\\[\\]$/;\r\n\r\n  const isArray = (obj: any) => {\r\n    return Object.prototype.toString.call(obj) === '[object Array]';\r\n  };\r\n\r\n  const add = (k: string, v: any) => {\r\n    v = typeof v === 'function' ? v() : v === null ? '' : v === undefined ? '' : v;\r\n    if (typeof v !== 'boolean') {\r\n      s[s.length] = encodeURIComponentAsAngularJS(k, true) + '=' + encodeURIComponentAsAngularJS(v, true);\r\n    } else {\r\n      s[s.length] = encodeURIComponentAsAngularJS(k, true);\r\n    }\r\n  };\r\n\r\n  const buildParams = (prefix: string, obj: any) => {\r\n    let i, len, key;\r\n\r\n    if (prefix) {\r\n      if (isArray(obj)) {\r\n        for (i = 0, len = obj.length; i < len; i++) {\r\n          if (rbracket.test(prefix)) {\r\n            add(prefix, obj[i]);\r\n          } else {\r\n            buildParams(prefix, obj[i]);\r\n          }\r\n        }\r\n      } else if (obj && String(obj) === '[object Object]') {\r\n        for (key in obj) {\r\n          buildParams(prefix + '[' + key + ']', obj[key]);\r\n        }\r\n      } else {\r\n        add(prefix, obj);\r\n      }\r\n    } else if (isArray(obj)) {\r\n      for (i = 0, len = obj.length; i < len; i++) {\r\n        add(obj[i].name, obj[i].value);\r\n      }\r\n    } else {\r\n      for (key in obj) {\r\n        buildParams(key, obj[key]);\r\n      }\r\n    }\r\n    return s;\r\n  };\r\n\r\n  return buildParams('', a).join('&');\r\n}\r\n\r\nexport function appendQueryToUrl(url: string, stringToAppend: string) {\r\n  if (stringToAppend !== undefined && stringToAppend !== null && stringToAppend !== '') {\r\n    const pos = url.indexOf('?');\r\n    if (pos !== -1) {\r\n      if (url.length - pos > 1) {\r\n        url += '&';\r\n      }\r\n    } else {\r\n      url += '?';\r\n    }\r\n    url += stringToAppend;\r\n  }\r\n\r\n  return url;\r\n}\r\n","import { BackendSrv } from 'app/core/services/backend_srv';\r\nimport { NavModelSrv } from 'app/core/core';\r\n\r\nexport default class AdminEditOrgCtrl {\r\n  /** @ngInject */\r\n  constructor($scope: any, $routeParams: any, backendSrv: BackendSrv, $location: any, navModelSrv: NavModelSrv) {\r\n    $scope.init = () => {\r\n      $scope.navModel = navModelSrv.getNav('admin', 'global-orgs', 0);\r\n\r\n      if ($routeParams.id) {\r\n        $scope.getOrg($routeParams.id);\r\n        $scope.getOrgUsers($routeParams.id);\r\n      }\r\n    };\r\n\r\n    $scope.getOrg = (id: number) => {\r\n      backendSrv.get('/api/orgs/' + id).then((org: any) => {\r\n        $scope.org = org;\r\n      });\r\n    };\r\n\r\n    $scope.getOrgUsers = (id: number) => {\r\n      backendSrv.get('/api/orgs/' + id + '/users').then((orgUsers: any) => {\r\n        $scope.orgUsers = orgUsers;\r\n      });\r\n    };\r\n\r\n    $scope.update = () => {\r\n      if (!$scope.orgDetailsForm.$valid) {\r\n        return;\r\n      }\r\n\r\n      backendSrv.put('/api/orgs/' + $scope.org.id, $scope.org).then(() => {\r\n        $location.path('/admin/orgs');\r\n      });\r\n    };\r\n\r\n    $scope.updateOrgUser = (orgUser: any) => {\r\n      backendSrv.patch('/api/orgs/' + orgUser.orgId + '/users/' + orgUser.userId, orgUser);\r\n    };\r\n\r\n    $scope.removeOrgUser = (orgUser: any) => {\r\n      backendSrv.delete('/api/orgs/' + orgUser.orgId + '/users/' + orgUser.userId).then(() => {\r\n        $scope.getOrgUsers($scope.org.id);\r\n      });\r\n    };\r\n\r\n    $scope.init();\r\n  }\r\n}\r\n","import _ from 'lodash';\r\nimport { BackendSrv } from 'app/core/services/backend_srv';\r\nimport { NavModelSrv } from 'app/core/core';\r\nimport { User } from 'app/core/services/context_srv';\r\nimport { UserSession, Scope, CoreEvents, AppEventEmitter } from 'app/types';\r\nimport { dateTime } from '@grafana/data';\r\n\r\nexport default class AdminEditUserCtrl {\r\n  /** @ngInject */\r\n  constructor(\r\n    $scope: Scope & AppEventEmitter,\r\n    $routeParams: any,\r\n    backendSrv: BackendSrv,\r\n    $location: any,\r\n    navModelSrv: NavModelSrv\r\n  ) {\r\n    $scope.user = {};\r\n    $scope.sessions = [];\r\n    $scope.newOrg = { name: '', role: 'Editor' };\r\n    $scope.permissions = {};\r\n    $scope.navModel = navModelSrv.getNav('admin', 'global-users', 0);\r\n\r\n    $scope.init = () => {\r\n      if ($routeParams.id) {\r\n        $scope.getUser($routeParams.id);\r\n        $scope.getUserSessions($routeParams.id);\r\n        $scope.getUserOrgs($routeParams.id);\r\n      }\r\n    };\r\n\r\n    $scope.getUser = (id: number) => {\r\n      backendSrv.get('/api/users/' + id).then((user: User) => {\r\n        $scope.user = user;\r\n        $scope.user_id = id;\r\n        $scope.permissions.isGrafanaAdmin = user.isGrafanaAdmin;\r\n      });\r\n    };\r\n\r\n    $scope.getUserSessions = (id: number) => {\r\n      backendSrv.get('/api/admin/users/' + id + '/auth-tokens').then((sessions: UserSession[]) => {\r\n        sessions.reverse();\r\n\r\n        $scope.sessions = sessions.map((session: UserSession) => {\r\n          return {\r\n            id: session.id,\r\n            isActive: session.isActive,\r\n            seenAt: dateTime(session.seenAt).fromNow(),\r\n            createdAt: dateTime(session.createdAt).format('MMMM DD, YYYY'),\r\n            clientIp: session.clientIp,\r\n            browser: session.browser,\r\n            browserVersion: session.browserVersion,\r\n            os: session.os,\r\n            osVersion: session.osVersion,\r\n            device: session.device,\r\n          };\r\n        });\r\n      });\r\n    };\r\n\r\n    $scope.revokeUserSession = (tokenId: number) => {\r\n      backendSrv\r\n        .post('/api/admin/users/' + $scope.user_id + '/revoke-auth-token', {\r\n          authTokenId: tokenId,\r\n        })\r\n        .then(() => {\r\n          $scope.sessions = $scope.sessions.filter((session: UserSession) => {\r\n            if (session.id === tokenId) {\r\n              return false;\r\n            }\r\n            return true;\r\n          });\r\n        });\r\n    };\r\n\r\n    $scope.revokeAllUserSessions = (tokenId: number) => {\r\n      backendSrv.post('/api/admin/users/' + $scope.user_id + '/logout').then(() => {\r\n        $scope.sessions = [];\r\n      });\r\n    };\r\n\r\n    $scope.setPassword = () => {\r\n      if (!$scope.passwordForm.$valid) {\r\n        return;\r\n      }\r\n\r\n      const payload = { password: $scope.password };\r\n      backendSrv.put('/api/admin/users/' + $scope.user_id + '/password', payload).then(() => {\r\n        $location.path('/admin/users');\r\n      });\r\n    };\r\n\r\n    $scope.updatePermissions = () => {\r\n      const payload = $scope.permissions;\r\n\r\n      backendSrv.put('/api/admin/users/' + $scope.user_id + '/permissions', payload);\r\n    };\r\n\r\n    $scope.create = () => {\r\n      if (!$scope.userForm.$valid) {\r\n        return;\r\n      }\r\n\r\n      backendSrv.post('/api/admin/users', $scope.user).then(() => {\r\n        $location.path('/admin/users');\r\n      });\r\n    };\r\n\r\n    $scope.getUserOrgs = (id: number) => {\r\n      backendSrv.get('/api/users/' + id + '/orgs').then((orgs: any) => {\r\n        $scope.orgs = orgs;\r\n      });\r\n    };\r\n\r\n    $scope.update = () => {\r\n      if (!$scope.userForm.$valid) {\r\n        return;\r\n      }\r\n\r\n      backendSrv.put('/api/users/' + $scope.user_id, $scope.user).then(() => {\r\n        $location.path('/admin/users');\r\n      });\r\n    };\r\n\r\n    $scope.updateOrgUser = (orgUser: { orgId: string }) => {\r\n      backendSrv.patch('/api/orgs/' + orgUser.orgId + '/users/' + $scope.user_id, orgUser).then(() => {});\r\n    };\r\n\r\n    $scope.removeOrgUser = (orgUser: { orgId: string }) => {\r\n      backendSrv.delete('/api/orgs/' + orgUser.orgId + '/users/' + $scope.user_id).then(() => {\r\n        $scope.getUser($scope.user_id);\r\n        $scope.getUserOrgs($scope.user_id);\r\n      });\r\n    };\r\n\r\n    $scope.orgsSearchCache = [];\r\n\r\n    $scope.searchOrgs = (queryStr: any, callback: any) => {\r\n      if ($scope.orgsSearchCache.length > 0) {\r\n        callback(_.map($scope.orgsSearchCache, 'name'));\r\n        return;\r\n      }\r\n\r\n      backendSrv.get('/api/orgs', { query: '' }).then((result: any) => {\r\n        $scope.orgsSearchCache = result;\r\n        callback(_.map(result, 'name'));\r\n      });\r\n    };\r\n\r\n    $scope.addOrgUser = () => {\r\n      if (!$scope.addOrgForm.$valid) {\r\n        return;\r\n      }\r\n\r\n      const orgInfo: any = _.find($scope.orgsSearchCache, {\r\n        name: $scope.newOrg.name,\r\n      });\r\n\r\n      if (!orgInfo) {\r\n        return;\r\n      }\r\n\r\n      $scope.newOrg.loginOrEmail = $scope.user.login;\r\n\r\n      backendSrv.post('/api/orgs/' + orgInfo.id + '/users/', $scope.newOrg).then(() => {\r\n        $scope.getUser($scope.user_id);\r\n        $scope.getUserOrgs($scope.user_id);\r\n      });\r\n    };\r\n\r\n    $scope.deleteUser = (user: any) => {\r\n      $scope.appEvent(CoreEvents.showConfirmModal, {\r\n        title: 'Delete',\r\n        text: 'Do you want to delete ' + user.login + '?',\r\n        icon: 'fa-trash',\r\n        yesText: 'Delete',\r\n        onConfirm: () => {\r\n          backendSrv.delete('/api/admin/users/' + user.id).then(() => {\r\n            $location.path('/admin/users');\r\n          });\r\n        },\r\n      });\r\n    };\r\n\r\n    $scope.disableUser = (event: any) => {\r\n      const user = $scope.user;\r\n\r\n      // External user can not be disabled\r\n      if (user.isExternal) {\r\n        event.preventDefault();\r\n        event.stopPropagation();\r\n        return;\r\n      }\r\n\r\n      const actionEndpoint = user.isDisabled ? '/enable' : '/disable';\r\n      backendSrv.post('/api/admin/users/' + user.id + actionEndpoint).then(() => {\r\n        $scope.init();\r\n      });\r\n    };\r\n\r\n    $scope.init();\r\n  }\r\n}\r\n","import { BackendSrv } from 'app/core/services/backend_srv';\r\nimport { NavModelSrv } from 'app/core/core';\r\nimport { Scope, CoreEvents, AppEventEmitter } from 'app/types';\r\n\r\nexport default class AdminListOrgsCtrl {\r\n  /** @ngInject */\r\n  constructor($scope: Scope & AppEventEmitter, backendSrv: BackendSrv, navModelSrv: NavModelSrv) {\r\n    $scope.init = () => {\r\n      $scope.navModel = navModelSrv.getNav('admin', 'global-orgs', 0);\r\n      $scope.getOrgs();\r\n    };\r\n\r\n    $scope.getOrgs = () => {\r\n      backendSrv.get('/api/orgs').then((orgs: any) => {\r\n        $scope.orgs = orgs;\r\n      });\r\n    };\r\n\r\n    $scope.deleteOrg = (org: any) => {\r\n      $scope.appEvent(CoreEvents.showConfirmModal, {\r\n        title: 'Delete',\r\n        text: `Do you want to delete organization ${org.name}?`,\r\n        text2: 'All dashboards for this organization will be removed!',\r\n        icon: 'fa-trash',\r\n        yesText: 'Delete',\r\n        onConfirm: () => {\r\n          backendSrv.delete('/api/orgs/' + org.id).then(() => {\r\n            $scope.getOrgs();\r\n          });\r\n        },\r\n      });\r\n    };\r\n\r\n    $scope.init();\r\n  }\r\n}\r\n","import { getTagColorsFromName } from '@grafana/ui';\r\nimport { BackendSrv } from 'app/core/services/backend_srv';\r\nimport { NavModelSrv } from 'app/core/core';\r\n\r\nexport default class AdminListUsersCtrl {\r\n  users: any;\r\n  pages: any[] = [];\r\n  perPage = 50;\r\n  page = 1;\r\n  totalPages: number;\r\n  showPaging = false;\r\n  query: any;\r\n  navModel: any;\r\n\r\n  /** @ngInject */\r\n  constructor(private backendSrv: BackendSrv, navModelSrv: NavModelSrv) {\r\n    this.navModel = navModelSrv.getNav('admin', 'global-users', 0);\r\n    this.query = '';\r\n    this.getUsers();\r\n  }\r\n\r\n  getUsers() {\r\n    this.backendSrv\r\n      .get(`/api/users/search?perpage=${this.perPage}&page=${this.page}&query=${this.query}`)\r\n      .then((result: any) => {\r\n        this.users = result.users;\r\n        this.page = result.page;\r\n        this.perPage = result.perPage;\r\n        this.totalPages = Math.ceil(result.totalCount / result.perPage);\r\n        this.showPaging = this.totalPages > 1;\r\n        this.pages = [];\r\n\r\n        for (let i = 1; i < this.totalPages + 1; i++) {\r\n          this.pages.push({ page: i, current: i === this.page });\r\n        }\r\n\r\n        this.addUsersAuthLabels();\r\n      });\r\n  }\r\n\r\n  navigateToPage(page: any) {\r\n    this.page = page.page;\r\n    this.getUsers();\r\n  }\r\n\r\n  addUsersAuthLabels() {\r\n    for (const user of this.users) {\r\n      user.authLabel = getAuthLabel(user);\r\n      user.authLabelStyle = getAuthLabelStyle(user.authLabel);\r\n    }\r\n  }\r\n}\r\n\r\nfunction getAuthLabel(user: any) {\r\n  if (user.authLabels && user.authLabels.length) {\r\n    return user.authLabels[0];\r\n  }\r\n  return '';\r\n}\r\n\r\nfunction getAuthLabelStyle(label: string) {\r\n  if (label === 'LDAP' || !label) {\r\n    return {};\r\n  }\r\n\r\n  const { color, borderColor } = getTagColorsFromName(label);\r\n  return {\r\n    'background-color': color,\r\n    'border-color': borderColor,\r\n  };\r\n}\r\n","import React, { PureComponent } from 'react';\r\nimport { hot } from 'react-hot-loader';\r\nimport { connect } from 'react-redux';\r\nimport { NavModel } from '@grafana/data';\r\nimport { getNavModel } from 'app/core/selectors/navModel';\r\nimport { getRouteParamsId } from 'app/core/selectors/location';\r\nimport config from 'app/core/config';\r\nimport Page from 'app/core/components/Page/Page';\r\nimport { UserProfile } from './UserProfile';\r\nimport { UserPermissions } from './UserPermissions';\r\nimport { UserSessions } from './UserSessions';\r\nimport { UserLdapSyncInfo } from './UserLdapSyncInfo';\r\nimport { StoreState, UserDTO, UserOrg, UserSession, SyncInfo, UserAdminError } from 'app/types';\r\nimport {\r\n  loadAdminUserPage,\r\n  revokeSession,\r\n  revokeAllSessions,\r\n  updateUser,\r\n  setUserPassword,\r\n  disableUser,\r\n  enableUser,\r\n  deleteUser,\r\n  updateUserPermissions,\r\n  addOrgUser,\r\n  updateOrgUserRole,\r\n  deleteOrgUser,\r\n  syncLdapUser,\r\n} from './state/actions';\r\nimport { UserOrgs } from './UserOrgs';\r\n\r\ninterface Props {\r\n  navModel: NavModel;\r\n  userId: number;\r\n  user: UserDTO;\r\n  orgs: UserOrg[];\r\n  sessions: UserSession[];\r\n  ldapSyncInfo: SyncInfo;\r\n  isLoading: boolean;\r\n  error: UserAdminError;\r\n\r\n  loadAdminUserPage: typeof loadAdminUserPage;\r\n  revokeSession: typeof revokeSession;\r\n  revokeAllSessions: typeof revokeAllSessions;\r\n  updateUser: typeof updateUser;\r\n  setUserPassword: typeof setUserPassword;\r\n  disableUser: typeof disableUser;\r\n  enableUser: typeof enableUser;\r\n  deleteUser: typeof deleteUser;\r\n  updateUserPermissions: typeof updateUserPermissions;\r\n  addOrgUser: typeof addOrgUser;\r\n  updateOrgUserRole: typeof updateOrgUserRole;\r\n  deleteOrgUser: typeof deleteOrgUser;\r\n  syncLdapUser: typeof syncLdapUser;\r\n}\r\n\r\ninterface State {\r\n  // isLoading: boolean;\r\n}\r\n\r\nexport class UserAdminPage extends PureComponent<Props, State> {\r\n  state = {\r\n    // isLoading: true,\r\n  };\r\n\r\n  async componentDidMount() {\r\n    const { userId, loadAdminUserPage } = this.props;\r\n    loadAdminUserPage(userId);\r\n  }\r\n\r\n  onUserUpdate = (user: UserDTO) => {\r\n    this.props.updateUser(user);\r\n  };\r\n\r\n  onPasswordChange = (password: string) => {\r\n    const { userId, setUserPassword } = this.props;\r\n    setUserPassword(userId, password);\r\n  };\r\n\r\n  onUserDelete = (userId: number) => {\r\n    this.props.deleteUser(userId);\r\n  };\r\n\r\n  onUserDisable = (userId: number) => {\r\n    this.props.disableUser(userId);\r\n  };\r\n\r\n  onUserEnable = (userId: number) => {\r\n    this.props.enableUser(userId);\r\n  };\r\n\r\n  onGrafanaAdminChange = (isGrafanaAdmin: boolean) => {\r\n    const { userId, updateUserPermissions } = this.props;\r\n    updateUserPermissions(userId, isGrafanaAdmin);\r\n  };\r\n\r\n  onOrgRemove = (orgId: number) => {\r\n    const { userId, deleteOrgUser } = this.props;\r\n    deleteOrgUser(userId, orgId);\r\n  };\r\n\r\n  onOrgRoleChange = (orgId: number, newRole: string) => {\r\n    const { userId, updateOrgUserRole } = this.props;\r\n    updateOrgUserRole(userId, orgId, newRole);\r\n  };\r\n\r\n  onOrgAdd = (orgId: number, role: string) => {\r\n    const { user, addOrgUser } = this.props;\r\n    addOrgUser(user, orgId, role);\r\n  };\r\n\r\n  onSessionRevoke = (tokenId: number) => {\r\n    const { userId, revokeSession } = this.props;\r\n    revokeSession(tokenId, userId);\r\n  };\r\n\r\n  onAllSessionsRevoke = () => {\r\n    const { userId, revokeAllSessions } = this.props;\r\n    revokeAllSessions(userId);\r\n  };\r\n\r\n  onUserSync = () => {\r\n    const { userId, syncLdapUser } = this.props;\r\n    syncLdapUser(userId);\r\n  };\r\n\r\n  render() {\r\n    const { navModel, user, orgs, sessions, ldapSyncInfo, isLoading } = this.props;\r\n    // const { isLoading } = this.state;\r\n    const isLDAPUser = user && user.isExternal && user.authLabels && user.authLabels.includes('LDAP');\r\n\r\n    return (\r\n      <Page navModel={navModel}>\r\n        <Page.Contents isLoading={isLoading}>\r\n          {user && (\r\n            <>\r\n              <UserProfile\r\n                user={user}\r\n                onUserUpdate={this.onUserUpdate}\r\n                onUserDelete={this.onUserDelete}\r\n                onUserDisable={this.onUserDisable}\r\n                onUserEnable={this.onUserEnable}\r\n                onPasswordChange={this.onPasswordChange}\r\n              />\r\n              {isLDAPUser && config.licenseInfo.hasLicense && ldapSyncInfo && (\r\n                <UserLdapSyncInfo ldapSyncInfo={ldapSyncInfo} user={user} onUserSync={this.onUserSync} />\r\n              )}\r\n              <UserPermissions isGrafanaAdmin={user.isGrafanaAdmin} onGrafanaAdminChange={this.onGrafanaAdminChange} />\r\n            </>\r\n          )}\r\n\r\n          {orgs && (\r\n            <UserOrgs\r\n              orgs={orgs}\r\n              onOrgRemove={this.onOrgRemove}\r\n              onOrgRoleChange={this.onOrgRoleChange}\r\n              onOrgAdd={this.onOrgAdd}\r\n            />\r\n          )}\r\n\r\n          {sessions && (\r\n            <UserSessions\r\n              sessions={sessions}\r\n              onSessionRevoke={this.onSessionRevoke}\r\n              onAllSessionsRevoke={this.onAllSessionsRevoke}\r\n            />\r\n          )}\r\n        </Page.Contents>\r\n      </Page>\r\n    );\r\n  }\r\n}\r\n\r\nconst mapStateToProps = (state: StoreState) => ({\r\n  userId: getRouteParamsId(state.location),\r\n  navModel: getNavModel(state.navIndex, 'global-users'),\r\n  user: state.userAdmin.user,\r\n  sessions: state.userAdmin.sessions,\r\n  orgs: state.userAdmin.orgs,\r\n  ldapSyncInfo: state.ldap.syncInfo,\r\n  isLoading: state.userAdmin.isLoading,\r\n  error: state.userAdmin.error,\r\n});\r\n\r\nconst mapDispatchToProps = {\r\n  loadAdminUserPage,\r\n  updateUser,\r\n  setUserPassword,\r\n  disableUser,\r\n  enableUser,\r\n  deleteUser,\r\n  updateUserPermissions,\r\n  addOrgUser,\r\n  updateOrgUserRole,\r\n  deleteOrgUser,\r\n  revokeSession,\r\n  revokeAllSessions,\r\n  syncLdapUser,\r\n};\r\n\r\nexport default hot(module)(connect(mapStateToProps, mapDispatchToProps)(UserAdminPage));\r\n","import React, { PureComponent } from 'react';\r\nimport { dateTime } from '@grafana/data';\r\nimport { SyncInfo, UserDTO } from 'app/types';\r\nimport { Button, LinkButton } from '@grafana/ui';\r\n\r\ninterface Props {\r\n  ldapSyncInfo: SyncInfo;\r\n  user: UserDTO;\r\n  onUserSync: () => void;\r\n}\r\n\r\ninterface State {}\r\n\r\nconst syncTimeFormat = 'dddd YYYY-MM-DD HH:mm zz';\r\nconst debugLDAPMappingBaseURL = '/admin/ldap';\r\n\r\nexport class UserLdapSyncInfo extends PureComponent<Props, State> {\r\n  onUserSync = () => {\r\n    this.props.onUserSync();\r\n  };\r\n\r\n  render() {\r\n    const { ldapSyncInfo, user } = this.props;\r\n    const nextSyncTime = dateTime(ldapSyncInfo.nextSync).format(syncTimeFormat);\r\n    const prevSyncSuccessful = ldapSyncInfo && ldapSyncInfo.prevSync;\r\n    const prevSyncTime = prevSyncSuccessful ? dateTime(ldapSyncInfo.prevSync.started).format(syncTimeFormat) : '';\r\n    const debugLDAPMappingURL = `${debugLDAPMappingBaseURL}?user=${user && user.login}`;\r\n\r\n    return (\r\n      <>\r\n        <h3 className=\"page-heading\">LDAP Synchronisation</h3>\r\n        <div className=\"gf-form-group\">\r\n          <div className=\"gf-form\">\r\n            <table className=\"filter-table form-inline\">\r\n              <tbody>\r\n                <tr>\r\n                  <td>External sync</td>\r\n                  <td>User synced via LDAP  some changes must be done in LDAP or mappings.</td>\r\n                  <td>\r\n                    <span className=\"label label-tag\">LDAP</span>\r\n                  </td>\r\n                </tr>\r\n                <tr>\r\n                  {ldapSyncInfo.enabled ? (\r\n                    <>\r\n                      <td>Next scheduled synchronisation</td>\r\n                      <td colSpan={2}>{nextSyncTime}</td>\r\n                    </>\r\n                  ) : (\r\n                    <>\r\n                      <td>Next scheduled synchronisation</td>\r\n                      <td colSpan={2}>Not enabled</td>\r\n                    </>\r\n                  )}\r\n                </tr>\r\n                <tr>\r\n                  {prevSyncSuccessful ? (\r\n                    <>\r\n                      <td>Last synchronisation</td>\r\n                      <td>{prevSyncTime}</td>\r\n                      <td>Successful</td>\r\n                    </>\r\n                  ) : (\r\n                    <td colSpan={3}>Last synchronisation</td>\r\n                  )}\r\n                </tr>\r\n              </tbody>\r\n            </table>\r\n          </div>\r\n          <div className=\"gf-form-button-row\">\r\n            <Button variant=\"secondary\" onClick={this.onUserSync}>\r\n              Sync user\r\n            </Button>\r\n            <LinkButton variant=\"inverse\" href={debugLDAPMappingURL}>\r\n              Debug LDAP Mapping\r\n            </LinkButton>\r\n          </div>\r\n        </div>\r\n      </>\r\n    );\r\n  }\r\n}\r\n","import React, { PureComponent } from 'react';\r\nimport { css, cx } from 'emotion';\r\nimport { Modal, Themeable, stylesFactory, withTheme, ConfirmButton, Forms } from '@grafana/ui';\r\nimport { GrafanaTheme } from '@grafana/data';\r\nimport { UserOrg, Organization } from 'app/types';\r\nimport { OrgPicker, OrgSelectItem } from 'app/core/components/Select/OrgPicker';\r\n\r\ninterface Props {\r\n  orgs: UserOrg[];\r\n\r\n  onOrgRemove: (orgId: number) => void;\r\n  onOrgRoleChange: (orgId: number, newRole: string) => void;\r\n  onOrgAdd: (orgId: number, role: string) => void;\r\n}\r\n\r\ninterface State {\r\n  showAddOrgModal: boolean;\r\n}\r\n\r\nexport class UserOrgs extends PureComponent<Props, State> {\r\n  state = {\r\n    showAddOrgModal: false,\r\n  };\r\n\r\n  showOrgAddModal = (show: boolean) => () => {\r\n    this.setState({ showAddOrgModal: show });\r\n  };\r\n\r\n  render() {\r\n    const { orgs, onOrgRoleChange, onOrgRemove, onOrgAdd } = this.props;\r\n    const { showAddOrgModal } = this.state;\r\n    const addToOrgContainerClass = css`\r\n      margin-top: 0.8rem;\r\n    `;\r\n\r\n    return (\r\n      <>\r\n        <h3 className=\"page-heading\">Organisations</h3>\r\n        <div className=\"gf-form-group\">\r\n          <div className=\"gf-form\">\r\n            <table className=\"filter-table form-inline\">\r\n              <tbody>\r\n                {orgs.map((org, index) => (\r\n                  <OrgRow\r\n                    key={`${org.orgId}-${index}`}\r\n                    org={org}\r\n                    onOrgRoleChange={onOrgRoleChange}\r\n                    onOrgRemove={onOrgRemove}\r\n                  />\r\n                ))}\r\n              </tbody>\r\n            </table>\r\n          </div>\r\n          <div className={addToOrgContainerClass}>\r\n            <Forms.Button variant=\"secondary\" onClick={this.showOrgAddModal(true)}>\r\n              Add user to organization\r\n            </Forms.Button>\r\n          </div>\r\n          <AddToOrgModal isOpen={showAddOrgModal} onOrgAdd={onOrgAdd} onDismiss={this.showOrgAddModal(false)} />\r\n        </div>\r\n      </>\r\n    );\r\n  }\r\n}\r\n\r\nconst ORG_ROLES = ['Viewer', 'Editor', 'Admin'];\r\n\r\nconst getOrgRowStyles = stylesFactory((theme: GrafanaTheme) => {\r\n  return {\r\n    removeButton: css`\r\n      margin-right: 0.6rem;\r\n      text-decoration: underline;\r\n      color: ${theme.colors.blue95};\r\n    `,\r\n    label: css`\r\n      font-weight: 500;\r\n    `,\r\n  };\r\n});\r\n\r\ninterface OrgRowProps extends Themeable {\r\n  org: UserOrg;\r\n  onOrgRemove: (orgId: number) => void;\r\n  onOrgRoleChange: (orgId: number, newRole: string) => void;\r\n}\r\n\r\ninterface OrgRowState {\r\n  currentRole: string;\r\n  isChangingRole: boolean;\r\n  isRemovingFromOrg: boolean;\r\n}\r\n\r\nclass UnThemedOrgRow extends PureComponent<OrgRowProps, OrgRowState> {\r\n  state = {\r\n    currentRole: this.props.org.role,\r\n    isChangingRole: false,\r\n    isRemovingFromOrg: false,\r\n  };\r\n\r\n  onOrgRemove = () => {\r\n    const { org } = this.props;\r\n    this.props.onOrgRemove(org.orgId);\r\n  };\r\n\r\n  onChangeRoleClick = () => {\r\n    const { org } = this.props;\r\n    this.setState({ isChangingRole: true, currentRole: org.role });\r\n  };\r\n\r\n  onOrgRemoveClick = () => {\r\n    this.setState({ isRemovingFromOrg: true });\r\n  };\r\n\r\n  onOrgRoleChange = (event: React.ChangeEvent<HTMLSelectElement>) => {\r\n    const newRole = event.target.value;\r\n    this.setState({ currentRole: newRole });\r\n  };\r\n\r\n  onOrgRoleSave = () => {\r\n    this.props.onOrgRoleChange(this.props.org.orgId, this.state.currentRole);\r\n  };\r\n\r\n  onCancelClick = () => {\r\n    this.setState({ isChangingRole: false, isRemovingFromOrg: false });\r\n  };\r\n\r\n  render() {\r\n    const { org, theme } = this.props;\r\n    const { currentRole, isChangingRole, isRemovingFromOrg } = this.state;\r\n    const styles = getOrgRowStyles(theme);\r\n    const labelClass = cx('width-16', styles.label);\r\n\r\n    return (\r\n      <tr>\r\n        <td className={labelClass}>{org.name}</td>\r\n        {isChangingRole ? (\r\n          <td>\r\n            <div className=\"gf-form-select-wrapper width-8\">\r\n              <select value={currentRole} className=\"gf-form-input\" onChange={this.onOrgRoleChange}>\r\n                {ORG_ROLES.map((option, index) => {\r\n                  return (\r\n                    <option value={option} key={`${option}-${index}`}>\r\n                      {option}\r\n                    </option>\r\n                  );\r\n                })}\r\n              </select>\r\n            </div>\r\n          </td>\r\n        ) : (\r\n          <td className=\"width-25\">{org.role}</td>\r\n        )}\r\n        {!isRemovingFromOrg && (\r\n          <td colSpan={isChangingRole ? 2 : 1}>\r\n            <div className=\"pull-right\">\r\n              <ConfirmButton\r\n                confirmText=\"Save\"\r\n                onClick={this.onChangeRoleClick}\r\n                onCancel={this.onCancelClick}\r\n                onConfirm={this.onOrgRoleSave}\r\n              >\r\n                Change role\r\n              </ConfirmButton>\r\n            </div>\r\n          </td>\r\n        )}\r\n        {!isChangingRole && (\r\n          <td colSpan={isRemovingFromOrg ? 2 : 1}>\r\n            <div className=\"pull-right\">\r\n              <ConfirmButton\r\n                confirmText=\"Confirm removal\"\r\n                confirmVariant=\"danger\"\r\n                onClick={this.onOrgRemoveClick}\r\n                onCancel={this.onCancelClick}\r\n                onConfirm={this.onOrgRemove}\r\n              >\r\n                Remove from organisation\r\n              </ConfirmButton>\r\n            </div>\r\n          </td>\r\n        )}\r\n      </tr>\r\n    );\r\n  }\r\n}\r\n\r\nconst OrgRow = withTheme(UnThemedOrgRow);\r\n\r\nconst getAddToOrgModalStyles = stylesFactory(() => ({\r\n  modal: css`\r\n    width: 500px;\r\n  `,\r\n  buttonRow: css`\r\n    text-align: center;\r\n  `,\r\n}));\r\n\r\ninterface AddToOrgModalProps {\r\n  isOpen: boolean;\r\n  onOrgAdd(orgId: number, role: string): void;\r\n  onDismiss?(): void;\r\n}\r\n\r\ninterface AddToOrgModalState {\r\n  selectedOrg: Organization;\r\n  role: string;\r\n}\r\n\r\nexport class AddToOrgModal extends PureComponent<AddToOrgModalProps, AddToOrgModalState> {\r\n  state: AddToOrgModalState = {\r\n    selectedOrg: null,\r\n    role: 'Admin',\r\n  };\r\n\r\n  onOrgSelect = (org: OrgSelectItem) => {\r\n    this.setState({ selectedOrg: { ...org } });\r\n  };\r\n\r\n  onOrgRoleChange = (event: React.ChangeEvent<HTMLSelectElement>) => {\r\n    this.setState({\r\n      role: event.target.value,\r\n    });\r\n  };\r\n\r\n  onAddUserToOrg = () => {\r\n    const { selectedOrg, role } = this.state;\r\n    this.props.onOrgAdd(selectedOrg.id, role);\r\n  };\r\n\r\n  onCancel = () => {\r\n    this.props.onDismiss();\r\n  };\r\n\r\n  render() {\r\n    const { isOpen } = this.props;\r\n    const { role } = this.state;\r\n    const styles = getAddToOrgModalStyles();\r\n    const buttonRowClass = cx('gf-form-button-row', styles.buttonRow);\r\n\r\n    return (\r\n      <Modal className={styles.modal} title=\"Add to an organization\" isOpen={isOpen} onDismiss={this.onCancel}>\r\n        <div className=\"gf-form-group\">\r\n          <h6 className=\"\">Organisation</h6>\r\n          <OrgPicker className=\"width-25\" onSelected={this.onOrgSelect} />\r\n        </div>\r\n        <div className=\"gf-form-group\">\r\n          <h6 className=\"\">Role</h6>\r\n          <div className=\"gf-form-select-wrapper width-16\">\r\n            <select value={role} className=\"gf-form-input\" onChange={this.onOrgRoleChange}>\r\n              {ORG_ROLES.map((option, index) => {\r\n                return (\r\n                  <option value={option} key={`${option}-${index}`}>\r\n                    {option}\r\n                  </option>\r\n                );\r\n              })}\r\n            </select>\r\n          </div>\r\n        </div>\r\n        <div className={buttonRowClass}>\r\n          <Forms.Button variant=\"primary\" onClick={this.onAddUserToOrg}>\r\n            Add to organization\r\n          </Forms.Button>\r\n          <Forms.Button variant=\"secondary\" onClick={this.onCancel}>\r\n            Cancel\r\n          </Forms.Button>\r\n        </div>\r\n      </Modal>\r\n    );\r\n  }\r\n}\r\n","import React, { PureComponent } from 'react';\r\nimport { ConfirmButton } from '@grafana/ui';\r\nimport { cx } from 'emotion';\r\n\r\ninterface Props {\r\n  isGrafanaAdmin: boolean;\r\n\r\n  onGrafanaAdminChange: (isGrafanaAdmin: boolean) => void;\r\n}\r\n\r\ninterface State {\r\n  isEditing: boolean;\r\n  currentAdminOption: string;\r\n}\r\n\r\nexport class UserPermissions extends PureComponent<Props, State> {\r\n  state = {\r\n    isEditing: false,\r\n    currentAdminOption: this.props.isGrafanaAdmin ? 'YES' : 'NO',\r\n  };\r\n\r\n  onChangeClick = () => {\r\n    this.setState({ isEditing: true });\r\n  };\r\n\r\n  onCancelClick = () => {\r\n    this.setState({\r\n      isEditing: false,\r\n      currentAdminOption: this.props.isGrafanaAdmin ? 'YES' : 'NO',\r\n    });\r\n  };\r\n\r\n  onGrafanaAdminChange = () => {\r\n    const { currentAdminOption } = this.state;\r\n    const newIsGrafanaAdmin = currentAdminOption === 'YES' ? true : false;\r\n    this.props.onGrafanaAdminChange(newIsGrafanaAdmin);\r\n  };\r\n\r\n  onAdminOptionSelect = (event: React.ChangeEvent<HTMLSelectElement>) => {\r\n    this.setState({ currentAdminOption: event.target.value });\r\n  };\r\n\r\n  render() {\r\n    const { isGrafanaAdmin } = this.props;\r\n    const { isEditing, currentAdminOption } = this.state;\r\n    const changeButtonContainerClass = cx('pull-right');\r\n\r\n    return (\r\n      <>\r\n        <h3 className=\"page-heading\">Permissions</h3>\r\n        <div className=\"gf-form-group\">\r\n          <div className=\"gf-form\">\r\n            <table className=\"filter-table form-inline\">\r\n              <tbody>\r\n                <tr>\r\n                  <td className=\"width-16\">Grafana Admin</td>\r\n                  {isEditing ? (\r\n                    <td colSpan={2}>\r\n                      <div className=\"gf-form-select-wrapper width-8\">\r\n                        <select\r\n                          value={currentAdminOption}\r\n                          className=\"gf-form-input\"\r\n                          onChange={this.onAdminOptionSelect}\r\n                        >\r\n                          {['YES', 'NO'].map((option, index) => {\r\n                            return (\r\n                              <option value={option} key={`${option}-${index}`}>\r\n                                {option}\r\n                              </option>\r\n                            );\r\n                          })}\r\n                        </select>\r\n                      </div>\r\n                    </td>\r\n                  ) : (\r\n                    <td colSpan={2}>\r\n                      {isGrafanaAdmin ? (\r\n                        <>\r\n                          <i className=\"gicon gicon-shield\" /> Yes\r\n                        </>\r\n                      ) : (\r\n                        <>No</>\r\n                      )}\r\n                    </td>\r\n                  )}\r\n                  <td>\r\n                    <div className={changeButtonContainerClass}>\r\n                      <ConfirmButton\r\n                        className=\"pull-right\"\r\n                        onClick={this.onChangeClick}\r\n                        onConfirm={this.onGrafanaAdminChange}\r\n                        onCancel={this.onCancelClick}\r\n                        confirmText=\"Change\"\r\n                      >\r\n                        Change\r\n                      </ConfirmButton>\r\n                    </div>\r\n                  </td>\r\n                </tr>\r\n              </tbody>\r\n            </table>\r\n          </div>\r\n        </div>\r\n      </>\r\n    );\r\n  }\r\n}\r\n","import React, { PureComponent, FC } from 'react';\r\nimport { UserDTO } from 'app/types';\r\nimport { cx, css } from 'emotion';\r\nimport { config } from 'app/core/config';\r\nimport { GrafanaTheme } from '@grafana/data';\r\nimport { ConfirmButton, Input, ConfirmModal, InputStatus, Forms, stylesFactory } from '@grafana/ui';\r\n\r\ninterface Props {\r\n  user: UserDTO;\r\n\r\n  onUserUpdate: (user: UserDTO) => void;\r\n  onUserDelete: (userId: number) => void;\r\n  onUserDisable: (userId: number) => void;\r\n  onUserEnable: (userId: number) => void;\r\n  onPasswordChange(password: string): void;\r\n}\r\n\r\ninterface State {\r\n  isLoading: boolean;\r\n  showDeleteModal: boolean;\r\n  showDisableModal: boolean;\r\n}\r\n\r\nexport class UserProfile extends PureComponent<Props, State> {\r\n  state = {\r\n    isLoading: false,\r\n    showDeleteModal: false,\r\n    showDisableModal: false,\r\n  };\r\n\r\n  showDeleteUserModal = (show: boolean) => () => {\r\n    this.setState({ showDeleteModal: show });\r\n  };\r\n\r\n  showDisableUserModal = (show: boolean) => () => {\r\n    this.setState({ showDisableModal: show });\r\n  };\r\n\r\n  onUserDelete = () => {\r\n    const { user, onUserDelete } = this.props;\r\n    onUserDelete(user.id);\r\n  };\r\n\r\n  onUserDisable = () => {\r\n    const { user, onUserDisable } = this.props;\r\n    onUserDisable(user.id);\r\n  };\r\n\r\n  onUserEnable = () => {\r\n    const { user, onUserEnable } = this.props;\r\n    onUserEnable(user.id);\r\n  };\r\n\r\n  onUserNameChange = (newValue: string) => {\r\n    const { user, onUserUpdate } = this.props;\r\n    onUserUpdate({\r\n      ...user,\r\n      name: newValue,\r\n    });\r\n  };\r\n\r\n  onUserEmailChange = (newValue: string) => {\r\n    const { user, onUserUpdate } = this.props;\r\n    onUserUpdate({\r\n      ...user,\r\n      email: newValue,\r\n    });\r\n  };\r\n\r\n  onUserLoginChange = (newValue: string) => {\r\n    const { user, onUserUpdate } = this.props;\r\n    onUserUpdate({\r\n      ...user,\r\n      login: newValue,\r\n    });\r\n  };\r\n\r\n  onPasswordChange = (newValue: string) => {\r\n    this.props.onPasswordChange(newValue);\r\n  };\r\n\r\n  render() {\r\n    const { user } = this.props;\r\n    const { showDeleteModal, showDisableModal } = this.state;\r\n    const lockMessage = 'Synced via LDAP';\r\n    const styles = getStyles(config.theme);\r\n\r\n    return (\r\n      <>\r\n        <h3 className=\"page-heading\">User information</h3>\r\n        <div className=\"gf-form-group\">\r\n          <div className=\"gf-form\">\r\n            <table className=\"filter-table form-inline\">\r\n              <tbody>\r\n                <UserProfileRow\r\n                  label=\"Name\"\r\n                  value={user.name}\r\n                  locked={user.isExternal}\r\n                  lockMessage={lockMessage}\r\n                  onChange={this.onUserNameChange}\r\n                />\r\n                <UserProfileRow\r\n                  label=\"Email\"\r\n                  value={user.email}\r\n                  locked={user.isExternal}\r\n                  lockMessage={lockMessage}\r\n                  onChange={this.onUserEmailChange}\r\n                />\r\n                <UserProfileRow\r\n                  label=\"Username\"\r\n                  value={user.login}\r\n                  locked={user.isExternal}\r\n                  lockMessage={lockMessage}\r\n                  onChange={this.onUserLoginChange}\r\n                />\r\n                <UserProfileRow\r\n                  label=\"Password\"\r\n                  value=\"********\"\r\n                  inputType=\"password\"\r\n                  locked={user.isExternal}\r\n                  lockMessage={lockMessage}\r\n                  onChange={this.onPasswordChange}\r\n                />\r\n              </tbody>\r\n            </table>\r\n          </div>\r\n          <div className={styles.buttonRow}>\r\n            <Forms.Button variant=\"destructive\" onClick={this.showDeleteUserModal(true)}>\r\n              Delete User\r\n            </Forms.Button>\r\n            <ConfirmModal\r\n              isOpen={showDeleteModal}\r\n              title=\"Delete user\"\r\n              body=\"Are you sure you want to delete this user?\"\r\n              confirmText=\"Delete user\"\r\n              onConfirm={this.onUserDelete}\r\n              onDismiss={this.showDeleteUserModal(false)}\r\n            />\r\n            {user.isDisabled ? (\r\n              <Forms.Button variant=\"secondary\" onClick={this.onUserEnable}>\r\n                Enable User\r\n              </Forms.Button>\r\n            ) : (\r\n              <Forms.Button variant=\"secondary\" onClick={this.showDisableUserModal(true)}>\r\n                Disable User\r\n              </Forms.Button>\r\n            )}\r\n            <ConfirmModal\r\n              isOpen={showDisableModal}\r\n              title=\"Disable user\"\r\n              body=\"Are you sure you want to disable this user?\"\r\n              confirmText=\"Disable user\"\r\n              onConfirm={this.onUserDisable}\r\n              onDismiss={this.showDisableUserModal(false)}\r\n            />\r\n          </div>\r\n        </div>\r\n      </>\r\n    );\r\n  }\r\n}\r\n\r\nconst getStyles = stylesFactory((theme: GrafanaTheme) => {\r\n  return {\r\n    buttonRow: css`\r\n      margin-top: 0.8rem;\r\n      > * {\r\n        margin-right: 16px;\r\n      }\r\n    `,\r\n  };\r\n});\r\n\r\ninterface UserProfileRowProps {\r\n  label: string;\r\n  value?: string;\r\n  locked?: boolean;\r\n  lockMessage?: string;\r\n  inputType?: string;\r\n  onChange?: (value: string) => void;\r\n}\r\n\r\ninterface UserProfileRowState {\r\n  value: string;\r\n  editing: boolean;\r\n}\r\n\r\nexport class UserProfileRow extends PureComponent<UserProfileRowProps, UserProfileRowState> {\r\n  inputElem: HTMLInputElement;\r\n\r\n  static defaultProps: Partial<UserProfileRowProps> = {\r\n    value: '',\r\n    locked: false,\r\n    lockMessage: '',\r\n    inputType: 'text',\r\n  };\r\n\r\n  state = {\r\n    editing: false,\r\n    value: this.props.value || '',\r\n  };\r\n\r\n  setInputElem = (elem: any) => {\r\n    this.inputElem = elem;\r\n  };\r\n\r\n  onEditClick = () => {\r\n    if (this.props.inputType === 'password') {\r\n      // Reset value for password field\r\n      this.setState({ editing: true, value: '' }, this.focusInput);\r\n    } else {\r\n      this.setState({ editing: true }, this.focusInput);\r\n    }\r\n  };\r\n\r\n  onCancelClick = () => {\r\n    this.setState({ editing: false, value: this.props.value || '' });\r\n  };\r\n\r\n  onInputChange = (event: React.ChangeEvent<HTMLInputElement>, status?: InputStatus) => {\r\n    if (status === InputStatus.Invalid) {\r\n      return;\r\n    }\r\n\r\n    this.setState({ value: event.target.value });\r\n  };\r\n\r\n  onInputBlur = (event: React.FocusEvent<HTMLInputElement>, status?: InputStatus) => {\r\n    if (status === InputStatus.Invalid) {\r\n      return;\r\n    }\r\n\r\n    this.setState({ value: event.target.value });\r\n  };\r\n\r\n  focusInput = () => {\r\n    if (this.inputElem && this.inputElem.focus) {\r\n      this.inputElem.focus();\r\n    }\r\n  };\r\n\r\n  onSave = () => {\r\n    if (this.props.onChange) {\r\n      this.props.onChange(this.state.value);\r\n    }\r\n  };\r\n\r\n  render() {\r\n    const { label, locked, lockMessage, inputType } = this.props;\r\n    const { value } = this.state;\r\n    const labelClass = cx(\r\n      'width-16',\r\n      css`\r\n        font-weight: 500;\r\n      `\r\n    );\r\n    const editButtonContainerClass = cx('pull-right');\r\n\r\n    if (locked) {\r\n      return <LockedRow label={label} value={value} lockMessage={lockMessage} />;\r\n    }\r\n\r\n    return (\r\n      <tr>\r\n        <td className={labelClass}>{label}</td>\r\n        <td className=\"width-25\" colSpan={2}>\r\n          {this.state.editing ? (\r\n            <Input\r\n              className=\"width-20\"\r\n              type={inputType}\r\n              defaultValue={value}\r\n              onBlur={this.onInputBlur}\r\n              onChange={this.onInputChange}\r\n              inputRef={this.setInputElem}\r\n            />\r\n          ) : (\r\n            <span>{this.props.value}</span>\r\n          )}\r\n        </td>\r\n        <td>\r\n          <div className={editButtonContainerClass}>\r\n            <ConfirmButton\r\n              confirmText=\"Save\"\r\n              onClick={this.onEditClick}\r\n              onConfirm={this.onSave}\r\n              onCancel={this.onCancelClick}\r\n            >\r\n              Edit\r\n            </ConfirmButton>\r\n          </div>\r\n        </td>\r\n      </tr>\r\n    );\r\n  }\r\n}\r\n\r\ninterface LockedRowProps {\r\n  label: string;\r\n  value?: any;\r\n  lockMessage?: string;\r\n}\r\n\r\nexport const LockedRow: FC<LockedRowProps> = ({ label, value, lockMessage }) => {\r\n  const lockMessageClass = cx(\r\n    'pull-right',\r\n    css`\r\n      font-style: italic;\r\n      margin-right: 0.6rem;\r\n    `\r\n  );\r\n  const labelClass = cx(\r\n    'width-16',\r\n    css`\r\n      font-weight: 500;\r\n    `\r\n  );\r\n\r\n  return (\r\n    <tr>\r\n      <td className={labelClass}>{label}</td>\r\n      <td className=\"width-25\" colSpan={2}>\r\n        {value}\r\n      </td>\r\n      <td>\r\n        <span className={lockMessageClass}>{lockMessage}</span>\r\n      </td>\r\n    </tr>\r\n  );\r\n};\r\n","import React, { PureComponent } from 'react';\r\nimport { css } from 'emotion';\r\nimport { ConfirmButton, ConfirmModal, Forms } from '@grafana/ui';\r\nimport { UserSession } from 'app/types';\r\n\r\ninterface Props {\r\n  sessions: UserSession[];\r\n\r\n  onSessionRevoke: (id: number) => void;\r\n  onAllSessionsRevoke: () => void;\r\n}\r\n\r\ninterface State {\r\n  showLogoutModal: boolean;\r\n}\r\n\r\nexport class UserSessions extends PureComponent<Props, State> {\r\n  state: State = {\r\n    showLogoutModal: false,\r\n  };\r\n\r\n  showLogoutConfirmationModal = (show: boolean) => () => {\r\n    this.setState({ showLogoutModal: show });\r\n  };\r\n\r\n  onSessionRevoke = (id: number) => {\r\n    return () => {\r\n      this.props.onSessionRevoke(id);\r\n    };\r\n  };\r\n\r\n  onAllSessionsRevoke = () => {\r\n    this.setState({ showLogoutModal: false });\r\n    this.props.onAllSessionsRevoke();\r\n  };\r\n\r\n  render() {\r\n    const { sessions } = this.props;\r\n    const { showLogoutModal } = this.state;\r\n\r\n    const logoutFromAllDevicesClass = css`\r\n      margin-top: 0.8rem;\r\n    `;\r\n\r\n    return (\r\n      <>\r\n        <h3 className=\"page-heading\">Sessions</h3>\r\n        <div className=\"gf-form-group\">\r\n          <div className=\"gf-form\">\r\n            <table className=\"filter-table form-inline\">\r\n              <thead>\r\n                <tr>\r\n                  <th>Last seen</th>\r\n                  <th>Logged on</th>\r\n                  <th>IP address</th>\r\n                  <th colSpan={2}>Browser &amp; OS</th>\r\n                </tr>\r\n              </thead>\r\n              <tbody>\r\n                {sessions &&\r\n                  sessions.map((session, index) => (\r\n                    <tr key={`${session.id}-${index}`}>\r\n                      <td>{session.isActive ? 'Now' : session.seenAt}</td>\r\n                      <td>{session.createdAt}</td>\r\n                      <td>{session.clientIp}</td>\r\n                      <td>{`${session.browser} on ${session.os} ${session.osVersion}`}</td>\r\n                      <td>\r\n                        <div className=\"pull-right\">\r\n                          <ConfirmButton\r\n                            confirmText=\"Confirm logout\"\r\n                            confirmVariant=\"danger\"\r\n                            onConfirm={this.onSessionRevoke(session.id)}\r\n                          >\r\n                            Force logout\r\n                          </ConfirmButton>\r\n                        </div>\r\n                      </td>\r\n                    </tr>\r\n                  ))}\r\n              </tbody>\r\n            </table>\r\n          </div>\r\n          <div className={logoutFromAllDevicesClass}>\r\n            {sessions.length > 0 && (\r\n              <Forms.Button variant=\"secondary\" onClick={this.showLogoutConfirmationModal(true)}>\r\n                Force logout from all devices\r\n              </Forms.Button>\r\n            )}\r\n            <ConfirmModal\r\n              isOpen={showLogoutModal}\r\n              title=\"Force logout from all devices\"\r\n              body=\"Are you sure you want to force logout from all devices?\"\r\n              confirmText=\"Force logout\"\r\n              onConfirm={this.onAllSessionsRevoke}\r\n              onDismiss={this.showLogoutConfirmationModal(false)}\r\n            />\r\n          </div>\r\n        </div>\r\n      </>\r\n    );\r\n  }\r\n}\r\n","import AdminListUsersCtrl from './AdminListUsersCtrl';\r\nimport AdminEditUserCtrl from './AdminEditUserCtrl';\r\nimport AdminListOrgsCtrl from './AdminListOrgsCtrl';\r\nimport AdminEditOrgCtrl from './AdminEditOrgCtrl';\r\n\r\nimport coreModule from 'app/core/core_module';\r\nimport { NavModelSrv } from 'app/core/core';\r\n\r\nclass AdminHomeCtrl {\r\n  navModel: any;\r\n\r\n  /** @ngInject */\r\n  constructor(navModelSrv: NavModelSrv) {\r\n    this.navModel = navModelSrv.getNav('admin');\r\n  }\r\n}\r\n\r\ncoreModule.controller('AdminListUsersCtrl', AdminListUsersCtrl);\r\ncoreModule.controller('AdminEditUserCtrl', AdminEditUserCtrl);\r\ncoreModule.controller('AdminListOrgsCtrl', AdminListOrgsCtrl);\r\ncoreModule.controller('AdminEditOrgCtrl', AdminEditOrgCtrl);\r\ncoreModule.controller('AdminHomeCtrl', AdminHomeCtrl);\r\n","import React, { FC } from 'react';\r\nimport { Alert } from '@grafana/ui';\r\nimport { AppNotificationSeverity, LdapConnectionInfo, LdapServerInfo } from 'app/types';\r\n\r\ninterface Props {\r\n  ldapConnectionInfo: LdapConnectionInfo;\r\n}\r\n\r\nexport const LdapConnectionStatus: FC<Props> = ({ ldapConnectionInfo }) => {\r\n  return (\r\n    <>\r\n      <h3 className=\"page-heading\">LDAP Connection</h3>\r\n      <div className=\"gf-form-group\">\r\n        <div className=\"gf-form\">\r\n          <table className=\"filter-table form-inline\">\r\n            <thead>\r\n              <tr>\r\n                <th>Host</th>\r\n                <th colSpan={2}>Port</th>\r\n              </tr>\r\n            </thead>\r\n            <tbody>\r\n              {ldapConnectionInfo &&\r\n                ldapConnectionInfo.map((serverInfo, index) => (\r\n                  <tr key={index}>\r\n                    <td>{serverInfo.host}</td>\r\n                    <td>{serverInfo.port}</td>\r\n                    <td>\r\n                      {serverInfo.available ? (\r\n                        <i className=\"fa fa-fw fa-check pull-right\" />\r\n                      ) : (\r\n                        <i className=\"fa fa-fw fa-exclamation-triangle pull-right\" />\r\n                      )}\r\n                    </td>\r\n                  </tr>\r\n                ))}\r\n            </tbody>\r\n          </table>\r\n        </div>\r\n        <div className=\"gf-form-group\">\r\n          <LdapErrorBox ldapConnectionInfo={ldapConnectionInfo} />\r\n        </div>\r\n      </div>\r\n    </>\r\n  );\r\n};\r\n\r\ninterface LdapConnectionErrorProps {\r\n  ldapConnectionInfo: LdapConnectionInfo;\r\n}\r\n\r\nexport const LdapErrorBox: FC<LdapConnectionErrorProps> = ({ ldapConnectionInfo }) => {\r\n  const hasError = ldapConnectionInfo.some(info => info.error);\r\n  if (!hasError) {\r\n    return null;\r\n  }\r\n\r\n  const connectionErrors: LdapServerInfo[] = [];\r\n  ldapConnectionInfo.forEach(info => {\r\n    if (info.error) {\r\n      connectionErrors.push(info);\r\n    }\r\n  });\r\n\r\n  const errorElements = connectionErrors.map((info, index) => (\r\n    <div key={index}>\r\n      <span style={{ fontWeight: 500 }}>\r\n        {info.host}:{info.port}\r\n        <br />\r\n      </span>\r\n      <span>{info.error}</span>\r\n      {index !== connectionErrors.length - 1 && (\r\n        <>\r\n          <br />\r\n          <br />\r\n        </>\r\n      )}\r\n    </div>\r\n  ));\r\n\r\n  return <Alert title=\"Connection error\" severity={AppNotificationSeverity.Error} children={errorElements} />;\r\n};\r\n","import React, { PureComponent } from 'react';\r\nimport { hot } from 'react-hot-loader';\r\nimport { connect } from 'react-redux';\r\nimport { NavModel } from '@grafana/data';\r\nimport { FormField, Alert } from '@grafana/ui';\r\nimport { getNavModel } from 'app/core/selectors/navModel';\r\nimport config from 'app/core/config';\r\nimport Page from 'app/core/components/Page/Page';\r\nimport { LdapConnectionStatus } from './LdapConnectionStatus';\r\nimport { LdapSyncInfo } from './LdapSyncInfo';\r\nimport { LdapUserInfo } from './LdapUserInfo';\r\nimport { AppNotificationSeverity, LdapError, LdapUser, StoreState, SyncInfo, LdapConnectionInfo } from 'app/types';\r\nimport {\r\n  loadLdapState,\r\n  loadLdapSyncStatus,\r\n  loadUserMapping,\r\n  clearUserError,\r\n  clearUserMappingInfo,\r\n} from '../state/actions';\r\n\r\ninterface Props {\r\n  navModel: NavModel;\r\n  ldapConnectionInfo: LdapConnectionInfo;\r\n  ldapUser: LdapUser;\r\n  ldapSyncInfo: SyncInfo;\r\n  ldapError: LdapError;\r\n  userError?: LdapError;\r\n  username?: string;\r\n\r\n  loadLdapState: typeof loadLdapState;\r\n  loadLdapSyncStatus: typeof loadLdapSyncStatus;\r\n  loadUserMapping: typeof loadUserMapping;\r\n  clearUserError: typeof clearUserError;\r\n  clearUserMappingInfo: typeof clearUserMappingInfo;\r\n}\r\n\r\ninterface State {\r\n  isLoading: boolean;\r\n}\r\n\r\nexport class LdapPage extends PureComponent<Props, State> {\r\n  state = {\r\n    isLoading: true,\r\n  };\r\n\r\n  async componentDidMount() {\r\n    const { username, clearUserMappingInfo, loadUserMapping } = this.props;\r\n    await clearUserMappingInfo();\r\n    await this.fetchLDAPStatus();\r\n    if (username) {\r\n      await loadUserMapping(username);\r\n    }\r\n    this.setState({ isLoading: false });\r\n  }\r\n\r\n  async fetchLDAPStatus() {\r\n    const { loadLdapState, loadLdapSyncStatus } = this.props;\r\n    return Promise.all([loadLdapState(), loadLdapSyncStatus()]);\r\n  }\r\n\r\n  async fetchUserMapping(username: string) {\r\n    const { loadUserMapping } = this.props;\r\n    return await loadUserMapping(username);\r\n  }\r\n\r\n  search = (event: any) => {\r\n    event.preventDefault();\r\n    const username = event.target.elements['username'].value;\r\n    if (username) {\r\n      this.fetchUserMapping(username);\r\n    }\r\n  };\r\n\r\n  onClearUserError = () => {\r\n    this.props.clearUserError();\r\n  };\r\n\r\n  render() {\r\n    const { ldapUser, userError, ldapError, ldapSyncInfo, ldapConnectionInfo, navModel, username } = this.props;\r\n    const { isLoading } = this.state;\r\n\r\n    return (\r\n      <Page navModel={navModel}>\r\n        <Page.Contents isLoading={isLoading}>\r\n          <>\r\n            {ldapError && ldapError.title && (\r\n              <div className=\"gf-form-group\">\r\n                <Alert title={ldapError.title} severity={AppNotificationSeverity.Error} children={ldapError.body} />\r\n              </div>\r\n            )}\r\n\r\n            <LdapConnectionStatus ldapConnectionInfo={ldapConnectionInfo} />\r\n\r\n            {config.licenseInfo.hasLicense && ldapSyncInfo && <LdapSyncInfo ldapSyncInfo={ldapSyncInfo} />}\r\n\r\n            <h3 className=\"page-heading\">Test user mapping</h3>\r\n            <div className=\"gf-form-group\">\r\n              <form onSubmit={this.search} className=\"gf-form-inline\">\r\n                <FormField\r\n                  label=\"Username\"\r\n                  labelWidth={8}\r\n                  inputWidth={30}\r\n                  type=\"text\"\r\n                  id=\"username\"\r\n                  name=\"username\"\r\n                  defaultValue={username}\r\n                />\r\n                <button type=\"submit\" className=\"btn btn-primary\">\r\n                  Run\r\n                </button>\r\n              </form>\r\n            </div>\r\n            {userError && userError.title && (\r\n              <div className=\"gf-form-group\">\r\n                <Alert\r\n                  title={userError.title}\r\n                  severity={AppNotificationSeverity.Error}\r\n                  children={userError.body}\r\n                  onRemove={this.onClearUserError}\r\n                />\r\n              </div>\r\n            )}\r\n            {ldapUser && <LdapUserInfo ldapUser={ldapUser} showAttributeMapping={true} />}\r\n          </>\r\n        </Page.Contents>\r\n      </Page>\r\n    );\r\n  }\r\n}\r\n\r\nconst mapStateToProps = (state: StoreState) => ({\r\n  navModel: getNavModel(state.navIndex, 'ldap'),\r\n  username: state.location.routeParams.user,\r\n  ldapConnectionInfo: state.ldap.connectionInfo,\r\n  ldapUser: state.ldap.user,\r\n  ldapSyncInfo: state.ldap.syncInfo,\r\n  userError: state.ldap.userError,\r\n  ldapError: state.ldap.ldapError,\r\n});\r\n\r\nconst mapDispatchToProps = {\r\n  loadLdapState,\r\n  loadLdapSyncStatus,\r\n  loadUserMapping,\r\n  clearUserError,\r\n  clearUserMappingInfo,\r\n};\r\n\r\nexport default hot(module)(connect(mapStateToProps, mapDispatchToProps)(LdapPage));\r\n","import React, { PureComponent } from 'react';\r\nimport { dateTime } from '@grafana/data';\r\nimport { SyncInfo } from 'app/types';\r\n\r\ninterface Props {\r\n  ldapSyncInfo: SyncInfo;\r\n}\r\n\r\ninterface State {\r\n  isSyncing: boolean;\r\n}\r\n\r\nconst syncTimeFormat = 'dddd YYYY-MM-DD HH:mm zz';\r\n\r\nexport class LdapSyncInfo extends PureComponent<Props, State> {\r\n  state = {\r\n    isSyncing: false,\r\n  };\r\n\r\n  handleSyncClick = () => {\r\n    console.log('Bulk-sync now');\r\n    this.setState({ isSyncing: !this.state.isSyncing });\r\n  };\r\n\r\n  render() {\r\n    const { ldapSyncInfo } = this.props;\r\n    const { isSyncing } = this.state;\r\n    const nextSyncTime = dateTime(ldapSyncInfo.nextSync).format(syncTimeFormat);\r\n    const prevSyncSuccessful = ldapSyncInfo && ldapSyncInfo.prevSync;\r\n    const prevSyncTime = prevSyncSuccessful ? dateTime(ldapSyncInfo.prevSync.started).format(syncTimeFormat) : '';\r\n\r\n    return (\r\n      <>\r\n        <h3 className=\"page-heading\">\r\n          LDAP Synchronisation\r\n          <button className={`btn btn-secondary pull-right`} onClick={this.handleSyncClick} hidden={true}>\r\n            <span className=\"btn-title\">Bulk-sync now</span>\r\n            {isSyncing && <i className=\"fa fa-spinner fa-fw fa-spin run-icon\" />}\r\n          </button>\r\n        </h3>\r\n        <div className=\"gf-form-group\">\r\n          <div className=\"gf-form\">\r\n            <table className=\"filter-table form-inline\">\r\n              <tbody>\r\n                <tr>\r\n                  <td>Active synchronisation</td>\r\n                  <td colSpan={2}>{ldapSyncInfo.enabled ? 'Enabled' : 'Disabled'}</td>\r\n                </tr>\r\n                <tr>\r\n                  <td>Scheduled</td>\r\n                  <td>{ldapSyncInfo.schedule}</td>\r\n                </tr>\r\n                <tr>\r\n                  <td>Next scheduled synchronisation</td>\r\n                  <td>{nextSyncTime}</td>\r\n                </tr>\r\n                <tr>\r\n                  <td>Last synchronisation</td>\r\n                  {prevSyncSuccessful && (\r\n                    <>\r\n                      <td>{prevSyncTime}</td>\r\n                      <td>Successful</td>\r\n                    </>\r\n                  )}\r\n                </tr>\r\n              </tbody>\r\n            </table>\r\n          </div>\r\n        </div>\r\n      </>\r\n    );\r\n  }\r\n}\r\n","import React, { FC } from 'react';\r\nimport { Tooltip } from '@grafana/ui';\r\nimport { LdapRole } from 'app/types';\r\n\r\ninterface Props {\r\n  groups: LdapRole[];\r\n  showAttributeMapping?: boolean;\r\n}\r\n\r\nexport const LdapUserGroups: FC<Props> = ({ groups, showAttributeMapping }) => {\r\n  const items = showAttributeMapping ? groups : groups.filter(item => item.orgRole);\r\n\r\n  return (\r\n    <div className=\"gf-form-group\">\r\n      <div className=\"gf-form\">\r\n        <table className=\"filter-table form-inline\">\r\n          <thead>\r\n            <tr>\r\n              {showAttributeMapping && <th>LDAP Group</th>}\r\n              <th>\r\n                Organization\r\n                <Tooltip placement=\"top\" content=\"Only the first match for an Organization will be used\" theme={'info'}>\r\n                  <span className=\"gf-form-help-icon\">\r\n                    <i className=\"fa fa-info-circle\" />\r\n                  </span>\r\n                </Tooltip>\r\n              </th>\r\n              <th>Role</th>\r\n            </tr>\r\n          </thead>\r\n          <tbody>\r\n            {items.map((group, index) => {\r\n              return (\r\n                <tr key={`${group.orgId}-${index}`}>\r\n                  {showAttributeMapping && (\r\n                    <>\r\n                      <td>{group.groupDN}</td>\r\n                      {!group.orgRole && (\r\n                        <>\r\n                          <td />\r\n                          <td>\r\n                            <span className=\"text-warning\">\r\n                              No match\r\n                              <Tooltip placement=\"top\" content=\"No matching groups found\" theme={'info'}>\r\n                                <span className=\"gf-form-help-icon\">\r\n                                  <i className=\"fa fa-info-circle\" />\r\n                                </span>\r\n                              </Tooltip>\r\n                            </span>\r\n                          </td>\r\n                        </>\r\n                      )}\r\n                    </>\r\n                  )}\r\n                  {group.orgName && (\r\n                    <>\r\n                      <td>{group.orgName}</td>\r\n                      <td>{group.orgRole}</td>\r\n                    </>\r\n                  )}\r\n                </tr>\r\n              );\r\n            })}\r\n          </tbody>\r\n        </table>\r\n      </div>\r\n    </div>\r\n  );\r\n};\r\n","import React, { FC } from 'react';\nimport { LdapUserMappingInfo } from './LdapUserMappingInfo';\nimport { LdapUserPermissions } from './LdapUserPermissions';\nimport { LdapUserGroups } from './LdapUserGroups';\nimport { LdapUserTeams } from './LdapUserTeams';\nimport { LdapUser } from 'app/types';\n\ninterface Props {\n  ldapUser: LdapUser;\n  showAttributeMapping?: boolean;\n}\n\nexport const LdapUserInfo: FC<Props> = ({ ldapUser, showAttributeMapping }) => {\n  return (\n    <>\n      <LdapUserMappingInfo info={ldapUser.info} showAttributeMapping={showAttributeMapping} />\n      <LdapUserPermissions permissions={ldapUser.permissions} />\n      {ldapUser.roles && ldapUser.roles.length > 0 && (\n        <LdapUserGroups groups={ldapUser.roles} showAttributeMapping={showAttributeMapping} />\n      )}\n\n      {ldapUser.teams && ldapUser.teams.length > 0 ? (\n        <LdapUserTeams teams={ldapUser.teams} showAttributeMapping={showAttributeMapping} />\n      ) : (\n        <div className=\"gf-form-group\">\n          <div className=\"gf-form\">\n            <table className=\"filter-table form-inline\">\n              <tbody>\n                <tr>\n                  <td>No teams found via LDAP</td>\n                </tr>\n              </tbody>\n            </table>\n          </div>\n        </div>\n      )}\n    </>\n  );\n};\n","import React, { FC } from 'react';\nimport { LdapUserInfo } from 'app/types';\n\ninterface Props {\n  info: LdapUserInfo;\n  showAttributeMapping?: boolean;\n}\n\nexport const LdapUserMappingInfo: FC<Props> = ({ info, showAttributeMapping }) => {\n  return (\n    <div className=\"gf-form-group\">\n      <div className=\"gf-form\">\n        <table className=\"filter-table form-inline\">\n          <thead>\n            <tr>\n              <th colSpan={2}>User information</th>\n              {showAttributeMapping && <th>LDAP attribute</th>}\n            </tr>\n          </thead>\n          <tbody>\n            <tr>\n              <td className=\"width-16\">First name</td>\n              <td>{info.name.ldapValue}</td>\n              {showAttributeMapping && <td>{info.name.cfgAttrValue}</td>}\n            </tr>\n            <tr>\n              <td className=\"width-16\">Surname</td>\n              <td>{info.surname.ldapValue}</td>\n              {showAttributeMapping && <td>{info.surname.cfgAttrValue}</td>}\n            </tr>\n            <tr>\n              <td className=\"width-16\">Username</td>\n              <td>{info.login.ldapValue}</td>\n              {showAttributeMapping && <td>{info.login.cfgAttrValue}</td>}\n            </tr>\n            <tr>\n              <td className=\"width-16\">Email</td>\n              <td>{info.email.ldapValue}</td>\n              {showAttributeMapping && <td>{info.email.cfgAttrValue}</td>}\n            </tr>\n          </tbody>\n        </table>\n      </div>\n    </div>\n  );\n};\n","import React, { FC } from 'react';\r\nimport { LdapPermissions } from 'app/types';\r\n\r\ninterface Props {\r\n  permissions: LdapPermissions;\r\n}\r\n\r\nexport const LdapUserPermissions: FC<Props> = ({ permissions }) => {\r\n  return (\r\n    <div className=\"gf-form-group\">\r\n      <div className=\"gf-form\">\r\n        <table className=\"filter-table form-inline\">\r\n          <thead>\r\n            <tr>\r\n              <th colSpan={1}>Permissions</th>\r\n            </tr>\r\n          </thead>\r\n          <tbody>\r\n            <tr>\r\n              <td className=\"width-16\"> Grafana admin</td>\r\n              <td>\r\n                {permissions.isGrafanaAdmin ? (\r\n                  <>\r\n                    <i className=\"gicon gicon-shield\" /> Yes\r\n                  </>\r\n                ) : (\r\n                  'No'\r\n                )}\r\n              </td>\r\n            </tr>\r\n            <tr>\r\n              <td className=\"width-16\">Status</td>\r\n              <td>\r\n                {permissions.isDisabled ? (\r\n                  <>\r\n                    <i className=\"fa fa-fw fa-times\" /> Inactive\r\n                  </>\r\n                ) : (\r\n                  <>\r\n                    <i className=\"fa fa-fw fa-check\" /> Active\r\n                  </>\r\n                )}\r\n              </td>\r\n            </tr>\r\n          </tbody>\r\n        </table>\r\n      </div>\r\n    </div>\r\n  );\r\n};\r\n","import React, { FC } from 'react';\r\nimport { Tooltip } from '@grafana/ui';\r\nimport { LdapTeam } from 'app/types';\r\n\r\ninterface Props {\r\n  teams: LdapTeam[];\r\n  showAttributeMapping?: boolean;\r\n}\r\n\r\nexport const LdapUserTeams: FC<Props> = ({ teams, showAttributeMapping }) => {\r\n  const items = showAttributeMapping ? teams : teams.filter(item => item.teamName);\r\n\r\n  return (\r\n    <div className=\"gf-form-group\">\r\n      <div className=\"gf-form\">\r\n        <table className=\"filter-table form-inline\">\r\n          <thead>\r\n            <tr>\r\n              {showAttributeMapping && <th>LDAP Group</th>}\r\n              <th>Organisation</th>\r\n              <th>Team</th>\r\n            </tr>\r\n          </thead>\r\n          <tbody>\r\n            {items.map((team, index) => {\r\n              return (\r\n                <tr key={`${team.teamName}-${index}`}>\r\n                  {showAttributeMapping && (\r\n                    <>\r\n                      <td>{team.groupDN}</td>\r\n                      {!team.orgName && (\r\n                        <>\r\n                          <td />\r\n                          <td>\r\n                            <div className=\"text-warning\">\r\n                              No match\r\n                              <Tooltip placement=\"top\" content=\"No matching teams found\" theme={'info'}>\r\n                                <span className=\"gf-form-help-icon\">\r\n                                  <i className=\"fa fa-info-circle\" />\r\n                                </span>\r\n                              </Tooltip>\r\n                            </div>\r\n                          </td>\r\n                        </>\r\n                      )}\r\n                    </>\r\n                  )}\r\n                  {team.orgName && (\r\n                    <>\r\n                      <td>{team.orgName}</td>\r\n                      <td>{team.teamName}</td>\r\n                    </>\r\n                  )}\r\n                </tr>\r\n              );\r\n            })}\r\n          </tbody>\r\n        </table>\r\n      </div>\r\n    </div>\r\n  );\r\n};\r\n","import { updateLocation } from 'app/core/actions';\r\nimport config from 'app/core/config';\r\nimport { dateTime } from '@grafana/data';\r\nimport { getBackendSrv } from '@grafana/runtime';\r\nimport { ThunkResult, LdapUser, UserSession, UserDTO } from 'app/types';\r\n\r\nimport {\r\n  userAdminPageLoadedAction,\r\n  userProfileLoadedAction,\r\n  userOrgsLoadedAction,\r\n  userSessionsLoadedAction,\r\n  userAdminPageFailedAction,\r\n  ldapConnectionInfoLoadedAction,\r\n  ldapSyncStatusLoadedAction,\r\n  userMappingInfoLoadedAction,\r\n  userMappingInfoFailedAction,\r\n  clearUserMappingInfoAction,\r\n  clearUserErrorAction,\r\n  ldapFailedAction,\r\n} from './reducers';\r\n\r\n// UserAdminPage\r\n\r\nexport function loadAdminUserPage(userId: number): ThunkResult<void> {\r\n  return async dispatch => {\r\n    try {\r\n      dispatch(userAdminPageLoadedAction(false));\r\n      await dispatch(loadUserProfile(userId));\r\n      await dispatch(loadUserOrgs(userId));\r\n      await dispatch(loadUserSessions(userId));\r\n      if (config.ldapEnabled && config.licenseInfo.hasLicense) {\r\n        await dispatch(loadLdapSyncStatus());\r\n      }\r\n      dispatch(userAdminPageLoadedAction(true));\r\n    } catch (error) {\r\n      console.log(error);\r\n      error.isHandled = true;\r\n      const userError = {\r\n        title: error.data.message,\r\n        body: error.data.error,\r\n      };\r\n      dispatch(userAdminPageFailedAction(userError));\r\n    }\r\n  };\r\n}\r\n\r\nexport function loadUserProfile(userId: number): ThunkResult<void> {\r\n  return async dispatch => {\r\n    const user = await getBackendSrv().get(`/api/users/${userId}`);\r\n    dispatch(userProfileLoadedAction(user));\r\n  };\r\n}\r\n\r\nexport function updateUser(user: UserDTO): ThunkResult<void> {\r\n  return async dispatch => {\r\n    await getBackendSrv().put(`/api/users/${user.id}`, user);\r\n    dispatch(loadAdminUserPage(user.id));\r\n  };\r\n}\r\n\r\nexport function setUserPassword(userId: number, password: string): ThunkResult<void> {\r\n  return async dispatch => {\r\n    const payload = { password };\r\n    await getBackendSrv().put(`/api/admin/users/${userId}/password`, payload);\r\n    dispatch(loadAdminUserPage(userId));\r\n  };\r\n}\r\n\r\nexport function disableUser(userId: number): ThunkResult<void> {\r\n  return async dispatch => {\r\n    await getBackendSrv().post(`/api/admin/users/${userId}/disable`);\r\n    // dispatch(loadAdminUserPage(userId));\r\n    dispatch(updateLocation({ path: '/admin/users' }));\r\n  };\r\n}\r\n\r\nexport function enableUser(userId: number): ThunkResult<void> {\r\n  return async dispatch => {\r\n    await getBackendSrv().post(`/api/admin/users/${userId}/enable`);\r\n    dispatch(loadAdminUserPage(userId));\r\n  };\r\n}\r\n\r\nexport function deleteUser(userId: number): ThunkResult<void> {\r\n  return async dispatch => {\r\n    await getBackendSrv().delete(`/api/admin/users/${userId}`);\r\n    dispatch(updateLocation({ path: '/admin/users' }));\r\n  };\r\n}\r\n\r\nexport function updateUserPermissions(userId: number, isGrafanaAdmin: boolean): ThunkResult<void> {\r\n  return async dispatch => {\r\n    const payload = { isGrafanaAdmin };\r\n    await getBackendSrv().put(`/api/admin/users/${userId}/permissions`, payload);\r\n    dispatch(loadAdminUserPage(userId));\r\n  };\r\n}\r\n\r\nexport function loadUserOrgs(userId: number): ThunkResult<void> {\r\n  return async dispatch => {\r\n    const orgs = await getBackendSrv().get(`/api/users/${userId}/orgs`);\r\n    dispatch(userOrgsLoadedAction(orgs));\r\n  };\r\n}\r\n\r\nexport function addOrgUser(user: UserDTO, orgId: number, role: string): ThunkResult<void> {\r\n  return async dispatch => {\r\n    const payload = {\r\n      loginOrEmail: user.login,\r\n      role: role,\r\n    };\r\n    await getBackendSrv().post(`/api/orgs/${orgId}/users/`, payload);\r\n    dispatch(loadAdminUserPage(user.id));\r\n  };\r\n}\r\n\r\nexport function updateOrgUserRole(userId: number, orgId: number, role: string): ThunkResult<void> {\r\n  return async dispatch => {\r\n    const payload = { role };\r\n    await getBackendSrv().patch(`/api/orgs/${orgId}/users/${userId}`, payload);\r\n    dispatch(loadAdminUserPage(userId));\r\n  };\r\n}\r\n\r\nexport function deleteOrgUser(userId: number, orgId: number): ThunkResult<void> {\r\n  return async dispatch => {\r\n    await getBackendSrv().delete(`/api/orgs/${orgId}/users/${userId}`);\r\n    dispatch(loadAdminUserPage(userId));\r\n  };\r\n}\r\n\r\nexport function loadUserSessions(userId: number): ThunkResult<void> {\r\n  return async dispatch => {\r\n    const tokens = await getBackendSrv().get(`/api/admin/users/${userId}/auth-tokens`);\r\n    tokens.reverse();\r\n    const sessions = tokens.map((session: UserSession) => {\r\n      return {\r\n        id: session.id,\r\n        isActive: session.isActive,\r\n        seenAt: dateTime(session.seenAt).fromNow(),\r\n        createdAt: dateTime(session.createdAt).format('MMMM DD, YYYY'),\r\n        clientIp: session.clientIp,\r\n        browser: session.browser,\r\n        browserVersion: session.browserVersion,\r\n        os: session.os,\r\n        osVersion: session.osVersion,\r\n        device: session.device,\r\n      };\r\n    });\r\n    dispatch(userSessionsLoadedAction(sessions));\r\n  };\r\n}\r\n\r\nexport function revokeSession(tokenId: number, userId: number): ThunkResult<void> {\r\n  return async dispatch => {\r\n    const payload = { authTokenId: tokenId };\r\n    await getBackendSrv().post(`/api/admin/users/${userId}/revoke-auth-token`, payload);\r\n    dispatch(loadUserSessions(userId));\r\n  };\r\n}\r\n\r\nexport function revokeAllSessions(userId: number): ThunkResult<void> {\r\n  return async dispatch => {\r\n    await getBackendSrv().post(`/api/admin/users/${userId}/logout`);\r\n    dispatch(loadUserSessions(userId));\r\n  };\r\n}\r\n\r\n// LDAP user actions\r\n\r\nexport function loadLdapSyncStatus(): ThunkResult<void> {\r\n  return async dispatch => {\r\n    // Available only in enterprise\r\n    if (config.licenseInfo.hasLicense) {\r\n      const syncStatus = await getBackendSrv().get(`/api/admin/ldap-sync-status`);\r\n      dispatch(ldapSyncStatusLoadedAction(syncStatus));\r\n    }\r\n  };\r\n}\r\n\r\nexport function syncLdapUser(userId: number): ThunkResult<void> {\r\n  return async dispatch => {\r\n    await getBackendSrv().post(`/api/admin/ldap/sync/${userId}`);\r\n    dispatch(loadAdminUserPage(userId));\r\n  };\r\n}\r\n\r\n// LDAP debug page\r\n\r\nexport function loadLdapState(): ThunkResult<void> {\r\n  return async dispatch => {\r\n    try {\r\n      const connectionInfo = await getBackendSrv().get(`/api/admin/ldap/status`);\r\n      dispatch(ldapConnectionInfoLoadedAction(connectionInfo));\r\n    } catch (error) {\r\n      error.isHandled = true;\r\n      const ldapError = {\r\n        title: error.data.message,\r\n        body: error.data.error,\r\n      };\r\n      dispatch(ldapFailedAction(ldapError));\r\n    }\r\n  };\r\n}\r\n\r\nexport function loadUserMapping(username: string): ThunkResult<void> {\r\n  return async dispatch => {\r\n    try {\r\n      const response = await getBackendSrv().get(`/api/admin/ldap/${username}`);\r\n      const { name, surname, email, login, isGrafanaAdmin, isDisabled, roles, teams } = response;\r\n      const userInfo: LdapUser = {\r\n        info: { name, surname, email, login },\r\n        permissions: { isGrafanaAdmin, isDisabled },\r\n        roles,\r\n        teams,\r\n      };\r\n      dispatch(userMappingInfoLoadedAction(userInfo));\r\n    } catch (error) {\r\n      error.isHandled = true;\r\n      const userError = {\r\n        title: error.data.message,\r\n        body: error.data.error,\r\n      };\r\n      dispatch(clearUserMappingInfoAction());\r\n      dispatch(userMappingInfoFailedAction(userError));\r\n    }\r\n  };\r\n}\r\n\r\nexport function clearUserError(): ThunkResult<void> {\r\n  return dispatch => {\r\n    dispatch(clearUserErrorAction());\r\n  };\r\n}\r\n\r\nexport function clearUserMappingInfo(): ThunkResult<void> {\r\n  return dispatch => {\r\n    dispatch(clearUserErrorAction());\r\n    dispatch(clearUserMappingInfoAction());\r\n  };\r\n}\r\n","import { createSlice, PayloadAction } from '@reduxjs/toolkit';\r\nimport {\r\n  LdapConnectionInfo,\r\n  LdapError,\r\n  LdapState,\r\n  LdapUser,\r\n  SyncInfo,\r\n  UserAdminState,\r\n  UserDTO,\r\n  UserOrg,\r\n  UserSession,\r\n  UserAdminError,\r\n} from 'app/types';\r\n\r\nconst initialLdapState: LdapState = {\r\n  connectionInfo: [],\r\n  syncInfo: null,\r\n  user: null,\r\n  connectionError: null,\r\n  userError: null,\r\n};\r\n\r\nconst ldapSlice = createSlice({\r\n  name: 'ldap',\r\n  initialState: initialLdapState,\r\n  reducers: {\r\n    ldapConnectionInfoLoadedAction: (state, action: PayloadAction<LdapConnectionInfo>): LdapState => ({\r\n      ...state,\r\n      ldapError: null,\r\n      connectionInfo: action.payload,\r\n    }),\r\n    ldapFailedAction: (state, action: PayloadAction<LdapError>): LdapState => ({\r\n      ...state,\r\n      ldapError: action.payload,\r\n    }),\r\n    ldapSyncStatusLoadedAction: (state, action: PayloadAction<SyncInfo>): LdapState => ({\r\n      ...state,\r\n      syncInfo: action.payload,\r\n    }),\r\n    userMappingInfoLoadedAction: (state, action: PayloadAction<LdapUser>): LdapState => ({\r\n      ...state,\r\n      user: action.payload,\r\n      userError: null,\r\n    }),\r\n    userMappingInfoFailedAction: (state, action: PayloadAction<LdapError>): LdapState => ({\r\n      ...state,\r\n      user: null,\r\n      userError: action.payload,\r\n    }),\r\n    clearUserMappingInfoAction: (state, action: PayloadAction<undefined>): LdapState => ({\r\n      ...state,\r\n      user: null,\r\n    }),\r\n    clearUserErrorAction: (state, action: PayloadAction<undefined>): LdapState => ({\r\n      ...state,\r\n      userError: null,\r\n    }),\r\n  },\r\n});\r\n\r\nexport const {\r\n  clearUserErrorAction,\r\n  clearUserMappingInfoAction,\r\n  ldapConnectionInfoLoadedAction,\r\n  ldapFailedAction,\r\n  ldapSyncStatusLoadedAction,\r\n  userMappingInfoFailedAction,\r\n  userMappingInfoLoadedAction,\r\n} = ldapSlice.actions;\r\n\r\nexport const ldapReducer = ldapSlice.reducer;\r\n\r\n// UserAdminPage\r\n\r\nconst initialUserAdminState: UserAdminState = {\r\n  user: null,\r\n  sessions: [],\r\n  orgs: [],\r\n  isLoading: true,\r\n};\r\n\r\nexport const userAdminSlice = createSlice({\r\n  name: 'userAdmin',\r\n  initialState: initialUserAdminState,\r\n  reducers: {\r\n    userProfileLoadedAction: (state, action: PayloadAction<UserDTO>): UserAdminState => ({\r\n      ...state,\r\n      user: action.payload,\r\n    }),\r\n    userOrgsLoadedAction: (state, action: PayloadAction<UserOrg[]>): UserAdminState => ({\r\n      ...state,\r\n      orgs: action.payload,\r\n    }),\r\n    userSessionsLoadedAction: (state, action: PayloadAction<UserSession[]>): UserAdminState => ({\r\n      ...state,\r\n      sessions: action.payload,\r\n    }),\r\n    userAdminPageLoadedAction: (state, action: PayloadAction<boolean>): UserAdminState => ({\r\n      ...state,\r\n      isLoading: !action.payload,\r\n    }),\r\n    userAdminPageFailedAction: (state, action: PayloadAction<UserAdminError>): UserAdminState => ({\r\n      ...state,\r\n      error: action.payload,\r\n      isLoading: false,\r\n    }),\r\n  },\r\n});\r\n\r\nexport const {\r\n  userProfileLoadedAction,\r\n  userOrgsLoadedAction,\r\n  userSessionsLoadedAction,\r\n  userAdminPageLoadedAction,\r\n  userAdminPageFailedAction,\r\n} = userAdminSlice.actions;\r\n\r\nexport const userAdminReducer = userAdminSlice.reducer;\r\n\r\nexport default {\r\n  ldap: ldapReducer,\r\n  userAdmin: userAdminReducer,\r\n};\r\n","import _ from 'lodash';\r\nimport coreModule from 'app/core/core_module';\r\nimport { ThresholdMapper } from './state/ThresholdMapper';\r\nimport { QueryPart } from 'app/core/components/query_part/query_part';\r\nimport alertDef from './state/alertDef';\r\nimport config from 'app/core/config';\r\nimport appEvents from 'app/core/app_events';\r\nimport { BackendSrv } from 'app/core/services/backend_srv';\r\nimport { DashboardSrv } from '../dashboard/services/DashboardSrv';\r\nimport DatasourceSrv from '../plugins/datasource_srv';\r\nimport { DataQuery, DataSourceApi } from '@grafana/data';\r\nimport { PanelModel } from 'app/features/dashboard/state';\r\nimport { getDefaultCondition } from './getAlertingValidationMessage';\r\nimport { CoreEvents } from 'app/types';\r\nimport kbn from 'app/core/utils/kbn';\r\n\r\nexport class AlertTabCtrl {\r\n  panel: PanelModel;\r\n  panelCtrl: any;\r\n  subTabIndex: number;\r\n  conditionTypes: any;\r\n  alert: any;\r\n  conditionModels: any;\r\n  evalFunctions: any;\r\n  evalOperators: any;\r\n  noDataModes: any;\r\n  executionErrorModes: any;\r\n  addNotificationSegment: any;\r\n  notifications: any;\r\n  alertNotifications: any;\r\n  error: string;\r\n  appSubUrl: string;\r\n  alertHistory: any;\r\n  newAlertRuleTag: any;\r\n  alertingMinIntervalSecs: number;\r\n  alertingMinInterval: string;\r\n  frequencyWarning: any;\r\n\r\n  /** @ngInject */\r\n  constructor(\r\n    private $scope: any,\r\n    private backendSrv: BackendSrv,\r\n    private dashboardSrv: DashboardSrv,\r\n    private uiSegmentSrv: any,\r\n    private datasourceSrv: DatasourceSrv\r\n  ) {\r\n    this.panelCtrl = $scope.ctrl;\r\n    this.panel = this.panelCtrl.panel;\r\n    this.$scope.ctrl = this;\r\n    this.subTabIndex = 0;\r\n    this.evalFunctions = alertDef.evalFunctions;\r\n    this.evalOperators = alertDef.evalOperators;\r\n    this.conditionTypes = alertDef.conditionTypes;\r\n    this.noDataModes = alertDef.noDataModes;\r\n    this.executionErrorModes = alertDef.executionErrorModes;\r\n    this.appSubUrl = config.appSubUrl;\r\n    this.panelCtrl._enableAlert = this.enable;\r\n    this.alertingMinIntervalSecs = config.alertingMinInterval;\r\n    this.alertingMinInterval = kbn.secondsToHms(config.alertingMinInterval);\r\n  }\r\n\r\n  $onInit() {\r\n    this.addNotificationSegment = this.uiSegmentSrv.newPlusButton();\r\n\r\n    // subscribe to graph threshold handle changes\r\n    const thresholdChangedEventHandler = this.graphThresholdChanged.bind(this);\r\n    this.panelCtrl.events.on(CoreEvents.thresholdChanged, thresholdChangedEventHandler);\r\n\r\n    // set panel alert edit mode\r\n    this.$scope.$on('$destroy', () => {\r\n      this.panelCtrl.events.off(CoreEvents.thresholdChanged, thresholdChangedEventHandler);\r\n      this.panelCtrl.editingThresholds = false;\r\n      this.panelCtrl.render();\r\n    });\r\n\r\n    // build notification model\r\n    this.notifications = [];\r\n    this.alertNotifications = [];\r\n    this.alertHistory = [];\r\n\r\n    return this.backendSrv.get('/api/alert-notifications/lookup').then((res: any) => {\r\n      this.notifications = res;\r\n\r\n      this.initModel();\r\n      this.validateModel();\r\n    });\r\n  }\r\n\r\n  getAlertHistory() {\r\n    this.backendSrv\r\n      .get(`/api/annotations?dashboardId=${this.panelCtrl.dashboard.id}&panelId=${this.panel.id}&limit=50&type=alert`)\r\n      .then((res: any) => {\r\n        this.alertHistory = _.map(res, ah => {\r\n          ah.time = this.dashboardSrv.getCurrent().formatDate(ah.time, 'MMM D, YYYY HH:mm:ss');\r\n          ah.stateModel = alertDef.getStateDisplayModel(ah.newState);\r\n          ah.info = alertDef.getAlertAnnotationInfo(ah);\r\n          return ah;\r\n        });\r\n      });\r\n  }\r\n\r\n  getNotificationIcon(type: string): string {\r\n    switch (type) {\r\n      case 'email':\r\n        return 'fa fa-envelope';\r\n      case 'slack':\r\n        return 'fa fa-slack';\r\n      case 'victorops':\r\n        return 'fa fa-pagelines';\r\n      case 'webhook':\r\n        return 'fa fa-cubes';\r\n      case 'pagerduty':\r\n        return 'fa fa-bullhorn';\r\n      case 'opsgenie':\r\n        return 'fa fa-bell';\r\n      case 'hipchat':\r\n        return 'fa fa-mail-forward';\r\n      case 'pushover':\r\n        return 'fa fa-mobile';\r\n      case 'kafka':\r\n        return 'fa fa-random';\r\n      case 'teams':\r\n        return 'fa fa-windows';\r\n    }\r\n    return 'fa fa-bell';\r\n  }\r\n\r\n  getNotifications() {\r\n    return Promise.resolve(\r\n      this.notifications.map((item: any) => {\r\n        return this.uiSegmentSrv.newSegment(item.name);\r\n      })\r\n    );\r\n  }\r\n\r\n  notificationAdded() {\r\n    const model: any = _.find(this.notifications, {\r\n      name: this.addNotificationSegment.value,\r\n    });\r\n    if (!model) {\r\n      return;\r\n    }\r\n\r\n    this.alertNotifications.push({\r\n      name: model.name,\r\n      iconClass: this.getNotificationIcon(model.type),\r\n      isDefault: false,\r\n      uid: model.uid,\r\n    });\r\n\r\n    // avoid duplicates using both id and uid to be backwards compatible.\r\n    if (!_.find(this.alert.notifications, n => n.id === model.id || n.uid === model.uid)) {\r\n      this.alert.notifications.push({ uid: model.uid });\r\n    }\r\n\r\n    // reset plus button\r\n    this.addNotificationSegment.value = this.uiSegmentSrv.newPlusButton().value;\r\n    this.addNotificationSegment.html = this.uiSegmentSrv.newPlusButton().html;\r\n    this.addNotificationSegment.fake = true;\r\n  }\r\n\r\n  removeNotification(an: any) {\r\n    // remove notifiers refeered to by id and uid to support notifiers added\r\n    // before and after we added support for uid\r\n    _.remove(this.alert.notifications, (n: any) => n.uid === an.uid || n.id === an.id);\r\n    _.remove(this.alertNotifications, (n: any) => n.uid === an.uid || n.id === an.id);\r\n  }\r\n\r\n  addAlertRuleTag() {\r\n    if (this.newAlertRuleTag.name) {\r\n      this.alert.alertRuleTags[this.newAlertRuleTag.name] = this.newAlertRuleTag.value;\r\n    }\r\n    this.newAlertRuleTag.name = '';\r\n    this.newAlertRuleTag.value = '';\r\n  }\r\n\r\n  removeAlertRuleTag(tagName: string) {\r\n    delete this.alert.alertRuleTags[tagName];\r\n  }\r\n\r\n  initModel() {\r\n    const alert = (this.alert = this.panel.alert);\r\n    if (!alert) {\r\n      return;\r\n    }\r\n\r\n    this.checkFrequency();\r\n\r\n    alert.conditions = alert.conditions || [];\r\n    if (alert.conditions.length === 0) {\r\n      alert.conditions.push(getDefaultCondition());\r\n    }\r\n\r\n    alert.noDataState = alert.noDataState || config.alertingNoDataOrNullValues;\r\n    alert.executionErrorState = alert.executionErrorState || config.alertingErrorOrTimeout;\r\n    alert.frequency = alert.frequency || '1m';\r\n    alert.handler = alert.handler || 1;\r\n    alert.notifications = alert.notifications || [];\r\n    alert.for = alert.for || '0m';\r\n    alert.alertRuleTags = alert.alertRuleTags || {};\r\n\r\n    const defaultName = this.panel.title + ' alert';\r\n    alert.name = alert.name || defaultName;\r\n\r\n    this.conditionModels = _.reduce(\r\n      alert.conditions,\r\n      (memo, value) => {\r\n        memo.push(this.buildConditionModel(value));\r\n        return memo;\r\n      },\r\n      []\r\n    );\r\n\r\n    ThresholdMapper.alertToGraphThresholds(this.panel);\r\n\r\n    for (const addedNotification of alert.notifications) {\r\n      // lookup notifier type by uid\r\n      let model: any = _.find(this.notifications, { uid: addedNotification.uid });\r\n\r\n      // fallback to using id if uid is missing\r\n      if (!model) {\r\n        model = _.find(this.notifications, { id: addedNotification.id });\r\n      }\r\n\r\n      if (model && model.isDefault === false) {\r\n        model.iconClass = this.getNotificationIcon(model.type);\r\n        this.alertNotifications.push(model);\r\n      }\r\n    }\r\n\r\n    for (const notification of this.notifications) {\r\n      if (notification.isDefault) {\r\n        notification.iconClass = this.getNotificationIcon(notification.type);\r\n        notification.bgColor = '#00678b';\r\n        this.alertNotifications.push(notification);\r\n      }\r\n    }\r\n\r\n    this.panelCtrl.editingThresholds = true;\r\n    this.panelCtrl.render();\r\n  }\r\n\r\n  checkFrequency() {\r\n    if (!this.alert.frequency) {\r\n      return;\r\n    }\r\n\r\n    this.frequencyWarning = '';\r\n\r\n    try {\r\n      const frequencySecs = kbn.interval_to_seconds(this.alert.frequency);\r\n      if (frequencySecs < this.alertingMinIntervalSecs) {\r\n        this.frequencyWarning =\r\n          'A minimum evaluation interval of ' +\r\n          this.alertingMinInterval +\r\n          ' have been configured in Grafana and will be used for this alert rule. ' +\r\n          'Please contact the administrator to configure a lower interval.';\r\n      }\r\n    } catch (err) {\r\n      this.frequencyWarning = err;\r\n    }\r\n  }\r\n\r\n  graphThresholdChanged(evt: any) {\r\n    for (const condition of this.alert.conditions) {\r\n      if (condition.type === 'query') {\r\n        condition.evaluator.params[evt.handleIndex] = evt.threshold.value;\r\n        this.evaluatorParamsChanged();\r\n        break;\r\n      }\r\n    }\r\n  }\r\n\r\n  validateModel() {\r\n    if (!this.alert) {\r\n      return;\r\n    }\r\n\r\n    let firstTarget;\r\n    let foundTarget: DataQuery = null;\r\n\r\n    const promises: Array<Promise<any>> = [];\r\n    for (const condition of this.alert.conditions) {\r\n      if (condition.type !== 'query') {\r\n        continue;\r\n      }\r\n\r\n      for (const target of this.panel.targets) {\r\n        if (!firstTarget) {\r\n          firstTarget = target;\r\n        }\r\n        if (condition.query.params[0] === target.refId) {\r\n          foundTarget = target;\r\n          break;\r\n        }\r\n      }\r\n\r\n      if (!foundTarget) {\r\n        if (firstTarget) {\r\n          condition.query.params[0] = firstTarget.refId;\r\n          foundTarget = firstTarget;\r\n        } else {\r\n          this.error = 'Could not find any metric queries';\r\n          return;\r\n        }\r\n      }\r\n\r\n      const datasourceName = foundTarget.datasource || this.panel.datasource;\r\n      promises.push(\r\n        this.datasourceSrv.get(datasourceName).then(\r\n          (foundTarget => (ds: DataSourceApi) => {\r\n            if (!ds.meta.alerting) {\r\n              return Promise.reject('The datasource does not support alerting queries');\r\n            } else if (ds.targetContainsTemplate && ds.targetContainsTemplate(foundTarget)) {\r\n              return Promise.reject('Template variables are not supported in alert queries');\r\n            }\r\n            return Promise.resolve();\r\n          })(foundTarget)\r\n        )\r\n      );\r\n    }\r\n    Promise.all(promises).then(\r\n      () => {\r\n        this.error = '';\r\n        this.$scope.$apply();\r\n      },\r\n      e => {\r\n        this.error = e;\r\n        this.$scope.$apply();\r\n      }\r\n    );\r\n  }\r\n\r\n  buildConditionModel(source: any) {\r\n    const cm: any = { source: source, type: source.type };\r\n\r\n    cm.queryPart = new QueryPart(source.query, alertDef.alertQueryDef);\r\n    cm.reducerPart = alertDef.createReducerPart(source.reducer);\r\n    cm.evaluator = source.evaluator;\r\n    cm.operator = source.operator;\r\n\r\n    return cm;\r\n  }\r\n\r\n  handleQueryPartEvent(conditionModel: any, evt: any) {\r\n    switch (evt.name) {\r\n      case 'action-remove-part': {\r\n        break;\r\n      }\r\n      case 'get-part-actions': {\r\n        return Promise.resolve([]);\r\n      }\r\n      case 'part-param-changed': {\r\n        this.validateModel();\r\n      }\r\n      case 'get-param-options': {\r\n        const result = this.panel.targets.map(target => {\r\n          return this.uiSegmentSrv.newSegment({ value: target.refId });\r\n        });\r\n\r\n        return Promise.resolve(result);\r\n      }\r\n      default: {\r\n        return Promise.resolve();\r\n      }\r\n    }\r\n\r\n    return Promise.resolve();\r\n  }\r\n\r\n  handleReducerPartEvent(conditionModel: any, evt: any) {\r\n    switch (evt.name) {\r\n      case 'action': {\r\n        conditionModel.source.reducer.type = evt.action.value;\r\n        conditionModel.reducerPart = alertDef.createReducerPart(conditionModel.source.reducer);\r\n        break;\r\n      }\r\n      case 'get-part-actions': {\r\n        const result = [];\r\n        for (const type of alertDef.reducerTypes) {\r\n          if (type.value !== conditionModel.source.reducer.type) {\r\n            result.push(type);\r\n          }\r\n        }\r\n        return Promise.resolve(result);\r\n      }\r\n    }\r\n\r\n    return Promise.resolve();\r\n  }\r\n\r\n  addCondition(type: string) {\r\n    const condition = getDefaultCondition();\r\n    // add to persited model\r\n    this.alert.conditions.push(condition);\r\n    // add to view model\r\n    this.conditionModels.push(this.buildConditionModel(condition));\r\n  }\r\n\r\n  removeCondition(index: number) {\r\n    this.alert.conditions.splice(index, 1);\r\n    this.conditionModels.splice(index, 1);\r\n  }\r\n\r\n  delete() {\r\n    appEvents.emit(CoreEvents.showConfirmModal, {\r\n      title: 'Delete Alert',\r\n      text: 'Are you sure you want to delete this alert rule?',\r\n      text2: 'You need to save dashboard for the delete to take effect',\r\n      icon: 'fa-trash',\r\n      yesText: 'Delete',\r\n      onConfirm: () => {\r\n        delete this.panel.alert;\r\n        this.alert = null;\r\n        this.panel.thresholds = [];\r\n        this.conditionModels = [];\r\n        this.panelCtrl.alertState = null;\r\n        this.panelCtrl.render();\r\n      },\r\n    });\r\n  }\r\n\r\n  enable = () => {\r\n    this.panel.alert = {};\r\n    this.initModel();\r\n    this.panel.alert.for = '5m'; //default value for new alerts. for existing alerts we use 0m to avoid breaking changes\r\n  };\r\n\r\n  evaluatorParamsChanged() {\r\n    ThresholdMapper.alertToGraphThresholds(this.panel);\r\n    this.panelCtrl.render();\r\n  }\r\n\r\n  evaluatorTypeChanged(evaluator: any) {\r\n    // ensure params array is correct length\r\n    switch (evaluator.type) {\r\n      case 'lt':\r\n      case 'gt': {\r\n        evaluator.params = [evaluator.params[0]];\r\n        break;\r\n      }\r\n      case 'within_range':\r\n      case 'outside_range': {\r\n        evaluator.params = [evaluator.params[0], evaluator.params[1]];\r\n        break;\r\n      }\r\n      case 'no_value': {\r\n        evaluator.params = [];\r\n      }\r\n    }\r\n\r\n    this.evaluatorParamsChanged();\r\n  }\r\n\r\n  clearHistory() {\r\n    appEvents.emit(CoreEvents.showConfirmModal, {\r\n      title: 'Delete Alert History',\r\n      text: 'Are you sure you want to remove all history & annotations for this alert?',\r\n      icon: 'fa-trash',\r\n      yesText: 'Yes',\r\n      onConfirm: () => {\r\n        this.backendSrv\r\n          .post('/api/annotations/mass-delete', {\r\n            dashboardId: this.panelCtrl.dashboard.id,\r\n            panelId: this.panel.id,\r\n          })\r\n          .then(() => {\r\n            this.alertHistory = [];\r\n            this.panelCtrl.refresh();\r\n          });\r\n      },\r\n    });\r\n  }\r\n}\r\n\r\n/** @ngInject */\r\nexport function alertTab() {\r\n  'use strict';\r\n  return {\r\n    restrict: 'E',\r\n    scope: true,\r\n    templateUrl: 'public/app/features/alerting/partials/alert_tab.html',\r\n    controller: AlertTabCtrl,\r\n  };\r\n}\r\n\r\ncoreModule.directive('alertTab', alertTab);\r\n","import _ from 'lodash';\r\nimport { appEvents, coreModule, NavModelSrv } from 'app/core/core';\r\nimport { BackendSrv } from 'app/core/services/backend_srv';\r\nimport { AppEvents } from '@grafana/data';\r\n\r\nexport class AlertNotificationEditCtrl {\r\n  theForm: any;\r\n  navModel: any;\r\n  testSeverity = 'critical';\r\n  notifiers: any;\r\n  notifierTemplateId: string;\r\n  isNew: boolean;\r\n  model: any;\r\n  defaults: any = {\r\n    type: 'email',\r\n    sendReminder: false,\r\n    disableResolveMessage: false,\r\n    frequency: '15m',\r\n    settings: {\r\n      httpMethod: 'POST',\r\n      autoResolve: true,\r\n      severity: 'critical',\r\n      uploadImage: true,\r\n    },\r\n    isDefault: false,\r\n  };\r\n  getFrequencySuggestion: any;\r\n\r\n  /** @ngInject */\r\n  constructor(\r\n    private $routeParams: any,\r\n    private backendSrv: BackendSrv,\r\n    private $location: any,\r\n    private $templateCache: any,\r\n    navModelSrv: NavModelSrv\r\n  ) {\r\n    this.navModel = navModelSrv.getNav('alerting', 'channels', 0);\r\n    this.isNew = !this.$routeParams.id;\r\n\r\n    this.getFrequencySuggestion = () => {\r\n      return ['1m', '5m', '10m', '15m', '30m', '1h'];\r\n    };\r\n\r\n    this.backendSrv\r\n      .get(`/api/alert-notifiers`)\r\n      .then((notifiers: any) => {\r\n        this.notifiers = notifiers;\r\n\r\n        // add option templates\r\n        for (const notifier of this.notifiers) {\r\n          this.$templateCache.put(this.getNotifierTemplateId(notifier.type), notifier.optionsTemplate);\r\n        }\r\n\r\n        if (!this.$routeParams.id) {\r\n          this.navModel.breadcrumbs.push({ text: 'New channel' });\r\n          this.navModel.node = { text: 'New channel' };\r\n          return _.defaults(this.model, this.defaults);\r\n        }\r\n\r\n        return this.backendSrv.get(`/api/alert-notifications/${this.$routeParams.id}`).then((result: any) => {\r\n          this.navModel.breadcrumbs.push({ text: result.name });\r\n          this.navModel.node = { text: result.name };\r\n          result.settings = _.defaults(result.settings, this.defaults.settings);\r\n          return result;\r\n        });\r\n      })\r\n      .then((model: any) => {\r\n        this.model = model;\r\n        this.notifierTemplateId = this.getNotifierTemplateId(this.model.type);\r\n      });\r\n  }\r\n\r\n  save() {\r\n    if (!this.theForm.$valid) {\r\n      return;\r\n    }\r\n\r\n    if (this.model.id) {\r\n      this.backendSrv\r\n        .put(`/api/alert-notifications/${this.model.id}`, this.model)\r\n        .then((res: any) => {\r\n          this.model = res;\r\n          appEvents.emit(AppEvents.alertSuccess, ['Notification updated']);\r\n        })\r\n        .catch((err: any) => {\r\n          if (err.data && err.data.error) {\r\n            appEvents.emit(AppEvents.alertError, [err.data.error]);\r\n          }\r\n        });\r\n    } else {\r\n      this.backendSrv\r\n        .post(`/api/alert-notifications`, this.model)\r\n        .then((res: any) => {\r\n          appEvents.emit(AppEvents.alertSuccess, ['Notification created']);\r\n          this.$location.path('alerting/notifications');\r\n        })\r\n        .catch((err: any) => {\r\n          if (err.data && err.data.error) {\r\n            appEvents.emit(AppEvents.alertError, [err.data.error]);\r\n          }\r\n        });\r\n    }\r\n  }\r\n\r\n  deleteNotification() {\r\n    this.backendSrv.delete(`/api/alert-notifications/${this.model.id}`).then((res: any) => {\r\n      this.model = res;\r\n      this.$location.path('alerting/notifications');\r\n    });\r\n  }\r\n\r\n  getNotifierTemplateId(type: string) {\r\n    return `notifier-options-${type}`;\r\n  }\r\n\r\n  typeChanged() {\r\n    this.model.settings = _.defaults({}, this.defaults.settings);\r\n    this.notifierTemplateId = this.getNotifierTemplateId(this.model.type);\r\n  }\r\n\r\n  testNotification() {\r\n    if (!this.theForm.$valid) {\r\n      return;\r\n    }\r\n\r\n    const payload = {\r\n      name: this.model.name,\r\n      type: this.model.type,\r\n      frequency: this.model.frequency,\r\n      settings: this.model.settings,\r\n    };\r\n\r\n    this.backendSrv.post(`/api/alert-notifications/test`, payload);\r\n  }\r\n}\r\n\r\ncoreModule.controller('AlertNotificationEditCtrl', AlertNotificationEditCtrl);\r\n","import { coreModule, NavModelSrv } from 'app/core/core';\r\nimport { BackendSrv } from 'app/core/services/backend_srv';\r\n\r\nexport class AlertNotificationsListCtrl {\r\n  notifications: any;\r\n  navModel: any;\r\n\r\n  /** @ngInject */\r\n  constructor(private backendSrv: BackendSrv, navModelSrv: NavModelSrv) {\r\n    this.loadNotifications();\r\n    this.navModel = navModelSrv.getNav('alerting', 'channels', 0);\r\n  }\r\n\r\n  loadNotifications() {\r\n    this.backendSrv.get(`/api/alert-notifications`).then((result: any) => {\r\n      this.notifications = result;\r\n    });\r\n  }\r\n\r\n  deleteNotification(id: number) {\r\n    this.backendSrv.delete(`/api/alert-notifications/${id}`).then(() => {\r\n      this.notifications = this.notifications.filter((notification: any) => {\r\n        return notification.id !== id;\r\n      });\r\n    });\r\n  }\r\n}\r\n\r\ncoreModule.controller('AlertNotificationsListCtrl', AlertNotificationsListCtrl);\r\n","import { DataQuery } from '@grafana/data';\r\nimport { DataSourceSrv } from '@grafana/runtime';\r\nimport { DataTransformerConfig } from '@grafana/data';\r\n\r\nexport const getDefaultCondition = () => ({\r\n  type: 'query',\r\n  query: { params: ['A', '5m', 'now'] },\r\n  reducer: { type: 'avg', params: [] as any[] },\r\n  evaluator: { type: 'gt', params: [null] as any[] },\r\n  operator: { type: 'and' },\r\n});\r\n\r\nexport const getAlertingValidationMessage = async (\r\n  transformations: DataTransformerConfig[],\r\n  targets: DataQuery[],\r\n  datasourceSrv: DataSourceSrv,\r\n  datasourceName: string\r\n): Promise<string> => {\r\n  if (targets.length === 0) {\r\n    return 'Could not find any metric queries';\r\n  }\r\n\r\n  if (transformations && transformations.length) {\r\n    return 'Transformations are not supported in alert queries';\r\n  }\r\n\r\n  let alertingNotSupported = 0;\r\n  let templateVariablesNotSupported = 0;\r\n\r\n  for (const target of targets) {\r\n    const dsName = target.datasource || datasourceName;\r\n    const ds = await datasourceSrv.get(dsName);\r\n    if (!ds.meta.alerting) {\r\n      alertingNotSupported++;\r\n    } else if (ds.targetContainsTemplate && ds.targetContainsTemplate(target)) {\r\n      templateVariablesNotSupported++;\r\n    }\r\n  }\r\n\r\n  if (alertingNotSupported === targets.length) {\r\n    return 'The datasource does not support alerting queries';\r\n  }\r\n\r\n  if (templateVariablesNotSupported === targets.length) {\r\n    return 'Template variables are not supported in alert queries';\r\n  }\r\n\r\n  return '';\r\n};\r\n","import { PanelModel } from 'app/features/dashboard/state';\r\n\r\nexport class ThresholdMapper {\r\n  static alertToGraphThresholds(panel: PanelModel) {\r\n    for (let i = 0; i < panel.alert.conditions.length; i++) {\r\n      const condition = panel.alert.conditions[i];\r\n      if (condition.type !== 'query') {\r\n        continue;\r\n      }\r\n\r\n      const evaluator = condition.evaluator;\r\n      const thresholds: any[] = (panel.thresholds = []);\r\n\r\n      switch (evaluator.type) {\r\n        case 'gt': {\r\n          const value = evaluator.params[0];\r\n          thresholds.push({ value: value, op: 'gt' });\r\n          break;\r\n        }\r\n        case 'lt': {\r\n          const value = evaluator.params[0];\r\n          thresholds.push({ value: value, op: 'lt' });\r\n          break;\r\n        }\r\n        case 'outside_range': {\r\n          const value1 = evaluator.params[0];\r\n          const value2 = evaluator.params[1];\r\n\r\n          if (value1 > value2) {\r\n            thresholds.push({ value: value1, op: 'gt' });\r\n            thresholds.push({ value: value2, op: 'lt' });\r\n          } else {\r\n            thresholds.push({ value: value1, op: 'lt' });\r\n            thresholds.push({ value: value2, op: 'gt' });\r\n          }\r\n\r\n          break;\r\n        }\r\n        case 'within_range': {\r\n          const value1 = evaluator.params[0];\r\n          const value2 = evaluator.params[1];\r\n\r\n          if (value1 > value2) {\r\n            thresholds.push({ value: value1, op: 'lt' });\r\n            thresholds.push({ value: value2, op: 'gt' });\r\n          } else {\r\n            thresholds.push({ value: value1, op: 'gt' });\r\n            thresholds.push({ value: value2, op: 'lt' });\r\n          }\r\n          break;\r\n        }\r\n      }\r\n      break;\r\n    }\r\n\r\n    for (const t of panel.thresholds) {\r\n      t.fill = true;\r\n      t.line = true;\r\n      t.colorMode = 'critical';\r\n    }\r\n\r\n    const updated = true;\r\n    return updated;\r\n  }\r\n}\r\n","import _ from 'lodash';\r\nimport { QueryPartDef, QueryPart } from 'app/core/components/query_part/query_part';\r\n\r\nconst alertQueryDef = new QueryPartDef({\r\n  type: 'query',\r\n  params: [\r\n    { name: 'queryRefId', type: 'string', dynamicLookup: true },\r\n    {\r\n      name: 'from',\r\n      type: 'string',\r\n      options: ['10s', '1m', '5m', '10m', '15m', '1h', '24h', '48h'],\r\n    },\r\n    { name: 'to', type: 'string', options: ['now', 'now-1m', 'now-5m', 'now-10m', 'now-1h'] },\r\n  ],\r\n  defaultParams: ['#A', '15m', 'now', 'avg'],\r\n});\r\n\r\nconst conditionTypes = [{ text: 'Query', value: 'query' }];\r\n\r\nconst alertStateSortScore = {\r\n  alerting: 1,\r\n  no_data: 2,\r\n  pending: 3,\r\n  ok: 4,\r\n  paused: 5,\r\n};\r\n\r\nconst evalFunctions = [\r\n  { text: 'IS ABOVE', value: 'gt' },\r\n  { text: 'IS BELOW', value: 'lt' },\r\n  { text: 'IS OUTSIDE RANGE', value: 'outside_range' },\r\n  { text: 'IS WITHIN RANGE', value: 'within_range' },\r\n  { text: 'HAS NO VALUE', value: 'no_value' },\r\n];\r\n\r\nconst evalOperators = [\r\n  { text: 'OR', value: 'or' },\r\n  { text: 'AND', value: 'and' },\r\n];\r\n\r\nconst reducerTypes = [\r\n  { text: 'avg()', value: 'avg' },\r\n  { text: 'min()', value: 'min' },\r\n  { text: 'max()', value: 'max' },\r\n  { text: 'sum()', value: 'sum' },\r\n  { text: 'count()', value: 'count' },\r\n  { text: 'last()', value: 'last' },\r\n  { text: 'median()', value: 'median' },\r\n  { text: 'diff()', value: 'diff' },\r\n  { text: 'percent_diff()', value: 'percent_diff' },\r\n  { text: 'count_non_null()', value: 'count_non_null' },\r\n];\r\n\r\nconst noDataModes = [\r\n  { text: 'Alerting', value: 'alerting' },\r\n  { text: 'No Data', value: 'no_data' },\r\n  { text: 'Keep Last State', value: 'keep_state' },\r\n  { text: 'Ok', value: 'ok' },\r\n];\r\n\r\nconst executionErrorModes = [\r\n  { text: 'Alerting', value: 'alerting' },\r\n  { text: 'Keep Last State', value: 'keep_state' },\r\n];\r\n\r\nfunction createReducerPart(model: any) {\r\n  const def = new QueryPartDef({ type: model.type, defaultParams: [] });\r\n  return new QueryPart(model, def);\r\n}\r\n\r\nfunction getStateDisplayModel(state: string) {\r\n  switch (state) {\r\n    case 'ok': {\r\n      return {\r\n        text: 'OK',\r\n        iconClass: 'icon-gf icon-gf-online',\r\n        stateClass: 'alert-state-ok',\r\n      };\r\n    }\r\n    case 'alerting': {\r\n      return {\r\n        text: 'ALERTING',\r\n        iconClass: 'icon-gf icon-gf-critical',\r\n        stateClass: 'alert-state-critical',\r\n      };\r\n    }\r\n    case 'no_data': {\r\n      return {\r\n        text: 'NO DATA',\r\n        iconClass: 'fa fa-question',\r\n        stateClass: 'alert-state-warning',\r\n      };\r\n    }\r\n    case 'paused': {\r\n      return {\r\n        text: 'PAUSED',\r\n        iconClass: 'fa fa-pause',\r\n        stateClass: 'alert-state-paused',\r\n      };\r\n    }\r\n    case 'pending': {\r\n      return {\r\n        text: 'PENDING',\r\n        iconClass: 'fa fa-exclamation',\r\n        stateClass: 'alert-state-warning',\r\n      };\r\n    }\r\n    case 'unknown': {\r\n      return {\r\n        text: 'UNKNOWN',\r\n        iconClass: 'fa fa-question',\r\n        stateClass: 'alert-state-paused',\r\n      };\r\n    }\r\n  }\r\n\r\n  throw { message: 'Unknown alert state' };\r\n}\r\n\r\nfunction joinEvalMatches(matches: any, separator: string) {\r\n  return _.reduce(\r\n    matches,\r\n    (res, ev) => {\r\n      if (ev.metric !== undefined && ev.value !== undefined) {\r\n        res.push(ev.metric + '=' + ev.value);\r\n      }\r\n\r\n      // For backwards compatibility . Should be be able to remove this after ~2017-06-01\r\n      if (ev.Metric !== undefined && ev.Value !== undefined) {\r\n        res.push(ev.Metric + '=' + ev.Value);\r\n      }\r\n\r\n      return res;\r\n    },\r\n    []\r\n  ).join(separator);\r\n}\r\n\r\nfunction getAlertAnnotationInfo(ah: any) {\r\n  // backward compatibility, can be removed in grafana 5.x\r\n  // old way stored evalMatches in data property directly,\r\n  // new way stores it in evalMatches property on new data object\r\n\r\n  if (_.isArray(ah.data)) {\r\n    return joinEvalMatches(ah.data, ', ');\r\n  } else if (_.isArray(ah.data.evalMatches)) {\r\n    return joinEvalMatches(ah.data.evalMatches, ', ');\r\n  }\r\n\r\n  if (ah.data.error) {\r\n    return 'Error: ' + ah.data.error;\r\n  }\r\n\r\n  return '';\r\n}\r\n\r\nexport default {\r\n  alertQueryDef: alertQueryDef,\r\n  getStateDisplayModel: getStateDisplayModel,\r\n  conditionTypes: conditionTypes,\r\n  evalFunctions: evalFunctions,\r\n  evalOperators: evalOperators,\r\n  noDataModes: noDataModes,\r\n  executionErrorModes: executionErrorModes,\r\n  reducerTypes: reducerTypes,\r\n  createReducerPart: createReducerPart,\r\n  getAlertAnnotationInfo: getAlertAnnotationInfo,\r\n  alertStateSortScore: alertStateSortScore,\r\n};\r\n","import { AlertRule, AlertRuleDTO, AlertRulesState } from 'app/types';\r\nimport alertDef from './alertDef';\r\nimport { dateTime } from '@grafana/data';\r\nimport { createSlice, PayloadAction } from '@reduxjs/toolkit';\r\n\r\nexport const initialState: AlertRulesState = { items: [], searchQuery: '', isLoading: false };\r\n\r\nfunction convertToAlertRule(dto: AlertRuleDTO, state: string): AlertRule {\r\n  const stateModel = alertDef.getStateDisplayModel(state);\r\n\r\n  const rule: AlertRule = {\r\n    ...dto,\r\n    stateText: stateModel.text,\r\n    stateIcon: stateModel.iconClass,\r\n    stateClass: stateModel.stateClass,\r\n    stateAge: dateTime(dto.newStateDate).fromNow(true),\r\n  };\r\n\r\n  if (rule.state !== 'paused') {\r\n    if (rule.executionError) {\r\n      rule.info = 'Execution Error: ' + rule.executionError;\r\n    }\r\n    if (rule.evalData && rule.evalData.noData) {\r\n      rule.info = 'Query returned no data';\r\n    }\r\n  }\r\n\r\n  return rule;\r\n}\r\n\r\nconst alertRulesSlice = createSlice({\r\n  name: 'alertRules',\r\n  initialState,\r\n  reducers: {\r\n    loadAlertRules: state => {\r\n      return { ...state, isLoading: true };\r\n    },\r\n    loadedAlertRules: (state, action: PayloadAction<AlertRuleDTO[]>): AlertRulesState => {\r\n      const alertRules: AlertRuleDTO[] = action.payload;\r\n\r\n      const alertRulesViewModel: AlertRule[] = alertRules.map(rule => {\r\n        return convertToAlertRule(rule, rule.state);\r\n      });\r\n\r\n      return { ...state, items: alertRulesViewModel, isLoading: false };\r\n    },\r\n    setSearchQuery: (state, action: PayloadAction<string>): AlertRulesState => {\r\n      return { ...state, searchQuery: action.payload };\r\n    },\r\n  },\r\n});\r\n\r\nexport const { loadAlertRules, loadedAlertRules, setSearchQuery } = alertRulesSlice.actions;\r\n\r\nexport const alertRulesReducer = alertRulesSlice.reducer;\r\n\r\nexport default {\r\n  alertRules: alertRulesReducer,\r\n};\r\n","import './annotations/all';\r\nimport './templating/all';\r\nimport './plugins/all';\r\nimport './dashboard';\r\nimport './playlist/all';\r\nimport './panel/all';\r\nimport './org/all';\r\nimport './admin';\r\nimport './alerting/NotificationsEditCtrl';\r\nimport './alerting/NotificationsListCtrl';\r\nimport './manage-dashboards';\r\nimport './profile/all';\r\nimport './datasources/settings/HttpSettingsCtrl';\r\nimport './datasources/settings/TlsAuthSettingsCtrl';\r\n","import { AnnotationsSrv } from './annotations_srv';\nimport { eventEditor } from './event_editor';\nimport { EventManager } from './event_manager';\nimport { annotationTooltipDirective } from './annotation_tooltip';\nexport { AnnotationsSrv, eventEditor, EventManager, annotationTooltipDirective };\n","import _ from 'lodash';\r\nimport $ from 'jquery';\r\nimport coreModule from 'app/core/core_module';\r\nimport alertDef from '../alerting/state/alertDef';\r\nimport { DashboardSrv } from '../dashboard/services/DashboardSrv';\r\nimport { ContextSrv } from 'app/core/services/context_srv';\r\n\r\n/** @ngInject */\r\nexport function annotationTooltipDirective(\r\n  $sanitize: any,\r\n  dashboardSrv: DashboardSrv,\r\n  contextSrv: ContextSrv,\r\n  $compile: any\r\n) {\r\n  function sanitizeString(str: string) {\r\n    try {\r\n      return $sanitize(str);\r\n    } catch (err) {\r\n      console.log('Could not sanitize annotation string, html escaping instead');\r\n      return _.escape(str);\r\n    }\r\n  }\r\n\r\n  return {\r\n    restrict: 'E',\r\n    scope: {\r\n      event: '=',\r\n      onEdit: '&',\r\n    },\r\n    link: (scope: any, element: JQuery) => {\r\n      const event = scope.event;\r\n      let title = event.title;\r\n      let text = event.text;\r\n      const dashboard = dashboardSrv.getCurrent();\r\n\r\n      let tooltip = '<div class=\"graph-annotation\">';\r\n      let titleStateClass = '';\r\n\r\n      if (event.alertId) {\r\n        const stateModel = alertDef.getStateDisplayModel(event.newState);\r\n        titleStateClass = stateModel.stateClass;\r\n        title = `<i class=\"${stateModel.iconClass}\"></i> ${stateModel.text}`;\r\n        text = alertDef.getAlertAnnotationInfo(event);\r\n        if (event.text) {\r\n          text = text + '<br />' + event.text;\r\n        }\r\n      } else if (title) {\r\n        text = title + '<br />' + (_.isString(text) ? text : '');\r\n        title = '';\r\n      }\r\n\r\n      let header = `<div class=\"graph-annotation__header\">`;\r\n      if (event.login) {\r\n        header += `<div class=\"graph-annotation__user\" bs-tooltip=\"'Created by ${event.login}'\"><img src=\"${event.avatarUrl}\" /></div>`;\r\n      }\r\n      header += `\r\n          <span class=\"graph-annotation__title ${titleStateClass}\">${sanitizeString(title)}</span>\r\n          <span class=\"graph-annotation__time\">${dashboard.formatDate(event.min)}</span>\r\n      `;\r\n\r\n      // Show edit icon only for users with at least Editor role\r\n      if (event.id && dashboard.meta.canEdit) {\r\n        header += `\r\n          <span class=\"pointer graph-annotation__edit-icon\" ng-click=\"onEdit()\">\r\n            <i class=\"fa fa-pencil-square\"></i>\r\n          </span>\r\n        `;\r\n      }\r\n\r\n      header += `</div>`;\r\n      tooltip += header;\r\n      tooltip += '<div class=\"graph-annotation__body\">';\r\n\r\n      if (text) {\r\n        tooltip += '<div>' + sanitizeString(text.replace(/\\n/g, '<br>')) + '</div>';\r\n      }\r\n\r\n      const tags = event.tags;\r\n\r\n      if (tags && tags.length) {\r\n        scope.tags = tags;\r\n        tooltip +=\r\n          '<span class=\"label label-tag small\" ng-repeat=\"tag in tags\" tag-color-from-name=\"tag\">{{tag}}</span><br/>';\r\n      }\r\n\r\n      tooltip += '</div>';\r\n      tooltip += '</div>';\r\n\r\n      const $tooltip = $(tooltip);\r\n      $tooltip.appendTo(element);\r\n\r\n      $compile(element.contents())(scope);\r\n    },\r\n  };\r\n}\r\n\r\ncoreModule.directive('annotationTooltip', annotationTooltipDirective);\r\n","// Libaries\r\nimport angular from 'angular';\r\nimport _ from 'lodash';\r\n\r\n// Components\r\nimport './editor_ctrl';\r\nimport coreModule from 'app/core/core_module';\r\n\r\n// Utils & Services\r\nimport { dedupAnnotations } from './events_processing';\r\n\r\n// Types\r\nimport { DashboardModel } from '../dashboard/state/DashboardModel';\r\nimport DatasourceSrv from '../plugins/datasource_srv';\r\nimport { BackendSrv } from 'app/core/services/backend_srv';\r\nimport { TimeSrv } from '../dashboard/services/TimeSrv';\r\nimport { DataSourceApi, PanelEvents, AnnotationEvent, AppEvents, PanelModel, TimeRange } from '@grafana/data';\r\nimport { GrafanaRootScope } from 'app/routes/GrafanaCtrl';\r\n\r\nexport class AnnotationsSrv {\r\n  globalAnnotationsPromise: any;\r\n  alertStatesPromise: any;\r\n  datasourcePromises: any;\r\n\r\n  /** @ngInject */\r\n  constructor(\r\n    private $rootScope: GrafanaRootScope,\r\n    private datasourceSrv: DatasourceSrv,\r\n    private backendSrv: BackendSrv,\r\n    private timeSrv: TimeSrv\r\n  ) {}\r\n\r\n  init(dashboard: DashboardModel) {\r\n    // always clearPromiseCaches when loading new dashboard\r\n    this.clearPromiseCaches();\r\n    // clear promises on refresh events\r\n    dashboard.on(PanelEvents.refresh, this.clearPromiseCaches.bind(this));\r\n  }\r\n\r\n  clearPromiseCaches() {\r\n    this.globalAnnotationsPromise = null;\r\n    this.alertStatesPromise = null;\r\n    this.datasourcePromises = null;\r\n  }\r\n\r\n  getAnnotations(options: { dashboard: DashboardModel; panel: PanelModel; range: TimeRange }) {\r\n    return Promise.all([this.getGlobalAnnotations(options), this.getAlertStates(options)])\r\n      .then(results => {\r\n        // combine the annotations and flatten results\r\n        let annotations: AnnotationEvent[] = _.flattenDeep(results[0]);\r\n\r\n        // filter out annotations that do not belong to requesting panel\r\n        annotations = _.filter(annotations, item => {\r\n          // if event has panel id and query is of type dashboard then panel and requesting panel id must match\r\n          if (item.panelId && item.source.type === 'dashboard') {\r\n            return item.panelId === options.panel.id;\r\n          }\r\n          return true;\r\n        });\r\n\r\n        annotations = dedupAnnotations(annotations);\r\n\r\n        // look for alert state for this panel\r\n        const alertState: any = _.find(results[1], { panelId: options.panel.id });\r\n\r\n        return {\r\n          annotations: annotations,\r\n          alertState: alertState,\r\n        };\r\n      })\r\n      .catch(err => {\r\n        if (!err.message && err.data && err.data.message) {\r\n          err.message = err.data.message;\r\n        }\r\n        console.log('AnnotationSrv.query error', err);\r\n        this.$rootScope.appEvent(AppEvents.alertError, ['Annotation Query Failed', err.message || err]);\r\n        return [];\r\n      });\r\n  }\r\n\r\n  getAlertStates(options: any) {\r\n    if (!options.dashboard.id) {\r\n      return Promise.resolve([]);\r\n    }\r\n\r\n    // ignore if no alerts\r\n    if (options.panel && !options.panel.alert) {\r\n      return Promise.resolve([]);\r\n    }\r\n\r\n    if (options.range.raw.to !== 'now') {\r\n      return Promise.resolve([]);\r\n    }\r\n\r\n    if (this.alertStatesPromise) {\r\n      return this.alertStatesPromise;\r\n    }\r\n\r\n    this.alertStatesPromise = this.backendSrv.get('/api/alerts/states-for-dashboard', {\r\n      dashboardId: options.dashboard.id,\r\n    });\r\n    return this.alertStatesPromise;\r\n  }\r\n\r\n  getGlobalAnnotations(options: { dashboard: DashboardModel; panel: PanelModel; range: TimeRange }) {\r\n    const dashboard = options.dashboard;\r\n\r\n    if (this.globalAnnotationsPromise) {\r\n      return this.globalAnnotationsPromise;\r\n    }\r\n\r\n    const range = this.timeSrv.timeRange();\r\n    const promises = [];\r\n    const dsPromises = [];\r\n\r\n    for (const annotation of dashboard.annotations.list) {\r\n      if (!annotation.enable) {\r\n        continue;\r\n      }\r\n\r\n      if (annotation.snapshotData) {\r\n        return this.translateQueryResult(annotation, annotation.snapshotData);\r\n      }\r\n      const datasourcePromise = this.datasourceSrv.get(annotation.datasource);\r\n      dsPromises.push(datasourcePromise);\r\n      promises.push(\r\n        datasourcePromise\r\n          .then((datasource: DataSourceApi) => {\r\n            // issue query against data source\r\n            return datasource.annotationQuery({\r\n              range,\r\n              rangeRaw: range.raw,\r\n              annotation: annotation,\r\n              dashboard: dashboard,\r\n            });\r\n          })\r\n          .then(results => {\r\n            // store response in annotation object if this is a snapshot call\r\n            if (dashboard.snapshot) {\r\n              annotation.snapshotData = angular.copy(results);\r\n            }\r\n            // translate result\r\n            return this.translateQueryResult(annotation, results);\r\n          })\r\n      );\r\n    }\r\n    this.datasourcePromises = Promise.all(dsPromises);\r\n    this.globalAnnotationsPromise = Promise.all(promises);\r\n    return this.globalAnnotationsPromise;\r\n  }\r\n\r\n  saveAnnotationEvent(annotation: AnnotationEvent) {\r\n    this.globalAnnotationsPromise = null;\r\n    return this.backendSrv.post('/api/annotations', annotation);\r\n  }\r\n\r\n  updateAnnotationEvent(annotation: AnnotationEvent) {\r\n    this.globalAnnotationsPromise = null;\r\n    return this.backendSrv.put(`/api/annotations/${annotation.id}`, annotation);\r\n  }\r\n\r\n  deleteAnnotationEvent(annotation: AnnotationEvent) {\r\n    this.globalAnnotationsPromise = null;\r\n    const deleteUrl = `/api/annotations/${annotation.id}`;\r\n\r\n    return this.backendSrv.delete(deleteUrl);\r\n  }\r\n\r\n  translateQueryResult(annotation: any, results: any) {\r\n    // if annotation has snapshotData\r\n    // make clone and remove it\r\n    if (annotation.snapshotData) {\r\n      annotation = angular.copy(annotation);\r\n      delete annotation.snapshotData;\r\n    }\r\n\r\n    for (const item of results) {\r\n      item.source = annotation;\r\n      item.isRegion = item.timeEnd && item.time !== item.timeEnd;\r\n    }\r\n\r\n    return results;\r\n  }\r\n}\r\n\r\ncoreModule.service('annotationsSrv', AnnotationsSrv);\r\n","import angular from 'angular';\r\nimport _ from 'lodash';\r\nimport $ from 'jquery';\r\nimport coreModule from 'app/core/core_module';\r\nimport { DashboardModel } from 'app/features/dashboard/state';\r\nimport DatasourceSrv from '../plugins/datasource_srv';\r\nimport appEvents from 'app/core/app_events';\r\nimport { AppEvents } from '@grafana/data';\r\n\r\nexport class AnnotationsEditorCtrl {\r\n  mode: any;\r\n  datasources: any;\r\n  annotations: any;\r\n  currentAnnotation: any;\r\n  currentDatasource: any;\r\n  currentIsNew: any;\r\n  dashboard: DashboardModel;\r\n\r\n  annotationDefaults: any = {\r\n    name: '',\r\n    datasource: null,\r\n    iconColor: 'rgba(255, 96, 96, 1)',\r\n    enable: true,\r\n    showIn: 0,\r\n    hide: false,\r\n  };\r\n\r\n  emptyListCta = {\r\n    title: 'There are no custom annotation queries added yet',\r\n    buttonIcon: 'gicon gicon-annotation',\r\n    buttonTitle: 'Add Annotation Query',\r\n    infoBox: {\r\n      __html: `<p>Annotations provide a way to integrate event data into your graphs. They are visualized as vertical lines\r\n    and icons on all graph panels. When you hover over an annotation icon you can get event text &amp; tags for\r\n    the event. You can add annotation events directly from grafana by holding CTRL or CMD + click on graph (or\r\n    drag region). These will be stored in Grafana's annotation database.\r\n  </p>\r\n  Checkout the\r\n  <a class='external-link' target='_blank' href='http://docs.grafana.org/reference/annotations/'\r\n    >Annotations documentation</a\r\n  >\r\n  for more information.`,\r\n    },\r\n    infoBoxTitle: 'What are annotations?',\r\n  };\r\n\r\n  showOptions: any = [\r\n    { text: 'All Panels', value: 0 },\r\n    { text: 'Specific Panels', value: 1 },\r\n  ];\r\n\r\n  /** @ngInject */\r\n  constructor(private $scope: any, private datasourceSrv: DatasourceSrv) {\r\n    $scope.ctrl = this;\r\n\r\n    this.dashboard = $scope.dashboard;\r\n    this.mode = 'list';\r\n    this.datasources = datasourceSrv.getAnnotationSources();\r\n    this.annotations = this.dashboard.annotations.list;\r\n    this.reset();\r\n\r\n    this.onColorChange = this.onColorChange.bind(this);\r\n  }\r\n\r\n  async datasourceChanged() {\r\n    const newDatasource = await this.datasourceSrv.get(this.currentAnnotation.datasource);\r\n    this.$scope.$apply(() => {\r\n      this.currentDatasource = newDatasource;\r\n    });\r\n  }\r\n\r\n  edit(annotation: any) {\r\n    this.currentAnnotation = annotation;\r\n    this.currentAnnotation.showIn = this.currentAnnotation.showIn || 0;\r\n    this.currentIsNew = false;\r\n    this.datasourceChanged();\r\n    this.mode = 'edit';\r\n    $('.tooltip.in').remove();\r\n  }\r\n\r\n  reset() {\r\n    this.currentAnnotation = angular.copy(this.annotationDefaults);\r\n    this.currentAnnotation.datasource = this.datasources[0].name;\r\n    this.currentIsNew = true;\r\n    this.datasourceChanged();\r\n  }\r\n\r\n  update() {\r\n    this.reset();\r\n    this.mode = 'list';\r\n  }\r\n\r\n  setupNew = () => {\r\n    this.mode = 'new';\r\n    this.reset();\r\n  };\r\n\r\n  backToList() {\r\n    this.mode = 'list';\r\n  }\r\n\r\n  move(index: number, dir: number) {\r\n    // @ts-ignore\r\n    _.move(this.annotations, index, index + dir);\r\n  }\r\n\r\n  add() {\r\n    const sameName: any = _.find(this.annotations, { name: this.currentAnnotation.name });\r\n    if (sameName) {\r\n      appEvents.emit(AppEvents.alertWarning, ['Validation', 'Annotations with the same name already exists']);\r\n      return;\r\n    }\r\n    this.annotations.push(this.currentAnnotation);\r\n    this.reset();\r\n    this.mode = 'list';\r\n    this.dashboard.updateSubmenuVisibility();\r\n  }\r\n\r\n  removeAnnotation(annotation: any) {\r\n    const index = _.indexOf(this.annotations, annotation);\r\n    this.annotations.splice(index, 1);\r\n    this.dashboard.updateSubmenuVisibility();\r\n  }\r\n\r\n  onColorChange(newColor: string) {\r\n    this.currentAnnotation.iconColor = newColor;\r\n  }\r\n}\r\n\r\ncoreModule.controller('AnnotationsEditorCtrl', AnnotationsEditorCtrl);\r\n","import _ from 'lodash';\r\nimport { coreModule } from 'app/core/core';\r\nimport { MetricsPanelCtrl } from 'app/plugins/sdk';\r\nimport { AnnotationEvent } from '@grafana/data';\r\nimport { dateTime } from '@grafana/data';\r\nimport { AnnotationsSrv } from './all';\r\n\r\nexport class EventEditorCtrl {\r\n  panelCtrl: MetricsPanelCtrl;\r\n  event: AnnotationEvent;\r\n  timeRange: { from: number; to: number };\r\n  form: any;\r\n  close: any;\r\n  timeFormated: string;\r\n\r\n  /** @ngInject */\r\n  constructor(private annotationsSrv: AnnotationsSrv) {\r\n    this.event.panelId = this.panelCtrl.panel.id;\r\n    this.event.dashboardId = this.panelCtrl.dashboard.id;\r\n\r\n    // Annotations query returns time as Unix timestamp in milliseconds\r\n    this.event.time = tryEpochToMoment(this.event.time);\r\n    if (this.event.isRegion) {\r\n      this.event.timeEnd = tryEpochToMoment(this.event.timeEnd);\r\n    }\r\n\r\n    this.timeFormated = this.panelCtrl.dashboard.formatDate(this.event.time);\r\n  }\r\n\r\n  save() {\r\n    if (!this.form.$valid) {\r\n      return;\r\n    }\r\n\r\n    const saveModel = _.cloneDeep(this.event);\r\n    saveModel.time = saveModel.time.valueOf();\r\n    saveModel.timeEnd = 0;\r\n\r\n    if (saveModel.isRegion) {\r\n      saveModel.timeEnd = this.event.timeEnd.valueOf();\r\n\r\n      if (saveModel.timeEnd < saveModel.time) {\r\n        console.log('invalid time');\r\n        return;\r\n      }\r\n    }\r\n\r\n    if (saveModel.id) {\r\n      this.annotationsSrv\r\n        .updateAnnotationEvent(saveModel)\r\n        .then(() => {\r\n          this.panelCtrl.refresh();\r\n          this.close();\r\n        })\r\n        .catch(() => {\r\n          this.panelCtrl.refresh();\r\n          this.close();\r\n        });\r\n    } else {\r\n      this.annotationsSrv\r\n        .saveAnnotationEvent(saveModel)\r\n        .then(() => {\r\n          this.panelCtrl.refresh();\r\n          this.close();\r\n        })\r\n        .catch(() => {\r\n          this.panelCtrl.refresh();\r\n          this.close();\r\n        });\r\n    }\r\n  }\r\n\r\n  delete() {\r\n    return this.annotationsSrv\r\n      .deleteAnnotationEvent(this.event)\r\n      .then(() => {\r\n        this.panelCtrl.refresh();\r\n        this.close();\r\n      })\r\n      .catch(() => {\r\n        this.panelCtrl.refresh();\r\n        this.close();\r\n      });\r\n  }\r\n}\r\n\r\nfunction tryEpochToMoment(timestamp: any) {\r\n  if (timestamp && _.isNumber(timestamp)) {\r\n    const epoch = Number(timestamp);\r\n    return dateTime(epoch);\r\n  } else {\r\n    return timestamp;\r\n  }\r\n}\r\n\r\nexport function eventEditor() {\r\n  return {\r\n    restrict: 'E',\r\n    controller: EventEditorCtrl,\r\n    bindToController: true,\r\n    controllerAs: 'ctrl',\r\n    templateUrl: 'public/app/features/annotations/partials/event_editor.html',\r\n    scope: {\r\n      panelCtrl: '=',\r\n      event: '=',\r\n      close: '&',\r\n    },\r\n  };\r\n}\r\n\r\ncoreModule.directive('eventEditor', eventEditor);\r\n","import _ from 'lodash';\r\nimport tinycolor from 'tinycolor2';\r\nimport {\r\n  OK_COLOR,\r\n  ALERTING_COLOR,\r\n  NO_DATA_COLOR,\r\n  PENDING_COLOR,\r\n  DEFAULT_ANNOTATION_COLOR,\r\n  REGION_FILL_ALPHA,\r\n} from '@grafana/ui';\r\n\r\nimport { MetricsPanelCtrl } from 'app/plugins/sdk';\r\nimport { AnnotationEvent } from '@grafana/data';\r\n\r\nexport class EventManager {\r\n  event: AnnotationEvent;\r\n  editorOpen: boolean;\r\n\r\n  constructor(private panelCtrl: MetricsPanelCtrl) {}\r\n\r\n  editorClosed() {\r\n    this.event = null;\r\n    this.editorOpen = false;\r\n    this.panelCtrl.render();\r\n  }\r\n\r\n  editorOpened() {\r\n    this.editorOpen = true;\r\n  }\r\n\r\n  updateTime(range: { from: any; to: any }) {\r\n    if (!this.event) {\r\n      this.event = {};\r\n      this.event.dashboardId = this.panelCtrl.dashboard.id;\r\n      this.event.panelId = this.panelCtrl.panel.id;\r\n    }\r\n\r\n    // update time\r\n    this.event.time = range.from;\r\n    this.event.isRegion = false;\r\n\r\n    if (range.to) {\r\n      this.event.timeEnd = range.to;\r\n      this.event.isRegion = true;\r\n    }\r\n\r\n    this.panelCtrl.render();\r\n  }\r\n\r\n  editEvent(event: AnnotationEvent, elem?: any) {\r\n    this.event = event;\r\n    this.panelCtrl.render();\r\n  }\r\n\r\n  addFlotEvents(annotations: any, flotOptions: any) {\r\n    if (!this.event && annotations.length === 0) {\r\n      return;\r\n    }\r\n\r\n    const types: any = {\r\n      $__alerting: {\r\n        color: ALERTING_COLOR,\r\n        position: 'BOTTOM',\r\n        markerSize: 5,\r\n      },\r\n      $__ok: {\r\n        color: OK_COLOR,\r\n        position: 'BOTTOM',\r\n        markerSize: 5,\r\n      },\r\n      $__no_data: {\r\n        color: NO_DATA_COLOR,\r\n        position: 'BOTTOM',\r\n        markerSize: 5,\r\n      },\r\n      $__pending: {\r\n        color: PENDING_COLOR,\r\n        position: 'BOTTOM',\r\n        markerSize: 5,\r\n      },\r\n      $__editing: {\r\n        color: DEFAULT_ANNOTATION_COLOR,\r\n        position: 'BOTTOM',\r\n        markerSize: 5,\r\n      },\r\n    };\r\n\r\n    if (this.event) {\r\n      if (this.event.isRegion) {\r\n        annotations = [\r\n          {\r\n            isRegion: true,\r\n            min: this.event.time,\r\n            timeEnd: this.event.timeEnd,\r\n            text: this.event.text,\r\n            eventType: '$__editing',\r\n            editModel: this.event,\r\n          },\r\n        ];\r\n      } else {\r\n        annotations = [\r\n          {\r\n            min: this.event.time,\r\n            text: this.event.text,\r\n            editModel: this.event,\r\n            eventType: '$__editing',\r\n          },\r\n        ];\r\n      }\r\n    } else {\r\n      // annotations from query\r\n      for (let i = 0; i < annotations.length; i++) {\r\n        const item = annotations[i];\r\n\r\n        // add properties used by jquery flot events\r\n        item.min = item.time;\r\n        item.max = item.time;\r\n        item.eventType = item.source.name;\r\n\r\n        if (item.newState) {\r\n          item.eventType = '$__' + item.newState;\r\n          continue;\r\n        }\r\n\r\n        if (!types[item.source.name]) {\r\n          types[item.source.name] = {\r\n            color: item.source.iconColor,\r\n            position: 'BOTTOM',\r\n            markerSize: 5,\r\n          };\r\n        }\r\n      }\r\n    }\r\n\r\n    const regions = getRegions(annotations);\r\n    addRegionMarking(regions, flotOptions);\r\n\r\n    const eventSectionHeight = 20;\r\n    const eventSectionMargin = 7;\r\n    flotOptions.grid.eventSectionHeight = eventSectionMargin;\r\n    flotOptions.xaxis.eventSectionHeight = eventSectionHeight;\r\n\r\n    flotOptions.events = {\r\n      levels: _.keys(types).length + 1,\r\n      data: annotations,\r\n      types: types,\r\n      manager: this,\r\n    };\r\n  }\r\n}\r\n\r\nfunction getRegions(events: AnnotationEvent[]) {\r\n  return _.filter(events, 'isRegion');\r\n}\r\n\r\nfunction addRegionMarking(regions: any[], flotOptions: { grid: { markings: any } }) {\r\n  const markings = flotOptions.grid.markings;\r\n  const defaultColor = DEFAULT_ANNOTATION_COLOR;\r\n  let fillColor;\r\n\r\n  _.each(regions, region => {\r\n    if (region.source) {\r\n      fillColor = region.source.iconColor || defaultColor;\r\n    } else {\r\n      fillColor = defaultColor;\r\n    }\r\n\r\n    fillColor = addAlphaToRGB(fillColor, REGION_FILL_ALPHA);\r\n    markings.push({\r\n      xaxis: { from: region.min, to: region.timeEnd },\r\n      color: fillColor,\r\n    });\r\n  });\r\n}\r\n\r\nfunction addAlphaToRGB(colorString: string, alpha: number): string {\r\n  const color = tinycolor(colorString);\r\n  if (color.isValid()) {\r\n    color.setAlpha(alpha);\r\n    return color.toRgbString();\r\n  } else {\r\n    return colorString;\r\n  }\r\n}\r\n","import _ from 'lodash';\r\n\r\nexport function dedupAnnotations(annotations: any) {\r\n  let dedup = [];\r\n\r\n  // Split events by annotationId property existence\r\n  const events = _.partition(annotations, 'id');\r\n\r\n  const eventsById = _.groupBy(events[0], 'id');\r\n  dedup = _.map(eventsById, eventGroup => {\r\n    if (eventGroup.length > 1 && !_.every(eventGroup, isPanelAlert)) {\r\n      // Get first non-panel alert\r\n      return _.find(eventGroup, event => {\r\n        return event.eventType !== 'panel-alert';\r\n      });\r\n    } else {\r\n      return _.head(eventGroup);\r\n    }\r\n  });\r\n\r\n  dedup = _.concat(dedup, events[1]);\r\n  return dedup;\r\n}\r\n\r\nfunction isPanelAlert(event: { eventType: string }) {\r\n  return event.eventType === 'panel-alert';\r\n}\r\n","import { createSlice } from '@reduxjs/toolkit';\r\n\r\nimport { ApiKeysState } from 'app/types';\r\n\r\nexport const initialApiKeysState: ApiKeysState = {\r\n  keys: [],\r\n  searchQuery: '',\r\n  hasFetched: false,\r\n  includeExpired: false,\r\n};\r\n\r\nconst apiKeysSlice = createSlice({\r\n  name: 'apiKeys',\r\n  initialState: initialApiKeysState,\r\n  reducers: {\r\n    apiKeysLoaded: (state, action): ApiKeysState => {\r\n      return { ...state, hasFetched: true, keys: action.payload };\r\n    },\r\n    setSearchQuery: (state, action): ApiKeysState => {\r\n      return { ...state, searchQuery: action.payload };\r\n    },\r\n  },\r\n});\r\n\r\nexport const { setSearchQuery, apiKeysLoaded } = apiKeysSlice.actions;\r\n\r\nexport const apiKeysReducer = apiKeysSlice.reducer;\r\n\r\nexport default {\r\n  apiKeys: apiKeysReducer,\r\n};\r\n","import _ from 'lodash';\r\nimport angular from 'angular';\r\nimport coreModule from 'app/core/core_module';\r\nimport { DashboardModel } from 'app/features/dashboard/state';\r\nimport DatasourceSrv from 'app/features/plugins/datasource_srv';\r\nimport { VariableSrv } from 'app/features/templating/all';\r\nimport { CoreEvents } from 'app/types';\r\n\r\nexport class AdHocFiltersCtrl {\r\n  segments: any;\r\n  variable: any;\r\n  dashboard: DashboardModel;\r\n  removeTagFilterSegment: any;\r\n\r\n  /** @ngInject */\r\n  constructor(\r\n    private uiSegmentSrv: any,\r\n    private datasourceSrv: DatasourceSrv,\r\n    private variableSrv: VariableSrv,\r\n    $scope: any\r\n  ) {\r\n    this.removeTagFilterSegment = uiSegmentSrv.newSegment({\r\n      fake: true,\r\n      value: '-- remove filter --',\r\n    });\r\n    this.buildSegmentModel();\r\n    this.dashboard.events.on(CoreEvents.templateVariableValueUpdated, this.buildSegmentModel.bind(this), $scope);\r\n  }\r\n\r\n  buildSegmentModel() {\r\n    this.segments = [];\r\n\r\n    if (this.variable.value && !_.isArray(this.variable.value)) {\r\n    }\r\n\r\n    for (const tag of this.variable.filters) {\r\n      if (this.segments.length > 0) {\r\n        this.segments.push(this.uiSegmentSrv.newCondition('AND'));\r\n      }\r\n\r\n      if (tag.key !== undefined && tag.value !== undefined) {\r\n        this.segments.push(this.uiSegmentSrv.newKey(tag.key));\r\n        this.segments.push(this.uiSegmentSrv.newOperator(tag.operator));\r\n        this.segments.push(this.uiSegmentSrv.newKeyValue(tag.value));\r\n      }\r\n    }\r\n\r\n    this.segments.push(this.uiSegmentSrv.newPlusButton());\r\n  }\r\n\r\n  getOptions(segment: { type: string }, index: number) {\r\n    if (segment.type === 'operator') {\r\n      return Promise.resolve(this.uiSegmentSrv.newOperators(['=', '!=', '<', '>', '=~', '!~']));\r\n    }\r\n\r\n    if (segment.type === 'condition') {\r\n      return Promise.resolve([this.uiSegmentSrv.newSegment('AND')]);\r\n    }\r\n\r\n    return this.datasourceSrv.get(this.variable.datasource).then(ds => {\r\n      const options: any = {};\r\n      let promise = null;\r\n\r\n      if (segment.type !== 'value') {\r\n        promise = ds.getTagKeys ? ds.getTagKeys() : Promise.resolve([]);\r\n      } else {\r\n        options.key = this.segments[index - 2].value;\r\n        promise = ds.getTagValues ? ds.getTagValues(options) : Promise.resolve([]);\r\n      }\r\n\r\n      return promise.then((results: any) => {\r\n        results = _.map(results, segment => {\r\n          return this.uiSegmentSrv.newSegment({ value: segment.text });\r\n        });\r\n\r\n        // add remove option for keys\r\n        if (segment.type === 'key') {\r\n          results.splice(0, 0, angular.copy(this.removeTagFilterSegment));\r\n        }\r\n        return results;\r\n      });\r\n    });\r\n  }\r\n\r\n  segmentChanged(segment: { value: any; type: string; cssClass: string }, index: number) {\r\n    this.segments[index] = segment;\r\n\r\n    // handle remove tag condition\r\n    if (segment.value === this.removeTagFilterSegment.value) {\r\n      this.segments.splice(index, 3);\r\n      if (this.segments.length === 0) {\r\n        this.segments.push(this.uiSegmentSrv.newPlusButton());\r\n      } else if (this.segments.length > 2) {\r\n        this.segments.splice(Math.max(index - 1, 0), 1);\r\n        if (this.segments[this.segments.length - 1].type !== 'plus-button') {\r\n          this.segments.push(this.uiSegmentSrv.newPlusButton());\r\n        }\r\n      }\r\n    } else {\r\n      if (segment.type === 'plus-button') {\r\n        if (index > 2) {\r\n          this.segments.splice(index, 0, this.uiSegmentSrv.newCondition('AND'));\r\n        }\r\n        this.segments.push(this.uiSegmentSrv.newOperator('='));\r\n        this.segments.push(this.uiSegmentSrv.newFake('select value', 'value', 'query-segment-value'));\r\n        segment.type = 'key';\r\n        segment.cssClass = 'query-segment-key';\r\n      }\r\n\r\n      if (index + 1 === this.segments.length) {\r\n        this.segments.push(this.uiSegmentSrv.newPlusButton());\r\n      }\r\n    }\r\n\r\n    this.updateVariableModel();\r\n  }\r\n\r\n  updateVariableModel() {\r\n    const filters: any[] = [];\r\n    let filterIndex = -1;\r\n    let hasFakes = false;\r\n\r\n    this.segments.forEach((segment: any) => {\r\n      if (segment.type === 'value' && segment.fake) {\r\n        hasFakes = true;\r\n        return;\r\n      }\r\n\r\n      switch (segment.type) {\r\n        case 'key': {\r\n          filters.push({ key: segment.value });\r\n          filterIndex += 1;\r\n          break;\r\n        }\r\n        case 'value': {\r\n          filters[filterIndex].value = segment.value;\r\n          break;\r\n        }\r\n        case 'operator': {\r\n          filters[filterIndex].operator = segment.value;\r\n          break;\r\n        }\r\n        case 'condition': {\r\n          filters[filterIndex].condition = segment.value;\r\n          break;\r\n        }\r\n      }\r\n    });\r\n\r\n    if (hasFakes) {\r\n      return;\r\n    }\r\n\r\n    this.variable.setFilters(filters);\r\n    this.variableSrv.variableUpdated(this.variable, true);\r\n  }\r\n}\r\n\r\nconst template = `\r\n<div class=\"gf-form-inline\">\r\n  <div class=\"gf-form\" ng-repeat=\"segment in ctrl.segments\">\r\n    <metric-segment segment=\"segment\" get-options=\"ctrl.getOptions(segment, $index)\"\r\n                    on-change=\"ctrl.segmentChanged(segment, $index)\"></metric-segment>\r\n  </div>\r\n</div>\r\n`;\r\n\r\nexport function adHocFiltersComponent() {\r\n  return {\r\n    restrict: 'E',\r\n    template: template,\r\n    controller: AdHocFiltersCtrl,\r\n    bindToController: true,\r\n    controllerAs: 'ctrl',\r\n    scope: {\r\n      variable: '=',\r\n      dashboard: '=',\r\n    },\r\n  };\r\n}\r\n\r\ncoreModule.directive('adHocFilters', adHocFiltersComponent);\r\n","export { AdHocFiltersCtrl } from './AdHocFiltersCtrl';\r\n","import angular from 'angular';\r\nimport { saveAs } from 'file-saver';\r\n\r\nimport coreModule from 'app/core/core_module';\r\nimport { DashboardExporter } from './DashboardExporter';\r\nimport { DashboardSrv } from '../../services/DashboardSrv';\r\nimport DatasourceSrv from 'app/features/plugins/datasource_srv';\r\nimport { GrafanaRootScope } from 'app/routes/GrafanaCtrl';\r\nimport { CoreEvents } from 'app/types';\r\n\r\nexport class DashExportCtrl {\r\n  dash: any;\r\n  exporter: DashboardExporter;\r\n  dismiss: () => void;\r\n  shareExternally: boolean;\r\n\r\n  /** @ngInject */\r\n  constructor(\r\n    private dashboardSrv: DashboardSrv,\r\n    datasourceSrv: DatasourceSrv,\r\n    private $scope: any,\r\n    private $rootScope: GrafanaRootScope\r\n  ) {\r\n    this.exporter = new DashboardExporter(datasourceSrv);\r\n\r\n    this.dash = this.dashboardSrv.getCurrent();\r\n  }\r\n\r\n  saveDashboardAsFile() {\r\n    if (this.shareExternally) {\r\n      this.exporter.makeExportable(this.dash).then((dashboardJson: any) => {\r\n        this.$scope.$apply(() => {\r\n          this.openSaveAsDialog(dashboardJson);\r\n        });\r\n      });\r\n    } else {\r\n      this.openSaveAsDialog(this.dash.getSaveModelClone());\r\n    }\r\n  }\r\n\r\n  viewJson() {\r\n    if (this.shareExternally) {\r\n      this.exporter.makeExportable(this.dash).then((dashboardJson: any) => {\r\n        this.$scope.$apply(() => {\r\n          this.openJsonModal(dashboardJson);\r\n        });\r\n      });\r\n    } else {\r\n      this.openJsonModal(this.dash.getSaveModelClone());\r\n    }\r\n  }\r\n\r\n  private openSaveAsDialog(dash: any) {\r\n    const blob = new Blob([angular.toJson(dash, true)], {\r\n      type: 'application/json;charset=utf-8',\r\n    });\r\n    saveAs(blob, dash.title + '-' + new Date().getTime() + '.json');\r\n  }\r\n\r\n  private openJsonModal(clone: object) {\r\n    const model = {\r\n      object: clone,\r\n      enableCopy: true,\r\n    };\r\n\r\n    this.$rootScope.appEvent(CoreEvents.showModal, {\r\n      src: 'public/app/partials/edit_json.html',\r\n      model: model,\r\n    });\r\n\r\n    this.dismiss();\r\n  }\r\n}\r\n\r\nexport function dashExportDirective() {\r\n  return {\r\n    restrict: 'E',\r\n    templateUrl: 'public/app/features/dashboard/components/DashExportModal/template.html',\r\n    controller: DashExportCtrl,\r\n    bindToController: true,\r\n    controllerAs: 'ctrl',\r\n    scope: { dismiss: '&' },\r\n  };\r\n}\r\n\r\ncoreModule.directive('dashExportModal', dashExportDirective);\r\n","import _ from 'lodash';\r\n\r\nimport config from 'app/core/config';\r\nimport { DashboardModel } from '../../state/DashboardModel';\r\nimport DatasourceSrv from 'app/features/plugins/datasource_srv';\r\nimport { PanelModel } from 'app/features/dashboard/state';\r\nimport { PanelPluginMeta } from '@grafana/data';\r\n\r\ninterface Input {\r\n  name: string;\r\n  type: string;\r\n  label: string;\r\n  value: any;\r\n  description: string;\r\n}\r\n\r\ninterface Requires {\r\n  [key: string]: {\r\n    type: string;\r\n    id: string;\r\n    name: string;\r\n    version: string;\r\n  };\r\n}\r\n\r\ninterface DataSources {\r\n  [key: string]: {\r\n    name: string;\r\n    label: string;\r\n    description: string;\r\n    type: string;\r\n    pluginId: string;\r\n    pluginName: string;\r\n  };\r\n}\r\n\r\nexport class DashboardExporter {\r\n  constructor(private datasourceSrv: DatasourceSrv) {}\r\n\r\n  makeExportable(dashboard: DashboardModel) {\r\n    // clean up repeated rows and panels,\r\n    // this is done on the live real dashboard instance, not on a clone\r\n    // so we need to undo this\r\n    // this is pretty hacky and needs to be changed\r\n    dashboard.cleanUpRepeats();\r\n\r\n    const saveModel = dashboard.getSaveModelClone();\r\n    saveModel.id = null;\r\n\r\n    // undo repeat cleanup\r\n    dashboard.processRepeats();\r\n\r\n    const inputs: Input[] = [];\r\n    const requires: Requires = {};\r\n    const datasources: DataSources = {};\r\n    const promises: Array<Promise<void>> = [];\r\n    const variableLookup: { [key: string]: any } = {};\r\n\r\n    for (const variable of saveModel.templating.list) {\r\n      variableLookup[variable.name] = variable;\r\n    }\r\n\r\n    const templateizeDatasourceUsage = (obj: any) => {\r\n      let datasource: string = obj.datasource;\r\n      let datasourceVariable: any = null;\r\n\r\n      // ignore data source properties that contain a variable\r\n      if (datasource && datasource.indexOf('$') === 0) {\r\n        datasourceVariable = variableLookup[datasource.substring(1)];\r\n        if (datasourceVariable && datasourceVariable.current) {\r\n          datasource = datasourceVariable.current.value;\r\n        }\r\n      }\r\n\r\n      promises.push(\r\n        this.datasourceSrv.get(datasource).then(ds => {\r\n          if (ds.meta.builtIn) {\r\n            return;\r\n          }\r\n\r\n          // add data source type to require list\r\n          requires['datasource' + ds.meta.id] = {\r\n            type: 'datasource',\r\n            id: ds.meta.id,\r\n            name: ds.meta.name,\r\n            version: ds.meta.info.version || '1.0.0',\r\n          };\r\n\r\n          // if used via variable we can skip templatizing usage\r\n          if (datasourceVariable) {\r\n            return;\r\n          }\r\n\r\n          const refName = 'DS_' + ds.name.replace(' ', '_').toUpperCase();\r\n          datasources[refName] = {\r\n            name: refName,\r\n            label: ds.name,\r\n            description: '',\r\n            type: 'datasource',\r\n            pluginId: ds.meta.id,\r\n            pluginName: ds.meta.name,\r\n          };\r\n\r\n          obj.datasource = '${' + refName + '}';\r\n        })\r\n      );\r\n    };\r\n\r\n    const processPanel = (panel: PanelModel) => {\r\n      if (panel.datasource !== undefined) {\r\n        templateizeDatasourceUsage(panel);\r\n      }\r\n\r\n      if (panel.targets) {\r\n        for (const target of panel.targets) {\r\n          if (target.datasource !== undefined) {\r\n            templateizeDatasourceUsage(target);\r\n          }\r\n        }\r\n      }\r\n\r\n      const panelDef: PanelPluginMeta = config.panels[panel.type];\r\n      if (panelDef) {\r\n        requires['panel' + panelDef.id] = {\r\n          type: 'panel',\r\n          id: panelDef.id,\r\n          name: panelDef.name,\r\n          version: panelDef.info.version,\r\n        };\r\n      }\r\n    };\r\n\r\n    // check up panel data sources\r\n    for (const panel of saveModel.panels) {\r\n      processPanel(panel);\r\n\r\n      // handle collapsed rows\r\n      if (panel.collapsed !== undefined && panel.collapsed === true && panel.panels) {\r\n        for (const rowPanel of panel.panels) {\r\n          processPanel(rowPanel);\r\n        }\r\n      }\r\n    }\r\n\r\n    // templatize template vars\r\n    for (const variable of saveModel.templating.list) {\r\n      if (variable.type === 'query') {\r\n        templateizeDatasourceUsage(variable);\r\n        variable.options = [];\r\n        variable.current = {};\r\n        variable.refresh = variable.refresh > 0 ? variable.refresh : 1;\r\n      }\r\n    }\r\n\r\n    // templatize annotations vars\r\n    for (const annotationDef of saveModel.annotations.list) {\r\n      templateizeDatasourceUsage(annotationDef);\r\n    }\r\n\r\n    // add grafana version\r\n    requires['grafana'] = {\r\n      type: 'grafana',\r\n      id: 'grafana',\r\n      name: 'Grafana',\r\n      version: config.buildInfo.version,\r\n    };\r\n\r\n    return Promise.all(promises)\r\n      .then(() => {\r\n        _.each(datasources, (value: any) => {\r\n          inputs.push(value);\r\n        });\r\n\r\n        // templatize constants\r\n        for (const variable of saveModel.templating.list) {\r\n          if (variable.type === 'constant') {\r\n            const refName = 'VAR_' + variable.name.replace(' ', '_').toUpperCase();\r\n            inputs.push({\r\n              name: refName,\r\n              type: 'constant',\r\n              label: variable.label || variable.name,\r\n              value: variable.current.value,\r\n              description: '',\r\n            });\r\n            // update current and option\r\n            variable.query = '${' + refName + '}';\r\n            variable.options[0] = variable.current = {\r\n              value: variable.query,\r\n              text: variable.query,\r\n            };\r\n          }\r\n        }\r\n\r\n        // make inputs and requires a top thing\r\n        const newObj: { [key: string]: {} } = {};\r\n        newObj['__inputs'] = inputs;\r\n        newObj['__requires'] = _.sortBy(requires, ['id']);\r\n\r\n        _.defaults(newObj, saveModel);\r\n        return newObj;\r\n      })\r\n      .catch(err => {\r\n        console.log('Export failed:', err);\r\n        return {\r\n          error: err,\r\n        };\r\n      });\r\n  }\r\n}\r\n","export { DashboardExporter } from './DashboardExporter';\r\nexport { DashExportCtrl } from './DashExportCtrl';\r\n","import angular from 'angular';\r\nimport _ from 'lodash';\r\nimport { iconMap } from './DashLinksEditorCtrl';\r\nimport { LinkSrv } from 'app/features/panel/panellinks/link_srv';\r\nimport { BackendSrv } from 'app/core/services/backend_srv';\r\nimport { DashboardSrv } from '../../services/DashboardSrv';\r\nimport { PanelEvents } from '@grafana/data';\r\nimport { CoreEvents } from 'app/types';\r\nimport { GrafanaRootScope } from 'app/routes/GrafanaCtrl';\r\n\r\nexport type DashboardLink = { tags: any; target: string; keepTime: any; includeVars: any };\r\n\r\nfunction dashLinksContainer() {\r\n  return {\r\n    scope: {\r\n      links: '=',\r\n      dashboard: '=',\r\n    },\r\n    restrict: 'E',\r\n    controller: 'DashLinksContainerCtrl',\r\n    template: '<dash-link ng-repeat=\"link in generatedLinks\" link=\"link\"></dash-link>',\r\n    link: () => {},\r\n  };\r\n}\r\n\r\n/** @ngInject */\r\nfunction dashLink($compile: any, $sanitize: any, linkSrv: LinkSrv) {\r\n  return {\r\n    restrict: 'E',\r\n    link: (scope: any, elem: JQuery) => {\r\n      const link = scope.link;\r\n      const dashboard = scope.dashboard;\r\n\r\n      let template =\r\n        '<div class=\"gf-form\">' +\r\n        '<a class=\"pointer gf-form-label\" data-placement=\"bottom\"' +\r\n        (link.asDropdown ? ' ng-click=\"fillDropdown(link)\" data-toggle=\"dropdown\"' : '') +\r\n        '>' +\r\n        '<i></i> <span></span></a>';\r\n\r\n      if (link.asDropdown) {\r\n        template +=\r\n          '<ul class=\"dropdown-menu\" role=\"menu\">' +\r\n          '<li ng-repeat=\"dash in link.searchHits\">' +\r\n          '<a href=\"{{dash.url}}\" target=\"{{dash.target}}\">{{dash.title}}</a>' +\r\n          '</li>' +\r\n          '</ul>';\r\n      }\r\n\r\n      template += '</div>';\r\n\r\n      elem.html(template);\r\n      $compile(elem.contents())(scope);\r\n\r\n      function update() {\r\n        const linkInfo = linkSrv.getAnchorInfo(link);\r\n\r\n        const anchor = elem.find('a');\r\n        const span = elem.find('span');\r\n        span.text(linkInfo.title);\r\n\r\n        if (!link.asDropdown) {\r\n          anchor.attr('href', linkInfo.href);\r\n          sanitizeAnchor();\r\n        }\r\n        anchor.attr('data-placement', 'bottom');\r\n        // tooltip\r\n        anchor.tooltip({\r\n          title: $sanitize(scope.link.tooltip),\r\n          html: true,\r\n          container: 'body',\r\n        });\r\n      }\r\n\r\n      function sanitizeAnchor() {\r\n        const anchor = elem.find('a');\r\n        const anchorSanitized = $sanitize(anchor.parent().html());\r\n        anchor.parent().html(anchorSanitized);\r\n      }\r\n\r\n      elem.find('i').attr('class', 'fa fa-fw ' + scope.link.icon);\r\n      elem.find('a').attr('target', scope.link.target);\r\n\r\n      // fix for menus on the far right\r\n      if (link.asDropdown && scope.$last) {\r\n        elem.find('.dropdown-menu').addClass('pull-right');\r\n      }\r\n\r\n      update();\r\n      dashboard.events.on(PanelEvents.refresh, update, scope);\r\n    },\r\n  };\r\n}\r\n\r\nexport class DashLinksContainerCtrl {\r\n  /** @ngInject */\r\n  constructor(\r\n    $scope: any,\r\n    $rootScope: GrafanaRootScope,\r\n    backendSrv: BackendSrv,\r\n    dashboardSrv: DashboardSrv,\r\n    linkSrv: LinkSrv\r\n  ) {\r\n    const currentDashId = dashboardSrv.getCurrent().id;\r\n\r\n    function buildLinks(linkDef: any) {\r\n      if (linkDef.type === 'dashboards') {\r\n        if (!linkDef.tags) {\r\n          console.log('Dashboard link missing tag');\r\n          return Promise.resolve([]);\r\n        }\r\n\r\n        if (linkDef.asDropdown) {\r\n          return Promise.resolve([\r\n            {\r\n              title: linkDef.title,\r\n              tags: linkDef.tags,\r\n              keepTime: linkDef.keepTime,\r\n              includeVars: linkDef.includeVars,\r\n              target: linkDef.targetBlank ? '_blank' : '_self',\r\n              icon: 'fa fa-bars',\r\n              asDropdown: true,\r\n            },\r\n          ]);\r\n        }\r\n\r\n        return $scope.searchDashboards(linkDef, 7);\r\n      }\r\n\r\n      if (linkDef.type === 'link') {\r\n        return Promise.resolve([\r\n          {\r\n            url: linkDef.url,\r\n            title: linkDef.title,\r\n            // @ts-ignore\r\n            icon: iconMap[linkDef.icon],\r\n            tooltip: linkDef.tooltip,\r\n            target: linkDef.targetBlank ? '_blank' : '_self',\r\n            keepTime: linkDef.keepTime,\r\n            includeVars: linkDef.includeVars,\r\n          },\r\n        ]);\r\n      }\r\n\r\n      return Promise.resolve([]);\r\n    }\r\n\r\n    function updateDashLinks() {\r\n      const promises = _.map($scope.links, buildLinks);\r\n\r\n      Promise.all(promises).then(results => {\r\n        $scope.generatedLinks = _.flatten(results);\r\n      });\r\n    }\r\n\r\n    $scope.searchDashboards = (link: DashboardLink, limit: any) => {\r\n      return backendSrv.search({ tag: link.tags, limit: limit }).then(results => {\r\n        return _.reduce(\r\n          results,\r\n          (memo, dash) => {\r\n            // do not add current dashboard\r\n            if (dash.id !== currentDashId) {\r\n              memo.push({\r\n                title: dash.title,\r\n                url: dash.url,\r\n                target: link.target === '_self' ? '' : link.target,\r\n                icon: 'fa fa-th-large',\r\n                keepTime: link.keepTime,\r\n                includeVars: link.includeVars,\r\n              });\r\n            }\r\n            return memo;\r\n          },\r\n          []\r\n        );\r\n      });\r\n    };\r\n\r\n    $scope.fillDropdown = (link: { searchHits: any }) => {\r\n      $scope.searchDashboards(link, 100).then((results: any) => {\r\n        _.each(results, hit => {\r\n          hit.url = linkSrv.getLinkUrl(hit);\r\n        });\r\n        link.searchHits = results;\r\n      });\r\n    };\r\n\r\n    updateDashLinks();\r\n    $rootScope.onAppEvent(CoreEvents.dashLinksUpdated, updateDashLinks, $scope);\r\n  }\r\n}\r\n\r\nangular.module('grafana.directives').directive('dashLinksContainer', dashLinksContainer);\r\nangular.module('grafana.directives').directive('dashLink', dashLink);\r\nangular.module('grafana.directives').controller('DashLinksContainerCtrl', DashLinksContainerCtrl);\r\n","import angular from 'angular';\r\nimport _ from 'lodash';\r\nimport { DashboardModel } from 'app/features/dashboard/state';\r\nimport { GrafanaRootScope } from 'app/routes/GrafanaCtrl';\r\nimport { CoreEvents } from 'app/types';\r\n\r\nexport let iconMap = {\r\n  'external link': 'fa-external-link',\r\n  dashboard: 'fa-th-large',\r\n  question: 'fa-question',\r\n  info: 'fa-info',\r\n  bolt: 'fa-bolt',\r\n  doc: 'fa-file-text-o',\r\n  cloud: 'fa-cloud',\r\n};\r\n\r\nexport class DashLinksEditorCtrl {\r\n  dashboard: DashboardModel;\r\n  iconMap: any;\r\n  mode: any;\r\n  link: any;\r\n\r\n  emptyListCta = {\r\n    title: 'There are no dashboard links added yet',\r\n    buttonIcon: 'gicon gicon-link',\r\n    buttonTitle: 'Add Dashboard Link',\r\n    infoBox: {\r\n      __html: `<p>\r\n      Dashboard Links allow you to place links to other dashboards and web sites directly in below the dashboard\r\n      header.\r\n    </p>`,\r\n    },\r\n    infoBoxTitle: 'What are Dashboard Links?',\r\n  };\r\n\r\n  /** @ngInject */\r\n  constructor($scope: any, $rootScope: GrafanaRootScope) {\r\n    this.iconMap = iconMap;\r\n    this.dashboard.links = this.dashboard.links || [];\r\n    this.mode = 'list';\r\n\r\n    $scope.$on('$destroy', () => {\r\n      $rootScope.appEvent(CoreEvents.dashLinksUpdated);\r\n    });\r\n  }\r\n\r\n  backToList() {\r\n    this.mode = 'list';\r\n  }\r\n\r\n  setupNew = () => {\r\n    this.mode = 'new';\r\n    this.link = { type: 'dashboards', icon: 'external link' };\r\n  };\r\n\r\n  addLink() {\r\n    this.dashboard.links.push(this.link);\r\n    this.mode = 'list';\r\n    this.dashboard.updateSubmenuVisibility();\r\n  }\r\n\r\n  editLink(link: any) {\r\n    this.link = link;\r\n    this.mode = 'edit';\r\n    console.log(this.link);\r\n  }\r\n\r\n  saveLink() {\r\n    this.backToList();\r\n  }\r\n\r\n  moveLink(index: string | number, dir: string | number) {\r\n    // @ts-ignore\r\n    _.move(this.dashboard.links, index, index + dir);\r\n  }\r\n\r\n  deleteLink(index: number) {\r\n    this.dashboard.links.splice(index, 1);\r\n    this.dashboard.updateSubmenuVisibility();\r\n  }\r\n}\r\n\r\nfunction dashLinksEditor() {\r\n  return {\r\n    restrict: 'E',\r\n    controller: DashLinksEditorCtrl,\r\n    templateUrl: 'public/app/features/dashboard/components/DashLinks/editor.html',\r\n    bindToController: true,\r\n    controllerAs: 'ctrl',\r\n    scope: {\r\n      dashboard: '=',\r\n    },\r\n  };\r\n}\r\n\r\nangular.module('grafana.directives').directive('dashLinksEditor', dashLinksEditor);\r\n","export { DashLinksContainerCtrl } from './DashLinksContainerCtrl';\r\nexport { DashLinksEditorCtrl } from './DashLinksEditorCtrl';\r\n","// Libaries\r\nimport React, { PureComponent } from 'react';\r\nimport { connect } from 'react-redux';\r\nimport { e2e } from '@grafana/e2e';\r\n// Utils & Services\r\nimport { appEvents } from 'app/core/app_events';\r\nimport { PlaylistSrv } from 'app/features/playlist/playlist_srv';\r\n// Components\r\nimport { DashNavButton } from './DashNavButton';\r\nimport { DashNavTimeControls } from './DashNavTimeControls';\r\nimport { Tooltip } from '@grafana/ui';\r\n// State\r\nimport { updateLocation } from 'app/core/actions';\r\n// Types\r\nimport { DashboardModel } from '../../state';\r\nimport { CoreEvents, StoreState } from 'app/types';\r\n\r\nexport interface OwnProps {\r\n  dashboard: DashboardModel;\r\n  editview: string;\r\n  isEditing: boolean;\r\n  isFullscreen: boolean;\r\n  $injector: any;\r\n  updateLocation: typeof updateLocation;\r\n  onAddPanel: () => void;\r\n}\r\n\r\nexport interface StateProps {\r\n  location: any;\r\n}\r\n\r\ntype Props = StateProps & OwnProps;\r\n\r\nexport class DashNav extends PureComponent<Props> {\r\n  playlistSrv: PlaylistSrv;\r\n\r\n  constructor(props: Props) {\r\n    super(props);\r\n    this.playlistSrv = this.props.$injector.get('playlistSrv');\r\n  }\r\n\r\n  onDahboardNameClick = () => {\r\n    appEvents.emit(CoreEvents.showDashSearch);\r\n  };\r\n\r\n  onFolderNameClick = () => {\r\n    appEvents.emit(CoreEvents.showDashSearch, {\r\n      query: 'folder:current',\r\n    });\r\n  };\r\n\r\n  onClose = () => {\r\n    if (this.props.editview) {\r\n      this.props.updateLocation({\r\n        query: { editview: null },\r\n        partial: true,\r\n      });\r\n    } else {\r\n      this.props.updateLocation({\r\n        query: { panelId: null, edit: null, fullscreen: null, tab: null },\r\n        partial: true,\r\n      });\r\n    }\r\n  };\r\n\r\n  onToggleTVMode = () => {\r\n    appEvents.emit(CoreEvents.toggleKioskMode);\r\n  };\r\n\r\n  onSave = () => {\r\n    const { $injector } = this.props;\r\n    const dashboardSrv = $injector.get('dashboardSrv');\r\n    dashboardSrv.saveDashboard();\r\n  };\r\n\r\n  onOpenSettings = () => {\r\n    this.props.updateLocation({\r\n      query: { editview: 'settings' },\r\n      partial: true,\r\n    });\r\n  };\r\n\r\n  onStarDashboard = () => {\r\n    const { dashboard, $injector } = this.props;\r\n    const dashboardSrv = $injector.get('dashboardSrv');\r\n\r\n    dashboardSrv.starDashboard(dashboard.id, dashboard.meta.isStarred).then((newState: any) => {\r\n      dashboard.meta.isStarred = newState;\r\n      this.forceUpdate();\r\n    });\r\n  };\r\n\r\n  onPlaylistPrev = () => {\r\n    this.playlistSrv.prev();\r\n  };\r\n\r\n  onPlaylistNext = () => {\r\n    this.playlistSrv.next();\r\n  };\r\n\r\n  onPlaylistStop = () => {\r\n    this.playlistSrv.stop();\r\n    this.forceUpdate();\r\n  };\r\n\r\n  onOpenShare = () => {\r\n    const $rootScope = this.props.$injector.get('$rootScope');\r\n    const modalScope = $rootScope.$new();\r\n    modalScope.tabIndex = 0;\r\n    modalScope.dashboard = this.props.dashboard;\r\n\r\n    appEvents.emit(CoreEvents.showModal, {\r\n      src: 'public/app/features/dashboard/components/ShareModal/template.html',\r\n      scope: modalScope,\r\n    });\r\n  };\r\n\r\n  renderDashboardTitleSearchButton() {\r\n    const { dashboard } = this.props;\r\n\r\n    const folderTitle = dashboard.meta.folderTitle;\r\n    const haveFolder = dashboard.meta.folderId > 0;\r\n\r\n    return (\r\n      <>\r\n        <div>\r\n          <div className=\"navbar-page-btn\">\r\n            {!this.isInFullscreenOrSettings && <i className=\"gicon gicon-dashboard\" />}\r\n            {haveFolder && (\r\n              <>\r\n                <a className=\"navbar-page-btn__folder\" onClick={this.onFolderNameClick}>\r\n                  {folderTitle}\r\n                </a>\r\n                <i className=\"fa fa-chevron-right navbar-page-btn__folder-icon\" />\r\n              </>\r\n            )}\r\n            <a onClick={this.onDahboardNameClick}>\r\n              {dashboard.title} <i className=\"fa fa-caret-down navbar-page-btn__search\" />\r\n            </a>\r\n          </div>\r\n        </div>\r\n        {this.isSettings && <span className=\"navbar-settings-title\">&nbsp;/ Settings</span>}\r\n        <div className=\"navbar__spacer\" />\r\n      </>\r\n    );\r\n  }\r\n\r\n  get isInFullscreenOrSettings() {\r\n    return this.props.editview || this.props.isFullscreen;\r\n  }\r\n\r\n  get isSettings() {\r\n    return this.props.editview;\r\n  }\r\n\r\n  renderBackButton() {\r\n    return (\r\n      <div className=\"navbar-edit\">\r\n        <Tooltip content=\"Go back (Esc)\">\r\n          <button\r\n            className=\"navbar-edit__back-btn\"\r\n            onClick={this.onClose}\r\n            aria-label={e2e.pages.Dashboard.Toolbar.selectors.backArrow}\r\n          >\r\n            <i className=\"fa fa-arrow-left\" />\r\n          </button>\r\n        </Tooltip>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  render() {\r\n    const { dashboard, onAddPanel, location, $injector } = this.props;\r\n    const { canStar, canSave, canShare, showSettings, isStarred } = dashboard.meta;\r\n    const { snapshot } = dashboard;\r\n    const snapshotUrl = snapshot && snapshot.originalUrl;\r\n    return (\r\n      <div className=\"navbar\">\r\n        {this.isInFullscreenOrSettings && this.renderBackButton()}\r\n        {this.renderDashboardTitleSearchButton()}\r\n\r\n        {this.playlistSrv.isPlaying && (\r\n          <div className=\"navbar-buttons navbar-buttons--playlist\">\r\n            <DashNavButton\r\n              tooltip=\"Go to previous dashboard\"\r\n              classSuffix=\"tight\"\r\n              icon=\"fa fa-step-backward\"\r\n              onClick={this.onPlaylistPrev}\r\n            />\r\n            <DashNavButton\r\n              tooltip=\"Stop playlist\"\r\n              classSuffix=\"tight\"\r\n              icon=\"fa fa-stop\"\r\n              onClick={this.onPlaylistStop}\r\n            />\r\n            <DashNavButton\r\n              tooltip=\"Go to next dashboard\"\r\n              classSuffix=\"tight\"\r\n              icon=\"fa fa-forward\"\r\n              onClick={this.onPlaylistNext}\r\n            />\r\n          </div>\r\n        )}\r\n\r\n        <div className=\"navbar-buttons navbar-buttons--actions\">\r\n          {canSave && (\r\n            <DashNavButton\r\n              tooltip=\"Add panel\"\r\n              classSuffix=\"add-panel\"\r\n              icon=\"gicon gicon-add-panel\"\r\n              onClick={onAddPanel}\r\n            />\r\n          )}\r\n\r\n          {canStar && (\r\n            <DashNavButton\r\n              tooltip=\"Mark as favorite\"\r\n              classSuffix=\"star\"\r\n              icon={`${isStarred ? 'fa fa-star' : 'fa fa-star-o'}`}\r\n              onClick={this.onStarDashboard}\r\n            />\r\n          )}\r\n\r\n          {canShare && (\r\n            <DashNavButton\r\n              tooltip=\"Share dashboard\"\r\n              classSuffix=\"share\"\r\n              icon=\"fa fa-share-square-o\"\r\n              onClick={this.onOpenShare}\r\n            />\r\n          )}\r\n\r\n          {canSave && (\r\n            <DashNavButton tooltip=\"Save dashboard\" classSuffix=\"save\" icon=\"fa fa-save\" onClick={this.onSave} />\r\n          )}\r\n\r\n          {snapshotUrl && (\r\n            <DashNavButton\r\n              tooltip=\"Open original dashboard\"\r\n              classSuffix=\"snapshot-origin\"\r\n              icon=\"gicon gicon-link\"\r\n              href={snapshotUrl}\r\n            />\r\n          )}\r\n\r\n          {showSettings && (\r\n            <DashNavButton\r\n              tooltip=\"Dashboard settings\"\r\n              classSuffix=\"settings\"\r\n              icon=\"gicon gicon-cog\"\r\n              onClick={this.onOpenSettings}\r\n            />\r\n          )}\r\n        </div>\r\n\r\n        <div className=\"navbar-buttons navbar-buttons--tv\">\r\n          <DashNavButton\r\n            tooltip=\"Cycle view mode\"\r\n            classSuffix=\"tv\"\r\n            icon=\"fa fa-desktop\"\r\n            onClick={this.onToggleTVMode}\r\n          />\r\n        </div>\r\n\r\n        {!dashboard.timepicker.hidden && (\r\n          <div className=\"navbar-buttons\">\r\n            <DashNavTimeControls\r\n              $injector={$injector}\r\n              dashboard={dashboard}\r\n              location={location}\r\n              updateLocation={updateLocation}\r\n            />\r\n          </div>\r\n        )}\r\n      </div>\r\n    );\r\n  }\r\n}\r\n\r\nconst mapStateToProps = (state: StoreState) => ({\r\n  location: state.location,\r\n});\r\n\r\nconst mapDispatchToProps = {\r\n  updateLocation,\r\n};\r\n\r\nexport default connect(mapStateToProps, mapDispatchToProps)(DashNav);\r\n","// Libraries\r\nimport React, { FunctionComponent } from 'react';\r\n// Components\r\nimport { Tooltip } from '@grafana/ui';\r\nimport { e2e } from '@grafana/e2e';\r\n\r\ninterface Props {\r\n  icon: string;\r\n  tooltip: string;\r\n  classSuffix: string;\r\n  onClick?: () => void;\r\n  href?: string;\r\n}\r\n\r\nexport const DashNavButton: FunctionComponent<Props> = ({ icon, tooltip, classSuffix, onClick, href }) => {\r\n  if (onClick) {\r\n    return (\r\n      <Tooltip content={tooltip}>\r\n        <button\r\n          className={`btn navbar-button navbar-button--${classSuffix}`}\r\n          onClick={onClick}\r\n          aria-label={e2e.pages.Dashboard.Toolbar.selectors.toolbarItems(tooltip)}\r\n        >\r\n          <i className={icon} />\r\n        </button>\r\n      </Tooltip>\r\n    );\r\n  }\r\n\r\n  return (\r\n    <Tooltip content={tooltip}>\r\n      <a className={`btn navbar-button navbar-button--${classSuffix}`} href={href}>\r\n        <i className={icon} />\r\n      </a>\r\n    </Tooltip>\r\n  );\r\n};\r\n","// Libaries\r\nimport React, { Component } from 'react';\r\nimport { dateMath, GrafanaTheme } from '@grafana/data';\r\nimport { css } from 'emotion';\r\n\r\n// Types\r\nimport { DashboardModel } from '../../state';\r\nimport { LocationState, CoreEvents } from 'app/types';\r\nimport { TimeRange } from '@grafana/data';\r\n\r\n// State\r\nimport { updateLocation } from 'app/core/actions';\r\n\r\n// Components\r\nimport { RefreshPicker, withTheme, stylesFactory, Themeable } from '@grafana/ui';\r\nimport { TimePickerWithHistory } from 'app/core/components/TimePicker/TimePickerWithHistory';\r\n\r\n// Utils & Services\r\nimport { getTimeSrv, TimeSrv } from 'app/features/dashboard/services/TimeSrv';\r\n\r\nconst getStyles = stylesFactory((theme: GrafanaTheme) => {\r\n  return {\r\n    container: css`\r\n      position: relative;\r\n      display: flex;\r\n      padding: 2px 2px;\r\n    `,\r\n  };\r\n});\r\n\r\nexport interface Props extends Themeable {\r\n  $injector: any;\r\n  dashboard: DashboardModel;\r\n  updateLocation: typeof updateLocation;\r\n  location: LocationState;\r\n}\r\nclass UnthemedDashNavTimeControls extends Component<Props> {\r\n  timeSrv: TimeSrv = getTimeSrv();\r\n  $rootScope = this.props.$injector.get('$rootScope');\r\n\r\n  componentDidMount() {\r\n    // Only reason for this is that sometimes time updates can happen via redux location changes\r\n    // and this happens before timeSrv has had chance to update state (as it listens to angular route-updated)\r\n    // This can be removed after timeSrv listens redux location\r\n    this.props.dashboard.on(CoreEvents.timeRangeUpdated, this.triggerForceUpdate);\r\n  }\r\n\r\n  componentWillUnmount() {\r\n    this.props.dashboard.off(CoreEvents.timeRangeUpdated, this.triggerForceUpdate);\r\n  }\r\n\r\n  triggerForceUpdate = () => {\r\n    this.forceUpdate();\r\n  };\r\n\r\n  get refreshParamInUrl(): string {\r\n    return this.props.location.query.refresh as string;\r\n  }\r\n\r\n  onChangeRefreshInterval = (interval: string) => {\r\n    this.timeSrv.setAutoRefresh(interval);\r\n    this.forceUpdate();\r\n  };\r\n\r\n  onRefresh = () => {\r\n    this.timeSrv.refreshDashboard();\r\n    return Promise.resolve();\r\n  };\r\n\r\n  onMoveBack = () => {\r\n    this.$rootScope.appEvent(CoreEvents.shiftTime, -1);\r\n  };\r\n  onMoveForward = () => {\r\n    this.$rootScope.appEvent(CoreEvents.shiftTime, 1);\r\n  };\r\n\r\n  onChangeTimePicker = (timeRange: TimeRange) => {\r\n    const { dashboard } = this.props;\r\n    const panel = dashboard.timepicker;\r\n    const hasDelay = panel.nowDelay && timeRange.raw.to === 'now';\r\n\r\n    const adjustedFrom = dateMath.isMathString(timeRange.raw.from) ? timeRange.raw.from : timeRange.from;\r\n    const adjustedTo = dateMath.isMathString(timeRange.raw.to) ? timeRange.raw.to : timeRange.to;\r\n    const nextRange = {\r\n      from: adjustedFrom,\r\n      to: hasDelay ? 'now-' + panel.nowDelay : adjustedTo,\r\n    };\r\n\r\n    this.timeSrv.setTime(nextRange);\r\n  };\r\n\r\n  onZoom = () => {\r\n    this.$rootScope.appEvent(CoreEvents.zoomOut, 2);\r\n  };\r\n\r\n  render() {\r\n    const { dashboard, theme } = this.props;\r\n    const intervals = dashboard.timepicker.refresh_intervals;\r\n    const timePickerValue = this.timeSrv.timeRange();\r\n    const timeZone = dashboard.getTimezone();\r\n    const styles = getStyles(theme);\r\n\r\n    return (\r\n      <div className={styles.container}>\r\n        <TimePickerWithHistory\r\n          value={timePickerValue}\r\n          onChange={this.onChangeTimePicker}\r\n          timeZone={timeZone}\r\n          onMoveBackward={this.onMoveBack}\r\n          onMoveForward={this.onMoveForward}\r\n          onZoom={this.onZoom}\r\n        />\r\n        <RefreshPicker\r\n          onIntervalChanged={this.onChangeRefreshInterval}\r\n          onRefresh={this.onRefresh}\r\n          value={dashboard.refresh}\r\n          intervals={intervals}\r\n          tooltip=\"Refresh dashboard\"\r\n        />\r\n      </div>\r\n    );\r\n  }\r\n}\r\n\r\nexport const DashNavTimeControls = withTheme(UnthemedDashNavTimeControls);\r\n","import DashNav from './DashNav';\nexport { DashNav };\n","import React, { PureComponent } from 'react';\r\nimport { Tooltip } from '@grafana/ui';\r\nimport { SlideDown } from 'app/core/components/Animations/SlideDown';\r\nimport { StoreState, FolderInfo } from 'app/types';\r\nimport { DashboardAcl, PermissionLevel, NewDashboardAclItem } from 'app/types/acl';\r\nimport {\r\n  getDashboardPermissions,\r\n  addDashboardPermission,\r\n  removeDashboardPermission,\r\n  updateDashboardPermission,\r\n} from '../../state/actions';\r\nimport PermissionList from 'app/core/components/PermissionList/PermissionList';\r\nimport AddPermission from 'app/core/components/PermissionList/AddPermission';\r\nimport PermissionsInfo from 'app/core/components/PermissionList/PermissionsInfo';\r\nimport { connectWithStore } from 'app/core/utils/connectWithReduxStore';\r\n\r\nexport interface Props {\r\n  dashboardId: number;\r\n  folder?: FolderInfo;\r\n  permissions: DashboardAcl[];\r\n  getDashboardPermissions: typeof getDashboardPermissions;\r\n  updateDashboardPermission: typeof updateDashboardPermission;\r\n  removeDashboardPermission: typeof removeDashboardPermission;\r\n  addDashboardPermission: typeof addDashboardPermission;\r\n}\r\n\r\nexport interface State {\r\n  isAdding: boolean;\r\n}\r\n\r\nexport class DashboardPermissions extends PureComponent<Props, State> {\r\n  constructor(props: Props) {\r\n    super(props);\r\n\r\n    this.state = {\r\n      isAdding: false,\r\n    };\r\n  }\r\n\r\n  componentDidMount() {\r\n    this.props.getDashboardPermissions(this.props.dashboardId);\r\n  }\r\n\r\n  onOpenAddPermissions = () => {\r\n    this.setState({ isAdding: true });\r\n  };\r\n\r\n  onRemoveItem = (item: DashboardAcl) => {\r\n    this.props.removeDashboardPermission(this.props.dashboardId, item);\r\n  };\r\n\r\n  onPermissionChanged = (item: DashboardAcl, level: PermissionLevel) => {\r\n    this.props.updateDashboardPermission(this.props.dashboardId, item, level);\r\n  };\r\n\r\n  onAddPermission = (newItem: NewDashboardAclItem) => {\r\n    return this.props.addDashboardPermission(this.props.dashboardId, newItem);\r\n  };\r\n\r\n  onCancelAddPermission = () => {\r\n    this.setState({ isAdding: false });\r\n  };\r\n\r\n  render() {\r\n    const { permissions, folder } = this.props;\r\n    const { isAdding } = this.state;\r\n\r\n    return (\r\n      <div>\r\n        <div className=\"dashboard-settings__header\">\r\n          <div className=\"page-action-bar\">\r\n            <h3 className=\"d-inline-block\">Permissions</h3>\r\n            <Tooltip placement=\"auto\" content={<PermissionsInfo />}>\r\n              <div className=\"page-sub-heading-icon\">\r\n                <i className=\"gicon gicon-question gicon--has-hover\" />\r\n              </div>\r\n            </Tooltip>\r\n            <div className=\"page-action-bar__spacer\" />\r\n            <button className=\"btn btn-primary pull-right\" onClick={this.onOpenAddPermissions} disabled={isAdding}>\r\n              Add Permission\r\n            </button>\r\n          </div>\r\n        </div>\r\n        <SlideDown in={isAdding}>\r\n          <AddPermission onAddPermission={this.onAddPermission} onCancel={this.onCancelAddPermission} />\r\n        </SlideDown>\r\n        <PermissionList\r\n          items={permissions}\r\n          onRemoveItem={this.onRemoveItem}\r\n          onPermissionChanged={this.onPermissionChanged}\r\n          isFetching={false}\r\n          folderInfo={folder}\r\n        />\r\n      </div>\r\n    );\r\n  }\r\n}\r\n\r\nconst mapStateToProps = (state: StoreState) => ({\r\n  permissions: state.dashboard.permissions,\r\n});\r\n\r\nconst mapDispatchToProps = {\r\n  getDashboardPermissions,\r\n  addDashboardPermission,\r\n  removeDashboardPermission,\r\n  updateDashboardPermission,\r\n};\r\n\r\nexport default connectWithStore(DashboardPermissions, mapStateToProps, mapDispatchToProps);\r\n","// Libaries\r\nimport React, { PureComponent } from 'react';\r\n\r\n// Utils & Services\r\nimport { AngularComponent, getAngularLoader } from '@grafana/runtime';\r\n\r\n// Types\r\nimport { DashboardModel } from '../../state/DashboardModel';\r\n\r\nexport interface Props {\r\n  dashboard: DashboardModel | null;\r\n}\r\n\r\nexport class DashboardSettings extends PureComponent<Props> {\r\n  element: HTMLElement;\r\n  angularCmp: AngularComponent;\r\n\r\n  componentDidMount() {\r\n    const loader = getAngularLoader();\r\n\r\n    const template = '<dashboard-settings dashboard=\"dashboard\" class=\"dashboard-settings\" />';\r\n    const scopeProps = { dashboard: this.props.dashboard };\r\n\r\n    this.angularCmp = loader.load(this.element, scopeProps, template);\r\n  }\r\n\r\n  componentWillUnmount() {\r\n    if (this.angularCmp) {\r\n      this.angularCmp.destroy();\r\n    }\r\n  }\r\n\r\n  render() {\r\n    return <div className=\"panel-height-helper\" ref={element => (this.element = element)} />;\r\n  }\r\n}\r\n","import { appEvents, contextSrv, coreModule } from 'app/core/core';\r\nimport { DashboardModel } from '../../state/DashboardModel';\r\nimport $ from 'jquery';\r\nimport _ from 'lodash';\r\nimport angular, { ILocationService } from 'angular';\r\nimport config from 'app/core/config';\r\nimport { BackendSrv } from 'app/core/services/backend_srv';\r\nimport { DashboardSrv } from '../../services/DashboardSrv';\r\nimport { CoreEvents } from 'app/types';\r\nimport { GrafanaRootScope } from 'app/routes/GrafanaCtrl';\r\nimport { AppEvents } from '@grafana/data';\r\nimport { e2e } from '@grafana/e2e';\r\n\r\nexport class SettingsCtrl {\r\n  dashboard: DashboardModel;\r\n  isOpen: boolean;\r\n  viewId: string;\r\n  json: string;\r\n  alertCount: number;\r\n  canSaveAs: boolean;\r\n  canSave: boolean;\r\n  canDelete: boolean;\r\n  sections: any[];\r\n  hasUnsavedFolderChange: boolean;\r\n  selectors: typeof e2e.pages.Dashboard.Settings.General.selectors;\r\n\r\n  /** @ngInject */\r\n  constructor(\r\n    private $scope: any,\r\n    private $route: any,\r\n    private $location: ILocationService,\r\n    private $rootScope: GrafanaRootScope,\r\n    private backendSrv: BackendSrv,\r\n    private dashboardSrv: DashboardSrv\r\n  ) {\r\n    // temp hack for annotations and variables editors\r\n    // that rely on inherited scope\r\n    $scope.dashboard = this.dashboard;\r\n\r\n    this.$scope.$on('$destroy', () => {\r\n      this.dashboard.updateSubmenuVisibility();\r\n      setTimeout(() => {\r\n        this.$rootScope.appEvent(CoreEvents.dashScroll, { restore: true });\r\n        this.dashboard.startRefresh();\r\n      });\r\n    });\r\n\r\n    this.canSaveAs = contextSrv.hasEditPermissionInFolders;\r\n    this.canSave = this.dashboard.meta.canSave;\r\n    this.canDelete = this.dashboard.meta.canSave;\r\n\r\n    this.buildSectionList();\r\n    this.onRouteUpdated();\r\n\r\n    this.$rootScope.onAppEvent(CoreEvents.routeUpdated, this.onRouteUpdated.bind(this), $scope);\r\n    this.$rootScope.appEvent(CoreEvents.dashScroll, { animate: false, pos: 0 });\r\n    this.$rootScope.onAppEvent(CoreEvents.dashboardSaved, this.onPostSave.bind(this), $scope);\r\n    this.selectors = e2e.pages.Dashboard.Settings.General.selectors;\r\n  }\r\n\r\n  buildSectionList() {\r\n    this.sections = [];\r\n\r\n    if (this.dashboard.meta.canEdit) {\r\n      this.sections.push({\r\n        title: 'General',\r\n        id: 'settings',\r\n        icon: 'gicon gicon-preferences',\r\n      });\r\n      this.sections.push({\r\n        title: 'Annotations',\r\n        id: 'annotations',\r\n        icon: 'gicon gicon-annotation',\r\n      });\r\n      this.sections.push({\r\n        title: 'Variables',\r\n        id: 'templating',\r\n        icon: 'gicon gicon-variable',\r\n      });\r\n      this.sections.push({\r\n        title: 'Links',\r\n        id: 'links',\r\n        icon: 'gicon gicon-link',\r\n      });\r\n    }\r\n\r\n    if (this.dashboard.id && this.dashboard.meta.canSave) {\r\n      this.sections.push({\r\n        title: 'Versions',\r\n        id: 'versions',\r\n        icon: 'fa fa-fw fa-history',\r\n      });\r\n    }\r\n\r\n    if (this.dashboard.id && this.dashboard.meta.canAdmin) {\r\n      this.sections.push({\r\n        title: 'Permissions',\r\n        id: 'permissions',\r\n        icon: 'fa fa-fw fa-lock',\r\n      });\r\n    }\r\n\r\n    if (this.dashboard.meta.canMakeEditable) {\r\n      this.sections.push({\r\n        title: 'General',\r\n        icon: 'gicon gicon-preferences',\r\n        id: 'make_editable',\r\n      });\r\n    }\r\n\r\n    this.sections.push({\r\n      title: 'JSON Model',\r\n      id: 'dashboard_json',\r\n      icon: 'gicon gicon-json',\r\n    });\r\n\r\n    const params = this.$location.search();\r\n    const url = this.$location.path();\r\n\r\n    for (const section of this.sections) {\r\n      const sectionParams = _.defaults({ editview: section.id }, params);\r\n      section.url = config.appSubUrl + url + '?' + $.param(sectionParams);\r\n    }\r\n  }\r\n\r\n  onRouteUpdated() {\r\n    this.viewId = this.$location.search().editview;\r\n\r\n    if (this.viewId) {\r\n      this.json = angular.toJson(this.dashboard.getSaveModelClone(), true);\r\n    }\r\n\r\n    if (this.viewId === 'settings' && this.dashboard.meta.canMakeEditable) {\r\n      this.viewId = 'make_editable';\r\n    }\r\n\r\n    const currentSection: any = _.find(this.sections, { id: this.viewId } as any);\r\n    if (!currentSection) {\r\n      this.sections.unshift({\r\n        title: 'Not found',\r\n        id: '404',\r\n        icon: 'fa fa-fw fa-warning',\r\n      });\r\n      this.viewId = '404';\r\n    }\r\n  }\r\n\r\n  openSaveAsModal() {\r\n    this.dashboardSrv.showSaveAsModal();\r\n  }\r\n\r\n  saveDashboard() {\r\n    this.dashboardSrv.saveDashboard();\r\n  }\r\n\r\n  saveDashboardJson() {\r\n    this.dashboardSrv.saveJSONDashboard(this.json).then(() => {\r\n      this.$route.reload();\r\n    });\r\n  }\r\n\r\n  onPostSave() {\r\n    this.hasUnsavedFolderChange = false;\r\n  }\r\n\r\n  hideSettings() {\r\n    const urlParams = this.$location.search();\r\n    delete urlParams.editview;\r\n    setTimeout(() => {\r\n      this.$rootScope.$apply(() => {\r\n        this.$location.search(urlParams);\r\n      });\r\n    });\r\n  }\r\n\r\n  makeEditable() {\r\n    this.dashboard.editable = true;\r\n    this.dashboard.meta.canMakeEditable = false;\r\n    this.dashboard.meta.canEdit = true;\r\n    this.dashboard.meta.canSave = true;\r\n    this.canDelete = true;\r\n    this.viewId = 'settings';\r\n    this.buildSectionList();\r\n\r\n    const currentSection: any = _.find(this.sections, { id: this.viewId } as any);\r\n    this.$location.url(currentSection.url);\r\n  }\r\n\r\n  deleteDashboard() {\r\n    let confirmText = '';\r\n    let text2 = this.dashboard.title;\r\n\r\n    if (this.dashboard.meta.provisioned) {\r\n      appEvents.emit(CoreEvents.showConfirmModal, {\r\n        title: 'Cannot delete provisioned dashboard',\r\n        text: `\r\n          This dashboard is managed by Grafanas provisioning and cannot be deleted. Remove the dashboard from the\r\n          config file to delete it.\r\n        `,\r\n        text2: `\r\n          <i>See <a class=\"external-link\" href=\"http://docs.grafana.org/administration/provisioning/#dashboards\" target=\"_blank\">\r\n          documentation</a> for more information about provisioning.</i>\r\n          </br>\r\n          File path: ${this.dashboard.meta.provisionedExternalId}\r\n        `,\r\n        text2htmlBind: true,\r\n        icon: 'fa-trash',\r\n        noText: 'OK',\r\n      });\r\n      return;\r\n    }\r\n\r\n    const alerts = _.sumBy(this.dashboard.panels, panel => {\r\n      return panel.alert ? 1 : 0;\r\n    });\r\n\r\n    if (alerts > 0) {\r\n      confirmText = 'DELETE';\r\n      text2 = `This dashboard contains ${alerts} alerts. Deleting this dashboard will also delete those alerts`;\r\n    }\r\n\r\n    appEvents.emit(CoreEvents.showConfirmModal, {\r\n      title: 'Delete',\r\n      text: 'Do you want to delete this dashboard?',\r\n      text2: text2,\r\n      icon: 'fa-trash',\r\n      confirmText: confirmText,\r\n      yesText: 'Delete',\r\n      onConfirm: () => {\r\n        this.dashboard.meta.canSave = false;\r\n        this.deleteDashboardConfirmed();\r\n      },\r\n    });\r\n  }\r\n\r\n  deleteDashboardConfirmed() {\r\n    this.backendSrv.deleteDashboard(this.dashboard.uid, false).then(() => {\r\n      appEvents.emit(AppEvents.alertSuccess, ['Dashboard Deleted', this.dashboard.title + ' has been deleted']);\r\n      this.$location.url('/');\r\n    });\r\n  }\r\n\r\n  onFolderChange(folder: { id: number; title: string }) {\r\n    this.dashboard.meta.folderId = folder.id;\r\n    this.dashboard.meta.folderTitle = folder.title;\r\n    this.hasUnsavedFolderChange = true;\r\n  }\r\n\r\n  getFolder() {\r\n    return {\r\n      id: this.dashboard.meta.folderId,\r\n      title: this.dashboard.meta.folderTitle,\r\n      url: this.dashboard.meta.folderUrl,\r\n    };\r\n  }\r\n}\r\n\r\nexport function dashboardSettings() {\r\n  return {\r\n    restrict: 'E',\r\n    templateUrl: 'public/app/features/dashboard/components/DashboardSettings/template.html',\r\n    controller: SettingsCtrl,\r\n    bindToController: true,\r\n    controllerAs: 'ctrl',\r\n    transclude: true,\r\n    scope: { dashboard: '=' },\r\n  };\r\n}\r\n\r\ncoreModule.directive('dashboardSettings', dashboardSettings);\r\n","import coreModule from 'app/core/core_module';\r\nimport { DashboardModel } from 'app/features/dashboard/state';\r\n\r\nexport class TimePickerCtrl {\r\n  panel: any;\r\n  dashboard: DashboardModel;\r\n\r\n  constructor() {\r\n    this.panel = this.dashboard.timepicker;\r\n    this.panel.refresh_intervals = this.panel.refresh_intervals || [\r\n      '5s',\r\n      '10s',\r\n      '30s',\r\n      '1m',\r\n      '5m',\r\n      '15m',\r\n      '30m',\r\n      '1h',\r\n      '2h',\r\n      '1d',\r\n    ];\r\n  }\r\n}\r\n\r\nconst template = `\r\n<div class=\"editor-row\">\r\n\t<h5 class=\"section-heading\">Time Options</h5>\r\n\r\n  <div class=\"gf-form-group\">\r\n\t\t<div class=\"gf-form\">\r\n\t\t\t<label class=\"gf-form-label width-10\">Timezone</label>\r\n\t\t\t<div class=\"gf-form-select-wrapper\">\r\n\t\t\t\t<select ng-model=\"ctrl.dashboard.timezone\" class='gf-form-input' ng-options=\"f.value as f.text for f in\r\n\t\t\t\t  [{value: '', text: 'Default'}, {value: 'browser', text: 'Local browser time'},{value: 'utc', text: 'UTC'}]\">\r\n\t\t\t\t</select>\r\n\t\t\t</div>\r\n\t\t</div>\r\n\r\n\t\t<div class=\"gf-form\">\r\n\t\t\t<span class=\"gf-form-label width-10\">Auto-refresh</span>\r\n\t\t\t<input type=\"text\" class=\"gf-form-input max-width-25\" ng-model=\"ctrl.panel.refresh_intervals\" array-join>\r\n\t\t</div>\r\n\t\t<div class=\"gf-form\">\r\n\t\t\t<span class=\"gf-form-label width-10\">Now delay now-</span>\r\n\t\t\t<input type=\"text\" class=\"gf-form-input max-width-25\" ng-model=\"ctrl.panel.nowDelay\"\r\n\t\t\t    placeholder=\"0m\"\r\n\t\t\t    valid-time-span\r\n\t\t\t    bs-tooltip=\"'Enter 1m to ignore the last minute (because it can contain incomplete metrics)'\"\r\n \t\t\t\t  data-placement=\"right\">\r\n\t\t</div>\r\n\r\n\t\t<gf-form-switch class=\"gf-form\" label=\"Hide time picker\" checked=\"ctrl.panel.hidden\" label-class=\"width-10\">\r\n\t\t</gf-form-switch>\r\n\t</div>\r\n</div>\r\n`;\r\n\r\nexport function TimePickerSettings() {\r\n  return {\r\n    restrict: 'E',\r\n    template: template,\r\n    controller: TimePickerCtrl,\r\n    bindToController: true,\r\n    controllerAs: 'ctrl',\r\n    scope: {\r\n      dashboard: '=',\r\n    },\r\n  };\r\n}\r\n\r\ncoreModule.directive('gfTimePickerSettings', TimePickerSettings);\r\n","export { SettingsCtrl } from './SettingsCtrl';\r\nexport { DashboardSettings } from './DashboardSettings';\r\nexport { TimePickerSettings } from './TimePickerSettings';\r\n","import angular from 'angular';\r\nimport * as fileExport from 'app/core/utils/file_export';\r\nimport appEvents from 'app/core/app_events';\r\nimport { DashboardSrv } from 'app/features/dashboard/services/DashboardSrv';\r\nimport { CoreEvents } from 'app/types';\r\n\r\nexport class ExportDataModalCtrl {\r\n  private data: any;\r\n  private panel: string;\r\n  asRows = true;\r\n  dateTimeFormat = 'YYYY-MM-DDTHH:mm:ssZ';\r\n  excel = false;\r\n\r\n  /** @ngInject */\r\n  constructor(private dashboardSrv: DashboardSrv) {}\r\n\r\n  export() {\r\n    const timezone = this.dashboardSrv.getCurrent().timezone;\r\n    const options = {\r\n      excel: this.excel,\r\n      dateTimeFormat: this.dateTimeFormat,\r\n      timezone,\r\n    };\r\n    if (this.panel === 'table') {\r\n      fileExport.exportTableDataToCsv(this.data, this.excel);\r\n    } else {\r\n      if (this.asRows) {\r\n        fileExport.exportSeriesListToCsv(this.data, options);\r\n      } else {\r\n        fileExport.exportSeriesListToCsvColumns(this.data, options);\r\n      }\r\n    }\r\n\r\n    this.dismiss();\r\n  }\r\n\r\n  dismiss() {\r\n    appEvents.emit(CoreEvents.hideModal);\r\n  }\r\n}\r\n\r\nexport function exportDataModal() {\r\n  return {\r\n    restrict: 'E',\r\n    templateUrl: 'public/app/features/dashboard/components/ExportDataModal/template.html',\r\n    controller: ExportDataModalCtrl,\r\n    controllerAs: 'ctrl',\r\n    scope: {\r\n      panel: '<',\r\n      data: '<', // The difference to '=' is that the bound properties are not watched\r\n    },\r\n    bindToController: true,\r\n  };\r\n}\r\n\r\nangular.module('grafana.directives').directive('exportDataModal', exportDataModal);\r\n","export { ExportDataModalCtrl } from './ExportDataModalCtrl';\r\n","import _ from 'lodash';\r\nimport coreModule from 'app/core/core_module';\r\nimport appEvents from 'app/core/app_events';\r\nimport { BackendSrv } from 'app/core/services/backend_srv';\r\nimport { ValidationSrv } from 'app/features/manage-dashboards';\r\nimport { ContextSrv } from 'app/core/services/context_srv';\r\nimport { AppEvents } from '@grafana/data';\r\n\r\nexport class FolderPickerCtrl {\r\n  initialTitle: string;\r\n  initialFolderId?: number;\r\n  labelClass: string;\r\n  onChange: any;\r\n  onLoad: any;\r\n  onCreateFolder: any;\r\n  enterFolderCreation: any;\r\n  exitFolderCreation: any;\r\n  enableCreateNew: boolean;\r\n  enableReset: boolean;\r\n  rootName = 'General';\r\n  folder: any;\r\n  createNewFolder: boolean;\r\n  newFolderName: string;\r\n  newFolderNameTouched: boolean;\r\n  hasValidationError: boolean;\r\n  validationError: any;\r\n  isEditor: boolean;\r\n  dashboardId?: number;\r\n\r\n  /** @ngInject */\r\n  constructor(private backendSrv: BackendSrv, private validationSrv: ValidationSrv, private contextSrv: ContextSrv) {\r\n    this.isEditor = this.contextSrv.isEditor;\r\n\r\n    if (!this.labelClass) {\r\n      this.labelClass = 'width-7';\r\n    }\r\n\r\n    this.loadInitialValue();\r\n  }\r\n\r\n  getOptions(query: string) {\r\n    const params = {\r\n      query,\r\n      type: 'dash-folder',\r\n      permission: 'Edit',\r\n    };\r\n\r\n    return this.backendSrv.get('api/search', params).then((result: any) => {\r\n      if (\r\n        this.isEditor &&\r\n        (query === '' ||\r\n          query.toLowerCase() === 'g' ||\r\n          query.toLowerCase() === 'ge' ||\r\n          query.toLowerCase() === 'gen' ||\r\n          query.toLowerCase() === 'gene' ||\r\n          query.toLowerCase() === 'gener' ||\r\n          query.toLowerCase() === 'genera' ||\r\n          query.toLowerCase() === 'general')\r\n      ) {\r\n        result.unshift({ title: this.rootName, id: 0 });\r\n      }\r\n\r\n      if (this.isEditor && this.enableCreateNew && query === '') {\r\n        result.unshift({ title: '-- New Folder --', id: -1 });\r\n      }\r\n\r\n      if (this.enableReset && query === '' && this.initialTitle !== '') {\r\n        result.unshift({ title: this.initialTitle, id: null });\r\n      }\r\n\r\n      return _.map(result, item => {\r\n        return { text: item.title, value: item.id };\r\n      });\r\n    });\r\n  }\r\n\r\n  onFolderChange(option: { value: number; text: string }) {\r\n    if (!option) {\r\n      option = { value: 0, text: this.rootName };\r\n    } else if (option.value === -1) {\r\n      this.createNewFolder = true;\r\n      this.enterFolderCreation();\r\n      return;\r\n    }\r\n    this.onChange({ $folder: { id: option.value, title: option.text } });\r\n  }\r\n\r\n  newFolderNameChanged() {\r\n    this.newFolderNameTouched = true;\r\n\r\n    this.validationSrv\r\n      .validateNewFolderName(this.newFolderName)\r\n      .then(() => {\r\n        this.hasValidationError = false;\r\n      })\r\n      .catch((err: any) => {\r\n        this.hasValidationError = true;\r\n        this.validationError = err.message;\r\n      });\r\n  }\r\n\r\n  createFolder(evt: any) {\r\n    if (evt) {\r\n      evt.stopPropagation();\r\n      evt.preventDefault();\r\n    }\r\n\r\n    return this.backendSrv.createFolder({ title: this.newFolderName }).then((result: { title: string; id: number }) => {\r\n      appEvents.emit(AppEvents.alertSuccess, ['Folder Created', 'OK']);\r\n\r\n      this.closeCreateFolder();\r\n      this.folder = { text: result.title, value: result.id };\r\n      this.onFolderChange(this.folder);\r\n    });\r\n  }\r\n\r\n  cancelCreateFolder(evt: any) {\r\n    if (evt) {\r\n      evt.stopPropagation();\r\n      evt.preventDefault();\r\n    }\r\n\r\n    this.closeCreateFolder();\r\n    this.loadInitialValue();\r\n  }\r\n\r\n  private closeCreateFolder() {\r\n    this.exitFolderCreation();\r\n    this.createNewFolder = false;\r\n    this.hasValidationError = false;\r\n    this.validationError = null;\r\n    this.newFolderName = '';\r\n    this.newFolderNameTouched = false;\r\n  }\r\n\r\n  private loadInitialValue() {\r\n    const resetFolder: { text: string; value: any } = { text: this.initialTitle, value: null };\r\n    const rootFolder: { text: string; value: any } = { text: this.rootName, value: 0 };\r\n\r\n    this.getOptions('').then((result: any[]) => {\r\n      let folder: { text: string; value: any };\r\n      if (this.initialFolderId) {\r\n        // @ts-ignore\r\n        folder = _.find(result, { value: this.initialFolderId });\r\n      } else if (this.enableReset && this.initialTitle && this.initialFolderId === null) {\r\n        folder = resetFolder;\r\n      }\r\n\r\n      if (!folder) {\r\n        if (this.isEditor) {\r\n          folder = rootFolder;\r\n        } else {\r\n          // We shouldn't assign a random folder without the user actively choosing it on a persisted dashboard\r\n          const isPersistedDashBoard = this.dashboardId ? true : false;\r\n          if (isPersistedDashBoard) {\r\n            folder = resetFolder;\r\n          } else {\r\n            folder = result.length > 0 ? result[0] : resetFolder;\r\n          }\r\n        }\r\n      }\r\n\r\n      this.folder = folder;\r\n\r\n      // if this is not the same as our initial value notify parent\r\n      if (this.folder.value !== this.initialFolderId) {\r\n        this.onChange({ $folder: { id: this.folder.value, title: this.folder.text } });\r\n      }\r\n    });\r\n  }\r\n}\r\n\r\nexport function folderPicker() {\r\n  return {\r\n    restrict: 'E',\r\n    templateUrl: 'public/app/features/dashboard/components/FolderPicker/template.html',\r\n    controller: FolderPickerCtrl,\r\n    bindToController: true,\r\n    controllerAs: 'ctrl',\r\n    scope: {\r\n      initialTitle: '<',\r\n      initialFolderId: '<',\r\n      labelClass: '@',\r\n      rootName: '@',\r\n      onChange: '&',\r\n      onCreateFolder: '&',\r\n      enterFolderCreation: '&',\r\n      exitFolderCreation: '&',\r\n      enableCreateNew: '@',\r\n      enableReset: '@',\r\n      dashboardId: '<?',\r\n    },\r\n  };\r\n}\r\n\r\ncoreModule.directive('folderPicker', folderPicker);\r\n","export { FolderPickerCtrl } from './FolderPickerCtrl';\r\n","import { coreModule } from 'app/core/core';\r\n\r\nexport class RowOptionsCtrl {\r\n  row: any;\r\n  source: any;\r\n  dismiss: any;\r\n  onUpdated: any;\r\n  showDelete: boolean;\r\n\r\n  /** @ngInject */\r\n  constructor() {\r\n    this.source = this.row;\r\n    this.row = this.row.getSaveModel();\r\n  }\r\n\r\n  update() {\r\n    this.source.title = this.row.title;\r\n    this.source.repeat = this.row.repeat;\r\n    this.onUpdated();\r\n    this.dismiss();\r\n  }\r\n}\r\n\r\nexport function rowOptionsDirective() {\r\n  return {\r\n    restrict: 'E',\r\n    templateUrl: 'public/app/features/dashboard/components/RowOptions/template.html',\r\n    controller: RowOptionsCtrl,\r\n    bindToController: true,\r\n    controllerAs: 'ctrl',\r\n    scope: {\r\n      row: '=',\r\n      dismiss: '&',\r\n      onUpdated: '&',\r\n    },\r\n  };\r\n}\r\n\r\ncoreModule.directive('rowOptions', rowOptionsDirective);\r\n","export { RowOptionsCtrl } from './RowOptionsCtrl';\r\n","import coreModule from 'app/core/core_module';\r\nimport { DashboardSrv } from '../../services/DashboardSrv';\r\nimport { PanelModel } from '../../state/PanelModel';\r\n\r\nconst template = `\r\n<div class=\"modal-body\">\r\n\t<div class=\"modal-header\">\r\n\t\t<h2 class=\"modal-header-title\">\r\n\t\t\t<i class=\"fa fa-copy\"></i>\r\n\t\t\t<span class=\"p-l-1\">Save As...</span>\r\n\t\t</h2>\r\n\r\n\t\t<a class=\"modal-header-close\" ng-click=\"ctrl.dismiss();\">\r\n\t\t\t<i class=\"fa fa-remove\"></i>\r\n\t\t</a>\r\n\t</div>\r\n\r\n\t<form name=\"ctrl.saveForm\" class=\"modal-content\" novalidate>\r\n\t\t<div class=\"p-t-2\">\r\n\t\t\t<div class=\"gf-form\">\r\n\t\t\t\t<label class=\"gf-form-label width-8\">New name</label>\r\n\t\t\t\t<input type=\"text\" class=\"gf-form-input\" ng-model=\"ctrl.clone.title\" give-focus=\"true\" required aria-label=\"Save dashboard title field\">\r\n\t\t\t</div>\r\n      <folder-picker initial-folder-id=\"ctrl.folderId\"\r\n                       on-change=\"ctrl.onFolderChange($folder)\"\r\n                       enter-folder-creation=\"ctrl.onEnterFolderCreation()\"\r\n                       exit-folder-creation=\"ctrl.onExitFolderCreation()\"\r\n                       enable-create-new=\"true\"\r\n                       label-class=\"width-8\"\r\n                       dashboard-id=\"ctrl.clone.id\">\r\n      </folder-picker>\r\n      <div class=\"gf-form-inline\">\r\n        <gf-form-switch class=\"gf-form\" label=\"Copy tags\" label-class=\"width-8\" checked=\"ctrl.copyTags\">\r\n        </gf-form-switch>\r\n      </div>\r\n\t\t</div>\r\n\r\n\t\t<div class=\"gf-form-button-row text-center\">\r\n      <button\r\n        type=\"submit\"\r\n        class=\"btn btn-primary\"\r\n        ng-click=\"ctrl.save()\"\r\n        ng-disabled=\"!ctrl.isValidFolderSelection\"\r\n        aria-label=\"Save dashboard button\">\r\n        Save\r\n      </button>\r\n\t\t\t<a class=\"btn-text\" ng-click=\"ctrl.dismiss();\">Cancel</a>\r\n\t\t</div>\r\n\t</form>\r\n</div>\r\n`;\r\n\r\nexport class SaveDashboardAsModalCtrl {\r\n  clone: any;\r\n  folderId: any;\r\n  dismiss: () => void;\r\n  isValidFolderSelection = true;\r\n  copyTags: boolean;\r\n\r\n  /** @ngInject */\r\n  constructor(private dashboardSrv: DashboardSrv) {\r\n    const dashboard = this.dashboardSrv.getCurrent();\r\n    this.clone = dashboard.getSaveModelClone();\r\n    this.clone.id = null;\r\n    this.clone.uid = '';\r\n    this.clone.title += ' Copy';\r\n    this.clone.editable = true;\r\n    this.clone.hideControls = false;\r\n    this.folderId = dashboard.meta.folderId;\r\n    this.copyTags = false;\r\n\r\n    // remove alerts if source dashboard is already persisted\r\n    // do not want to create alert dupes\r\n    if (dashboard.id > 0) {\r\n      this.clone.panels.forEach((panel: PanelModel) => {\r\n        if (panel.type === 'graph' && panel.alert) {\r\n          delete panel.thresholds;\r\n        }\r\n        delete panel.alert;\r\n      });\r\n    }\r\n\r\n    delete this.clone.autoUpdate;\r\n  }\r\n\r\n  save() {\r\n    if (!this.copyTags) {\r\n      this.clone.tags = [];\r\n    }\r\n\r\n    return this.dashboardSrv.save(this.clone, { folderId: this.folderId }).then(this.dismiss);\r\n  }\r\n\r\n  keyDown(evt: KeyboardEvent) {\r\n    if (evt.keyCode === 13) {\r\n      this.save();\r\n    }\r\n  }\r\n\r\n  onFolderChange(folder: { id: any }) {\r\n    this.folderId = folder.id;\r\n  }\r\n\r\n  onEnterFolderCreation() {\r\n    this.isValidFolderSelection = false;\r\n  }\r\n\r\n  onExitFolderCreation() {\r\n    this.isValidFolderSelection = true;\r\n  }\r\n}\r\n\r\nexport function saveDashboardAsDirective() {\r\n  return {\r\n    restrict: 'E',\r\n    template: template,\r\n    controller: SaveDashboardAsModalCtrl,\r\n    bindToController: true,\r\n    controllerAs: 'ctrl',\r\n    scope: { dismiss: '&' },\r\n  };\r\n}\r\n\r\ncoreModule.directive('saveDashboardAsModal', saveDashboardAsDirective);\r\n","import { e2e } from '@grafana/e2e';\r\n\r\nimport coreModule from 'app/core/core_module';\r\nimport { DashboardSrv } from '../../services/DashboardSrv';\r\nimport { CloneOptions } from '../../state/DashboardModel';\r\n\r\nconst template = `\r\n<div class=\"modal-body\">\r\n  <div class=\"modal-header\">\r\n    <h2 class=\"modal-header-title\">\r\n      <i class=\"fa fa-save\"></i>\r\n      <span class=\"p-l-1\">Save changes</span>\r\n    </h2>\r\n\r\n    <a class=\"modal-header-close\" ng-click=\"ctrl.dismiss();\">\r\n      <i class=\"fa fa-remove\"></i>\r\n    </a>\r\n  </div>\r\n\r\n  <form name=\"ctrl.saveForm\" ng-submit=\"ctrl.save()\" class=\"modal-content\" novalidate>\r\n    <div class=\"p-t-1\">\r\n      <div class=\"gf-form-group\" ng-if=\"ctrl.timeChange || ctrl.variableValueChange\">\r\n\t\t    <gf-form-switch class=\"gf-form\"\r\n\t\t\t    label=\"Save current time range\" ng-if=\"ctrl.timeChange\" label-class=\"width-12\" switch-class=\"max-width-6\"\r\n\t\t\t    checked=\"ctrl.saveTimerange\" on-change=\"buildUrl()\">\r\n\t\t    </gf-form-switch>\r\n\t\t    <gf-form-switch class=\"gf-form\"\r\n\t\t\t    label=\"Save current variables\" ng-if=\"ctrl.variableValueChange\" label-class=\"width-12\" switch-class=\"max-width-6\"\r\n\t\t\t    checked=\"ctrl.saveVariables\" on-change=\"buildUrl()\">\r\n\t\t    </gf-form-switch>\r\n\t    </div>\r\n      <div class=\"gf-form\">\r\n        <label class=\"gf-form-hint\">\r\n          <input\r\n            type=\"text\"\r\n            name=\"message\"\r\n            class=\"gf-form-input\"\r\n            placeholder=\"Add a note to describe your changes &hellip;\"\r\n            give-focus=\"true\"\r\n            ng-model=\"ctrl.message\"\r\n            ng-model-options=\"{allowInvalid: true}\"\r\n            ng-maxlength=\"this.max\"\r\n            maxlength=\"64\"\r\n            autocomplete=\"off\" />\r\n          <small class=\"gf-form-hint-text muted\" ng-cloak>\r\n            <span ng-class=\"{'text-error': ctrl.saveForm.message.$invalid && ctrl.saveForm.message.$dirty }\">\r\n              {{ctrl.message.length || 0}}\r\n            </span>\r\n            / {{ctrl.max}} characters\r\n          </small>\r\n        </label>\r\n      </div>\r\n    </div>\r\n\r\n    <div class=\"gf-form-button-row text-center\">\r\n      <button\r\n        id=\"saveBtn\"\r\n        type=\"submit\"\r\n        class=\"btn btn-primary\"\r\n        ng-class=\"{'btn-primary--processing': ctrl.isSaving}\"\r\n        ng-disabled=\"ctrl.saveForm.$invalid || ctrl.isSaving\"\r\n        aria-label={{ctrl.selectors.save}}\r\n      >\r\n        <span ng-if=\"!ctrl.isSaving\">Save</span>\r\n        <span ng-if=\"ctrl.isSaving === true\">Saving...</span>\r\n      </button>\r\n      <button class=\"btn btn-inverse\" ng-click=\"ctrl.dismiss();\">Cancel</button>\r\n    </div>\r\n  </form>\r\n</div>\r\n`;\r\n\r\nexport class SaveDashboardModalCtrl {\r\n  message: string;\r\n  saveVariables = false;\r\n  saveTimerange = false;\r\n  time: any;\r\n  originalTime: any;\r\n  current: any[] = [];\r\n  originalCurrent: any[] = [];\r\n  max: number;\r\n  saveForm: any;\r\n  isSaving: boolean;\r\n  dismiss: () => void;\r\n  timeChange = false;\r\n  variableValueChange = false;\r\n  selectors: typeof e2e.pages.SaveDashboardModal.selectors;\r\n\r\n  /** @ngInject */\r\n  constructor(private dashboardSrv: DashboardSrv) {\r\n    this.message = '';\r\n    this.max = 64;\r\n    this.isSaving = false;\r\n    this.timeChange = this.dashboardSrv.getCurrent().hasTimeChanged();\r\n    this.variableValueChange = this.dashboardSrv.getCurrent().hasVariableValuesChanged();\r\n    this.selectors = e2e.pages.SaveDashboardModal.selectors;\r\n  }\r\n\r\n  save() {\r\n    if (!this.saveForm.$valid) {\r\n      return;\r\n    }\r\n\r\n    const options: CloneOptions = {\r\n      saveVariables: this.saveVariables,\r\n      saveTimerange: this.saveTimerange,\r\n      message: this.message,\r\n    };\r\n\r\n    const dashboard = this.dashboardSrv.getCurrent();\r\n    const saveModel = dashboard.getSaveModelClone(options);\r\n\r\n    this.isSaving = true;\r\n    return this.dashboardSrv.save(saveModel, options).then(this.postSave.bind(this, options));\r\n  }\r\n\r\n  postSave(options?: { saveVariables?: boolean; saveTimerange?: boolean }) {\r\n    if (options.saveVariables) {\r\n      this.dashboardSrv.getCurrent().resetOriginalVariables();\r\n    }\r\n\r\n    if (options.saveTimerange) {\r\n      this.dashboardSrv.getCurrent().resetOriginalTime();\r\n    }\r\n\r\n    this.dismiss();\r\n  }\r\n}\r\n\r\nexport function saveDashboardModalDirective() {\r\n  return {\r\n    restrict: 'E',\r\n    template: template,\r\n    controller: SaveDashboardModalCtrl,\r\n    bindToController: true,\r\n    controllerAs: 'ctrl',\r\n    scope: { dismiss: '&' },\r\n  };\r\n}\r\n\r\ncoreModule.directive('saveDashboardModal', saveDashboardModalDirective);\r\n","import angular from 'angular';\r\nimport { saveAs } from 'file-saver';\r\nimport coreModule from 'app/core/core_module';\r\nimport { DashboardModel } from '../../state';\r\nimport { DashboardSrv } from '../../services/DashboardSrv';\r\n\r\nconst template = `\r\n<div class=\"modal-body\">\r\n  <div class=\"modal-header\">\r\n    <h2 class=\"modal-header-title\">\r\n      <i class=\"fa fa-save\"></i><span class=\"p-l-1\">Cannot save provisioned dashboard</span>\r\n    </h2>\r\n\r\n    <a class=\"modal-header-close\" ng-click=\"ctrl.dismiss();\">\r\n      <i class=\"fa fa-remove\"></i>\r\n    </a>\r\n  </div>\r\n\r\n  <div class=\"modal-content\">\r\n    <small>\r\n      This dashboard cannot be saved from Grafana's UI since it has been provisioned from another source.\r\n      Copy the JSON or save it to a file below. Then you can update your dashboard in corresponding provisioning source.<br/>\r\n      <i>See <a class=\"external-link\" href=\"http://docs.grafana.org/administration/provisioning/#dashboards\" target=\"_blank\">\r\n      documentation</a> for more information about provisioning.</i>\r\n    </small>\r\n    <div class=\"p-t-1\">\r\n      File path: {{ctrl.dashboardModel.meta.provisionedExternalId}}\r\n    </div>\r\n    <div class=\"p-t-2\">\r\n      <div class=\"gf-form\">\r\n        <code-editor content=\"ctrl.dashboardJson\" data-mode=\"json\" data-max-lines=15></code-editor>\r\n      </div>\r\n      <div class=\"gf-form-button-row\">\r\n        <button class=\"btn btn-primary\" clipboard-button=\"ctrl.getJsonForClipboard()\">\r\n          Copy JSON to Clipboard\r\n        </button>\r\n        <button class=\"btn btn-secondary\" clipboard-button=\"ctrl.save()\">\r\n          Save JSON to file\r\n        </button>\r\n        <a class=\"btn btn-link\" ng-click=\"ctrl.dismiss();\">Cancel</a>\r\n      </div>\r\n    </div>\r\n  </div>\r\n</div>\r\n`;\r\n\r\nexport class SaveProvisionedDashboardModalCtrl {\r\n  dash: any;\r\n  dashboardModel: DashboardModel;\r\n  dashboardJson: string;\r\n  dismiss: () => void;\r\n\r\n  /** @ngInject */\r\n  constructor(dashboardSrv: DashboardSrv) {\r\n    this.dashboardModel = dashboardSrv.getCurrent();\r\n    this.dash = this.dashboardModel.getSaveModelClone();\r\n    delete this.dash.id;\r\n    this.dashboardJson = angular.toJson(this.dash, true);\r\n  }\r\n\r\n  save() {\r\n    const blob = new Blob([angular.toJson(this.dash, true)], {\r\n      type: 'application/json;charset=utf-8',\r\n    });\r\n    saveAs(blob, this.dash.title + '-' + new Date().getTime() + '.json');\r\n  }\r\n\r\n  getJsonForClipboard() {\r\n    return this.dashboardJson;\r\n  }\r\n}\r\n\r\nexport function saveProvisionedDashboardModalDirective() {\r\n  return {\r\n    restrict: 'E',\r\n    template: template,\r\n    controller: SaveProvisionedDashboardModalCtrl,\r\n    bindToController: true,\r\n    controllerAs: 'ctrl',\r\n    scope: { dismiss: '&' },\r\n  };\r\n}\r\n\r\ncoreModule.directive('saveProvisionedDashboardModal', saveProvisionedDashboardModalDirective);\r\n","export { SaveDashboardAsModalCtrl } from './SaveDashboardAsModalCtrl';\r\nexport { SaveDashboardModalCtrl } from './SaveDashboardModalCtrl';\r\nexport { SaveProvisionedDashboardModalCtrl } from './SaveProvisionedDashboardModalCtrl';\r\n","import angular, { ILocationService } from 'angular';\r\nimport { dateTime } from '@grafana/data';\r\nimport { e2e } from '@grafana/e2e';\r\n\r\nimport config from 'app/core/config';\r\nimport { appendQueryToUrl, toUrlParams } from 'app/core/utils/url';\r\nimport { TimeSrv } from '../../services/TimeSrv';\r\nimport { TemplateSrv } from 'app/features/templating/template_srv';\r\nimport { LinkSrv } from 'app/features/panel/panellinks/link_srv';\r\nimport { GrafanaRootScope } from 'app/routes/GrafanaCtrl';\r\n\r\n/** @ngInject */\r\nexport function ShareModalCtrl(\r\n  $scope: any,\r\n  $rootScope: GrafanaRootScope,\r\n  $location: ILocationService,\r\n  $timeout: any,\r\n  timeSrv: TimeSrv,\r\n  templateSrv: TemplateSrv,\r\n  linkSrv: LinkSrv\r\n) {\r\n  $scope.options = {\r\n    forCurrent: true,\r\n    includeTemplateVars: true,\r\n    theme: 'current',\r\n  };\r\n  $scope.editor = { index: $scope.tabIndex || 0 };\r\n  $scope.selectors = e2e.pages.SharePanelModal.selectors;\r\n\r\n  $scope.init = () => {\r\n    $scope.panel = $scope.model && $scope.model.panel ? $scope.model.panel : $scope.panel; // React pass panel and dashboard in the \"model\" property\r\n    $scope.dashboard = $scope.model && $scope.model.dashboard ? $scope.model.dashboard : $scope.dashboard; // ^\r\n    $scope.modeSharePanel = $scope.panel ? true : false;\r\n\r\n    $scope.tabs = [{ title: 'Link', src: 'shareLink.html' }];\r\n\r\n    if ($scope.modeSharePanel) {\r\n      $scope.modalTitle = 'Share Panel';\r\n      $scope.tabs.push({ title: 'Embed', src: 'shareEmbed.html' });\r\n    } else {\r\n      $scope.modalTitle = 'Share';\r\n    }\r\n\r\n    if (!$scope.dashboard.meta.isSnapshot) {\r\n      $scope.tabs.push({ title: 'Snapshot', src: 'shareSnapshot.html' });\r\n    }\r\n\r\n    if (!$scope.dashboard.meta.isSnapshot && !$scope.modeSharePanel) {\r\n      $scope.tabs.push({ title: 'Export', src: 'shareExport.html' });\r\n    }\r\n\r\n    $scope.buildUrl();\r\n  };\r\n\r\n  $scope.buildUrl = () => {\r\n    let baseUrl = $location.absUrl();\r\n    const queryStart = baseUrl.indexOf('?');\r\n\r\n    if (queryStart !== -1) {\r\n      baseUrl = baseUrl.substring(0, queryStart);\r\n    }\r\n\r\n    const params = angular.copy($location.search());\r\n\r\n    const range = timeSrv.timeRange();\r\n    params.from = range.from.valueOf();\r\n    params.to = range.to.valueOf();\r\n    params.orgId = config.bootData.user.orgId;\r\n\r\n    if ($scope.options.includeTemplateVars) {\r\n      templateSrv.fillVariableValuesForUrl(params);\r\n    }\r\n\r\n    if (!$scope.options.forCurrent) {\r\n      delete params.from;\r\n      delete params.to;\r\n    }\r\n\r\n    if ($scope.options.theme !== 'current') {\r\n      params.theme = $scope.options.theme;\r\n    }\r\n\r\n    if ($scope.modeSharePanel) {\r\n      params.panelId = $scope.panel.id;\r\n      params.fullscreen = true;\r\n    } else {\r\n      delete params.panelId;\r\n      delete params.fullscreen;\r\n    }\r\n\r\n    $scope.shareUrl = appendQueryToUrl(baseUrl, toUrlParams(params));\r\n\r\n    let soloUrl = baseUrl.replace(config.appSubUrl + '/dashboard/', config.appSubUrl + '/dashboard-solo/');\r\n    soloUrl = soloUrl.replace(config.appSubUrl + '/d/', config.appSubUrl + '/d-solo/');\r\n    delete params.fullscreen;\r\n    delete params.edit;\r\n    soloUrl = appendQueryToUrl(soloUrl, toUrlParams(params));\r\n\r\n    $scope.iframeHtml = '<iframe src=\"' + soloUrl + '\" width=\"450\" height=\"200\" frameborder=\"0\"></iframe>';\r\n\r\n    $scope.imageUrl = soloUrl.replace(\r\n      config.appSubUrl + '/dashboard-solo/',\r\n      config.appSubUrl + '/render/dashboard-solo/'\r\n    );\r\n    $scope.imageUrl = $scope.imageUrl.replace(config.appSubUrl + '/d-solo/', config.appSubUrl + '/render/d-solo/');\r\n    $scope.imageUrl += '&width=1000&height=500' + $scope.getLocalTimeZone();\r\n  };\r\n\r\n  // This function will try to return the proper full name of the local timezone\r\n  // Chrome does not handle the timezone offset (but phantomjs does)\r\n  $scope.getLocalTimeZone = () => {\r\n    const utcOffset = '&tz=UTC' + encodeURIComponent(dateTime().format('Z'));\r\n\r\n    // Older browser does not the internationalization API\r\n    if (!(window as any).Intl) {\r\n      return utcOffset;\r\n    }\r\n\r\n    const dateFormat = (window as any).Intl.DateTimeFormat();\r\n    if (!dateFormat.resolvedOptions) {\r\n      return utcOffset;\r\n    }\r\n\r\n    const options = dateFormat.resolvedOptions();\r\n    if (!options.timeZone) {\r\n      return utcOffset;\r\n    }\r\n\r\n    return '&tz=' + encodeURIComponent(options.timeZone);\r\n  };\r\n\r\n  $scope.getShareUrl = () => {\r\n    return $scope.shareUrl;\r\n  };\r\n}\r\n\r\nangular.module('grafana.controllers').controller('ShareModalCtrl', ShareModalCtrl);\r\n","import angular, { ILocationService } from 'angular';\r\nimport _ from 'lodash';\r\nimport { BackendSrv } from 'app/core/services/backend_srv';\r\nimport { TimeSrv } from '../../services/TimeSrv';\r\nimport { DashboardModel } from '../../state/DashboardModel';\r\nimport { PanelModel } from '../../state/PanelModel';\r\nimport { GrafanaRootScope } from 'app/routes/GrafanaCtrl';\r\n\r\nexport class ShareSnapshotCtrl {\r\n  /** @ngInject */\r\n  constructor(\r\n    $scope: any,\r\n    $rootScope: GrafanaRootScope,\r\n    $location: ILocationService,\r\n    backendSrv: BackendSrv,\r\n    $timeout: any,\r\n    timeSrv: TimeSrv\r\n  ) {\r\n    $scope.snapshot = {\r\n      name: $scope.dashboard.title,\r\n      expires: 0,\r\n      timeoutSeconds: 4,\r\n    };\r\n\r\n    $scope.step = 1;\r\n\r\n    $scope.expireOptions = [\r\n      { text: '1 Hour', value: 60 * 60 },\r\n      { text: '1 Day', value: 60 * 60 * 24 },\r\n      { text: '7 Days', value: 60 * 60 * 24 * 7 },\r\n      { text: 'Never', value: 0 },\r\n    ];\r\n\r\n    $scope.accessOptions = [\r\n      { text: 'Anyone with the link', value: 1 },\r\n      { text: 'Organization users', value: 2 },\r\n      { text: 'Public on the web', value: 3 },\r\n    ];\r\n\r\n    $scope.init = () => {\r\n      backendSrv.get('/api/snapshot/shared-options').then((options: { [x: string]: any }) => {\r\n        $scope.sharingButtonText = options['externalSnapshotName'];\r\n        $scope.externalEnabled = options['externalEnabled'];\r\n      });\r\n    };\r\n\r\n    $scope.apiUrl = '/api/snapshots';\r\n\r\n    $scope.createSnapshot = (external: any) => {\r\n      $scope.dashboard.snapshot = {\r\n        timestamp: new Date(),\r\n      };\r\n\r\n      if (!external) {\r\n        $scope.dashboard.snapshot.originalUrl = $location.absUrl();\r\n      }\r\n\r\n      $scope.loading = true;\r\n      $scope.snapshot.external = external;\r\n      $scope.dashboard.startRefresh();\r\n\r\n      $timeout(() => {\r\n        $scope.saveSnapshot(external);\r\n      }, $scope.snapshot.timeoutSeconds * 1000);\r\n    };\r\n\r\n    $scope.saveSnapshot = (external: any) => {\r\n      const dash = $scope.dashboard.getSaveModelClone();\r\n      $scope.scrubDashboard(dash);\r\n\r\n      const cmdData = {\r\n        dashboard: dash,\r\n        name: dash.title,\r\n        expires: $scope.snapshot.expires,\r\n        external: external,\r\n      };\r\n\r\n      backendSrv.post($scope.apiUrl, cmdData).then(\r\n        (results: { deleteUrl: any; url: any }) => {\r\n          $scope.loading = false;\r\n          $scope.deleteUrl = results.deleteUrl;\r\n          $scope.snapshotUrl = results.url;\r\n          $scope.step = 2;\r\n        },\r\n        () => {\r\n          $scope.loading = false;\r\n        }\r\n      );\r\n    };\r\n\r\n    $scope.getSnapshotUrl = () => {\r\n      return $scope.snapshotUrl;\r\n    };\r\n\r\n    $scope.scrubDashboard = (dash: DashboardModel) => {\r\n      // change title\r\n      dash.title = $scope.snapshot.name;\r\n\r\n      // make relative times absolute\r\n      dash.time = timeSrv.timeRange();\r\n\r\n      // remove panel queries & links\r\n      _.each(dash.panels, panel => {\r\n        panel.targets = [];\r\n        panel.links = [];\r\n        panel.datasource = null;\r\n      });\r\n\r\n      // remove annotation queries\r\n      dash.annotations.list = _.chain(dash.annotations.list)\r\n        .filter(annotation => {\r\n          return annotation.enable;\r\n        })\r\n        .map((annotation: any) => {\r\n          return {\r\n            name: annotation.name,\r\n            enable: annotation.enable,\r\n            iconColor: annotation.iconColor,\r\n            snapshotData: annotation.snapshotData,\r\n            type: annotation.type,\r\n            builtIn: annotation.builtIn,\r\n            hide: annotation.hide,\r\n          };\r\n        })\r\n        .value();\r\n\r\n      // remove template queries\r\n      _.each(dash.templating.list, variable => {\r\n        variable.query = '';\r\n        variable.options = variable.current;\r\n        variable.refresh = false;\r\n      });\r\n\r\n      // snapshot single panel\r\n      if ($scope.modeSharePanel) {\r\n        const singlePanel = $scope.panel.getSaveModel();\r\n        singlePanel.gridPos.w = 24;\r\n        singlePanel.gridPos.x = 0;\r\n        singlePanel.gridPos.y = 0;\r\n        singlePanel.gridPos.h = 20;\r\n        dash.panels = [singlePanel];\r\n      }\r\n\r\n      // cleanup snapshotData\r\n      delete $scope.dashboard.snapshot;\r\n      $scope.dashboard.forEachPanel((panel: PanelModel) => {\r\n        delete panel.snapshotData;\r\n      });\r\n      _.each($scope.dashboard.annotations.list, annotation => {\r\n        delete annotation.snapshotData;\r\n      });\r\n    };\r\n\r\n    $scope.deleteSnapshot = () => {\r\n      backendSrv.get($scope.deleteUrl).then(() => {\r\n        $scope.step = 3;\r\n      });\r\n    };\r\n  }\r\n}\r\n\r\nangular.module('grafana.controllers').controller('ShareSnapshotCtrl', ShareSnapshotCtrl);\r\n","export { ShareModalCtrl } from './ShareModalCtrl';\r\nexport { ShareSnapshotCtrl } from './ShareSnapshotCtrl';\r\n","// Libaries\r\nimport React, { PureComponent } from 'react';\r\n\r\n// Utils & Services\r\nimport { AngularComponent, getAngularLoader } from '@grafana/runtime';\r\n\r\n// Types\r\nimport { DashboardModel } from '../../state/DashboardModel';\r\n\r\nexport interface Props {\r\n  dashboard: DashboardModel | null;\r\n}\r\n\r\nexport class SubMenu extends PureComponent<Props> {\r\n  element: HTMLElement;\r\n  angularCmp: AngularComponent;\r\n\r\n  componentDidMount() {\r\n    const loader = getAngularLoader();\r\n\r\n    const template = '<dashboard-submenu dashboard=\"dashboard\" />';\r\n    const scopeProps = { dashboard: this.props.dashboard };\r\n\r\n    this.angularCmp = loader.load(this.element, scopeProps, template);\r\n  }\r\n\r\n  componentWillUnmount() {\r\n    if (this.angularCmp) {\r\n      this.angularCmp.destroy();\r\n    }\r\n  }\r\n\r\n  render() {\r\n    return <div ref={element => (this.element = element)} />;\r\n  }\r\n}\r\n","import angular, { ILocationService } from 'angular';\r\nimport _ from 'lodash';\r\nimport { e2e } from '@grafana/e2e';\r\nimport { VariableSrv } from 'app/features/templating/all';\r\nimport { CoreEvents } from '../../../../types';\r\n\r\nexport class SubMenuCtrl {\r\n  annotations: any;\r\n  variables: any;\r\n  dashboard: any;\r\n  submenuEnabled: boolean;\r\n  selectors: typeof e2e.pages.Dashboard.SubMenu.selectors;\r\n\r\n  /** @ngInject */\r\n  constructor(private variableSrv: VariableSrv, private $location: ILocationService) {\r\n    this.annotations = this.dashboard.templating.list;\r\n    this.variables = this.variableSrv.variables;\r\n    this.submenuEnabled = this.dashboard.meta.submenuEnabled;\r\n    this.dashboard.events.on(CoreEvents.submenuVisibilityChanged, (enabled: boolean) => {\r\n      this.submenuEnabled = enabled;\r\n    });\r\n    this.selectors = e2e.pages.Dashboard.SubMenu.selectors;\r\n  }\r\n\r\n  annotationStateChanged() {\r\n    this.dashboard.startRefresh();\r\n  }\r\n\r\n  variableUpdated(variable: any) {\r\n    this.variableSrv.variableUpdated(variable, true);\r\n  }\r\n\r\n  openEditView(editview: any) {\r\n    const search = _.extend(this.$location.search(), { editview: editview });\r\n    this.$location.search(search);\r\n  }\r\n}\r\n\r\nexport function submenuDirective() {\r\n  return {\r\n    restrict: 'E',\r\n    templateUrl: 'public/app/features/dashboard/components/SubMenu/template.html',\r\n    controller: SubMenuCtrl,\r\n    bindToController: true,\r\n    controllerAs: 'ctrl',\r\n    scope: {\r\n      dashboard: '=',\r\n    },\r\n  };\r\n}\r\n\r\nangular.module('grafana.directives').directive('dashboardSubmenu', submenuDirective);\r\n","export { SubMenuCtrl } from './SubMenuCtrl';\r\nexport { SubMenu } from './SubMenu';\r\n","import coreModule from 'app/core/core_module';\r\n\r\nconst template = `\r\n<div class=\"modal-body\">\r\n  <div class=\"modal-header\">\r\n    <h2 class=\"modal-header-title\">\r\n      <i class=\"fa fa-exclamation\"></i>\r\n      <span class=\"p-l-1\">Unsaved changes</span>\r\n    </h2>\r\n\r\n    <a class=\"modal-header-close\" ng-click=\"ctrl.dismiss();\">\r\n      <i class=\"fa fa-remove\"></i>\r\n    </a>\r\n  </div>\r\n\r\n  <div class=\"modal-content text-center\">\r\n\r\n    <div class=\"confirm-modal-text\">\r\n      Do you want to save your changes?\r\n    </div>\r\n\r\n    <div class=\"confirm-modal-buttons\">\r\n      <button type=\"button\" class=\"btn btn-primary\" ng-click=\"ctrl.save()\">Save</button>\r\n      <button type=\"button\" class=\"btn btn-danger\" ng-click=\"ctrl.discard()\">Discard</button>\r\n      <button type=\"button\" class=\"btn btn-inverse\" ng-click=\"ctrl.dismiss()\">Cancel</button>\r\n    </div>\r\n  </div>\r\n</div>\r\n`;\r\n\r\nexport class UnsavedChangesModalCtrl {\r\n  clone: any;\r\n  dismiss: () => void;\r\n\r\n  /** @ngInject */\r\n  constructor(private unsavedChangesSrv: any) {}\r\n\r\n  discard() {\r\n    this.dismiss();\r\n    this.unsavedChangesSrv.tracker.discardChanges();\r\n  }\r\n\r\n  save() {\r\n    this.dismiss();\r\n    this.unsavedChangesSrv.tracker.saveChanges();\r\n  }\r\n}\r\n\r\nexport function unsavedChangesModalDirective() {\r\n  return {\r\n    restrict: 'E',\r\n    template: template,\r\n    controller: UnsavedChangesModalCtrl,\r\n    bindToController: true,\r\n    controllerAs: 'ctrl',\r\n    scope: { dismiss: '&' },\r\n  };\r\n}\r\n\r\ncoreModule.directive('unsavedChangesModal', unsavedChangesModalDirective);\r\n","export { UnsavedChangesModalCtrl } from './UnsavedChangesModalCtrl';\r\n","import _ from 'lodash';\r\nimport angular, { ILocationService } from 'angular';\r\n\r\nimport locationUtil from 'app/core/utils/location_util';\r\nimport { DashboardModel } from '../../state/DashboardModel';\r\nimport { HistoryListOpts, RevisionsModel, CalculateDiffOptions, HistorySrv } from './HistorySrv';\r\nimport { dateTime, toUtc, DateTimeInput, AppEvents } from '@grafana/data';\r\nimport { GrafanaRootScope } from 'app/routes/GrafanaCtrl';\r\nimport { CoreEvents } from 'app/types';\r\n\r\nexport class HistoryListCtrl {\r\n  appending: boolean;\r\n  dashboard: DashboardModel;\r\n  delta: { basic: string; json: string };\r\n  diff: string;\r\n  limit: number;\r\n  loading: boolean;\r\n  max: number;\r\n  mode: string;\r\n  revisions: RevisionsModel[];\r\n  start: number;\r\n  newInfo: RevisionsModel;\r\n  baseInfo: RevisionsModel;\r\n  canCompare: boolean;\r\n  isNewLatest: boolean;\r\n\r\n  /** @ngInject */\r\n  constructor(\r\n    private $route: any,\r\n    private $rootScope: GrafanaRootScope,\r\n    private $location: ILocationService,\r\n    private historySrv: HistorySrv,\r\n    public $scope: any\r\n  ) {\r\n    this.appending = false;\r\n    this.diff = 'basic';\r\n    this.limit = 10;\r\n    this.loading = false;\r\n    this.max = 2;\r\n    this.mode = 'list';\r\n    this.start = 0;\r\n    this.canCompare = false;\r\n\r\n    this.$rootScope.onAppEvent(CoreEvents.dashboardSaved, this.onDashboardSaved.bind(this), $scope);\r\n    this.resetFromSource();\r\n  }\r\n\r\n  onDashboardSaved() {\r\n    this.resetFromSource();\r\n  }\r\n\r\n  switchMode(mode: string) {\r\n    this.mode = mode;\r\n    if (this.mode === 'list') {\r\n      this.reset();\r\n    }\r\n  }\r\n\r\n  dismiss() {\r\n    this.$rootScope.appEvent(CoreEvents.hideDashEditor);\r\n  }\r\n\r\n  addToLog() {\r\n    this.start = this.start + this.limit;\r\n    this.getLog(true);\r\n  }\r\n\r\n  revisionSelectionChanged() {\r\n    const selected = _.filter(this.revisions, { checked: true }).length;\r\n    this.canCompare = selected === 2;\r\n  }\r\n\r\n  formatDate(date: DateTimeInput) {\r\n    return this.dashboard.formatDate(date);\r\n  }\r\n\r\n  formatBasicDate(date: DateTimeInput) {\r\n    const now = this.dashboard.timezone === 'browser' ? dateTime() : toUtc();\r\n    const then = this.dashboard.timezone === 'browser' ? dateTime(date) : toUtc(date);\r\n    return then.from(now);\r\n  }\r\n\r\n  getDiff(diff: 'basic' | 'json') {\r\n    this.diff = diff;\r\n    this.mode = 'compare';\r\n\r\n    // has it already been fetched?\r\n    if (this.delta[diff]) {\r\n      return Promise.resolve(this.delta[diff]);\r\n    }\r\n\r\n    const selected = _.filter(this.revisions, { checked: true });\r\n\r\n    this.newInfo = selected[0];\r\n    this.baseInfo = selected[1];\r\n    this.isNewLatest = this.newInfo.version === this.dashboard.version;\r\n\r\n    this.loading = true;\r\n    const options: CalculateDiffOptions = {\r\n      new: {\r\n        dashboardId: this.dashboard.id,\r\n        version: this.newInfo.version,\r\n      },\r\n      base: {\r\n        dashboardId: this.dashboard.id,\r\n        version: this.baseInfo.version,\r\n      },\r\n      diffType: diff,\r\n    };\r\n\r\n    return this.historySrv\r\n      .calculateDiff(options)\r\n      .then((response: any) => {\r\n        // @ts-ignore\r\n        this.delta[this.diff] = response;\r\n      })\r\n      .catch(() => {\r\n        this.mode = 'list';\r\n      })\r\n      .finally(() => {\r\n        this.loading = false;\r\n      });\r\n  }\r\n\r\n  getLog(append = false) {\r\n    this.loading = !append;\r\n    this.appending = append;\r\n    const options: HistoryListOpts = {\r\n      limit: this.limit,\r\n      start: this.start,\r\n    };\r\n\r\n    return this.historySrv\r\n      .getHistoryList(this.dashboard, options)\r\n      .then((revisions: any) => {\r\n        // set formatted dates & default values\r\n        for (const rev of revisions) {\r\n          rev.createdDateString = this.formatDate(rev.created);\r\n          rev.ageString = this.formatBasicDate(rev.created);\r\n          rev.checked = false;\r\n        }\r\n\r\n        this.revisions = append ? this.revisions.concat(revisions) : revisions;\r\n      })\r\n      .catch((err: any) => {\r\n        this.loading = false;\r\n      })\r\n      .finally(() => {\r\n        this.loading = false;\r\n        this.appending = false;\r\n      });\r\n  }\r\n\r\n  isLastPage() {\r\n    return _.find(this.revisions, rev => rev.version === 1);\r\n  }\r\n\r\n  reset() {\r\n    this.delta = { basic: '', json: '' };\r\n    this.diff = 'basic';\r\n    this.mode = 'list';\r\n    this.revisions = _.map(this.revisions, rev => _.extend({}, rev, { checked: false }));\r\n    this.canCompare = false;\r\n    this.start = 0;\r\n    this.isNewLatest = false;\r\n  }\r\n\r\n  resetFromSource() {\r\n    this.revisions = [];\r\n    return this.getLog().then(this.reset.bind(this));\r\n  }\r\n\r\n  restore(version: number) {\r\n    this.$rootScope.appEvent(CoreEvents.showConfirmModal, {\r\n      title: 'Restore version',\r\n      text: '',\r\n      text2: `Are you sure you want to restore the dashboard to version ${version}? All unsaved changes will be lost.`,\r\n      icon: 'fa-history',\r\n      yesText: `Yes, restore to version ${version}`,\r\n      onConfirm: this.restoreConfirm.bind(this, version),\r\n    });\r\n  }\r\n\r\n  restoreConfirm(version: number) {\r\n    this.loading = true;\r\n    return this.historySrv\r\n      .restoreDashboard(this.dashboard, version)\r\n      .then((response: any) => {\r\n        this.$location.url(locationUtil.stripBaseFromUrl(response.url)).replace();\r\n        this.$route.reload();\r\n        this.$rootScope.appEvent(AppEvents.alertSuccess, ['Dashboard restored', 'Restored from version ' + version]);\r\n      })\r\n      .catch(() => {\r\n        this.mode = 'list';\r\n        this.loading = false;\r\n      });\r\n  }\r\n}\r\n\r\nexport function dashboardHistoryDirective() {\r\n  return {\r\n    restrict: 'E',\r\n    templateUrl: 'public/app/features/dashboard/components/VersionHistory/template.html',\r\n    controller: HistoryListCtrl,\r\n    bindToController: true,\r\n    controllerAs: 'ctrl',\r\n    scope: {\r\n      dashboard: '=',\r\n    },\r\n  };\r\n}\r\n\r\nangular.module('grafana.directives').directive('gfDashboardHistory', dashboardHistoryDirective);\r\n","import _ from 'lodash';\r\nimport coreModule from 'app/core/core_module';\r\nimport { DashboardModel } from '../../state/DashboardModel';\r\nimport { BackendSrv } from 'app/core/services/backend_srv';\r\n\r\nexport interface HistoryListOpts {\r\n  limit: number;\r\n  start: number;\r\n}\r\n\r\nexport interface RevisionsModel {\r\n  id: number;\r\n  checked: boolean;\r\n  dashboardId: number;\r\n  parentVersion: number;\r\n  version: number;\r\n  created: Date;\r\n  createdBy: string;\r\n  message: string;\r\n}\r\n\r\nexport interface CalculateDiffOptions {\r\n  new: DiffTarget;\r\n  base: DiffTarget;\r\n  diffType: string;\r\n}\r\n\r\nexport interface DiffTarget {\r\n  dashboardId: number;\r\n  version: number;\r\n  unsavedDashboard?: DashboardModel; // when doing diffs against unsaved dashboard version\r\n}\r\n\r\nexport class HistorySrv {\r\n  /** @ngInject */\r\n  constructor(private backendSrv: BackendSrv) {}\r\n\r\n  getHistoryList(dashboard: DashboardModel, options: HistoryListOpts) {\r\n    const id = dashboard && dashboard.id ? dashboard.id : void 0;\r\n    return id ? this.backendSrv.get(`api/dashboards/id/${id}/versions`, options) : Promise.resolve([]);\r\n  }\r\n\r\n  calculateDiff(options: CalculateDiffOptions) {\r\n    return this.backendSrv.post('api/dashboards/calculate-diff', options);\r\n  }\r\n\r\n  restoreDashboard(dashboard: DashboardModel, version: number) {\r\n    const id = dashboard && dashboard.id ? dashboard.id : void 0;\r\n    const url = `api/dashboards/id/${id}/restore`;\r\n\r\n    return id && _.isNumber(version) ? this.backendSrv.post(url, { version }) : Promise.resolve({});\r\n  }\r\n}\r\n\r\ncoreModule.service('historySrv', HistorySrv);\r\n","export { HistoryListCtrl } from './HistoryListCtrl';\r\nexport { HistorySrv } from './HistorySrv';\r\n","// Libraries\r\nimport _ from 'lodash';\r\nimport React, { PureComponent, ReactNode } from 'react';\r\n\r\n// Types\r\nimport { AppNotificationSeverity } from 'app/types';\r\nimport { Alert } from '@grafana/ui';\r\nimport { PanelProps, PanelPlugin, PluginType, PanelPluginMeta } from '@grafana/data';\r\n\r\ninterface Props {\r\n  title: string;\r\n  text?: ReactNode;\r\n}\r\n\r\nclass PanelPluginError extends PureComponent<Props> {\r\n  constructor(props: Props) {\r\n    super(props);\r\n  }\r\n\r\n  render() {\r\n    const style = {\r\n      display: 'flex',\r\n      alignItems: 'center',\r\n      justifyContent: 'center',\r\n      height: '100%',\r\n    };\r\n\r\n    return (\r\n      <div style={style}>\r\n        <Alert severity={AppNotificationSeverity.Error} {...this.props} />\r\n      </div>\r\n    );\r\n  }\r\n}\r\n\r\nexport function getPanelPluginLoadError(meta: PanelPluginMeta, err: any): PanelPlugin {\r\n  const LoadError = class LoadError extends PureComponent<PanelProps> {\r\n    render() {\r\n      const text = (\r\n        <>\r\n          Check the server startup logs for more information. <br />\r\n          If this plugin was loaded from git, make sure it was compiled.\r\n        </>\r\n      );\r\n      return <PanelPluginError title={`Error loading: ${meta.id}`} text={text} />;\r\n    }\r\n  };\r\n  const plugin = new PanelPlugin(LoadError);\r\n  plugin.meta = meta;\r\n  plugin.loadError = true;\r\n  return plugin;\r\n}\r\n\r\nexport function getPanelPluginNotFound(id: string): PanelPlugin {\r\n  const NotFound = class NotFound extends PureComponent<PanelProps> {\r\n    render() {\r\n      return <PanelPluginError title={`Panel plugin not found: ${id}`} />;\r\n    }\r\n  };\r\n\r\n  const plugin = new PanelPlugin(NotFound);\r\n  plugin.meta = {\r\n    id: id,\r\n    name: id,\r\n    sort: 100,\r\n    type: PluginType.panel,\r\n    module: '',\r\n    baseUrl: '',\r\n    info: {\r\n      author: {\r\n        name: '',\r\n      },\r\n      description: '',\r\n      links: [],\r\n      logos: {\r\n        large: '',\r\n        small: '',\r\n      },\r\n      screenshots: [],\r\n      updated: '',\r\n      version: '',\r\n    },\r\n  };\r\n  return plugin;\r\n}\r\n","// Services\r\nimport './services/UnsavedChangesSrv';\r\nimport './services/DashboardLoaderSrv';\r\nimport './services/DashboardSrv';\r\n\r\n// Components\r\nimport './components/DashLinks';\r\nimport './components/DashExportModal';\r\nimport './components/DashNav';\r\nimport './components/ExportDataModal';\r\nimport './components/FolderPicker';\r\nimport './components/VersionHistory';\r\nimport './components/DashboardSettings';\r\nimport './components/SubMenu';\r\nimport './components/UnsavedChangesModal';\r\nimport './components/SaveModals';\r\nimport './components/ShareModal';\r\nimport './components/AdHocFilters';\r\nimport './components/RowOptions';\r\n\r\nimport DashboardPermissions from './components/DashboardPermissions/DashboardPermissions';\r\n\r\n// angular wrappers\r\nimport { react2AngularDirective } from 'app/core/utils/react2angular';\r\n\r\nreact2AngularDirective('dashboardPermissions', DashboardPermissions, ['dashboardId', 'folder']);\r\n","// Libraries\r\nimport React, { PureComponent } from 'react';\r\nimport classNames from 'classnames';\r\nimport _ from 'lodash';\r\n// Utils & Services\r\nimport { getDatasourceSrv } from 'app/features/plugins/datasource_srv';\r\nimport { AngularComponent, getAngularLoader } from '@grafana/runtime';\r\nimport { Emitter } from 'app/core/utils/emitter';\r\nimport { getTimeSrv } from 'app/features/dashboard/services/TimeSrv';\r\n// Types\r\nimport { PanelModel } from '../state/PanelModel';\r\nimport { ErrorBoundaryAlert } from '@grafana/ui';\r\nimport {\r\n  DataQuery,\r\n  DataSourceApi,\r\n  PanelData,\r\n  PanelEvents,\r\n  TimeRange,\r\n  LoadingState,\r\n  toLegacyResponseData,\r\n} from '@grafana/data';\r\nimport { DashboardModel } from '../state/DashboardModel';\r\n\r\ninterface Props {\r\n  panel: PanelModel;\r\n  data: PanelData;\r\n  query: DataQuery;\r\n  dashboard: DashboardModel;\r\n  onAddQuery: (query?: DataQuery) => void;\r\n  onRemoveQuery: (query: DataQuery) => void;\r\n  onMoveQuery: (query: DataQuery, direction: number) => void;\r\n  onChange: (query: DataQuery) => void;\r\n  dataSourceValue: string | null;\r\n  inMixedMode: boolean;\r\n}\r\n\r\ninterface State {\r\n  loadedDataSourceValue: string | null | undefined;\r\n  datasource: DataSourceApi | null;\r\n  isCollapsed: boolean;\r\n  hasTextEditMode: boolean;\r\n  data?: PanelData;\r\n}\r\n\r\nexport class QueryEditorRow extends PureComponent<Props, State> {\r\n  element: HTMLElement | null = null;\r\n  angularScope: AngularQueryComponentScope | null;\r\n  angularQueryEditor: AngularComponent | null = null;\r\n\r\n  state: State = {\r\n    datasource: null,\r\n    isCollapsed: false,\r\n    loadedDataSourceValue: undefined,\r\n    hasTextEditMode: false,\r\n    data: null,\r\n  };\r\n\r\n  componentDidMount() {\r\n    this.loadDatasource();\r\n  }\r\n\r\n  componentWillUnmount() {\r\n    if (this.angularQueryEditor) {\r\n      this.angularQueryEditor.destroy();\r\n    }\r\n  }\r\n\r\n  getAngularQueryComponentScope(): AngularQueryComponentScope {\r\n    const { panel, query, dashboard } = this.props;\r\n    const { datasource } = this.state;\r\n\r\n    return {\r\n      datasource: datasource,\r\n      target: query,\r\n      panel: panel,\r\n      dashboard: dashboard,\r\n      refresh: () => panel.refresh(),\r\n      render: () => panel.render(),\r\n      events: panel.events,\r\n      range: getTimeSrv().timeRange(),\r\n    };\r\n  }\r\n\r\n  async loadDatasource() {\r\n    const { query, panel } = this.props;\r\n    const dataSourceSrv = getDatasourceSrv();\r\n    const datasource = await dataSourceSrv.get(query.datasource || panel.datasource);\r\n\r\n    this.setState({\r\n      datasource,\r\n      loadedDataSourceValue: this.props.dataSourceValue,\r\n      hasTextEditMode: _.has(datasource, 'components.QueryCtrl.prototype.toggleEditorMode'),\r\n    });\r\n  }\r\n\r\n  componentDidUpdate(prevProps: Props) {\r\n    const { loadedDataSourceValue } = this.state;\r\n    const { data, query, panel } = this.props;\r\n\r\n    if (data !== prevProps.data) {\r\n      this.setState({ data: filterPanelDataToQuery(data, query.refId) });\r\n\r\n      if (this.angularScope) {\r\n        this.angularScope.range = getTimeSrv().timeRange();\r\n      }\r\n\r\n      if (this.angularQueryEditor) {\r\n        notifyAngularQueryEditorsOfData(panel, data, this.angularQueryEditor);\r\n      }\r\n    }\r\n\r\n    // check if we need to load another datasource\r\n    if (loadedDataSourceValue !== this.props.dataSourceValue) {\r\n      if (this.angularQueryEditor) {\r\n        this.angularQueryEditor.destroy();\r\n        this.angularQueryEditor = null;\r\n      }\r\n      this.loadDatasource();\r\n      return;\r\n    }\r\n\r\n    if (!this.element || this.angularQueryEditor) {\r\n      return;\r\n    }\r\n\r\n    const loader = getAngularLoader();\r\n    const template = '<plugin-component type=\"query-ctrl\" />';\r\n    const scopeProps = { ctrl: this.getAngularQueryComponentScope() };\r\n    this.angularQueryEditor = loader.load(this.element, scopeProps, template);\r\n    this.angularScope = scopeProps.ctrl;\r\n  }\r\n\r\n  onToggleCollapse = () => {\r\n    this.setState({ isCollapsed: !this.state.isCollapsed });\r\n  };\r\n\r\n  onRunQuery = () => {\r\n    this.props.panel.refresh();\r\n  };\r\n\r\n  renderPluginEditor() {\r\n    const { query, onChange } = this.props;\r\n    const { datasource, data } = this.state;\r\n\r\n    if (datasource.components.QueryCtrl) {\r\n      return <div ref={element => (this.element = element)} />;\r\n    }\r\n\r\n    if (datasource.components.QueryEditor) {\r\n      const QueryEditor = datasource.components.QueryEditor;\r\n\r\n      return (\r\n        <QueryEditor\r\n          query={query}\r\n          datasource={datasource}\r\n          onChange={onChange}\r\n          onRunQuery={this.onRunQuery}\r\n          data={data}\r\n        />\r\n      );\r\n    }\r\n\r\n    return <div>Data source plugin does not export any Query Editor component</div>;\r\n  }\r\n\r\n  onToggleEditMode = () => {\r\n    if (this.angularScope && this.angularScope.toggleEditorMode) {\r\n      this.angularScope.toggleEditorMode();\r\n      this.angularQueryEditor.digest();\r\n    }\r\n\r\n    if (this.state.isCollapsed) {\r\n      this.setState({ isCollapsed: false });\r\n    }\r\n  };\r\n\r\n  onRemoveQuery = () => {\r\n    this.props.onRemoveQuery(this.props.query);\r\n  };\r\n\r\n  onCopyQuery = () => {\r\n    const copy = _.cloneDeep(this.props.query);\r\n    this.props.onAddQuery(copy);\r\n  };\r\n\r\n  onDisableQuery = () => {\r\n    this.props.query.hide = !this.props.query.hide;\r\n    this.onRunQuery();\r\n    this.forceUpdate();\r\n  };\r\n\r\n  renderCollapsedText(): string | null {\r\n    const { datasource } = this.state;\r\n    if (datasource.getQueryDisplayText) {\r\n      return datasource.getQueryDisplayText(this.props.query);\r\n    }\r\n\r\n    if (this.angularScope && this.angularScope.getCollapsedText) {\r\n      return this.angularScope.getCollapsedText();\r\n    }\r\n    return null;\r\n  }\r\n\r\n  render() {\r\n    const { query, inMixedMode } = this.props;\r\n    const { datasource, isCollapsed, hasTextEditMode } = this.state;\r\n    const isDisabled = query.hide;\r\n\r\n    const bodyClasses = classNames('query-editor-row__body gf-form-query', {\r\n      'query-editor-row__body--collapsed': isCollapsed,\r\n    });\r\n\r\n    const rowClasses = classNames('query-editor-row', {\r\n      'query-editor-row--disabled': isDisabled,\r\n      'gf-form-disabled': isDisabled,\r\n    });\r\n\r\n    if (!datasource) {\r\n      return null;\r\n    }\r\n\r\n    return (\r\n      <div className={rowClasses}>\r\n        <div className=\"query-editor-row__header\">\r\n          <div className=\"query-editor-row__ref-id\" onClick={this.onToggleCollapse}>\r\n            {isCollapsed && <i className=\"fa fa-caret-right\" />}\r\n            {!isCollapsed && <i className=\"fa fa-caret-down\" />}\r\n            <span>{query.refId}</span>\r\n            {inMixedMode && <em className=\"query-editor-row__context-info\"> ({datasource.name})</em>}\r\n            {isDisabled && <em className=\"query-editor-row__context-info\"> Disabled</em>}\r\n          </div>\r\n          <div className=\"query-editor-row__collapsed-text\" onClick={this.onToggleEditMode}>\r\n            {isCollapsed && <div>{this.renderCollapsedText()}</div>}\r\n          </div>\r\n          <div className=\"query-editor-row__actions\">\r\n            {hasTextEditMode && (\r\n              <button\r\n                className=\"query-editor-row__action\"\r\n                onClick={this.onToggleEditMode}\r\n                title=\"Toggle text edit mode\"\r\n              >\r\n                <i className=\"fa fa-fw fa-pencil\" />\r\n              </button>\r\n            )}\r\n            <button className=\"query-editor-row__action\" onClick={() => this.props.onMoveQuery(query, 1)}>\r\n              <i className=\"fa fa-fw fa-arrow-down\" />\r\n            </button>\r\n            <button className=\"query-editor-row__action\" onClick={() => this.props.onMoveQuery(query, -1)}>\r\n              <i className=\"fa fa-fw fa-arrow-up\" />\r\n            </button>\r\n            <button className=\"query-editor-row__action\" onClick={this.onCopyQuery} title=\"Duplicate query\">\r\n              <i className=\"fa fa-fw fa-copy\" />\r\n            </button>\r\n            <button className=\"query-editor-row__action\" onClick={this.onDisableQuery} title=\"Disable/enable query\">\r\n              {isDisabled && <i className=\"fa fa-fw fa-eye-slash\" />}\r\n              {!isDisabled && <i className=\"fa fa-fw fa-eye\" />}\r\n            </button>\r\n            <button className=\"query-editor-row__action\" onClick={this.onRemoveQuery} title=\"Remove query\">\r\n              <i className=\"fa fa-fw fa-trash\" />\r\n            </button>\r\n          </div>\r\n        </div>\r\n        <div className={bodyClasses}>\r\n          <ErrorBoundaryAlert>{this.renderPluginEditor()}</ErrorBoundaryAlert>\r\n        </div>\r\n      </div>\r\n    );\r\n  }\r\n}\r\n\r\n// To avoid sending duplicate events for each row we have this global cached object here\r\n// So we can check if we already emitted this legacy data event\r\nlet globalLastPanelDataCache: PanelData = null;\r\n\r\nfunction notifyAngularQueryEditorsOfData(panel: PanelModel, data: PanelData, editor: AngularComponent) {\r\n  if (data === globalLastPanelDataCache) {\r\n    return;\r\n  }\r\n\r\n  globalLastPanelDataCache = data;\r\n\r\n  if (data.state === LoadingState.Done) {\r\n    const legacy = data.series.map(v => toLegacyResponseData(v));\r\n    panel.events.emit(PanelEvents.dataReceived, legacy);\r\n  } else if (data.state === LoadingState.Error) {\r\n    panel.events.emit(PanelEvents.dataError, data.error);\r\n  }\r\n\r\n  // Some query controllers listen to data error events and need a digest\r\n  // for some reason this needs to be done in next tick\r\n  setTimeout(editor.digest);\r\n}\r\n\r\nexport interface AngularQueryComponentScope {\r\n  target: DataQuery;\r\n  panel: PanelModel;\r\n  dashboard: DashboardModel;\r\n  events: Emitter;\r\n  refresh: () => void;\r\n  render: () => void;\r\n  datasource: DataSourceApi;\r\n  toggleEditorMode?: () => void;\r\n  getCollapsedText?: () => string;\r\n  range: TimeRange;\r\n}\r\n\r\n/**\r\n * Get a version of the PanelData limited to the query we are looking at\r\n */\r\nexport function filterPanelDataToQuery(data: PanelData, refId: string): PanelData | undefined {\r\n  const series = data.series.filter(series => series.refId === refId);\r\n\r\n  // No matching series\r\n  if (!series.length) {\r\n    return undefined;\r\n  }\r\n\r\n  // Only say this is an error if the error links to the query\r\n  let state = LoadingState.Done;\r\n  const error = data.error && data.error.refId === refId ? data.error : undefined;\r\n  if (error) {\r\n    state = LoadingState.Error;\r\n  }\r\n\r\n  const timeRange = data.timeRange;\r\n\r\n  return {\r\n    ...data,\r\n    state,\r\n    series,\r\n    error,\r\n    timeRange,\r\n  };\r\n}\r\n","import { createSlice, PayloadAction } from '@reduxjs/toolkit';\r\n\r\nexport interface PanelEditorInitCompleted {\r\n  activeTab: PanelEditorTabIds;\r\n  tabs: PanelEditorTab[];\r\n}\r\n\r\nexport interface PanelEditorTab {\r\n  id: string;\r\n  text: string;\r\n}\r\n\r\nexport enum PanelEditorTabIds {\r\n  Queries = 'queries',\r\n  Visualization = 'visualization',\r\n  Advanced = 'advanced',\r\n  Alert = 'alert',\r\n}\r\n\r\nexport const panelEditorTabTexts = {\r\n  [PanelEditorTabIds.Queries]: 'Queries',\r\n  [PanelEditorTabIds.Visualization]: 'Visualization',\r\n  [PanelEditorTabIds.Advanced]: 'General',\r\n  [PanelEditorTabIds.Alert]: 'Alert',\r\n};\r\n\r\nexport const getPanelEditorTab = (tabId: PanelEditorTabIds): PanelEditorTab => {\r\n  return {\r\n    id: tabId,\r\n    text: panelEditorTabTexts[tabId],\r\n  };\r\n};\r\n\r\nexport interface PanelEditorState {\r\n  activeTab: PanelEditorTabIds;\r\n  tabs: PanelEditorTab[];\r\n}\r\n\r\nexport const initialState: PanelEditorState = {\r\n  activeTab: null,\r\n  tabs: [],\r\n};\r\n\r\nconst panelEditorSlice = createSlice({\r\n  name: 'panelEditor',\r\n  initialState,\r\n  reducers: {\r\n    panelEditorInitCompleted: (state, action: PayloadAction<PanelEditorInitCompleted>): PanelEditorState => {\r\n      const { activeTab, tabs } = action.payload;\r\n      return {\r\n        ...state,\r\n        activeTab,\r\n        tabs,\r\n      };\r\n    },\r\n    panelEditorCleanUp: (state, action: PayloadAction<undefined>): PanelEditorState => initialState,\r\n  },\r\n});\r\n\r\nexport const { panelEditorCleanUp, panelEditorInitCompleted } = panelEditorSlice.actions;\r\n\r\nexport const panelEditorReducer = panelEditorSlice.reducer;\r\n","import angular, { ILocationService, IRootScopeService } from 'angular';\r\nimport _ from 'lodash';\r\nimport { DashboardModel } from '../state/DashboardModel';\r\nimport { ContextSrv } from 'app/core/services/context_srv';\r\nimport { GrafanaRootScope } from 'app/routes/GrafanaCtrl';\r\nimport { CoreEvents, AppEventConsumer } from 'app/types';\r\n\r\nexport class ChangeTracker {\r\n  current: any;\r\n  originalPath: any;\r\n  scope: any;\r\n  original: any;\r\n  next: any;\r\n  $window: any;\r\n\r\n  /** @ngInject */\r\n  constructor(\r\n    dashboard: DashboardModel,\r\n    scope: IRootScopeService & AppEventConsumer,\r\n    originalCopyDelay: any,\r\n    private $location: ILocationService,\r\n    $window: any,\r\n    private $timeout: any,\r\n    private contextSrv: ContextSrv,\r\n    private $rootScope: GrafanaRootScope\r\n  ) {\r\n    this.$location = $location;\r\n    this.$window = $window;\r\n\r\n    this.current = dashboard;\r\n    this.originalPath = $location.path();\r\n    this.scope = scope;\r\n\r\n    // register events\r\n    scope.onAppEvent(CoreEvents.dashboardSaved, () => {\r\n      this.original = this.current.getSaveModelClone();\r\n      this.originalPath = $location.path();\r\n    });\r\n\r\n    $window.onbeforeunload = () => {\r\n      if (this.ignoreChanges()) {\r\n        return undefined;\r\n      }\r\n      if (this.hasChanges()) {\r\n        return 'There are unsaved changes to this dashboard';\r\n      }\r\n      return undefined;\r\n    };\r\n\r\n    scope.$on('$locationChangeStart', (event: any, next: any) => {\r\n      // check if we should look for changes\r\n      if (this.originalPath === $location.path()) {\r\n        return true;\r\n      }\r\n      if (this.ignoreChanges()) {\r\n        return true;\r\n      }\r\n\r\n      if (this.hasChanges()) {\r\n        event.preventDefault();\r\n        this.next = next;\r\n\r\n        this.$timeout(() => {\r\n          this.open_modal();\r\n        });\r\n      }\r\n      return false;\r\n    });\r\n\r\n    if (originalCopyDelay && !dashboard.meta.fromExplore) {\r\n      this.$timeout(() => {\r\n        // wait for different services to patch the dashboard (missing properties)\r\n        this.original = dashboard.getSaveModelClone();\r\n      }, originalCopyDelay);\r\n    } else {\r\n      this.original = dashboard.getSaveModelClone();\r\n    }\r\n  }\r\n\r\n  // for some dashboards and users\r\n  // changes should be ignored\r\n  ignoreChanges() {\r\n    if (!this.original) {\r\n      return true;\r\n    }\r\n    if (!this.contextSrv.isEditor) {\r\n      return true;\r\n    }\r\n    if (!this.current || !this.current.meta) {\r\n      return true;\r\n    }\r\n\r\n    const meta = this.current.meta;\r\n    return !meta.canSave || meta.fromScript || meta.fromFile;\r\n  }\r\n\r\n  // remove stuff that should not count in diff\r\n  cleanDashboardFromIgnoredChanges(dashData: any) {\r\n    // need to new up the domain model class to get access to expand / collapse row logic\r\n    const model = new DashboardModel(dashData);\r\n\r\n    // Expand all rows before making comparison. This is required because row expand / collapse\r\n    // change order of panel array and panel positions.\r\n    model.expandRows();\r\n\r\n    const dash = model.getSaveModelClone();\r\n\r\n    // ignore time and refresh\r\n    dash.time = 0;\r\n    dash.refresh = 0;\r\n    dash.schemaVersion = 0;\r\n\r\n    // ignore iteration property\r\n    delete dash.iteration;\r\n\r\n    dash.panels = _.filter(dash.panels, panel => {\r\n      if (panel.repeatPanelId) {\r\n        return false;\r\n      }\r\n\r\n      // remove scopedVars\r\n      panel.scopedVars = null;\r\n\r\n      // ignore panel legend sort\r\n      if (panel.legend) {\r\n        delete panel.legend.sort;\r\n        delete panel.legend.sortDesc;\r\n      }\r\n\r\n      return true;\r\n    });\r\n\r\n    // ignore template variable values\r\n    _.each(dash.templating.list, value => {\r\n      value.current = null;\r\n      value.options = null;\r\n      value.filters = null;\r\n    });\r\n\r\n    return dash;\r\n  }\r\n\r\n  hasChanges() {\r\n    const current = this.cleanDashboardFromIgnoredChanges(this.current.getSaveModelClone());\r\n    const original = this.cleanDashboardFromIgnoredChanges(this.original);\r\n\r\n    const currentTimepicker: any = _.find(current.nav, { type: 'timepicker' });\r\n    const originalTimepicker: any = _.find(original.nav, { type: 'timepicker' });\r\n\r\n    if (currentTimepicker && originalTimepicker) {\r\n      currentTimepicker.now = originalTimepicker.now;\r\n    }\r\n\r\n    const currentJson = angular.toJson(current, true);\r\n    const originalJson = angular.toJson(original, true);\r\n\r\n    return currentJson !== originalJson;\r\n  }\r\n\r\n  discardChanges() {\r\n    this.original = null;\r\n    this.gotoNext();\r\n  }\r\n\r\n  open_modal() {\r\n    this.$rootScope.appEvent(CoreEvents.showModal, {\r\n      templateHtml: '<unsaved-changes-modal dismiss=\"dismiss()\"></unsaved-changes-modal>',\r\n      modalClass: 'modal--narrow confirm-modal',\r\n    });\r\n  }\r\n\r\n  saveChanges() {\r\n    const self = this;\r\n    const cancel = this.$rootScope.$on('dashboard-saved', () => {\r\n      cancel();\r\n      this.$timeout(() => {\r\n        self.gotoNext();\r\n      });\r\n    });\r\n\r\n    this.$rootScope.appEvent(CoreEvents.saveDashboard);\r\n  }\r\n\r\n  gotoNext() {\r\n    const baseLen = this.$location.absUrl().length - this.$location.url().length;\r\n    const nextUrl = this.next.substring(baseLen);\r\n    this.$location.url(nextUrl);\r\n  }\r\n}\r\n","/* tslint:disable:import-blacklist */\r\nimport angular from 'angular';\r\nimport moment from 'moment';\r\nimport _ from 'lodash';\r\nimport $ from 'jquery';\r\nimport kbn from 'app/core/utils/kbn';\r\nimport { dateMath, AppEvents } from '@grafana/data';\r\nimport impressionSrv from 'app/core/services/impression_srv';\r\nimport { BackendSrv } from 'app/core/services/backend_srv';\r\nimport { DashboardSrv } from './DashboardSrv';\r\nimport DatasourceSrv from 'app/features/plugins/datasource_srv';\r\nimport { UrlQueryValue } from '@grafana/runtime';\r\nimport { GrafanaRootScope } from 'app/routes/GrafanaCtrl';\r\n\r\nexport class DashboardLoaderSrv {\r\n  /** @ngInject */\r\n  constructor(\r\n    private backendSrv: BackendSrv,\r\n    private dashboardSrv: DashboardSrv,\r\n    private datasourceSrv: DatasourceSrv,\r\n    private $http: any,\r\n    private $timeout: any,\r\n    contextSrv: any,\r\n    private $routeParams: any,\r\n    private $rootScope: GrafanaRootScope\r\n  ) {}\r\n\r\n  _dashboardLoadFailed(title: string, snapshot?: boolean) {\r\n    snapshot = snapshot || false;\r\n    return {\r\n      meta: {\r\n        canStar: false,\r\n        isSnapshot: snapshot,\r\n        canDelete: false,\r\n        canSave: false,\r\n        canEdit: false,\r\n        dashboardNotFound: true,\r\n      },\r\n      dashboard: { title },\r\n    };\r\n  }\r\n\r\n  loadDashboard(type: UrlQueryValue, slug: any, uid: any) {\r\n    let promise;\r\n\r\n    if (type === 'script') {\r\n      promise = this._loadScriptedDashboard(slug);\r\n    } else if (type === 'snapshot') {\r\n      promise = this.backendSrv.get('/api/snapshots/' + slug).catch(() => {\r\n        return this._dashboardLoadFailed('Snapshot not found', true);\r\n      });\r\n    } else {\r\n      promise = this.backendSrv\r\n        .getDashboardByUid(uid)\r\n        .then((result: any) => {\r\n          if (result.meta.isFolder) {\r\n            this.$rootScope.appEvent(AppEvents.alertError, ['Dashboard not found']);\r\n            throw new Error('Dashboard not found');\r\n          }\r\n          return result;\r\n        })\r\n        .catch(() => {\r\n          return this._dashboardLoadFailed('Not found', true);\r\n        });\r\n    }\r\n\r\n    promise.then((result: any) => {\r\n      if (result.meta.dashboardNotFound !== true) {\r\n        impressionSrv.addDashboardImpression(result.dashboard.id);\r\n      }\r\n\r\n      return result;\r\n    });\r\n\r\n    return promise;\r\n  }\r\n\r\n  _loadScriptedDashboard(file: string) {\r\n    const url = 'public/dashboards/' + file.replace(/\\.(?!js)/, '/') + '?' + new Date().getTime();\r\n\r\n    return this.$http({ url: url, method: 'GET' })\r\n      .then(this._executeScript.bind(this))\r\n      .then(\r\n        (result: any) => {\r\n          return {\r\n            meta: {\r\n              fromScript: true,\r\n              canDelete: false,\r\n              canSave: false,\r\n              canStar: false,\r\n            },\r\n            dashboard: result.data,\r\n          };\r\n        },\r\n        (err: any) => {\r\n          console.log('Script dashboard error ' + err);\r\n          this.$rootScope.appEvent(AppEvents.alertError, [\r\n            'Script Error',\r\n            'Please make sure it exists and returns a valid dashboard',\r\n          ]);\r\n          return this._dashboardLoadFailed('Scripted dashboard');\r\n        }\r\n      );\r\n  }\r\n\r\n  _executeScript(result: any) {\r\n    const services = {\r\n      dashboardSrv: this.dashboardSrv,\r\n      datasourceSrv: this.datasourceSrv,\r\n    };\r\n\r\n    /*jshint -W054 */\r\n    const scriptFunc = new Function(\r\n      'ARGS',\r\n      'kbn',\r\n      'dateMath',\r\n      '_',\r\n      'moment',\r\n      'window',\r\n      'document',\r\n      '$',\r\n      'jQuery',\r\n      'services',\r\n      result.data\r\n    );\r\n    const scriptResult = scriptFunc(this.$routeParams, kbn, dateMath, _, moment, window, document, $, $, services);\r\n\r\n    // Handle async dashboard scripts\r\n    if (_.isFunction(scriptResult)) {\r\n      return new Promise(resolve => {\r\n        scriptResult((dashboard: any) => {\r\n          this.$timeout(() => {\r\n            resolve({ data: dashboard });\r\n          });\r\n        });\r\n      });\r\n    }\r\n\r\n    return { data: scriptResult };\r\n  }\r\n}\r\n\r\nangular.module('grafana.services').service('dashboardLoaderSrv', DashboardLoaderSrv);\r\n","import coreModule from 'app/core/core_module';\r\nimport { appEvents } from 'app/core/app_events';\r\nimport locationUtil from 'app/core/utils/location_util';\r\nimport { DashboardModel } from '../state/DashboardModel';\r\nimport { removePanel } from '../utils/panel';\r\nimport { DashboardMeta, CoreEvents } from 'app/types';\r\nimport { GrafanaRootScope } from 'app/routes/GrafanaCtrl';\r\nimport { BackendSrv } from 'app/core/services/backend_srv';\r\nimport { ILocationService } from 'angular';\r\nimport { AppEvents } from '@grafana/data';\r\nimport { PanelEvents } from '@grafana/data';\r\n\r\ninterface DashboardSaveOptions {\r\n  folderId?: number;\r\n  overwrite?: boolean;\r\n  message?: string;\r\n  makeEditable?: boolean;\r\n}\r\n\r\nexport class DashboardSrv {\r\n  dashboard: DashboardModel;\r\n\r\n  /** @ngInject */\r\n  constructor(\r\n    private backendSrv: BackendSrv,\r\n    private $rootScope: GrafanaRootScope,\r\n    private $location: ILocationService\r\n  ) {\r\n    appEvents.on(CoreEvents.saveDashboard, this.saveDashboard.bind(this), $rootScope);\r\n    appEvents.on(PanelEvents.panelChangeView, this.onPanelChangeView);\r\n    appEvents.on(CoreEvents.removePanel, this.onRemovePanel);\r\n  }\r\n\r\n  create(dashboard: any, meta: DashboardMeta) {\r\n    return new DashboardModel(dashboard, meta);\r\n  }\r\n\r\n  setCurrent(dashboard: DashboardModel) {\r\n    this.dashboard = dashboard;\r\n  }\r\n\r\n  getCurrent(): DashboardModel {\r\n    return this.dashboard;\r\n  }\r\n\r\n  onRemovePanel = (panelId: number) => {\r\n    const dashboard = this.getCurrent();\r\n    removePanel(dashboard, dashboard.getPanelById(panelId), true);\r\n  };\r\n\r\n  onPanelChangeView = ({\r\n    fullscreen = false,\r\n    edit = false,\r\n    panelId,\r\n  }: {\r\n    fullscreen?: boolean;\r\n    edit?: boolean;\r\n    panelId?: number;\r\n  }) => {\r\n    const urlParams = this.$location.search();\r\n\r\n    // handle toggle logic\r\n    // I hate using these truthy converters (!!) but in this case\r\n    // I think it's appropriate. edit can be null/false/undefined and\r\n    // here i want all of those to compare the same\r\n    if (fullscreen === urlParams.fullscreen && edit === !!urlParams.edit) {\r\n      const paramsToRemove = ['fullscreen', 'edit', 'panelId', 'tab'];\r\n      for (const key of paramsToRemove) {\r\n        delete urlParams[key];\r\n      }\r\n\r\n      this.$location.search(urlParams);\r\n      return;\r\n    }\r\n\r\n    const newUrlParams = {\r\n      ...urlParams,\r\n      fullscreen: fullscreen || undefined,\r\n      edit: edit || undefined,\r\n      tab: edit ? urlParams.tab : undefined,\r\n      panelId,\r\n    };\r\n\r\n    Object.keys(newUrlParams).forEach(key => {\r\n      if (newUrlParams[key] === undefined) {\r\n        delete newUrlParams[key];\r\n      }\r\n    });\r\n\r\n    this.$location.search(newUrlParams);\r\n  };\r\n\r\n  handleSaveDashboardError(\r\n    clone: any,\r\n    options: DashboardSaveOptions,\r\n    err: { data: { status: string; message: any }; isHandled: boolean }\r\n  ) {\r\n    options.overwrite = true;\r\n\r\n    if (err.data && err.data.status === 'version-mismatch') {\r\n      err.isHandled = true;\r\n\r\n      this.$rootScope.appEvent(CoreEvents.showConfirmModal, {\r\n        title: 'Conflict',\r\n        text: 'Someone else has updated this dashboard.',\r\n        text2: 'Would you still like to save this dashboard?',\r\n        yesText: 'Save & Overwrite',\r\n        icon: 'fa-warning',\r\n        onConfirm: () => {\r\n          this.save(clone, options);\r\n        },\r\n      });\r\n    }\r\n\r\n    if (err.data && err.data.status === 'name-exists') {\r\n      err.isHandled = true;\r\n\r\n      this.$rootScope.appEvent(CoreEvents.showConfirmModal, {\r\n        title: 'Conflict',\r\n        text: 'A dashboard with the same name in selected folder already exists.',\r\n        text2: 'Would you still like to save this dashboard?',\r\n        yesText: 'Save & Overwrite',\r\n        icon: 'fa-warning',\r\n        onConfirm: () => {\r\n          this.save(clone, options);\r\n        },\r\n      });\r\n    }\r\n\r\n    if (err.data && err.data.status === 'plugin-dashboard') {\r\n      err.isHandled = true;\r\n\r\n      this.$rootScope.appEvent(CoreEvents.showConfirmModal, {\r\n        title: 'Plugin Dashboard',\r\n        text: err.data.message,\r\n        text2: 'Your changes will be lost when you update the plugin. Use Save As to create custom version.',\r\n        yesText: 'Overwrite',\r\n        icon: 'fa-warning',\r\n        altActionText: 'Save As',\r\n        onAltAction: () => {\r\n          this.showSaveAsModal();\r\n        },\r\n        onConfirm: () => {\r\n          this.save(clone, { ...options, overwrite: true });\r\n        },\r\n      });\r\n    }\r\n  }\r\n\r\n  postSave(data: { version: number; url: string }) {\r\n    this.dashboard.version = data.version;\r\n\r\n    // important that these happen before location redirect below\r\n    this.$rootScope.appEvent(CoreEvents.dashboardSaved, this.dashboard);\r\n    this.$rootScope.appEvent(AppEvents.alertSuccess, ['Dashboard saved']);\r\n\r\n    const newUrl = locationUtil.stripBaseFromUrl(data.url);\r\n    const currentPath = this.$location.path();\r\n\r\n    if (newUrl !== currentPath) {\r\n      this.$location.url(newUrl).replace();\r\n    }\r\n\r\n    return this.dashboard;\r\n  }\r\n\r\n  save(clone: any, options?: DashboardSaveOptions) {\r\n    options.folderId = options.folderId >= 0 ? options.folderId : this.dashboard.meta.folderId || clone.folderId;\r\n\r\n    return this.backendSrv\r\n      .saveDashboard(clone, options)\r\n      .then((data: any) => this.postSave(data))\r\n      .catch(this.handleSaveDashboardError.bind(this, clone, { folderId: options.folderId }));\r\n  }\r\n\r\n  saveDashboard(\r\n    clone?: DashboardModel,\r\n    { makeEditable = false, folderId, overwrite = false, message }: DashboardSaveOptions = {}\r\n  ) {\r\n    if (clone) {\r\n      this.setCurrent(this.create(clone, this.dashboard.meta));\r\n    }\r\n\r\n    if (this.dashboard.meta.provisioned) {\r\n      return this.showDashboardProvisionedModal();\r\n    }\r\n\r\n    if (!(this.dashboard.meta.canSave || makeEditable)) {\r\n      return Promise.resolve();\r\n    }\r\n\r\n    if (this.dashboard.title === 'New dashboard') {\r\n      return this.showSaveAsModal();\r\n    }\r\n\r\n    if (this.dashboard.version > 0) {\r\n      return this.showSaveModal();\r\n    }\r\n\r\n    return this.save(this.dashboard.getSaveModelClone(), { folderId, overwrite, message });\r\n  }\r\n\r\n  saveJSONDashboard(json: string) {\r\n    return this.save(JSON.parse(json), {});\r\n  }\r\n\r\n  showDashboardProvisionedModal() {\r\n    this.$rootScope.appEvent(CoreEvents.showModal, {\r\n      templateHtml: '<save-provisioned-dashboard-modal dismiss=\"dismiss()\"></save-provisioned-dashboard-modal>',\r\n    });\r\n  }\r\n\r\n  showSaveAsModal() {\r\n    this.$rootScope.appEvent(CoreEvents.showModal, {\r\n      templateHtml: '<save-dashboard-as-modal dismiss=\"dismiss()\"></save-dashboard-as-modal>',\r\n      modalClass: 'modal--narrow',\r\n    });\r\n  }\r\n\r\n  showSaveModal() {\r\n    this.$rootScope.appEvent(CoreEvents.showModal, {\r\n      templateHtml: '<save-dashboard-modal dismiss=\"dismiss()\"></save-dashboard-modal>',\r\n      modalClass: 'modal--narrow',\r\n    });\r\n  }\r\n\r\n  starDashboard(dashboardId: string, isStarred: any) {\r\n    let promise;\r\n\r\n    if (isStarred) {\r\n      promise = this.backendSrv.delete('/api/user/stars/dashboard/' + dashboardId).then(() => {\r\n        return false;\r\n      });\r\n    } else {\r\n      promise = this.backendSrv.post('/api/user/stars/dashboard/' + dashboardId).then(() => {\r\n        return true;\r\n      });\r\n    }\r\n\r\n    return promise.then((res: boolean) => {\r\n      if (this.dashboard && this.dashboard.id === dashboardId) {\r\n        this.dashboard.meta.isStarred = res;\r\n      }\r\n      return res;\r\n    });\r\n  }\r\n}\r\n\r\ncoreModule.service('dashboardSrv', DashboardSrv);\r\n\r\n//\r\n// Code below is to export the service to react components\r\n//\r\n\r\nlet singletonInstance: DashboardSrv;\r\n\r\nexport function setDashboardSrv(instance: DashboardSrv) {\r\n  singletonInstance = instance;\r\n}\r\n\r\nexport function getDashboardSrv(): DashboardSrv {\r\n  return singletonInstance;\r\n}\r\n","// Libraries\r\nimport _ from 'lodash';\r\n// Utils\r\nimport kbn from 'app/core/utils/kbn';\r\nimport coreModule from 'app/core/core_module';\r\n// Types\r\nimport {\r\n  dateMath,\r\n  DefaultTimeRange,\r\n  TimeRange,\r\n  RawTimeRange,\r\n  TimeZone,\r\n  toUtc,\r\n  dateTime,\r\n  isDateTime,\r\n} from '@grafana/data';\r\nimport { ITimeoutService, ILocationService } from 'angular';\r\nimport { ContextSrv } from 'app/core/services/context_srv';\r\nimport { DashboardModel } from '../state/DashboardModel';\r\nimport { GrafanaRootScope } from 'app/routes/GrafanaCtrl';\r\nimport { getZoomedTimeRange, getShiftedTimeRange } from 'app/core/utils/timePicker';\r\n\r\nexport class TimeSrv {\r\n  time: any;\r\n  refreshTimer: any;\r\n  refresh: any;\r\n  oldRefresh: boolean;\r\n  dashboard: Partial<DashboardModel>;\r\n  timeAtLoad: any;\r\n  private autoRefreshBlocked: boolean;\r\n\r\n  /** @ngInject */\r\n  constructor(\r\n    $rootScope: GrafanaRootScope,\r\n    private $timeout: ITimeoutService,\r\n    private $location: ILocationService,\r\n    private timer: any,\r\n    private contextSrv: ContextSrv\r\n  ) {\r\n    // default time\r\n    this.time = DefaultTimeRange.raw;\r\n\r\n    $rootScope.$on('zoom-out', this.zoomOut.bind(this));\r\n    $rootScope.$on('shift-time', this.shiftTime.bind(this));\r\n    $rootScope.$on('$routeUpdate', this.routeUpdated.bind(this));\r\n\r\n    document.addEventListener('visibilitychange', () => {\r\n      if (this.autoRefreshBlocked && document.visibilityState === 'visible') {\r\n        this.autoRefreshBlocked = false;\r\n        this.refreshDashboard();\r\n      }\r\n    });\r\n  }\r\n\r\n  init(dashboard: Partial<DashboardModel>) {\r\n    this.timer.cancelAll();\r\n\r\n    this.dashboard = dashboard;\r\n    this.time = dashboard.time;\r\n    this.refresh = dashboard.refresh;\r\n\r\n    this.initTimeFromUrl();\r\n    this.parseTime();\r\n\r\n    // remember time at load so we can go back to it\r\n    this.timeAtLoad = _.cloneDeep(this.time);\r\n\r\n    if (this.refresh) {\r\n      this.setAutoRefresh(this.refresh);\r\n    }\r\n  }\r\n\r\n  private parseTime() {\r\n    // when absolute time is saved in json it is turned to a string\r\n    if (_.isString(this.time.from) && this.time.from.indexOf('Z') >= 0) {\r\n      this.time.from = dateTime(this.time.from).utc();\r\n    }\r\n    if (_.isString(this.time.to) && this.time.to.indexOf('Z') >= 0) {\r\n      this.time.to = dateTime(this.time.to).utc();\r\n    }\r\n  }\r\n\r\n  private parseUrlParam(value: any) {\r\n    if (value.indexOf('now') !== -1) {\r\n      return value;\r\n    }\r\n    if (value.length === 8) {\r\n      return toUtc(value, 'YYYYMMDD');\r\n    }\r\n    if (value.length === 15) {\r\n      return toUtc(value, 'YYYYMMDDTHHmmss');\r\n    }\r\n\r\n    if (!isNaN(value)) {\r\n      const epoch = parseInt(value, 10);\r\n      return toUtc(epoch);\r\n    }\r\n\r\n    return null;\r\n  }\r\n\r\n  private getTimeWindow(time: string, timeWindow: string) {\r\n    const valueTime = parseInt(time, 10);\r\n    let timeWindowMs;\r\n\r\n    if (timeWindow.match(/^\\d+$/) && parseInt(timeWindow, 10)) {\r\n      // when time window specified in ms\r\n      timeWindowMs = parseInt(timeWindow, 10);\r\n    } else {\r\n      timeWindowMs = kbn.interval_to_ms(timeWindow);\r\n    }\r\n\r\n    return {\r\n      from: toUtc(valueTime - timeWindowMs / 2),\r\n      to: toUtc(valueTime + timeWindowMs / 2),\r\n    };\r\n  }\r\n\r\n  private initTimeFromUrl() {\r\n    const params = this.$location.search();\r\n\r\n    if (params.time && params['time.window']) {\r\n      this.time = this.getTimeWindow(params.time, params['time.window']);\r\n    }\r\n\r\n    if (params.from) {\r\n      this.time.from = this.parseUrlParam(params.from) || this.time.from;\r\n    }\r\n    if (params.to) {\r\n      this.time.to = this.parseUrlParam(params.to) || this.time.to;\r\n    }\r\n    // if absolute ignore refresh option saved to dashboard\r\n    if (params.to && params.to.indexOf('now') === -1) {\r\n      this.refresh = false;\r\n      this.dashboard.refresh = false;\r\n    }\r\n    // but if refresh explicitly set then use that\r\n    if (params.refresh) {\r\n      this.refresh = params.refresh || this.refresh;\r\n    }\r\n  }\r\n\r\n  private routeUpdated() {\r\n    const params = this.$location.search();\r\n    if (params.left) {\r\n      return; // explore handles this;\r\n    }\r\n    const urlRange = this.timeRangeForUrl();\r\n    // check if url has time range\r\n    if (params.from && params.to) {\r\n      // is it different from what our current time range?\r\n      if (params.from !== urlRange.from || params.to !== urlRange.to) {\r\n        // issue update\r\n        this.initTimeFromUrl();\r\n        this.setTime(this.time, true);\r\n      }\r\n    } else if (this.timeHasChangedSinceLoad()) {\r\n      this.setTime(this.timeAtLoad, true);\r\n    }\r\n  }\r\n\r\n  private timeHasChangedSinceLoad() {\r\n    return this.timeAtLoad && (this.timeAtLoad.from !== this.time.from || this.timeAtLoad.to !== this.time.to);\r\n  }\r\n\r\n  setAutoRefresh(interval: any) {\r\n    this.dashboard.refresh = interval;\r\n    this.cancelNextRefresh();\r\n\r\n    if (interval) {\r\n      const intervalMs = kbn.interval_to_ms(interval);\r\n\r\n      this.refreshTimer = this.timer.register(\r\n        this.$timeout(() => {\r\n          this.startNextRefreshTimer(intervalMs);\r\n          this.refreshDashboard();\r\n        }, intervalMs)\r\n      );\r\n    }\r\n\r\n    // update url inside timeout to so that a digest happens after (called from react)\r\n    this.$timeout(() => {\r\n      const params = this.$location.search();\r\n      if (interval) {\r\n        params.refresh = interval;\r\n        this.$location.search(params);\r\n      } else if (params.refresh) {\r\n        delete params.refresh;\r\n        this.$location.search(params);\r\n      }\r\n    });\r\n  }\r\n\r\n  refreshDashboard() {\r\n    this.dashboard.timeRangeUpdated(this.timeRange());\r\n  }\r\n\r\n  private startNextRefreshTimer(afterMs: number) {\r\n    this.cancelNextRefresh();\r\n    this.refreshTimer = this.timer.register(\r\n      this.$timeout(() => {\r\n        this.startNextRefreshTimer(afterMs);\r\n        if (this.contextSrv.isGrafanaVisible()) {\r\n          this.refreshDashboard();\r\n        } else {\r\n          this.autoRefreshBlocked = true;\r\n        }\r\n      }, afterMs)\r\n    );\r\n  }\r\n\r\n  private cancelNextRefresh() {\r\n    this.timer.cancel(this.refreshTimer);\r\n  }\r\n\r\n  setTime(time: RawTimeRange, fromRouteUpdate?: boolean) {\r\n    _.extend(this.time, time);\r\n\r\n    // disable refresh if zoom in or zoom out\r\n    if (isDateTime(time.to)) {\r\n      this.oldRefresh = this.dashboard.refresh || this.oldRefresh;\r\n      this.setAutoRefresh(false);\r\n    } else if (this.oldRefresh && this.oldRefresh !== this.dashboard.refresh) {\r\n      this.setAutoRefresh(this.oldRefresh);\r\n      this.oldRefresh = null;\r\n    }\r\n\r\n    // update url\r\n    if (fromRouteUpdate !== true) {\r\n      const urlRange = this.timeRangeForUrl();\r\n      const urlParams = this.$location.search();\r\n      urlParams.from = urlRange.from;\r\n      urlParams.to = urlRange.to;\r\n      this.$location.search(urlParams);\r\n    }\r\n\r\n    this.$timeout(this.refreshDashboard.bind(this), 0);\r\n  }\r\n\r\n  timeRangeForUrl() {\r\n    const range = this.timeRange().raw;\r\n\r\n    if (isDateTime(range.from)) {\r\n      range.from = range.from.valueOf().toString();\r\n    }\r\n    if (isDateTime(range.to)) {\r\n      range.to = range.to.valueOf().toString();\r\n    }\r\n\r\n    return range;\r\n  }\r\n\r\n  timeRange(): TimeRange {\r\n    // make copies if they are moment  (do not want to return out internal moment, because they are mutable!)\r\n    const raw = {\r\n      from: isDateTime(this.time.from) ? dateTime(this.time.from) : this.time.from,\r\n      to: isDateTime(this.time.to) ? dateTime(this.time.to) : this.time.to,\r\n    };\r\n\r\n    const timezone: TimeZone = this.dashboard ? this.dashboard.getTimezone() : undefined;\r\n\r\n    return {\r\n      from: dateMath.parse(raw.from, false, timezone),\r\n      to: dateMath.parse(raw.to, true, timezone),\r\n      raw: raw,\r\n    };\r\n  }\r\n\r\n  zoomOut(e: any, factor: number) {\r\n    const range = this.timeRange();\r\n    const { from, to } = getZoomedTimeRange(range, factor);\r\n\r\n    this.setTime({ from: toUtc(from), to: toUtc(to) });\r\n  }\r\n\r\n  shiftTime(e: any, direction: number) {\r\n    const range = this.timeRange();\r\n    const { from, to } = getShiftedTimeRange(direction, range);\r\n\r\n    this.setTime({\r\n      from: toUtc(from),\r\n      to: toUtc(to),\r\n    });\r\n  }\r\n}\r\n\r\nlet singleton: TimeSrv;\r\n\r\nexport function setTimeSrv(srv: TimeSrv) {\r\n  singleton = srv;\r\n}\r\n\r\nexport function getTimeSrv(): TimeSrv {\r\n  return singleton;\r\n}\r\n\r\ncoreModule.service('timeSrv', TimeSrv);\r\n","import angular, { ILocationService } from 'angular';\r\nimport { ChangeTracker } from './ChangeTracker';\r\nimport { ContextSrv } from 'app/core/services/context_srv';\r\nimport { DashboardSrv } from './DashboardSrv';\r\nimport { GrafanaRootScope } from 'app/routes/GrafanaCtrl';\r\n\r\n/** @ngInject */\r\nexport function unsavedChangesSrv(\r\n  this: any,\r\n  $rootScope: GrafanaRootScope,\r\n  $location: ILocationService,\r\n  $timeout: any,\r\n  contextSrv: ContextSrv,\r\n  dashboardSrv: DashboardSrv,\r\n  $window: any\r\n) {\r\n  this.init = function(dashboard: any, scope: any) {\r\n    this.tracker = new ChangeTracker(dashboard, scope, 1000, $location, $window, $timeout, contextSrv, $rootScope);\r\n    return this.tracker;\r\n  };\r\n}\r\n\r\nangular.module('grafana.services').service('unsavedChangesSrv', unsavedChangesSrv);\r\n","// Libraries\r\nimport _ from 'lodash';\r\n\r\n// Utils\r\nimport getFactors from 'app/core/utils/factors';\r\nimport { appendQueryToUrl } from 'app/core/utils/url';\r\nimport kbn from 'app/core/utils/kbn';\r\n\r\n// Types\r\nimport { PanelModel } from './PanelModel';\r\nimport { DashboardModel } from './DashboardModel';\r\nimport { DataLink } from '@grafana/data';\r\n\r\n// Constants\r\nimport {\r\n  GRID_COLUMN_COUNT,\r\n  GRID_CELL_HEIGHT,\r\n  GRID_CELL_VMARGIN,\r\n  DEFAULT_ROW_HEIGHT,\r\n  MIN_PANEL_HEIGHT,\r\n  DEFAULT_PANEL_SPAN,\r\n} from 'app/core/constants';\r\nimport { DataLinkBuiltInVars } from '@grafana/ui';\r\n\r\nexport class DashboardMigrator {\r\n  dashboard: DashboardModel;\r\n\r\n  constructor(dashboardModel: DashboardModel) {\r\n    this.dashboard = dashboardModel;\r\n  }\r\n\r\n  updateSchema(old: any) {\r\n    let i, j, k, n;\r\n    const oldVersion = this.dashboard.schemaVersion;\r\n    const panelUpgrades = [];\r\n    this.dashboard.schemaVersion = 22;\r\n\r\n    if (oldVersion === this.dashboard.schemaVersion) {\r\n      return;\r\n    }\r\n\r\n    // version 2 schema changes\r\n    if (oldVersion < 2) {\r\n      if (old.services) {\r\n        if (old.services.filter) {\r\n          this.dashboard.time = old.services.filter.time;\r\n          this.dashboard.templating.list = old.services.filter.list || [];\r\n        }\r\n      }\r\n\r\n      panelUpgrades.push((panel: any) => {\r\n        // rename panel type\r\n        if (panel.type === 'graphite') {\r\n          panel.type = 'graph';\r\n        }\r\n        if (panel.type !== 'graph') {\r\n          return;\r\n        }\r\n\r\n        if (_.isBoolean(panel.legend)) {\r\n          panel.legend = { show: panel.legend };\r\n        }\r\n\r\n        if (panel.grid) {\r\n          if (panel.grid.min) {\r\n            panel.grid.leftMin = panel.grid.min;\r\n            delete panel.grid.min;\r\n          }\r\n\r\n          if (panel.grid.max) {\r\n            panel.grid.leftMax = panel.grid.max;\r\n            delete panel.grid.max;\r\n          }\r\n        }\r\n\r\n        if (panel.y_format) {\r\n          if (!panel.y_formats) {\r\n            panel.y_formats = [];\r\n          }\r\n          panel.y_formats[0] = panel.y_format;\r\n          delete panel.y_format;\r\n        }\r\n\r\n        if (panel.y2_format) {\r\n          if (!panel.y_formats) {\r\n            panel.y_formats = [];\r\n          }\r\n          panel.y_formats[1] = panel.y2_format;\r\n          delete panel.y2_format;\r\n        }\r\n      });\r\n    }\r\n\r\n    // schema version 3 changes\r\n    if (oldVersion < 3) {\r\n      // ensure panel ids\r\n      let maxId = this.dashboard.getNextPanelId();\r\n      panelUpgrades.push((panel: any) => {\r\n        if (!panel.id) {\r\n          panel.id = maxId;\r\n          maxId += 1;\r\n        }\r\n      });\r\n    }\r\n\r\n    // schema version 4 changes\r\n    if (oldVersion < 4) {\r\n      // move aliasYAxis changes\r\n      panelUpgrades.push((panel: any) => {\r\n        if (panel.type !== 'graph') {\r\n          return;\r\n        }\r\n        _.each(panel.aliasYAxis, (value, key) => {\r\n          panel.seriesOverrides = [{ alias: key, yaxis: value }];\r\n        });\r\n        delete panel.aliasYAxis;\r\n      });\r\n    }\r\n\r\n    if (oldVersion < 6) {\r\n      // move pulldowns to new schema\r\n      const annotations: any = _.find(old.pulldowns, { type: 'annotations' });\r\n\r\n      if (annotations) {\r\n        this.dashboard.annotations = {\r\n          list: annotations.annotations || [],\r\n        };\r\n      }\r\n\r\n      // update template variables\r\n      for (i = 0; i < this.dashboard.templating.list.length; i++) {\r\n        const variable = this.dashboard.templating.list[i];\r\n        if (variable.datasource === void 0) {\r\n          variable.datasource = null;\r\n        }\r\n        if (variable.type === 'filter') {\r\n          variable.type = 'query';\r\n        }\r\n        if (variable.type === void 0) {\r\n          variable.type = 'query';\r\n        }\r\n        if (variable.allFormat === void 0) {\r\n          variable.allFormat = 'glob';\r\n        }\r\n      }\r\n    }\r\n\r\n    if (oldVersion < 7) {\r\n      if (old.nav && old.nav.length) {\r\n        this.dashboard.timepicker = old.nav[0];\r\n      }\r\n\r\n      // ensure query refIds\r\n      panelUpgrades.push((panel: any) => {\r\n        _.each(panel.targets, target => {\r\n          if (!target.refId) {\r\n            target.refId = panel.getNextQueryLetter && panel.getNextQueryLetter();\r\n          }\r\n        });\r\n      });\r\n    }\r\n\r\n    if (oldVersion < 8) {\r\n      panelUpgrades.push((panel: any) => {\r\n        _.each(panel.targets, target => {\r\n          // update old influxdb query schema\r\n          if (target.fields && target.tags && target.groupBy) {\r\n            if (target.rawQuery) {\r\n              delete target.fields;\r\n              delete target.fill;\r\n            } else {\r\n              target.select = _.map(target.fields, field => {\r\n                const parts = [];\r\n                parts.push({ type: 'field', params: [field.name] });\r\n                parts.push({ type: field.func, params: [] });\r\n                if (field.mathExpr) {\r\n                  parts.push({ type: 'math', params: [field.mathExpr] });\r\n                }\r\n                if (field.asExpr) {\r\n                  parts.push({ type: 'alias', params: [field.asExpr] });\r\n                }\r\n                return parts;\r\n              });\r\n              delete target.fields;\r\n              _.each(target.groupBy, part => {\r\n                if (part.type === 'time' && part.interval) {\r\n                  part.params = [part.interval];\r\n                  delete part.interval;\r\n                }\r\n                if (part.type === 'tag' && part.key) {\r\n                  part.params = [part.key];\r\n                  delete part.key;\r\n                }\r\n              });\r\n\r\n              if (target.fill) {\r\n                target.groupBy.push({ type: 'fill', params: [target.fill] });\r\n                delete target.fill;\r\n              }\r\n            }\r\n          }\r\n        });\r\n      });\r\n    }\r\n\r\n    // schema version 9 changes\r\n    if (oldVersion < 9) {\r\n      // move aliasYAxis changes\r\n      panelUpgrades.push((panel: any) => {\r\n        if (panel.type !== 'singlestat' && panel.thresholds !== '') {\r\n          return;\r\n        }\r\n\r\n        if (panel.thresholds) {\r\n          const k = panel.thresholds.split(',');\r\n\r\n          if (k.length >= 3) {\r\n            k.shift();\r\n            panel.thresholds = k.join(',');\r\n          }\r\n        }\r\n      });\r\n    }\r\n\r\n    // schema version 10 changes\r\n    if (oldVersion < 10) {\r\n      // move aliasYAxis changes\r\n      panelUpgrades.push((panel: any) => {\r\n        if (panel.type !== 'table') {\r\n          return;\r\n        }\r\n\r\n        _.each(panel.styles, style => {\r\n          if (style.thresholds && style.thresholds.length >= 3) {\r\n            const k = style.thresholds;\r\n            k.shift();\r\n            style.thresholds = k;\r\n          }\r\n        });\r\n      });\r\n    }\r\n\r\n    if (oldVersion < 12) {\r\n      // update template variables\r\n      _.each(this.dashboard.templating.list, templateVariable => {\r\n        if (templateVariable.refresh) {\r\n          templateVariable.refresh = 1;\r\n        }\r\n        if (!templateVariable.refresh) {\r\n          templateVariable.refresh = 0;\r\n        }\r\n        if (templateVariable.hideVariable) {\r\n          templateVariable.hide = 2;\r\n        } else if (templateVariable.hideLabel) {\r\n          templateVariable.hide = 1;\r\n        }\r\n      });\r\n    }\r\n\r\n    if (oldVersion < 12) {\r\n      // update graph yaxes changes\r\n      panelUpgrades.push((panel: any) => {\r\n        if (panel.type !== 'graph') {\r\n          return;\r\n        }\r\n        if (!panel.grid) {\r\n          return;\r\n        }\r\n\r\n        if (!panel.yaxes) {\r\n          panel.yaxes = [\r\n            {\r\n              show: panel['y-axis'],\r\n              min: panel.grid.leftMin,\r\n              max: panel.grid.leftMax,\r\n              logBase: panel.grid.leftLogBase,\r\n              format: panel.y_formats[0],\r\n              label: panel.leftYAxisLabel,\r\n            },\r\n            {\r\n              show: panel['y-axis'],\r\n              min: panel.grid.rightMin,\r\n              max: panel.grid.rightMax,\r\n              logBase: panel.grid.rightLogBase,\r\n              format: panel.y_formats[1],\r\n              label: panel.rightYAxisLabel,\r\n            },\r\n          ];\r\n\r\n          panel.xaxis = {\r\n            show: panel['x-axis'],\r\n          };\r\n\r\n          delete panel.grid.leftMin;\r\n          delete panel.grid.leftMax;\r\n          delete panel.grid.leftLogBase;\r\n          delete panel.grid.rightMin;\r\n          delete panel.grid.rightMax;\r\n          delete panel.grid.rightLogBase;\r\n          delete panel.y_formats;\r\n          delete panel.leftYAxisLabel;\r\n          delete panel.rightYAxisLabel;\r\n          delete panel['y-axis'];\r\n          delete panel['x-axis'];\r\n        }\r\n      });\r\n    }\r\n\r\n    if (oldVersion < 13) {\r\n      // update graph yaxes changes\r\n      panelUpgrades.push((panel: any) => {\r\n        if (panel.type !== 'graph') {\r\n          return;\r\n        }\r\n        if (!panel.grid) {\r\n          return;\r\n        }\r\n\r\n        if (!panel.thresholds) {\r\n          panel.thresholds = [];\r\n        }\r\n        const t1: any = {},\r\n          t2: any = {};\r\n\r\n        if (panel.grid.threshold1 !== null) {\r\n          t1.value = panel.grid.threshold1;\r\n          if (panel.grid.thresholdLine) {\r\n            t1.line = true;\r\n            t1.lineColor = panel.grid.threshold1Color;\r\n            t1.colorMode = 'custom';\r\n          } else {\r\n            t1.fill = true;\r\n            t1.fillColor = panel.grid.threshold1Color;\r\n            t1.colorMode = 'custom';\r\n          }\r\n        }\r\n\r\n        if (panel.grid.threshold2 !== null) {\r\n          t2.value = panel.grid.threshold2;\r\n          if (panel.grid.thresholdLine) {\r\n            t2.line = true;\r\n            t2.lineColor = panel.grid.threshold2Color;\r\n            t2.colorMode = 'custom';\r\n          } else {\r\n            t2.fill = true;\r\n            t2.fillColor = panel.grid.threshold2Color;\r\n            t2.colorMode = 'custom';\r\n          }\r\n        }\r\n\r\n        if (_.isNumber(t1.value)) {\r\n          if (_.isNumber(t2.value)) {\r\n            if (t1.value > t2.value) {\r\n              t1.op = t2.op = 'lt';\r\n              panel.thresholds.push(t1);\r\n              panel.thresholds.push(t2);\r\n            } else {\r\n              t1.op = t2.op = 'gt';\r\n              panel.thresholds.push(t1);\r\n              panel.thresholds.push(t2);\r\n            }\r\n          } else {\r\n            t1.op = 'gt';\r\n            panel.thresholds.push(t1);\r\n          }\r\n        }\r\n\r\n        delete panel.grid.threshold1;\r\n        delete panel.grid.threshold1Color;\r\n        delete panel.grid.threshold2;\r\n        delete panel.grid.threshold2Color;\r\n        delete panel.grid.thresholdLine;\r\n      });\r\n    }\r\n\r\n    if (oldVersion < 14) {\r\n      this.dashboard.graphTooltip = old.sharedCrosshair ? 1 : 0;\r\n    }\r\n\r\n    if (oldVersion < 16) {\r\n      this.upgradeToGridLayout(old);\r\n    }\r\n\r\n    if (oldVersion < 17) {\r\n      panelUpgrades.push((panel: any) => {\r\n        if (panel.minSpan) {\r\n          const max = GRID_COLUMN_COUNT / panel.minSpan;\r\n          const factors = getFactors(GRID_COLUMN_COUNT);\r\n          // find the best match compared to factors\r\n          // (ie. [1,2,3,4,6,12,24] for 24 columns)\r\n          panel.maxPerRow =\r\n            factors[\r\n              _.findIndex(factors, o => {\r\n                return o > max;\r\n              }) - 1\r\n            ];\r\n        }\r\n        delete panel.minSpan;\r\n      });\r\n    }\r\n\r\n    if (oldVersion < 18) {\r\n      // migrate change to gauge options\r\n      panelUpgrades.push((panel: any) => {\r\n        if (panel['options-gauge']) {\r\n          panel.options = panel['options-gauge'];\r\n          panel.options.valueOptions = {\r\n            unit: panel.options.unit,\r\n            stat: panel.options.stat,\r\n            decimals: panel.options.decimals,\r\n            prefix: panel.options.prefix,\r\n            suffix: panel.options.suffix,\r\n          };\r\n\r\n          // correct order\r\n          if (panel.options.thresholds) {\r\n            panel.options.thresholds.reverse();\r\n          }\r\n\r\n          // this options prop was due to a bug\r\n          delete panel.options.options;\r\n          delete panel.options.unit;\r\n          delete panel.options.stat;\r\n          delete panel.options.decimals;\r\n          delete panel.options.prefix;\r\n          delete panel.options.suffix;\r\n          delete panel['options-gauge'];\r\n        }\r\n      });\r\n    }\r\n\r\n    if (oldVersion < 19) {\r\n      // migrate change to gauge options\r\n      panelUpgrades.push((panel: any) => {\r\n        if (panel.links && _.isArray(panel.links)) {\r\n          panel.links = panel.links.map(upgradePanelLink);\r\n        }\r\n      });\r\n    }\r\n\r\n    if (oldVersion < 20) {\r\n      const updateLinks = (link: DataLink) => {\r\n        return {\r\n          ...link,\r\n          url: updateVariablesSyntax(link.url),\r\n        };\r\n      };\r\n      panelUpgrades.push((panel: any) => {\r\n        // For graph panel\r\n        if (panel.options && panel.options.dataLinks && _.isArray(panel.options.dataLinks)) {\r\n          panel.options.dataLinks = panel.options.dataLinks.map(updateLinks);\r\n        }\r\n\r\n        // For panel with fieldOptions\r\n        if (panel.options && panel.options.fieldOptions && panel.options.fieldOptions.defaults) {\r\n          if (panel.options.fieldOptions.defaults.links && _.isArray(panel.options.fieldOptions.defaults.links)) {\r\n            panel.options.fieldOptions.defaults.links = panel.options.fieldOptions.defaults.links.map(updateLinks);\r\n          }\r\n          if (panel.options.fieldOptions.defaults.title) {\r\n            panel.options.fieldOptions.defaults.title = updateVariablesSyntax(\r\n              panel.options.fieldOptions.defaults.title\r\n            );\r\n          }\r\n        }\r\n      });\r\n    }\r\n\r\n    if (oldVersion < 21) {\r\n      const updateLinks = (link: DataLink) => {\r\n        return {\r\n          ...link,\r\n          url: link.url.replace(/__series.labels/g, '__field.labels'),\r\n        };\r\n      };\r\n      panelUpgrades.push((panel: any) => {\r\n        // For graph panel\r\n        if (panel.options && panel.options.dataLinks && _.isArray(panel.options.dataLinks)) {\r\n          panel.options.dataLinks = panel.options.dataLinks.map(updateLinks);\r\n        }\r\n\r\n        // For panel with fieldOptions\r\n        if (panel.options && panel.options.fieldOptions && panel.options.fieldOptions.defaults) {\r\n          if (panel.options.fieldOptions.defaults.links && _.isArray(panel.options.fieldOptions.defaults.links)) {\r\n            panel.options.fieldOptions.defaults.links = panel.options.fieldOptions.defaults.links.map(updateLinks);\r\n          }\r\n        }\r\n      });\r\n    }\r\n\r\n    if (oldVersion < 22) {\r\n      panelUpgrades.push((panel: any) => {\r\n        if (panel.type !== 'table') {\r\n          return;\r\n        }\r\n\r\n        _.each(panel.styles, style => {\r\n          style.align = 'auto';\r\n        });\r\n      });\r\n    }\r\n\r\n    if (panelUpgrades.length === 0) {\r\n      return;\r\n    }\r\n\r\n    for (j = 0; j < this.dashboard.panels.length; j++) {\r\n      for (k = 0; k < panelUpgrades.length; k++) {\r\n        panelUpgrades[k].call(this, this.dashboard.panels[j]);\r\n        if (this.dashboard.panels[j].panels) {\r\n          for (n = 0; n < this.dashboard.panels[j].panels.length; n++) {\r\n            panelUpgrades[k].call(this, this.dashboard.panels[j].panels[n]);\r\n          }\r\n        }\r\n      }\r\n    }\r\n  }\r\n\r\n  upgradeToGridLayout(old: any) {\r\n    let yPos = 0;\r\n    const widthFactor = GRID_COLUMN_COUNT / 12;\r\n\r\n    const maxPanelId = _.max(\r\n      _.flattenDeep(\r\n        _.map(old.rows, row => {\r\n          return _.map(row.panels, 'id');\r\n        })\r\n      )\r\n    );\r\n    let nextRowId = maxPanelId + 1;\r\n\r\n    if (!old.rows) {\r\n      return;\r\n    }\r\n\r\n    // Add special \"row\" panels if even one row is collapsed, repeated or has visible title\r\n    const showRows = _.some(old.rows, row => row.collapse || row.showTitle || row.repeat);\r\n\r\n    for (const row of old.rows) {\r\n      if (row.repeatIteration) {\r\n        continue;\r\n      }\r\n\r\n      const height: any = row.height || DEFAULT_ROW_HEIGHT;\r\n      const rowGridHeight = getGridHeight(height);\r\n\r\n      const rowPanel: any = {};\r\n      let rowPanelModel: PanelModel;\r\n      if (showRows) {\r\n        // add special row panel\r\n        rowPanel.id = nextRowId;\r\n        rowPanel.type = 'row';\r\n        rowPanel.title = row.title;\r\n        rowPanel.collapsed = row.collapse;\r\n        rowPanel.repeat = row.repeat;\r\n        rowPanel.panels = [];\r\n        rowPanel.gridPos = {\r\n          x: 0,\r\n          y: yPos,\r\n          w: GRID_COLUMN_COUNT,\r\n          h: rowGridHeight,\r\n        };\r\n        rowPanelModel = new PanelModel(rowPanel);\r\n        nextRowId++;\r\n        yPos++;\r\n      }\r\n\r\n      const rowArea = new RowArea(rowGridHeight, GRID_COLUMN_COUNT, yPos);\r\n\r\n      for (const panel of row.panels) {\r\n        panel.span = panel.span || DEFAULT_PANEL_SPAN;\r\n        if (panel.minSpan) {\r\n          panel.minSpan = Math.min(GRID_COLUMN_COUNT, (GRID_COLUMN_COUNT / 12) * panel.minSpan);\r\n        }\r\n        const panelWidth = Math.floor(panel.span) * widthFactor;\r\n        const panelHeight = panel.height ? getGridHeight(panel.height) : rowGridHeight;\r\n\r\n        const panelPos = rowArea.getPanelPosition(panelHeight, panelWidth);\r\n        yPos = rowArea.yPos;\r\n        panel.gridPos = {\r\n          x: panelPos.x,\r\n          y: yPos + panelPos.y,\r\n          w: panelWidth,\r\n          h: panelHeight,\r\n        };\r\n        rowArea.addPanel(panel.gridPos);\r\n\r\n        delete panel.span;\r\n\r\n        if (rowPanelModel && rowPanel.collapsed) {\r\n          rowPanelModel.panels.push(panel);\r\n        } else {\r\n          this.dashboard.panels.push(new PanelModel(panel));\r\n        }\r\n      }\r\n\r\n      if (rowPanelModel) {\r\n        this.dashboard.panels.push(rowPanelModel);\r\n      }\r\n\r\n      if (!(rowPanelModel && rowPanel.collapsed)) {\r\n        yPos += rowGridHeight;\r\n      }\r\n    }\r\n  }\r\n}\r\n\r\nfunction getGridHeight(height: number | string) {\r\n  if (_.isString(height)) {\r\n    height = parseInt(height.replace('px', ''), 10);\r\n  }\r\n\r\n  if (height < MIN_PANEL_HEIGHT) {\r\n    height = MIN_PANEL_HEIGHT;\r\n  }\r\n\r\n  const gridHeight = Math.ceil(height / (GRID_CELL_HEIGHT + GRID_CELL_VMARGIN));\r\n  return gridHeight;\r\n}\r\n\r\n/**\r\n * RowArea represents dashboard row filled by panels\r\n * area is an array of numbers represented filled column's cells like\r\n *  -----------------------\r\n * |******** ****\r\n * |******** ****\r\n * |********\r\n *  -----------------------\r\n *  33333333 2222 00000 ...\r\n */\r\nclass RowArea {\r\n  area: number[];\r\n  yPos: number;\r\n  height: number;\r\n\r\n  constructor(height: number, width = GRID_COLUMN_COUNT, rowYPos = 0) {\r\n    this.area = new Array(width).fill(0);\r\n    this.yPos = rowYPos;\r\n    this.height = height;\r\n  }\r\n\r\n  reset() {\r\n    this.area.fill(0);\r\n  }\r\n\r\n  /**\r\n   * Update area after adding the panel.\r\n   */\r\n  addPanel(gridPos: any) {\r\n    for (let i = gridPos.x; i < gridPos.x + gridPos.w; i++) {\r\n      if (!this.area[i] || gridPos.y + gridPos.h - this.yPos > this.area[i]) {\r\n        this.area[i] = gridPos.y + gridPos.h - this.yPos;\r\n      }\r\n    }\r\n    return this.area;\r\n  }\r\n\r\n  /**\r\n   * Calculate position for the new panel in the row.\r\n   */\r\n  getPanelPosition(panelHeight: number, panelWidth: number, callOnce = false): any {\r\n    let startPlace, endPlace;\r\n    let place;\r\n    for (let i = this.area.length - 1; i >= 0; i--) {\r\n      if (this.height - this.area[i] > 0) {\r\n        if (endPlace === undefined) {\r\n          endPlace = i;\r\n        } else {\r\n          if (i < this.area.length - 1 && this.area[i] <= this.area[i + 1]) {\r\n            startPlace = i;\r\n          } else {\r\n            break;\r\n          }\r\n        }\r\n      } else {\r\n        break;\r\n      }\r\n    }\r\n\r\n    if (startPlace !== undefined && endPlace !== undefined && endPlace - startPlace >= panelWidth - 1) {\r\n      const yPos = _.max(this.area.slice(startPlace));\r\n      place = {\r\n        x: startPlace,\r\n        y: yPos,\r\n      };\r\n    } else if (!callOnce) {\r\n      // wrap to next row\r\n      this.yPos += this.height;\r\n      this.reset();\r\n      return this.getPanelPosition(panelHeight, panelWidth, true);\r\n    } else {\r\n      return null;\r\n    }\r\n\r\n    return place;\r\n  }\r\n}\r\n\r\nfunction upgradePanelLink(link: any): DataLink {\r\n  let url = link.url;\r\n\r\n  if (!url && link.dashboard) {\r\n    url = `dashboard/db/${kbn.slugifyForUrl(link.dashboard)}`;\r\n  }\r\n\r\n  if (!url && link.dashUri) {\r\n    url = `dashboard/${link.dashUri}`;\r\n  }\r\n\r\n  // some models are incomplete and have no dashboard or dashUri\r\n  if (!url) {\r\n    url = '/';\r\n  }\r\n\r\n  if (link.keepTime) {\r\n    url = appendQueryToUrl(url, `$${DataLinkBuiltInVars.keepTime}`);\r\n  }\r\n\r\n  if (link.includeVars) {\r\n    url = appendQueryToUrl(url, `$${DataLinkBuiltInVars.includeVars}`);\r\n  }\r\n\r\n  if (link.params) {\r\n    url = appendQueryToUrl(url, link.params);\r\n  }\r\n\r\n  return {\r\n    url: url,\r\n    title: link.title,\r\n    targetBlank: link.targetBlank,\r\n  };\r\n}\r\n\r\nfunction updateVariablesSyntax(text: string) {\r\n  const legacyVariableNamesRegex = /(__series_name)|(\\$__series_name)|(__value_time)|(__field_name)|(\\$__field_name)/g;\r\n\r\n  return text.replace(legacyVariableNamesRegex, (match, seriesName, seriesName1, valueTime, fieldName, fieldName1) => {\r\n    if (seriesName) {\r\n      return '__series.name';\r\n    }\r\n    if (seriesName1) {\r\n      return '${__series.name}';\r\n    }\r\n    if (valueTime) {\r\n      return '__value.time';\r\n    }\r\n    if (fieldName) {\r\n      return '__field.name';\r\n    }\r\n    if (fieldName1) {\r\n      return '${__field.name}';\r\n    }\r\n    return match;\r\n  });\r\n}\r\n","// Libaries\r\nimport _ from 'lodash';\r\n// Constants\r\nimport { DEFAULT_ANNOTATION_COLOR } from '@grafana/ui';\r\nimport { GRID_CELL_HEIGHT, GRID_CELL_VMARGIN, GRID_COLUMN_COUNT, REPEAT_DIR_VERTICAL } from 'app/core/constants';\r\n// Utils & Services\r\nimport { Emitter } from 'app/core/utils/emitter';\r\nimport { contextSrv } from 'app/core/services/context_srv';\r\nimport sortByKeys from 'app/core/utils/sort_by_keys';\r\n// Types\r\nimport { GridPos, panelAdded, PanelModel, panelRemoved } from './PanelModel';\r\nimport { DashboardMigrator } from './DashboardMigrator';\r\nimport { AppEvent, dateTime, DateTimeInput, isDateTime, PanelEvents, TimeRange, TimeZone, toUtc } from '@grafana/data';\r\nimport { UrlQueryValue } from '@grafana/runtime';\r\nimport { CoreEvents, DashboardMeta, KIOSK_MODE_TV } from 'app/types';\r\n\r\nexport interface CloneOptions {\r\n  saveVariables?: boolean;\r\n  saveTimerange?: boolean;\r\n  message?: string;\r\n}\r\n\r\nexport class DashboardModel {\r\n  id: any;\r\n  uid: string;\r\n  title: string;\r\n  autoUpdate: any;\r\n  description: any;\r\n  tags: any;\r\n  style: any;\r\n  timezone: any;\r\n  editable: any;\r\n  graphTooltip: any;\r\n  time: any;\r\n  private originalTime: any;\r\n  timepicker: any;\r\n  templating: { list: any[] };\r\n  private originalTemplating: any;\r\n  annotations: { list: any[] };\r\n  refresh: any;\r\n  snapshot: any;\r\n  schemaVersion: number;\r\n  version: number;\r\n  revision: number;\r\n  links: any;\r\n  gnetId: any;\r\n  panels: PanelModel[];\r\n\r\n  // ------------------\r\n  // not persisted\r\n  // ------------------\r\n\r\n  // repeat process cycles\r\n  iteration: number;\r\n  meta: DashboardMeta;\r\n  events: Emitter;\r\n\r\n  static nonPersistedProperties: { [str: string]: boolean } = {\r\n    events: true,\r\n    meta: true,\r\n    panels: true, // needs special handling\r\n    templating: true, // needs special handling\r\n    originalTime: true,\r\n    originalTemplating: true,\r\n  };\r\n\r\n  constructor(data: any, meta?: DashboardMeta) {\r\n    if (!data) {\r\n      data = {};\r\n    }\r\n\r\n    this.events = new Emitter();\r\n    this.id = data.id || null;\r\n    this.uid = data.uid || null;\r\n    this.revision = data.revision;\r\n    this.title = data.title || 'No Title';\r\n    this.autoUpdate = data.autoUpdate;\r\n    this.description = data.description;\r\n    this.tags = data.tags || [];\r\n    this.style = data.style || 'dark';\r\n    this.timezone = data.timezone || '';\r\n    this.editable = data.editable !== false;\r\n    this.graphTooltip = data.graphTooltip || 0;\r\n    this.time = data.time || { from: 'now-6h', to: 'now' };\r\n    this.timepicker = data.timepicker || {};\r\n    this.templating = this.ensureListExist(data.templating);\r\n    this.annotations = this.ensureListExist(data.annotations);\r\n    this.refresh = data.refresh;\r\n    this.snapshot = data.snapshot;\r\n    this.schemaVersion = data.schemaVersion || 0;\r\n    this.version = data.version || 0;\r\n    this.links = data.links || [];\r\n    this.gnetId = data.gnetId || null;\r\n    this.panels = _.map(data.panels || [], (panelData: any) => new PanelModel(panelData));\r\n\r\n    this.resetOriginalVariables();\r\n    this.resetOriginalTime();\r\n\r\n    this.initMeta(meta);\r\n    this.updateSchema(data);\r\n\r\n    this.addBuiltInAnnotationQuery();\r\n    this.sortPanelsByGridPos();\r\n  }\r\n\r\n  addBuiltInAnnotationQuery() {\r\n    let found = false;\r\n    for (const item of this.annotations.list) {\r\n      if (item.builtIn === 1) {\r\n        found = true;\r\n        break;\r\n      }\r\n    }\r\n\r\n    if (found) {\r\n      return;\r\n    }\r\n\r\n    this.annotations.list.unshift({\r\n      datasource: '-- Grafana --',\r\n      name: 'Annotations & Alerts',\r\n      type: 'dashboard',\r\n      iconColor: DEFAULT_ANNOTATION_COLOR,\r\n      enable: true,\r\n      hide: true,\r\n      builtIn: 1,\r\n    });\r\n  }\r\n\r\n  private initMeta(meta: DashboardMeta) {\r\n    meta = meta || {};\r\n\r\n    meta.canShare = meta.canShare !== false;\r\n    meta.canSave = meta.canSave !== false;\r\n    meta.canStar = meta.canStar !== false;\r\n    meta.canEdit = meta.canEdit !== false;\r\n    meta.showSettings = meta.canEdit;\r\n    meta.canMakeEditable = meta.canSave && !this.editable;\r\n    meta.fullscreen = false;\r\n    meta.isEditing = false;\r\n\r\n    if (!this.editable) {\r\n      meta.canEdit = false;\r\n      meta.canDelete = false;\r\n      meta.canSave = false;\r\n    }\r\n\r\n    this.meta = meta;\r\n  }\r\n\r\n  // cleans meta data and other non persistent state\r\n  getSaveModelClone(options?: CloneOptions) {\r\n    const defaults = _.defaults(options || {}, {\r\n      saveVariables: true,\r\n      saveTimerange: true,\r\n    });\r\n\r\n    // make clone\r\n    let copy: any = {};\r\n    for (const property in this) {\r\n      if (DashboardModel.nonPersistedProperties[property] || !this.hasOwnProperty(property)) {\r\n        continue;\r\n      }\r\n\r\n      copy[property] = _.cloneDeep(this[property]);\r\n    }\r\n\r\n    // get variable save models\r\n    copy.templating = {\r\n      list: _.map(this.templating.list, (variable: any) =>\r\n        variable.getSaveModel ? variable.getSaveModel() : variable\r\n      ),\r\n    };\r\n\r\n    if (!defaults.saveVariables) {\r\n      for (let i = 0; i < copy.templating.list.length; i++) {\r\n        const current = copy.templating.list[i];\r\n        const original: any = _.find(this.originalTemplating, { name: current.name, type: current.type });\r\n\r\n        if (!original) {\r\n          continue;\r\n        }\r\n\r\n        if (current.type === 'adhoc') {\r\n          copy.templating.list[i].filters = original.filters;\r\n        } else {\r\n          copy.templating.list[i].current = original.current;\r\n        }\r\n      }\r\n    }\r\n\r\n    if (!defaults.saveTimerange) {\r\n      copy.time = this.originalTime;\r\n    }\r\n\r\n    // get panel save models\r\n    copy.panels = _.chain(this.panels)\r\n      .filter((panel: PanelModel) => panel.type !== 'add-panel')\r\n      .map((panel: PanelModel) => panel.getSaveModel())\r\n      .value();\r\n\r\n    //  sort by keys\r\n    copy = sortByKeys(copy);\r\n\r\n    return copy;\r\n  }\r\n\r\n  setViewMode(panel: PanelModel, fullscreen: boolean, isEditing: boolean) {\r\n    this.meta.fullscreen = fullscreen;\r\n    this.meta.isEditing = isEditing && this.meta.canEdit;\r\n\r\n    panel.setViewMode(fullscreen, this.meta.isEditing);\r\n\r\n    this.events.emit(PanelEvents.viewModeChanged, panel);\r\n  }\r\n\r\n  timeRangeUpdated(timeRange: TimeRange) {\r\n    this.events.emit(CoreEvents.timeRangeUpdated, timeRange);\r\n  }\r\n\r\n  startRefresh() {\r\n    this.events.emit(PanelEvents.refresh);\r\n\r\n    for (const panel of this.panels) {\r\n      if (!this.otherPanelInFullscreen(panel)) {\r\n        panel.refresh();\r\n      }\r\n    }\r\n  }\r\n\r\n  render() {\r\n    this.events.emit(PanelEvents.render);\r\n\r\n    for (const panel of this.panels) {\r\n      panel.render();\r\n    }\r\n  }\r\n\r\n  panelInitialized(panel: PanelModel) {\r\n    panel.initialized();\r\n\r\n    if (!this.otherPanelInFullscreen(panel)) {\r\n      panel.refresh();\r\n    }\r\n  }\r\n\r\n  otherPanelInFullscreen(panel: PanelModel) {\r\n    return this.meta.fullscreen && !panel.fullscreen;\r\n  }\r\n\r\n  private ensureListExist(data: any) {\r\n    if (!data) {\r\n      data = {};\r\n    }\r\n    if (!data.list) {\r\n      data.list = [];\r\n    }\r\n    return data;\r\n  }\r\n\r\n  getNextPanelId() {\r\n    let max = 0;\r\n\r\n    for (const panel of this.panels) {\r\n      if (panel.id > max) {\r\n        max = panel.id;\r\n      }\r\n\r\n      if (panel.collapsed) {\r\n        for (const rowPanel of panel.panels) {\r\n          if (rowPanel.id > max) {\r\n            max = rowPanel.id;\r\n          }\r\n        }\r\n      }\r\n    }\r\n\r\n    return max + 1;\r\n  }\r\n\r\n  forEachPanel(callback: (panel: PanelModel, index: number) => void) {\r\n    for (let i = 0; i < this.panels.length; i++) {\r\n      callback(this.panels[i], i);\r\n    }\r\n  }\r\n\r\n  getPanelById(id: number): PanelModel {\r\n    for (const panel of this.panels) {\r\n      if (panel.id === id) {\r\n        return panel;\r\n      }\r\n    }\r\n    return null;\r\n  }\r\n\r\n  canEditPanel(panel?: PanelModel): boolean {\r\n    return this.meta.canEdit && panel && !panel.repeatPanelId;\r\n  }\r\n\r\n  canEditPanelById(id: number): boolean {\r\n    return this.canEditPanel(this.getPanelById(id));\r\n  }\r\n\r\n  addPanel(panelData: any) {\r\n    panelData.id = this.getNextPanelId();\r\n\r\n    const panel = new PanelModel(panelData);\r\n\r\n    this.panels.unshift(panel);\r\n\r\n    this.sortPanelsByGridPos();\r\n\r\n    this.events.emit(panelAdded, panel);\r\n  }\r\n\r\n  sortPanelsByGridPos() {\r\n    this.panels.sort((panelA, panelB) => {\r\n      if (panelA.gridPos.y === panelB.gridPos.y) {\r\n        return panelA.gridPos.x - panelB.gridPos.x;\r\n      } else {\r\n        return panelA.gridPos.y - panelB.gridPos.y;\r\n      }\r\n    });\r\n  }\r\n\r\n  cleanUpRepeats() {\r\n    if (this.snapshot || this.templating.list.length === 0) {\r\n      return;\r\n    }\r\n\r\n    this.iteration = (this.iteration || new Date().getTime()) + 1;\r\n    const panelsToRemove = [];\r\n\r\n    // cleanup scopedVars\r\n    for (const panel of this.panels) {\r\n      delete panel.scopedVars;\r\n    }\r\n\r\n    for (let i = 0; i < this.panels.length; i++) {\r\n      const panel = this.panels[i];\r\n      if ((!panel.repeat || panel.repeatedByRow) && panel.repeatPanelId && panel.repeatIteration !== this.iteration) {\r\n        panelsToRemove.push(panel);\r\n      }\r\n    }\r\n\r\n    // remove panels\r\n    _.pull(this.panels, ...panelsToRemove);\r\n    panelsToRemove.map(p => p.destroy());\r\n    this.sortPanelsByGridPos();\r\n    this.events.emit(CoreEvents.repeatsProcessed);\r\n  }\r\n\r\n  processRepeats() {\r\n    if (this.snapshot || this.templating.list.length === 0) {\r\n      return;\r\n    }\r\n\r\n    this.cleanUpRepeats();\r\n\r\n    this.iteration = (this.iteration || new Date().getTime()) + 1;\r\n\r\n    for (let i = 0; i < this.panels.length; i++) {\r\n      const panel = this.panels[i];\r\n      if (panel.repeat) {\r\n        this.repeatPanel(panel, i);\r\n      }\r\n    }\r\n\r\n    this.sortPanelsByGridPos();\r\n    this.events.emit(CoreEvents.repeatsProcessed);\r\n  }\r\n\r\n  cleanUpRowRepeats(rowPanels: PanelModel[]) {\r\n    const panelsToRemove = [];\r\n    for (let i = 0; i < rowPanels.length; i++) {\r\n      const panel = rowPanels[i];\r\n      if (!panel.repeat && panel.repeatPanelId) {\r\n        panelsToRemove.push(panel);\r\n      }\r\n    }\r\n    _.pull(rowPanels, ...panelsToRemove);\r\n    _.pull(this.panels, ...panelsToRemove);\r\n  }\r\n\r\n  processRowRepeats(row: PanelModel) {\r\n    if (this.snapshot || this.templating.list.length === 0) {\r\n      return;\r\n    }\r\n\r\n    let rowPanels = row.panels;\r\n    if (!row.collapsed) {\r\n      const rowPanelIndex = _.findIndex(this.panels, (p: PanelModel) => p.id === row.id);\r\n      rowPanels = this.getRowPanels(rowPanelIndex);\r\n    }\r\n\r\n    this.cleanUpRowRepeats(rowPanels);\r\n\r\n    for (let i = 0; i < rowPanels.length; i++) {\r\n      const panel = rowPanels[i];\r\n      if (panel.repeat) {\r\n        const panelIndex = _.findIndex(this.panels, (p: PanelModel) => p.id === panel.id);\r\n        this.repeatPanel(panel, panelIndex);\r\n      }\r\n    }\r\n  }\r\n\r\n  getPanelRepeatClone(sourcePanel: PanelModel, valueIndex: number, sourcePanelIndex: number) {\r\n    // if first clone return source\r\n    if (valueIndex === 0) {\r\n      return sourcePanel;\r\n    }\r\n\r\n    const clone = new PanelModel(sourcePanel.getSaveModel());\r\n    clone.id = this.getNextPanelId();\r\n\r\n    // insert after source panel + value index\r\n    this.panels.splice(sourcePanelIndex + valueIndex, 0, clone);\r\n\r\n    clone.repeatIteration = this.iteration;\r\n    clone.repeatPanelId = sourcePanel.id;\r\n    clone.repeat = null;\r\n    return clone;\r\n  }\r\n\r\n  getRowRepeatClone(sourceRowPanel: PanelModel, valueIndex: number, sourcePanelIndex: number) {\r\n    // if first clone return source\r\n    if (valueIndex === 0) {\r\n      if (!sourceRowPanel.collapsed) {\r\n        const rowPanels = this.getRowPanels(sourcePanelIndex);\r\n        sourceRowPanel.panels = rowPanels;\r\n      }\r\n      return sourceRowPanel;\r\n    }\r\n\r\n    const clone = new PanelModel(sourceRowPanel.getSaveModel());\r\n    // for row clones we need to figure out panels under row to clone and where to insert clone\r\n    let rowPanels: PanelModel[], insertPos: number;\r\n    if (sourceRowPanel.collapsed) {\r\n      rowPanels = _.cloneDeep(sourceRowPanel.panels);\r\n      clone.panels = rowPanels;\r\n      // insert copied row after preceding row\r\n      insertPos = sourcePanelIndex + valueIndex;\r\n    } else {\r\n      rowPanels = this.getRowPanels(sourcePanelIndex);\r\n      clone.panels = _.map(rowPanels, (panel: PanelModel) => panel.getSaveModel());\r\n      // insert copied row after preceding row's panels\r\n      insertPos = sourcePanelIndex + (rowPanels.length + 1) * valueIndex;\r\n    }\r\n    this.panels.splice(insertPos, 0, clone);\r\n\r\n    this.updateRepeatedPanelIds(clone);\r\n    return clone;\r\n  }\r\n\r\n  repeatPanel(panel: PanelModel, panelIndex: number) {\r\n    const variable: any = _.find(this.templating.list, { name: panel.repeat } as any);\r\n    if (!variable) {\r\n      return;\r\n    }\r\n\r\n    if (panel.type === 'row') {\r\n      this.repeatRow(panel, panelIndex, variable);\r\n      return;\r\n    }\r\n\r\n    const selectedOptions = this.getSelectedVariableOptions(variable);\r\n    const maxPerRow = panel.maxPerRow || 4;\r\n    let xPos = 0;\r\n    let yPos = panel.gridPos.y;\r\n\r\n    for (let index = 0; index < selectedOptions.length; index++) {\r\n      const option = selectedOptions[index];\r\n      let copy;\r\n\r\n      copy = this.getPanelRepeatClone(panel, index, panelIndex);\r\n      copy.scopedVars = copy.scopedVars || {};\r\n      copy.scopedVars[variable.name] = option;\r\n\r\n      if (panel.repeatDirection === REPEAT_DIR_VERTICAL) {\r\n        if (index > 0) {\r\n          yPos += copy.gridPos.h;\r\n        }\r\n        copy.gridPos.y = yPos;\r\n      } else {\r\n        // set width based on how many are selected\r\n        // assumed the repeated panels should take up full row width\r\n        copy.gridPos.w = Math.max(GRID_COLUMN_COUNT / selectedOptions.length, GRID_COLUMN_COUNT / maxPerRow);\r\n        copy.gridPos.x = xPos;\r\n        copy.gridPos.y = yPos;\r\n\r\n        xPos += copy.gridPos.w;\r\n\r\n        // handle overflow by pushing down one row\r\n        if (xPos + copy.gridPos.w > GRID_COLUMN_COUNT) {\r\n          xPos = 0;\r\n          yPos += copy.gridPos.h;\r\n        }\r\n      }\r\n    }\r\n\r\n    // Update gridPos for panels below\r\n    const yOffset = yPos - panel.gridPos.y;\r\n    if (yOffset > 0) {\r\n      const panelBelowIndex = panelIndex + selectedOptions.length;\r\n      for (let i = panelBelowIndex; i < this.panels.length; i++) {\r\n        this.panels[i].gridPos.y += yOffset;\r\n      }\r\n    }\r\n  }\r\n\r\n  repeatRow(panel: PanelModel, panelIndex: number, variable: any) {\r\n    const selectedOptions = this.getSelectedVariableOptions(variable);\r\n    let yPos = panel.gridPos.y;\r\n\r\n    function setScopedVars(panel: PanelModel, variableOption: any) {\r\n      panel.scopedVars = panel.scopedVars || {};\r\n      panel.scopedVars[variable.name] = variableOption;\r\n    }\r\n\r\n    for (let optionIndex = 0; optionIndex < selectedOptions.length; optionIndex++) {\r\n      const option = selectedOptions[optionIndex];\r\n      const rowCopy = this.getRowRepeatClone(panel, optionIndex, panelIndex);\r\n      setScopedVars(rowCopy, option);\r\n\r\n      const rowHeight = this.getRowHeight(rowCopy);\r\n      const rowPanels = rowCopy.panels || [];\r\n      let panelBelowIndex;\r\n\r\n      if (panel.collapsed) {\r\n        // For collapsed row just copy its panels and set scoped vars and proper IDs\r\n        _.each(rowPanels, (rowPanel: PanelModel, i: number) => {\r\n          setScopedVars(rowPanel, option);\r\n          if (optionIndex > 0) {\r\n            this.updateRepeatedPanelIds(rowPanel, true);\r\n          }\r\n        });\r\n        rowCopy.gridPos.y += optionIndex;\r\n        yPos += optionIndex;\r\n        panelBelowIndex = panelIndex + optionIndex + 1;\r\n      } else {\r\n        // insert after 'row' panel\r\n        const insertPos = panelIndex + (rowPanels.length + 1) * optionIndex + 1;\r\n        _.each(rowPanels, (rowPanel: PanelModel, i: number) => {\r\n          setScopedVars(rowPanel, option);\r\n          if (optionIndex > 0) {\r\n            const cloneRowPanel = new PanelModel(rowPanel);\r\n            this.updateRepeatedPanelIds(cloneRowPanel, true);\r\n            // For exposed row additionally set proper Y grid position and add it to dashboard panels\r\n            cloneRowPanel.gridPos.y += rowHeight * optionIndex;\r\n            this.panels.splice(insertPos + i, 0, cloneRowPanel);\r\n          }\r\n        });\r\n        rowCopy.panels = [];\r\n        rowCopy.gridPos.y += rowHeight * optionIndex;\r\n        yPos += rowHeight;\r\n        panelBelowIndex = insertPos + rowPanels.length;\r\n      }\r\n\r\n      // Update gridPos for panels below\r\n      for (let i = panelBelowIndex; i < this.panels.length; i++) {\r\n        this.panels[i].gridPos.y += yPos;\r\n      }\r\n    }\r\n  }\r\n\r\n  updateRepeatedPanelIds(panel: PanelModel, repeatedByRow?: boolean) {\r\n    panel.repeatPanelId = panel.id;\r\n    panel.id = this.getNextPanelId();\r\n    panel.repeatIteration = this.iteration;\r\n    if (repeatedByRow) {\r\n      panel.repeatedByRow = true;\r\n    } else {\r\n      panel.repeat = null;\r\n    }\r\n    return panel;\r\n  }\r\n\r\n  getSelectedVariableOptions(variable: any) {\r\n    let selectedOptions: any[];\r\n    if (variable.current.text === 'All') {\r\n      selectedOptions = variable.options.slice(1, variable.options.length);\r\n    } else {\r\n      selectedOptions = _.filter(variable.options, { selected: true });\r\n    }\r\n    return selectedOptions;\r\n  }\r\n\r\n  getRowHeight(rowPanel: PanelModel): number {\r\n    if (!rowPanel.panels || rowPanel.panels.length === 0) {\r\n      return 0;\r\n    }\r\n    const rowYPos = rowPanel.gridPos.y;\r\n    const positions = _.map(rowPanel.panels, 'gridPos');\r\n    const maxPos = _.maxBy(positions, (pos: GridPos) => {\r\n      return pos.y + pos.h;\r\n    });\r\n    return maxPos.y + maxPos.h - rowYPos;\r\n  }\r\n\r\n  removePanel(panel: PanelModel) {\r\n    const index = _.indexOf(this.panels, panel);\r\n    this.panels.splice(index, 1);\r\n    this.events.emit(panelRemoved, panel);\r\n  }\r\n\r\n  removeRow(row: PanelModel, removePanels: boolean) {\r\n    const needToogle = (!removePanels && row.collapsed) || (removePanels && !row.collapsed);\r\n\r\n    if (needToogle) {\r\n      this.toggleRow(row);\r\n    }\r\n\r\n    this.removePanel(row);\r\n  }\r\n\r\n  expandRows() {\r\n    for (let i = 0; i < this.panels.length; i++) {\r\n      const panel = this.panels[i];\r\n\r\n      if (panel.type !== 'row') {\r\n        continue;\r\n      }\r\n\r\n      if (panel.collapsed) {\r\n        this.toggleRow(panel);\r\n      }\r\n    }\r\n  }\r\n\r\n  collapseRows() {\r\n    for (let i = 0; i < this.panels.length; i++) {\r\n      const panel = this.panels[i];\r\n\r\n      if (panel.type !== 'row') {\r\n        continue;\r\n      }\r\n\r\n      if (!panel.collapsed) {\r\n        this.toggleRow(panel);\r\n      }\r\n    }\r\n  }\r\n\r\n  setPanelFocus(id: number) {\r\n    this.meta.focusPanelId = id;\r\n  }\r\n\r\n  updateSubmenuVisibility() {\r\n    this.meta.submenuEnabled = (() => {\r\n      if (this.links.length > 0) {\r\n        return true;\r\n      }\r\n\r\n      const visibleVars = _.filter(this.templating.list, (variable: any) => variable.hide !== 2);\r\n      if (visibleVars.length > 0) {\r\n        return true;\r\n      }\r\n\r\n      const visibleAnnotations = _.filter(this.annotations.list, (annotation: any) => annotation.hide !== true);\r\n      if (visibleAnnotations.length > 0) {\r\n        return true;\r\n      }\r\n\r\n      return false;\r\n    })();\r\n    this.events.emit(CoreEvents.submenuVisibilityChanged, this.meta.submenuEnabled);\r\n  }\r\n\r\n  getPanelInfoById(panelId: number) {\r\n    for (let i = 0; i < this.panels.length; i++) {\r\n      if (this.panels[i].id === panelId) {\r\n        return {\r\n          panel: this.panels[i],\r\n          index: i,\r\n        };\r\n      }\r\n    }\r\n\r\n    return null;\r\n  }\r\n\r\n  duplicatePanel(panel: PanelModel) {\r\n    const newPanel = panel.getSaveModel();\r\n    newPanel.id = this.getNextPanelId();\r\n\r\n    delete newPanel.repeat;\r\n    delete newPanel.repeatIteration;\r\n    delete newPanel.repeatPanelId;\r\n    delete newPanel.scopedVars;\r\n    if (newPanel.alert) {\r\n      delete newPanel.thresholds;\r\n    }\r\n    delete newPanel.alert;\r\n\r\n    // does it fit to the right?\r\n    if (panel.gridPos.x + panel.gridPos.w * 2 <= GRID_COLUMN_COUNT) {\r\n      newPanel.gridPos.x += panel.gridPos.w;\r\n    } else {\r\n      // add below\r\n      newPanel.gridPos.y += panel.gridPos.h;\r\n    }\r\n\r\n    this.addPanel(newPanel);\r\n    return newPanel;\r\n  }\r\n\r\n  formatDate(date: DateTimeInput, format?: string) {\r\n    date = isDateTime(date) ? date : dateTime(date);\r\n    format = format || 'YYYY-MM-DD HH:mm:ss';\r\n    const timezone = this.getTimezone();\r\n\r\n    return timezone === 'browser' ? dateTime(date).format(format) : toUtc(date).format(format);\r\n  }\r\n\r\n  destroy() {\r\n    this.events.removeAllListeners();\r\n    for (const panel of this.panels) {\r\n      panel.destroy();\r\n    }\r\n  }\r\n\r\n  toggleRow(row: PanelModel) {\r\n    const rowIndex = _.indexOf(this.panels, row);\r\n\r\n    if (row.collapsed) {\r\n      row.collapsed = false;\r\n      const hasRepeat = _.some(row.panels as PanelModel[], (p: PanelModel) => p.repeat);\r\n\r\n      if (row.panels.length > 0) {\r\n        // Use first panel to figure out if it was moved or pushed\r\n        const firstPanel = row.panels[0];\r\n        const yDiff = firstPanel.gridPos.y - (row.gridPos.y + row.gridPos.h);\r\n\r\n        // start inserting after row\r\n        let insertPos = rowIndex + 1;\r\n        // y max will represent the bottom y pos after all panels have been added\r\n        // needed to know home much panels below should be pushed down\r\n        let yMax = row.gridPos.y;\r\n\r\n        for (const panel of row.panels) {\r\n          // make sure y is adjusted (in case row moved while collapsed)\r\n          // console.log('yDiff', yDiff);\r\n          panel.gridPos.y -= yDiff;\r\n          // insert after row\r\n          this.panels.splice(insertPos, 0, new PanelModel(panel));\r\n          // update insert post and y max\r\n          insertPos += 1;\r\n          yMax = Math.max(yMax, panel.gridPos.y + panel.gridPos.h);\r\n        }\r\n\r\n        const pushDownAmount = yMax - row.gridPos.y - 1;\r\n\r\n        // push panels below down\r\n        for (let panelIndex = insertPos; panelIndex < this.panels.length; panelIndex++) {\r\n          this.panels[panelIndex].gridPos.y += pushDownAmount;\r\n        }\r\n\r\n        row.panels = [];\r\n\r\n        if (hasRepeat) {\r\n          this.processRowRepeats(row);\r\n        }\r\n      }\r\n\r\n      // sort panels\r\n      this.sortPanelsByGridPos();\r\n\r\n      // emit change event\r\n      this.events.emit(CoreEvents.rowExpanded);\r\n      return;\r\n    }\r\n\r\n    const rowPanels = this.getRowPanels(rowIndex);\r\n\r\n    // remove panels\r\n    _.pull(this.panels, ...rowPanels);\r\n    // save panel models inside row panel\r\n    row.panels = _.map(rowPanels, (panel: PanelModel) => panel.getSaveModel());\r\n    row.collapsed = true;\r\n\r\n    // emit change event\r\n    this.events.emit(CoreEvents.rowCollapsed);\r\n  }\r\n\r\n  /**\r\n   * Will return all panels after rowIndex until it encounters another row\r\n   */\r\n  getRowPanels(rowIndex: number): PanelModel[] {\r\n    const rowPanels = [];\r\n\r\n    for (let index = rowIndex + 1; index < this.panels.length; index++) {\r\n      const panel = this.panels[index];\r\n\r\n      // break when encountering another row\r\n      if (panel.type === 'row') {\r\n        break;\r\n      }\r\n\r\n      // this panel must belong to row\r\n      rowPanels.push(panel);\r\n    }\r\n\r\n    return rowPanels;\r\n  }\r\n\r\n  on<T>(event: AppEvent<T>, callback: (payload?: T) => void) {\r\n    this.events.on(event, callback);\r\n  }\r\n\r\n  off<T>(event: AppEvent<T>, callback?: (payload?: T) => void) {\r\n    this.events.off(event, callback);\r\n  }\r\n\r\n  cycleGraphTooltip() {\r\n    this.graphTooltip = (this.graphTooltip + 1) % 3;\r\n  }\r\n\r\n  sharedTooltipModeEnabled() {\r\n    return this.graphTooltip > 0;\r\n  }\r\n\r\n  sharedCrosshairModeOnly() {\r\n    return this.graphTooltip === 1;\r\n  }\r\n\r\n  getRelativeTime(date: DateTimeInput) {\r\n    date = isDateTime(date) ? date : dateTime(date);\r\n\r\n    return this.timezone === 'browser' ? dateTime(date).fromNow() : toUtc(date).fromNow();\r\n  }\r\n\r\n  isTimezoneUtc() {\r\n    return this.getTimezone() === 'utc';\r\n  }\r\n\r\n  isSnapshot() {\r\n    return this.snapshot !== undefined;\r\n  }\r\n\r\n  getTimezone(): TimeZone {\r\n    return (this.timezone ? this.timezone : contextSrv.user.timezone) as TimeZone;\r\n  }\r\n\r\n  private updateSchema(old: any) {\r\n    const migrator = new DashboardMigrator(this);\r\n    migrator.updateSchema(old);\r\n  }\r\n\r\n  resetOriginalTime() {\r\n    this.originalTime = _.cloneDeep(this.time);\r\n  }\r\n\r\n  hasTimeChanged() {\r\n    return !_.isEqual(this.time, this.originalTime);\r\n  }\r\n\r\n  resetOriginalVariables() {\r\n    this.originalTemplating = _.map(this.templating.list, (variable: any) => {\r\n      return {\r\n        name: variable.name,\r\n        type: variable.type,\r\n        current: _.cloneDeep(variable.current),\r\n        filters: _.cloneDeep(variable.filters),\r\n      };\r\n    });\r\n  }\r\n\r\n  hasVariableValuesChanged() {\r\n    if (this.templating.list.length !== this.originalTemplating.length) {\r\n      return false;\r\n    }\r\n\r\n    const updated = _.map(this.templating.list, (variable: any) => {\r\n      return {\r\n        name: variable.name,\r\n        type: variable.type,\r\n        current: _.cloneDeep(variable.current),\r\n        filters: _.cloneDeep(variable.filters),\r\n      };\r\n    });\r\n\r\n    return !_.isEqual(updated, this.originalTemplating);\r\n  }\r\n\r\n  autoFitPanels(viewHeight: number, kioskMode?: UrlQueryValue) {\r\n    const currentGridHeight = Math.max(\r\n      ...this.panels.map(panel => {\r\n        return panel.gridPos.h + panel.gridPos.y;\r\n      })\r\n    );\r\n\r\n    const navbarHeight = 55;\r\n    const margin = 20;\r\n    const submenuHeight = 50;\r\n\r\n    let visibleHeight = viewHeight - navbarHeight - margin;\r\n\r\n    // Remove submenu height if visible\r\n    if (this.meta.submenuEnabled && !kioskMode) {\r\n      visibleHeight -= submenuHeight;\r\n    }\r\n\r\n    // add back navbar height\r\n    if (kioskMode && kioskMode !== KIOSK_MODE_TV) {\r\n      visibleHeight += navbarHeight;\r\n    }\r\n\r\n    const visibleGridHeight = Math.floor(visibleHeight / (GRID_CELL_HEIGHT + GRID_CELL_VMARGIN));\r\n    const scaleFactor = currentGridHeight / visibleGridHeight;\r\n\r\n    this.panels.forEach((panel, i) => {\r\n      panel.gridPos.y = Math.round(panel.gridPos.y / scaleFactor) || 1;\r\n      panel.gridPos.h = Math.round(panel.gridPos.h / scaleFactor) || 1;\r\n    });\r\n  }\r\n\r\n  templateVariableValueUpdated() {\r\n    this.processRepeats();\r\n    this.events.emit(CoreEvents.templateVariableValueUpdated);\r\n  }\r\n\r\n  expandParentRowFor(panelId: number) {\r\n    for (const panel of this.panels) {\r\n      if (panel.collapsed) {\r\n        for (const rowPanel of panel.panels) {\r\n          if (rowPanel.id === panelId) {\r\n            this.toggleRow(panel);\r\n            return;\r\n          }\r\n        }\r\n      }\r\n    }\r\n  }\r\n\r\n  toggleLegendsForAll() {\r\n    const panelsWithLegends = this.panels.filter(panel => {\r\n      return panel.legend !== undefined && panel.legend !== null;\r\n    });\r\n\r\n    // determine if more panels are displaying legends or not\r\n    const onCount = panelsWithLegends.filter(panel => panel.legend.show).length;\r\n    const offCount = panelsWithLegends.length - onCount;\r\n    const panelLegendsOn = onCount >= offCount;\r\n\r\n    for (const panel of panelsWithLegends) {\r\n      panel.legend.show = !panelLegendsOn;\r\n      panel.render();\r\n    }\r\n  }\r\n}\r\n","// Libraries\r\nimport _ from 'lodash';\r\n// Utils\r\nimport { Emitter } from 'app/core/utils/emitter';\r\nimport { getNextRefIdChar } from 'app/core/utils/query';\r\n// Types\r\nimport {\r\n  DataQuery,\r\n  DataQueryResponseData,\r\n  PanelPlugin,\r\n  PanelEvents,\r\n  DataLink,\r\n  DataTransformerConfig,\r\n  ScopedVars,\r\n} from '@grafana/data';\r\n\r\nimport config from 'app/core/config';\r\n\r\nimport { PanelQueryRunner } from './PanelQueryRunner';\r\nimport { eventFactory } from '@grafana/data';\r\n\r\nexport const panelAdded = eventFactory<PanelModel | undefined>('panel-added');\r\nexport const panelRemoved = eventFactory<PanelModel | undefined>('panel-removed');\r\n\r\nexport interface GridPos {\r\n  x: number;\r\n  y: number;\r\n  w: number;\r\n  h: number;\r\n  static?: boolean;\r\n}\r\n\r\nconst notPersistedProperties: { [str: string]: boolean } = {\r\n  events: true,\r\n  fullscreen: true,\r\n  isEditing: true,\r\n  isInView: true,\r\n  isNewEdit: true,\r\n  hasRefreshed: true,\r\n  cachedPluginOptions: true,\r\n  plugin: true,\r\n  queryRunner: true,\r\n};\r\n\r\n// For angular panels we need to clean up properties when changing type\r\n// To make sure the change happens without strange bugs happening when panels use same\r\n// named property with different type / value expectations\r\n// This is not required for react panels\r\nconst mustKeepProps: { [str: string]: boolean } = {\r\n  id: true,\r\n  gridPos: true,\r\n  type: true,\r\n  title: true,\r\n  scopedVars: true,\r\n  repeat: true,\r\n  repeatIteration: true,\r\n  repeatPanelId: true,\r\n  repeatDirection: true,\r\n  repeatedByRow: true,\r\n  minSpan: true,\r\n  collapsed: true,\r\n  panels: true,\r\n  targets: true,\r\n  datasource: true,\r\n  timeFrom: true,\r\n  timeShift: true,\r\n  hideTimeOverride: true,\r\n  description: true,\r\n  links: true,\r\n  fullscreen: true,\r\n  isEditing: true,\r\n  hasRefreshed: true,\r\n  events: true,\r\n  cacheTimeout: true,\r\n  cachedPluginOptions: true,\r\n  transparent: true,\r\n  pluginVersion: true,\r\n  queryRunner: true,\r\n  transformations: true,\r\n};\r\n\r\nconst defaults: any = {\r\n  gridPos: { x: 0, y: 0, h: 3, w: 6 },\r\n  targets: [{ refId: 'A' }],\r\n  cachedPluginOptions: {},\r\n  transparent: false,\r\n};\r\n\r\nexport class PanelModel {\r\n  id: number;\r\n  gridPos: GridPos;\r\n  type: string;\r\n  title: string;\r\n  alert?: any;\r\n  scopedVars?: ScopedVars;\r\n  repeat?: string;\r\n  repeatIteration?: number;\r\n  repeatPanelId?: number;\r\n  repeatDirection?: string;\r\n  repeatedByRow?: boolean;\r\n  maxPerRow?: number;\r\n  collapsed?: boolean;\r\n  panels?: any;\r\n  soloMode?: boolean;\r\n  targets: DataQuery[];\r\n  transformations?: DataTransformerConfig[];\r\n  datasource: string;\r\n  thresholds?: any;\r\n  pluginVersion?: string;\r\n\r\n  snapshotData?: DataQueryResponseData[];\r\n  timeFrom?: any;\r\n  timeShift?: any;\r\n  hideTimeOverride?: any;\r\n  options: {\r\n    [key: string]: any;\r\n  };\r\n\r\n  maxDataPoints?: number;\r\n  interval?: string;\r\n  description?: string;\r\n  links?: DataLink[];\r\n  transparent: boolean;\r\n\r\n  // non persisted\r\n  fullscreen: boolean;\r\n  isEditing: boolean;\r\n  isInView: boolean;\r\n  isNewEdit: boolean;\r\n  hasRefreshed: boolean;\r\n  events: Emitter;\r\n  cacheTimeout?: any;\r\n  cachedPluginOptions?: any;\r\n  legend?: { show: boolean };\r\n  plugin?: PanelPlugin;\r\n  private queryRunner?: PanelQueryRunner;\r\n\r\n  constructor(model: any) {\r\n    this.events = new Emitter();\r\n\r\n    // should not be part of defaults as defaults are removed in save model and\r\n    // this should not be removed in save model as exporter needs to templatize it\r\n    this.datasource = null;\r\n\r\n    // copy properties from persisted model\r\n    for (const property in model) {\r\n      (this as any)[property] = model[property];\r\n    }\r\n\r\n    // defaults\r\n    _.defaultsDeep(this, _.cloneDeep(defaults));\r\n\r\n    // queries must have refId\r\n    this.ensureQueryIds();\r\n  }\r\n\r\n  ensureQueryIds() {\r\n    if (this.targets && _.isArray(this.targets)) {\r\n      for (const query of this.targets) {\r\n        if (!query.refId) {\r\n          query.refId = getNextRefIdChar(this.targets);\r\n        }\r\n      }\r\n    }\r\n  }\r\n\r\n  getOptions() {\r\n    return this.options;\r\n  }\r\n\r\n  updateOptions(options: object) {\r\n    this.options = options;\r\n    this.render();\r\n  }\r\n\r\n  getSaveModel() {\r\n    const model: any = {};\r\n    for (const property in this) {\r\n      if (notPersistedProperties[property] || !this.hasOwnProperty(property)) {\r\n        continue;\r\n      }\r\n\r\n      if (_.isEqual(this[property], defaults[property])) {\r\n        continue;\r\n      }\r\n\r\n      model[property] = _.cloneDeep(this[property]);\r\n    }\r\n    return model;\r\n  }\r\n\r\n  setViewMode(fullscreen: boolean, isEditing: boolean) {\r\n    this.fullscreen = fullscreen;\r\n    this.isEditing = isEditing;\r\n    this.events.emit(PanelEvents.viewModeChanged);\r\n  }\r\n\r\n  updateGridPos(newPos: GridPos) {\r\n    let sizeChanged = false;\r\n\r\n    if (this.gridPos.w !== newPos.w || this.gridPos.h !== newPos.h) {\r\n      sizeChanged = true;\r\n    }\r\n\r\n    this.gridPos.x = newPos.x;\r\n    this.gridPos.y = newPos.y;\r\n    this.gridPos.w = newPos.w;\r\n    this.gridPos.h = newPos.h;\r\n\r\n    if (sizeChanged) {\r\n      this.events.emit(PanelEvents.panelSizeChanged);\r\n    }\r\n  }\r\n\r\n  resizeDone() {\r\n    this.events.emit(PanelEvents.panelSizeChanged);\r\n  }\r\n\r\n  refresh() {\r\n    this.hasRefreshed = true;\r\n    this.events.emit(PanelEvents.refresh);\r\n  }\r\n\r\n  render() {\r\n    if (!this.hasRefreshed) {\r\n      this.refresh();\r\n    } else {\r\n      this.events.emit(PanelEvents.render);\r\n    }\r\n  }\r\n\r\n  initialized() {\r\n    this.events.emit(PanelEvents.panelInitialized);\r\n  }\r\n\r\n  private getOptionsToRemember() {\r\n    return Object.keys(this).reduce((acc, property) => {\r\n      if (notPersistedProperties[property] || mustKeepProps[property]) {\r\n        return acc;\r\n      }\r\n      return {\r\n        ...acc,\r\n        [property]: (this as any)[property],\r\n      };\r\n    }, {});\r\n  }\r\n\r\n  private restorePanelOptions(pluginId: string) {\r\n    const prevOptions = this.cachedPluginOptions[pluginId] || {};\r\n\r\n    Object.keys(prevOptions).map(property => {\r\n      (this as any)[property] = prevOptions[property];\r\n    });\r\n  }\r\n\r\n  private applyPluginOptionDefaults(plugin: PanelPlugin) {\r\n    if (plugin.angularConfigCtrl) {\r\n      return;\r\n    }\r\n    this.options = _.mergeWith({}, plugin.defaults, this.options || {}, (objValue: any, srcValue: any): any => {\r\n      if (_.isArray(srcValue)) {\r\n        return srcValue;\r\n      }\r\n    });\r\n  }\r\n\r\n  pluginLoaded(plugin: PanelPlugin) {\r\n    this.plugin = plugin;\r\n\r\n    if (plugin.panel && plugin.onPanelMigration) {\r\n      const version = getPluginVersion(plugin);\r\n      if (version !== this.pluginVersion) {\r\n        this.options = plugin.onPanelMigration(this);\r\n        this.pluginVersion = version;\r\n      }\r\n    }\r\n\r\n    this.applyPluginOptionDefaults(plugin);\r\n  }\r\n\r\n  changePlugin(newPlugin: PanelPlugin) {\r\n    const pluginId = newPlugin.meta.id;\r\n    const oldOptions: any = this.getOptionsToRemember();\r\n    const oldPluginId = this.type;\r\n    const wasAngular = !!this.plugin.angularPanelCtrl;\r\n\r\n    // for angular panels we must remove all events and let angular panels do some cleanup\r\n    if (wasAngular) {\r\n      this.destroy();\r\n    }\r\n\r\n    // remove panel type specific  options\r\n    for (const key of _.keys(this)) {\r\n      if (mustKeepProps[key]) {\r\n        continue;\r\n      }\r\n\r\n      delete (this as any)[key];\r\n    }\r\n\r\n    this.cachedPluginOptions[oldPluginId] = oldOptions;\r\n    this.restorePanelOptions(pluginId);\r\n\r\n    // Let panel plugins inspect options from previous panel and keep any that it can use\r\n    if (newPlugin.onPanelTypeChanged) {\r\n      let old: any = {};\r\n\r\n      if (wasAngular) {\r\n        old = { angular: oldOptions };\r\n      } else if (oldOptions && oldOptions.options) {\r\n        old = oldOptions.options;\r\n      }\r\n      this.options = this.options || {};\r\n      Object.assign(this.options, newPlugin.onPanelTypeChanged(this.options, oldPluginId, old));\r\n    }\r\n\r\n    // switch\r\n    this.type = pluginId;\r\n    this.plugin = newPlugin;\r\n    this.applyPluginOptionDefaults(newPlugin);\r\n\r\n    if (newPlugin.onPanelMigration) {\r\n      this.pluginVersion = getPluginVersion(newPlugin);\r\n    }\r\n  }\r\n\r\n  addQuery(query?: Partial<DataQuery>) {\r\n    query = query || { refId: 'A' };\r\n    query.refId = getNextRefIdChar(this.targets);\r\n    this.targets.push(query as DataQuery);\r\n  }\r\n\r\n  changeQuery(query: DataQuery, index: number) {\r\n    // ensure refId is maintained\r\n    query.refId = this.targets[index].refId;\r\n\r\n    // update query in array\r\n    this.targets = this.targets.map((item, itemIndex) => {\r\n      if (itemIndex === index) {\r\n        return query;\r\n      }\r\n      return item;\r\n    });\r\n  }\r\n\r\n  getQueryRunner(): PanelQueryRunner {\r\n    if (!this.queryRunner) {\r\n      this.queryRunner = new PanelQueryRunner();\r\n      this.setTransformations(this.transformations);\r\n    }\r\n    return this.queryRunner;\r\n  }\r\n\r\n  hasTitle() {\r\n    return this.title && this.title.length > 0;\r\n  }\r\n\r\n  isAngularPlugin(): boolean {\r\n    return this.plugin && !!this.plugin.angularPanelCtrl;\r\n  }\r\n\r\n  destroy() {\r\n    this.events.emit(PanelEvents.panelTeardown);\r\n    this.events.removeAllListeners();\r\n\r\n    if (this.queryRunner) {\r\n      this.queryRunner.destroy();\r\n      this.queryRunner = null;\r\n    }\r\n  }\r\n\r\n  setTransformations(transformations: DataTransformerConfig[]) {\r\n    this.transformations = transformations;\r\n    this.getQueryRunner().setTransformations(transformations);\r\n  }\r\n}\r\n\r\nfunction getPluginVersion(plugin: PanelPlugin): string {\r\n  return plugin && plugin.meta.info.version ? plugin.meta.info.version : config.buildInfo.version;\r\n}\r\n","// Libraries\r\nimport { cloneDeep } from 'lodash';\r\nimport { ReplaySubject, Unsubscribable, Observable } from 'rxjs';\r\nimport { map } from 'rxjs/operators';\r\n\r\n// Services & Utils\r\nimport { config } from 'app/core/config';\r\nimport { getDatasourceSrv } from 'app/features/plugins/datasource_srv';\r\nimport kbn from 'app/core/utils/kbn';\r\nimport templateSrv from 'app/features/templating/template_srv';\r\nimport { runRequest, preProcessPanelData } from './runRequest';\r\nimport { runSharedRequest, isSharedDashboardQuery } from '../../../plugins/datasource/dashboard';\r\n\r\n// Types\r\nimport {\r\n  PanelData,\r\n  DataQuery,\r\n  CoreApp,\r\n  DataQueryRequest,\r\n  DataSourceApi,\r\n  DataSourceJsonData,\r\n  TimeRange,\r\n  DataTransformerConfig,\r\n  transformDataFrame,\r\n  ScopedVars,\r\n} from '@grafana/data';\r\n\r\nexport interface QueryRunnerOptions<\r\n  TQuery extends DataQuery = DataQuery,\r\n  TOptions extends DataSourceJsonData = DataSourceJsonData\r\n> {\r\n  datasource: string | DataSourceApi<TQuery, TOptions>;\r\n  queries: TQuery[];\r\n  panelId: number;\r\n  dashboardId?: number;\r\n  timezone?: string;\r\n  timeRange: TimeRange;\r\n  timeInfo?: string; // String description of time range for display\r\n  widthPixels: number;\r\n  maxDataPoints: number | undefined | null;\r\n  minInterval: string | undefined | null;\r\n  scopedVars?: ScopedVars;\r\n  cacheTimeout?: string;\r\n  delayStateNotification?: number; // default 100ms.\r\n  transformations?: DataTransformerConfig[];\r\n}\r\n\r\nlet counter = 100;\r\nfunction getNextRequestId() {\r\n  return 'Q' + counter++;\r\n}\r\n\r\nexport class PanelQueryRunner {\r\n  private subject?: ReplaySubject<PanelData>;\r\n  private subscription?: Unsubscribable;\r\n  private transformations?: DataTransformerConfig[];\r\n  private lastResult?: PanelData;\r\n\r\n  constructor() {\r\n    this.subject = new ReplaySubject(1);\r\n  }\r\n\r\n  /**\r\n   * Returns an observable that subscribes to the shared multi-cast subject (that reply last result).\r\n   */\r\n  getData(transform = true): Observable<PanelData> {\r\n    if (transform) {\r\n      return this.subject.pipe(\r\n        map((data: PanelData) => {\r\n          if (this.hasTransformations()) {\r\n            const newSeries = transformDataFrame(this.transformations, data.series);\r\n            return { ...data, series: newSeries };\r\n          }\r\n          return data;\r\n        })\r\n      );\r\n    }\r\n\r\n    // Just pass it directly\r\n    return this.subject.pipe();\r\n  }\r\n\r\n  hasTransformations() {\r\n    return config.featureToggles.transformations && this.transformations && this.transformations.length > 0;\r\n  }\r\n\r\n  async run(options: QueryRunnerOptions) {\r\n    const {\r\n      queries,\r\n      timezone,\r\n      datasource,\r\n      panelId,\r\n      dashboardId,\r\n      timeRange,\r\n      timeInfo,\r\n      cacheTimeout,\r\n      widthPixels,\r\n      maxDataPoints,\r\n      scopedVars,\r\n      minInterval,\r\n      // delayStateNotification,\r\n    } = options;\r\n\r\n    if (isSharedDashboardQuery(datasource)) {\r\n      this.pipeToSubject(runSharedRequest(options));\r\n      return;\r\n    }\r\n\r\n    const request: DataQueryRequest = {\r\n      app: CoreApp.Dashboard,\r\n      requestId: getNextRequestId(),\r\n      timezone,\r\n      panelId,\r\n      dashboardId,\r\n      range: timeRange,\r\n      timeInfo,\r\n      interval: '',\r\n      intervalMs: 0,\r\n      targets: cloneDeep(queries),\r\n      maxDataPoints: maxDataPoints || widthPixels,\r\n      scopedVars: scopedVars || {},\r\n      cacheTimeout,\r\n      startTime: Date.now(),\r\n    };\r\n\r\n    // Add deprecated property\r\n    (request as any).rangeRaw = timeRange.raw;\r\n\r\n    try {\r\n      const ds = await getDataSource(datasource, request.scopedVars);\r\n\r\n      // Attach the datasource name to each query\r\n      request.targets = request.targets.map(query => {\r\n        if (!query.datasource) {\r\n          query.datasource = ds.name;\r\n        }\r\n        return query;\r\n      });\r\n\r\n      const lowerIntervalLimit = minInterval ? templateSrv.replace(minInterval, request.scopedVars) : ds.interval;\r\n      const norm = kbn.calculateInterval(timeRange, widthPixels, lowerIntervalLimit);\r\n\r\n      // make shallow copy of scoped vars,\r\n      // and add built in variables interval and interval_ms\r\n      request.scopedVars = Object.assign({}, request.scopedVars, {\r\n        __interval: { text: norm.interval, value: norm.interval },\r\n        __interval_ms: { text: norm.intervalMs.toString(), value: norm.intervalMs },\r\n      });\r\n\r\n      request.interval = norm.interval;\r\n      request.intervalMs = norm.intervalMs;\r\n\r\n      this.pipeToSubject(runRequest(ds, request));\r\n    } catch (err) {\r\n      console.log('PanelQueryRunner Error', err);\r\n    }\r\n  }\r\n\r\n  private pipeToSubject(observable: Observable<PanelData>) {\r\n    if (this.subscription) {\r\n      this.subscription.unsubscribe();\r\n    }\r\n\r\n    this.subscription = observable.subscribe({\r\n      next: (data: PanelData) => {\r\n        this.lastResult = preProcessPanelData(data, this.lastResult);\r\n        this.subject.next(this.lastResult);\r\n      },\r\n    });\r\n  }\r\n\r\n  setTransformations(transformations?: DataTransformerConfig[]) {\r\n    this.transformations = transformations;\r\n  }\r\n\r\n  /**\r\n   * Called when the panel is closed\r\n   */\r\n  destroy() {\r\n    // Tell anyone listening that we are done\r\n    if (this.subject) {\r\n      this.subject.complete();\r\n    }\r\n\r\n    if (this.subscription) {\r\n      this.subscription.unsubscribe();\r\n    }\r\n  }\r\n}\r\n\r\nasync function getDataSource(\r\n  datasource: string | DataSourceApi | null,\r\n  scopedVars: ScopedVars\r\n): Promise<DataSourceApi> {\r\n  if (datasource && (datasource as any).query) {\r\n    return datasource as DataSourceApi;\r\n  }\r\n  return await getDatasourceSrv().get(datasource as string, scopedVars);\r\n}\r\n","// Services & Utils\r\nimport { createAction } from '@reduxjs/toolkit';\r\nimport { getBackendSrv } from '@grafana/runtime';\r\nimport { createSuccessNotification } from 'app/core/copy/appNotification';\r\n// Actions\r\nimport { loadPluginDashboards } from '../../plugins/state/actions';\r\nimport { notifyApp } from 'app/core/actions';\r\n// Types\r\nimport {\r\n  DashboardAcl,\r\n  DashboardAclDTO,\r\n  DashboardAclUpdateDTO,\r\n  DashboardInitError,\r\n  MutableDashboard,\r\n  NewDashboardAclItem,\r\n  PermissionLevel,\r\n  ThunkResult,\r\n} from 'app/types';\r\nimport { DataQuery } from '@grafana/data';\r\n\r\nexport const loadDashboardPermissions = createAction<DashboardAclDTO[]>('dashboard/loadDashboardPermissions');\r\n\r\nexport const dashboardInitFetching = createAction('dashboard/dashboardInitFetching');\r\n\r\nexport const dashboardInitServices = createAction('dashboard/dashboardInitServices');\r\n\r\nexport const dashboardInitSlow = createAction('dashboard/dashboardInitSlow');\r\n\r\nexport const dashboardInitCompleted = createAction<MutableDashboard>('dashboard/dashboardInitCompleted');\r\n\r\n/*\r\n * Unrecoverable init failure (fetch or model creation failed)\r\n */\r\nexport const dashboardInitFailed = createAction<DashboardInitError>('dashboard/dashboardInitFailed');\r\n\r\n/*\r\n * When leaving dashboard, resets state\r\n * */\r\nexport const cleanUpDashboard = createAction('dashboard/cleanUpDashboard');\r\n\r\nexport function getDashboardPermissions(id: number): ThunkResult<void> {\r\n  return async dispatch => {\r\n    const permissions = await getBackendSrv().get(`/api/dashboards/id/${id}/permissions`);\r\n    dispatch(loadDashboardPermissions(permissions));\r\n  };\r\n}\r\n\r\nfunction toUpdateItem(item: DashboardAcl): DashboardAclUpdateDTO {\r\n  return {\r\n    userId: item.userId,\r\n    teamId: item.teamId,\r\n    role: item.role,\r\n    permission: item.permission,\r\n  };\r\n}\r\n\r\ninterface SetDashboardQueriesToUpdatePayload {\r\n  panelId: number;\r\n  queries: DataQuery[];\r\n}\r\n\r\nexport const clearDashboardQueriesToUpdate = createAction('dashboard/clearDashboardQueriesToUpdate');\r\nexport const setDashboardQueriesToUpdate = createAction<SetDashboardQueriesToUpdatePayload>(\r\n  'dashboard/setDashboardQueriesToUpdate'\r\n);\r\nexport const setDashboardQueriesToUpdateOnLoad = (panelId: number, queries: DataQuery[]): ThunkResult<void> => {\r\n  return async dispatch => {\r\n    await dispatch(setDashboardQueriesToUpdate({ panelId, queries }));\r\n  };\r\n};\r\n\r\nexport function updateDashboardPermission(\r\n  dashboardId: number,\r\n  itemToUpdate: DashboardAcl,\r\n  level: PermissionLevel\r\n): ThunkResult<void> {\r\n  return async (dispatch, getStore) => {\r\n    const { dashboard } = getStore();\r\n    const itemsToUpdate = [];\r\n\r\n    for (const item of dashboard.permissions) {\r\n      if (item.inherited) {\r\n        continue;\r\n      }\r\n\r\n      const updated = toUpdateItem(item);\r\n\r\n      // if this is the item we want to update, update it's permission\r\n      if (itemToUpdate === item) {\r\n        updated.permission = level;\r\n      }\r\n\r\n      itemsToUpdate.push(updated);\r\n    }\r\n\r\n    await getBackendSrv().post(`/api/dashboards/id/${dashboardId}/permissions`, { items: itemsToUpdate });\r\n    await dispatch(getDashboardPermissions(dashboardId));\r\n  };\r\n}\r\n\r\nexport function removeDashboardPermission(dashboardId: number, itemToDelete: DashboardAcl): ThunkResult<void> {\r\n  return async (dispatch, getStore) => {\r\n    const dashboard = getStore().dashboard;\r\n    const itemsToUpdate = [];\r\n\r\n    for (const item of dashboard.permissions) {\r\n      if (item.inherited || item === itemToDelete) {\r\n        continue;\r\n      }\r\n      itemsToUpdate.push(toUpdateItem(item));\r\n    }\r\n\r\n    await getBackendSrv().post(`/api/dashboards/id/${dashboardId}/permissions`, { items: itemsToUpdate });\r\n    await dispatch(getDashboardPermissions(dashboardId));\r\n  };\r\n}\r\n\r\nexport function addDashboardPermission(dashboardId: number, newItem: NewDashboardAclItem): ThunkResult<void> {\r\n  return async (dispatch, getStore) => {\r\n    const { dashboard } = getStore();\r\n    const itemsToUpdate = [];\r\n\r\n    for (const item of dashboard.permissions) {\r\n      if (item.inherited) {\r\n        continue;\r\n      }\r\n      itemsToUpdate.push(toUpdateItem(item));\r\n    }\r\n\r\n    itemsToUpdate.push({\r\n      userId: newItem.userId,\r\n      teamId: newItem.teamId,\r\n      role: newItem.role,\r\n      permission: newItem.permission,\r\n    });\r\n\r\n    await getBackendSrv().post(`/api/dashboards/id/${dashboardId}/permissions`, { items: itemsToUpdate });\r\n    await dispatch(getDashboardPermissions(dashboardId));\r\n  };\r\n}\r\n\r\nexport function importDashboard(data: any, dashboardTitle: string): ThunkResult<void> {\r\n  return async dispatch => {\r\n    await getBackendSrv().post('/api/dashboards/import', data);\r\n    dispatch(notifyApp(createSuccessNotification('Dashboard Imported', dashboardTitle)));\r\n    dispatch(loadPluginDashboards());\r\n  };\r\n}\r\n\r\nexport function removeDashboard(uri: string): ThunkResult<void> {\r\n  return async dispatch => {\r\n    await getBackendSrv().delete(`/api/dashboards/${uri}`);\r\n    dispatch(loadPluginDashboards());\r\n  };\r\n}\r\n","import { getDashboardSrv } from '../services/DashboardSrv';\r\n\r\nimport { PanelData, LoadingState, DataSourceApi } from '@grafana/data';\r\n\r\nimport { reportMetaAnalytics, MetaAnalyticsEventPayload } from '@grafana/runtime';\r\n\r\nexport function getAnalyticsProcessor(datasource: DataSourceApi) {\r\n  let done = false;\r\n\r\n  return (data: PanelData) => {\r\n    if (!data.request || done) {\r\n      return;\r\n    }\r\n\r\n    if (data.state !== LoadingState.Done && data.state !== LoadingState.Error) {\r\n      return;\r\n    }\r\n\r\n    const eventData: MetaAnalyticsEventPayload = {\r\n      datasourceName: datasource.name,\r\n      datasourceId: datasource.id,\r\n      panelId: data.request.panelId,\r\n      dashboardId: data.request.dashboardId,\r\n      // app: 'dashboard',\r\n      dataSize: 0,\r\n      duration: data.request.endTime - data.request.startTime,\r\n      eventName: 'data-request',\r\n      // sessionId: '',\r\n    };\r\n\r\n    // enrich with dashboard info\r\n    const dashboard = getDashboardSrv().getCurrent();\r\n    if (dashboard) {\r\n      eventData.dashboardId = dashboard.id;\r\n      eventData.dashboardName = dashboard.title;\r\n      eventData.dashboardUid = dashboard.uid;\r\n      eventData.folderName = dashboard.meta.folderTitle;\r\n    }\r\n\r\n    if (data.series && data.series.length > 0) {\r\n      // estimate size\r\n      eventData.dataSize = data.series.length;\r\n    }\r\n\r\n    if (data.error) {\r\n      eventData.error = data.error.message;\r\n    }\r\n\r\n    reportMetaAnalytics(eventData);\r\n\r\n    // this done check is to make sure we do not double emit events in case\r\n    // there are multiple responses with done state\r\n    done = true;\r\n  };\r\n}\r\n","import { Action } from 'redux';\r\nimport { DashboardInitPhase, DashboardState } from 'app/types';\r\nimport {\r\n  cleanUpDashboard,\r\n  dashboardInitCompleted,\r\n  dashboardInitFailed,\r\n  dashboardInitFetching,\r\n  dashboardInitServices,\r\n  dashboardInitSlow,\r\n  loadDashboardPermissions,\r\n  setDashboardQueriesToUpdate,\r\n  clearDashboardQueriesToUpdate,\r\n} from './actions';\r\nimport { processAclItems } from 'app/core/utils/acl';\r\nimport { panelEditorReducer } from '../panel_editor/state/reducers';\r\nimport { DashboardModel } from './DashboardModel';\r\n\r\nexport const initialState: DashboardState = {\r\n  initPhase: DashboardInitPhase.NotStarted,\r\n  isInitSlow: false,\r\n  model: null,\r\n  permissions: [],\r\n  modifiedQueries: {\r\n    panelId: undefined,\r\n    queries: undefined,\r\n  },\r\n};\r\n\r\n// Redux Toolkit uses ImmerJs as part of their solution to ensure that state objects are not mutated.\r\n// ImmerJs has an autoFreeze option that freezes objects from change which means this reducer can't be migrated to createSlice\r\n// because the state would become frozen and during run time we would get errors because Angular would try to mutate\r\n// the frozen state.\r\n// https://github.com/reduxjs/redux-toolkit/issues/242\r\nexport const dashboardReducer = (state: DashboardState = initialState, action: Action<unknown>): DashboardState => {\r\n  if (loadDashboardPermissions.match(action)) {\r\n    return {\r\n      ...state,\r\n      permissions: processAclItems(action.payload),\r\n    };\r\n  }\r\n\r\n  if (dashboardInitFetching.match(action)) {\r\n    return {\r\n      ...state,\r\n      initPhase: DashboardInitPhase.Fetching,\r\n    };\r\n  }\r\n\r\n  if (dashboardInitServices.match(action)) {\r\n    return {\r\n      ...state,\r\n      initPhase: DashboardInitPhase.Services,\r\n    };\r\n  }\r\n\r\n  if (dashboardInitSlow.match(action)) {\r\n    return {\r\n      ...state,\r\n      isInitSlow: true,\r\n    };\r\n  }\r\n\r\n  if (dashboardInitFailed.match(action)) {\r\n    return {\r\n      ...state,\r\n      initPhase: DashboardInitPhase.Failed,\r\n      isInitSlow: false,\r\n      initError: action.payload,\r\n      model: new DashboardModel({ title: 'Dashboard init failed' }, { canSave: false, canEdit: false }),\r\n    };\r\n  }\r\n\r\n  if (dashboardInitCompleted.match(action)) {\r\n    return {\r\n      ...state,\r\n      initPhase: DashboardInitPhase.Completed,\r\n      model: action.payload,\r\n      isInitSlow: false,\r\n    };\r\n  }\r\n\r\n  if (cleanUpDashboard.match(action)) {\r\n    // Destroy current DashboardModel\r\n    // Very important as this removes all dashboard event listeners\r\n    state.model.destroy();\r\n\r\n    return {\r\n      ...state,\r\n      initPhase: DashboardInitPhase.NotStarted,\r\n      model: null,\r\n      isInitSlow: false,\r\n      initError: null,\r\n    };\r\n  }\r\n\r\n  if (setDashboardQueriesToUpdate.match(action)) {\r\n    const { panelId, queries } = action.payload;\r\n\r\n    return {\r\n      ...state,\r\n      modifiedQueries: {\r\n        panelId,\r\n        queries,\r\n      },\r\n    };\r\n  }\r\n\r\n  if (clearDashboardQueriesToUpdate.match(action)) {\r\n    return {\r\n      ...state,\r\n      modifiedQueries: {\r\n        panelId: undefined,\r\n        queries: undefined,\r\n      },\r\n    };\r\n  }\r\n\r\n  return state;\r\n};\r\n\r\nexport default {\r\n  dashboard: dashboardReducer,\r\n  panelEditor: panelEditorReducer,\r\n};\r\n","// Libraries\r\nimport { Observable, of, timer, merge, from } from 'rxjs';\r\nimport { flatten, map as lodashMap, isArray, isString } from 'lodash';\r\nimport { map, catchError, takeUntil, mapTo, share, finalize, tap } from 'rxjs/operators';\r\n// Utils & Services\r\nimport { getBackendSrv } from 'app/core/services/backend_srv';\r\n// Types\r\nimport {\r\n  DataSourceApi,\r\n  DataQueryRequest,\r\n  PanelData,\r\n  DataQueryResponse,\r\n  DataQueryResponseData,\r\n  DataQueryError,\r\n  LoadingState,\r\n  dateMath,\r\n  toDataFrame,\r\n  DataFrame,\r\n  guessFieldTypes,\r\n} from '@grafana/data';\r\nimport { getAnalyticsProcessor } from './analyticsProcessor';\r\nimport { ExpressionDatasourceID, expressionDatasource } from 'app/features/expressions/ExpressionDatasource';\r\n\r\ntype MapOfResponsePackets = { [str: string]: DataQueryResponse };\r\n\r\ninterface RunningQueryState {\r\n  packets: { [key: string]: DataQueryResponse };\r\n  panelData: PanelData;\r\n}\r\n\r\n/*\r\n * This function should handle composing a PanelData from multiple responses\r\n */\r\nexport function processResponsePacket(packet: DataQueryResponse, state: RunningQueryState): RunningQueryState {\r\n  const request = state.panelData.request;\r\n  const packets: MapOfResponsePackets = {\r\n    ...state.packets,\r\n  };\r\n\r\n  packets[packet.key || 'A'] = packet;\r\n\r\n  let loadingState = packet.state || LoadingState.Done;\r\n  let error: DataQueryError | undefined = undefined;\r\n\r\n  // Update the time range\r\n  const range = { ...request.range };\r\n  const timeRange = isString(range.raw.from)\r\n    ? {\r\n        from: dateMath.parse(range.raw.from, false),\r\n        to: dateMath.parse(range.raw.to, true),\r\n        raw: range.raw,\r\n      }\r\n    : range;\r\n\r\n  const combinedData = flatten(\r\n    lodashMap(packets, (packet: DataQueryResponse) => {\r\n      if (packet.error) {\r\n        loadingState = LoadingState.Error;\r\n        error = packet.error;\r\n      }\r\n      return packet.data;\r\n    })\r\n  );\r\n\r\n  const panelData = {\r\n    state: loadingState,\r\n    series: combinedData,\r\n    error,\r\n    request,\r\n    timeRange,\r\n  };\r\n\r\n  return { packets, panelData };\r\n}\r\n\r\n/**\r\n * This function handles the excecution of requests & and processes the single or multiple response packets into\r\n * a combined PanelData response.\r\n * It will\r\n *  * Merge multiple responses into a single DataFrame array based on the packet key\r\n *  * Will emit a loading state if no response after 50ms\r\n *  * Cancel any still running network requests on unsubscribe (using request.requestId)\r\n */\r\nexport function runRequest(datasource: DataSourceApi, request: DataQueryRequest): Observable<PanelData> {\r\n  let state: RunningQueryState = {\r\n    panelData: {\r\n      state: LoadingState.Loading,\r\n      series: [],\r\n      request: request,\r\n      timeRange: request.range,\r\n    },\r\n    packets: {},\r\n  };\r\n\r\n  // Return early if there are no queries to run\r\n  if (!request.targets.length) {\r\n    request.endTime = Date.now();\r\n    state.panelData.state = LoadingState.Done;\r\n    return of(state.panelData);\r\n  }\r\n\r\n  const dataObservable = callQueryMethod(datasource, request).pipe(\r\n    // Transform response packets into PanelData with merged results\r\n    map((packet: DataQueryResponse) => {\r\n      if (!isArray(packet.data)) {\r\n        throw new Error(`Expected response data to be array, got ${typeof packet.data}.`);\r\n      }\r\n\r\n      request.endTime = Date.now();\r\n\r\n      state = processResponsePacket(packet, state);\r\n\r\n      return state.panelData;\r\n    }),\r\n    // handle errors\r\n    catchError(err =>\r\n      of({\r\n        ...state.panelData,\r\n        state: LoadingState.Error,\r\n        error: processQueryError(err),\r\n      })\r\n    ),\r\n    tap(getAnalyticsProcessor(datasource)),\r\n    // finalize is triggered when subscriber unsubscribes\r\n    // This makes sure any still running network requests are cancelled\r\n    finalize(cancelNetworkRequestsOnUnsubscribe(request)),\r\n    // this makes it possible to share this observable in takeUntil\r\n    share()\r\n  );\r\n\r\n  // If 50ms without a response emit a loading state\r\n  // mapTo will translate the timer event into state.panelData (which has state set to loading)\r\n  // takeUntil will cancel the timer emit when first response packet is received on the dataObservable\r\n  return merge(timer(200).pipe(mapTo(state.panelData), takeUntil(dataObservable)), dataObservable);\r\n}\r\n\r\nfunction cancelNetworkRequestsOnUnsubscribe(req: DataQueryRequest) {\r\n  return () => {\r\n    getBackendSrv().resolveCancelerIfExists(req.requestId);\r\n  };\r\n}\r\n\r\nexport function callQueryMethod(datasource: DataSourceApi, request: DataQueryRequest) {\r\n  // If any query has an expression, use the expression endpoint\r\n  for (const target of request.targets) {\r\n    if (target.datasource === ExpressionDatasourceID) {\r\n      return expressionDatasource.query(request);\r\n    }\r\n  }\r\n\r\n  // Otherwise it is a standard datasource request\r\n  const returnVal = datasource.query(request);\r\n  return from(returnVal);\r\n}\r\n\r\nexport function processQueryError(err: any): DataQueryError {\r\n  const error = (err || {}) as DataQueryError;\r\n\r\n  if (!error.message) {\r\n    if (typeof err === 'string' || err instanceof String) {\r\n      return { message: err } as DataQueryError;\r\n    }\r\n\r\n    let message = 'Query error';\r\n    if (error.message) {\r\n      message = error.message;\r\n    } else if (error.data && error.data.message) {\r\n      message = error.data.message;\r\n    } else if (error.data && error.data.error) {\r\n      message = error.data.error;\r\n    } else if (error.status) {\r\n      message = `Query error: ${error.status} ${error.statusText}`;\r\n    }\r\n    error.message = message;\r\n  }\r\n\r\n  return error;\r\n}\r\n\r\n/**\r\n * All panels will be passed tables that have our best guess at colum type set\r\n *\r\n * This is also used by PanelChrome for snapshot support\r\n */\r\nexport function getProcessedDataFrames(results?: DataQueryResponseData[]): DataFrame[] {\r\n  if (!isArray(results)) {\r\n    return [];\r\n  }\r\n\r\n  const dataFrames: DataFrame[] = [];\r\n\r\n  for (const result of results) {\r\n    const dataFrame = guessFieldTypes(toDataFrame(result));\r\n\r\n    // clear out any cached calcs\r\n    for (const field of dataFrame.fields) {\r\n      field.calcs = null;\r\n    }\r\n\r\n    dataFrames.push(dataFrame);\r\n  }\r\n\r\n  return dataFrames;\r\n}\r\n\r\nexport function preProcessPanelData(data: PanelData, lastResult: PanelData): PanelData {\r\n  const { series } = data;\r\n\r\n  //  for loading states with no data, use last result\r\n  if (data.state === LoadingState.Loading && series.length === 0) {\r\n    if (!lastResult) {\r\n      lastResult = data;\r\n    }\r\n\r\n    return { ...lastResult, state: LoadingState.Loading };\r\n  }\r\n\r\n  // Make sure the data frames are properly formatted\r\n  return {\r\n    ...data,\r\n    series: getProcessedDataFrames(series),\r\n  };\r\n}\r\n","// Store\r\nimport store from 'app/core/store';\r\n\r\n// Models\r\nimport { DashboardModel } from 'app/features/dashboard/state/DashboardModel';\r\nimport { PanelModel, panelRemoved, panelAdded } from 'app/features/dashboard/state/PanelModel';\r\nimport { TimeRange, AppEvents } from '@grafana/data';\r\n\r\n// Utils\r\nimport { isString as _isString } from 'lodash';\r\nimport { rangeUtil } from '@grafana/data';\r\nimport { dateMath } from '@grafana/data';\r\nimport appEvents from 'app/core/app_events';\r\nimport config from 'app/core/config';\r\n\r\n// Services\r\nimport templateSrv from 'app/features/templating/template_srv';\r\n\r\n// Constants\r\nimport { LS_PANEL_COPY_KEY, PANEL_BORDER } from 'app/core/constants';\r\nimport { CoreEvents } from 'app/types';\r\n\r\nexport const removePanel = (dashboard: DashboardModel, panel: PanelModel, ask: boolean) => {\r\n  // confirm deletion\r\n  if (ask !== false) {\r\n    const text2 = panel.alert ? 'Panel includes an alert rule, removing panel will also remove alert rule' : null;\r\n    const confirmText = panel.alert ? 'YES' : null;\r\n\r\n    appEvents.emit(CoreEvents.showConfirmModal, {\r\n      title: 'Remove Panel',\r\n      text: 'Are you sure you want to remove this panel?',\r\n      text2: text2,\r\n      icon: 'fa-trash',\r\n      confirmText: confirmText,\r\n      yesText: 'Remove',\r\n      onConfirm: () => removePanel(dashboard, panel, false),\r\n    });\r\n    return;\r\n  }\r\n  dashboard.removePanel(panel);\r\n};\r\n\r\nexport const duplicatePanel = (dashboard: DashboardModel, panel: PanelModel) => {\r\n  dashboard.duplicatePanel(panel);\r\n};\r\n\r\nexport const copyPanel = (panel: PanelModel) => {\r\n  store.set(LS_PANEL_COPY_KEY, JSON.stringify(panel.getSaveModel()));\r\n  appEvents.emit(AppEvents.alertSuccess, ['Panel copied. Open Add Panel to paste']);\r\n};\r\n\r\nconst replacePanel = (dashboard: DashboardModel, newPanel: PanelModel, oldPanel: PanelModel) => {\r\n  const index = dashboard.panels.findIndex(panel => {\r\n    return panel.id === oldPanel.id;\r\n  });\r\n\r\n  const deletedPanel = dashboard.panels.splice(index, 1)[0];\r\n  dashboard.events.emit(panelRemoved, deletedPanel);\r\n\r\n  newPanel = new PanelModel(newPanel);\r\n  newPanel.id = oldPanel.id;\r\n\r\n  dashboard.panels.splice(index, 0, newPanel);\r\n  dashboard.sortPanelsByGridPos();\r\n  dashboard.events.emit(panelAdded, newPanel);\r\n};\r\n\r\nexport const editPanelJson = (dashboard: DashboardModel, panel: PanelModel) => {\r\n  const model = {\r\n    object: panel.getSaveModel(),\r\n    updateHandler: (newPanel: PanelModel, oldPanel: PanelModel) => {\r\n      replacePanel(dashboard, newPanel, oldPanel);\r\n    },\r\n    canUpdate: dashboard.meta.canEdit,\r\n    enableCopy: true,\r\n  };\r\n\r\n  appEvents.emit(CoreEvents.showModal, {\r\n    src: 'public/app/partials/edit_json.html',\r\n    model: model,\r\n  });\r\n};\r\n\r\nexport const sharePanel = (dashboard: DashboardModel, panel: PanelModel) => {\r\n  appEvents.emit(CoreEvents.showModal, {\r\n    src: 'public/app/features/dashboard/components/ShareModal/template.html',\r\n    model: {\r\n      dashboard: dashboard,\r\n      panel: panel,\r\n    },\r\n  });\r\n};\r\n\r\nexport const refreshPanel = (panel: PanelModel) => {\r\n  panel.refresh();\r\n};\r\n\r\nexport const toggleLegend = (panel: PanelModel) => {\r\n  console.log('Toggle legend is not implemented yet');\r\n  // We need to set panel.legend defaults first\r\n  // panel.legend.show = !panel.legend.show;\r\n  refreshPanel(panel);\r\n};\r\n\r\nexport interface TimeOverrideResult {\r\n  timeRange: TimeRange;\r\n  timeInfo: string;\r\n}\r\n\r\nexport function applyPanelTimeOverrides(panel: PanelModel, timeRange: TimeRange): TimeOverrideResult {\r\n  const newTimeData = {\r\n    timeInfo: '',\r\n    timeRange: timeRange,\r\n  };\r\n\r\n  if (panel.timeFrom) {\r\n    const timeFromInterpolated = templateSrv.replace(panel.timeFrom, panel.scopedVars);\r\n    const timeFromInfo = rangeUtil.describeTextRange(timeFromInterpolated);\r\n    if (timeFromInfo.invalid) {\r\n      newTimeData.timeInfo = 'invalid time override';\r\n      return newTimeData;\r\n    }\r\n\r\n    if (_isString(timeRange.raw.from)) {\r\n      const timeFromDate = dateMath.parse(timeFromInfo.from);\r\n      newTimeData.timeInfo = timeFromInfo.display;\r\n      newTimeData.timeRange = {\r\n        from: timeFromDate,\r\n        to: dateMath.parse(timeFromInfo.to),\r\n        raw: {\r\n          from: timeFromInfo.from,\r\n          to: timeFromInfo.to,\r\n        },\r\n      };\r\n    }\r\n  }\r\n\r\n  if (panel.timeShift) {\r\n    const timeShiftInterpolated = templateSrv.replace(panel.timeShift, panel.scopedVars);\r\n    const timeShiftInfo = rangeUtil.describeTextRange(timeShiftInterpolated);\r\n    if (timeShiftInfo.invalid) {\r\n      newTimeData.timeInfo = 'invalid timeshift';\r\n      return newTimeData;\r\n    }\r\n\r\n    const timeShift = '-' + timeShiftInterpolated;\r\n    newTimeData.timeInfo += ' timeshift ' + timeShift;\r\n    const from = dateMath.parseDateMath(timeShift, newTimeData.timeRange.from, false);\r\n    const to = dateMath.parseDateMath(timeShift, newTimeData.timeRange.to, true);\r\n\r\n    newTimeData.timeRange = {\r\n      from,\r\n      to,\r\n      raw: {\r\n        from,\r\n        to,\r\n      },\r\n    };\r\n  }\r\n\r\n  if (panel.hideTimeOverride) {\r\n    newTimeData.timeInfo = '';\r\n  }\r\n\r\n  return newTimeData;\r\n}\r\n\r\nexport function getResolution(panel: PanelModel): number {\r\n  const htmlEl = document.getElementsByTagName('html')[0];\r\n  const width = htmlEl.getBoundingClientRect().width; // https://stackoverflow.com/a/21454625\r\n\r\n  return panel.maxDataPoints ? panel.maxDataPoints : Math.ceil(width * (panel.gridPos.w / 24));\r\n}\r\n\r\nexport function calculateInnerPanelHeight(panel: PanelModel, containerHeight: number): number {\r\n  const chromePadding = panel.plugin && panel.plugin.noPadding ? 0 : config.theme.panelPadding * 2;\r\n  const headerHeight = panel.hasTitle() ? config.theme.panelHeaderHeight : 0;\r\n  return containerHeight - headerHeight - chromePadding - PANEL_BORDER;\r\n}\r\n","import { coreModule } from 'app/core/core';\r\n\r\ncoreModule.directive('datasourceHttpSettings', () => {\r\n  return {\r\n    scope: {\r\n      current: '=',\r\n      suggestUrl: '@',\r\n      noDirectAccess: '@',\r\n    },\r\n    templateUrl: 'public/app/features/datasources/partials/http_settings_next.html',\r\n    link: {\r\n      pre: ($scope: any) => {\r\n        // do not show access option if direct access is disabled\r\n        $scope.showAccessOption = $scope.noDirectAccess !== 'true';\r\n        $scope.onChange = (datasourceSetting: any) => {\r\n          $scope.current = datasourceSetting;\r\n        };\r\n      },\r\n    },\r\n  };\r\n});\r\n","import { coreModule } from 'app/core/core';\n\ncoreModule.directive('datasourceTlsAuthSettings', () => {\n  return {\n    scope: {\n      current: '=',\n    },\n    templateUrl: 'public/app/features/datasources/partials/tls_auth_settings.html',\n  };\n});\n","import { AnyAction, createAction } from '@reduxjs/toolkit';\r\nimport { DataSourcePluginMeta, DataSourceSettings } from '@grafana/data';\r\n\r\nimport { DataSourcesState } from 'app/types';\r\nimport { LayoutMode, LayoutModes } from 'app/core/components/LayoutSelector/LayoutSelector';\r\nimport { DataSourceTypesLoadedPayload } from './actions';\r\n\r\nexport const initialState: DataSourcesState = {\r\n  dataSources: [],\r\n  plugins: [],\r\n  categories: [],\r\n  dataSource: {} as DataSourceSettings,\r\n  layoutMode: LayoutModes.List,\r\n  searchQuery: '',\r\n  dataSourcesCount: 0,\r\n  dataSourceTypeSearchQuery: '',\r\n  hasFetched: false,\r\n  isLoadingDataSources: false,\r\n  dataSourceMeta: {} as DataSourcePluginMeta,\r\n};\r\n\r\nexport const dataSourceLoaded = createAction<DataSourceSettings>('dataSources/dataSourceLoaded');\r\nexport const dataSourcesLoaded = createAction<DataSourceSettings[]>('dataSources/dataSourcesLoaded');\r\nexport const dataSourceMetaLoaded = createAction<DataSourcePluginMeta>('dataSources/dataSourceMetaLoaded');\r\nexport const dataSourcePluginsLoad = createAction('dataSources/dataSourcePluginsLoad');\r\nexport const dataSourcePluginsLoaded = createAction<DataSourceTypesLoadedPayload>(\r\n  'dataSources/dataSourcePluginsLoaded'\r\n);\r\nexport const setDataSourcesSearchQuery = createAction<string>('dataSources/setDataSourcesSearchQuery');\r\nexport const setDataSourcesLayoutMode = createAction<LayoutMode>('dataSources/setDataSourcesLayoutMode');\r\nexport const setDataSourceTypeSearchQuery = createAction<string>('dataSources/setDataSourceTypeSearchQuery');\r\nexport const setDataSourceName = createAction<string>('dataSources/setDataSourceName');\r\nexport const setIsDefault = createAction<boolean>('dataSources/setIsDefault');\r\n\r\n// Redux Toolkit uses ImmerJs as part of their solution to ensure that state objects are not mutated.\r\n// ImmerJs has an autoFreeze option that freezes objects from change which means this reducer can't be migrated to createSlice\r\n// because the state would become frozen and during run time we would get errors because Angular would try to mutate\r\n// the frozen state.\r\n// https://github.com/reduxjs/redux-toolkit/issues/242\r\nexport const dataSourcesReducer = (state: DataSourcesState = initialState, action: AnyAction): DataSourcesState => {\r\n  if (dataSourcesLoaded.match(action)) {\r\n    return {\r\n      ...state,\r\n      hasFetched: true,\r\n      dataSources: action.payload,\r\n      dataSourcesCount: action.payload.length,\r\n    };\r\n  }\r\n\r\n  if (dataSourceLoaded.match(action)) {\r\n    return { ...state, dataSource: action.payload };\r\n  }\r\n\r\n  if (setDataSourcesSearchQuery.match(action)) {\r\n    return { ...state, searchQuery: action.payload };\r\n  }\r\n\r\n  if (setDataSourcesLayoutMode.match(action)) {\r\n    return { ...state, layoutMode: action.payload };\r\n  }\r\n\r\n  if (dataSourcePluginsLoad.match(action)) {\r\n    return { ...state, plugins: [], isLoadingDataSources: true };\r\n  }\r\n\r\n  if (dataSourcePluginsLoaded.match(action)) {\r\n    return {\r\n      ...state,\r\n      plugins: action.payload.plugins,\r\n      categories: action.payload.categories,\r\n      isLoadingDataSources: false,\r\n    };\r\n  }\r\n\r\n  if (setDataSourceTypeSearchQuery.match(action)) {\r\n    return { ...state, dataSourceTypeSearchQuery: action.payload };\r\n  }\r\n\r\n  if (dataSourceMetaLoaded.match(action)) {\r\n    return { ...state, dataSourceMeta: action.payload };\r\n  }\r\n\r\n  if (setDataSourceName.match(action)) {\r\n    return { ...state, dataSource: { ...state.dataSource, name: action.payload } };\r\n  }\r\n\r\n  if (setIsDefault.match(action)) {\r\n    return {\r\n      ...state,\r\n      dataSource: { ...state.dataSource, isDefault: action.payload },\r\n    };\r\n  }\r\n\r\n  return state;\r\n};\r\n\r\nexport default {\r\n  dataSources: dataSourcesReducer,\r\n};\r\n","// Types\r\nimport { Unsubscribable } from 'rxjs';\r\nimport { createAction } from '@reduxjs/toolkit';\r\n\r\nimport { Emitter } from 'app/core/core';\r\nimport {\r\n  AbsoluteTimeRange,\r\n  DataQuery,\r\n  DataSourceApi,\r\n  HistoryItem,\r\n  LoadingState,\r\n  LogLevel,\r\n  PanelData,\r\n  QueryFixAction,\r\n  TimeRange,\r\n} from '@grafana/data';\r\nimport { ExploreId, ExploreItemState, ExploreMode, ExploreUIState } from 'app/types/explore';\r\n\r\nexport interface AddQueryRowPayload {\r\n  exploreId: ExploreId;\r\n  index: number;\r\n  query: DataQuery;\r\n}\r\n\r\nexport interface ChangeModePayload {\r\n  exploreId: ExploreId;\r\n  mode: ExploreMode;\r\n}\r\n\r\nexport interface ChangeQueryPayload {\r\n  exploreId: ExploreId;\r\n  query: DataQuery;\r\n  index: number;\r\n  override: boolean;\r\n}\r\n\r\nexport interface ChangeSizePayload {\r\n  exploreId: ExploreId;\r\n  width: number;\r\n  height: number;\r\n}\r\n\r\nexport interface ChangeRefreshIntervalPayload {\r\n  exploreId: ExploreId;\r\n  refreshInterval: string;\r\n}\r\n\r\nexport interface ClearQueriesPayload {\r\n  exploreId: ExploreId;\r\n}\r\n\r\nexport interface HighlightLogsExpressionPayload {\r\n  exploreId: ExploreId;\r\n  expressions: string[];\r\n}\r\n\r\nexport interface InitializeExplorePayload {\r\n  exploreId: ExploreId;\r\n  containerWidth: number;\r\n  eventBridge: Emitter;\r\n  queries: DataQuery[];\r\n  range: TimeRange;\r\n  mode: ExploreMode;\r\n  ui: ExploreUIState;\r\n  originPanelId: number;\r\n}\r\n\r\nexport interface LoadDatasourceMissingPayload {\r\n  exploreId: ExploreId;\r\n}\r\n\r\nexport interface LoadDatasourcePendingPayload {\r\n  exploreId: ExploreId;\r\n  requestedDatasourceName: string;\r\n}\r\n\r\nexport interface LoadDatasourceReadyPayload {\r\n  exploreId: ExploreId;\r\n  history: HistoryItem[];\r\n}\r\n\r\nexport interface ModifyQueriesPayload {\r\n  exploreId: ExploreId;\r\n  modification: QueryFixAction;\r\n  index?: number;\r\n  modifier: (query: DataQuery, modification: QueryFixAction) => DataQuery;\r\n}\r\n\r\nexport interface QueryEndedPayload {\r\n  exploreId: ExploreId;\r\n  response: PanelData;\r\n}\r\n\r\nexport interface QueryStoreSubscriptionPayload {\r\n  exploreId: ExploreId;\r\n  querySubscription: Unsubscribable;\r\n}\r\n\r\nexport interface HistoryUpdatedPayload {\r\n  exploreId: ExploreId;\r\n  history: HistoryItem[];\r\n}\r\n\r\nexport interface RemoveQueryRowPayload {\r\n  exploreId: ExploreId;\r\n  index: number;\r\n}\r\n\r\nexport interface ScanStartPayload {\r\n  exploreId: ExploreId;\r\n}\r\n\r\nexport interface ScanStopPayload {\r\n  exploreId: ExploreId;\r\n}\r\n\r\nexport interface SetQueriesPayload {\r\n  exploreId: ExploreId;\r\n  queries: DataQuery[];\r\n}\r\n\r\nexport interface SplitCloseActionPayload {\r\n  itemId: ExploreId;\r\n}\r\n\r\nexport interface SplitOpenPayload {\r\n  itemState: ExploreItemState;\r\n}\r\n\r\nexport interface SyncTimesPayload {\r\n  syncedTimes: boolean;\r\n}\r\n\r\nexport interface ToggleTablePayload {\r\n  exploreId: ExploreId;\r\n}\r\n\r\nexport interface ToggleGraphPayload {\r\n  exploreId: ExploreId;\r\n}\r\n\r\nexport interface UpdateUIStatePayload extends Partial<ExploreUIState> {\r\n  exploreId: ExploreId;\r\n}\r\n\r\nexport interface UpdateDatasourceInstancePayload {\r\n  exploreId: ExploreId;\r\n  datasourceInstance: DataSourceApi;\r\n  version?: string;\r\n  mode?: ExploreMode;\r\n}\r\n\r\nexport interface ToggleLogLevelPayload {\r\n  exploreId: ExploreId;\r\n  hiddenLogLevels: LogLevel[];\r\n}\r\n\r\nexport interface QueriesImportedPayload {\r\n  exploreId: ExploreId;\r\n  queries: DataQuery[];\r\n}\r\n\r\nexport interface SetUrlReplacedPayload {\r\n  exploreId: ExploreId;\r\n}\r\n\r\nexport interface ChangeRangePayload {\r\n  exploreId: ExploreId;\r\n  range: TimeRange;\r\n  absoluteRange: AbsoluteTimeRange;\r\n}\r\n\r\nexport interface ChangeLoadingStatePayload {\r\n  exploreId: ExploreId;\r\n  loadingState: LoadingState;\r\n}\r\n\r\nexport interface SetPausedStatePayload {\r\n  exploreId: ExploreId;\r\n  isPaused: boolean;\r\n}\r\n\r\nexport interface ResetExplorePayload {\r\n  force?: boolean;\r\n}\r\n\r\n/**\r\n * Adds a query row after the row with the given index.\r\n */\r\nexport const addQueryRowAction = createAction<AddQueryRowPayload>('explore/addQueryRow');\r\n\r\n/**\r\n * Change the mode of Explore.\r\n */\r\nexport const changeModeAction = createAction<ChangeModePayload>('explore/changeMode');\r\n\r\n/**\r\n * Query change handler for the query row with the given index.\r\n * If `override` is reset the query modifications and run the queries. Use this to set queries via a link.\r\n */\r\nexport const changeQueryAction = createAction<ChangeQueryPayload>('explore/changeQuery');\r\n\r\n/**\r\n * Keep track of the Explore container size, in particular the width.\r\n * The width will be used to calculate graph intervals (number of datapoints).\r\n */\r\nexport const changeSizeAction = createAction<ChangeSizePayload>('explore/changeSize');\r\n\r\n/**\r\n * Change the time range of Explore. Usually called from the Timepicker or a graph interaction.\r\n */\r\nexport const changeRefreshIntervalAction = createAction<ChangeRefreshIntervalPayload>('explore/changeRefreshInterval');\r\n\r\n/**\r\n * Clear all queries and results.\r\n */\r\nexport const clearQueriesAction = createAction<ClearQueriesPayload>('explore/clearQueries');\r\n\r\n/**\r\n * Highlight expressions in the log results\r\n */\r\nexport const highlightLogsExpressionAction = createAction<HighlightLogsExpressionPayload>(\r\n  'explore/highlightLogsExpression'\r\n);\r\n\r\n/**\r\n * Initialize Explore state with state from the URL and the React component.\r\n * Call this only on components for with the Explore state has not been initialized.\r\n */\r\nexport const initializeExploreAction = createAction<InitializeExplorePayload>('explore/initializeExplore');\r\n\r\n/**\r\n * Display an error when no datasources have been configured\r\n */\r\nexport const loadDatasourceMissingAction = createAction<LoadDatasourceMissingPayload>('explore/loadDatasourceMissing');\r\n\r\n/**\r\n * Start the async process of loading a datasource to display a loading indicator\r\n */\r\nexport const loadDatasourcePendingAction = createAction<LoadDatasourcePendingPayload>('explore/loadDatasourcePending');\r\n\r\n/**\r\n * Datasource loading was completed.\r\n */\r\nexport const loadDatasourceReadyAction = createAction<LoadDatasourceReadyPayload>('explore/loadDatasourceReady');\r\n\r\n/**\r\n * Action to modify a query given a datasource-specific modifier action.\r\n * @param exploreId Explore area\r\n * @param modification Action object with a type, e.g., ADD_FILTER\r\n * @param index Optional query row index. If omitted, the modification is applied to all query rows.\r\n * @param modifier Function that executes the modification, typically `datasourceInstance.modifyQueries`.\r\n */\r\nexport const modifyQueriesAction = createAction<ModifyQueriesPayload>('explore/modifyQueries');\r\n\r\nexport const queryStreamUpdatedAction = createAction<QueryEndedPayload>('explore/queryStreamUpdated');\r\n\r\nexport const queryStoreSubscriptionAction = createAction<QueryStoreSubscriptionPayload>(\r\n  'explore/queryStoreSubscription'\r\n);\r\n\r\n/**\r\n * Remove query row of the given index, as well as associated query results.\r\n */\r\nexport const removeQueryRowAction = createAction<RemoveQueryRowPayload>('explore/removeQueryRow');\r\n\r\n/**\r\n * Start a scan for more results using the given scanner.\r\n * @param exploreId Explore area\r\n * @param scanner Function that a) returns a new time range and b) triggers a query run for the new range\r\n */\r\nexport const scanStartAction = createAction<ScanStartPayload>('explore/scanStart');\r\n\r\n/**\r\n * Stop any scanning for more results.\r\n */\r\nexport const scanStopAction = createAction<ScanStopPayload>('explore/scanStop');\r\n\r\n/**\r\n * Reset queries to the given queries. Any modifications will be discarded.\r\n * Use this action for clicks on query examples. Triggers a query run.\r\n */\r\nexport const setQueriesAction = createAction<SetQueriesPayload>('explore/setQueries');\r\n\r\n/**\r\n * Close the split view and save URL state.\r\n */\r\nexport const splitCloseAction = createAction<SplitCloseActionPayload>('explore/splitClose');\r\n\r\n/**\r\n * Open the split view and copy the left state to be the right state.\r\n * The right state is automatically initialized.\r\n * The copy keeps all query modifications but wipes the query results.\r\n */\r\nexport const splitOpenAction = createAction<SplitOpenPayload>('explore/splitOpen');\r\n\r\nexport const syncTimesAction = createAction<SyncTimesPayload>('explore/syncTimes');\r\n/**\r\n * Update state of Explores UI elements (panels visiblity and deduplication  strategy)\r\n */\r\nexport const updateUIStateAction = createAction<UpdateUIStatePayload>('explore/updateUIState');\r\n\r\n/**\r\n * Expand/collapse the table result viewer. When collapsed, table queries won't be run.\r\n */\r\nexport const toggleTableAction = createAction<ToggleTablePayload>('explore/toggleTable');\r\n\r\n/**\r\n * Expand/collapse the graph result viewer. When collapsed, graph queries won't be run.\r\n */\r\nexport const toggleGraphAction = createAction<ToggleGraphPayload>('explore/toggleGraph');\r\n\r\n/**\r\n * Updates datasource instance before datasouce loading has started\r\n */\r\nexport const updateDatasourceInstanceAction = createAction<UpdateDatasourceInstancePayload>(\r\n  'explore/updateDatasourceInstance'\r\n);\r\n\r\nexport const toggleLogLevelAction = createAction<ToggleLogLevelPayload>('explore/toggleLogLevel');\r\n\r\n/**\r\n * Resets state for explore.\r\n */\r\nexport const resetExploreAction = createAction<ResetExplorePayload>('explore/resetExplore');\r\nexport const queriesImportedAction = createAction<QueriesImportedPayload>('explore/queriesImported');\r\n\r\nexport const historyUpdatedAction = createAction<HistoryUpdatedPayload>('explore/historyUpdated');\r\n\r\nexport const setUrlReplacedAction = createAction<SetUrlReplacedPayload>('explore/setUrlReplaced');\r\n\r\nexport const changeRangeAction = createAction<ChangeRangePayload>('explore/changeRange');\r\n\r\nexport const changeLoadingStateAction = createAction<ChangeLoadingStatePayload>('changeLoadingState');\r\n\r\nexport const setPausedStateAction = createAction<SetPausedStatePayload>('explore/setPausedState');\r\n","import _ from 'lodash';\r\nimport { AnyAction } from 'redux';\r\nimport { PayloadAction } from '@reduxjs/toolkit';\r\nimport {\r\n  DataQuery,\r\n  DataQueryRequest,\r\n  DataSourceApi,\r\n  DefaultTimeRange,\r\n  LoadingState,\r\n  PanelData,\r\n  PanelEvents,\r\n  TimeZone,\r\n  toLegacyResponseData,\r\n} from '@grafana/data';\r\nimport { RefreshPicker } from '@grafana/ui';\r\nimport { LocationUpdate } from '@grafana/runtime';\r\n\r\nimport {\r\n  DEFAULT_UI_STATE,\r\n  ensureQueries,\r\n  generateNewKeyAndAddRefIdIfMissing,\r\n  getQueryKeys,\r\n  parseUrlState,\r\n  refreshIntervalToSortOrder,\r\n  sortLogsResult,\r\n  stopQueryState,\r\n} from 'app/core/utils/explore';\r\nimport { ExploreId, ExploreItemState, ExploreMode, ExploreState, ExploreUpdateState } from 'app/types/explore';\r\nimport {\r\n  addQueryRowAction,\r\n  changeLoadingStateAction,\r\n  changeModeAction,\r\n  changeQueryAction,\r\n  changeRangeAction,\r\n  changeRefreshIntervalAction,\r\n  changeSizeAction,\r\n  clearQueriesAction,\r\n  highlightLogsExpressionAction,\r\n  historyUpdatedAction,\r\n  initializeExploreAction,\r\n  loadDatasourceMissingAction,\r\n  loadDatasourcePendingAction,\r\n  loadDatasourceReadyAction,\r\n  modifyQueriesAction,\r\n  queriesImportedAction,\r\n  QueryEndedPayload,\r\n  queryStoreSubscriptionAction,\r\n  queryStreamUpdatedAction,\r\n  removeQueryRowAction,\r\n  resetExploreAction,\r\n  ResetExplorePayload,\r\n  scanStartAction,\r\n  scanStopAction,\r\n  setPausedStateAction,\r\n  setQueriesAction,\r\n  setUrlReplacedAction,\r\n  splitCloseAction,\r\n  SplitCloseActionPayload,\r\n  splitOpenAction,\r\n  syncTimesAction,\r\n  toggleGraphAction,\r\n  toggleLogLevelAction,\r\n  toggleTableAction,\r\n  updateDatasourceInstanceAction,\r\n  updateUIStateAction,\r\n} from './actionTypes';\r\nimport { ResultProcessor } from '../utils/ResultProcessor';\r\nimport { updateLocation } from '../../../core/actions';\r\n\r\nexport const DEFAULT_RANGE = {\r\n  from: 'now-6h',\r\n  to: 'now',\r\n};\r\n\r\nexport const makeInitialUpdateState = (): ExploreUpdateState => ({\r\n  datasource: false,\r\n  queries: false,\r\n  range: false,\r\n  mode: false,\r\n  ui: false,\r\n});\r\n\r\n/**\r\n * Returns a fresh Explore area state\r\n */\r\nexport const makeExploreItemState = (): ExploreItemState => ({\r\n  containerWidth: 0,\r\n  datasourceInstance: null,\r\n  requestedDatasourceName: null,\r\n  datasourceLoading: null,\r\n  datasourceMissing: false,\r\n  history: [],\r\n  queries: [],\r\n  initialized: false,\r\n  range: {\r\n    from: null,\r\n    to: null,\r\n    raw: DEFAULT_RANGE,\r\n  },\r\n  absoluteRange: {\r\n    from: null,\r\n    to: null,\r\n  },\r\n  scanning: false,\r\n  scanRange: null,\r\n  showingGraph: true,\r\n  showingTable: true,\r\n  loading: false,\r\n  queryKeys: [],\r\n  urlState: null,\r\n  update: makeInitialUpdateState(),\r\n  latency: 0,\r\n  supportedModes: [],\r\n  mode: null,\r\n  isLive: false,\r\n  isPaused: false,\r\n  urlReplaced: false,\r\n  queryResponse: createEmptyQueryResponse(),\r\n});\r\n\r\nexport const createEmptyQueryResponse = (): PanelData => ({\r\n  state: LoadingState.NotStarted,\r\n  request: {} as DataQueryRequest<DataQuery>,\r\n  series: [],\r\n  error: null,\r\n  timeRange: DefaultTimeRange,\r\n});\r\n\r\n/**\r\n * Global Explore state that handles multiple Explore areas and the split state\r\n */\r\nexport const initialExploreItemState = makeExploreItemState();\r\nexport const initialExploreState: ExploreState = {\r\n  split: null,\r\n  syncedTimes: false,\r\n  left: initialExploreItemState,\r\n  right: initialExploreItemState,\r\n};\r\n\r\n/**\r\n * Reducer for an Explore area, to be used by the global Explore reducer.\r\n */\r\n// Redux Toolkit uses ImmerJs as part of their solution to ensure that state objects are not mutated.\r\n// ImmerJs has an autoFreeze option that freezes objects from change which means this reducer can't be migrated to createSlice\r\n// because the state would become frozen and during run time we would get errors because flot (Graph lib) would try to mutate\r\n// the frozen state.\r\n// https://github.com/reduxjs/redux-toolkit/issues/242\r\nexport const itemReducer = (state: ExploreItemState = makeExploreItemState(), action: AnyAction): ExploreItemState => {\r\n  if (addQueryRowAction.match(action)) {\r\n    const { queries } = state;\r\n    const { index, query } = action.payload;\r\n\r\n    // Add to queries, which will cause a new row to be rendered\r\n    const nextQueries = [...queries.slice(0, index + 1), { ...query }, ...queries.slice(index + 1)];\r\n\r\n    return {\r\n      ...state,\r\n      queries: nextQueries,\r\n      logsHighlighterExpressions: undefined,\r\n      queryKeys: getQueryKeys(nextQueries, state.datasourceInstance),\r\n    };\r\n  }\r\n\r\n  if (changeQueryAction.match(action)) {\r\n    const { queries } = state;\r\n    const { query, index } = action.payload;\r\n\r\n    // Override path: queries are completely reset\r\n    const nextQuery: DataQuery = generateNewKeyAndAddRefIdIfMissing(query, queries, index);\r\n    const nextQueries = [...queries];\r\n    nextQueries[index] = nextQuery;\r\n\r\n    return {\r\n      ...state,\r\n      queries: nextQueries,\r\n      queryKeys: getQueryKeys(nextQueries, state.datasourceInstance),\r\n    };\r\n  }\r\n\r\n  if (changeSizeAction.match(action)) {\r\n    const containerWidth = action.payload.width;\r\n    return { ...state, containerWidth };\r\n  }\r\n\r\n  if (changeModeAction.match(action)) {\r\n    return {\r\n      ...state,\r\n      mode: action.payload.mode,\r\n      graphResult: null,\r\n      tableResult: null,\r\n      logsResult: null,\r\n      queryResponse: createEmptyQueryResponse(),\r\n      loading: false,\r\n    };\r\n  }\r\n\r\n  if (changeRefreshIntervalAction.match(action)) {\r\n    const { refreshInterval } = action.payload;\r\n    const live = RefreshPicker.isLive(refreshInterval);\r\n    const sortOrder = refreshIntervalToSortOrder(refreshInterval);\r\n    const logsResult = sortLogsResult(state.logsResult, sortOrder);\r\n\r\n    if (RefreshPicker.isLive(state.refreshInterval) && !live) {\r\n      stopQueryState(state.querySubscription);\r\n    }\r\n\r\n    return {\r\n      ...state,\r\n      refreshInterval,\r\n      queryResponse: {\r\n        ...state.queryResponse,\r\n        state: live ? LoadingState.Streaming : LoadingState.Done,\r\n      },\r\n      isLive: live,\r\n      isPaused: live ? false : state.isPaused,\r\n      loading: live,\r\n      logsResult,\r\n    };\r\n  }\r\n\r\n  if (clearQueriesAction.match(action)) {\r\n    const queries = ensureQueries();\r\n    stopQueryState(state.querySubscription);\r\n    return {\r\n      ...state,\r\n      queries: queries.slice(),\r\n      graphResult: null,\r\n      tableResult: null,\r\n      logsResult: null,\r\n      queryKeys: getQueryKeys(queries, state.datasourceInstance),\r\n      queryResponse: createEmptyQueryResponse(),\r\n      loading: false,\r\n    };\r\n  }\r\n\r\n  if (highlightLogsExpressionAction.match(action)) {\r\n    const { expressions } = action.payload;\r\n    return { ...state, logsHighlighterExpressions: expressions };\r\n  }\r\n\r\n  if (initializeExploreAction.match(action)) {\r\n    const { containerWidth, eventBridge, queries, range, mode, ui, originPanelId } = action.payload;\r\n    return {\r\n      ...state,\r\n      containerWidth,\r\n      eventBridge,\r\n      range,\r\n      mode,\r\n      queries,\r\n      initialized: true,\r\n      queryKeys: getQueryKeys(queries, state.datasourceInstance),\r\n      ...ui,\r\n      originPanelId,\r\n      update: makeInitialUpdateState(),\r\n    };\r\n  }\r\n\r\n  if (updateDatasourceInstanceAction.match(action)) {\r\n    const { datasourceInstance, version, mode } = action.payload;\r\n\r\n    // Custom components\r\n    stopQueryState(state.querySubscription);\r\n\r\n    let newMetadata = datasourceInstance.meta;\r\n\r\n    // HACK: Temporary hack for Loki datasource. Can remove when plugin.json structure is changed.\r\n    if (version && version.length && datasourceInstance.meta.name === 'Loki') {\r\n      const lokiVersionMetadata: Record<string, { metrics: boolean }> = {\r\n        v0: {\r\n          metrics: false,\r\n        },\r\n\r\n        v1: {\r\n          metrics: true,\r\n        },\r\n      };\r\n      newMetadata = { ...newMetadata, ...lokiVersionMetadata[version] };\r\n    }\r\n\r\n    const updatedDatasourceInstance = Object.assign(datasourceInstance, { meta: newMetadata });\r\n    const [supportedModes, newMode] = getModesForDatasource(updatedDatasourceInstance, state.mode);\r\n\r\n    return {\r\n      ...state,\r\n      datasourceInstance: updatedDatasourceInstance,\r\n      graphResult: null,\r\n      tableResult: null,\r\n      logsResult: null,\r\n      latency: 0,\r\n      queryResponse: createEmptyQueryResponse(),\r\n      loading: false,\r\n      queryKeys: [],\r\n      supportedModes,\r\n      mode: mode ?? newMode,\r\n      originPanelId: state.urlState && state.urlState.originPanelId,\r\n    };\r\n  }\r\n\r\n  if (loadDatasourceMissingAction.match(action)) {\r\n    return {\r\n      ...state,\r\n      datasourceMissing: true,\r\n      datasourceLoading: false,\r\n      update: makeInitialUpdateState(),\r\n    };\r\n  }\r\n\r\n  if (loadDatasourcePendingAction.match(action)) {\r\n    return {\r\n      ...state,\r\n      datasourceLoading: true,\r\n      requestedDatasourceName: action.payload.requestedDatasourceName,\r\n    };\r\n  }\r\n\r\n  if (loadDatasourceReadyAction.match(action)) {\r\n    const { history } = action.payload;\r\n    return {\r\n      ...state,\r\n      history,\r\n      datasourceLoading: false,\r\n      datasourceMissing: false,\r\n      logsHighlighterExpressions: undefined,\r\n      update: makeInitialUpdateState(),\r\n    };\r\n  }\r\n\r\n  if (modifyQueriesAction.match(action)) {\r\n    const { queries } = state;\r\n    const { modification, index, modifier } = action.payload;\r\n    let nextQueries: DataQuery[];\r\n    if (index === undefined) {\r\n      // Modify all queries\r\n      nextQueries = queries.map((query, i) => {\r\n        const nextQuery = modifier({ ...query }, modification);\r\n        return generateNewKeyAndAddRefIdIfMissing(nextQuery, queries, i);\r\n      });\r\n    } else {\r\n      // Modify query only at index\r\n      nextQueries = queries.map((query, i) => {\r\n        if (i === index) {\r\n          const nextQuery = modifier({ ...query }, modification);\r\n          return generateNewKeyAndAddRefIdIfMissing(nextQuery, queries, i);\r\n        }\r\n\r\n        return query;\r\n      });\r\n    }\r\n    return {\r\n      ...state,\r\n      queries: nextQueries,\r\n      queryKeys: getQueryKeys(nextQueries, state.datasourceInstance),\r\n    };\r\n  }\r\n\r\n  if (removeQueryRowAction.match(action)) {\r\n    const { queries, queryKeys } = state;\r\n    const { index } = action.payload;\r\n\r\n    if (queries.length <= 1) {\r\n      return state;\r\n    }\r\n\r\n    const nextQueries = [...queries.slice(0, index), ...queries.slice(index + 1)];\r\n    const nextQueryKeys = [...queryKeys.slice(0, index), ...queryKeys.slice(index + 1)];\r\n\r\n    return {\r\n      ...state,\r\n      queries: nextQueries,\r\n      logsHighlighterExpressions: undefined,\r\n      queryKeys: nextQueryKeys,\r\n    };\r\n  }\r\n\r\n  if (scanStartAction.match(action)) {\r\n    return { ...state, scanning: true };\r\n  }\r\n\r\n  if (scanStopAction.match(action)) {\r\n    return {\r\n      ...state,\r\n      scanning: false,\r\n      scanRange: undefined,\r\n      update: makeInitialUpdateState(),\r\n    };\r\n  }\r\n\r\n  if (setQueriesAction.match(action)) {\r\n    const { queries } = action.payload;\r\n    return {\r\n      ...state,\r\n      queries: queries.slice(),\r\n      queryKeys: getQueryKeys(queries, state.datasourceInstance),\r\n    };\r\n  }\r\n\r\n  if (updateUIStateAction.match(action)) {\r\n    return { ...state, ...action.payload };\r\n  }\r\n\r\n  if (toggleGraphAction.match(action)) {\r\n    const showingGraph = !state.showingGraph;\r\n    if (showingGraph) {\r\n      return { ...state, showingGraph };\r\n    }\r\n\r\n    return { ...state, showingGraph, graphResult: null };\r\n  }\r\n\r\n  if (toggleTableAction.match(action)) {\r\n    const showingTable = !state.showingTable;\r\n    if (showingTable) {\r\n      return { ...state, showingTable };\r\n    }\r\n\r\n    return { ...state, showingTable, tableResult: null };\r\n  }\r\n\r\n  if (queriesImportedAction.match(action)) {\r\n    const { queries } = action.payload;\r\n    return {\r\n      ...state,\r\n      queries,\r\n      queryKeys: getQueryKeys(queries, state.datasourceInstance),\r\n    };\r\n  }\r\n\r\n  if (toggleLogLevelAction.match(action)) {\r\n    const { hiddenLogLevels } = action.payload;\r\n    return {\r\n      ...state,\r\n      hiddenLogLevels: Array.from(hiddenLogLevels),\r\n    };\r\n  }\r\n\r\n  if (historyUpdatedAction.match(action)) {\r\n    return {\r\n      ...state,\r\n      history: action.payload.history,\r\n    };\r\n  }\r\n\r\n  if (setUrlReplacedAction.match(action)) {\r\n    return {\r\n      ...state,\r\n      urlReplaced: true,\r\n    };\r\n  }\r\n\r\n  if (changeRangeAction.match(action)) {\r\n    const { range, absoluteRange } = action.payload;\r\n    return {\r\n      ...state,\r\n      range,\r\n      absoluteRange,\r\n      update: makeInitialUpdateState(),\r\n    };\r\n  }\r\n\r\n  if (changeLoadingStateAction.match(action)) {\r\n    const { loadingState } = action.payload;\r\n    return {\r\n      ...state,\r\n      queryResponse: {\r\n        ...state.queryResponse,\r\n        state: loadingState,\r\n      },\r\n      loading: loadingState === LoadingState.Loading || loadingState === LoadingState.Streaming,\r\n    };\r\n  }\r\n\r\n  if (setPausedStateAction.match(action)) {\r\n    const { isPaused } = action.payload;\r\n    return {\r\n      ...state,\r\n      isPaused: isPaused,\r\n    };\r\n  }\r\n\r\n  if (queryStoreSubscriptionAction.match(action)) {\r\n    const { querySubscription } = action.payload;\r\n    return {\r\n      ...state,\r\n      querySubscription,\r\n    };\r\n  }\r\n\r\n  if (queryStreamUpdatedAction.match(action)) {\r\n    return processQueryResponse(state, action);\r\n  }\r\n\r\n  return state;\r\n};\r\n\r\nexport const processQueryResponse = (\r\n  state: ExploreItemState,\r\n  action: PayloadAction<QueryEndedPayload>\r\n): ExploreItemState => {\r\n  const { response } = action.payload;\r\n  const { request, state: loadingState, series, error } = response;\r\n\r\n  if (error) {\r\n    if (error.cancelled) {\r\n      return state;\r\n    }\r\n\r\n    // For Angular editors\r\n    state.eventBridge.emit(PanelEvents.dataError, error);\r\n\r\n    return {\r\n      ...state,\r\n      loading: false,\r\n      queryResponse: response,\r\n      graphResult: null,\r\n      tableResult: null,\r\n      logsResult: null,\r\n      update: makeInitialUpdateState(),\r\n    };\r\n  }\r\n\r\n  const latency = request.endTime ? request.endTime - request.startTime : 0;\r\n  const processor = new ResultProcessor(state, series, request.intervalMs, request.timezone as TimeZone);\r\n  const graphResult = processor.getGraphResult();\r\n  const tableResult = processor.getTableResult();\r\n  const logsResult = processor.getLogsResult();\r\n\r\n  // Send legacy data to Angular editors\r\n  if (state.datasourceInstance.components.QueryCtrl) {\r\n    const legacy = series.map(v => toLegacyResponseData(v));\r\n\r\n    state.eventBridge.emit(PanelEvents.dataReceived, legacy);\r\n  }\r\n\r\n  return {\r\n    ...state,\r\n    latency,\r\n    queryResponse: response,\r\n    graphResult,\r\n    tableResult,\r\n    logsResult,\r\n    loading: loadingState === LoadingState.Loading || loadingState === LoadingState.Streaming,\r\n    update: makeInitialUpdateState(),\r\n  };\r\n};\r\n\r\nexport const updateChildRefreshState = (\r\n  state: Readonly<ExploreItemState>,\r\n  payload: LocationUpdate,\r\n  exploreId: ExploreId\r\n): ExploreItemState => {\r\n  const path = payload.path || '';\r\n  const queryState = payload.query[exploreId] as string;\r\n  if (!queryState) {\r\n    return state;\r\n  }\r\n\r\n  const urlState = parseUrlState(queryState);\r\n  if (!state.urlState || path !== '/explore') {\r\n    // we only want to refresh when browser back/forward\r\n    return {\r\n      ...state,\r\n      urlState,\r\n      update: { datasource: false, queries: false, range: false, mode: false, ui: false },\r\n    };\r\n  }\r\n\r\n  const datasource = _.isEqual(urlState ? urlState.datasource : '', state.urlState.datasource) === false;\r\n  const queries = _.isEqual(urlState ? urlState.queries : [], state.urlState.queries) === false;\r\n  const range = _.isEqual(urlState ? urlState.range : DEFAULT_RANGE, state.urlState.range) === false;\r\n  const mode = _.isEqual(urlState ? urlState.mode : ExploreMode.Metrics, state.urlState.mode) === false;\r\n  const ui = _.isEqual(urlState ? urlState.ui : DEFAULT_UI_STATE, state.urlState.ui) === false;\r\n\r\n  return {\r\n    ...state,\r\n    urlState,\r\n    update: {\r\n      ...state.update,\r\n      datasource,\r\n      queries,\r\n      range,\r\n      mode,\r\n      ui,\r\n    },\r\n  };\r\n};\r\n\r\nconst getModesForDatasource = (dataSource: DataSourceApi, currentMode: ExploreMode): [ExploreMode[], ExploreMode] => {\r\n  const supportsGraph = dataSource.meta.metrics;\r\n  const supportsLogs = dataSource.meta.logs;\r\n\r\n  let mode = currentMode || ExploreMode.Metrics;\r\n  const supportedModes: ExploreMode[] = [];\r\n\r\n  if (supportsGraph) {\r\n    supportedModes.push(ExploreMode.Metrics);\r\n  }\r\n\r\n  if (supportsLogs) {\r\n    supportedModes.push(ExploreMode.Logs);\r\n  }\r\n\r\n  if (supportedModes.length === 1) {\r\n    mode = supportedModes[0];\r\n  }\r\n\r\n  // HACK: Used to set Loki's default explore mode to Logs mode.\r\n  // A better solution would be to introduce a \"default\" or \"preferred\" mode to the datasource config\r\n  if (dataSource.meta.name === 'Loki' && !currentMode) {\r\n    mode = ExploreMode.Logs;\r\n  }\r\n\r\n  return [supportedModes, mode];\r\n};\r\n\r\n/**\r\n * Global Explore reducer that handles multiple Explore areas (left and right).\r\n * Actions that have an `exploreId` get routed to the ExploreItemReducer.\r\n */\r\nexport const exploreReducer = (state = initialExploreState, action: AnyAction): ExploreState => {\r\n  if (splitCloseAction.match(action)) {\r\n    const { itemId } = action.payload as SplitCloseActionPayload;\r\n    const targetSplit = {\r\n      left: itemId === ExploreId.left ? state.right : state.left,\r\n      right: initialExploreState.right,\r\n    };\r\n    return {\r\n      ...state,\r\n      ...targetSplit,\r\n      split: false,\r\n    };\r\n  }\r\n\r\n  if (splitOpenAction.match(action)) {\r\n    return { ...state, split: true, right: { ...action.payload.itemState } };\r\n  }\r\n\r\n  if (syncTimesAction.match(action)) {\r\n    return { ...state, syncedTimes: action.payload.syncedTimes };\r\n  }\r\n\r\n  if (resetExploreAction.match(action)) {\r\n    const payload: ResetExplorePayload = action.payload;\r\n    const leftState = state[ExploreId.left];\r\n    const rightState = state[ExploreId.right];\r\n    stopQueryState(leftState.querySubscription);\r\n    stopQueryState(rightState.querySubscription);\r\n\r\n    if (payload.force || !Number.isInteger(state.left.originPanelId)) {\r\n      return initialExploreState;\r\n    }\r\n\r\n    return {\r\n      ...initialExploreState,\r\n      left: {\r\n        ...initialExploreItemState,\r\n        queries: state.left.queries,\r\n        originPanelId: state.left.originPanelId,\r\n      },\r\n    };\r\n  }\r\n\r\n  if (updateLocation.match(action)) {\r\n    const payload: LocationUpdate = action.payload;\r\n    const { query } = payload;\r\n    if (!query || !query[ExploreId.left]) {\r\n      return state;\r\n    }\r\n\r\n    const split = query[ExploreId.right] ? true : false;\r\n    const leftState = state[ExploreId.left];\r\n    const rightState = state[ExploreId.right];\r\n\r\n    return {\r\n      ...state,\r\n      split,\r\n      [ExploreId.left]: updateChildRefreshState(leftState, payload, ExploreId.left),\r\n      [ExploreId.right]: updateChildRefreshState(rightState, payload, ExploreId.right),\r\n    };\r\n  }\r\n\r\n  if (action.payload) {\r\n    const { exploreId } = action.payload;\r\n    if (exploreId !== undefined) {\r\n      // @ts-ignore\r\n      const exploreItemState = state[exploreId];\r\n      return { ...state, [exploreId]: itemReducer(exploreItemState, action as any) };\r\n    }\r\n  }\r\n\r\n  return state;\r\n};\r\n\r\nexport default {\r\n  explore: exploreReducer,\r\n};\r\n","import {\r\n  LogsModel,\r\n  GraphSeriesXY,\r\n  DataFrame,\r\n  FieldType,\r\n  TimeZone,\r\n  toDataFrame,\r\n  getDisplayProcessor,\r\n} from '@grafana/data';\r\nimport { ExploreItemState, ExploreMode } from 'app/types/explore';\r\nimport TableModel, { mergeTablesIntoModel } from 'app/core/table_model';\r\nimport { sortLogsResult, refreshIntervalToSortOrder } from 'app/core/utils/explore';\r\nimport { dataFrameToLogsModel } from 'app/core/logs_model';\r\nimport { getGraphSeriesModel } from 'app/plugins/panel/graph2/getGraphSeriesModel';\r\nimport { config } from 'app/core/config';\r\n\r\nexport class ResultProcessor {\r\n  constructor(\r\n    private state: ExploreItemState,\r\n    private dataFrames: DataFrame[],\r\n    private intervalMs: number,\r\n    private timeZone: TimeZone\r\n  ) {}\r\n\r\n  getGraphResult(): GraphSeriesXY[] | null {\r\n    if (this.state.mode !== ExploreMode.Metrics) {\r\n      return null;\r\n    }\r\n\r\n    const onlyTimeSeries = this.dataFrames.filter(isTimeSeries);\r\n\r\n    if (onlyTimeSeries.length === 0) {\r\n      return null;\r\n    }\r\n\r\n    return getGraphSeriesModel(\r\n      onlyTimeSeries,\r\n      this.timeZone,\r\n      {},\r\n      { showBars: false, showLines: true, showPoints: false },\r\n      { asTable: false, isVisible: true, placement: 'under' }\r\n    );\r\n  }\r\n\r\n  getTableResult(): DataFrame | null {\r\n    if (this.state.mode !== ExploreMode.Metrics) {\r\n      return null;\r\n    }\r\n\r\n    // For now ignore time series\r\n    // We can change this later, just need to figure out how to\r\n    // Ignore time series only for prometheus\r\n    const onlyTables = this.dataFrames.filter(frame => !isTimeSeries(frame));\r\n\r\n    if (onlyTables.length === 0) {\r\n      return null;\r\n    }\r\n\r\n    const tables = onlyTables.map(frame => {\r\n      const { fields } = frame;\r\n      const fieldCount = fields.length;\r\n      const rowCount = frame.length;\r\n\r\n      const columns = fields.map(field => ({\r\n        text: field.name,\r\n        type: field.type,\r\n        filterable: field.config.filterable,\r\n      }));\r\n\r\n      const rows: any[][] = [];\r\n      for (let i = 0; i < rowCount; i++) {\r\n        const row: any[] = [];\r\n        for (let j = 0; j < fieldCount; j++) {\r\n          row.push(frame.fields[j].values.get(i));\r\n        }\r\n        rows.push(row);\r\n      }\r\n\r\n      return new TableModel({\r\n        columns,\r\n        rows,\r\n        meta: frame.meta,\r\n      });\r\n    });\r\n\r\n    const mergedTable = mergeTablesIntoModel(new TableModel(), ...tables);\r\n    const data = toDataFrame(mergedTable);\r\n\r\n    // set display processor\r\n    for (const field of data.fields) {\r\n      field.display = getDisplayProcessor({\r\n        field,\r\n        theme: config.theme,\r\n      });\r\n    }\r\n\r\n    return data;\r\n  }\r\n\r\n  getLogsResult(): LogsModel | null {\r\n    if (this.state.mode !== ExploreMode.Logs) {\r\n      return null;\r\n    }\r\n\r\n    const newResults = dataFrameToLogsModel(this.dataFrames, this.intervalMs, this.timeZone);\r\n    const sortOrder = refreshIntervalToSortOrder(this.state.refreshInterval);\r\n    const sortedNewResults = sortLogsResult(newResults, sortOrder);\r\n    const rows = sortedNewResults.rows;\r\n    const series = sortedNewResults.series;\r\n    return { ...sortedNewResults, rows, series };\r\n  }\r\n}\r\n\r\nexport function isTimeSeries(frame: DataFrame): boolean {\r\n  if (frame.fields.length === 2) {\r\n    if (frame.fields[1].type === FieldType.time) {\r\n      return true;\r\n    }\r\n  }\r\n\r\n  return false;\r\n}\r\n","import { DataSourceInstanceSettings, DataSourcePluginMeta } from '@grafana/data';\r\nimport { ExpressionQuery, GELQueryType } from './types';\r\nimport { ExpressionQueryEditor } from './ExpressionQueryEditor';\r\nimport { DataSourceWithBackend } from '@grafana/runtime';\r\n\r\n/**\r\n * This is a singleton instance that just pretends to be a DataSource\r\n */\r\nexport class ExpressionDatasourceApi extends DataSourceWithBackend<ExpressionQuery> {\r\n  constructor(instanceSettings: DataSourceInstanceSettings) {\r\n    super(instanceSettings);\r\n  }\r\n\r\n  getCollapsedText(query: ExpressionQuery) {\r\n    return `Expression: ${query.type}`;\r\n  }\r\n\r\n  newQuery(): ExpressionQuery {\r\n    return {\r\n      refId: '--', // Replaced with query\r\n      type: GELQueryType.math,\r\n      datasource: ExpressionDatasourceID,\r\n    };\r\n  }\r\n}\r\n\r\n// MATCHES the constant in DataSourceWithBackend\r\nexport const ExpressionDatasourceID = '__expr__';\r\n\r\nexport const expressionDatasource = new ExpressionDatasourceApi({\r\n  id: -100,\r\n  name: ExpressionDatasourceID,\r\n} as DataSourceInstanceSettings);\r\nexpressionDatasource.meta = {\r\n  id: ExpressionDatasourceID,\r\n  info: {\r\n    logos: {\r\n      small: 'public/img/icn-datasource.svg',\r\n      large: 'public/img/icn-datasource.svg',\r\n    },\r\n  },\r\n} as DataSourcePluginMeta;\r\nexpressionDatasource.components = {\r\n  QueryEditor: ExpressionQueryEditor,\r\n};\r\n","// Libraries\r\nimport React, { PureComponent, ChangeEvent } from 'react';\r\n\r\nimport { FormLabel, Select, FormField } from '@grafana/ui';\r\nimport { SelectableValue, ReducerID, QueryEditorProps } from '@grafana/data';\r\n\r\n// Types\r\nimport { ExpressionQuery, GELQueryType } from './types';\r\nimport { ExpressionDatasourceApi } from './ExpressionDatasource';\r\n\r\ntype Props = QueryEditorProps<ExpressionDatasourceApi, ExpressionQuery>;\r\n\r\ninterface State {}\r\n\r\nconst gelTypes: Array<SelectableValue<GELQueryType>> = [\r\n  { value: GELQueryType.math, label: 'Math' },\r\n  { value: GELQueryType.reduce, label: 'Reduce' },\r\n  { value: GELQueryType.resample, label: 'Resample' },\r\n];\r\n\r\nconst reducerTypes: Array<SelectableValue<string>> = [\r\n  { value: ReducerID.min, label: 'Min', description: 'Get the minimum value' },\r\n  { value: ReducerID.max, label: 'Max', description: 'Get the maximum value' },\r\n  { value: ReducerID.mean, label: 'Mean', description: 'Get the average value' },\r\n  { value: ReducerID.sum, label: 'Sum', description: 'Get the sum of all values' },\r\n  { value: ReducerID.count, label: 'Count', description: 'Get the number of values' },\r\n];\r\n\r\nconst downsamplingTypes: Array<SelectableValue<string>> = [\r\n  { value: ReducerID.min, label: 'Min', description: 'Fill with the minimum value' },\r\n  { value: ReducerID.max, label: 'Max', description: 'Fill with the maximum value' },\r\n  { value: ReducerID.mean, label: 'Mean', description: 'Fill with the average value' },\r\n  { value: ReducerID.sum, label: 'Sum', description: 'Fill with the sum of all values' },\r\n];\r\n\r\nconst upsamplingTypes: Array<SelectableValue<string>> = [\r\n  { value: 'pad', label: 'pad', description: 'fill with the last known value' },\r\n  { value: 'backfilling', label: 'backfilling', description: 'fill with the next known value' },\r\n  { value: 'fillna', label: 'fillna', description: 'Fill with NaNs' },\r\n];\r\n\r\nexport class ExpressionQueryEditor extends PureComponent<Props, State> {\r\n  state = {};\r\n\r\n  onSelectGELType = (item: SelectableValue<GELQueryType>) => {\r\n    const { query, onChange } = this.props;\r\n    const q = {\r\n      ...query,\r\n      type: item.value!,\r\n    };\r\n\r\n    if (q.type === GELQueryType.reduce) {\r\n      if (!q.reducer) {\r\n        q.reducer = ReducerID.mean;\r\n      }\r\n      q.expression = undefined;\r\n    } else if (q.type === GELQueryType.resample) {\r\n      if (!q.downsampler) {\r\n        q.downsampler = ReducerID.mean;\r\n      }\r\n      if (!q.upsampler) {\r\n        q.upsampler = 'fillna';\r\n      }\r\n      q.reducer = undefined;\r\n    } else {\r\n      q.reducer = undefined;\r\n    }\r\n\r\n    onChange(q);\r\n  };\r\n\r\n  onSelectReducer = (item: SelectableValue<string>) => {\r\n    const { query, onChange } = this.props;\r\n    onChange({\r\n      ...query,\r\n      reducer: item.value!,\r\n    });\r\n  };\r\n\r\n  onSelectUpsampler = (item: SelectableValue<string>) => {\r\n    const { query, onChange } = this.props;\r\n    onChange({\r\n      ...query,\r\n      upsampler: item.value!,\r\n    });\r\n  };\r\n\r\n  onSelectDownsampler = (item: SelectableValue<string>) => {\r\n    const { query, onChange } = this.props;\r\n    onChange({\r\n      ...query,\r\n      downsampler: item.value!,\r\n    });\r\n  };\r\n\r\n  onRuleReducer = (item: SelectableValue<string>) => {\r\n    const { query, onChange } = this.props;\r\n    onChange({\r\n      ...query,\r\n      rule: item.value!,\r\n    });\r\n  };\r\n\r\n  onExpressionChange = (evt: ChangeEvent<any>) => {\r\n    const { query, onChange } = this.props;\r\n    onChange({\r\n      ...query,\r\n      expression: evt.target.value,\r\n    });\r\n  };\r\n\r\n  onRuleChange = (evt: ChangeEvent<any>) => {\r\n    const { query, onChange } = this.props;\r\n    onChange({\r\n      ...query,\r\n      rule: evt.target.value,\r\n    });\r\n  };\r\n\r\n  render() {\r\n    const { query } = this.props;\r\n    const selected = gelTypes.find(o => o.value === query.type);\r\n    const reducer = reducerTypes.find(o => o.value === query.reducer);\r\n    const downsampler = downsamplingTypes.find(o => o.value === query.downsampler);\r\n    const upsampler = upsamplingTypes.find(o => o.value === query.upsampler);\r\n\r\n    return (\r\n      <div>\r\n        <div className=\"form-field\">\r\n          <Select options={gelTypes} value={selected} onChange={this.onSelectGELType} />\r\n          {query.type === GELQueryType.reduce && (\r\n            <>\r\n              <FormLabel width={5}>Function:</FormLabel>\r\n              <Select options={reducerTypes} value={reducer} onChange={this.onSelectReducer} />\r\n              <FormField label=\"Fields:\" labelWidth={5} onChange={this.onExpressionChange} value={query.expression} />\r\n            </>\r\n          )}\r\n        </div>\r\n        {query.type === GELQueryType.math && (\r\n          <textarea value={query.expression} onChange={this.onExpressionChange} className=\"gf-form-input\" rows={2} />\r\n        )}\r\n        {query.type === GELQueryType.resample && (\r\n          <>\r\n            <div>\r\n              <FormField label=\"Series:\" labelWidth={5} onChange={this.onExpressionChange} value={query.expression} />\r\n              <FormField label=\"Rule:\" labelWidth={5} onChange={this.onRuleChange} value={query.rule} />\r\n            </div>\r\n            <div>\r\n              <FormLabel width={12}>Downsample Function:</FormLabel>\r\n              <Select options={downsamplingTypes} value={downsampler} onChange={this.onSelectDownsampler} />\r\n              <FormLabel width={12}>Upsample Function:</FormLabel>\r\n              <Select options={upsamplingTypes} value={upsampler} onChange={this.onSelectUpsampler} />\r\n            </div>\r\n          </>\r\n        )}\r\n      </div>\r\n    );\r\n  }\r\n}\r\n","import { DataQuery } from '@grafana/data';\r\n\r\nexport enum GELQueryType {\r\n  math = 'math',\r\n  reduce = 'reduce',\r\n  resample = 'resample',\r\n}\r\n\r\n/**\r\n * For now this is a single object to cover all the types.... would likely\r\n * want to split this up by type as the complexity increases\r\n */\r\nexport interface ExpressionQuery extends DataQuery {\r\n  type: GELQueryType;\r\n  reducer?: string;\r\n  expression?: string;\r\n  rule?: string;\r\n  downsampler?: string;\r\n  upsampler?: string;\r\n}\r\n","import appEvents from 'app/core/app_events';\r\nimport locationUtil from 'app/core/utils/location_util';\r\nimport { BackendSrv } from 'app/core/services/backend_srv';\r\nimport { ILocationService } from 'angular';\r\nimport { ValidationSrv } from 'app/features/manage-dashboards';\r\nimport { NavModelSrv } from 'app/core/nav_model_srv';\r\nimport { AppEvents } from '@grafana/data';\r\n\r\nexport default class CreateFolderCtrl {\r\n  title = '';\r\n  navModel: any;\r\n  titleTouched = false;\r\n  hasValidationError: boolean;\r\n  validationError: any;\r\n\r\n  /** @ngInject */\r\n  constructor(\r\n    private backendSrv: BackendSrv,\r\n    private $location: ILocationService,\r\n    private validationSrv: ValidationSrv,\r\n    navModelSrv: NavModelSrv\r\n  ) {\r\n    this.navModel = navModelSrv.getNav('dashboards', 'manage-dashboards', 0);\r\n  }\r\n\r\n  create() {\r\n    if (this.hasValidationError) {\r\n      return;\r\n    }\r\n\r\n    return this.backendSrv.createFolder({ title: this.title }).then((result: any) => {\r\n      appEvents.emit(AppEvents.alertSuccess, ['Folder Created', 'OK']);\r\n      this.$location.url(locationUtil.stripBaseFromUrl(result.url));\r\n    });\r\n  }\r\n\r\n  titleChanged() {\r\n    this.titleTouched = true;\r\n\r\n    this.validationSrv\r\n      .validateNewFolderName(this.title)\r\n      .then(() => {\r\n        this.hasValidationError = false;\r\n      })\r\n      .catch(err => {\r\n        this.hasValidationError = true;\r\n        this.validationError = err.message;\r\n      });\r\n  }\r\n}\r\n","import { FolderPageLoader } from './services/FolderPageLoader';\r\nimport locationUtil from 'app/core/utils/location_util';\r\nimport { NavModelSrv } from 'app/core/core';\r\nimport { ILocationService } from 'angular';\r\n\r\nexport default class FolderDashboardsCtrl {\r\n  navModel: any;\r\n  folderId: number;\r\n  uid: string;\r\n\r\n  /** @ngInject */\r\n  constructor(\r\n    private backendSrv: any,\r\n    navModelSrv: NavModelSrv,\r\n    private $routeParams: any,\r\n    $location: ILocationService\r\n  ) {\r\n    if (this.$routeParams.uid) {\r\n      this.uid = $routeParams.uid;\r\n\r\n      const loader = new FolderPageLoader(this.backendSrv);\r\n\r\n      loader.load(this, this.uid, 'manage-folder-dashboards').then((folder: any) => {\r\n        const url = locationUtil.stripBaseFromUrl(folder.url);\r\n\r\n        if (url !== $location.path()) {\r\n          $location.path(url).replace();\r\n        }\r\n      });\r\n    }\r\n  }\r\n}\r\n","import { BackendSrv } from 'app/core/services/backend_srv';\r\n\r\nexport class FolderPageLoader {\r\n  constructor(private backendSrv: BackendSrv) {}\r\n\r\n  load(ctrl: any, uid: any, activeChildId: any) {\r\n    ctrl.navModel = {\r\n      main: {\r\n        icon: 'fa fa-folder-open',\r\n        id: 'manage-folder',\r\n        subTitle: 'Manage folder dashboards & permissions',\r\n        url: '',\r\n        text: '',\r\n        breadcrumbs: [{ title: 'Dashboards', url: 'dashboards' }],\r\n        children: [\r\n          {\r\n            active: activeChildId === 'manage-folder-dashboards',\r\n            icon: 'fa fa-fw fa-th-large',\r\n            id: 'manage-folder-dashboards',\r\n            text: 'Dashboards',\r\n            url: 'dashboards',\r\n          },\r\n          {\r\n            active: activeChildId === 'manage-folder-permissions',\r\n            icon: 'fa fa-fw fa-lock',\r\n            id: 'manage-folder-permissions',\r\n            text: 'Permissions',\r\n            url: 'dashboards/permissions',\r\n          },\r\n          {\r\n            active: activeChildId === 'manage-folder-settings',\r\n            icon: 'gicon gicon-cog',\r\n            id: 'manage-folder-settings',\r\n            text: 'Settings',\r\n            url: 'dashboards/settings',\r\n          },\r\n        ],\r\n      },\r\n    };\r\n\r\n    return this.backendSrv.getFolderByUid(uid).then((folder: any) => {\r\n      ctrl.folderId = folder.id;\r\n      const folderTitle = folder.title;\r\n      const folderUrl = folder.url;\r\n      ctrl.navModel.main.text = folderTitle;\r\n\r\n      const dashTab = ctrl.navModel.main.children.find((child: any) => child.id === 'manage-folder-dashboards');\r\n      dashTab.url = folderUrl;\r\n\r\n      if (folder.canAdmin) {\r\n        const permTab = ctrl.navModel.main.children.find((child: any) => child.id === 'manage-folder-permissions');\r\n        permTab.url = folderUrl + '/permissions';\r\n\r\n        const settingsTab = ctrl.navModel.main.children.find((child: any) => child.id === 'manage-folder-settings');\r\n        settingsTab.url = folderUrl + '/settings';\r\n      } else {\r\n        ctrl.navModel.main.children = [dashTab];\r\n      }\r\n\r\n      return folder;\r\n    });\r\n  }\r\n}\r\n","import { createSlice, PayloadAction } from '@reduxjs/toolkit';\n\nimport { DashboardAclDTO, FolderDTO, FolderState } from 'app/types';\nimport { processAclItems } from 'app/core/utils/acl';\n\nexport const initialState: FolderState = {\n  id: 0,\n  uid: 'loading',\n  title: 'loading',\n  url: '',\n  canSave: false,\n  hasChanged: false,\n  version: 1,\n  permissions: [],\n};\n\nconst folderSlice = createSlice({\n  name: 'folder',\n  initialState,\n  reducers: {\n    loadFolder: (state, action: PayloadAction<FolderDTO>): FolderState => {\n      return {\n        ...state,\n        ...action.payload,\n        hasChanged: false,\n      };\n    },\n    setFolderTitle: (state, action: PayloadAction<string>): FolderState => {\n      return {\n        ...state,\n        title: action.payload,\n        hasChanged: action.payload.trim().length > 0,\n      };\n    },\n    loadFolderPermissions: (state, action: PayloadAction<DashboardAclDTO[]>): FolderState => {\n      return {\n        ...state,\n        permissions: processAclItems(action.payload),\n      };\n    },\n  },\n});\n\nexport const { loadFolderPermissions, loadFolder, setFolderTitle } = folderSlice.actions;\n\nexport const folderReducer = folderSlice.reducer;\n\nexport default {\n  folder: folderReducer,\n};\n","import _ from 'lodash';\r\nimport config from 'app/core/config';\r\nimport locationUtil from 'app/core/utils/location_util';\r\nimport { BackendSrv } from '@grafana/runtime';\r\nimport { ValidationSrv } from './services/ValidationSrv';\r\nimport { NavModelSrv } from 'app/core/core';\r\nimport { ILocationService } from 'angular';\r\n\r\nexport class DashboardImportCtrl {\r\n  navModel: any;\r\n  step: number;\r\n  jsonText: string;\r\n  parseError: string;\r\n  nameExists: boolean;\r\n  uidExists: boolean;\r\n  dash: any;\r\n  inputs: any[];\r\n  inputsValid: boolean;\r\n  gnetUrl: string;\r\n  gnetError: string;\r\n  gnetInfo: any;\r\n  titleTouched: boolean;\r\n  hasNameValidationError: boolean;\r\n  nameValidationError: any;\r\n  hasUidValidationError: boolean;\r\n  uidValidationError: any;\r\n  autoGenerateUid: boolean;\r\n  autoGenerateUidValue: string;\r\n  folderId: number;\r\n  initialFolderTitle: string;\r\n  isValidFolderSelection: boolean;\r\n\r\n  /** @ngInject */\r\n  constructor(\r\n    private backendSrv: BackendSrv,\r\n    private validationSrv: ValidationSrv,\r\n    navModelSrv: NavModelSrv,\r\n    private $location: ILocationService,\r\n    $routeParams: any\r\n  ) {\r\n    this.navModel = navModelSrv.getNav('create', 'import');\r\n\r\n    this.step = 1;\r\n    this.nameExists = false;\r\n    this.uidExists = false;\r\n    this.autoGenerateUid = true;\r\n    this.autoGenerateUidValue = 'auto-generated';\r\n    this.folderId = $routeParams.folderId ? Number($routeParams.folderId) || 0 : null;\r\n    this.initialFolderTitle = 'Select a folder';\r\n\r\n    // check gnetId in url\r\n    if ($routeParams.gnetId) {\r\n      this.gnetUrl = $routeParams.gnetId;\r\n      this.checkGnetDashboard();\r\n    }\r\n  }\r\n\r\n  onUpload(dash: any) {\r\n    this.dash = dash;\r\n    this.dash.id = null;\r\n    this.step = 2;\r\n    this.inputs = [];\r\n\r\n    if (this.dash.__inputs) {\r\n      for (const input of this.dash.__inputs) {\r\n        const inputModel: any = {\r\n          name: input.name,\r\n          label: input.label,\r\n          info: input.description,\r\n          value: input.value,\r\n          type: input.type,\r\n          pluginId: input.pluginId,\r\n          options: [],\r\n        };\r\n\r\n        if (input.type === 'datasource') {\r\n          this.setDatasourceOptions(input, inputModel);\r\n        } else if (!inputModel.info) {\r\n          inputModel.info = 'Specify a string constant';\r\n        }\r\n\r\n        this.inputs.push(inputModel);\r\n      }\r\n    }\r\n\r\n    this.inputsValid = this.inputs.length === 0;\r\n    this.titleChanged();\r\n    this.uidChanged(true);\r\n  }\r\n\r\n  setDatasourceOptions(input: { pluginId: string; pluginName: string }, inputModel: any) {\r\n    const sources = _.filter(config.datasources, val => {\r\n      return val.type === input.pluginId;\r\n    });\r\n\r\n    if (sources.length === 0) {\r\n      inputModel.info = 'No data sources of type ' + input.pluginName + ' found';\r\n    } else if (!inputModel.info) {\r\n      inputModel.info = 'Select a ' + input.pluginName + ' data source';\r\n    }\r\n\r\n    inputModel.options = sources.map(val => {\r\n      return { text: val.name, value: val.name };\r\n    });\r\n  }\r\n\r\n  inputValueChanged() {\r\n    this.inputsValid = true;\r\n    for (const input of this.inputs) {\r\n      if (!input.value) {\r\n        this.inputsValid = false;\r\n      }\r\n    }\r\n  }\r\n\r\n  titleChanged() {\r\n    this.titleTouched = true;\r\n    this.nameExists = false;\r\n\r\n    this.validationSrv\r\n      .validateNewDashboardName(this.folderId, this.dash.title)\r\n      .then(() => {\r\n        this.nameExists = false;\r\n        this.hasNameValidationError = false;\r\n      })\r\n      .catch(err => {\r\n        if (err.type === 'EXISTING') {\r\n          this.nameExists = true;\r\n        }\r\n\r\n        this.hasNameValidationError = true;\r\n        this.nameValidationError = err.message;\r\n      });\r\n  }\r\n\r\n  uidChanged(initial: boolean) {\r\n    this.uidExists = false;\r\n    this.hasUidValidationError = false;\r\n\r\n    if (initial === true && this.dash.uid) {\r\n      this.autoGenerateUidValue = 'value set';\r\n    }\r\n\r\n    if (!this.dash.uid) {\r\n      return;\r\n    }\r\n\r\n    this.backendSrv\r\n      // @ts-ignore\r\n      .getDashboardByUid(this.dash.uid)\r\n      .then((res: any) => {\r\n        this.uidExists = true;\r\n        this.hasUidValidationError = true;\r\n        this.uidValidationError = `Dashboard named '${res.dashboard.title}' in folder '${res.meta.folderTitle}' has the same uid`;\r\n      })\r\n      .catch((err: any) => {\r\n        err.isHandled = true;\r\n      });\r\n  }\r\n\r\n  onFolderChange(folder: any) {\r\n    this.folderId = folder.id;\r\n    this.titleChanged();\r\n  }\r\n\r\n  onEnterFolderCreation() {\r\n    this.inputsValid = false;\r\n  }\r\n\r\n  onExitFolderCreation() {\r\n    this.inputValueChanged();\r\n  }\r\n\r\n  isValid() {\r\n    return this.inputsValid && this.folderId !== null;\r\n  }\r\n\r\n  saveDashboard() {\r\n    const inputs = this.inputs.map(input => {\r\n      return {\r\n        name: input.name,\r\n        type: input.type,\r\n        pluginId: input.pluginId,\r\n        value: input.value,\r\n      };\r\n    });\r\n\r\n    return this.backendSrv\r\n      .post('api/dashboards/import', {\r\n        dashboard: this.dash,\r\n        overwrite: true,\r\n        inputs: inputs,\r\n        folderId: this.folderId,\r\n      })\r\n      .then(res => {\r\n        const dashUrl = locationUtil.stripBaseFromUrl(res.importedUrl);\r\n        this.$location.url(dashUrl);\r\n      });\r\n  }\r\n\r\n  loadJsonText() {\r\n    try {\r\n      this.parseError = '';\r\n      const dash = JSON.parse(this.jsonText);\r\n      this.onUpload(dash);\r\n    } catch (err) {\r\n      console.log(err);\r\n      this.parseError = err.message;\r\n      return;\r\n    }\r\n  }\r\n\r\n  checkGnetDashboard() {\r\n    this.gnetError = '';\r\n\r\n    const match = /(^\\d+$)|dashboards\\/(\\d+)/.exec(this.gnetUrl);\r\n    let dashboardId;\r\n\r\n    if (match && match[1]) {\r\n      dashboardId = match[1];\r\n    } else if (match && match[2]) {\r\n      dashboardId = match[2];\r\n    } else {\r\n      this.gnetError = 'Could not find dashboard';\r\n    }\r\n\r\n    return this.backendSrv\r\n      .get('api/gnet/dashboards/' + dashboardId)\r\n      .then(res => {\r\n        this.gnetInfo = res;\r\n        // store reference to grafana.com\r\n        res.json.gnetId = res.id;\r\n        this.onUpload(res.json);\r\n      })\r\n      .catch(err => {\r\n        err.isHandled = true;\r\n        this.gnetError = err.data.message || err;\r\n      });\r\n  }\r\n\r\n  back() {\r\n    this.gnetUrl = '';\r\n    this.step = 1;\r\n    this.gnetError = '';\r\n    this.gnetInfo = '';\r\n  }\r\n}\r\n\r\nexport default DashboardImportCtrl;\r\n","import { NavModelSrv } from 'app/core/core';\r\n\r\nexport class DashboardListCtrl {\r\n  navModel: any;\r\n\r\n  /** @ngInject */\r\n  constructor(navModelSrv: NavModelSrv) {\r\n    this.navModel = navModelSrv.getNav('dashboards', 'manage-dashboards', 0);\r\n  }\r\n}\r\n","import _ from 'lodash';\r\nimport { NavModelSrv } from 'app/core/core';\r\nimport { ILocationService } from 'angular';\r\nimport { BackendSrv } from '@grafana/runtime';\r\nimport { GrafanaRootScope } from 'app/routes/GrafanaCtrl';\r\nimport { CoreEvents } from 'app/types';\r\n\r\nexport class SnapshotListCtrl {\r\n  navModel: any;\r\n  snapshots: any;\r\n\r\n  /** @ngInject */\r\n  constructor(\r\n    private $rootScope: GrafanaRootScope,\r\n    private backendSrv: BackendSrv,\r\n    navModelSrv: NavModelSrv,\r\n    private $location: ILocationService\r\n  ) {\r\n    this.navModel = navModelSrv.getNav('dashboards', 'snapshots', 0);\r\n    this.backendSrv.get('/api/dashboard/snapshots').then((result: any) => {\r\n      const baseUrl = this.$location.absUrl().replace($location.url(), '');\r\n      this.snapshots = result.map((snapshot: any) => ({\r\n        ...snapshot,\r\n        url: snapshot.externalUrl || `${baseUrl}/dashboard/snapshot/${snapshot.key}`,\r\n      }));\r\n    });\r\n  }\r\n\r\n  removeSnapshotConfirmed(snapshot: any) {\r\n    _.remove(this.snapshots, { key: snapshot.key });\r\n    this.backendSrv.delete('/api/snapshots/' + snapshot.key).then(\r\n      () => {},\r\n      () => {\r\n        this.snapshots.push(snapshot);\r\n      }\r\n    );\r\n  }\r\n\r\n  removeSnapshot(snapshot: any) {\r\n    this.$rootScope.appEvent(CoreEvents.showConfirmModal, {\r\n      title: 'Delete',\r\n      text: 'Are you sure you want to delete snapshot ' + snapshot.name + '?',\r\n      yesText: 'Delete',\r\n      icon: 'fa-trash',\r\n      onConfirm: () => {\r\n        this.removeSnapshotConfirmed(snapshot);\r\n      },\r\n    });\r\n  }\r\n}\r\n","import coreModule from 'app/core/core_module';\r\nimport appEvents from 'app/core/app_events';\r\nimport { BackendSrv } from 'app/core/services/backend_srv';\r\nimport { AppEvents } from '@grafana/data';\r\n\r\nexport class MoveToFolderCtrl {\r\n  dashboards: any;\r\n  folder: any;\r\n  dismiss: any;\r\n  afterSave: any;\r\n  isValidFolderSelection = true;\r\n\r\n  /** @ngInject */\r\n  constructor(private backendSrv: BackendSrv) {}\r\n\r\n  onFolderChange(folder: any) {\r\n    this.folder = folder;\r\n  }\r\n\r\n  save() {\r\n    return this.backendSrv.moveDashboards(this.dashboards, this.folder).then((result: any) => {\r\n      if (result.successCount > 0) {\r\n        const header = `Dashboard${result.successCount === 1 ? '' : 's'} Moved`;\r\n        const msg = `${result.successCount} dashboard${result.successCount === 1 ? '' : 's'} moved to ${\r\n          this.folder.title\r\n        }`;\r\n        appEvents.emit(AppEvents.alertSuccess, [header, msg]);\r\n      }\r\n\r\n      if (result.totalCount === result.alreadyInFolderCount) {\r\n        appEvents.emit(AppEvents.alertError, ['Error', `Dashboards already belongs to folder ${this.folder.title}`]);\r\n      }\r\n\r\n      this.dismiss();\r\n      return this.afterSave();\r\n    });\r\n  }\r\n\r\n  onEnterFolderCreation() {\r\n    this.isValidFolderSelection = false;\r\n  }\r\n\r\n  onExitFolderCreation() {\r\n    this.isValidFolderSelection = true;\r\n  }\r\n}\r\n\r\nexport function moveToFolderModal() {\r\n  return {\r\n    restrict: 'E',\r\n    templateUrl: 'public/app/features/manage-dashboards/components/MoveToFolderModal/template.html',\r\n    controller: MoveToFolderCtrl,\r\n    bindToController: true,\r\n    controllerAs: 'ctrl',\r\n    scope: {\r\n      dismiss: '&',\r\n      dashboards: '=',\r\n      afterSave: '&',\r\n    },\r\n  };\r\n}\r\n\r\ncoreModule.directive('moveToFolderModal', moveToFolderModal);\r\n","export { MoveToFolderCtrl } from './MoveToFolderCtrl';\r\n","export { uploadDashboardDirective } from './uploadDashboardDirective';\n","import coreModule from 'app/core/core_module';\r\nimport appEvents from 'app/core/app_events';\r\nimport angular, { ILocationService } from 'angular';\r\nimport { AppEvents } from '@grafana/data';\r\n\r\nconst template = `\r\n<input type=\"file\" id=\"dashupload\" name=\"dashupload\" class=\"hide\" onchange=\"angular.element(this).scope().file_selected\"/>\r\n<label class=\"btn btn-primary\" for=\"dashupload\">\r\n  {{btnText}}\r\n</label>\r\n`;\r\n\r\n/** @ngInject */\r\nexport function uploadDashboardDirective(timer: any, $location: ILocationService) {\r\n  return {\r\n    restrict: 'E',\r\n    template: template,\r\n    scope: {\r\n      onUpload: '&',\r\n      btnText: '@?',\r\n    },\r\n    link: (scope: any, elem: JQuery) => {\r\n      scope.btnText = angular.isDefined(scope.btnText) ? scope.btnText : 'Upload .json file';\r\n\r\n      function file_selected(evt: any) {\r\n        const files = evt.target.files; // FileList object\r\n        const readerOnload = () => {\r\n          return (e: any) => {\r\n            let dash: any;\r\n            try {\r\n              dash = JSON.parse(e.target.result);\r\n            } catch (err) {\r\n              console.log(err);\r\n              appEvents.emit(AppEvents.alertError, [\r\n                'Import failed',\r\n                'JSON -> JS Serialization failed: ' + err.message,\r\n              ]);\r\n              return;\r\n            }\r\n\r\n            scope.$apply(() => {\r\n              scope.onUpload({ dash });\r\n            });\r\n          };\r\n        };\r\n\r\n        let i = 0;\r\n        let file = files[i];\r\n\r\n        while (file) {\r\n          const reader = new FileReader();\r\n          reader.onload = readerOnload();\r\n          reader.readAsText(file);\r\n          i += 1;\r\n          file = files[i];\r\n        }\r\n      }\r\n\r\n      const wnd: any = window;\r\n      // Check for the various File API support.\r\n      if (wnd.File && wnd.FileReader && wnd.FileList && wnd.Blob) {\r\n        // Something\r\n        elem[0].addEventListener('change', file_selected, false);\r\n      } else {\r\n        appEvents.emit(AppEvents.alertError, ['Oops', 'The HTML5 File APIs are not fully supported in this browser']);\r\n      }\r\n    },\r\n  };\r\n}\r\n\r\ncoreModule.directive('dashUpload', uploadDashboardDirective);\r\n","// Services\r\nexport { ValidationSrv } from './services/ValidationSrv';\r\n\r\n// Components\r\nexport * from './components/MoveToFolderModal';\r\nexport * from './components/UploadDashboard';\r\n\r\n// Controllers\r\nimport { DashboardListCtrl } from './DashboardListCtrl';\r\nimport { SnapshotListCtrl } from './SnapshotListCtrl';\r\n\r\nimport coreModule from 'app/core/core_module';\r\n\r\ncoreModule.controller('DashboardListCtrl', DashboardListCtrl);\r\ncoreModule.controller('SnapshotListCtrl', SnapshotListCtrl);\r\n","import coreModule from 'app/core/core_module';\r\nimport { BackendSrv } from 'app/core/services/backend_srv';\r\n\r\nconst hitTypes = {\r\n  FOLDER: 'dash-folder',\r\n  DASHBOARD: 'dash-db',\r\n};\r\n\r\nexport class ValidationSrv {\r\n  rootName = 'general';\r\n\r\n  /** @ngInject */\r\n  constructor(private backendSrv: BackendSrv) {}\r\n\r\n  validateNewDashboardName(folderId: any, name: string) {\r\n    return this.validate(folderId, name, 'A dashboard in this folder with the same name already exists');\r\n  }\r\n\r\n  validateNewFolderName(name: string) {\r\n    return this.validate(0, name, 'A folder or dashboard in the general folder with the same name already exists');\r\n  }\r\n\r\n  private validate(folderId: any, name: string, existingErrorMessage: string) {\r\n    name = (name || '').trim();\r\n    const nameLowerCased = name.toLowerCase();\r\n\r\n    if (name.length === 0) {\r\n      return Promise.reject({\r\n        type: 'REQUIRED',\r\n        message: 'Name is required',\r\n      });\r\n    }\r\n\r\n    if (folderId === 0 && nameLowerCased === this.rootName) {\r\n      return Promise.reject({\r\n        type: 'EXISTING',\r\n        message: 'This is a reserved name and cannot be used for a folder.',\r\n      });\r\n    }\r\n\r\n    const promises = [];\r\n    promises.push(this.backendSrv.search({ type: hitTypes.FOLDER, folderIds: [folderId], query: name }));\r\n    promises.push(this.backendSrv.search({ type: hitTypes.DASHBOARD, folderIds: [folderId], query: name }));\r\n\r\n    return Promise.all(promises).then(res => {\r\n      let hits: any[] = [];\r\n\r\n      if (res.length > 0 && res[0].length > 0) {\r\n        hits = res[0];\r\n      }\r\n\r\n      if (res.length > 1 && res[1].length > 0) {\r\n        hits = hits.concat(res[1]);\r\n      }\r\n\r\n      for (const hit of hits) {\r\n        if (nameLowerCased === hit.title.toLowerCase()) {\r\n          throw {\r\n            type: 'EXISTING',\r\n            message: existingErrorMessage,\r\n          };\r\n        }\r\n      }\r\n\r\n      return;\r\n    });\r\n  }\r\n}\r\n\r\ncoreModule.service('validationSrv', ValidationSrv);\r\n","import angular from 'angular';\r\nimport config from 'app/core/config';\r\nimport { BackendSrv } from 'app/core/services/backend_srv';\r\nimport { NavModelSrv } from 'app/core/core';\r\n\r\nexport class NewOrgCtrl {\r\n  /** @ngInject */\r\n  constructor($scope: any, $http: any, backendSrv: BackendSrv, navModelSrv: NavModelSrv) {\r\n    $scope.navModel = navModelSrv.getNav('admin', 'global-orgs', 0);\r\n    $scope.newOrg = { name: '' };\r\n\r\n    $scope.createOrg = () => {\r\n      backendSrv.post('/api/orgs/', $scope.newOrg).then((result: any) => {\r\n        backendSrv.post('/api/user/using/' + result.orgId).then(() => {\r\n          window.location.href = config.appSubUrl + '/org';\r\n        });\r\n      });\r\n    };\r\n  }\r\n}\r\n\r\nangular.module('grafana.controllers').controller('NewOrgCtrl', NewOrgCtrl);\r\n","import angular from 'angular';\r\nimport config from 'app/core/config';\r\nimport { BackendSrv } from 'app/core/services/backend_srv';\r\n\r\nexport class SelectOrgCtrl {\r\n  /** @ngInject */\r\n  constructor($scope: any, backendSrv: BackendSrv, contextSrv: any) {\r\n    contextSrv.sidemenu = false;\r\n\r\n    $scope.navModel = {\r\n      main: {\r\n        icon: 'gicon gicon-branding',\r\n        subTitle: 'Preferences',\r\n        text: 'Select active organization',\r\n      },\r\n    };\r\n\r\n    $scope.init = () => {\r\n      $scope.getUserOrgs();\r\n    };\r\n\r\n    $scope.getUserOrgs = () => {\r\n      backendSrv.get('/api/user/orgs').then((orgs: any) => {\r\n        $scope.orgs = orgs;\r\n      });\r\n    };\r\n\r\n    $scope.setUsingOrg = (org: any) => {\r\n      backendSrv.post('/api/user/using/' + org.orgId).then(() => {\r\n        window.location.href = config.appSubUrl + '/';\r\n      });\r\n    };\r\n\r\n    $scope.init();\r\n  }\r\n}\r\n\r\nangular.module('grafana.controllers').controller('SelectOrgCtrl', SelectOrgCtrl);\r\n","import coreModule from 'app/core/core_module';\r\nimport { BackendSrv } from 'app/core/services/backend_srv';\r\nimport { NavModelSrv } from 'app/core/core';\r\nimport { ILocationService } from 'angular';\r\n\r\nexport class UserInviteCtrl {\r\n  navModel: any;\r\n  invite: any;\r\n  inviteForm: any;\r\n\r\n  /** @ngInject */\r\n  constructor(private backendSrv: BackendSrv, navModelSrv: NavModelSrv, private $location: ILocationService) {\r\n    this.navModel = navModelSrv.getNav('cfg', 'users', 0);\r\n\r\n    this.invite = {\r\n      name: '',\r\n      email: '',\r\n      role: 'Editor',\r\n      sendEmail: true,\r\n    };\r\n  }\r\n\r\n  sendInvite() {\r\n    if (!this.inviteForm.$valid) {\r\n      return;\r\n    }\r\n\r\n    return this.backendSrv.post('/api/org/invites', this.invite).then(() => {\r\n      this.$location.path('org/users/');\r\n    });\r\n  }\r\n}\r\n\r\ncoreModule.controller('UserInviteCtrl', UserInviteCtrl);\r\n","import './SelectOrgCtrl';\r\nimport './NewOrgCtrl';\r\nimport './UserInviteCtrl';\r\n","import { createSlice, PayloadAction } from '@reduxjs/toolkit';\n\nimport { Organization, OrganizationState } from 'app/types';\n\nexport const initialState: OrganizationState = {\n  organization: {} as Organization,\n};\n\nconst organizationSlice = createSlice({\n  name: 'organization',\n  initialState,\n  reducers: {\n    organizationLoaded: (state, action: PayloadAction<Organization>): OrganizationState => {\n      return { ...state, organization: action.payload };\n    },\n    setOrganizationName: (state, action: PayloadAction<string>): OrganizationState => {\n      return { ...state, organization: { ...state.organization, name: action.payload } };\n    },\n  },\n});\n\nexport const { setOrganizationName, organizationLoaded } = organizationSlice.actions;\n\nexport const organizationReducer = organizationSlice.reducer;\n\nexport default {\n  organization: organizationReducer,\n};\n","import './panel_header';\r\nimport './panel_directive';\r\nimport './query_ctrl';\r\nimport './panel_editor_tab';\r\nimport './query_editor_row';\r\nimport './repeat_option';\r\nimport './panellinks/module';\r\n","import _ from 'lodash';\r\n\r\nimport kbn from 'app/core/utils/kbn';\r\n\r\nimport { PanelCtrl } from 'app/features/panel/panel_ctrl';\r\nimport { getExploreUrl } from 'app/core/utils/explore';\r\nimport { applyPanelTimeOverrides, getResolution } from 'app/features/dashboard/utils/panel';\r\nimport { ContextSrv } from 'app/core/services/context_srv';\r\nimport {\r\n  DataFrame,\r\n  DataQueryResponse,\r\n  DataSourceApi,\r\n  LegacyResponseData,\r\n  LoadingState,\r\n  PanelData,\r\n  PanelEvents,\r\n  TimeRange,\r\n  toDataFrameDTO,\r\n  toLegacyResponseData,\r\n} from '@grafana/data';\r\nimport { Unsubscribable } from 'rxjs';\r\nimport { PanelModel } from 'app/features/dashboard/state';\r\nimport { CoreEvents } from 'app/types';\r\n\r\nclass MetricsPanelCtrl extends PanelCtrl {\r\n  scope: any;\r\n  datasource: DataSourceApi;\r\n  $timeout: any;\r\n  contextSrv: ContextSrv;\r\n  datasourceSrv: any;\r\n  timeSrv: any;\r\n  templateSrv: any;\r\n  range: TimeRange;\r\n  interval: any;\r\n  intervalMs: any;\r\n  resolution: any;\r\n  timeInfo?: string;\r\n  skipDataOnInit: boolean;\r\n  dataList: LegacyResponseData[];\r\n  querySubscription?: Unsubscribable;\r\n  useDataFrames = false;\r\n\r\n  constructor($scope: any, $injector: any) {\r\n    super($scope, $injector);\r\n\r\n    this.contextSrv = $injector.get('contextSrv');\r\n    this.datasourceSrv = $injector.get('datasourceSrv');\r\n    this.timeSrv = $injector.get('timeSrv');\r\n    this.templateSrv = $injector.get('templateSrv');\r\n    this.scope = $scope;\r\n    this.panel.datasource = this.panel.datasource || null;\r\n\r\n    this.events.on(PanelEvents.refresh, this.onMetricsPanelRefresh.bind(this));\r\n    this.events.on(PanelEvents.panelTeardown, this.onPanelTearDown.bind(this));\r\n  }\r\n\r\n  private onPanelTearDown() {\r\n    if (this.querySubscription) {\r\n      this.querySubscription.unsubscribe();\r\n      this.querySubscription = null;\r\n    }\r\n  }\r\n\r\n  private onMetricsPanelRefresh() {\r\n    // ignore fetching data if another panel is in fullscreen\r\n    if (this.otherPanelInFullscreenMode()) {\r\n      return;\r\n    }\r\n\r\n    // if we have snapshot data use that\r\n    if (this.panel.snapshotData) {\r\n      this.updateTimeRange();\r\n      let data = this.panel.snapshotData;\r\n      // backward compatibility\r\n      if (!_.isArray(data)) {\r\n        data = data.data;\r\n      }\r\n\r\n      // Defer panel rendering till the next digest cycle.\r\n      // For some reason snapshot panels don't init at this time, so this helps to avoid rendering issues.\r\n      return this.$timeout(() => {\r\n        this.events.emit(PanelEvents.dataSnapshotLoad, data);\r\n      });\r\n    }\r\n\r\n    // clear loading/error state\r\n    delete this.error;\r\n    this.loading = true;\r\n\r\n    // load datasource service\r\n    return this.datasourceSrv\r\n      .get(this.panel.datasource, this.panel.scopedVars)\r\n      .then(this.updateTimeRange.bind(this))\r\n      .then(this.issueQueries.bind(this))\r\n      .catch((err: any) => {\r\n        this.processDataError(err);\r\n      });\r\n  }\r\n\r\n  processDataError(err: any) {\r\n    // if canceled  keep loading set to true\r\n    if (err.cancelled) {\r\n      console.log('Panel request cancelled', err);\r\n      return;\r\n    }\r\n\r\n    this.error = err.message || 'Request Error';\r\n\r\n    if (err.data) {\r\n      if (err.data.message) {\r\n        this.error = err.data.message;\r\n      } else if (err.data.error) {\r\n        this.error = err.data.error;\r\n      }\r\n    }\r\n\r\n    this.angularDirtyCheck();\r\n  }\r\n\r\n  angularDirtyCheck() {\r\n    if (!this.$scope.$root.$$phase) {\r\n      this.$scope.$digest();\r\n    }\r\n  }\r\n\r\n  // Updates the response with information from the stream\r\n  panelDataObserver = {\r\n    next: (data: PanelData) => {\r\n      if (data.state === LoadingState.Error) {\r\n        this.loading = false;\r\n        this.processDataError(data.error);\r\n      }\r\n\r\n      // Ignore data in loading state\r\n      if (data.state === LoadingState.Loading) {\r\n        this.loading = true;\r\n        this.angularDirtyCheck();\r\n        return;\r\n      }\r\n\r\n      if (data.request) {\r\n        const { timeInfo } = data.request;\r\n        if (timeInfo) {\r\n          this.timeInfo = timeInfo;\r\n        }\r\n      }\r\n\r\n      if (data.timeRange) {\r\n        this.range = data.timeRange;\r\n      }\r\n\r\n      if (this.useDataFrames) {\r\n        this.handleDataFrames(data.series);\r\n      } else {\r\n        // Make the results look as if they came directly from a <6.2 datasource request\r\n        const legacy = data.series.map(v => toLegacyResponseData(v));\r\n        this.handleQueryResult({ data: legacy });\r\n      }\r\n\r\n      this.angularDirtyCheck();\r\n    },\r\n  };\r\n\r\n  updateTimeRange(datasource?: DataSourceApi) {\r\n    this.datasource = datasource || this.datasource;\r\n    this.range = this.timeSrv.timeRange();\r\n    this.resolution = getResolution(this.panel);\r\n\r\n    const newTimeData = applyPanelTimeOverrides(this.panel, this.range);\r\n    this.timeInfo = newTimeData.timeInfo;\r\n    this.range = newTimeData.timeRange;\r\n\r\n    this.calculateInterval();\r\n\r\n    return this.datasource;\r\n  }\r\n\r\n  calculateInterval() {\r\n    let intervalOverride = this.panel.interval;\r\n\r\n    // if no panel interval check datasource\r\n    if (intervalOverride) {\r\n      intervalOverride = this.templateSrv.replace(intervalOverride, this.panel.scopedVars);\r\n    } else if (this.datasource && this.datasource.interval) {\r\n      intervalOverride = this.datasource.interval;\r\n    }\r\n\r\n    const res = kbn.calculateInterval(this.range, this.resolution, intervalOverride);\r\n    this.interval = res.interval;\r\n    this.intervalMs = res.intervalMs;\r\n  }\r\n\r\n  issueQueries(datasource: DataSourceApi) {\r\n    this.datasource = datasource;\r\n\r\n    const panel = this.panel as PanelModel;\r\n    const queryRunner = panel.getQueryRunner();\r\n\r\n    if (!this.querySubscription) {\r\n      this.querySubscription = queryRunner.getData().subscribe(this.panelDataObserver);\r\n    }\r\n\r\n    return queryRunner.run({\r\n      datasource: panel.datasource,\r\n      queries: panel.targets,\r\n      panelId: panel.id,\r\n      dashboardId: this.dashboard.id,\r\n      timezone: this.dashboard.timezone,\r\n      timeRange: this.range,\r\n      widthPixels: this.resolution, // The pixel width\r\n      maxDataPoints: panel.maxDataPoints,\r\n      minInterval: panel.interval,\r\n      scopedVars: panel.scopedVars,\r\n      cacheTimeout: panel.cacheTimeout,\r\n      transformations: panel.transformations,\r\n    });\r\n  }\r\n\r\n  handleDataFrames(data: DataFrame[]) {\r\n    this.loading = false;\r\n\r\n    if (this.dashboard && this.dashboard.snapshot) {\r\n      this.panel.snapshotData = data.map(frame => toDataFrameDTO(frame));\r\n    }\r\n\r\n    try {\r\n      this.events.emit(CoreEvents.dataFramesReceived, data);\r\n    } catch (err) {\r\n      this.processDataError(err);\r\n    }\r\n  }\r\n\r\n  handleQueryResult(result: DataQueryResponse) {\r\n    this.loading = false;\r\n\r\n    if (this.dashboard.snapshot) {\r\n      this.panel.snapshotData = result.data;\r\n    }\r\n\r\n    if (!result || !result.data) {\r\n      console.log('Data source query result invalid, missing data field:', result);\r\n      result = { data: [] };\r\n    }\r\n\r\n    try {\r\n      this.events.emit(PanelEvents.dataReceived, result.data);\r\n    } catch (err) {\r\n      this.processDataError(err);\r\n    }\r\n  }\r\n\r\n  async getAdditionalMenuItems() {\r\n    const items = [];\r\n    if (this.contextSrv.hasAccessToExplore() && this.datasource) {\r\n      items.push({\r\n        text: 'Explore',\r\n        icon: 'gicon gicon-explore',\r\n        shortcut: 'x',\r\n        href: await getExploreUrl({\r\n          panel: this.panel,\r\n          panelTargets: this.panel.targets,\r\n          panelDatasource: this.datasource,\r\n          datasourceSrv: this.datasourceSrv,\r\n          timeSrv: this.timeSrv,\r\n        }),\r\n      });\r\n    }\r\n    return items;\r\n  }\r\n}\r\n\r\nexport { MetricsPanelCtrl };\r\n","import _ from 'lodash';\r\nimport { escapeHtml, sanitize } from 'app/core/utils/text';\r\n\r\nimport config from 'app/core/config';\r\nimport { Emitter, profiler } from 'app/core/core';\r\nimport getFactors from 'app/core/utils/factors';\r\nimport {\r\n  calculateInnerPanelHeight,\r\n  copyPanel as copyPanelUtil,\r\n  duplicatePanel,\r\n  editPanelJson as editPanelJsonUtil,\r\n  removePanel,\r\n  sharePanel as sharePanelUtil,\r\n} from 'app/features/dashboard/utils/panel';\r\nimport { GRID_COLUMN_COUNT } from 'app/core/constants';\r\nimport { auto } from 'angular';\r\nimport { TemplateSrv } from '../templating/template_srv';\r\nimport { getPanelLinksSupplier } from './panellinks/linkSuppliers';\r\nimport { AppEvent, PanelEvents, PanelPluginMeta, renderMarkdown } from '@grafana/data';\r\nimport { getLocationSrv } from '@grafana/runtime';\r\nimport { DashboardModel } from '../dashboard/state';\r\n\r\nexport class PanelCtrl {\r\n  panel: any;\r\n  error: any;\r\n  dashboard: DashboardModel;\r\n  pluginName: string;\r\n  pluginId: string;\r\n  editorTabs: any;\r\n  $scope: any;\r\n  $injector: auto.IInjectorService;\r\n  $location: any;\r\n  $timeout: any;\r\n  editModeInitiated: boolean;\r\n  height: any;\r\n  containerHeight: any;\r\n  events: Emitter;\r\n  loading: boolean;\r\n  timing: any;\r\n  maxPanelsPerRowOptions: number[];\r\n\r\n  constructor($scope: any, $injector: auto.IInjectorService) {\r\n    this.$injector = $injector;\r\n    this.$location = $injector.get('$location');\r\n    this.$scope = $scope;\r\n    this.$timeout = $injector.get('$timeout');\r\n    this.editorTabs = [];\r\n    this.events = this.panel.events;\r\n    this.timing = {}; // not used but here to not break plugins\r\n\r\n    const plugin = config.panels[this.panel.type];\r\n    if (plugin) {\r\n      this.pluginId = plugin.id;\r\n      this.pluginName = plugin.name;\r\n    }\r\n\r\n    $scope.$on(PanelEvents.componentDidMount.name, () => this.panelDidMount());\r\n  }\r\n\r\n  panelDidMount() {\r\n    this.events.emit(PanelEvents.componentDidMount);\r\n    this.dashboard.panelInitialized(this.panel);\r\n  }\r\n\r\n  renderingCompleted() {\r\n    profiler.renderingCompleted();\r\n  }\r\n\r\n  refresh() {\r\n    this.panel.refresh();\r\n  }\r\n\r\n  publishAppEvent<T>(event: AppEvent<T>, payload?: T) {\r\n    this.$scope.$root.appEvent(event, payload);\r\n  }\r\n\r\n  changeView(fullscreen: boolean, edit: boolean) {\r\n    this.publishAppEvent(PanelEvents.panelChangeView, {\r\n      fullscreen,\r\n      edit,\r\n      panelId: this.panel.id,\r\n    });\r\n  }\r\n\r\n  viewPanel() {\r\n    this.changeView(true, false);\r\n  }\r\n\r\n  editPanel() {\r\n    this.changeView(true, true);\r\n  }\r\n\r\n  exitFullscreen() {\r\n    this.changeView(false, false);\r\n  }\r\n\r\n  initEditMode() {\r\n    if (!this.editModeInitiated) {\r\n      this.editModeInitiated = true;\r\n      this.events.emit(PanelEvents.editModeInitialized);\r\n      this.maxPanelsPerRowOptions = getFactors(GRID_COLUMN_COUNT);\r\n    }\r\n  }\r\n\r\n  addEditorTab(title: string, directiveFn: any, index?: number, icon?: any) {\r\n    const editorTab = { title, directiveFn, icon };\r\n\r\n    if (_.isString(directiveFn)) {\r\n      editorTab.directiveFn = () => {\r\n        return { templateUrl: directiveFn };\r\n      };\r\n    }\r\n\r\n    if (index) {\r\n      this.editorTabs.splice(index, 0, editorTab);\r\n    } else {\r\n      this.editorTabs.push(editorTab);\r\n    }\r\n  }\r\n\r\n  async getMenu() {\r\n    const menu = [];\r\n    menu.push({\r\n      text: 'View',\r\n      click: 'ctrl.viewPanel();',\r\n      icon: 'gicon gicon-viewer',\r\n      shortcut: 'v',\r\n    });\r\n\r\n    if (this.dashboard.canEditPanel(this.panel)) {\r\n      menu.push({\r\n        text: 'Edit',\r\n        click: 'ctrl.editPanel();',\r\n        role: 'Editor',\r\n        icon: 'gicon gicon-editor',\r\n        shortcut: 'e',\r\n      });\r\n    }\r\n\r\n    menu.push({\r\n      text: 'Share',\r\n      click: 'ctrl.sharePanel();',\r\n      icon: 'fa fa-fw fa-share',\r\n      shortcut: 'p s',\r\n    });\r\n\r\n    if (config.featureToggles.inspect) {\r\n      menu.push({\r\n        text: 'Inspect',\r\n        icon: 'fa fa-fw fa-info-circle',\r\n        click: 'ctrl.inspectPanel();',\r\n        shortcut: 'p i',\r\n      });\r\n    }\r\n\r\n    // Additional items from sub-class\r\n    menu.push(...(await this.getAdditionalMenuItems()));\r\n\r\n    const extendedMenu = this.getExtendedMenu();\r\n    menu.push({\r\n      text: 'More ...',\r\n      click: '',\r\n      icon: 'fa fa-fw fa-cube',\r\n      submenu: extendedMenu,\r\n    });\r\n\r\n    if (this.dashboard.canEditPanel(this.panel)) {\r\n      menu.push({ divider: true, role: 'Editor' });\r\n      menu.push({\r\n        text: 'Remove',\r\n        click: 'ctrl.removePanel();',\r\n        role: 'Editor',\r\n        icon: 'fa fa-fw fa-trash',\r\n        shortcut: 'p r',\r\n      });\r\n    }\r\n\r\n    return menu;\r\n  }\r\n\r\n  getExtendedMenu() {\r\n    const menu = [];\r\n    if (!this.panel.fullscreen && this.dashboard.canEditPanel(this.panel)) {\r\n      menu.push({\r\n        text: 'Duplicate',\r\n        click: 'ctrl.duplicate()',\r\n        role: 'Editor',\r\n        shortcut: 'p d',\r\n      });\r\n\r\n      menu.push({\r\n        text: 'Copy',\r\n        click: 'ctrl.copyPanel()',\r\n        role: 'Editor',\r\n      });\r\n    }\r\n\r\n    menu.push({\r\n      text: 'Panel JSON',\r\n      click: 'ctrl.editPanelJson(); dismiss();',\r\n    });\r\n\r\n    this.events.emit(PanelEvents.initPanelActions, menu);\r\n    return menu;\r\n  }\r\n\r\n  // Override in sub-class to add items before extended menu\r\n  async getAdditionalMenuItems(): Promise<any[]> {\r\n    return [];\r\n  }\r\n\r\n  otherPanelInFullscreenMode() {\r\n    return this.dashboard.meta.fullscreen && !this.panel.fullscreen;\r\n  }\r\n\r\n  calculatePanelHeight(containerHeight: number) {\r\n    this.containerHeight = containerHeight;\r\n    this.height = calculateInnerPanelHeight(this.panel, containerHeight);\r\n  }\r\n\r\n  render(payload?: any) {\r\n    this.events.emit(PanelEvents.render, payload);\r\n  }\r\n\r\n  duplicate() {\r\n    duplicatePanel(this.dashboard, this.panel);\r\n  }\r\n\r\n  removePanel() {\r\n    removePanel(this.dashboard, this.panel, true);\r\n  }\r\n\r\n  editPanelJson() {\r\n    editPanelJsonUtil(this.dashboard, this.panel);\r\n  }\r\n\r\n  copyPanel() {\r\n    copyPanelUtil(this.panel);\r\n  }\r\n\r\n  sharePanel() {\r\n    sharePanelUtil(this.dashboard, this.panel);\r\n  }\r\n\r\n  inspectPanel() {\r\n    getLocationSrv().update({\r\n      query: {\r\n        inspect: this.panel.id,\r\n      },\r\n      partial: true,\r\n    });\r\n  }\r\n\r\n  getInfoMode() {\r\n    if (this.error) {\r\n      return 'error';\r\n    }\r\n    if (!!this.panel.description) {\r\n      return 'info';\r\n    }\r\n    if (this.panel.links && this.panel.links.length) {\r\n      return 'links';\r\n    }\r\n    return '';\r\n  }\r\n\r\n  getInfoContent(options: { mode: string }) {\r\n    const { panel } = this;\r\n    let markdown = panel.description || '';\r\n\r\n    if (options.mode === 'tooltip') {\r\n      markdown = this.error || panel.description || '';\r\n    }\r\n\r\n    const templateSrv: TemplateSrv = this.$injector.get('templateSrv');\r\n    const interpolatedMarkdown = templateSrv.replace(markdown, panel.scopedVars);\r\n    let html = '<div class=\"markdown-html panel-info-content\">';\r\n\r\n    const md = renderMarkdown(interpolatedMarkdown);\r\n    html += md;\r\n\r\n    if (panel.links && panel.links.length > 0) {\r\n      const interpolatedLinks = getPanelLinksSupplier(panel).getLinks();\r\n      html += '<ul class=\"panel-info-corner-links\">';\r\n      for (const link of interpolatedLinks) {\r\n        html +=\r\n          '<li><a class=\"panel-menu-link\" href=\"' +\r\n          escapeHtml(link.href) +\r\n          '\" target=\"' +\r\n          escapeHtml(link.target) +\r\n          '\">' +\r\n          escapeHtml(link.title) +\r\n          '</a></li>';\r\n      }\r\n      html += '</ul>';\r\n    }\r\n\r\n    html += '</div>';\r\n\r\n    return config.disableSanitizeHtml ? html : sanitize(html);\r\n  }\r\n\r\n  // overriden from react\r\n  onPluginTypeChange = (plugin: PanelPluginMeta) => {};\r\n}\r\n","import angular from 'angular';\r\nimport $ from 'jquery';\r\n// @ts-ignore\r\nimport Drop from 'tether-drop';\r\n// @ts-ignore\r\nimport baron from 'baron';\r\nimport { PanelEvents } from '@grafana/data';\r\nimport { getLocationSrv } from '@grafana/runtime';\r\nimport { e2e } from '@grafana/e2e';\r\n\r\nconst module = angular.module('grafana.directives');\r\n\r\nconst panelTemplate = `\r\n  <div class=\"panel-container\" ng-class=\"{'panel-container--no-title': !ctrl.panel.title.length}\">\r\n      <div class=\"panel-header\" ng-class=\"{'grid-drag-handle': !ctrl.panel.fullscreen}\">\r\n        <span class=\"panel-info-corner\">\r\n          <i class=\"fa\"></i>\r\n          <span class=\"panel-info-corner-inner\"></span>\r\n        </span>\r\n\r\n        <span class=\"panel-loading\" ng-show=\"ctrl.loading\">\r\n          <i class=\"fa fa-spinner fa-spin\"></i>\r\n        </span>\r\n\r\n        <panel-header class=\"panel-title-container\" panel-ctrl=\"ctrl\" aria-label={{ctrl.selectors.title(ctrl.panel.title)}}></panel-header>\r\n      </div>\r\n\r\n      <div class=\"panel-content\">\r\n        <ng-transclude class=\"panel-height-helper\"></ng-transclude>\r\n      </div>\r\n    </div>\r\n  </div>\r\n`;\r\n\r\nmodule.directive('grafanaPanel', ($rootScope, $document, $timeout) => {\r\n  return {\r\n    restrict: 'E',\r\n    template: panelTemplate,\r\n    transclude: true,\r\n    scope: { ctrl: '=' },\r\n    link: (scope: any, elem) => {\r\n      const panelContainer = elem.find('.panel-container');\r\n      const panelContent = elem.find('.panel-content');\r\n      const cornerInfoElem = elem.find('.panel-info-corner');\r\n      const ctrl = scope.ctrl;\r\n      ctrl.selectors = e2e.pages.Dashboard.Panels.Panel.selectors;\r\n      let infoDrop: any;\r\n      let panelScrollbar: any;\r\n\r\n      // the reason for handling these classes this way is for performance\r\n      // limit the watchers on panels etc\r\n      let transparentLastState = false;\r\n      let lastHasAlertRule = false;\r\n      let lastAlertState: boolean;\r\n      let hasAlertRule;\r\n\r\n      function mouseEnter() {\r\n        panelContainer.toggleClass('panel-hover-highlight', true);\r\n        ctrl.dashboard.setPanelFocus(ctrl.panel.id);\r\n      }\r\n\r\n      function mouseLeave() {\r\n        panelContainer.toggleClass('panel-hover-highlight', false);\r\n        ctrl.dashboard.setPanelFocus(0);\r\n      }\r\n\r\n      function resizeScrollableContent() {\r\n        if (panelScrollbar) {\r\n          panelScrollbar.update();\r\n        }\r\n      }\r\n\r\n      function infoCornerClicked() {\r\n        if (ctrl.error) {\r\n          getLocationSrv().update({ partial: true, query: { inspect: ctrl.panel.id } });\r\n        }\r\n      }\r\n\r\n      // set initial transparency\r\n      if (ctrl.panel.transparent) {\r\n        transparentLastState = true;\r\n        panelContainer.addClass('panel-container--transparent');\r\n      }\r\n\r\n      // update scrollbar after mounting\r\n      ctrl.events.on(PanelEvents.componentDidMount, () => {\r\n        if (ctrl.__proto__.constructor.scrollable) {\r\n          const scrollRootClass = 'baron baron__root baron__clipper panel-content--scrollable';\r\n          const scrollerClass = 'baron__scroller';\r\n          const scrollBarHTML = `\r\n            <div class=\"baron__track\">\r\n              <div class=\"baron__bar\"></div>\r\n            </div>\r\n          `;\r\n\r\n          const scrollRoot = panelContent;\r\n          const scroller = panelContent.find(':first').find(':first');\r\n\r\n          scrollRoot.addClass(scrollRootClass);\r\n          $(scrollBarHTML).appendTo(scrollRoot);\r\n          scroller.addClass(scrollerClass);\r\n\r\n          panelScrollbar = baron({\r\n            root: scrollRoot[0],\r\n            scroller: scroller[0],\r\n            bar: '.baron__bar',\r\n            barOnCls: '_scrollbar',\r\n            scrollingCls: '_scrolling',\r\n          });\r\n\r\n          panelScrollbar.scroll();\r\n        }\r\n      });\r\n\r\n      ctrl.events.on(PanelEvents.panelSizeChanged, () => {\r\n        ctrl.calculatePanelHeight(panelContainer[0].offsetHeight);\r\n        $timeout(() => {\r\n          resizeScrollableContent();\r\n          ctrl.render();\r\n        });\r\n      });\r\n\r\n      ctrl.events.on(PanelEvents.viewModeChanged, () => {\r\n        // first wait one pass for dashboard fullscreen view mode to take effect (classses being applied)\r\n        setTimeout(() => {\r\n          // then recalc style\r\n          ctrl.calculatePanelHeight(panelContainer[0].offsetHeight);\r\n          // then wait another cycle (this might not be needed)\r\n          $timeout(() => {\r\n            ctrl.render();\r\n            resizeScrollableContent();\r\n          });\r\n        }, 10);\r\n      });\r\n\r\n      ctrl.events.on(PanelEvents.render, () => {\r\n        // set initial height\r\n        if (!ctrl.height) {\r\n          ctrl.calculatePanelHeight(panelContainer[0].offsetHeight);\r\n        }\r\n\r\n        if (transparentLastState !== ctrl.panel.transparent) {\r\n          panelContainer.toggleClass('panel-container--transparent', ctrl.panel.transparent === true);\r\n          transparentLastState = ctrl.panel.transparent;\r\n        }\r\n\r\n        hasAlertRule = ctrl.panel.alert !== undefined;\r\n        if (lastHasAlertRule !== hasAlertRule) {\r\n          panelContainer.toggleClass('panel-has-alert', hasAlertRule);\r\n\r\n          lastHasAlertRule = hasAlertRule;\r\n        }\r\n\r\n        if (ctrl.alertState) {\r\n          if (lastAlertState) {\r\n            panelContainer.removeClass('panel-alert-state--' + lastAlertState);\r\n          }\r\n\r\n          if (\r\n            ctrl.alertState.state === 'ok' ||\r\n            ctrl.alertState.state === 'alerting' ||\r\n            ctrl.alertState.state === 'pending'\r\n          ) {\r\n            panelContainer.addClass('panel-alert-state--' + ctrl.alertState.state);\r\n          }\r\n\r\n          lastAlertState = ctrl.alertState.state;\r\n        } else if (lastAlertState) {\r\n          panelContainer.removeClass('panel-alert-state--' + lastAlertState);\r\n          lastAlertState = null;\r\n        }\r\n      });\r\n\r\n      function updatePanelCornerInfo() {\r\n        const cornerMode = ctrl.getInfoMode();\r\n        cornerInfoElem[0].className = 'panel-info-corner panel-info-corner--' + cornerMode;\r\n\r\n        if (cornerMode) {\r\n          if (infoDrop) {\r\n            infoDrop.destroy();\r\n          }\r\n\r\n          infoDrop = new Drop({\r\n            target: cornerInfoElem[0],\r\n            content: () => {\r\n              return ctrl.getInfoContent({ mode: 'tooltip' });\r\n            },\r\n            classes: ctrl.error ? 'drop-error' : 'drop-help',\r\n            openOn: 'hover',\r\n            hoverOpenDelay: 100,\r\n            tetherOptions: {\r\n              attachment: 'bottom left',\r\n              targetAttachment: 'top left',\r\n              constraints: [\r\n                {\r\n                  to: 'window',\r\n                  attachment: 'together',\r\n                  pin: true,\r\n                },\r\n              ],\r\n            },\r\n          });\r\n        }\r\n      }\r\n\r\n      scope.$watchGroup(['ctrl.error', 'ctrl.panel.description'], updatePanelCornerInfo);\r\n      scope.$watchCollection('ctrl.panel.links', updatePanelCornerInfo);\r\n\r\n      elem.on('mouseenter', mouseEnter);\r\n      elem.on('mouseleave', mouseLeave);\r\n\r\n      cornerInfoElem.on('click', infoCornerClicked);\r\n\r\n      scope.$on('$destroy', () => {\r\n        elem.off();\r\n        cornerInfoElem.off();\r\n\r\n        if (infoDrop) {\r\n          infoDrop.destroy();\r\n        }\r\n\r\n        if (panelScrollbar) {\r\n          panelScrollbar.dispose();\r\n        }\r\n      });\r\n    },\r\n  };\r\n});\r\n\r\nmodule.directive('panelHelpCorner', $rootScope => {\r\n  return {\r\n    restrict: 'E',\r\n    template: `\r\n    <span class=\"alert-error panel-error small pointer\" ng-if=\"ctrl.error\" ng-click=\"ctrl.openInspector()\">\r\n    <span data-placement=\"top\" bs-tooltip=\"ctrl.error\">\r\n    <i class=\"fa fa-exclamation\"></i><span class=\"panel-error-arrow\"></span>\r\n    </span>\r\n    </span>\r\n    `,\r\n    link: (scope, elem) => {},\r\n  };\r\n});\r\n","import angular from 'angular';\n\nconst directiveModule = angular.module('grafana.directives');\nconst directiveCache: any = {};\n\n/** @ngInject */\nfunction panelEditorTab(dynamicDirectiveSrv: any) {\n  return dynamicDirectiveSrv.create({\n    scope: {\n      ctrl: '=',\n      editorTab: '=',\n    },\n    directive: (scope: any) => {\n      const pluginId = scope.ctrl.pluginId;\n      const tabName = scope.editorTab.title\n        .toLowerCase()\n        .replace(' ', '-')\n        .replace('&', '')\n        .replace(' ', '')\n        .replace(' ', '-');\n\n      if (directiveCache[pluginId]) {\n        if (directiveCache[pluginId][tabName]) {\n          return directiveCache[pluginId][tabName];\n        }\n      } else {\n        directiveCache[pluginId] = [];\n      }\n\n      const result = {\n        fn: () => scope.editorTab.directiveFn(),\n        name: `panel-editor-tab-${pluginId}${tabName}`,\n      };\n\n      directiveCache[pluginId][tabName] = result;\n\n      return result;\n    },\n  });\n}\n\ndirectiveModule.directive('panelEditorTab', panelEditorTab);\n","import { coreModule } from 'app/core/core';\r\nimport { AngularPanelMenuItem } from '@grafana/data';\r\nimport { e2e } from '@grafana/e2e';\r\n\r\nconst template = `\r\n<span class=\"panel-title\">\r\n  <span class=\"icon-gf panel-alert-icon\"></span>\r\n  <span class=\"panel-title-text\">{{ctrl.panel.title | interpolateTemplateVars:this}}</span>\r\n  <span class=\"panel-menu-container dropdown\">\r\n    <span class=\"fa fa-caret-down panel-menu-toggle\" data-toggle=\"dropdown\"></span>\r\n    <ul class=\"dropdown-menu dropdown-menu--menu panel-menu\" role=\"menu\">\r\n    </ul>\r\n  </span>\r\n  <span class=\"panel-time-info\" ng-if=\"ctrl.timeInfo\"><i class=\"fa fa-clock-o\"></i> {{ctrl.timeInfo}}</span>\r\n</span>`;\r\n\r\nfunction renderMenuItem(item: AngularPanelMenuItem, ctrl: any) {\r\n  let html = '';\r\n  let listItemClass = '';\r\n\r\n  if (item.divider) {\r\n    return '<li class=\"divider\"></li>';\r\n  }\r\n\r\n  if (item.submenu) {\r\n    listItemClass = 'dropdown-submenu';\r\n  }\r\n\r\n  html += `<li class=\"${listItemClass}\"><a `;\r\n\r\n  if (item.click) {\r\n    html += ` ng-click=\"${item.click}\"`;\r\n  }\r\n  if (item.href) {\r\n    html += ` href=\"${item.href}\"`;\r\n  }\r\n\r\n  html += `><i class=\"${item.icon}\"></i>`;\r\n  html += `<span class=\"dropdown-item-text\" aria-label=\"${e2e.pages.Dashboard.Panels.Panel.selectors.headerItems(\r\n    item.text\r\n  )}\">${item.text}</span>`;\r\n\r\n  if (item.shortcut) {\r\n    html += `<span class=\"dropdown-menu-item-shortcut\">${item.shortcut}</span>`;\r\n  }\r\n\r\n  html += `</a>`;\r\n\r\n  if (item.submenu) {\r\n    html += '<ul class=\"dropdown-menu dropdown-menu--menu panel-menu\">';\r\n    for (const subitem of item.submenu) {\r\n      html += renderMenuItem(subitem, ctrl);\r\n    }\r\n    html += '</ul>';\r\n  }\r\n\r\n  html += `</li>`;\r\n  return html;\r\n}\r\n\r\nasync function createMenuTemplate(ctrl: any) {\r\n  let html = '';\r\n\r\n  for (const item of await ctrl.getMenu()) {\r\n    html += renderMenuItem(item, ctrl);\r\n  }\r\n\r\n  return html;\r\n}\r\n\r\n/** @ngInject */\r\nfunction panelHeader($compile: any) {\r\n  return {\r\n    restrict: 'E',\r\n    template: template,\r\n    link: (scope: any, elem: any, attrs: any) => {\r\n      const menuElem = elem.find('.panel-menu');\r\n      let menuScope: any;\r\n      let isDragged: boolean;\r\n\r\n      elem.click(async (evt: any) => {\r\n        const targetClass = evt.target.className;\r\n\r\n        // remove existing scope\r\n        if (menuScope) {\r\n          menuScope.$destroy();\r\n        }\r\n\r\n        menuScope = scope.$new();\r\n        const menuHtml = await createMenuTemplate(scope.ctrl);\r\n        menuElem.html(menuHtml);\r\n        $compile(menuElem)(menuScope);\r\n\r\n        if (targetClass.indexOf('panel-title-text') >= 0 || targetClass.indexOf('panel-title') >= 0) {\r\n          togglePanelMenu(evt);\r\n        }\r\n      });\r\n\r\n      function togglePanelMenu(e: any) {\r\n        if (!isDragged) {\r\n          e.stopPropagation();\r\n          elem.find('[data-toggle=dropdown]').dropdown('toggle');\r\n        }\r\n      }\r\n\r\n      let mouseX: number, mouseY: number;\r\n      elem.mousedown((e: any) => {\r\n        mouseX = e.pageX;\r\n        mouseY = e.pageY;\r\n      });\r\n\r\n      elem.mouseup((e: any) => {\r\n        if (mouseX === e.pageX && mouseY === e.pageY) {\r\n          isDragged = false;\r\n        } else {\r\n          isDragged = true;\r\n        }\r\n      });\r\n    },\r\n  };\r\n}\r\n\r\ncoreModule.directive('panelHeader', panelHeader);\r\n","import { DisplayValue, DataFrame, formattedValueToString, getDisplayProcessor } from '@grafana/data';\r\nimport { config } from '@grafana/runtime';\r\nimport toNumber from 'lodash/toNumber';\r\n\r\nexport function getFieldDisplayValuesProxy(frame: DataFrame, rowIndex: number): Record<string, DisplayValue> {\r\n  return new Proxy({} as Record<string, DisplayValue>, {\r\n    get: (obj: any, key: string) => {\r\n      // 1. Match the name\r\n      let field = frame.fields.find(f => key === f.name);\r\n      if (!field) {\r\n        // 2. Match the array index\r\n        const k = toNumber(key);\r\n        field = frame.fields[k];\r\n      }\r\n      if (!field) {\r\n        // 3. Match the title\r\n        field = frame.fields.find(f => key === f.config.title);\r\n      }\r\n      if (!field) {\r\n        return undefined;\r\n      }\r\n      if (!field.display) {\r\n        // Lazy load the display processor\r\n        field.display = getDisplayProcessor({\r\n          field,\r\n          theme: config.theme,\r\n        });\r\n      }\r\n      const raw = field.values.get(rowIndex);\r\n      const disp = field.display(raw);\r\n      disp.toString = () => formattedValueToString(disp);\r\n      return disp;\r\n    },\r\n  });\r\n}\r\n","import { PanelModel } from 'app/features/dashboard/state/PanelModel';\r\nimport {\r\n  FieldDisplay,\r\n  LinkModelSupplier,\r\n  getTimeField,\r\n  Labels,\r\n  ScopedVars,\r\n  ScopedVar,\r\n  Field,\r\n  LinkModel,\r\n  formattedValueToString,\r\n  DisplayValue,\r\n} from '@grafana/data';\r\nimport { getLinkSrv } from './link_srv';\r\nimport { getFieldDisplayValuesProxy } from './fieldDisplayValuesProxy';\r\n\r\ninterface SeriesVars {\r\n  name?: string;\r\n  refId?: string;\r\n}\r\n\r\ninterface FieldVars {\r\n  name: string;\r\n  labels?: Labels;\r\n}\r\n\r\ninterface ValueVars {\r\n  raw: any;\r\n  numeric: number;\r\n  text: string;\r\n  time?: number;\r\n  calc?: string;\r\n}\r\n\r\ninterface DataViewVars {\r\n  name?: string;\r\n  refId?: string;\r\n  fields?: Record<string, DisplayValue>;\r\n}\r\n\r\ninterface DataLinkScopedVars extends ScopedVars {\r\n  __series?: ScopedVar<SeriesVars>;\r\n  __field?: ScopedVar<FieldVars>;\r\n  __value?: ScopedVar<ValueVars>;\r\n  __data?: ScopedVar<DataViewVars>;\r\n}\r\n\r\n/**\r\n * Link suppliers creates link models based on a link origin\r\n */\r\n\r\nexport const getFieldLinksSupplier = (value: FieldDisplay): LinkModelSupplier<FieldDisplay> | undefined => {\r\n  const links = value.field.links;\r\n  if (!links || links.length === 0) {\r\n    return undefined;\r\n  }\r\n  return {\r\n    getLinks: (_scopedVars?: any) => {\r\n      const scopedVars: DataLinkScopedVars = {};\r\n\r\n      if (value.view) {\r\n        const { dataFrame } = value.view;\r\n\r\n        scopedVars['__series'] = {\r\n          value: {\r\n            name: dataFrame.name,\r\n            refId: dataFrame.refId,\r\n          },\r\n          text: 'Series',\r\n        };\r\n\r\n        const field = value.colIndex !== undefined ? dataFrame.fields[value.colIndex] : undefined;\r\n        if (field) {\r\n          console.log('Full Field Info:', field);\r\n          scopedVars['__field'] = {\r\n            value: {\r\n              name: field.name,\r\n              labels: field.labels,\r\n            },\r\n            text: 'Field',\r\n          };\r\n        }\r\n\r\n        if (!isNaN(value.rowIndex)) {\r\n          const { timeField } = getTimeField(dataFrame);\r\n          scopedVars['__value'] = {\r\n            value: {\r\n              raw: field.values.get(value.rowIndex),\r\n              numeric: value.display.numeric,\r\n              text: formattedValueToString(value.display),\r\n              time: timeField ? timeField.values.get(value.rowIndex) : undefined,\r\n            },\r\n            text: 'Value',\r\n          };\r\n\r\n          // Expose other values on the row\r\n          if (value.view) {\r\n            scopedVars['__data'] = {\r\n              value: {\r\n                name: dataFrame.name,\r\n                refId: dataFrame.refId,\r\n                fields: getFieldDisplayValuesProxy(dataFrame, value.rowIndex!),\r\n              },\r\n              text: 'Data',\r\n            };\r\n          }\r\n        } else {\r\n          // calculation\r\n          scopedVars['__value'] = {\r\n            value: {\r\n              raw: value.display.numeric,\r\n              numeric: value.display.numeric,\r\n              text: formattedValueToString(value.display),\r\n              calc: value.name,\r\n            },\r\n            text: 'Value',\r\n          };\r\n        }\r\n      } else {\r\n        console.log('VALUE', value);\r\n      }\r\n\r\n      return links.map(link => {\r\n        return getLinkSrv().getDataLinkUIModel(link, scopedVars, value);\r\n      });\r\n    },\r\n  };\r\n};\r\n\r\nexport const getPanelLinksSupplier = (value: PanelModel): LinkModelSupplier<PanelModel> => {\r\n  const links = value.links;\r\n\r\n  if (!links || links.length === 0) {\r\n    return undefined;\r\n  }\r\n\r\n  return {\r\n    getLinks: () => {\r\n      return links.map(link => {\r\n        return getLinkSrv().getDataLinkUIModel(link, value.scopedVars, value);\r\n      });\r\n    },\r\n  };\r\n};\r\n\r\nexport const getLinksFromLogsField = (field: Field, rowIndex: number): Array<LinkModel<Field>> => {\r\n  const scopedVars: any = {};\r\n  scopedVars['__value'] = {\r\n    value: {\r\n      raw: field.values.get(rowIndex),\r\n    },\r\n    text: 'Raw value',\r\n  };\r\n\r\n  return field.config.links\r\n    ? field.config.links.map(link => getLinkSrv().getDataLinkUIModel(link, scopedVars, field))\r\n    : [];\r\n};\r\n","import _ from 'lodash';\r\nimport { TimeSrv } from 'app/features/dashboard/services/TimeSrv';\r\nimport templateSrv, { TemplateSrv } from 'app/features/templating/template_srv';\r\nimport coreModule from 'app/core/core_module';\r\nimport { appendQueryToUrl, toUrlParams } from 'app/core/utils/url';\r\nimport { sanitizeUrl } from 'app/core/utils/text';\r\nimport { getConfig } from 'app/core/config';\r\nimport { VariableSuggestion, VariableOrigin, DataLinkBuiltInVars } from '@grafana/ui';\r\nimport {\r\n  DataLink,\r\n  KeyValue,\r\n  deprecationWarning,\r\n  LinkModel,\r\n  DataFrame,\r\n  ScopedVars,\r\n  FieldType,\r\n  Field,\r\n} from '@grafana/data';\r\n\r\nconst timeRangeVars = [\r\n  {\r\n    value: `${DataLinkBuiltInVars.keepTime}`,\r\n    label: 'Time range',\r\n    documentation: 'Adds current time range',\r\n    origin: VariableOrigin.BuiltIn,\r\n  },\r\n  {\r\n    value: `${DataLinkBuiltInVars.timeRangeFrom}`,\r\n    label: 'Time range: from',\r\n    documentation: \"Adds current time range's from value\",\r\n    origin: VariableOrigin.BuiltIn,\r\n  },\r\n  {\r\n    value: `${DataLinkBuiltInVars.timeRangeTo}`,\r\n    label: 'Time range: to',\r\n    documentation: \"Adds current time range's to value\",\r\n    origin: VariableOrigin.BuiltIn,\r\n  },\r\n];\r\n\r\nconst seriesVars = [\r\n  {\r\n    value: `${DataLinkBuiltInVars.seriesName}`,\r\n    label: 'Name',\r\n    documentation: 'Name of the series',\r\n    origin: VariableOrigin.Series,\r\n  },\r\n];\r\n\r\nconst valueVars = [\r\n  {\r\n    value: `${DataLinkBuiltInVars.valueNumeric}`,\r\n    label: 'Numeric',\r\n    documentation: 'Numeric representation of selected value',\r\n    origin: VariableOrigin.Value,\r\n  },\r\n  {\r\n    value: `${DataLinkBuiltInVars.valueText}`,\r\n    label: 'Text',\r\n    documentation: 'Text representation of selected value',\r\n    origin: VariableOrigin.Value,\r\n  },\r\n  {\r\n    value: `${DataLinkBuiltInVars.valueRaw}`,\r\n    label: 'Raw',\r\n    documentation: 'Raw value',\r\n    origin: VariableOrigin.Value,\r\n  },\r\n];\r\n\r\nconst buildLabelPath = (label: string) => {\r\n  return label.indexOf('.') > -1 ? `[\"${label}\"]` : `.${label}`;\r\n};\r\n\r\nexport const getPanelLinksVariableSuggestions = (): VariableSuggestion[] => [\r\n  ...templateSrv.variables.map(variable => ({\r\n    value: variable.name as string,\r\n    label: variable.name,\r\n    origin: VariableOrigin.Template,\r\n  })),\r\n  {\r\n    value: `${DataLinkBuiltInVars.includeVars}`,\r\n    label: 'All variables',\r\n    documentation: 'Adds current variables',\r\n    origin: VariableOrigin.Template,\r\n  },\r\n  ...timeRangeVars,\r\n];\r\n\r\nconst getFieldVars = (dataFrames: DataFrame[]) => {\r\n  const all = [];\r\n  for (const df of dataFrames) {\r\n    for (const f of df.fields) {\r\n      if (f.labels) {\r\n        for (const k of Object.keys(f.labels)) {\r\n          all.push(k);\r\n        }\r\n      }\r\n    }\r\n  }\r\n\r\n  const labels = _.chain(all)\r\n    .flatten()\r\n    .uniq()\r\n    .value();\r\n\r\n  return [\r\n    {\r\n      value: `${DataLinkBuiltInVars.fieldName}`,\r\n      label: 'Name',\r\n      documentation: 'Field name of the clicked datapoint (in ms epoch)',\r\n      origin: VariableOrigin.Field,\r\n    },\r\n    ...labels.map(label => ({\r\n      value: `__field.labels${buildLabelPath(label)}`,\r\n      label: `labels.${label}`,\r\n      documentation: `${label} label value`,\r\n      origin: VariableOrigin.Field,\r\n    })),\r\n  ];\r\n};\r\n\r\nconst getDataFrameVars = (dataFrames: DataFrame[]) => {\r\n  let numeric: Field = undefined;\r\n  let title: Field = undefined;\r\n  const suggestions: VariableSuggestion[] = [];\r\n  const keys: KeyValue<true> = {};\r\n  for (const df of dataFrames) {\r\n    for (const f of df.fields) {\r\n      if (keys[f.name]) {\r\n        continue;\r\n      }\r\n      suggestions.push({\r\n        value: `__data.fields[${f.name}]`,\r\n        label: `${f.name}`,\r\n        documentation: `Formatted value for ${f.name} on the same row`,\r\n        origin: VariableOrigin.Fields,\r\n      });\r\n      keys[f.name] = true;\r\n      if (!numeric && f.type === FieldType.number) {\r\n        numeric = f;\r\n      }\r\n      if (!title && f.config.title && f.config.title !== f.name) {\r\n        title = f;\r\n      }\r\n    }\r\n  }\r\n\r\n  if (suggestions.length) {\r\n    suggestions.push({\r\n      value: `__data.fields[0]`,\r\n      label: `Select by index`,\r\n      documentation: `Enter the field order`,\r\n      origin: VariableOrigin.Fields,\r\n    });\r\n  }\r\n  if (numeric) {\r\n    suggestions.push({\r\n      value: `__data.fields[${numeric.name}].numeric`,\r\n      label: `Show numeric value`,\r\n      documentation: `the numeric field value`,\r\n      origin: VariableOrigin.Fields,\r\n    });\r\n    suggestions.push({\r\n      value: `__data.fields[${numeric.name}].text`,\r\n      label: `Show text value`,\r\n      documentation: `the text value`,\r\n      origin: VariableOrigin.Fields,\r\n    });\r\n  }\r\n  if (title) {\r\n    suggestions.push({\r\n      value: `__data.fields[${title.config.title}]`,\r\n      label: `Select by title`,\r\n      documentation: `Use the title to pick the field`,\r\n      origin: VariableOrigin.Fields,\r\n    });\r\n  }\r\n  return suggestions;\r\n};\r\n\r\nexport const getDataLinksVariableSuggestions = (dataFrames: DataFrame[]): VariableSuggestion[] => {\r\n  const valueTimeVar = {\r\n    value: `${DataLinkBuiltInVars.valueTime}`,\r\n    label: 'Time',\r\n    documentation: 'Time value of the clicked datapoint (in ms epoch)',\r\n    origin: VariableOrigin.Value,\r\n  };\r\n  return [\r\n    ...seriesVars,\r\n    ...getFieldVars(dataFrames),\r\n    ...valueVars,\r\n    valueTimeVar,\r\n    ...getDataFrameVars(dataFrames),\r\n    ...getPanelLinksVariableSuggestions(),\r\n  ];\r\n};\r\n\r\nexport const getCalculationValueDataLinksVariableSuggestions = (dataFrames: DataFrame[]): VariableSuggestion[] => {\r\n  const fieldVars = getFieldVars(dataFrames);\r\n  const valueCalcVar = {\r\n    value: `${DataLinkBuiltInVars.valueCalc}`,\r\n    label: 'Calculation name',\r\n    documentation: 'Name of the calculation the value is a result of',\r\n    origin: VariableOrigin.Value,\r\n  };\r\n  return [...seriesVars, ...fieldVars, ...valueVars, valueCalcVar, ...getPanelLinksVariableSuggestions()];\r\n};\r\n\r\nexport interface LinkService {\r\n  getDataLinkUIModel: <T>(link: DataLink, scopedVars: ScopedVars, origin: T) => LinkModel<T>;\r\n}\r\n\r\nexport class LinkSrv implements LinkService {\r\n  /** @ngInject */\r\n  constructor(private templateSrv: TemplateSrv, private timeSrv: TimeSrv) {}\r\n\r\n  getLinkUrl(link: any) {\r\n    const url = this.templateSrv.replace(link.url || '');\r\n    const params: { [key: string]: any } = {};\r\n\r\n    if (link.keepTime) {\r\n      const range = this.timeSrv.timeRangeForUrl();\r\n      params['from'] = range.from;\r\n      params['to'] = range.to;\r\n    }\r\n\r\n    if (link.includeVars) {\r\n      this.templateSrv.fillVariableValuesForUrl(params);\r\n    }\r\n\r\n    return appendQueryToUrl(url, toUrlParams(params));\r\n  }\r\n\r\n  getAnchorInfo(link: any) {\r\n    const info: any = {};\r\n    info.href = this.getLinkUrl(link);\r\n    info.title = this.templateSrv.replace(link.title || '');\r\n    return info;\r\n  }\r\n\r\n  /**\r\n   * Returns LinkModel which is basically a DataLink with all values interpolated through the templateSrv.\r\n   */\r\n  getDataLinkUIModel = <T>(link: DataLink, scopedVars: ScopedVars, origin: T): LinkModel<T> => {\r\n    const params: KeyValue = {};\r\n    const timeRangeUrl = toUrlParams(this.timeSrv.timeRangeForUrl());\r\n\r\n    let href = link.url;\r\n    if (link.onBuildUrl) {\r\n      href = link.onBuildUrl({\r\n        origin,\r\n        scopedVars,\r\n      });\r\n    }\r\n\r\n    let onClick: (e: any) => void = undefined;\r\n    if (link.onClick) {\r\n      onClick = (e: any) => {\r\n        link.onClick({\r\n          origin,\r\n          scopedVars,\r\n          e,\r\n        });\r\n      };\r\n    }\r\n\r\n    const info: LinkModel<T> = {\r\n      href: href.replace(/\\s|\\n/g, ''),\r\n      title: this.templateSrv.replace(link.title || '', scopedVars),\r\n      target: link.targetBlank ? '_blank' : '_self',\r\n      origin,\r\n      onClick,\r\n    };\r\n    this.templateSrv.fillVariableValuesForUrl(params, scopedVars);\r\n\r\n    const variablesQuery = toUrlParams(params);\r\n    info.href = this.templateSrv.replace(info.href, {\r\n      ...scopedVars,\r\n      [DataLinkBuiltInVars.keepTime]: {\r\n        text: timeRangeUrl,\r\n        value: timeRangeUrl,\r\n      },\r\n      [DataLinkBuiltInVars.includeVars]: {\r\n        text: variablesQuery,\r\n        value: variablesQuery,\r\n      },\r\n    });\r\n    info.href = getConfig().disableSanitizeHtml ? info.href : sanitizeUrl(info.href);\r\n    return info;\r\n  };\r\n\r\n  /**\r\n   * getPanelLinkAnchorInfo method is left for plugins compatibility reasons\r\n   *\r\n   * @deprecated Drilldown links should be generated using getDataLinkUIModel method\r\n   */\r\n  getPanelLinkAnchorInfo(link: DataLink, scopedVars: ScopedVars) {\r\n    deprecationWarning('link_srv.ts', 'getPanelLinkAnchorInfo', 'getDataLinkUIModel');\r\n    return this.getDataLinkUIModel(link, scopedVars, {});\r\n  }\r\n}\r\n\r\nlet singleton: LinkService;\r\n\r\nexport function setLinkSrv(srv: LinkService) {\r\n  singleton = srv;\r\n}\r\n\r\nexport function getLinkSrv(): LinkService {\r\n  return singleton;\r\n}\r\n\r\ncoreModule.service('linkSrv', LinkSrv);\r\n","import angular from 'angular';\r\nimport _ from 'lodash';\r\nimport './link_srv';\r\nimport { BackendSrv } from 'app/core/services/backend_srv';\r\n\r\nfunction panelLinksEditor() {\r\n  return {\r\n    scope: {\r\n      panel: '=',\r\n    },\r\n    restrict: 'E',\r\n    controller: 'PanelLinksEditorCtrl',\r\n    templateUrl: 'public/app/features/panel/panellinks/module.html',\r\n    link: () => {},\r\n  };\r\n}\r\n\r\nexport class PanelLinksEditorCtrl {\r\n  /** @ngInject */\r\n  constructor($scope: any, backendSrv: BackendSrv) {\r\n    $scope.panel.links = $scope.panel.links || [];\r\n\r\n    $scope.addLink = () => {\r\n      $scope.panel.links.push({\r\n        type: 'dashboard',\r\n      });\r\n    };\r\n\r\n    $scope.searchDashboards = (queryStr: string, callback: Function) => {\r\n      backendSrv.search({ query: queryStr }).then(hits => {\r\n        const dashboards = _.map(hits, dash => {\r\n          return dash.title;\r\n        });\r\n\r\n        callback(dashboards);\r\n      });\r\n    };\r\n\r\n    $scope.dashboardChanged = (link: any) => {\r\n      backendSrv.search({ query: link.dashboard }).then(hits => {\r\n        const dashboard: any = _.find(hits, { title: link.dashboard });\r\n        if (dashboard) {\r\n          if (dashboard.url) {\r\n            link.url = dashboard.url;\r\n          } else {\r\n            // To support legacy url's\r\n            link.dashUri = dashboard.uri;\r\n          }\r\n          link.title = dashboard.title;\r\n        }\r\n      });\r\n    };\r\n\r\n    $scope.deleteLink = (link: any) => {\r\n      $scope.panel.links = _.without($scope.panel.links, link);\r\n    };\r\n  }\r\n}\r\n\r\nangular\r\n  .module('grafana.directives')\r\n  .directive('panelLinksEditor', panelLinksEditor)\r\n  .controller('PanelLinksEditorCtrl', PanelLinksEditorCtrl);\r\n","import _ from 'lodash';\r\nimport { auto } from 'angular';\r\n\r\nexport class QueryCtrl {\r\n  target: any;\r\n  datasource: any;\r\n  panelCtrl: any;\r\n  panel: any;\r\n  hasRawMode: boolean;\r\n  error: string;\r\n  isLastQuery: boolean;\r\n\r\n  constructor(public $scope: any, public $injector: auto.IInjectorService) {\r\n    this.panel = this.panelCtrl.panel;\r\n    this.isLastQuery = _.indexOf(this.panel.targets, this.target) === this.panel.targets.length - 1;\r\n  }\r\n\r\n  refresh() {\r\n    this.panelCtrl.refresh();\r\n  }\r\n}\r\n","import angular from 'angular';\r\n\r\nconst module = angular.module('grafana.directives');\r\n\r\nexport class QueryRowCtrl {\r\n  target: any;\r\n  queryCtrl: any;\r\n  panelCtrl: any;\r\n  panel: any;\r\n  hasTextEditMode: boolean;\r\n\r\n  constructor() {\r\n    this.panelCtrl = this.queryCtrl.panelCtrl;\r\n    this.target = this.queryCtrl.target;\r\n    this.panel = this.panelCtrl.panel;\r\n\r\n    if (this.hasTextEditMode && this.queryCtrl.toggleEditorMode) {\r\n      // expose this function to react parent component\r\n      this.panelCtrl.toggleEditorMode = this.queryCtrl.toggleEditorMode.bind(this.queryCtrl);\r\n    }\r\n\r\n    if (this.queryCtrl.getCollapsedText) {\r\n      // expose this function to react parent component\r\n      this.panelCtrl.getCollapsedText = this.queryCtrl.getCollapsedText.bind(this.queryCtrl);\r\n    }\r\n  }\r\n}\r\n\r\n/** @ngInject */\r\nfunction queryEditorRowDirective() {\r\n  return {\r\n    restrict: 'E',\r\n    controller: QueryRowCtrl,\r\n    bindToController: true,\r\n    controllerAs: 'ctrl',\r\n    templateUrl: 'public/app/features/panel/partials/query_editor_row.html',\r\n    transclude: true,\r\n    scope: {\r\n      queryCtrl: '=',\r\n      canCollapse: '=',\r\n      hasTextEditMode: '=',\r\n    },\r\n  };\r\n}\r\n\r\nmodule.directive('queryEditorRow', queryEditorRowDirective);\r\n","import { coreModule } from 'app/core/core';\r\nimport { VariableSrv } from 'app/features/templating/variable_srv';\r\nconst template = `\r\n<div class=\"gf-form-select-wrapper max-width-18\">\r\n  <select class=\"gf-form-input\" ng-model=\"panel.repeat\" ng-options=\"f.value as f.text for f in variables\" ng-change=\"optionChanged()\">\r\n  <option value=\"\"></option>\r\n</div>\r\n`;\r\n\r\n/** @ngInject */\r\nfunction dashRepeatOptionDirective(variableSrv: VariableSrv) {\r\n  return {\r\n    restrict: 'E',\r\n    template: template,\r\n    scope: {\r\n      panel: '=',\r\n    },\r\n    link: (scope: any, element: JQuery) => {\r\n      element.css({ display: 'block', width: '100%' });\r\n\r\n      scope.variables = variableSrv.variables.map((item: any) => {\r\n        return { text: item.name, value: item.name };\r\n      });\r\n\r\n      if (scope.variables.length === 0) {\r\n        scope.variables.unshift({\r\n          text: 'No template variables found',\r\n          value: null,\r\n        });\r\n      }\r\n\r\n      scope.variables.unshift({ text: 'Disabled', value: null });\r\n\r\n      // if repeat is set and no direction set to horizontal\r\n      if (scope.panel.repeat && !scope.panel.repeatDirection) {\r\n        scope.panel.repeatDirection = 'h';\r\n      }\r\n\r\n      scope.optionChanged = () => {\r\n        if (scope.panel.repeat) {\r\n          scope.panel.repeatDirection = 'h';\r\n        }\r\n      };\r\n    },\r\n  };\r\n}\r\n\r\ncoreModule.directive('dashRepeatOption', dashRepeatOptionDirective);\r\n","import './playlists_ctrl';\r\nimport './playlist_search';\r\nimport './playlist_srv';\r\nimport './playlist_edit_ctrl';\r\nimport './playlist_routes';\r\n","import _ from 'lodash';\r\nimport coreModule from '../../core/core_module';\r\nimport { ILocationService } from 'angular';\r\nimport { BackendSrv } from 'app/core/services/backend_srv';\r\nimport { NavModelSrv } from 'app/core/nav_model_srv';\r\nimport { AppEventEmitter } from 'app/types';\r\nimport { AppEvents } from '@grafana/data';\r\n\r\nexport interface PlaylistItem {\r\n  value: any;\r\n  id: any;\r\n  type: string;\r\n  order: any;\r\n}\r\nexport class PlaylistEditCtrl {\r\n  filteredDashboards: any = [];\r\n  filteredTags: any = [];\r\n  searchQuery = '';\r\n  loading = false;\r\n  playlist: any = {\r\n    interval: '5m',\r\n  };\r\n\r\n  playlistItems: any = [];\r\n  dashboardresult: any = [];\r\n  tagresult: any = [];\r\n  navModel: any;\r\n  isNew: boolean;\r\n\r\n  /** @ngInject */\r\n  constructor(\r\n    private $scope: AppEventEmitter,\r\n    private backendSrv: BackendSrv,\r\n    private $location: ILocationService,\r\n    $route: any,\r\n    navModelSrv: NavModelSrv\r\n  ) {\r\n    this.navModel = navModelSrv.getNav('dashboards', 'playlists', 0);\r\n    this.isNew = !$route.current.params.id;\r\n\r\n    if ($route.current.params.id) {\r\n      const playlistId = $route.current.params.id;\r\n\r\n      backendSrv.get('/api/playlists/' + playlistId).then((result: any) => {\r\n        this.playlist = result;\r\n      });\r\n\r\n      backendSrv.get('/api/playlists/' + playlistId + '/items').then((result: any) => {\r\n        this.playlistItems = result;\r\n      });\r\n    }\r\n  }\r\n\r\n  filterFoundPlaylistItems() {\r\n    this.filteredDashboards = _.reject(this.dashboardresult, playlistItem => {\r\n      return _.find(this.playlistItems, listPlaylistItem => {\r\n        return parseInt(listPlaylistItem.value, 10) === playlistItem.id;\r\n      });\r\n    });\r\n\r\n    this.filteredTags = _.reject(this.tagresult, tag => {\r\n      return _.find(this.playlistItems, listPlaylistItem => {\r\n        return listPlaylistItem.value === tag.term;\r\n      });\r\n    });\r\n  }\r\n\r\n  addPlaylistItem(playlistItem: PlaylistItem) {\r\n    playlistItem.value = playlistItem.id.toString();\r\n    playlistItem.type = 'dashboard_by_id';\r\n    playlistItem.order = this.playlistItems.length + 1;\r\n\r\n    this.playlistItems.push(playlistItem);\r\n    this.filterFoundPlaylistItems();\r\n  }\r\n\r\n  addTagPlaylistItem(tag: { term: any }) {\r\n    const playlistItem: any = {\r\n      value: tag.term,\r\n      type: 'dashboard_by_tag',\r\n      order: this.playlistItems.length + 1,\r\n      title: tag.term,\r\n    };\r\n\r\n    this.playlistItems.push(playlistItem);\r\n    this.filterFoundPlaylistItems();\r\n  }\r\n\r\n  removePlaylistItem(playlistItem: PlaylistItem) {\r\n    _.remove(this.playlistItems, listedPlaylistItem => {\r\n      return playlistItem === listedPlaylistItem;\r\n    });\r\n    this.filterFoundPlaylistItems();\r\n  }\r\n\r\n  savePlaylist(playlist: any, playlistItems: PlaylistItem[]) {\r\n    let savePromise;\r\n\r\n    playlist.items = playlistItems;\r\n\r\n    savePromise = playlist.id\r\n      ? this.backendSrv.put('/api/playlists/' + playlist.id, playlist)\r\n      : this.backendSrv.post('/api/playlists', playlist);\r\n\r\n    savePromise.then(\r\n      () => {\r\n        this.$scope.appEvent(AppEvents.alertSuccess, ['Playlist saved']);\r\n        this.$location.path('/playlists');\r\n      },\r\n      () => {\r\n        this.$scope.appEvent(AppEvents.alertError, ['Unable to save playlist']);\r\n      }\r\n    );\r\n  }\r\n\r\n  isPlaylistEmpty() {\r\n    return !this.playlistItems.length;\r\n  }\r\n\r\n  backToList() {\r\n    this.$location.path('/playlists');\r\n  }\r\n\r\n  searchStarted(promise: Promise<any>) {\r\n    promise.then((data: any) => {\r\n      this.dashboardresult = data.dashboardResult;\r\n      this.tagresult = data.tagResult;\r\n      this.filterFoundPlaylistItems();\r\n    });\r\n  }\r\n\r\n  movePlaylistItem(playlistItem: PlaylistItem, offset: number) {\r\n    const currentPosition = this.playlistItems.indexOf(playlistItem);\r\n    const newPosition = currentPosition + offset;\r\n\r\n    if (newPosition >= 0 && newPosition < this.playlistItems.length) {\r\n      this.playlistItems.splice(currentPosition, 1);\r\n      this.playlistItems.splice(newPosition, 0, playlistItem);\r\n    }\r\n  }\r\n\r\n  movePlaylistItemUp(playlistItem: PlaylistItem) {\r\n    this.movePlaylistItem(playlistItem, -1);\r\n  }\r\n\r\n  movePlaylistItemDown(playlistItem: PlaylistItem) {\r\n    this.movePlaylistItem(playlistItem, 1);\r\n  }\r\n}\r\n\r\ncoreModule.controller('PlaylistEditCtrl', PlaylistEditCtrl);\r\n","import angular from 'angular';\r\nimport { PlaylistSrv } from './playlist_srv';\r\n\r\n/** @ngInject */\r\nfunction grafanaRoutes($routeProvider: any) {\r\n  $routeProvider\r\n    .when('/playlists', {\r\n      templateUrl: 'public/app/features/playlist/partials/playlists.html',\r\n      controllerAs: 'ctrl',\r\n      controller: 'PlaylistsCtrl',\r\n    })\r\n    .when('/playlists/create', {\r\n      templateUrl: 'public/app/features/playlist/partials/playlist.html',\r\n      controllerAs: 'ctrl',\r\n      controller: 'PlaylistEditCtrl',\r\n    })\r\n    .when('/playlists/edit/:id', {\r\n      templateUrl: 'public/app/features/playlist/partials/playlist.html',\r\n      controllerAs: 'ctrl',\r\n      controller: 'PlaylistEditCtrl',\r\n    })\r\n    .when('/playlists/play/:id', {\r\n      template: '',\r\n      resolve: {\r\n        init: (playlistSrv: PlaylistSrv, $route: any) => {\r\n          const playlistId = $route.current.params.id;\r\n          playlistSrv.start(playlistId);\r\n        },\r\n      },\r\n    });\r\n}\r\n\r\nangular.module('grafana.routes').config(grafanaRoutes);\r\n","import coreModule from '../../core/core_module';\r\nimport { BackendSrv } from 'app/core/services/backend_srv';\r\n\r\nexport class PlaylistSearchCtrl {\r\n  query: any;\r\n  tagsMode: boolean;\r\n\r\n  searchStarted: any;\r\n\r\n  /** @ngInject */\r\n  constructor($timeout: any, private backendSrv: BackendSrv) {\r\n    this.query = { query: '', tag: [], starred: false, limit: 20 };\r\n\r\n    $timeout(() => {\r\n      this.query.query = '';\r\n      this.query.type = 'dash-db';\r\n      this.searchDashboards();\r\n    }, 100);\r\n  }\r\n\r\n  searchDashboards() {\r\n    this.tagsMode = false;\r\n    const prom: any = {};\r\n\r\n    prom.promise = this.backendSrv.search(this.query).then(result => {\r\n      return {\r\n        dashboardResult: result,\r\n        tagResult: [],\r\n      };\r\n    });\r\n\r\n    this.searchStarted(prom);\r\n  }\r\n\r\n  showStarred() {\r\n    this.query.starred = !this.query.starred;\r\n    this.searchDashboards();\r\n  }\r\n\r\n  queryHasNoFilters() {\r\n    return this.query.query === '' && this.query.starred === false && this.query.tag.length === 0;\r\n  }\r\n\r\n  filterByTag(tag: any, evt: any) {\r\n    this.query.tag.push(tag);\r\n    this.searchDashboards();\r\n    if (evt) {\r\n      evt.stopPropagation();\r\n      evt.preventDefault();\r\n    }\r\n  }\r\n\r\n  getTags() {\r\n    const prom: any = {};\r\n    prom.promise = this.backendSrv.get('/api/dashboards/tags').then((result: any) => {\r\n      return {\r\n        dashboardResult: [],\r\n        tagResult: result,\r\n      } as any;\r\n    });\r\n\r\n    this.searchStarted(prom);\r\n  }\r\n}\r\n\r\nexport function playlistSearchDirective() {\r\n  return {\r\n    restrict: 'E',\r\n    templateUrl: 'public/app/features/playlist/partials/playlist_search.html',\r\n    controller: PlaylistSearchCtrl,\r\n    bindToController: true,\r\n    controllerAs: 'ctrl',\r\n    scope: {\r\n      searchStarted: '&',\r\n    },\r\n  };\r\n}\r\n\r\ncoreModule.directive('playlistSearch', playlistSearchDirective);\r\n","// Libraries\r\nimport _ from 'lodash';\r\n\r\n// Utils\r\nimport { toUrlParams } from 'app/core/utils/url';\r\nimport coreModule from '../../core/core_module';\r\nimport appEvents from 'app/core/app_events';\r\nimport locationUtil from 'app/core/utils/location_util';\r\nimport kbn from 'app/core/utils/kbn';\r\nimport { store } from 'app/store/store';\r\nimport { CoreEvents } from 'app/types';\r\n\r\nexport const queryParamsToPreserve: { [key: string]: boolean } = {\r\n  kiosk: true,\r\n  autofitpanels: true,\r\n  orgId: true,\r\n};\r\n\r\nexport class PlaylistSrv {\r\n  private cancelPromise: any;\r\n  private dashboards: Array<{ url: string }>;\r\n  private index: number;\r\n  private interval: number;\r\n  private startUrl: string;\r\n  private numberOfLoops = 0;\r\n  private storeUnsub: () => void;\r\n  private validPlaylistUrl: string;\r\n  isPlaying: boolean;\r\n\r\n  /** @ngInject */\r\n  constructor(private $location: any, private $timeout: any, private backendSrv: any) {}\r\n\r\n  next() {\r\n    this.$timeout.cancel(this.cancelPromise);\r\n\r\n    const playedAllDashboards = this.index > this.dashboards.length - 1;\r\n    if (playedAllDashboards) {\r\n      this.numberOfLoops++;\r\n\r\n      // This does full reload of the playlist to keep memory in check due to existing leaks but at the same time\r\n      // we do not want page to flicker after each full loop.\r\n      if (this.numberOfLoops >= 3) {\r\n        window.location.href = this.startUrl;\r\n        return;\r\n      }\r\n      this.index = 0;\r\n    }\r\n\r\n    const dash = this.dashboards[this.index];\r\n    const queryParams = this.$location.search();\r\n    const filteredParams = _.pickBy(queryParams, (value: any, key: string) => queryParamsToPreserve[key]);\r\n    const nextDashboardUrl = locationUtil.stripBaseFromUrl(dash.url);\r\n\r\n    // this is done inside timeout to make sure digest happens after\r\n    // as this can be called from react\r\n    this.$timeout(() => {\r\n      this.$location.url(nextDashboardUrl + '?' + toUrlParams(filteredParams));\r\n    });\r\n\r\n    this.index++;\r\n    this.validPlaylistUrl = nextDashboardUrl;\r\n    this.cancelPromise = this.$timeout(() => this.next(), this.interval);\r\n  }\r\n\r\n  prev() {\r\n    this.index = Math.max(this.index - 2, 0);\r\n    this.next();\r\n  }\r\n\r\n  // Detect url changes not caused by playlist srv and stop playlist\r\n  storeUpdated() {\r\n    const state = store.getState();\r\n\r\n    if (state.location.path !== this.validPlaylistUrl) {\r\n      this.stop();\r\n    }\r\n  }\r\n\r\n  start(playlistId: number) {\r\n    this.stop();\r\n\r\n    this.startUrl = window.location.href;\r\n    this.index = 0;\r\n    this.isPlaying = true;\r\n\r\n    // setup location tracking\r\n    this.storeUnsub = store.subscribe(() => this.storeUpdated());\r\n    this.validPlaylistUrl = this.$location.path();\r\n\r\n    appEvents.emit(CoreEvents.playlistStarted);\r\n\r\n    return this.backendSrv.get(`/api/playlists/${playlistId}`).then((playlist: any) => {\r\n      return this.backendSrv.get(`/api/playlists/${playlistId}/dashboards`).then((dashboards: any) => {\r\n        this.dashboards = dashboards;\r\n        this.interval = kbn.interval_to_ms(playlist.interval);\r\n        this.next();\r\n      });\r\n    });\r\n  }\r\n\r\n  stop() {\r\n    if (this.isPlaying) {\r\n      const queryParams = this.$location.search();\r\n      if (queryParams.kiosk) {\r\n        appEvents.emit(CoreEvents.toggleKioskMode, { exit: true });\r\n      }\r\n    }\r\n\r\n    this.index = 0;\r\n    this.isPlaying = false;\r\n\r\n    if (this.storeUnsub) {\r\n      this.storeUnsub();\r\n    }\r\n\r\n    if (this.cancelPromise) {\r\n      this.$timeout.cancel(this.cancelPromise);\r\n    }\r\n\r\n    appEvents.emit(CoreEvents.playlistStopped);\r\n  }\r\n}\r\n\r\ncoreModule.service('playlistSrv', PlaylistSrv);\r\n","import _ from 'lodash';\r\nimport coreModule from '../../core/core_module';\r\nimport { BackendSrv } from '@grafana/runtime';\r\nimport { NavModelSrv } from 'app/core/nav_model_srv';\r\nimport { CoreEvents } from 'app/types';\r\nimport { AppEvents } from '@grafana/data';\r\n\r\nexport class PlaylistsCtrl {\r\n  playlists: any;\r\n  navModel: any;\r\n\r\n  /** @ngInject */\r\n  constructor(private $scope: any, private backendSrv: BackendSrv, navModelSrv: NavModelSrv) {\r\n    this.navModel = navModelSrv.getNav('dashboards', 'playlists', 0);\r\n\r\n    backendSrv.get('/api/playlists').then((result: any) => {\r\n      this.playlists = result.map((item: any) => {\r\n        item.startUrl = `playlists/play/${item.id}`;\r\n        return item;\r\n      });\r\n    });\r\n  }\r\n\r\n  removePlaylistConfirmed(playlist: any) {\r\n    _.remove(this.playlists, { id: playlist.id });\r\n\r\n    this.backendSrv.delete('/api/playlists/' + playlist.id).then(\r\n      () => {\r\n        this.$scope.appEvent(AppEvents.alertSuccess, ['Playlist deleted']);\r\n      },\r\n      () => {\r\n        this.$scope.appEvent(AppEvents.alertError, ['Unable to delete playlist']);\r\n        this.playlists.push(playlist);\r\n      }\r\n    );\r\n  }\r\n\r\n  removePlaylist(playlist: any) {\r\n    this.$scope.appEvent(CoreEvents.showConfirmModal, {\r\n      title: 'Delete',\r\n      text: 'Are you sure you want to delete playlist ' + playlist.name + '?',\r\n      yesText: 'Delete',\r\n      icon: 'fa-trash',\r\n      onConfirm: () => {\r\n        this.removePlaylistConfirmed(playlist);\r\n      },\r\n    });\r\n  }\r\n}\r\n\r\ncoreModule.controller('PlaylistsCtrl', PlaylistsCtrl);\r\n","import { getBackendSrv } from 'app/core/services/backend_srv';\r\nimport { PluginMeta } from '@grafana/data';\r\n\r\ntype PluginCache = {\r\n  [key: string]: PluginMeta;\r\n};\r\n\r\nconst pluginInfoCache: PluginCache = {};\r\n\r\nexport function getPluginSettings(pluginId: string): Promise<PluginMeta> {\r\n  const v = pluginInfoCache[pluginId];\r\n  if (v) {\r\n    return Promise.resolve(v);\r\n  }\r\n  return getBackendSrv()\r\n    .get(`/api/plugins/${pluginId}/settings`)\r\n    .then((settings: any) => {\r\n      pluginInfoCache[pluginId] = settings;\r\n      return settings;\r\n    })\r\n    .catch((err: any) => {\r\n      // err.isHandled = true;\r\n      return Promise.reject('Unknown Plugin');\r\n    });\r\n}\r\n","import './plugin_page_ctrl';\nimport './datasource_srv';\nimport './plugin_component';\nimport './variableQueryEditorLoader';\n","const graphitePlugin = async () =>\r\n  await import(/* webpackChunkName: \"graphitePlugin\" */ 'app/plugins/datasource/graphite/module');\r\nconst cloudwatchPlugin = async () =>\r\n  await import(/* webpackChunkName: \"cloudwatchPlugin\" */ 'app/plugins/datasource/cloudwatch/module');\r\nconst dashboardDSPlugin = async () =>\r\n  await import(/* webpackChunkName \"dashboardDSPlugin\" */ 'app/plugins/datasource/dashboard/module');\r\nconst elasticsearchPlugin = async () =>\r\n  await import(/* webpackChunkName: \"elasticsearchPlugin\" */ 'app/plugins/datasource/elasticsearch/module');\r\nconst opentsdbPlugin = async () =>\r\n  await import(/* webpackChunkName: \"opentsdbPlugin\" */ 'app/plugins/datasource/opentsdb/module');\r\nconst grafanaPlugin = async () =>\r\n  await import(/* webpackChunkName: \"grafanaPlugin\" */ 'app/plugins/datasource/grafana/module');\r\nconst influxdbPlugin = async () =>\r\n  await import(/* webpackChunkName: \"influxdbPlugin\" */ 'app/plugins/datasource/influxdb/module');\r\nconst lokiPlugin = async () => await import(/* webpackChunkName: \"lokiPlugin\" */ 'app/plugins/datasource/loki/module');\r\nconst mixedPlugin = async () =>\r\n  await import(/* webpackChunkName: \"mixedPlugin\" */ 'app/plugins/datasource/mixed/module');\r\nconst mysqlPlugin = async () =>\r\n  await import(/* webpackChunkName: \"mysqlPlugin\" */ 'app/plugins/datasource/mysql/module');\r\nconst postgresPlugin = async () =>\r\n  await import(/* webpackChunkName: \"postgresPlugin\" */ 'app/plugins/datasource/postgres/module');\r\nconst prometheusPlugin = async () =>\r\n  await import(/* webpackChunkName: \"prometheusPlugin\" */ 'app/plugins/datasource/prometheus/module');\r\nconst mssqlPlugin = async () =>\r\n  await import(/* webpackChunkName: \"mssqlPlugin\" */ 'app/plugins/datasource/mssql/module');\r\nconst testDataDSPlugin = async () =>\r\n  await import(/* webpackChunkName: \"testDataDSPlugin\" */ 'app/plugins/datasource/testdata/module');\r\nconst inputDatasourcePlugin = async () =>\r\n  await import(/* webpackChunkName: \"inputDatasourcePlugin\" */ 'app/plugins/datasource/input/module');\r\nconst stackdriverPlugin = async () =>\r\n  await import(/* webpackChunkName: \"stackdriverPlugin\" */ 'app/plugins/datasource/stackdriver/module');\r\nconst azureMonitorPlugin = async () =>\r\n  await import(\r\n    /* webpackChunkName: \"azureMonitorPlugin\" */ 'app/plugins/datasource/grafana-azure-monitor-datasource/module'\r\n  );\r\n\r\nimport * as textPanel from 'app/plugins/panel/text/module';\r\nimport * as text2Panel from 'app/plugins/panel/text2/module';\r\nimport * as graph2Panel from 'app/plugins/panel/graph2/module';\r\nimport * as graphPanel from 'app/plugins/panel/graph/module';\r\nimport * as dashListPanel from 'app/plugins/panel/dashlist/module';\r\nimport * as pluginsListPanel from 'app/plugins/panel/pluginlist/module';\r\nimport * as alertListPanel from 'app/plugins/panel/alertlist/module';\r\nimport * as annoListPanel from 'app/plugins/panel/annolist/module';\r\nimport * as heatmapPanel from 'app/plugins/panel/heatmap/module';\r\nimport * as tablePanel from 'app/plugins/panel/table/module';\r\nimport * as table2Panel from 'app/plugins/panel/table2/module';\r\nimport * as singlestatPanel from 'app/plugins/panel/singlestat/module';\r\nimport * as singlestatPanel2 from 'app/plugins/panel/stat/module';\r\nimport * as gettingStartedPanel from 'app/plugins/panel/gettingstarted/module';\r\nimport * as gaugePanel from 'app/plugins/panel/gauge/module';\r\nimport * as pieChartPanel from 'app/plugins/panel/piechart/module';\r\nimport * as barGaugePanel from 'app/plugins/panel/bargauge/module';\r\nimport * as logsPanel from 'app/plugins/panel/logs/module';\r\nimport * as newsPanel from 'app/plugins/panel/news/module';\r\nimport * as homeLinksPanel from 'app/plugins/panel/homelinks/module';\r\n\r\nconst builtInPlugins: any = {\r\n  'app/plugins/datasource/graphite/module': graphitePlugin,\r\n  'app/plugins/datasource/cloudwatch/module': cloudwatchPlugin,\r\n  'app/plugins/datasource/dashboard/module': dashboardDSPlugin,\r\n  'app/plugins/datasource/elasticsearch/module': elasticsearchPlugin,\r\n  'app/plugins/datasource/opentsdb/module': opentsdbPlugin,\r\n  'app/plugins/datasource/grafana/module': grafanaPlugin,\r\n  'app/plugins/datasource/influxdb/module': influxdbPlugin,\r\n  'app/plugins/datasource/loki/module': lokiPlugin,\r\n  'app/plugins/datasource/mixed/module': mixedPlugin,\r\n  'app/plugins/datasource/mysql/module': mysqlPlugin,\r\n  'app/plugins/datasource/postgres/module': postgresPlugin,\r\n  'app/plugins/datasource/mssql/module': mssqlPlugin,\r\n  'app/plugins/datasource/prometheus/module': prometheusPlugin,\r\n  'app/plugins/datasource/testdata/module': testDataDSPlugin,\r\n  'app/plugins/datasource/input/module': inputDatasourcePlugin,\r\n  'app/plugins/datasource/stackdriver/module': stackdriverPlugin,\r\n  'app/plugins/datasource/grafana-azure-monitor-datasource/module': azureMonitorPlugin,\r\n\r\n  'app/plugins/panel/text/module': textPanel,\r\n  'app/plugins/panel/text2/module': text2Panel,\r\n  'app/plugins/panel/graph2/module': graph2Panel,\r\n  'app/plugins/panel/graph/module': graphPanel,\r\n  'app/plugins/panel/dashlist/module': dashListPanel,\r\n  'app/plugins/panel/pluginlist/module': pluginsListPanel,\r\n  'app/plugins/panel/alertlist/module': alertListPanel,\r\n  'app/plugins/panel/annolist/module': annoListPanel,\r\n  'app/plugins/panel/heatmap/module': heatmapPanel,\r\n  'app/plugins/panel/table/module': tablePanel,\r\n  'app/plugins/panel/table2/module': table2Panel,\r\n  'app/plugins/panel/news/module': newsPanel,\r\n  'app/plugins/panel/singlestat/module': singlestatPanel,\r\n  'app/plugins/panel/stat/module': singlestatPanel2,\r\n  'app/plugins/panel/gettingstarted/module': gettingStartedPanel,\r\n  'app/plugins/panel/gauge/module': gaugePanel,\r\n  'app/plugins/panel/piechart/module': pieChartPanel,\r\n  'app/plugins/panel/bargauge/module': barGaugePanel,\r\n  'app/plugins/panel/logs/module': logsPanel,\r\n  'app/plugins/panel/homelinks/module': homeLinksPanel,\r\n};\r\n\r\nexport default builtInPlugins;\r\n","// Libraries\r\nimport _ from 'lodash';\r\nimport coreModule from 'app/core/core_module';\r\n\r\n// Services & Utils\r\nimport config from 'app/core/config';\r\nimport { importDataSourcePlugin } from './plugin_loader';\r\nimport { DataSourceSrv as DataSourceService, getDataSourceSrv as getDataSourceService } from '@grafana/runtime';\r\n\r\n// Types\r\nimport { DataSourceApi, DataSourceSelectItem, ScopedVars, AppEvents } from '@grafana/data';\r\nimport { auto } from 'angular';\r\nimport { TemplateSrv } from '../templating/template_srv';\r\nimport { GrafanaRootScope } from 'app/routes/GrafanaCtrl';\r\n\r\n// Pretend Datasource\r\nimport { expressionDatasource } from 'app/features/expressions/ExpressionDatasource';\r\n\r\nexport class DatasourceSrv implements DataSourceService {\r\n  datasources: Record<string, DataSourceApi>;\r\n\r\n  /** @ngInject */\r\n  constructor(\r\n    private $injector: auto.IInjectorService,\r\n    private $rootScope: GrafanaRootScope,\r\n    private templateSrv: TemplateSrv\r\n  ) {\r\n    this.init();\r\n  }\r\n\r\n  init() {\r\n    this.datasources = {};\r\n  }\r\n\r\n  get(name?: string, scopedVars?: ScopedVars): Promise<DataSourceApi> {\r\n    if (!name) {\r\n      return this.get(config.defaultDatasource);\r\n    }\r\n\r\n    // Interpolation here is to support template variable in data source selection\r\n    name = this.templateSrv.replace(name, scopedVars, (value: any[], variable: any) => {\r\n      if (Array.isArray(value)) {\r\n        return value[0];\r\n      }\r\n      return value;\r\n    });\r\n\r\n    if (name === 'default') {\r\n      return this.get(config.defaultDatasource);\r\n    }\r\n\r\n    if (this.datasources[name]) {\r\n      return Promise.resolve(this.datasources[name]);\r\n    }\r\n\r\n    return this.loadDatasource(name);\r\n  }\r\n\r\n  loadDatasource(name: string): Promise<DataSourceApi<any, any>> {\r\n    // Expression Datasource (not a real datasource)\r\n    if (name === expressionDatasource.name) {\r\n      this.datasources[name] = expressionDatasource as any;\r\n      return Promise.resolve(expressionDatasource);\r\n    }\r\n\r\n    const dsConfig = config.datasources[name];\r\n    if (!dsConfig) {\r\n      return Promise.reject({ message: `Datasource named ${name} was not found` });\r\n    }\r\n\r\n    return importDataSourcePlugin(dsConfig.meta)\r\n      .then(dsPlugin => {\r\n        // check if its in cache now\r\n        if (this.datasources[name]) {\r\n          return this.datasources[name];\r\n        }\r\n\r\n        // If there is only one constructor argument it is instanceSettings\r\n        const useAngular = dsPlugin.DataSourceClass.length !== 1;\r\n        const instance: DataSourceApi = useAngular\r\n          ? this.$injector.instantiate(dsPlugin.DataSourceClass, {\r\n              instanceSettings: dsConfig,\r\n            })\r\n          : new dsPlugin.DataSourceClass(dsConfig);\r\n\r\n        instance.components = dsPlugin.components;\r\n        instance.meta = dsConfig.meta;\r\n\r\n        // store in instance cache\r\n        this.datasources[name] = instance;\r\n        return instance;\r\n      })\r\n      .catch(err => {\r\n        this.$rootScope.appEvent(AppEvents.alertError, [dsConfig.name + ' plugin failed', err.toString()]);\r\n        return undefined;\r\n      });\r\n  }\r\n\r\n  getAll() {\r\n    const { datasources } = config;\r\n    return Object.keys(datasources).map(name => datasources[name]);\r\n  }\r\n\r\n  getExternal() {\r\n    const datasources = this.getAll().filter(ds => !ds.meta.builtIn);\r\n    return _.sortBy(datasources, ['name']);\r\n  }\r\n\r\n  getAnnotationSources() {\r\n    const sources: any[] = [];\r\n\r\n    this.addDataSourceVariables(sources);\r\n\r\n    _.each(config.datasources, value => {\r\n      if (value.meta && value.meta.annotations) {\r\n        sources.push(value);\r\n      }\r\n    });\r\n\r\n    return sources;\r\n  }\r\n\r\n  getMetricSources(options?: { skipVariables?: boolean }) {\r\n    const metricSources: DataSourceSelectItem[] = [];\r\n\r\n    _.each(config.datasources, (value, key) => {\r\n      if (value.meta && value.meta.metrics) {\r\n        let metricSource = { value: key, name: key, meta: value.meta, sort: key };\r\n\r\n        //Make sure grafana and mixed are sorted at the bottom\r\n        if (value.meta.id === 'grafana') {\r\n          metricSource.sort = String.fromCharCode(253);\r\n        } else if (value.meta.id === 'dashboard') {\r\n          metricSource.sort = String.fromCharCode(254);\r\n        } else if (value.meta.id === 'mixed') {\r\n          metricSource.sort = String.fromCharCode(255);\r\n        }\r\n\r\n        metricSources.push(metricSource);\r\n\r\n        if (key === config.defaultDatasource) {\r\n          metricSource = { value: null, name: 'default', meta: value.meta, sort: key };\r\n          metricSources.push(metricSource);\r\n        }\r\n      }\r\n    });\r\n\r\n    if (!options || !options.skipVariables) {\r\n      this.addDataSourceVariables(metricSources);\r\n    }\r\n\r\n    metricSources.sort((a, b) => {\r\n      if (a.sort.toLowerCase() > b.sort.toLowerCase()) {\r\n        return 1;\r\n      }\r\n      if (a.sort.toLowerCase() < b.sort.toLowerCase()) {\r\n        return -1;\r\n      }\r\n      return 0;\r\n    });\r\n\r\n    return metricSources;\r\n  }\r\n\r\n  addDataSourceVariables(list: any[]) {\r\n    // look for data source variables\r\n    for (let i = 0; i < this.templateSrv.variables.length; i++) {\r\n      const variable = this.templateSrv.variables[i];\r\n      if (variable.type !== 'datasource') {\r\n        continue;\r\n      }\r\n\r\n      let first = variable.current.value;\r\n      if (first === 'default') {\r\n        first = config.defaultDatasource;\r\n      }\r\n\r\n      const ds = config.datasources[first];\r\n\r\n      if (ds) {\r\n        const key = `$${variable.name}`;\r\n        list.push({\r\n          name: key,\r\n          value: key,\r\n          meta: ds.meta,\r\n          sort: key,\r\n        });\r\n      }\r\n    }\r\n  }\r\n}\r\n\r\nexport const getDatasourceSrv = (): DatasourceSrv => {\r\n  return getDataSourceService() as DatasourceSrv;\r\n};\r\n\r\ncoreModule.service('datasourceSrv', DatasourceSrv);\r\nexport default DatasourceSrv;\r\n","import angular from 'angular';\r\nimport _ from 'lodash';\r\n\r\nimport config from 'app/core/config';\r\nimport coreModule from 'app/core/core_module';\r\n\r\nimport { DataSourceApi } from '@grafana/data';\r\nimport { importPanelPlugin, importDataSourcePlugin, importAppPlugin } from './plugin_loader';\r\nimport DatasourceSrv from './datasource_srv';\r\nimport { GrafanaRootScope } from 'app/routes/GrafanaCtrl';\r\n\r\n/** @ngInject */\r\nfunction pluginDirectiveLoader(\r\n  $compile: any,\r\n  datasourceSrv: DatasourceSrv,\r\n  $rootScope: GrafanaRootScope,\r\n  $http: any,\r\n  $templateCache: any,\r\n  $timeout: any\r\n) {\r\n  function getTemplate(component: { template: any; templateUrl: any }) {\r\n    if (component.template) {\r\n      return Promise.resolve(component.template);\r\n    }\r\n    const cached = $templateCache.get(component.templateUrl);\r\n    if (cached) {\r\n      return Promise.resolve(cached);\r\n    }\r\n    return $http.get(component.templateUrl).then((res: any) => {\r\n      return res.data;\r\n    });\r\n  }\r\n\r\n  function relativeTemplateUrlToAbs(templateUrl: string, baseUrl: string) {\r\n    if (!templateUrl) {\r\n      return undefined;\r\n    }\r\n    if (templateUrl.indexOf('public') === 0) {\r\n      return templateUrl;\r\n    }\r\n    return baseUrl + '/' + templateUrl;\r\n  }\r\n\r\n  function getPluginComponentDirective(options: any) {\r\n    // handle relative template urls for plugin templates\r\n    options.Component.templateUrl = relativeTemplateUrlToAbs(options.Component.templateUrl, options.baseUrl);\r\n\r\n    return () => {\r\n      return {\r\n        templateUrl: options.Component.templateUrl,\r\n        template: options.Component.template,\r\n        restrict: 'E',\r\n        controller: options.Component,\r\n        controllerAs: 'ctrl',\r\n        bindToController: true,\r\n        scope: options.bindings,\r\n        link: (scope: any, elem: any, attrs: any, ctrl: any) => {\r\n          if (ctrl.link) {\r\n            ctrl.link(scope, elem, attrs, ctrl);\r\n          }\r\n          if (ctrl.init) {\r\n            ctrl.init();\r\n          }\r\n        },\r\n      };\r\n    };\r\n  }\r\n\r\n  function loadPanelComponentInfo(scope: any, attrs: any) {\r\n    const componentInfo: any = {\r\n      name: 'panel-plugin-' + scope.panel.type,\r\n      bindings: { dashboard: '=', panel: '=', row: '=' },\r\n      attrs: {\r\n        dashboard: 'dashboard',\r\n        panel: 'panel',\r\n        class: 'panel-height-helper',\r\n      },\r\n    };\r\n\r\n    const panelInfo = config.panels[scope.panel.type];\r\n    return importPanelPlugin(panelInfo.id).then(panelPlugin => {\r\n      const PanelCtrl = panelPlugin.angularPanelCtrl;\r\n      componentInfo.Component = PanelCtrl;\r\n\r\n      if (!PanelCtrl || PanelCtrl.registered) {\r\n        return componentInfo;\r\n      }\r\n\r\n      if (PanelCtrl.templatePromise) {\r\n        return PanelCtrl.templatePromise.then((res: any) => {\r\n          return componentInfo;\r\n        });\r\n      }\r\n\r\n      if (panelInfo) {\r\n        PanelCtrl.templateUrl = relativeTemplateUrlToAbs(PanelCtrl.templateUrl, panelInfo.baseUrl);\r\n      }\r\n\r\n      PanelCtrl.templatePromise = getTemplate(PanelCtrl).then((template: any) => {\r\n        PanelCtrl.templateUrl = null;\r\n        PanelCtrl.template = `<grafana-panel ctrl=\"ctrl\" class=\"panel-height-helper\">${template}</grafana-panel>`;\r\n        return componentInfo;\r\n      });\r\n\r\n      return PanelCtrl.templatePromise;\r\n    });\r\n  }\r\n\r\n  function getModule(scope: any, attrs: any): any {\r\n    switch (attrs.type) {\r\n      // QueryCtrl\r\n      case 'query-ctrl': {\r\n        const ds: DataSourceApi = scope.ctrl.datasource as DataSourceApi;\r\n\r\n        return Promise.resolve({\r\n          baseUrl: ds.meta.baseUrl,\r\n          name: 'query-ctrl-' + ds.meta.id,\r\n          bindings: { target: '=', panelCtrl: '=', datasource: '=' },\r\n          attrs: {\r\n            target: 'ctrl.target',\r\n            'panel-ctrl': 'ctrl',\r\n            datasource: 'ctrl.datasource',\r\n          },\r\n          Component: ds.components.QueryCtrl,\r\n        });\r\n      }\r\n      // Annotations\r\n      case 'annotations-query-ctrl': {\r\n        const baseUrl = scope.ctrl.currentDatasource.meta.baseUrl;\r\n        const pluginId = scope.ctrl.currentDatasource.meta.id;\r\n\r\n        return importDataSourcePlugin(scope.ctrl.currentDatasource.meta).then(dsPlugin => {\r\n          return {\r\n            baseUrl,\r\n            name: 'annotations-query-ctrl-' + pluginId,\r\n            bindings: { annotation: '=', datasource: '=' },\r\n            attrs: {\r\n              annotation: 'ctrl.currentAnnotation',\r\n              datasource: 'ctrl.currentDatasource',\r\n            },\r\n            Component: dsPlugin.components.AnnotationsQueryCtrl,\r\n          };\r\n        });\r\n      }\r\n      // Datasource ConfigCtrl\r\n      case 'datasource-config-ctrl': {\r\n        const dsMeta = scope.ctrl.datasourceMeta;\r\n        return importDataSourcePlugin(dsMeta).then(dsPlugin => {\r\n          scope.$watch(\r\n            'ctrl.current',\r\n            () => {\r\n              scope.onModelChanged(scope.ctrl.current);\r\n            },\r\n            true\r\n          );\r\n\r\n          return {\r\n            baseUrl: dsMeta.baseUrl,\r\n            name: 'ds-config-' + dsMeta.id,\r\n            bindings: { meta: '=', current: '=' },\r\n            attrs: { meta: 'ctrl.datasourceMeta', current: 'ctrl.current' },\r\n            Component: dsPlugin.angularConfigCtrl,\r\n          };\r\n        });\r\n      }\r\n      // AppConfigCtrl\r\n      case 'app-config-ctrl': {\r\n        const model = scope.ctrl.model;\r\n        return importAppPlugin(model).then(appPlugin => {\r\n          return {\r\n            baseUrl: model.baseUrl,\r\n            name: 'app-config-' + model.id,\r\n            bindings: { appModel: '=', appEditCtrl: '=' },\r\n            attrs: { 'app-model': 'ctrl.model', 'app-edit-ctrl': 'ctrl' },\r\n            Component: appPlugin.angularConfigCtrl,\r\n          };\r\n        });\r\n      }\r\n      // App Page\r\n      case 'app-page': {\r\n        const appModel = scope.ctrl.appModel;\r\n        return importAppPlugin(appModel).then(appPlugin => {\r\n          return {\r\n            baseUrl: appModel.baseUrl,\r\n            name: 'app-page-' + appModel.id + '-' + scope.ctrl.page.slug,\r\n            bindings: { appModel: '=' },\r\n            attrs: { 'app-model': 'ctrl.appModel' },\r\n            Component: appPlugin.angularPages[scope.ctrl.page.component],\r\n          };\r\n        });\r\n      }\r\n      // Panel\r\n      case 'panel': {\r\n        return loadPanelComponentInfo(scope, attrs);\r\n      }\r\n      default: {\r\n        return Promise.reject({\r\n          message: 'Could not find component type: ' + attrs.type,\r\n        });\r\n      }\r\n    }\r\n  }\r\n\r\n  function appendAndCompile(scope: any, elem: JQuery, componentInfo: any) {\r\n    const child = angular.element(document.createElement(componentInfo.name));\r\n    _.each(componentInfo.attrs, (value, key) => {\r\n      child.attr(key, value);\r\n    });\r\n\r\n    $compile(child)(scope);\r\n    elem.empty();\r\n\r\n    // let a binding digest cycle complete before adding to dom\r\n    setTimeout(() => {\r\n      scope.$applyAsync(() => {\r\n        elem.append(child);\r\n        setTimeout(() => {\r\n          scope.$applyAsync(() => {\r\n            scope.$broadcast('component-did-mount');\r\n          });\r\n        });\r\n      });\r\n    });\r\n  }\r\n\r\n  function registerPluginComponent(scope: any, elem: JQuery, attrs: any, componentInfo: any) {\r\n    if (componentInfo.notFound) {\r\n      elem.empty();\r\n      return;\r\n    }\r\n\r\n    if (!componentInfo.Component) {\r\n      throw {\r\n        message: 'Failed to find exported plugin component for ' + componentInfo.name,\r\n      };\r\n    }\r\n\r\n    if (!componentInfo.Component.registered) {\r\n      const directiveName = attrs.$normalize(componentInfo.name);\r\n      const directiveFn = getPluginComponentDirective(componentInfo);\r\n      coreModule.directive(directiveName, directiveFn);\r\n      componentInfo.Component.registered = true;\r\n    }\r\n\r\n    appendAndCompile(scope, elem, componentInfo);\r\n  }\r\n\r\n  return {\r\n    restrict: 'E',\r\n    link: (scope: any, elem: JQuery, attrs: any) => {\r\n      getModule(scope, attrs)\r\n        .then((componentInfo: any) => {\r\n          registerPluginComponent(scope, elem, attrs, componentInfo);\r\n        })\r\n        .catch((err: any) => {\r\n          console.log('Plugin component error', err);\r\n        });\r\n    },\r\n  };\r\n}\r\n\r\ncoreModule.directive('pluginComponent', pluginDirectiveLoader);\r\n","import _ from 'lodash';\r\nimport * as sdk from 'app/plugins/sdk';\r\nimport kbn from 'app/core/utils/kbn';\r\n// tslint:disable:import-blacklist\r\nimport moment from 'moment';\r\nimport angular from 'angular';\r\nimport jquery from 'jquery';\r\n\r\n// Experimental module exports\r\nimport prismjs from 'prismjs';\r\nimport slate from 'slate';\r\n// @ts-ignore\r\nimport slateReact from '@grafana/slate-react';\r\n// @ts-ignore\r\nimport slatePlain from 'slate-plain-serializer';\r\nimport react from 'react';\r\nimport reactDom from 'react-dom';\r\nimport * as reactRedux from 'react-redux';\r\nimport * as redux from 'redux';\r\n\r\nimport config from 'app/core/config';\r\nimport TimeSeries from 'app/core/time_series2';\r\nimport TableModel from 'app/core/table_model';\r\nimport { coreModule, appEvents, contextSrv } from 'app/core/core';\r\nimport {\r\n  DataSourcePlugin,\r\n  AppPlugin,\r\n  PanelPlugin,\r\n  PluginMeta,\r\n  DataSourcePluginMeta,\r\n  dateMath,\r\n  DataSourceApi,\r\n  DataSourceJsonData,\r\n  DataQuery,\r\n} from '@grafana/data';\r\nimport * as fileExport from 'app/core/utils/file_export';\r\nimport * as flatten from 'app/core/utils/flatten';\r\nimport * as ticks from 'app/core/utils/ticks';\r\nimport { BackendSrv, getBackendSrv } from 'app/core/services/backend_srv';\r\nimport impressionSrv from 'app/core/services/impression_srv';\r\nimport builtInPlugins from './built_in_plugins';\r\nimport * as d3 from 'd3';\r\nimport * as emotion from 'emotion';\r\nimport * as grafanaData from '@grafana/data';\r\nimport * as grafanaUIraw from '@grafana/ui';\r\nimport * as grafanaRuntime from '@grafana/runtime';\r\n\r\n// Help the 6.4 to 6.5 migration\r\n// The base classes were moved from @grafana/ui to @grafana/data\r\n// This exposes the same classes on both import paths\r\nconst grafanaUI = grafanaUIraw as any;\r\ngrafanaUI.PanelPlugin = grafanaData.PanelPlugin;\r\ngrafanaUI.DataSourcePlugin = grafanaData.DataSourcePlugin;\r\ngrafanaUI.AppPlugin = grafanaData.AppPlugin;\r\ngrafanaUI.DataSourceApi = grafanaData.DataSourceApi;\r\n\r\n// rxjs\r\nimport * as rxjs from 'rxjs';\r\nimport * as rxjsOperators from 'rxjs/operators';\r\n\r\n// add cache busting\r\nconst bust = `?_cache=${Date.now()}`;\r\nfunction locate(load: { address: string }) {\r\n  return load.address + bust;\r\n}\r\ngrafanaRuntime.SystemJS.registry.set('plugin-loader', grafanaRuntime.SystemJS.newModule({ locate: locate }));\r\n\r\ngrafanaRuntime.SystemJS.config({\r\n  baseURL: 'public',\r\n  defaultExtension: 'js',\r\n  packages: {\r\n    plugins: {\r\n      defaultExtension: 'js',\r\n    },\r\n  },\r\n  map: {\r\n    text: 'vendor/plugin-text/text.js',\r\n    css: 'vendor/plugin-css/css.js',\r\n  },\r\n  meta: {\r\n    '/*': {\r\n      esModule: true,\r\n      authorization: true,\r\n      loader: 'plugin-loader',\r\n    },\r\n  },\r\n});\r\n\r\nfunction exposeToPlugin(name: string, component: any) {\r\n  grafanaRuntime.SystemJS.registerDynamic(name, [], true, (require: any, exports: any, module: { exports: any }) => {\r\n    module.exports = component;\r\n  });\r\n}\r\n\r\nexposeToPlugin('@grafana/data', grafanaData);\r\nexposeToPlugin('@grafana/ui', grafanaUI);\r\nexposeToPlugin('@grafana/runtime', grafanaRuntime);\r\nexposeToPlugin('lodash', _);\r\nexposeToPlugin('moment', moment);\r\nexposeToPlugin('jquery', jquery);\r\nexposeToPlugin('angular', angular);\r\nexposeToPlugin('d3', d3);\r\nexposeToPlugin('rxjs', rxjs);\r\nexposeToPlugin('rxjs/operators', rxjsOperators);\r\n\r\n// Experimental modules\r\nexposeToPlugin('prismjs', prismjs);\r\nexposeToPlugin('slate', slate);\r\nexposeToPlugin('@grafana/slate-react', slateReact);\r\nexposeToPlugin('slate-plain-serializer', slatePlain);\r\nexposeToPlugin('react', react);\r\nexposeToPlugin('react-dom', reactDom);\r\nexposeToPlugin('react-redux', reactRedux);\r\nexposeToPlugin('redux', redux);\r\nexposeToPlugin('emotion', emotion);\r\n\r\nexposeToPlugin('app/features/dashboard/impression_store', {\r\n  impressions: impressionSrv,\r\n  __esModule: true,\r\n});\r\n\r\n/**\r\n * NOTE: this is added temporarily while we explore a long term solution\r\n * If you use this export, only use the:\r\n *  get/delete/post/patch/request methods\r\n */\r\nexposeToPlugin('app/core/services/backend_srv', {\r\n  BackendSrv,\r\n  getBackendSrv,\r\n});\r\n\r\nexposeToPlugin('app/plugins/sdk', sdk);\r\nexposeToPlugin('app/core/utils/datemath', dateMath);\r\nexposeToPlugin('app/core/utils/file_export', fileExport);\r\nexposeToPlugin('app/core/utils/flatten', flatten);\r\nexposeToPlugin('app/core/utils/kbn', kbn);\r\nexposeToPlugin('app/core/utils/ticks', ticks);\r\n\r\nexposeToPlugin('app/core/config', config);\r\nexposeToPlugin('app/core/time_series', TimeSeries);\r\nexposeToPlugin('app/core/time_series2', TimeSeries);\r\nexposeToPlugin('app/core/table_model', TableModel);\r\nexposeToPlugin('app/core/app_events', appEvents);\r\nexposeToPlugin('app/core/core_module', coreModule);\r\nexposeToPlugin('app/core/core', {\r\n  coreModule: coreModule,\r\n  appEvents: appEvents,\r\n  contextSrv: contextSrv,\r\n  __esModule: true,\r\n});\r\n\r\nimport 'vendor/flot/jquery.flot';\r\nimport 'vendor/flot/jquery.flot.selection';\r\nimport 'vendor/flot/jquery.flot.time';\r\nimport 'vendor/flot/jquery.flot.stack';\r\nimport 'vendor/flot/jquery.flot.stackpercent';\r\nimport 'vendor/flot/jquery.flot.fillbelow';\r\nimport 'vendor/flot/jquery.flot.crosshair';\r\nimport 'vendor/flot/jquery.flot.dashes';\r\nimport 'vendor/flot/jquery.flot.gauge';\r\n\r\nconst flotDeps = [\r\n  'jquery.flot',\r\n  'jquery.flot.pie',\r\n  'jquery.flot.time',\r\n  'jquery.flot.fillbelow',\r\n  'jquery.flot.crosshair',\r\n  'jquery.flot.stack',\r\n  'jquery.flot.selection',\r\n  'jquery.flot.stackpercent',\r\n  'jquery.flot.events',\r\n  'jquery.flot.gauge',\r\n];\r\n\r\nfor (const flotDep of flotDeps) {\r\n  exposeToPlugin(flotDep, { fakeDep: 1 });\r\n}\r\n\r\nexport async function importPluginModule(path: string): Promise<any> {\r\n  const builtIn = builtInPlugins[path];\r\n  if (builtIn) {\r\n    // for handling dynamic imports\r\n    if (typeof builtIn === 'function') {\r\n      return await builtIn();\r\n    } else {\r\n      return Promise.resolve(builtIn);\r\n    }\r\n  }\r\n  return grafanaRuntime.SystemJS.import(path);\r\n}\r\n\r\nexport function importDataSourcePlugin(meta: DataSourcePluginMeta): Promise<GenericDataSourcePlugin> {\r\n  return importPluginModule(meta.module).then(pluginExports => {\r\n    if (pluginExports.plugin) {\r\n      const dsPlugin = pluginExports.plugin as GenericDataSourcePlugin;\r\n      dsPlugin.meta = meta;\r\n      return dsPlugin;\r\n    }\r\n\r\n    if (pluginExports.Datasource) {\r\n      const dsPlugin = new DataSourcePlugin<\r\n        DataSourceApi<DataQuery, DataSourceJsonData>,\r\n        DataQuery,\r\n        DataSourceJsonData\r\n      >(pluginExports.Datasource);\r\n      dsPlugin.setComponentsFromLegacyExports(pluginExports);\r\n      dsPlugin.meta = meta;\r\n      return dsPlugin;\r\n    }\r\n\r\n    throw new Error('Plugin module is missing DataSourcePlugin or Datasource constructor export');\r\n  });\r\n}\r\n\r\nexport function importAppPlugin(meta: PluginMeta): Promise<AppPlugin> {\r\n  return importPluginModule(meta.module).then(pluginExports => {\r\n    const plugin = pluginExports.plugin ? (pluginExports.plugin as AppPlugin) : new AppPlugin();\r\n    plugin.init(meta);\r\n    plugin.meta = meta;\r\n    plugin.setComponentsFromLegacyExports(pluginExports);\r\n    return plugin;\r\n  });\r\n}\r\n\r\nimport { getPanelPluginNotFound, getPanelPluginLoadError } from '../dashboard/dashgrid/PanelPluginError';\r\nimport { GenericDataSourcePlugin } from '../datasources/settings/PluginSettings';\r\n\r\ninterface PanelCache {\r\n  [key: string]: PanelPlugin;\r\n}\r\nconst panelCache: PanelCache = {};\r\n\r\nexport function importPanelPlugin(id: string): Promise<PanelPlugin> {\r\n  const loaded = panelCache[id];\r\n  if (loaded) {\r\n    return Promise.resolve(loaded);\r\n  }\r\n  const meta = config.panels[id];\r\n  if (!meta) {\r\n    return Promise.resolve(getPanelPluginNotFound(id));\r\n  }\r\n\r\n  return importPluginModule(meta.module)\r\n    .then(pluginExports => {\r\n      if (pluginExports.plugin) {\r\n        return pluginExports.plugin as PanelPlugin;\r\n      } else if (pluginExports.PanelCtrl) {\r\n        const plugin = new PanelPlugin(null);\r\n        plugin.angularPanelCtrl = pluginExports.PanelCtrl;\r\n        return plugin;\r\n      }\r\n      throw new Error('missing export: plugin or PanelCtrl');\r\n    })\r\n    .then(plugin => {\r\n      plugin.meta = meta;\r\n      return (panelCache[meta.id] = plugin);\r\n    })\r\n    .catch(err => {\r\n      // TODO, maybe a different error plugin\r\n      console.warn('Error loading panel plugin: ' + id, err);\r\n      return getPanelPluginLoadError(meta, err);\r\n    });\r\n}\r\n","import angular from 'angular';\r\nimport _ from 'lodash';\r\n\r\nimport { getPluginSettings } from './PluginSettingsCache';\r\nimport { PluginMeta } from '@grafana/data';\r\nimport { NavModelSrv } from 'app/core/core';\r\nimport { GrafanaRootScope } from 'app/routes/GrafanaCtrl';\r\nimport { AppEvents } from '@grafana/data';\r\n\r\nexport class AppPageCtrl {\r\n  page: any;\r\n  pluginId: any;\r\n  appModel: any;\r\n  navModel: any;\r\n\r\n  /** @ngInject */\r\n  constructor(private $routeParams: any, private $rootScope: GrafanaRootScope, private navModelSrv: NavModelSrv) {\r\n    this.pluginId = $routeParams.pluginId;\r\n\r\n    Promise.resolve(getPluginSettings(this.pluginId))\r\n      .then(settings => {\r\n        this.initPage(settings);\r\n      })\r\n      .catch(err => {\r\n        this.$rootScope.appEvent(AppEvents.alertError, ['Unknown Plugin']);\r\n        this.navModel = this.navModelSrv.getNotFoundNav();\r\n      });\r\n  }\r\n\r\n  initPage(app: PluginMeta) {\r\n    this.appModel = app;\r\n    this.page = _.find(app.includes, { slug: this.$routeParams.slug });\r\n\r\n    if (!this.page) {\r\n      this.$rootScope.appEvent(AppEvents.alertError, ['App Page Not Found']);\r\n      this.navModel = this.navModelSrv.getNotFoundNav();\r\n      return;\r\n    }\r\n    if (app.type !== 'app' || !app.enabled) {\r\n      this.$rootScope.appEvent(AppEvents.alertError, ['Application Not Enabled']);\r\n      this.navModel = this.navModelSrv.getNotFoundNav();\r\n      return;\r\n    }\r\n\r\n    const pluginNav = this.navModelSrv.getNav('plugin-page-' + app.id);\r\n\r\n    this.navModel = {\r\n      main: {\r\n        img: app.info.logos.large,\r\n        subTitle: app.name,\r\n        url: '',\r\n        text: this.page.name,\r\n        breadcrumbs: [{ title: app.name, url: pluginNav.main.url }],\r\n      },\r\n    };\r\n  }\r\n}\r\n\r\nangular.module('grafana.controllers').controller('AppPageCtrl', AppPageCtrl);\r\n","import { getBackendSrv } from '@grafana/runtime';\r\n\r\nimport { ThunkResult } from 'app/types';\r\nimport { pluginDashboardsLoad, pluginDashboardsLoaded, pluginsLoaded } from './reducers';\r\n\r\nexport function loadPlugins(): ThunkResult<void> {\r\n  return async dispatch => {\r\n    const result = await getBackendSrv().get('api/plugins', { embedded: 0 });\r\n    dispatch(pluginsLoaded(result));\r\n  };\r\n}\r\n\r\nexport function loadPluginDashboards(): ThunkResult<void> {\r\n  return async (dispatch, getStore) => {\r\n    dispatch(pluginDashboardsLoad());\r\n    const dataSourceType = getStore().dataSources.dataSource.type;\r\n    const response = await getBackendSrv().get(`api/plugins/${dataSourceType}/dashboards`);\r\n    dispatch(pluginDashboardsLoaded(response));\r\n  };\r\n}\r\n","import { createSlice, PayloadAction } from '@reduxjs/toolkit';\r\nimport { PluginMeta } from '@grafana/data';\r\nimport { PluginsState } from 'app/types';\r\nimport { LayoutMode, LayoutModes } from '../../../core/components/LayoutSelector/LayoutSelector';\r\nimport { PluginDashboard } from '../../../types/plugins';\r\n\r\nexport const initialState: PluginsState = {\r\n  plugins: [],\r\n  searchQuery: '',\r\n  layoutMode: LayoutModes.Grid,\r\n  hasFetched: false,\r\n  dashboards: [],\r\n  isLoadingPluginDashboards: false,\r\n};\r\n\r\nconst pluginsSlice = createSlice({\r\n  name: 'plugins',\r\n  initialState,\r\n  reducers: {\r\n    pluginsLoaded: (state, action: PayloadAction<PluginMeta[]>): PluginsState => {\r\n      return { ...state, hasFetched: true, plugins: action.payload };\r\n    },\r\n    setPluginsSearchQuery: (state, action: PayloadAction<string>): PluginsState => {\r\n      return { ...state, searchQuery: action.payload };\r\n    },\r\n    setPluginsLayoutMode: (state, action: PayloadAction<LayoutMode>): PluginsState => {\r\n      return { ...state, layoutMode: action.payload };\r\n    },\r\n    pluginDashboardsLoad: (state, action: PayloadAction<undefined>): PluginsState => {\r\n      return { ...state, dashboards: [], isLoadingPluginDashboards: true };\r\n    },\r\n    pluginDashboardsLoaded: (state, action: PayloadAction<PluginDashboard[]>): PluginsState => {\r\n      return { ...state, dashboards: action.payload, isLoadingPluginDashboards: false };\r\n    },\r\n  },\r\n});\r\n\r\nexport const {\r\n  pluginsLoaded,\r\n  pluginDashboardsLoad,\r\n  pluginDashboardsLoaded,\r\n  setPluginsLayoutMode,\r\n  setPluginsSearchQuery,\r\n} = pluginsSlice.actions;\r\n\r\nexport const pluginsReducer = pluginsSlice.reducer;\r\n\r\nexport default {\r\n  plugins: pluginsReducer,\r\n};\r\n","import coreModule from 'app/core/core_module';\r\nimport { importDataSourcePlugin } from './plugin_loader';\r\nimport React from 'react';\r\nimport ReactDOM from 'react-dom';\r\nimport DefaultVariableQueryEditor from '../templating/DefaultVariableQueryEditor';\r\nimport { DataSourcePluginMeta } from '@grafana/data';\r\nimport { TemplateSrv } from '../templating/template_srv';\r\n\r\nasync function loadComponent(meta: DataSourcePluginMeta) {\r\n  const dsPlugin = await importDataSourcePlugin(meta);\r\n  if (dsPlugin.components.VariableQueryEditor) {\r\n    return dsPlugin.components.VariableQueryEditor;\r\n  } else {\r\n    return DefaultVariableQueryEditor;\r\n  }\r\n}\r\n\r\n/** @ngInject */\r\nfunction variableQueryEditorLoader(templateSrv: TemplateSrv) {\r\n  return {\r\n    restrict: 'E',\r\n    link: async (scope: any, elem: JQuery) => {\r\n      const Component = await loadComponent(scope.currentDatasource.meta);\r\n      const props = {\r\n        datasource: scope.currentDatasource,\r\n        query: scope.current.query,\r\n        onChange: scope.onQueryChange,\r\n        templateSrv,\r\n      };\r\n      ReactDOM.render(<Component {...props} />, elem[0]);\r\n      scope.$on('$destroy', () => {\r\n        ReactDOM.unmountComponentAtNode(elem[0]);\r\n      });\r\n    },\r\n  };\r\n}\r\n\r\ncoreModule.directive('variableQueryEditorLoader', variableQueryEditorLoader);\r\n","import { coreModule, NavModelSrv } from 'app/core/core';\r\nimport { dateTime } from '@grafana/data';\r\nimport { UserSession } from 'app/types';\r\nimport { BackendSrv } from 'app/core/services/backend_srv';\r\n\r\nexport class ProfileCtrl {\r\n  sessions: object[] = [];\r\n  navModel: any;\r\n\r\n  /** @ngInject */\r\n  constructor(private backendSrv: BackendSrv, navModelSrv: NavModelSrv) {\r\n    this.getUserSessions();\r\n    this.navModel = navModelSrv.getNav('profile', 'profile-settings', 0);\r\n  }\r\n\r\n  getUserSessions() {\r\n    this.backendSrv.get('/api/user/auth-tokens').then((sessions: UserSession[]) => {\r\n      sessions.reverse();\r\n\r\n      const found = sessions.findIndex((session: UserSession) => {\r\n        return session.isActive;\r\n      });\r\n\r\n      if (found) {\r\n        const now = sessions[found];\r\n        sessions.splice(found, found);\r\n        sessions.unshift(now);\r\n      }\r\n\r\n      this.sessions = sessions.map((session: UserSession) => {\r\n        return {\r\n          id: session.id,\r\n          isActive: session.isActive,\r\n          seenAt: dateTime(session.seenAt).fromNow(),\r\n          createdAt: dateTime(session.createdAt).format('MMMM DD, YYYY'),\r\n          clientIp: session.clientIp,\r\n          browser: session.browser,\r\n          browserVersion: session.browserVersion,\r\n          os: session.os,\r\n          osVersion: session.osVersion,\r\n          device: session.device,\r\n        };\r\n      });\r\n    });\r\n  }\r\n\r\n  revokeUserSession(tokenId: number) {\r\n    this.backendSrv\r\n      .post('/api/user/revoke-auth-token', {\r\n        authTokenId: tokenId,\r\n      })\r\n      .then(() => {\r\n        this.sessions = this.sessions.filter((session: UserSession) => {\r\n          if (session.id === tokenId) {\r\n            return false;\r\n          }\r\n          return true;\r\n        });\r\n      });\r\n  }\r\n}\r\n\r\ncoreModule.controller('ProfileCtrl', ProfileCtrl);\r\n","import React from 'react';\r\nimport { UserProvider } from 'app/core/utils/UserProvider';\r\nimport { UserProfileEditForm } from './UserProfileEditForm';\r\nimport { SharedPreferences } from 'app/core/components/SharedPreferences/SharedPreferences';\r\nimport { UserTeams } from './UserTeams';\r\nimport { UserOrganizations } from './UserOrganizations';\r\nimport { config } from '@grafana/runtime';\r\nimport { LoadingPlaceholder } from '@grafana/ui';\r\n\r\nexport const ReactProfileWrapper = () => (\r\n  <UserProvider userId={config.bootData.user.id}>\r\n    {(api, states, teams, orgs, user) => {\r\n      return (\r\n        <>\r\n          {states.loadUser ? (\r\n            <LoadingPlaceholder text=\"Loading user profile...\" />\r\n          ) : (\r\n            <UserProfileEditForm\r\n              updateProfile={api.updateUserProfile}\r\n              isSavingUser={states.updateUserProfile}\r\n              user={user}\r\n            />\r\n          )}\r\n          <SharedPreferences resourceUri=\"user\" />\r\n          <UserTeams isLoading={states.loadTeams} loadTeams={api.loadTeams} teams={teams} />\r\n          {!states.loadUser && (\r\n            <UserOrganizations\r\n              isLoading={states.loadOrgs}\r\n              setUserOrg={api.setUserOrg}\r\n              loadOrgs={api.loadOrgs}\r\n              orgs={orgs}\r\n              user={user}\r\n            />\r\n          )}\r\n        </>\r\n      );\r\n    }}\r\n  </UserProvider>\r\n);\r\n\r\nexport default ReactProfileWrapper;\r\n","import React, { PureComponent } from 'react';\r\nimport { User } from 'app/types';\r\nimport { UserOrg } from 'app/core/utils/UserProvider';\r\nimport { LoadingPlaceholder, Button } from '@grafana/ui';\r\n\r\nexport interface Props {\r\n  user: User;\r\n  orgs: UserOrg[];\r\n  isLoading: boolean;\r\n  loadOrgs: () => void;\r\n  setUserOrg: (org: UserOrg) => void;\r\n}\r\n\r\nexport class UserOrganizations extends PureComponent<Props> {\r\n  componentDidMount() {\r\n    this.props.loadOrgs();\r\n  }\r\n\r\n  render() {\r\n    const { isLoading, orgs, user } = this.props;\r\n\r\n    if (isLoading) {\r\n      return <LoadingPlaceholder text=\"Loading organizations...\" />;\r\n    }\r\n\r\n    return (\r\n      <>\r\n        {orgs.length > 0 && (\r\n          <>\r\n            <h3 className=\"page-sub-heading\">Organizations</h3>\r\n            <div className=\"gf-form-group\">\r\n              <table className=\"filter-table form-inline\">\r\n                <thead>\r\n                  <tr>\r\n                    <th>Name</th>\r\n                    <th>Role</th>\r\n                    <th />\r\n                  </tr>\r\n                </thead>\r\n                <tbody>\r\n                  {orgs.map((org: UserOrg, index) => {\r\n                    return (\r\n                      <tr key={index}>\r\n                        <td>{org.name}</td>\r\n                        <td>{org.role}</td>\r\n                        <td className=\"text-right\">\r\n                          {org.orgId === user.orgId ? (\r\n                            <span className=\"btn btn-primary btn-small\">Current</span>\r\n                          ) : (\r\n                            <Button\r\n                              variant=\"inverse\"\r\n                              size=\"sm\"\r\n                              onClick={() => {\r\n                                this.props.setUserOrg(org);\r\n                              }}\r\n                            >\r\n                              Select\r\n                            </Button>\r\n                          )}\r\n                        </td>\r\n                      </tr>\r\n                    );\r\n                  })}\r\n                </tbody>\r\n              </table>\r\n            </div>\r\n          </>\r\n        )}\r\n      </>\r\n    );\r\n  }\r\n}\r\n\r\nexport default UserOrganizations;\r\n","import React, { PureComponent, ChangeEvent, MouseEvent } from 'react';\r\nimport { Button, FormLabel, Input, Tooltip } from '@grafana/ui';\r\nimport { User } from 'app/types';\r\nimport config from 'app/core/config';\r\nimport { ProfileUpdateFields } from 'app/core/utils/UserProvider';\r\n\r\nexport interface Props {\r\n  user: User;\r\n  isSavingUser: boolean;\r\n  updateProfile: (payload: ProfileUpdateFields) => void;\r\n}\r\n\r\nexport interface State {\r\n  name: string;\r\n  email: string;\r\n  login: string;\r\n}\r\n\r\nexport class UserProfileEditForm extends PureComponent<Props, State> {\r\n  constructor(props: Props) {\r\n    super(props);\r\n\r\n    const {\r\n      user: { name, email, login },\r\n    } = this.props;\r\n\r\n    this.state = {\r\n      name,\r\n      email,\r\n      login,\r\n    };\r\n  }\r\n\r\n  onNameChange = (event: ChangeEvent<HTMLInputElement>) => {\r\n    this.setState({ name: event.target.value });\r\n  };\r\n\r\n  onEmailChange = (event: ChangeEvent<HTMLInputElement>) => {\r\n    this.setState({ email: event.target.value });\r\n  };\r\n\r\n  onLoginChange = (event: ChangeEvent<HTMLInputElement>) => {\r\n    this.setState({ login: event.target.value });\r\n  };\r\n\r\n  onSubmitProfileUpdate = (event: MouseEvent<HTMLInputElement>) => {\r\n    event.preventDefault();\r\n    this.props.updateProfile({ ...this.state });\r\n  };\r\n\r\n  render() {\r\n    const { name, email, login } = this.state;\r\n    const { isSavingUser } = this.props;\r\n    const { disableLoginForm } = config;\r\n\r\n    return (\r\n      <>\r\n        <h3 className=\"page-sub-heading\">Edit Profile</h3>\r\n        <form name=\"userForm\" className=\"gf-form-group\">\r\n          <div className=\"gf-form max-width-30\">\r\n            <FormLabel className=\"width-8\">Name</FormLabel>\r\n            <Input className=\"gf-form-input max-width-22\" type=\"text\" onChange={this.onNameChange} value={name} />\r\n          </div>\r\n          <div className=\"gf-form max-width-30\">\r\n            <FormLabel className=\"width-8\">Email</FormLabel>\r\n            <Input\r\n              className=\"gf-form-input max-width-22\"\r\n              type=\"text\"\r\n              onChange={this.onEmailChange}\r\n              value={email}\r\n              disabled={disableLoginForm}\r\n            />\r\n            {disableLoginForm && (\r\n              <Tooltip content=\"Login Details Locked - managed in another system.\">\r\n                <i className=\"fa fa-lock gf-form-icon--right-absolute\" />\r\n              </Tooltip>\r\n            )}\r\n          </div>\r\n          <div className=\"gf-form max-width-30\">\r\n            <FormLabel className=\"width-8\">Username</FormLabel>\r\n            <Input\r\n              className=\"gf-form-input max-width-22\"\r\n              type=\"text\"\r\n              onChange={this.onLoginChange}\r\n              value={login}\r\n              disabled={disableLoginForm}\r\n            />\r\n            {disableLoginForm && (\r\n              <Tooltip content=\"Login Details Locked - managed in another system.\">\r\n                <i className=\"fa fa-lock gf-form-icon--right-absolute\" />\r\n              </Tooltip>\r\n            )}\r\n          </div>\r\n          <div className=\"gf-form-button-row\">\r\n            <Button variant=\"primary\" onClick={this.onSubmitProfileUpdate} disabled={isSavingUser}>\r\n              Save\r\n            </Button>\r\n          </div>\r\n        </form>\r\n      </>\r\n    );\r\n  }\r\n}\r\n\r\nexport default UserProfileEditForm;\r\n","import React, { PureComponent } from 'react';\r\nimport { Team } from 'app/types';\r\nimport { LoadingPlaceholder } from '@grafana/ui';\r\n\r\nexport interface Props {\r\n  teams: Team[];\r\n  isLoading: boolean;\r\n  loadTeams: () => void;\r\n}\r\n\r\nexport class UserTeams extends PureComponent<Props> {\r\n  componentDidMount() {\r\n    this.props.loadTeams();\r\n  }\r\n\r\n  render() {\r\n    const { isLoading, teams } = this.props;\r\n\r\n    if (isLoading) {\r\n      return <LoadingPlaceholder text=\"Loading teams...\" />;\r\n    }\r\n\r\n    return (\r\n      <>\r\n        {teams.length > 0 && (\r\n          <>\r\n            <h3 className=\"page-sub-heading\">Teams</h3>\r\n            <div className=\"gf-form-group\">\r\n              <table className=\"filter-table form-inline\">\r\n                <thead>\r\n                  <tr>\r\n                    <th />\r\n                    <th>Name</th>\r\n                    <th>Email</th>\r\n                    <th>Members</th>\r\n                  </tr>\r\n                </thead>\r\n                <tbody>\r\n                  {teams.map((team: Team, index) => {\r\n                    return (\r\n                      <tr key={index}>\r\n                        <td className=\"width-4 text-center\">\r\n                          <img className=\"filter-table__avatar\" src={team.avatarUrl} />\r\n                        </td>\r\n                        <td>{team.name}</td>\r\n                        <td>{team.email}</td>\r\n                        <td>{team.memberCount}</td>\r\n                      </tr>\r\n                    );\r\n                  })}\r\n                </tbody>\r\n              </table>\r\n            </div>\r\n          </>\r\n        )}\r\n      </>\r\n    );\r\n  }\r\n}\r\n\r\nexport default UserTeams;\r\n","import './ProfileCtrl';\r\n","import { UserState } from 'app/types';\r\nimport config from 'app/core/config';\r\n\r\nexport const initialState: UserState = {\r\n  orgId: config.bootData.user.orgId,\r\n  timeZone: config.bootData.user.timezone,\r\n};\r\n\r\nexport const userReducer = (state = initialState, action: any): UserState => {\r\n  return state;\r\n};\r\n\r\nexport default {\r\n  user: userReducer,\r\n};\r\n","import { createSlice, PayloadAction } from '@reduxjs/toolkit';\n\nimport { Team, TeamGroup, TeamMember, TeamsState, TeamState } from 'app/types';\n\nexport const initialTeamsState: TeamsState = { teams: [], searchQuery: '', hasFetched: false };\n\nconst teamsSlice = createSlice({\n  name: 'teams',\n  initialState: initialTeamsState,\n  reducers: {\n    teamsLoaded: (state, action: PayloadAction<Team[]>): TeamsState => {\n      return { ...state, hasFetched: true, teams: action.payload };\n    },\n    setSearchQuery: (state, action: PayloadAction<string>): TeamsState => {\n      return { ...state, searchQuery: action.payload };\n    },\n  },\n});\n\nexport const { teamsLoaded, setSearchQuery } = teamsSlice.actions;\n\nexport const teamsReducer = teamsSlice.reducer;\n\nexport const initialTeamState: TeamState = {\n  team: {} as Team,\n  members: [] as TeamMember[],\n  groups: [] as TeamGroup[],\n  searchMemberQuery: '',\n};\n\nconst teamSlice = createSlice({\n  name: 'team',\n  initialState: initialTeamState,\n  reducers: {\n    teamLoaded: (state, action: PayloadAction<Team>): TeamState => {\n      return { ...state, team: action.payload };\n    },\n    teamMembersLoaded: (state, action: PayloadAction<TeamMember[]>): TeamState => {\n      return { ...state, members: action.payload };\n    },\n    setSearchMemberQuery: (state, action: PayloadAction<string>): TeamState => {\n      return { ...state, searchMemberQuery: action.payload };\n    },\n    teamGroupsLoaded: (state, action: PayloadAction<TeamGroup[]>): TeamState => {\n      return { ...state, groups: action.payload };\n    },\n  },\n});\n\nexport const { teamLoaded, teamGroupsLoaded, teamMembersLoaded, setSearchMemberQuery } = teamSlice.actions;\n\nexport const teamReducer = teamSlice.reducer;\n\nexport default {\n  teams: teamsReducer,\n  team: teamReducer,\n};\n","import React, { PureComponent } from 'react';\r\nimport { VariableQueryProps } from 'app/types/plugins';\r\nimport { e2e } from '@grafana/e2e';\r\n\r\nexport default class DefaultVariableQueryEditor extends PureComponent<VariableQueryProps, any> {\r\n  constructor(props: VariableQueryProps) {\r\n    super(props);\r\n    this.state = { value: props.query };\r\n  }\r\n\r\n  onChange = (event: React.FormEvent<HTMLTextAreaElement>) => {\r\n    this.setState({ value: event.currentTarget.value });\r\n  };\r\n\r\n  onBlur = (event: React.FormEvent<HTMLTextAreaElement>) => {\r\n    this.props.onChange(event.currentTarget.value, event.currentTarget.value);\r\n  };\r\n\r\n  getLineCount() {\r\n    const { value } = this.state;\r\n\r\n    if (typeof value === 'string') {\r\n      return value.split('\\n').length;\r\n    }\r\n\r\n    return 1;\r\n  }\r\n\r\n  render() {\r\n    return (\r\n      <div className=\"gf-form\">\r\n        <span className=\"gf-form-label width-10\">Query</span>\r\n        <textarea\r\n          rows={this.getLineCount()}\r\n          className=\"gf-form-input\"\r\n          value={this.state.value}\r\n          onChange={this.onChange}\r\n          onBlur={this.onBlur}\r\n          placeholder=\"metric name or tags query\"\r\n          required\r\n          aria-label={e2e.pages.Dashboard.Settings.Variables.Edit.QueryVariable.selectors.queryOptionsQueryInput}\r\n        />\r\n      </div>\r\n    );\r\n  }\r\n}\r\n","import {\r\n  assignModelProperties,\r\n  TextBoxVariableModel,\r\n  VariableActions,\r\n  VariableHide,\r\n  VariableOption,\r\n  VariableType,\r\n  variableTypes,\r\n} from './variable';\r\nimport { VariableSrv } from './variable_srv';\r\n\r\nexport class TextBoxVariable implements TextBoxVariableModel, VariableActions {\r\n  type: VariableType;\r\n  name: string;\r\n  label: string;\r\n  hide: VariableHide;\r\n  skipUrlSync: boolean;\r\n  query: string;\r\n  current: VariableOption;\r\n  options: VariableOption[];\r\n\r\n  defaults: TextBoxVariableModel = {\r\n    type: 'textbox',\r\n    name: '',\r\n    label: '',\r\n    hide: VariableHide.dontHide,\r\n    query: '',\r\n    current: {} as VariableOption,\r\n    options: [],\r\n    skipUrlSync: false,\r\n  };\r\n\r\n  /** @ngInject */\r\n  constructor(private model: any, private variableSrv: VariableSrv) {\r\n    assignModelProperties(this, model, this.defaults);\r\n  }\r\n\r\n  getSaveModel() {\r\n    assignModelProperties(this.model, this, this.defaults);\r\n    return this.model;\r\n  }\r\n\r\n  setValue(option: any) {\r\n    this.variableSrv.setOptionAsCurrent(this, option);\r\n  }\r\n\r\n  updateOptions() {\r\n    this.options = [{ text: this.query.trim(), value: this.query.trim(), selected: false }];\r\n    this.current = this.options[0];\r\n    return Promise.resolve();\r\n  }\r\n\r\n  dependsOn(variable: any) {\r\n    return false;\r\n  }\r\n\r\n  setValueFromUrl(urlValue: string) {\r\n    this.query = urlValue;\r\n    return this.variableSrv.setOptionFromUrl(this, urlValue);\r\n  }\r\n\r\n  getValueForUrl() {\r\n    return this.current.value;\r\n  }\r\n}\r\n// @ts-ignore\r\nvariableTypes['textbox'] = {\r\n  name: 'Text box',\r\n  ctor: TextBoxVariable,\r\n  description: 'Define a textbox variable, where users can enter any arbitrary string',\r\n};\r\n","import _ from 'lodash';\r\nimport {\r\n  AdHocVariableFilter,\r\n  AdHocVariableModel,\r\n  assignModelProperties,\r\n  VariableActions,\r\n  VariableHide,\r\n  VariableType,\r\n  variableTypes,\r\n} from './variable';\r\n\r\nexport class AdhocVariable implements AdHocVariableModel, VariableActions {\r\n  type: VariableType;\r\n  name: string;\r\n  label: string;\r\n  hide: VariableHide;\r\n  skipUrlSync: boolean;\r\n  filters: AdHocVariableFilter[];\r\n  datasource: string;\r\n\r\n  defaults: AdHocVariableModel = {\r\n    type: 'adhoc',\r\n    name: '',\r\n    label: '',\r\n    hide: VariableHide.dontHide,\r\n    skipUrlSync: false,\r\n    datasource: null,\r\n    filters: [],\r\n  };\r\n\r\n  /** @ngInject */\r\n  constructor(private model: any) {\r\n    assignModelProperties(this, model, this.defaults);\r\n  }\r\n\r\n  setValue(option: any) {\r\n    return Promise.resolve();\r\n  }\r\n\r\n  getSaveModel() {\r\n    assignModelProperties(this.model, this, this.defaults);\r\n    return this.model;\r\n  }\r\n\r\n  updateOptions() {\r\n    return Promise.resolve();\r\n  }\r\n\r\n  dependsOn(variable: any) {\r\n    return false;\r\n  }\r\n\r\n  setValueFromUrl(urlValue: string[] | string[]) {\r\n    if (!_.isArray(urlValue)) {\r\n      urlValue = [urlValue];\r\n    }\r\n\r\n    this.filters = urlValue.map(item => {\r\n      const values = item.split('|').map(value => {\r\n        return this.unescapeDelimiter(value);\r\n      });\r\n      return {\r\n        key: values[0],\r\n        operator: values[1],\r\n        value: values[2],\r\n        condition: '',\r\n      };\r\n    });\r\n\r\n    return Promise.resolve();\r\n  }\r\n\r\n  getValueForUrl() {\r\n    return this.filters.map(filter => {\r\n      return [filter.key, filter.operator, filter.value]\r\n        .map(value => {\r\n          return this.escapeDelimiter(value);\r\n        })\r\n        .join('|');\r\n    });\r\n  }\r\n\r\n  escapeDelimiter(value: string) {\r\n    return value.replace(/\\|/g, '__gfp__');\r\n  }\r\n\r\n  unescapeDelimiter(value: string) {\r\n    return value.replace(/__gfp__/g, '|');\r\n  }\r\n\r\n  setFilters(filters: any[]) {\r\n    this.filters = filters;\r\n  }\r\n}\r\n\r\nvariableTypes['adhoc'] = {\r\n  name: 'Ad hoc filters',\r\n  ctor: AdhocVariable,\r\n  description: 'Add key/value filters on the fly',\r\n};\r\n","import './editor_ctrl';\r\nimport coreModule from 'app/core/core_module';\r\n\r\nimport templateSrv from './template_srv';\r\nimport { VariableSrv } from './variable_srv';\r\nimport { IntervalVariable } from './interval_variable';\r\nimport { QueryVariable } from './query_variable';\r\nimport { DatasourceVariable } from './datasource_variable';\r\nimport { CustomVariable } from './custom_variable';\r\nimport { ConstantVariable } from './constant_variable';\r\nimport { AdhocVariable } from './adhoc_variable';\r\nimport { TextBoxVariable } from './TextBoxVariable';\r\n\r\ncoreModule.factory('templateSrv', () => {\r\n  return templateSrv;\r\n});\r\n\r\nexport {\r\n  VariableSrv,\r\n  IntervalVariable,\r\n  QueryVariable,\r\n  DatasourceVariable,\r\n  CustomVariable,\r\n  ConstantVariable,\r\n  AdhocVariable,\r\n  TextBoxVariable,\r\n};\r\n","import {\r\n  assignModelProperties,\r\n  ConstantVariableModel,\r\n  VariableActions,\r\n  VariableHide,\r\n  VariableOption,\r\n  VariableType,\r\n  variableTypes,\r\n} from './variable';\r\nimport { VariableSrv } from './all';\r\n\r\nexport class ConstantVariable implements ConstantVariableModel, VariableActions {\r\n  type: VariableType;\r\n  name: string;\r\n  label: string;\r\n  hide: VariableHide;\r\n  skipUrlSync: boolean;\r\n  query: string;\r\n  options: VariableOption[];\r\n  current: VariableOption;\r\n\r\n  defaults: ConstantVariableModel = {\r\n    type: 'constant',\r\n    name: '',\r\n    hide: VariableHide.hideLabel,\r\n    label: '',\r\n    query: '',\r\n    current: {} as VariableOption,\r\n    options: [],\r\n    skipUrlSync: false,\r\n  };\r\n\r\n  /** @ngInject */\r\n  constructor(private model: any, private variableSrv: VariableSrv) {\r\n    assignModelProperties(this, model, this.defaults);\r\n  }\r\n\r\n  getSaveModel() {\r\n    assignModelProperties(this.model, this, this.defaults);\r\n    return this.model;\r\n  }\r\n\r\n  setValue(option: any) {\r\n    this.variableSrv.setOptionAsCurrent(this, option);\r\n  }\r\n\r\n  updateOptions() {\r\n    this.options = [{ text: this.query.trim(), value: this.query.trim(), selected: false }];\r\n    this.setValue(this.options[0]);\r\n    return Promise.resolve();\r\n  }\r\n\r\n  dependsOn(variable: any) {\r\n    return false;\r\n  }\r\n\r\n  setValueFromUrl(urlValue: string) {\r\n    return this.variableSrv.setOptionFromUrl(this, urlValue);\r\n  }\r\n\r\n  getValueForUrl() {\r\n    return this.current.value;\r\n  }\r\n}\r\n\r\nvariableTypes['constant'] = {\r\n  name: 'Constant',\r\n  ctor: ConstantVariable,\r\n  description: 'Define a hidden constant variable, useful for metric prefixes in dashboards you want to share',\r\n};\r\n","import _ from 'lodash';\r\nimport {\r\n  assignModelProperties,\r\n  CustomVariableModel,\r\n  VariableActions,\r\n  VariableHide,\r\n  VariableOption,\r\n  VariableType,\r\n  variableTypes,\r\n} from './variable';\r\nimport { VariableSrv } from './variable_srv';\r\n\r\nexport class CustomVariable implements CustomVariableModel, VariableActions {\r\n  type: VariableType;\r\n  name: string;\r\n  label: string;\r\n  hide: VariableHide;\r\n  skipUrlSync: boolean;\r\n  query: string;\r\n  options: VariableOption[];\r\n  includeAll: boolean;\r\n  multi: boolean;\r\n  current: VariableOption;\r\n  allValue: string;\r\n\r\n  defaults: CustomVariableModel = {\r\n    type: 'custom',\r\n    name: '',\r\n    label: '',\r\n    hide: VariableHide.dontHide,\r\n    skipUrlSync: false,\r\n    query: '',\r\n    options: [],\r\n    includeAll: false,\r\n    multi: false,\r\n    current: {} as VariableOption,\r\n    allValue: null,\r\n  };\r\n\r\n  /** @ngInject */\r\n  constructor(private model: any, private variableSrv: VariableSrv) {\r\n    assignModelProperties(this, model, this.defaults);\r\n  }\r\n\r\n  setValue(option: any) {\r\n    return this.variableSrv.setOptionAsCurrent(this, option);\r\n  }\r\n\r\n  getSaveModel() {\r\n    assignModelProperties(this.model, this, this.defaults);\r\n    return this.model;\r\n  }\r\n\r\n  updateOptions() {\r\n    // extract options in comma separated string (use backslash to escape wanted commas)\r\n    this.options = _.map(this.query.match(/(?:\\\\,|[^,])+/g), text => {\r\n      text = text.replace(/\\\\,/g, ',');\r\n      return { text: text.trim(), value: text.trim(), selected: false };\r\n    });\r\n\r\n    if (this.includeAll) {\r\n      this.addAllOption();\r\n    }\r\n\r\n    return this.variableSrv.validateVariableSelectionState(this);\r\n  }\r\n\r\n  addAllOption() {\r\n    this.options.unshift({ text: 'All', value: '$__all', selected: false });\r\n  }\r\n\r\n  dependsOn(variable: any) {\r\n    return false;\r\n  }\r\n\r\n  setValueFromUrl(urlValue: string[]) {\r\n    return this.variableSrv.setOptionFromUrl(this, urlValue);\r\n  }\r\n\r\n  getValueForUrl() {\r\n    if (this.current.text === 'All') {\r\n      return 'All';\r\n    }\r\n    return this.current.value;\r\n  }\r\n}\r\n\r\nvariableTypes['custom'] = {\r\n  name: 'Custom',\r\n  ctor: CustomVariable,\r\n  description: 'Define variable values manually',\r\n  supportsMulti: true,\r\n};\r\n","import { assignModelProperties, containsVariable, VariableActions, variableTypes } from './variable';\r\nimport { stringToJsRegex } from '@grafana/data';\r\nimport { VariableSrv } from './variable_srv';\r\nimport { TemplateSrv } from './template_srv';\r\nimport { DatasourceSrv } from '../plugins/datasource_srv';\r\nimport { config } from '@grafana/runtime';\r\n\r\nexport class DatasourceVariable implements VariableActions {\r\n  regex: any;\r\n  query: string;\r\n  options: any;\r\n  current: any;\r\n  multi: boolean;\r\n  includeAll: boolean;\r\n  refresh: any;\r\n  skipUrlSync: boolean;\r\n\r\n  defaults: any = {\r\n    type: 'datasource',\r\n    name: '',\r\n    hide: 0,\r\n    label: '',\r\n    current: {},\r\n    regex: '',\r\n    options: [],\r\n    query: '',\r\n    multi: false,\r\n    includeAll: false,\r\n    refresh: 1,\r\n    skipUrlSync: false,\r\n  };\r\n\r\n  /** @ngInject */\r\n  constructor(\r\n    private model: any,\r\n    private datasourceSrv: DatasourceSrv,\r\n    private variableSrv: VariableSrv,\r\n    private templateSrv: TemplateSrv\r\n  ) {\r\n    assignModelProperties(this, model, this.defaults);\r\n    this.refresh = 1;\r\n  }\r\n\r\n  getSaveModel() {\r\n    assignModelProperties(this.model, this, this.defaults);\r\n\r\n    // don't persist options\r\n    this.model.options = [];\r\n    return this.model;\r\n  }\r\n\r\n  setValue(option: any) {\r\n    return this.variableSrv.setOptionAsCurrent(this, option);\r\n  }\r\n\r\n  updateOptions() {\r\n    const options = [];\r\n    const sources = this.datasourceSrv.getMetricSources({ skipVariables: true });\r\n    let regex;\r\n\r\n    if (this.regex) {\r\n      regex = this.templateSrv.replace(this.regex, null, 'regex');\r\n      regex = stringToJsRegex(regex);\r\n    }\r\n\r\n    for (let i = 0; i < sources.length; i++) {\r\n      const source = sources[i];\r\n      // must match on type\r\n      if (source.meta.id !== this.query) {\r\n        continue;\r\n      }\r\n\r\n      if (regex && !regex.exec(source.name)) {\r\n        continue;\r\n      }\r\n\r\n      options.push({ text: source.name, value: source.name });\r\n    }\r\n\r\n    if (options.length === 0) {\r\n      options.push({ text: 'No data sources found', value: '' });\r\n    }\r\n\r\n    this.options = options;\r\n    if (this.includeAll) {\r\n      this.addAllOption();\r\n    }\r\n    const { defaultDatasource } = config.bootData.settings;\r\n    return this.variableSrv.validateVariableSelectionState(this, defaultDatasource);\r\n  }\r\n\r\n  addAllOption() {\r\n    this.options.unshift({ text: 'All', value: '$__all' });\r\n  }\r\n\r\n  dependsOn(variable: any) {\r\n    if (this.regex) {\r\n      return containsVariable(this.regex, variable.name);\r\n    }\r\n    return false;\r\n  }\r\n\r\n  setValueFromUrl(urlValue: string | string[]) {\r\n    return this.variableSrv.setOptionFromUrl(this, urlValue);\r\n  }\r\n\r\n  getValueForUrl() {\r\n    if (this.current.text === 'All') {\r\n      return 'All';\r\n    }\r\n    return this.current.value;\r\n  }\r\n}\r\n\r\nvariableTypes['datasource'] = {\r\n  name: 'Datasource',\r\n  ctor: DatasourceVariable,\r\n  supportsMulti: true,\r\n  description: 'Enabled you to dynamically switch the datasource for multiple panels',\r\n};\r\n","import _ from 'lodash';\r\nimport { AppEvents } from '@grafana/data';\r\nimport { e2e } from '@grafana/e2e';\r\n\r\nimport coreModule from 'app/core/core_module';\r\nimport { variableTypes } from './variable';\r\nimport appEvents from 'app/core/app_events';\r\nimport DatasourceSrv from '../plugins/datasource_srv';\r\nimport { VariableSrv } from './all';\r\nimport { TemplateSrv } from './template_srv';\r\nimport { promiseToDigest } from '../../core/utils/promiseToDigest';\r\n\r\nexport class VariableEditorCtrl {\r\n  /** @ngInject */\r\n  constructor($scope: any, datasourceSrv: DatasourceSrv, variableSrv: VariableSrv, templateSrv: TemplateSrv) {\r\n    $scope.variableTypes = variableTypes;\r\n    $scope.ctrl = {};\r\n    $scope.namePattern = /^(?!__).*$/;\r\n    $scope._ = _;\r\n    $scope.optionsLimit = 20;\r\n    $scope.emptyListCta = {\r\n      title: 'There are no variables yet',\r\n      buttonTitle: 'Add variable',\r\n      buttonIcon: 'gicon gicon-variable',\r\n      infoBox: {\r\n        __html: ` <p>\r\n      Variables enable more interactive and dynamic dashboards. Instead of hard-coding things like server or\r\n      sensor names in your metric queries you can use variables in their place. Variables are shown as dropdown\r\n      select boxes at the top of the dashboard. These dropdowns make it easy to change the data being displayed in\r\n      your dashboard. Check out the\r\n      <a class=\"external-link\" href=\"http://docs.grafana.org/reference/templating/\" target=\"_blank\">\r\n        Templating documentation\r\n      </a>\r\n      for more information.\r\n    </p>`,\r\n        infoBoxTitle: 'What do variables do?',\r\n      },\r\n    };\r\n\r\n    $scope.refreshOptions = [\r\n      { value: 0, text: 'Never' },\r\n      { value: 1, text: 'On Dashboard Load' },\r\n      { value: 2, text: 'On Time Range Change' },\r\n    ];\r\n\r\n    $scope.sortOptions = [\r\n      { value: 0, text: 'Disabled' },\r\n      { value: 1, text: 'Alphabetical (asc)' },\r\n      { value: 2, text: 'Alphabetical (desc)' },\r\n      { value: 3, text: 'Numerical (asc)' },\r\n      { value: 4, text: 'Numerical (desc)' },\r\n      { value: 5, text: 'Alphabetical (case-insensitive, asc)' },\r\n      { value: 6, text: 'Alphabetical (case-insensitive, desc)' },\r\n    ];\r\n\r\n    $scope.hideOptions = [\r\n      { value: 0, text: '' },\r\n      { value: 1, text: 'Label' },\r\n      { value: 2, text: 'Variable' },\r\n    ];\r\n\r\n    $scope.selectors = {\r\n      ...e2e.pages.Dashboard.Settings.Variables.List.selectors,\r\n      ...e2e.pages.Dashboard.Settings.Variables.Edit.General.selectors,\r\n      ...e2e.pages.Dashboard.Settings.Variables.Edit.QueryVariable.selectors,\r\n      ...e2e.pages.Dashboard.Settings.Variables.Edit.ConstantVariable.selectors,\r\n    };\r\n\r\n    $scope.init = () => {\r\n      $scope.mode = 'list';\r\n\r\n      $scope.variables = variableSrv.variables;\r\n      $scope.reset();\r\n\r\n      $scope.$watch('mode', (val: string) => {\r\n        if (val === 'new') {\r\n          $scope.reset();\r\n        }\r\n      });\r\n    };\r\n\r\n    $scope.setMode = (mode: any) => {\r\n      $scope.mode = mode;\r\n    };\r\n\r\n    $scope.setNewMode = () => {\r\n      $scope.setMode('new');\r\n    };\r\n\r\n    $scope.add = () => {\r\n      if ($scope.isValid()) {\r\n        variableSrv.addVariable($scope.current);\r\n        $scope.update();\r\n      }\r\n    };\r\n\r\n    $scope.isValid = () => {\r\n      if (!$scope.ctrl.form.$valid) {\r\n        return false;\r\n      }\r\n\r\n      if (!$scope.current.name.match(/^\\w+$/)) {\r\n        appEvents.emit(AppEvents.alertWarning, [\r\n          'Validation',\r\n          'Only word and digit characters are allowed in variable names',\r\n        ]);\r\n        return false;\r\n      }\r\n\r\n      const sameName: any = _.find($scope.variables, { name: $scope.current.name });\r\n      if (sameName && sameName !== $scope.current) {\r\n        appEvents.emit(AppEvents.alertWarning, ['Validation', 'Variable with the same name already exists']);\r\n        return false;\r\n      }\r\n\r\n      if (\r\n        $scope.current.type === 'query' &&\r\n        _.isString($scope.current.query) &&\r\n        $scope.current.query.match(new RegExp('\\\\$' + $scope.current.name + '(/| |$)'))\r\n      ) {\r\n        appEvents.emit(AppEvents.alertWarning, [\r\n          'Validation',\r\n          'Query cannot contain a reference to itself. Variable: $' + $scope.current.name,\r\n        ]);\r\n        return false;\r\n      }\r\n\r\n      return true;\r\n    };\r\n\r\n    $scope.validate = () => {\r\n      $scope.infoText = '';\r\n      if ($scope.current.type === 'adhoc' && $scope.current.datasource !== null) {\r\n        $scope.infoText = 'Adhoc filters are applied automatically to all queries that target this datasource';\r\n        promiseToDigest($scope)(\r\n          datasourceSrv.get($scope.current.datasource).then(ds => {\r\n            if (!ds.getTagKeys) {\r\n              $scope.infoText = 'This datasource does not support adhoc filters yet.';\r\n            }\r\n          })\r\n        );\r\n      }\r\n    };\r\n\r\n    $scope.runQuery = () => {\r\n      $scope.optionsLimit = 20;\r\n      return variableSrv.updateOptions($scope.current).catch((err: { data: { message: any }; message: string }) => {\r\n        if (err.data && err.data.message) {\r\n          err.message = err.data.message;\r\n        }\r\n        appEvents.emit(AppEvents.alertError, [\r\n          'Templating',\r\n          'Template variables could not be initialized: ' + err.message,\r\n        ]);\r\n      });\r\n    };\r\n\r\n    $scope.onQueryChange = (query: any, definition: any) => {\r\n      $scope.current.query = query;\r\n      $scope.current.definition = definition;\r\n      $scope.runQuery();\r\n    };\r\n\r\n    $scope.edit = (variable: any) => {\r\n      $scope.current = variable;\r\n      $scope.currentIsNew = false;\r\n      $scope.mode = 'edit';\r\n      $scope.validate();\r\n      promiseToDigest($scope)(\r\n        datasourceSrv.get($scope.current.datasource).then(ds => {\r\n          $scope.currentDatasource = ds;\r\n        })\r\n      );\r\n    };\r\n\r\n    $scope.duplicate = (variable: { getSaveModel: () => void; name: string }) => {\r\n      const clone = _.cloneDeep(variable.getSaveModel());\r\n      $scope.current = variableSrv.createVariableFromModel(clone);\r\n      $scope.current.name = 'copy_of_' + variable.name;\r\n      variableSrv.addVariable($scope.current);\r\n    };\r\n\r\n    $scope.update = () => {\r\n      if ($scope.isValid()) {\r\n        promiseToDigest($scope)(\r\n          $scope.runQuery().then(() => {\r\n            $scope.reset();\r\n            $scope.mode = 'list';\r\n            templateSrv.updateIndex();\r\n          })\r\n        );\r\n      }\r\n    };\r\n\r\n    $scope.reset = () => {\r\n      $scope.currentIsNew = true;\r\n      $scope.current = variableSrv.createVariableFromModel({ type: 'query' });\r\n\r\n      // this is done here in case a new data source type variable was added\r\n      $scope.datasources = _.filter(datasourceSrv.getMetricSources(), ds => {\r\n        return !ds.meta.mixed && ds.value !== null;\r\n      });\r\n\r\n      $scope.datasourceTypes = _($scope.datasources)\r\n        .uniqBy('meta.id')\r\n        .map((ds: any) => {\r\n          return { text: ds.meta.name, value: ds.meta.id };\r\n        })\r\n        .value();\r\n    };\r\n\r\n    $scope.typeChanged = function() {\r\n      const old = $scope.current;\r\n      $scope.current = variableSrv.createVariableFromModel({\r\n        type: $scope.current.type,\r\n      });\r\n      $scope.current.name = old.name;\r\n      $scope.current.label = old.label;\r\n\r\n      const oldIndex = _.indexOf(this.variables, old);\r\n      if (oldIndex !== -1) {\r\n        this.variables[oldIndex] = $scope.current;\r\n      }\r\n\r\n      $scope.validate();\r\n    };\r\n\r\n    $scope.removeVariable = (variable: any) => {\r\n      variableSrv.removeVariable(variable);\r\n    };\r\n\r\n    $scope.showMoreOptions = () => {\r\n      $scope.optionsLimit += 20;\r\n    };\r\n\r\n    $scope.datasourceChanged = async () => {\r\n      promiseToDigest($scope)(\r\n        datasourceSrv.get($scope.current.datasource).then(ds => {\r\n          $scope.current.query = '';\r\n          $scope.currentDatasource = ds;\r\n        })\r\n      );\r\n    };\r\n  }\r\n}\r\n\r\ncoreModule.controller('VariableEditorCtrl', VariableEditorCtrl);\r\n","import _ from 'lodash';\r\nimport kbn from 'app/core/utils/kbn';\r\nimport {\r\n  assignModelProperties,\r\n  IntervalVariableModel,\r\n  VariableActions,\r\n  VariableHide,\r\n  VariableOption,\r\n  VariableRefresh,\r\n  VariableType,\r\n  variableTypes,\r\n} from './variable';\r\nimport { TimeSrv } from '../dashboard/services/TimeSrv';\r\nimport { TemplateSrv } from './template_srv';\r\nimport { VariableSrv } from './variable_srv';\r\n\r\nexport class IntervalVariable implements IntervalVariableModel, VariableActions {\r\n  type: VariableType;\r\n  name: string;\r\n  label: string;\r\n  hide: VariableHide;\r\n  skipUrlSync: boolean;\r\n  auto_count: number; // tslint:disable-line variable-name\r\n  auto_min: string; // tslint:disable-line variable-name\r\n  options: VariableOption[];\r\n  auto: boolean;\r\n  query: string;\r\n  refresh: VariableRefresh;\r\n  current: VariableOption;\r\n\r\n  defaults: IntervalVariableModel = {\r\n    type: 'interval',\r\n    name: '',\r\n    label: '',\r\n    hide: VariableHide.dontHide,\r\n    skipUrlSync: false,\r\n    auto_count: 30,\r\n    auto_min: '10s',\r\n    options: [],\r\n    auto: false,\r\n    query: '1m,10m,30m,1h,6h,12h,1d,7d,14d,30d',\r\n    refresh: VariableRefresh.onTimeRangeChanged,\r\n    current: {} as VariableOption,\r\n  };\r\n\r\n  /** @ngInject */\r\n  constructor(\r\n    private model: any,\r\n    private timeSrv: TimeSrv,\r\n    private templateSrv: TemplateSrv,\r\n    private variableSrv: VariableSrv\r\n  ) {\r\n    assignModelProperties(this, model, this.defaults);\r\n    this.refresh = VariableRefresh.onTimeRangeChanged;\r\n  }\r\n\r\n  getSaveModel() {\r\n    assignModelProperties(this.model, this, this.defaults);\r\n    return this.model;\r\n  }\r\n\r\n  setValue(option: any) {\r\n    this.updateAutoValue();\r\n    return this.variableSrv.setOptionAsCurrent(this, option);\r\n  }\r\n\r\n  updateAutoValue() {\r\n    if (!this.auto) {\r\n      return;\r\n    }\r\n\r\n    // add auto option if missing\r\n    if (this.options.length && this.options[0].text !== 'auto') {\r\n      this.options.unshift({\r\n        text: 'auto',\r\n        value: '$__auto_interval_' + this.name,\r\n        selected: false,\r\n      });\r\n    }\r\n\r\n    const res = kbn.calculateInterval(this.timeSrv.timeRange(), this.auto_count, this.auto_min);\r\n    this.templateSrv.setGrafanaVariable('$__auto_interval_' + this.name, res.interval);\r\n    // for backward compatibility, to be removed eventually\r\n    this.templateSrv.setGrafanaVariable('$__auto_interval', res.interval);\r\n  }\r\n\r\n  updateOptions() {\r\n    // extract options between quotes and/or comma\r\n    this.options = _.map(this.query.match(/([\"'])(.*?)\\1|\\w+/g), text => {\r\n      text = text.replace(/[\"']+/g, '');\r\n      return { text: text.trim(), value: text.trim(), selected: false };\r\n    });\r\n\r\n    this.updateAutoValue();\r\n    return this.variableSrv.validateVariableSelectionState(this);\r\n  }\r\n\r\n  dependsOn(variable: any) {\r\n    return false;\r\n  }\r\n\r\n  setValueFromUrl(urlValue: string | string[]) {\r\n    this.updateAutoValue();\r\n    return this.variableSrv.setOptionFromUrl(this, urlValue);\r\n  }\r\n\r\n  getValueForUrl() {\r\n    return this.current.value;\r\n  }\r\n}\r\n\r\n// @ts-ignore\r\nvariableTypes['interval'] = {\r\n  name: 'Interval',\r\n  ctor: IntervalVariable,\r\n  description: 'Define a timespan interval (ex 1m, 1h, 1d)',\r\n};\r\n","import _ from 'lodash';\r\nimport {\r\n  assignModelProperties,\r\n  containsVariable,\r\n  QueryVariableModel,\r\n  VariableActions,\r\n  VariableHide,\r\n  VariableOption,\r\n  VariableRefresh,\r\n  VariableSort,\r\n  VariableTag,\r\n  VariableType,\r\n  variableTypes,\r\n} from './variable';\r\nimport { stringToJsRegex } from '@grafana/data';\r\nimport DatasourceSrv from '../plugins/datasource_srv';\r\nimport { TemplateSrv } from './template_srv';\r\nimport { VariableSrv } from './variable_srv';\r\nimport { TimeSrv } from '../dashboard/services/TimeSrv';\r\n\r\nfunction getNoneOption(): VariableOption {\r\n  return { text: 'None', value: '', isNone: true, selected: false };\r\n}\r\n\r\nexport class QueryVariable implements QueryVariableModel, VariableActions {\r\n  type: VariableType;\r\n  name: string;\r\n  label: string;\r\n  hide: VariableHide;\r\n  skipUrlSync: boolean;\r\n  datasource: string;\r\n  query: string;\r\n  regex: string;\r\n  sort: VariableSort;\r\n  options: VariableOption[];\r\n  current: VariableOption;\r\n  refresh: VariableRefresh;\r\n  multi: boolean;\r\n  includeAll: boolean;\r\n  useTags: boolean;\r\n  tagsQuery: string;\r\n  tagValuesQuery: string;\r\n  tags: VariableTag[];\r\n  definition: string;\r\n  allValue: string;\r\n\r\n  defaults: QueryVariableModel = {\r\n    type: 'query',\r\n    name: '',\r\n    label: null,\r\n    hide: VariableHide.dontHide,\r\n    skipUrlSync: false,\r\n    datasource: null,\r\n    query: '',\r\n    regex: '',\r\n    sort: VariableSort.disabled,\r\n    refresh: VariableRefresh.never,\r\n    multi: false,\r\n    includeAll: false,\r\n    allValue: null,\r\n    options: [],\r\n    current: {} as VariableOption,\r\n    tags: [],\r\n    useTags: false,\r\n    tagsQuery: '',\r\n    tagValuesQuery: '',\r\n    definition: '',\r\n  };\r\n\r\n  /** @ngInject */\r\n  constructor(\r\n    private model: any,\r\n    private datasourceSrv: DatasourceSrv,\r\n    private templateSrv: TemplateSrv,\r\n    private variableSrv: VariableSrv,\r\n    private timeSrv: TimeSrv\r\n  ) {\r\n    // copy model properties to this instance\r\n    assignModelProperties(this, model, this.defaults);\r\n    this.updateOptionsFromMetricFindQuery.bind(this);\r\n  }\r\n\r\n  getSaveModel() {\r\n    // copy back model properties to model\r\n    assignModelProperties(this.model, this, this.defaults);\r\n\r\n    // remove options\r\n    if (this.refresh !== 0) {\r\n      this.model.options = [];\r\n    }\r\n\r\n    return this.model;\r\n  }\r\n\r\n  setValue(option: any) {\r\n    return this.variableSrv.setOptionAsCurrent(this, option);\r\n  }\r\n\r\n  setValueFromUrl(urlValue: any) {\r\n    return this.variableSrv.setOptionFromUrl(this, urlValue);\r\n  }\r\n\r\n  getValueForUrl() {\r\n    if (this.current.text === 'All') {\r\n      return 'All';\r\n    }\r\n    return this.current.value;\r\n  }\r\n\r\n  updateOptions(searchFilter?: string) {\r\n    return this.datasourceSrv\r\n      .get(this.datasource)\r\n      .then(ds => this.updateOptionsFromMetricFindQuery(ds, searchFilter))\r\n      .then(this.updateTags.bind(this))\r\n      .then(this.variableSrv.validateVariableSelectionState.bind(this.variableSrv, this));\r\n  }\r\n\r\n  updateTags(datasource: any) {\r\n    if (this.useTags) {\r\n      return this.metricFindQuery(datasource, this.tagsQuery).then((results: any[]) => {\r\n        this.tags = [];\r\n        for (let i = 0; i < results.length; i++) {\r\n          this.tags.push(results[i].text);\r\n        }\r\n        return datasource;\r\n      });\r\n    } else {\r\n      delete this.tags;\r\n    }\r\n\r\n    return datasource;\r\n  }\r\n\r\n  getValuesForTag(tagKey: string) {\r\n    return this.datasourceSrv.get(this.datasource).then(datasource => {\r\n      const query = this.tagValuesQuery.replace('$tag', tagKey);\r\n      return this.metricFindQuery(datasource, query).then((results: any) => {\r\n        return _.map(results, value => {\r\n          return value.text;\r\n        });\r\n      });\r\n    });\r\n  }\r\n\r\n  updateOptionsFromMetricFindQuery(datasource: any, searchFilter?: string) {\r\n    return this.metricFindQuery(datasource, this.query, searchFilter).then((results: any) => {\r\n      this.options = this.metricNamesToVariableValues(results);\r\n      if (this.includeAll) {\r\n        this.addAllOption();\r\n      }\r\n      if (!this.options.length) {\r\n        this.options.push(getNoneOption());\r\n      }\r\n      return datasource;\r\n    });\r\n  }\r\n\r\n  metricFindQuery(datasource: any, query: string, searchFilter?: string) {\r\n    const options: any = { range: undefined, variable: this, searchFilter };\r\n\r\n    if (this.refresh === 2) {\r\n      options.range = this.timeSrv.timeRange();\r\n    }\r\n\r\n    return datasource.metricFindQuery(query, options);\r\n  }\r\n\r\n  addAllOption() {\r\n    this.options.unshift({ text: 'All', value: '$__all', selected: false });\r\n  }\r\n\r\n  metricNamesToVariableValues(metricNames: any[]) {\r\n    let regex, options, i, matches;\r\n    options = [];\r\n\r\n    if (this.regex) {\r\n      regex = stringToJsRegex(this.templateSrv.replace(this.regex, {}, 'regex'));\r\n    }\r\n    for (i = 0; i < metricNames.length; i++) {\r\n      const item = metricNames[i];\r\n      let text = item.text === undefined || item.text === null ? item.value : item.text;\r\n\r\n      let value = item.value === undefined || item.value === null ? item.text : item.value;\r\n\r\n      if (_.isNumber(value)) {\r\n        value = value.toString();\r\n      }\r\n\r\n      if (_.isNumber(text)) {\r\n        text = text.toString();\r\n      }\r\n\r\n      if (regex) {\r\n        matches = regex.exec(value);\r\n        if (!matches) {\r\n          continue;\r\n        }\r\n        if (matches.length > 1) {\r\n          value = matches[1];\r\n          text = matches[1];\r\n        }\r\n      }\r\n\r\n      options.push({ text: text, value: value });\r\n    }\r\n\r\n    options = _.uniqBy(options, 'value');\r\n    return this.sortVariableValues(options, this.sort);\r\n  }\r\n\r\n  sortVariableValues(options: any[], sortOrder: number) {\r\n    if (sortOrder === 0) {\r\n      return options;\r\n    }\r\n\r\n    const sortType = Math.ceil(sortOrder / 2);\r\n    const reverseSort = sortOrder % 2 === 0;\r\n\r\n    if (sortType === 1) {\r\n      options = _.sortBy(options, 'text');\r\n    } else if (sortType === 2) {\r\n      options = _.sortBy(options, opt => {\r\n        const matches = opt.text.match(/.*?(\\d+).*/);\r\n        if (!matches || matches.length < 2) {\r\n          return -1;\r\n        } else {\r\n          return parseInt(matches[1], 10);\r\n        }\r\n      });\r\n    } else if (sortType === 3) {\r\n      options = _.sortBy(options, opt => {\r\n        return _.toLower(opt.text);\r\n      });\r\n    }\r\n\r\n    if (reverseSort) {\r\n      options = options.reverse();\r\n    }\r\n\r\n    return options;\r\n  }\r\n\r\n  dependsOn(variable: any) {\r\n    return containsVariable(this.query, this.datasource, this.regex, variable.name);\r\n  }\r\n}\r\n// @ts-ignore\r\nvariableTypes['query'] = {\r\n  name: 'Query',\r\n  ctor: QueryVariable,\r\n  description: 'Variable values are fetched from a datasource query',\r\n  supportsMulti: true,\r\n};\r\n","import kbn from 'app/core/utils/kbn';\r\nimport _ from 'lodash';\r\nimport { variableRegex } from 'app/features/templating/variable';\r\nimport { escapeHtml } from 'app/core/utils/text';\r\nimport { ScopedVars, TimeRange } from '@grafana/data';\r\n\r\nfunction luceneEscape(value: string) {\r\n  return value.replace(/([\\!\\*\\+\\-\\=<>\\s\\&\\|\\(\\)\\[\\]\\{\\}\\^\\~\\?\\:\\\\/\"])/g, '\\\\$1');\r\n}\r\n\r\ninterface FieldAccessorCache {\r\n  [key: string]: (obj: any) => any;\r\n}\r\n\r\nexport class TemplateSrv {\r\n  variables: any[];\r\n\r\n  private regex = variableRegex;\r\n  private index: any = {};\r\n  private grafanaVariables: any = {};\r\n  private builtIns: any = {};\r\n  private timeRange: TimeRange = null;\r\n  private fieldAccessorCache: FieldAccessorCache = {};\r\n\r\n  constructor() {\r\n    this.builtIns['__interval'] = { text: '1s', value: '1s' };\r\n    this.builtIns['__interval_ms'] = { text: '100', value: '100' };\r\n    this.variables = [];\r\n  }\r\n\r\n  init(variables: any, timeRange?: TimeRange) {\r\n    this.variables = variables;\r\n    this.timeRange = timeRange;\r\n    this.updateIndex();\r\n  }\r\n\r\n  getBuiltInIntervalValue() {\r\n    return this.builtIns.__interval.value;\r\n  }\r\n\r\n  updateIndex() {\r\n    const existsOrEmpty = (value: any) => value || value === '';\r\n\r\n    this.index = this.variables.reduce((acc, currentValue) => {\r\n      if (currentValue.current && (currentValue.current.isNone || existsOrEmpty(currentValue.current.value))) {\r\n        acc[currentValue.name] = currentValue;\r\n      }\r\n      return acc;\r\n    }, {});\r\n\r\n    if (this.timeRange) {\r\n      const from = this.timeRange.from.valueOf().toString();\r\n      const to = this.timeRange.to.valueOf().toString();\r\n\r\n      this.index = {\r\n        ...this.index,\r\n        ['__from']: {\r\n          current: { value: from, text: from },\r\n        },\r\n        ['__to']: {\r\n          current: { value: to, text: to },\r\n        },\r\n      };\r\n    }\r\n  }\r\n\r\n  updateTimeRange(timeRange: TimeRange) {\r\n    this.timeRange = timeRange;\r\n    this.updateIndex();\r\n  }\r\n\r\n  variableInitialized(variable: any) {\r\n    this.index[variable.name] = variable;\r\n  }\r\n\r\n  getAdhocFilters(datasourceName: string) {\r\n    let filters: any = [];\r\n\r\n    if (this.variables) {\r\n      for (let i = 0; i < this.variables.length; i++) {\r\n        const variable = this.variables[i];\r\n        if (variable.type !== 'adhoc') {\r\n          continue;\r\n        }\r\n\r\n        // null is the \"default\" datasource\r\n        if (variable.datasource === null || variable.datasource === datasourceName) {\r\n          filters = filters.concat(variable.filters);\r\n        } else if (variable.datasource.indexOf('$') === 0) {\r\n          if (this.replace(variable.datasource) === datasourceName) {\r\n            filters = filters.concat(variable.filters);\r\n          }\r\n        }\r\n      }\r\n    }\r\n\r\n    return filters;\r\n  }\r\n\r\n  luceneFormat(value: any) {\r\n    if (typeof value === 'string') {\r\n      return luceneEscape(value);\r\n    }\r\n    if (value instanceof Array && value.length === 0) {\r\n      return '__empty__';\r\n    }\r\n    const quotedValues = _.map(value, val => {\r\n      return '\"' + luceneEscape(val) + '\"';\r\n    });\r\n    return '(' + quotedValues.join(' OR ') + ')';\r\n  }\r\n\r\n  // encode string according to RFC 3986; in contrast to encodeURIComponent()\r\n  // also the sub-delims \"!\", \"'\", \"(\", \")\" and \"*\" are encoded;\r\n  // unicode handling uses UTF-8 as in ECMA-262.\r\n  encodeURIComponentStrict(str: string) {\r\n    return encodeURIComponent(str).replace(/[!'()*]/g, c => {\r\n      return (\r\n        '%' +\r\n        c\r\n          .charCodeAt(0)\r\n          .toString(16)\r\n          .toUpperCase()\r\n      );\r\n    });\r\n  }\r\n\r\n  formatValue(value: any, format: any, variable: any) {\r\n    // for some scopedVars there is no variable\r\n    variable = variable || {};\r\n\r\n    if (typeof format === 'function') {\r\n      return format(value, variable, this.formatValue);\r\n    }\r\n\r\n    switch (format) {\r\n      case 'regex': {\r\n        if (typeof value === 'string') {\r\n          return kbn.regexEscape(value);\r\n        }\r\n\r\n        const escapedValues = _.map(value, kbn.regexEscape);\r\n        if (escapedValues.length === 1) {\r\n          return escapedValues[0];\r\n        }\r\n        return '(' + escapedValues.join('|') + ')';\r\n      }\r\n      case 'lucene': {\r\n        return this.luceneFormat(value);\r\n      }\r\n      case 'pipe': {\r\n        if (typeof value === 'string') {\r\n          return value;\r\n        }\r\n        return value.join('|');\r\n      }\r\n      case 'distributed': {\r\n        if (typeof value === 'string') {\r\n          return value;\r\n        }\r\n        return this.distributeVariable(value, variable.name);\r\n      }\r\n      case 'csv': {\r\n        if (_.isArray(value)) {\r\n          return value.join(',');\r\n        }\r\n        return value;\r\n      }\r\n      case 'html': {\r\n        if (_.isArray(value)) {\r\n          return escapeHtml(value.join(', '));\r\n        }\r\n        return escapeHtml(value);\r\n      }\r\n      case 'json': {\r\n        return JSON.stringify(value);\r\n      }\r\n      case 'percentencode': {\r\n        // like glob, but url escaped\r\n        if (_.isArray(value)) {\r\n          return this.encodeURIComponentStrict('{' + value.join(',') + '}');\r\n        }\r\n        return this.encodeURIComponentStrict(value);\r\n      }\r\n      default: {\r\n        if (_.isArray(value) && value.length > 1) {\r\n          return '{' + value.join(',') + '}';\r\n        }\r\n        return value;\r\n      }\r\n    }\r\n  }\r\n\r\n  setGrafanaVariable(name: string, value: any) {\r\n    this.grafanaVariables[name] = value;\r\n  }\r\n\r\n  setGlobalVariable(name: string, variable: any) {\r\n    this.index = {\r\n      ...this.index,\r\n      [name]: {\r\n        current: variable,\r\n      },\r\n    };\r\n  }\r\n\r\n  getVariableName(expression: string) {\r\n    this.regex.lastIndex = 0;\r\n    const match = this.regex.exec(expression);\r\n    if (!match) {\r\n      return null;\r\n    }\r\n    const variableName = match.slice(1).find(match => match !== undefined);\r\n    return variableName;\r\n  }\r\n\r\n  variableExists(expression: string) {\r\n    const name = this.getVariableName(expression);\r\n    return name && this.index[name] !== void 0;\r\n  }\r\n\r\n  highlightVariablesAsHtml(str: string) {\r\n    if (!str || !_.isString(str)) {\r\n      return str;\r\n    }\r\n\r\n    str = _.escape(str);\r\n    this.regex.lastIndex = 0;\r\n    return str.replace(this.regex, (match, var1, var2, fmt2, var3) => {\r\n      if (this.index[var1 || var2 || var3] || this.builtIns[var1 || var2 || var3]) {\r\n        return '<span class=\"template-variable\">' + match + '</span>';\r\n      }\r\n      return match;\r\n    });\r\n  }\r\n\r\n  getAllValue(variable: any) {\r\n    if (variable.allValue) {\r\n      return variable.allValue;\r\n    }\r\n    const values = [];\r\n    for (let i = 1; i < variable.options.length; i++) {\r\n      values.push(variable.options[i].value);\r\n    }\r\n    return values;\r\n  }\r\n\r\n  getFieldAccessor(fieldPath: string) {\r\n    const accessor = this.fieldAccessorCache[fieldPath];\r\n    if (accessor) {\r\n      return accessor;\r\n    }\r\n\r\n    return (this.fieldAccessorCache[fieldPath] = _.property(fieldPath));\r\n  }\r\n\r\n  getVariableValue(variableName: string, fieldPath: string | undefined, scopedVars: ScopedVars) {\r\n    const scopedVar = scopedVars[variableName];\r\n    if (!scopedVar) {\r\n      return null;\r\n    }\r\n\r\n    if (fieldPath) {\r\n      return this.getFieldAccessor(fieldPath)(scopedVar.value);\r\n    }\r\n\r\n    return scopedVar.value;\r\n  }\r\n\r\n  replace(target: string, scopedVars?: ScopedVars, format?: string | Function): any {\r\n    if (!target) {\r\n      return target;\r\n    }\r\n\r\n    this.regex.lastIndex = 0;\r\n\r\n    return target.replace(this.regex, (match, var1, var2, fmt2, var3, fieldPath, fmt3) => {\r\n      const variableName = var1 || var2 || var3;\r\n      const variable = this.index[variableName];\r\n      const fmt = fmt2 || fmt3 || format;\r\n\r\n      if (scopedVars) {\r\n        const value = this.getVariableValue(variableName, fieldPath, scopedVars);\r\n        if (value !== null && value !== undefined) {\r\n          return this.formatValue(value, fmt, variable);\r\n        }\r\n      }\r\n\r\n      if (!variable) {\r\n        return match;\r\n      }\r\n\r\n      const systemValue = this.grafanaVariables[variable.current.value];\r\n      if (systemValue) {\r\n        return this.formatValue(systemValue, fmt, variable);\r\n      }\r\n\r\n      let value = variable.current.value;\r\n      if (this.isAllValue(value)) {\r\n        value = this.getAllValue(variable);\r\n        // skip formatting of custom all values\r\n        if (variable.allValue) {\r\n          return this.replace(value);\r\n        }\r\n      }\r\n\r\n      if (fieldPath) {\r\n        const fieldValue = this.getVariableValue(variableName, fieldPath, {\r\n          [variableName]: { value: value, text: '' },\r\n        });\r\n        if (fieldValue !== null && fieldValue !== undefined) {\r\n          return this.formatValue(fieldValue, fmt, variable);\r\n        }\r\n      }\r\n\r\n      const res = this.formatValue(value, fmt, variable);\r\n      return res;\r\n    });\r\n  }\r\n\r\n  isAllValue(value: any) {\r\n    return value === '$__all' || (Array.isArray(value) && value[0] === '$__all');\r\n  }\r\n\r\n  replaceWithText(target: string, scopedVars: ScopedVars) {\r\n    if (!target) {\r\n      return target;\r\n    }\r\n\r\n    let variable;\r\n    this.regex.lastIndex = 0;\r\n\r\n    return target.replace(this.regex, (match: any, var1: any, var2: any, fmt2: any, var3: any) => {\r\n      if (scopedVars) {\r\n        const option = scopedVars[var1 || var2 || var3];\r\n        if (option) {\r\n          return option.text;\r\n        }\r\n      }\r\n\r\n      variable = this.index[var1 || var2 || var3];\r\n      if (!variable) {\r\n        return match;\r\n      }\r\n\r\n      const value = this.grafanaVariables[variable.current.value];\r\n\r\n      return typeof value === 'string' ? value : variable.current.text;\r\n    });\r\n  }\r\n\r\n  fillVariableValuesForUrl(params: any, scopedVars?: ScopedVars) {\r\n    _.each(this.variables, variable => {\r\n      if (scopedVars && scopedVars[variable.name] !== void 0) {\r\n        if (scopedVars[variable.name].skipUrlSync) {\r\n          return;\r\n        }\r\n        params['var-' + variable.name] = scopedVars[variable.name].value;\r\n      } else {\r\n        if (variable.skipUrlSync) {\r\n          return;\r\n        }\r\n        params['var-' + variable.name] = variable.getValueForUrl();\r\n      }\r\n    });\r\n  }\r\n\r\n  distributeVariable(value: any, variable: any) {\r\n    value = _.map(value, (val: any, index: number) => {\r\n      if (index !== 0) {\r\n        return variable + '=' + val;\r\n      } else {\r\n        return val;\r\n      }\r\n    });\r\n    return value.join(',');\r\n  }\r\n}\r\n\r\nexport default new TemplateSrv();\r\n","import _ from 'lodash';\r\nimport { assignModelProperties } from 'app/core/utils/model_utils';\r\nimport { ScopedVars } from '@grafana/data';\r\n\r\n/*\r\n * This regex matches 3 types of variable reference with an optional format specifier\r\n * \\$(\\w+)                          $var1\r\n * \\[\\[([\\s\\S]+?)(?::(\\w+))?\\]\\]    [[var2]] or [[var2:fmt2]]\r\n * \\${(\\w+)(?::(\\w+))?}             ${var3} or ${var3:fmt3}\r\n */\r\nexport const variableRegex = /\\$(\\w+)|\\[\\[([\\s\\S]+?)(?::(\\w+))?\\]\\]|\\${(\\w+)(?:\\.([^:^\\}]+))?(?::(\\w+))?}/g;\r\n\r\n// Helper function since lastIndex is not reset\r\nexport const variableRegexExec = (variableString: string) => {\r\n  variableRegex.lastIndex = 0;\r\n  return variableRegex.exec(variableString);\r\n};\r\n\r\nexport const SEARCH_FILTER_VARIABLE = '__searchFilter';\r\n\r\nexport const containsSearchFilter = (query: string | unknown): boolean =>\r\n  query && typeof query === 'string' ? query.indexOf(SEARCH_FILTER_VARIABLE) !== -1 : false;\r\n\r\nexport const getSearchFilterScopedVar = (args: {\r\n  query: string;\r\n  wildcardChar: string;\r\n  options: { searchFilter?: string };\r\n}): ScopedVars => {\r\n  const { query, wildcardChar } = args;\r\n  if (!containsSearchFilter(query)) {\r\n    return {};\r\n  }\r\n\r\n  let { options } = args;\r\n\r\n  options = options || { searchFilter: '' };\r\n  const value = options.searchFilter ? `${options.searchFilter}${wildcardChar}` : `${wildcardChar}`;\r\n\r\n  return {\r\n    __searchFilter: {\r\n      value,\r\n      text: '',\r\n    },\r\n  };\r\n};\r\n\r\nexport enum VariableRefresh {\r\n  never,\r\n  onDashboardLoad,\r\n  onTimeRangeChanged,\r\n}\r\n\r\nexport enum VariableHide {\r\n  dontHide,\r\n  hideVariable,\r\n  hideLabel,\r\n}\r\n\r\nexport enum VariableSort {\r\n  disabled,\r\n  alphabeticalAsc,\r\n  alphabeticalDesc,\r\n  numericalAsc,\r\n  numericalDesc,\r\n  alphabeticalCaseInsensitiveAsc,\r\n  alphabeticalCaseInsensitiveDesc,\r\n}\r\n\r\nexport interface VariableTag {\r\n  text: string | string[];\r\n}\r\n\r\nexport interface VariableOption {\r\n  selected: boolean;\r\n  text: string | string[];\r\n  value: string | string[];\r\n  isNone?: boolean;\r\n}\r\n\r\nexport type VariableType = 'query' | 'adhoc' | 'constant' | 'datasource' | 'interval' | 'textbox' | 'custom';\r\n\r\nexport interface AdHocVariableFilter {\r\n  key: string;\r\n  operator: string;\r\n  value: string;\r\n  condition: string;\r\n}\r\n\r\nexport interface AdHocVariableModel extends VariableModel {\r\n  datasource: string;\r\n  filters: AdHocVariableFilter[];\r\n}\r\n\r\nexport interface CustomVariableModel extends VariableWithOptions {\r\n  allValue: string;\r\n  includeAll: boolean;\r\n  multi: boolean;\r\n}\r\n\r\nexport interface DataSourceVariableModel extends VariableWithOptions {\r\n  includeAll: boolean;\r\n  multi: boolean;\r\n  refresh: VariableRefresh;\r\n  regex: string;\r\n}\r\n\r\nexport interface IntervalVariableModel extends VariableWithOptions {\r\n  auto: boolean;\r\n  auto_min: string;\r\n  auto_count: number;\r\n  refresh: VariableRefresh;\r\n}\r\n\r\nexport interface QueryVariableModel extends VariableWithOptions {\r\n  allValue: string;\r\n  datasource: string;\r\n  definition: string;\r\n  includeAll: boolean;\r\n  multi: boolean;\r\n  refresh: VariableRefresh;\r\n  regex: string;\r\n  sort: VariableSort;\r\n  tags: VariableTag[];\r\n  tagsQuery: string;\r\n  tagValuesQuery: string;\r\n  useTags: boolean;\r\n}\r\n\r\nexport interface TextBoxVariableModel extends VariableWithOptions {}\r\n\r\nexport interface ConstantVariableModel extends VariableWithOptions {}\r\n\r\nexport interface VariableWithOptions extends VariableModel {\r\n  current: VariableOption;\r\n  options: VariableOption[];\r\n  query: string;\r\n}\r\n\r\nexport interface VariableModel {\r\n  type: VariableType;\r\n  name: string;\r\n  label: string;\r\n  hide: VariableHide;\r\n  skipUrlSync: boolean;\r\n}\r\n\r\nexport interface VariableActions {\r\n  setValue(option: any): any;\r\n  updateOptions(searchFilter?: string): any;\r\n  dependsOn(variable: any): any;\r\n  setValueFromUrl(urlValue: any): any;\r\n  getValueForUrl(): any;\r\n  getSaveModel(): any;\r\n}\r\n\r\nexport type CtorType = new (...args: any[]) => {};\r\n\r\nexport interface VariableTypes {\r\n  [key: string]: {\r\n    name: string;\r\n    ctor: CtorType;\r\n    description: string;\r\n    supportsMulti?: boolean;\r\n  };\r\n}\r\n\r\nexport let variableTypes: VariableTypes = {};\r\nexport { assignModelProperties };\r\n\r\nexport function containsVariable(...args: any[]) {\r\n  const variableName = args[args.length - 1];\r\n  args[0] = _.isString(args[0]) ? args[0] : Object['values'](args[0]).join(' ');\r\n  const variableString = args.slice(0, -1).join(' ');\r\n  const matches = variableString.match(variableRegex);\r\n  const isMatchingVariable =\r\n    matches !== null\r\n      ? matches.find(match => {\r\n          const varMatch = variableRegexExec(match);\r\n          return varMatch !== null && varMatch.indexOf(variableName) > -1;\r\n        })\r\n      : false;\r\n\r\n  return !!isMatchingVariable;\r\n}\r\n","// Libaries\r\nimport angular, { IQService, ILocationService, auto, IPromise } from 'angular';\r\nimport _ from 'lodash';\r\n\r\n// Utils & Services\r\nimport coreModule from 'app/core/core_module';\r\nimport { variableTypes } from './variable';\r\nimport { Graph } from 'app/core/utils/dag';\r\nimport { TemplateSrv } from 'app/features/templating/template_srv';\r\nimport { TimeSrv } from 'app/features/dashboard/services/TimeSrv';\r\nimport { DashboardModel } from 'app/features/dashboard/state/DashboardModel';\r\n\r\n// Types\r\nimport { TimeRange, AppEvents } from '@grafana/data';\r\nimport { CoreEvents } from 'app/types';\r\nimport { UrlQueryMap } from '@grafana/runtime';\r\nimport { appEvents } from 'app/core/core';\r\n\r\nexport class VariableSrv {\r\n  dashboard: DashboardModel;\r\n  variables: any[];\r\n\r\n  /** @ngInject */\r\n  constructor(\r\n    private $q: IQService,\r\n    private $location: ILocationService,\r\n    private $injector: auto.IInjectorService,\r\n    private templateSrv: TemplateSrv,\r\n    private timeSrv: TimeSrv\r\n  ) {}\r\n\r\n  init(dashboard: DashboardModel) {\r\n    this.dashboard = dashboard;\r\n    this.dashboard.events.on(CoreEvents.timeRangeUpdated, this.onTimeRangeUpdated.bind(this));\r\n    this.dashboard.events.on(\r\n      CoreEvents.templateVariableValueUpdated,\r\n      this.updateUrlParamsWithCurrentVariables.bind(this)\r\n    );\r\n\r\n    // create working class models representing variables\r\n    this.variables = dashboard.templating.list = dashboard.templating.list.map(this.createVariableFromModel.bind(this));\r\n    this.templateSrv.init(this.variables, this.timeSrv.timeRange());\r\n\r\n    // init variables\r\n    for (const variable of this.variables) {\r\n      variable.initLock = this.$q.defer();\r\n    }\r\n\r\n    const queryParams = this.$location.search();\r\n    return this.$q\r\n      .all(\r\n        this.variables.map(variable => {\r\n          return this.processVariable(variable, queryParams);\r\n        })\r\n      )\r\n      .then(() => {\r\n        this.templateSrv.updateIndex();\r\n      });\r\n  }\r\n\r\n  onTimeRangeUpdated(timeRange: TimeRange) {\r\n    this.templateSrv.updateTimeRange(timeRange);\r\n    const promises = this.variables\r\n      .filter(variable => variable.refresh === 2)\r\n      .map(variable => {\r\n        const previousOptions = variable.options.slice();\r\n\r\n        return variable.updateOptions().then(() => {\r\n          if (angular.toJson(previousOptions) !== angular.toJson(variable.options)) {\r\n            this.dashboard.templateVariableValueUpdated();\r\n          }\r\n        });\r\n      });\r\n\r\n    return this.$q\r\n      .all(promises)\r\n      .then(() => {\r\n        this.dashboard.startRefresh();\r\n      })\r\n      .catch(e => {\r\n        appEvents.emit(AppEvents.alertError, ['Template variable service failed', e.message]);\r\n      });\r\n  }\r\n\r\n  processVariable(variable: any, queryParams: any) {\r\n    const dependencies = [];\r\n\r\n    for (const otherVariable of this.variables) {\r\n      if (variable.dependsOn(otherVariable)) {\r\n        dependencies.push(otherVariable.initLock.promise);\r\n      }\r\n    }\r\n\r\n    return this.$q\r\n      .all(dependencies)\r\n      .then(() => {\r\n        const urlValue = queryParams['var-' + variable.name];\r\n        if (urlValue !== void 0) {\r\n          return variable.setValueFromUrl(urlValue).then(variable.initLock.resolve);\r\n        }\r\n\r\n        if (variable.refresh === 1 || variable.refresh === 2) {\r\n          return variable.updateOptions().then(variable.initLock.resolve);\r\n        }\r\n\r\n        variable.initLock.resolve();\r\n      })\r\n      .finally(() => {\r\n        this.templateSrv.variableInitialized(variable);\r\n        delete variable.initLock;\r\n      });\r\n  }\r\n\r\n  createVariableFromModel(model: any) {\r\n    // @ts-ignore\r\n    const ctor = variableTypes[model.type].ctor;\r\n    if (!ctor) {\r\n      throw {\r\n        message: 'Unable to find variable constructor for ' + model.type,\r\n      };\r\n    }\r\n\r\n    const variable = this.$injector.instantiate(ctor, { model: model });\r\n    return variable;\r\n  }\r\n\r\n  addVariable(variable: any) {\r\n    this.variables.push(variable);\r\n    this.templateSrv.updateIndex();\r\n    this.dashboard.updateSubmenuVisibility();\r\n  }\r\n\r\n  removeVariable(variable: any) {\r\n    const index = _.indexOf(this.variables, variable);\r\n    this.variables.splice(index, 1);\r\n    this.templateSrv.updateIndex();\r\n    this.dashboard.updateSubmenuVisibility();\r\n  }\r\n\r\n  updateOptions(variable: any) {\r\n    return variable.updateOptions();\r\n  }\r\n\r\n  variableUpdated(variable: any, emitChangeEvents?: any) {\r\n    // if there is a variable lock ignore cascading update because we are in a boot up scenario\r\n    if (variable.initLock) {\r\n      return this.$q.when();\r\n    }\r\n\r\n    const g = this.createGraph();\r\n    const node = g.getNode(variable.name);\r\n    let promises = [];\r\n    if (node) {\r\n      promises = node.getOptimizedInputEdges().map(e => {\r\n        return this.updateOptions(this.variables.find(v => v.name === e.inputNode.name));\r\n      });\r\n    }\r\n\r\n    return this.$q.all(promises).then(() => {\r\n      if (emitChangeEvents) {\r\n        this.dashboard.templateVariableValueUpdated();\r\n        this.dashboard.startRefresh();\r\n      }\r\n    });\r\n  }\r\n\r\n  selectOptionsForCurrentValue(variable: any) {\r\n    let i, y, value, option;\r\n    const selected: any = [];\r\n\r\n    for (i = 0; i < variable.options.length; i++) {\r\n      option = variable.options[i];\r\n      option.selected = false;\r\n      if (_.isArray(variable.current.value)) {\r\n        for (y = 0; y < variable.current.value.length; y++) {\r\n          value = variable.current.value[y];\r\n          if (option.value === value) {\r\n            option.selected = true;\r\n            selected.push(option);\r\n          }\r\n        }\r\n      } else if (option.value === variable.current.value) {\r\n        option.selected = true;\r\n        selected.push(option);\r\n      }\r\n    }\r\n\r\n    return selected;\r\n  }\r\n\r\n  validateVariableSelectionState(variable: any, defaultValue?: string) {\r\n    if (!variable.current) {\r\n      variable.current = {};\r\n    }\r\n\r\n    if (_.isArray(variable.current.value)) {\r\n      let selected = this.selectOptionsForCurrentValue(variable);\r\n\r\n      // if none pick first\r\n      if (selected.length === 0) {\r\n        selected = variable.options[0];\r\n      } else {\r\n        selected = {\r\n          value: _.map(selected, val => {\r\n            return val.value;\r\n          }),\r\n          text: _.map(selected, val => {\r\n            return val.text;\r\n          }),\r\n        };\r\n      }\r\n\r\n      return variable.setValue(selected);\r\n    } else {\r\n      let option: any = undefined;\r\n\r\n      // 1. find the current value\r\n      option = _.find(variable.options, {\r\n        text: variable.current.text,\r\n      });\r\n      if (option) {\r\n        return variable.setValue(option);\r\n      }\r\n\r\n      // 2. find the default value\r\n      if (defaultValue) {\r\n        option = _.find(variable.options, {\r\n          text: defaultValue,\r\n        });\r\n        if (option) {\r\n          return variable.setValue(option);\r\n        }\r\n      }\r\n\r\n      // 3. use the first value\r\n      if (variable.options) {\r\n        return variable.setValue(variable.options[0]);\r\n      }\r\n\r\n      // 4... give up\r\n      return Promise.resolve();\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Sets the current selected option (or options) based on the query params in the url. It is possible for values\r\n   * in the url to not match current options of the variable. In that case the variables current value will be still set\r\n   * to that value.\r\n   * @param variable Instance of Variable\r\n   * @param urlValue Value of the query parameter\r\n   */\r\n  setOptionFromUrl(variable: any, urlValue: string | string[]): IPromise<any> {\r\n    let promise = this.$q.when();\r\n\r\n    if (variable.refresh) {\r\n      promise = variable.updateOptions();\r\n    }\r\n\r\n    return promise.then(() => {\r\n      // Simple case. Value in url matches existing options text or value.\r\n      let option: any = _.find(variable.options, op => {\r\n        return op.text === urlValue || op.value === urlValue;\r\n      });\r\n\r\n      // No luck either it is array or value does not exist in the variables options.\r\n      if (!option) {\r\n        let defaultText = urlValue;\r\n        const defaultValue = urlValue;\r\n\r\n        if (_.isArray(urlValue)) {\r\n          // Multiple values in the url. We construct text as a list of texts from all matched options.\r\n          defaultText = urlValue.reduce((acc, item) => {\r\n            const t: any = _.find(variable.options, { value: item });\r\n            if (t) {\r\n              acc.push(t.text);\r\n            } else {\r\n              acc.push(item);\r\n            }\r\n\r\n            return acc;\r\n          }, []);\r\n        }\r\n\r\n        // It is possible that we did not match the value to any existing option. In that case the url value will be\r\n        // used anyway for both text and value.\r\n        option = { text: defaultText, value: defaultValue };\r\n      }\r\n\r\n      if (variable.multi) {\r\n        // In case variable is multiple choice, we cast to array to preserve the same behaviour as when selecting\r\n        // the option directly, which will return even single value in an array.\r\n        option = { text: _.castArray(option.text), value: _.castArray(option.value) };\r\n      }\r\n\r\n      return variable.setValue(option);\r\n    });\r\n  }\r\n\r\n  setOptionAsCurrent(variable: any, option: any) {\r\n    variable.current = _.cloneDeep(option);\r\n\r\n    if (_.isArray(variable.current.text) && variable.current.text.length > 0) {\r\n      variable.current.text = variable.current.text.join(' + ');\r\n    } else if (_.isArray(variable.current.value) && variable.current.value[0] !== '$__all') {\r\n      variable.current.text = variable.current.value.join(' + ');\r\n    }\r\n\r\n    this.selectOptionsForCurrentValue(variable);\r\n    return this.variableUpdated(variable);\r\n  }\r\n\r\n  templateVarsChangedInUrl(vars: UrlQueryMap) {\r\n    const update: Array<Promise<any>> = [];\r\n    for (const v of this.variables) {\r\n      const key = `var-${v.name}`;\r\n      if (vars.hasOwnProperty(key)) {\r\n        update.push(v.setValueFromUrl(vars[key]));\r\n      }\r\n    }\r\n    if (update.length) {\r\n      Promise.all(update).then(() => {\r\n        this.dashboard.templateVariableValueUpdated();\r\n        this.dashboard.startRefresh();\r\n      });\r\n    }\r\n  }\r\n\r\n  updateUrlParamsWithCurrentVariables() {\r\n    // update url\r\n    const params = this.$location.search();\r\n\r\n    // remove variable params\r\n    _.each(params, (value, key) => {\r\n      if (key.indexOf('var-') === 0) {\r\n        delete params[key];\r\n      }\r\n    });\r\n\r\n    // add new values\r\n    this.templateSrv.fillVariableValuesForUrl(params);\r\n    // update url\r\n    this.$location.search(params);\r\n  }\r\n\r\n  setAdhocFilter(options: any) {\r\n    let variable: any = _.find(this.variables, {\r\n      type: 'adhoc',\r\n      datasource: options.datasource,\r\n    } as any);\r\n    if (!variable) {\r\n      variable = this.createVariableFromModel({\r\n        name: 'Filters',\r\n        type: 'adhoc',\r\n        datasource: options.datasource,\r\n      });\r\n      this.addVariable(variable);\r\n    }\r\n\r\n    const filters = variable.filters;\r\n    let filter: any = _.find(filters, { key: options.key, value: options.value });\r\n\r\n    if (!filter) {\r\n      filter = { key: options.key, value: options.value };\r\n      filters.push(filter);\r\n    }\r\n\r\n    filter.operator = options.operator;\r\n    this.variableUpdated(variable, true);\r\n  }\r\n\r\n  createGraph() {\r\n    const g = new Graph();\r\n\r\n    this.variables.forEach(v => {\r\n      g.createNode(v.name);\r\n    });\r\n\r\n    this.variables.forEach(v1 => {\r\n      this.variables.forEach(v2 => {\r\n        if (v1 === v2) {\r\n          return;\r\n        }\r\n\r\n        if (v1.dependsOn(v2)) {\r\n          g.link(v1.name, v2.name);\r\n        }\r\n      });\r\n    });\r\n\r\n    return g;\r\n  }\r\n}\r\n\r\ncoreModule.service('variableSrv', VariableSrv);\r\n","import { createSlice, PayloadAction } from '@reduxjs/toolkit';\r\n\r\nimport { Invitee, OrgUser, UsersState } from 'app/types';\r\nimport config from 'app/core/config';\r\n\r\nexport const initialState: UsersState = {\r\n  invitees: [] as Invitee[],\r\n  users: [] as OrgUser[],\r\n  searchQuery: '',\r\n  canInvite: !config.externalUserMngLinkName,\r\n  externalUserMngInfo: config.externalUserMngInfo,\r\n  externalUserMngLinkName: config.externalUserMngLinkName,\r\n  externalUserMngLinkUrl: config.externalUserMngLinkUrl,\r\n  hasFetched: false,\r\n};\r\n\r\nconst usersSlice = createSlice({\r\n  name: 'users',\r\n  initialState,\r\n  reducers: {\r\n    usersLoaded: (state, action: PayloadAction<OrgUser[]>): UsersState => {\r\n      return { ...state, hasFetched: true, users: action.payload };\r\n    },\r\n    inviteesLoaded: (state, action: PayloadAction<Invitee[]>): UsersState => {\r\n      return { ...state, hasFetched: true, invitees: action.payload };\r\n    },\r\n    setUsersSearchQuery: (state, action: PayloadAction<string>): UsersState => {\r\n      return { ...state, searchQuery: action.payload };\r\n    },\r\n  },\r\n});\r\n\r\nexport const { inviteesLoaded, setUsersSearchQuery, usersLoaded } = usersSlice.actions;\r\n\r\nexport const usersReducer = usersSlice.reducer;\r\n\r\nexport default {\r\n  users: usersReducer,\r\n};\r\n","import app from './app';\r\n\r\napp.initEchoSrv();\r\napp.init();\r\n","import React, { FunctionComponent, useState } from 'react';\r\nimport { debounce } from 'lodash';\r\nimport { Input } from '@grafana/ui';\r\n\r\nexport interface Props {\r\n  onChange: (alias: any) => void;\r\n  value: string;\r\n}\r\n\r\nexport const Alias: FunctionComponent<Props> = ({ value = '', onChange }) => {\r\n  const [alias, setAlias] = useState(value);\r\n\r\n  const propagateOnChange = debounce(onChange, 1500);\r\n\r\n  onChange = (e: any) => {\r\n    setAlias(e.target.value);\r\n    propagateOnChange(e.target.value);\r\n  };\r\n\r\n  return <Input type=\"text\" className=\"gf-form-input width-16\" value={alias} onChange={onChange} />;\r\n};\r\n","import React, { ChangeEvent } from 'react';\r\nimport { Switch } from '@grafana/ui';\r\nimport { PanelData } from '@grafana/data';\r\nimport { CloudWatchQuery, AnnotationQuery } from '../types';\r\nimport CloudWatchDatasource from '../datasource';\r\nimport { QueryField, QueryFieldsEditor } from './';\r\n\r\nexport type Props = {\r\n  query: AnnotationQuery;\r\n  datasource: CloudWatchDatasource;\r\n  onChange: (value: AnnotationQuery) => void;\r\n  data?: PanelData;\r\n};\r\n\r\nexport function AnnotationQueryEditor(props: React.PropsWithChildren<Props>) {\r\n  const { query, onChange } = props;\r\n  return (\r\n    <>\r\n      <QueryFieldsEditor\r\n        {...props}\r\n        onChange={(editorQuery: CloudWatchQuery) => onChange({ ...query, ...editorQuery })}\r\n        hideWilcard\r\n      ></QueryFieldsEditor>\r\n      <div className=\"gf-form-inline\">\r\n        <Switch\r\n          label=\"Enable Prefix Matching\"\r\n          labelClass=\"query-keyword\"\r\n          checked={query.prefixMatching}\r\n          onChange={() => onChange({ ...query, prefixMatching: !query.prefixMatching })}\r\n        />\r\n\r\n        <div className=\"gf-form gf-form--grow\">\r\n          <QueryField label=\"Action\">\r\n            <input\r\n              disabled={!query.prefixMatching}\r\n              className=\"gf-form-input width-12\"\r\n              value={query.actionPrefix || ''}\r\n              onChange={(event: ChangeEvent<HTMLInputElement>) =>\r\n                onChange({ ...query, actionPrefix: event.target.value })\r\n              }\r\n            />\r\n          </QueryField>\r\n          <QueryField label=\"Alarm Name\">\r\n            <input\r\n              disabled={!query.prefixMatching}\r\n              className=\"gf-form-input width-12\"\r\n              value={query.alarmNamePrefix || ''}\r\n              onChange={(event: ChangeEvent<HTMLInputElement>) =>\r\n                onChange({ ...query, alarmNamePrefix: event.target.value })\r\n              }\r\n            />\r\n          </QueryField>\r\n          <div className=\"gf-form gf-form--grow\">\r\n            <div className=\"gf-form-label gf-form-label--grow\" />\r\n          </div>\r\n        </div>\r\n      </div>\r\n    </>\r\n  );\r\n}\r\n","import React, { FunctionComponent, Fragment, useState, useEffect } from 'react';\r\nimport isEqual from 'lodash/isEqual';\r\nimport { SelectableValue } from '@grafana/data';\r\nimport { SegmentAsync } from '@grafana/ui';\r\nimport { SelectableStrings } from '../types';\r\n\r\nexport interface Props {\r\n  dimensions: { [key: string]: string | string[] };\r\n  onChange: (dimensions: { [key: string]: string }) => void;\r\n  loadValues: (key: string) => Promise<SelectableStrings>;\r\n  loadKeys: () => Promise<SelectableStrings>;\r\n}\r\n\r\nconst removeText = '-- remove dimension --';\r\nconst removeOption: SelectableValue<string> = { label: removeText, value: removeText };\r\n\r\n// The idea of this component is that is should only trigger the onChange event in the case\r\n// there is a complete dimension object. E.g, when a new key is added is doesn't have a value.\r\n// That should not trigger onChange.\r\nexport const Dimensions: FunctionComponent<Props> = ({ dimensions, loadValues, loadKeys, onChange }) => {\r\n  const [data, setData] = useState(dimensions);\r\n\r\n  useEffect(() => {\r\n    const completeDimensions = Object.entries(data).reduce(\r\n      (res, [key, value]) => (value ? { ...res, [key]: value } : res),\r\n      {}\r\n    );\r\n    if (!isEqual(completeDimensions, dimensions)) {\r\n      onChange(completeDimensions);\r\n    }\r\n  }, [data]);\r\n\r\n  const excludeUsedKeys = (options: SelectableStrings) => {\r\n    return options.filter(({ value }) => !Object.keys(data).includes(value));\r\n  };\r\n\r\n  return (\r\n    <>\r\n      {Object.entries(data).map(([key, value], index) => (\r\n        <Fragment key={index}>\r\n          <SegmentAsync\r\n            allowCustomValue\r\n            value={key}\r\n            loadOptions={() => loadKeys().then(keys => [removeOption, ...excludeUsedKeys(keys)])}\r\n            onChange={({ value: newKey }) => {\r\n              const { [key]: value, ...newDimensions } = data;\r\n              if (newKey === removeText) {\r\n                setData({ ...newDimensions });\r\n              } else {\r\n                setData({ ...newDimensions, [newKey]: '' });\r\n              }\r\n            }}\r\n          />\r\n          <label className=\"gf-form-label query-segment-operator\">=</label>\r\n          <SegmentAsync\r\n            allowCustomValue\r\n            value={value}\r\n            placeholder=\"select dimension value\"\r\n            loadOptions={() => loadValues(key)}\r\n            onChange={({ value: newValue }) => setData({ ...data, [key]: newValue })}\r\n          />\r\n          {Object.values(data).length > 1 && index + 1 !== Object.values(data).length && (\r\n            <label className=\"gf-form-label query-keyword\">AND</label>\r\n          )}\r\n        </Fragment>\r\n      ))}\r\n      {Object.values(data).every(v => v) && (\r\n        <SegmentAsync\r\n          allowCustomValue\r\n          Component={\r\n            <a className=\"gf-form-label query-part\">\r\n              <i className=\"fa fa-plus\" />\r\n            </a>\r\n          }\r\n          loadOptions={() => loadKeys().then(excludeUsedKeys)}\r\n          onChange={({ value: newKey }) => setData({ ...data, [newKey]: '' })}\r\n        />\r\n      )}\r\n    </>\r\n  );\r\n};\r\n","import React, { InputHTMLAttributes, FunctionComponent } from 'react';\r\nimport { FormLabel } from '@grafana/ui';\r\n\r\nexport interface Props extends InputHTMLAttributes<HTMLInputElement> {\r\n  label: string;\r\n  tooltip?: string;\r\n  children?: React.ReactNode;\r\n}\r\n\r\nexport const QueryField: FunctionComponent<Partial<Props>> = ({ label, tooltip, children }) => (\r\n  <>\r\n    <FormLabel width={8} className=\"query-keyword\" tooltip={tooltip}>\r\n      {label}\r\n    </FormLabel>\r\n    {children}\r\n  </>\r\n);\r\n\r\nexport const QueryInlineField: FunctionComponent<Props> = ({ ...props }) => {\r\n  return (\r\n    <div className={'gf-form-inline'}>\r\n      <QueryField {...props} />\r\n      <div className=\"gf-form gf-form--grow\">\r\n        <div className=\"gf-form-label gf-form-label--grow\" />\r\n      </div>\r\n    </div>\r\n  );\r\n};\r\n","import React, { useState, useEffect } from 'react';\r\nimport { SelectableValue } from '@grafana/data';\r\nimport { Segment, SegmentAsync } from '@grafana/ui';\r\nimport { CloudWatchQuery, SelectableStrings } from '../types';\r\nimport CloudWatchDatasource from '../datasource';\r\nimport { Stats, Dimensions, QueryInlineField } from './';\r\n\r\nexport type Props = {\r\n  query: CloudWatchQuery;\r\n  datasource: CloudWatchDatasource;\r\n  onRunQuery?: () => void;\r\n  onChange: (value: CloudWatchQuery) => void;\r\n  hideWilcard?: boolean;\r\n};\r\n\r\ninterface State {\r\n  regions: SelectableStrings;\r\n  namespaces: SelectableStrings;\r\n  metricNames: SelectableStrings;\r\n  variableOptionGroup: SelectableValue<string>;\r\n  showMeta: boolean;\r\n}\r\n\r\nexport function QueryFieldsEditor({\r\n  query,\r\n  datasource,\r\n  onChange,\r\n  onRunQuery = () => {},\r\n  hideWilcard = false,\r\n}: React.PropsWithChildren<Props>) {\r\n  const [state, setState] = useState<State>({\r\n    regions: [],\r\n    namespaces: [],\r\n    metricNames: [],\r\n    variableOptionGroup: {},\r\n    showMeta: false,\r\n  });\r\n\r\n  useEffect(() => {\r\n    const variableOptionGroup = {\r\n      label: 'Template Variables',\r\n      options: datasource.variables.map(toOption),\r\n    };\r\n\r\n    Promise.all([datasource.metricFindQuery('regions()'), datasource.metricFindQuery('namespaces()')]).then(\r\n      ([regions, namespaces]) => {\r\n        setState({\r\n          ...state,\r\n          regions: [...regions, variableOptionGroup],\r\n          namespaces: [...namespaces, variableOptionGroup],\r\n          variableOptionGroup,\r\n        });\r\n      }\r\n    );\r\n  }, []);\r\n\r\n  const loadMetricNames = async () => {\r\n    const { namespace, region } = query;\r\n    return datasource.metricFindQuery(`metrics(${namespace},${region})`).then(appendTemplateVariables);\r\n  };\r\n\r\n  const appendTemplateVariables = (values: SelectableValue[]) => [\r\n    ...values,\r\n    { label: 'Template Variables', options: datasource.variables.map(toOption) },\r\n  ];\r\n\r\n  const toOption = (value: any) => ({ label: value, value });\r\n\r\n  const onQueryChange = (query: CloudWatchQuery) => {\r\n    onChange(query);\r\n    onRunQuery();\r\n  };\r\n\r\n  // Load dimension values based on current selected dimensions.\r\n  // Remove the new dimension key and all dimensions that has a wildcard as selected value\r\n  const loadDimensionValues = (newKey: string) => {\r\n    const { [newKey]: value, ...dim } = query.dimensions;\r\n    const newDimensions = Object.entries(dim).reduce(\r\n      (result, [key, value]) => (value === '*' ? result : { ...result, [key]: value }),\r\n      {}\r\n    );\r\n    return datasource\r\n      .getDimensionValues(query.region, query.namespace, query.metricName, newKey, newDimensions)\r\n      .then(values => (values.length ? [{ value: '*', text: '*', label: '*' }, ...values] : values))\r\n      .then(appendTemplateVariables);\r\n  };\r\n\r\n  const { regions, namespaces, variableOptionGroup } = state;\r\n  return (\r\n    <>\r\n      <QueryInlineField label=\"Region\">\r\n        <Segment\r\n          value={query.region}\r\n          placeholder=\"Select region\"\r\n          options={regions}\r\n          allowCustomValue\r\n          onChange={({ value: region }) => onQueryChange({ ...query, region })}\r\n        />\r\n      </QueryInlineField>\r\n\r\n      {query.expression.length === 0 && (\r\n        <>\r\n          <QueryInlineField label=\"Namespace\">\r\n            <Segment\r\n              value={query.namespace}\r\n              placeholder=\"Select namespace\"\r\n              allowCustomValue\r\n              options={namespaces}\r\n              onChange={({ value: namespace }) => onQueryChange({ ...query, namespace })}\r\n            />\r\n          </QueryInlineField>\r\n\r\n          <QueryInlineField label=\"Metric Name\">\r\n            <SegmentAsync\r\n              value={query.metricName}\r\n              placeholder=\"Select metric name\"\r\n              allowCustomValue\r\n              loadOptions={loadMetricNames}\r\n              onChange={({ value: metricName }) => onQueryChange({ ...query, metricName })}\r\n            />\r\n          </QueryInlineField>\r\n\r\n          <QueryInlineField label=\"Stats\">\r\n            <Stats\r\n              stats={datasource.standardStatistics.map(toOption)}\r\n              values={query.statistics}\r\n              onChange={statistics => onQueryChange({ ...query, statistics })}\r\n              variableOptionGroup={variableOptionGroup}\r\n            />\r\n          </QueryInlineField>\r\n\r\n          <QueryInlineField label=\"Dimensions\">\r\n            <Dimensions\r\n              dimensions={query.dimensions}\r\n              onChange={dimensions => onQueryChange({ ...query, dimensions })}\r\n              loadKeys={() => datasource.getDimensionKeys(query.namespace, query.region).then(appendTemplateVariables)}\r\n              loadValues={loadDimensionValues}\r\n            />\r\n          </QueryInlineField>\r\n        </>\r\n      )}\r\n    </>\r\n  );\r\n}\r\n","import React, { FunctionComponent } from 'react';\r\nimport { SelectableStrings } from '../types';\r\nimport { SelectableValue } from '@grafana/data';\r\nimport { Segment } from '@grafana/ui';\r\n\r\nexport interface Props {\r\n  values: string[];\r\n  onChange: (values: string[]) => void;\r\n  variableOptionGroup: SelectableValue<string>;\r\n  stats: SelectableStrings;\r\n}\r\n\r\nconst removeText = '-- remove stat --';\r\nconst removeOption: SelectableValue<string> = { label: removeText, value: removeText };\r\n\r\nexport const Stats: FunctionComponent<Props> = ({ stats, values, onChange, variableOptionGroup }) => (\r\n  <>\r\n    {values &&\r\n      values.map((value, index) => (\r\n        <Segment\r\n          allowCustomValue\r\n          key={value + index}\r\n          value={value}\r\n          options={[removeOption, ...stats, variableOptionGroup]}\r\n          onChange={({ value }) =>\r\n            onChange(\r\n              value === removeText\r\n                ? values.filter((_, i) => i !== index)\r\n                : values.map((v, i) => (i === index ? value : v))\r\n            )\r\n          }\r\n        />\r\n      ))}\r\n    <Segment\r\n      Component={\r\n        <a className=\"gf-form-label query-part\">\r\n          <i className=\"fa fa-plus\" />\r\n        </a>\r\n      }\r\n      allowCustomValue\r\n      onChange={({ value }) => onChange([...values, value])}\r\n      options={[...stats.filter(({ value }) => !values.includes(value)), variableOptionGroup]}\r\n    />\r\n  </>\r\n);\r\n","export { Stats } from './Stats';\r\nexport { Dimensions } from './Dimensions';\r\nexport { QueryInlineField, QueryField } from './Forms';\r\nexport { Alias } from './Alias';\r\nexport { QueryFieldsEditor } from './QueryFieldsEditor';\r\n","// Libraries\r\nimport React, { PureComponent } from 'react';\r\n\r\n// Types\r\nimport { Select } from '@grafana/ui';\r\nimport { DataQuery, DataQueryError, PanelData, DataFrame, SelectableValue } from '@grafana/data';\r\nimport { DashboardQuery } from './types';\r\nimport config from 'app/core/config';\r\nimport { css } from 'emotion';\r\nimport { getDatasourceSrv } from 'app/features/plugins/datasource_srv';\r\nimport { PanelModel } from 'app/features/dashboard/state';\r\nimport { SHARED_DASHBODARD_QUERY } from './types';\r\nimport { getDashboardSrv } from 'app/features/dashboard/services/DashboardSrv';\r\nimport { filterPanelDataToQuery } from 'app/features/dashboard/panel_editor/QueryEditorRow';\r\n\r\ntype ResultInfo = {\r\n  img: string; // The Datasource\r\n  refId: string;\r\n  query: string; // As text\r\n  data: DataFrame[];\r\n  error?: DataQueryError;\r\n};\r\n\r\nfunction getQueryDisplayText(query: DataQuery): string {\r\n  return JSON.stringify(query);\r\n}\r\n\r\ninterface Props {\r\n  panel: PanelModel;\r\n  panelData: PanelData;\r\n  onChange: (query: DashboardQuery) => void;\r\n}\r\n\r\ntype State = {\r\n  defaultDatasource: string;\r\n  results: ResultInfo[];\r\n};\r\n\r\nexport class DashboardQueryEditor extends PureComponent<Props, State> {\r\n  constructor(props: Props) {\r\n    super(props);\r\n    this.state = {\r\n      defaultDatasource: '',\r\n      results: [],\r\n    };\r\n  }\r\n\r\n  getQuery(): DashboardQuery {\r\n    const { panel } = this.props;\r\n    return panel.targets[0] as DashboardQuery;\r\n  }\r\n\r\n  async componentDidMount() {\r\n    this.componentDidUpdate(null);\r\n  }\r\n\r\n  async componentDidUpdate(prevProps: Props) {\r\n    const { panelData } = this.props;\r\n\r\n    if (!prevProps || prevProps.panelData !== panelData) {\r\n      const query = this.props.panel.targets[0] as DashboardQuery;\r\n      const defaultDS = await getDatasourceSrv().get(null);\r\n      const dashboard = getDashboardSrv().getCurrent();\r\n      const panel = dashboard.getPanelById(query.panelId);\r\n\r\n      if (!panel) {\r\n        this.setState({ defaultDatasource: defaultDS.name });\r\n        return;\r\n      }\r\n\r\n      const mainDS = await getDatasourceSrv().get(panel.datasource);\r\n      const info: ResultInfo[] = [];\r\n\r\n      for (const query of panel.targets) {\r\n        const ds = query.datasource ? await getDatasourceSrv().get(query.datasource) : mainDS;\r\n        const fmt = ds.getQueryDisplayText ? ds.getQueryDisplayText : getQueryDisplayText;\r\n\r\n        const qData = filterPanelDataToQuery(panelData, query.refId);\r\n        const queryData = qData ? qData : panelData;\r\n\r\n        info.push({\r\n          refId: query.refId,\r\n          query: fmt(query),\r\n          img: ds.meta.info.logos.small,\r\n          data: queryData.series,\r\n          error: queryData.error,\r\n        });\r\n      }\r\n\r\n      this.setState({ defaultDatasource: defaultDS.name, results: info });\r\n    }\r\n  }\r\n\r\n  onPanelChanged = (id: number) => {\r\n    const { onChange } = this.props;\r\n    const query = this.getQuery();\r\n    query.panelId = id;\r\n    onChange(query);\r\n\r\n    // Update the\r\n    this.props.panel.refresh();\r\n  };\r\n\r\n  renderQueryData(editURL: string) {\r\n    const { results } = this.state;\r\n\r\n    return (\r\n      <div>\r\n        {results.map((target, index) => {\r\n          return (\r\n            <div className=\"query-editor-row__header\" key={index}>\r\n              <div className=\"query-editor-row__ref-id\">\r\n                <img src={target.img} width={16} className={css({ marginRight: '8px' })} />\r\n                {target.refId}:\r\n              </div>\r\n              <div className=\"query-editor-row__collapsed-text\">\r\n                <a href={editURL}>\r\n                  {target.query}\r\n                  &nbsp;\r\n                  <i className=\"fa fa-external-link\" />\r\n                </a>\r\n              </div>\r\n            </div>\r\n          );\r\n        })}\r\n      </div>\r\n    );\r\n  }\r\n\r\n  getPanelDescription = (panel: PanelModel): string => {\r\n    const { defaultDatasource } = this.state;\r\n    const dsname = panel.datasource ? panel.datasource : defaultDatasource;\r\n\r\n    if (panel.targets.length === 1) {\r\n      return '1 query to ' + dsname;\r\n    }\r\n\r\n    return panel.targets.length + ' queries to ' + dsname;\r\n  };\r\n\r\n  render() {\r\n    const dashboard = getDashboardSrv().getCurrent();\r\n    const query = this.getQuery();\r\n\r\n    let selected: SelectableValue<number>;\r\n    const panels: Array<SelectableValue<number>> = [];\r\n\r\n    for (const panel of dashboard.panels) {\r\n      const plugin = config.panels[panel.type];\r\n      if (!plugin) {\r\n        continue;\r\n      }\r\n\r\n      if (panel.targets && panel.datasource !== SHARED_DASHBODARD_QUERY) {\r\n        const item = {\r\n          value: panel.id,\r\n          label: panel.title ? panel.title : 'Panel ' + panel.id,\r\n          description: this.getPanelDescription(panel),\r\n          imgUrl: plugin.info.logos.small,\r\n        };\r\n\r\n        panels.push(item);\r\n\r\n        if (query.panelId === panel.id) {\r\n          selected = item;\r\n        }\r\n      }\r\n    }\r\n\r\n    if (panels.length < 1) {\r\n      return (\r\n        <div className={css({ padding: '10px' })}>\r\n          This dashboard does not have other panels. Add queries to other panels and try again\r\n        </div>\r\n      );\r\n    }\r\n\r\n    // Same as current URL, but different panelId\r\n    const editURL = `d/${dashboard.uid}/${dashboard.title}?&fullscreen&edit&panelId=${query.panelId}`;\r\n\r\n    return (\r\n      <div>\r\n        <div className=\"gf-form\">\r\n          <div className=\"gf-form-label\">Use results from panel</div>\r\n          <Select\r\n            placeholder=\"Choose Panel\"\r\n            isSearchable={true}\r\n            options={panels}\r\n            value={selected}\r\n            onChange={item => this.onPanelChanged(item.value)}\r\n          />\r\n        </div>\r\n        <div className={css({ padding: '16px' })}>{query.panelId && this.renderQueryData(editURL)}</div>\r\n      </div>\r\n    );\r\n  }\r\n}\r\n","export { isSharedDashboardQuery, runSharedRequest } from './runSharedRequest';\nexport { DashboardQueryEditor } from './DashboardQueryEditor';\nexport { SHARED_DASHBODARD_QUERY } from './types';\n","import { Observable } from 'rxjs';\r\nimport { QueryRunnerOptions } from 'app/features/dashboard/state/PanelQueryRunner';\r\nimport { DashboardQuery, SHARED_DASHBODARD_QUERY } from './types';\r\nimport { getDashboardSrv } from 'app/features/dashboard/services/DashboardSrv';\r\nimport { LoadingState, DefaultTimeRange, DataQuery, PanelData, DataSourceApi } from '@grafana/data';\r\n\r\nexport function isSharedDashboardQuery(datasource: string | DataSourceApi) {\r\n  if (!datasource) {\r\n    // default datasource\r\n    return false;\r\n  }\r\n  if (datasource === SHARED_DASHBODARD_QUERY) {\r\n    return true;\r\n  }\r\n  const ds = datasource as DataSourceApi;\r\n  return ds.meta && ds.meta.name === SHARED_DASHBODARD_QUERY;\r\n}\r\n\r\nexport function runSharedRequest(options: QueryRunnerOptions): Observable<PanelData> {\r\n  return new Observable<PanelData>(subscriber => {\r\n    const dashboard = getDashboardSrv().getCurrent();\r\n    const listenToPanelId = getPanelIdFromQuery(options.queries);\r\n\r\n    if (!listenToPanelId) {\r\n      subscriber.next(getQueryError('Missing panel reference ID'));\r\n      return null;\r\n    }\r\n\r\n    const currentPanel = dashboard.getPanelById(options.panelId);\r\n    const listenToPanel = dashboard.getPanelById(listenToPanelId);\r\n\r\n    if (!listenToPanel) {\r\n      subscriber.next(getQueryError('Unknown Panel: ' + listenToPanelId));\r\n      return null;\r\n    }\r\n\r\n    const listenToRunner = listenToPanel.getQueryRunner();\r\n    const subscription = listenToRunner.getData(false).subscribe({\r\n      next: (data: PanelData) => {\r\n        subscriber.next(data);\r\n      },\r\n    });\r\n\r\n    // If we are in fullscreen the other panel will not execute any queries\r\n    // So we have to trigger it from here\r\n    if (currentPanel.fullscreen) {\r\n      const { datasource, targets } = listenToPanel;\r\n      const modified = {\r\n        ...options,\r\n        datasource,\r\n        panelId: listenToPanelId,\r\n        queries: targets,\r\n      };\r\n      listenToRunner.run(modified);\r\n    }\r\n\r\n    return () => {\r\n      console.log('runSharedRequest unsubscribe');\r\n      subscription.unsubscribe();\r\n    };\r\n  });\r\n}\r\n\r\nfunction getPanelIdFromQuery(queries: DataQuery[]): number | undefined {\r\n  if (!queries || !queries.length) {\r\n    return undefined;\r\n  }\r\n  return (queries[0] as DashboardQuery).panelId;\r\n}\r\n\r\nfunction getQueryError(msg: string): PanelData {\r\n  return {\r\n    state: LoadingState.Error,\r\n    series: [],\r\n    error: { message: msg },\r\n    timeRange: DefaultTimeRange,\r\n  };\r\n}\r\n","import { DataQuery } from '@grafana/data';\r\n\r\nexport const SHARED_DASHBODARD_QUERY = '-- Dashboard --';\r\n\r\nexport interface DashboardQuery extends DataQuery {\r\n  panelId?: number;\r\n}\r\n","import React, { Suspense } from 'react';\r\nimport { PopoverController, Popover } from '@grafana/ui';\r\nimport { FunctionDescriptor, FunctionEditorControls, FunctionEditorControlsProps } from './FunctionEditorControls';\r\n\r\ninterface FunctionEditorProps extends FunctionEditorControlsProps {\r\n  func: FunctionDescriptor;\r\n}\r\n\r\ninterface FunctionEditorState {\r\n  showingDescription: boolean;\r\n}\r\nconst FunctionDescription = React.lazy(async () => {\r\n  // @ts-ignore\r\n  const { default: rst2html } = await import(/* webpackChunkName: \"rst2html\" */ 'rst2html');\r\n  return {\r\n    default: (props: { description: string }) => (\r\n      <div dangerouslySetInnerHTML={{ __html: rst2html(props.description) }} />\r\n    ),\r\n  };\r\n});\r\n\r\nclass FunctionEditor extends React.PureComponent<FunctionEditorProps, FunctionEditorState> {\r\n  private triggerRef = React.createRef<HTMLSpanElement>();\r\n\r\n  constructor(props: FunctionEditorProps) {\r\n    super(props);\r\n\r\n    this.state = {\r\n      showingDescription: false,\r\n    };\r\n  }\r\n\r\n  renderContent = ({ updatePopperPosition }: any) => {\r\n    const {\r\n      onMoveLeft,\r\n      onMoveRight,\r\n      func: {\r\n        def: { name, description },\r\n      },\r\n    } = this.props;\r\n    const { showingDescription } = this.state;\r\n\r\n    if (showingDescription) {\r\n      return (\r\n        <div style={{ overflow: 'auto', maxHeight: '30rem', textAlign: 'left', fontWeight: 'normal' }}>\r\n          <h4 style={{ color: 'white' }}> {name} </h4>\r\n          <Suspense fallback={<span>Loading description...</span>}>\r\n            <FunctionDescription description={description} />\r\n          </Suspense>\r\n        </div>\r\n      );\r\n    }\r\n\r\n    return (\r\n      <FunctionEditorControls\r\n        {...this.props}\r\n        onMoveLeft={() => {\r\n          onMoveLeft(this.props.func);\r\n          updatePopperPosition();\r\n        }}\r\n        onMoveRight={() => {\r\n          onMoveRight(this.props.func);\r\n          updatePopperPosition();\r\n        }}\r\n        onDescriptionShow={() => {\r\n          this.setState({ showingDescription: true }, () => {\r\n            updatePopperPosition();\r\n          });\r\n        }}\r\n      />\r\n    );\r\n  };\r\n\r\n  render() {\r\n    return (\r\n      <PopoverController content={this.renderContent} placement=\"top\" hideAfter={300}>\r\n        {(showPopper, hidePopper, popperProps) => {\r\n          return (\r\n            <>\r\n              {this.triggerRef && (\r\n                <Popover\r\n                  {...popperProps}\r\n                  referenceElement={this.triggerRef.current}\r\n                  wrapperClassName=\"popper\"\r\n                  className=\"popper__background\"\r\n                  onMouseLeave={() => {\r\n                    this.setState({ showingDescription: false });\r\n                    hidePopper();\r\n                  }}\r\n                  onMouseEnter={showPopper}\r\n                  renderArrow={({ arrowProps, placement }) => (\r\n                    <div className=\"popper__arrow\" data-placement={placement} {...arrowProps} />\r\n                  )}\r\n                />\r\n              )}\r\n\r\n              <span\r\n                ref={this.triggerRef}\r\n                onClick={popperProps.show ? hidePopper : showPopper}\r\n                onMouseLeave={() => {\r\n                  hidePopper();\r\n                  this.setState({ showingDescription: false });\r\n                }}\r\n                style={{ cursor: 'pointer' }}\r\n              >\r\n                {this.props.func.def.name}\r\n              </span>\r\n            </>\r\n          );\r\n        }}\r\n      </PopoverController>\r\n    );\r\n  }\r\n}\r\n\r\nexport { FunctionEditor };\r\n","import React from 'react';\r\n\r\nexport interface FunctionDescriptor {\r\n  text: string;\r\n  params: string[];\r\n  def: {\r\n    category: string;\r\n    defaultParams: string[];\r\n    description?: string;\r\n    fake: boolean;\r\n    name: string;\r\n    params: string[];\r\n  };\r\n}\r\n\r\nexport interface FunctionEditorControlsProps {\r\n  onMoveLeft: (func: FunctionDescriptor) => void;\r\n  onMoveRight: (func: FunctionDescriptor) => void;\r\n  onRemove: (func: FunctionDescriptor) => void;\r\n}\r\n\r\nconst FunctionHelpButton = (props: { description: string; name: string; onDescriptionShow: () => void }) => {\r\n  if (props.description) {\r\n    return <span className=\"pointer fa fa-question-circle\" onClick={props.onDescriptionShow} />;\r\n  }\r\n\r\n  return (\r\n    <span\r\n      className=\"pointer fa fa-question-circle\"\r\n      onClick={() => {\r\n        window.open(\r\n          'http://graphite.readthedocs.org/en/latest/functions.html#graphite.render.functions.' + props.name,\r\n          '_blank'\r\n        );\r\n      }}\r\n    />\r\n  );\r\n};\r\n\r\nexport const FunctionEditorControls = (\r\n  props: FunctionEditorControlsProps & {\r\n    func: FunctionDescriptor;\r\n    onDescriptionShow: () => void;\r\n  }\r\n) => {\r\n  const { func, onMoveLeft, onMoveRight, onRemove, onDescriptionShow } = props;\r\n  return (\r\n    <div\r\n      style={{\r\n        display: 'flex',\r\n        width: '60px',\r\n        justifyContent: 'space-between',\r\n      }}\r\n    >\r\n      <span className=\"pointer fa fa-arrow-left\" onClick={() => onMoveLeft(func)} />\r\n      <FunctionHelpButton\r\n        name={func.def.name}\r\n        description={func.def.description}\r\n        onDescriptionShow={onDescriptionShow}\r\n      />\r\n      <span className=\"pointer fa fa-remove\" onClick={() => onRemove(func)} />\r\n      <span className=\"pointer fa fa-arrow-right\" onClick={() => onMoveRight(func)} />\r\n    </div>\r\n  );\r\n};\r\n","// Libraries\r\nimport React, { memo } from 'react';\r\n\r\n// Types\r\nimport { LokiQuery } from '../types';\r\nimport { useLokiSyntax } from './useLokiSyntax';\r\nimport { LokiQueryFieldForm } from './LokiQueryFieldForm';\r\nimport LokiDatasource from '../datasource';\r\n\r\ninterface Props {\r\n  expr: string;\r\n  datasource: LokiDatasource;\r\n  onChange: (expr: string) => void;\r\n}\r\n\r\nexport const LokiAnnotationsQueryEditor = memo(function LokiAnnotationQueryEditor(props: Props) {\r\n  const { expr, datasource, onChange } = props;\r\n\r\n  // Timerange to get existing labels from. Hard coding like this seems to be good enough right now.\r\n  const absolute = {\r\n    from: Date.now() - 10000,\r\n    to: Date.now(),\r\n  };\r\n\r\n  const { isSyntaxReady, setActiveOption, refreshLabels, ...syntaxProps } = useLokiSyntax(\r\n    datasource.languageProvider,\r\n    absolute\r\n  );\r\n\r\n  const query: LokiQuery = {\r\n    refId: '',\r\n    expr,\r\n  };\r\n\r\n  return (\r\n    <div className=\"gf-form-group\">\r\n      <LokiQueryFieldForm\r\n        datasource={datasource}\r\n        query={query}\r\n        onChange={(query: LokiQuery) => onChange(query.expr)}\r\n        onRunQuery={() => {}}\r\n        history={[]}\r\n        data={null}\r\n        onLoadOptions={setActiveOption}\r\n        onLabelsRefresh={refreshLabels}\r\n        syntaxLoaded={isSyntaxReady}\r\n        absoluteRange={absolute}\r\n        {...syntaxProps}\r\n      />\r\n    </div>\r\n  );\r\n});\r\n","// Libraries\r\nimport React from 'react';\r\n\r\nimport {\r\n  ButtonCascader,\r\n  CascaderOption,\r\n  SlatePrism,\r\n  TypeaheadOutput,\r\n  SuggestionsState,\r\n  QueryField,\r\n  TypeaheadInput,\r\n  BracesPlugin,\r\n} from '@grafana/ui';\r\n\r\n// Utils & Services\r\n// dom also includes Element polyfills\r\nimport { Plugin, Node } from 'slate';\r\n\r\n// Types\r\nimport { DOMUtil } from '@grafana/ui';\r\nimport { ExploreQueryFieldProps, AbsoluteTimeRange } from '@grafana/data';\r\nimport { LokiQuery, LokiOptions } from '../types';\r\nimport { Grammar } from 'prismjs';\r\nimport LokiLanguageProvider, { LokiHistoryItem } from '../language_provider';\r\nimport LokiDatasource from '../datasource';\r\n\r\nfunction getChooserText(hasSyntax: boolean, hasLogLabels: boolean) {\r\n  if (!hasSyntax) {\r\n    return 'Loading labels...';\r\n  }\r\n  if (!hasLogLabels) {\r\n    return '(No labels found)';\r\n  }\r\n  return 'Log labels';\r\n}\r\n\r\nfunction willApplySuggestion(suggestion: string, { typeaheadContext, typeaheadText }: SuggestionsState): string {\r\n  // Modify suggestion based on context\r\n  switch (typeaheadContext) {\r\n    case 'context-labels': {\r\n      const nextChar = DOMUtil.getNextCharacter();\r\n      if (!nextChar || nextChar === '}' || nextChar === ',') {\r\n        suggestion += '=';\r\n      }\r\n      break;\r\n    }\r\n\r\n    case 'context-label-values': {\r\n      // Always add quotes and remove existing ones instead\r\n      if (!typeaheadText.match(/^(!?=~?\"|\")/)) {\r\n        suggestion = `\"${suggestion}`;\r\n      }\r\n      if (DOMUtil.getNextCharacter() !== '\"') {\r\n        suggestion = `${suggestion}\"`;\r\n      }\r\n      break;\r\n    }\r\n\r\n    default:\r\n  }\r\n  return suggestion;\r\n}\r\n\r\nexport interface LokiQueryFieldFormProps extends ExploreQueryFieldProps<LokiDatasource, LokiQuery, LokiOptions> {\r\n  history: LokiHistoryItem[];\r\n  syntax: Grammar;\r\n  logLabelOptions: CascaderOption[];\r\n  syntaxLoaded: boolean;\r\n  absoluteRange: AbsoluteTimeRange;\r\n  onLoadOptions: (selectedOptions: CascaderOption[]) => void;\r\n  onLabelsRefresh?: () => void;\r\n}\r\n\r\nexport class LokiQueryFieldForm extends React.PureComponent<LokiQueryFieldFormProps> {\r\n  plugins: Plugin[];\r\n  modifiedSearch: string;\r\n  modifiedQuery: string;\r\n\r\n  constructor(props: LokiQueryFieldFormProps, context: React.Context<any>) {\r\n    super(props, context);\r\n\r\n    this.plugins = [\r\n      BracesPlugin(),\r\n      SlatePrism({\r\n        onlyIn: (node: Node) => node.object === 'block' && node.type === 'code_block',\r\n        getSyntax: (node: Node) => 'promql',\r\n      }),\r\n    ];\r\n  }\r\n\r\n  loadOptions = (selectedOptions: CascaderOption[]) => {\r\n    this.props.onLoadOptions(selectedOptions);\r\n  };\r\n\r\n  onChangeLogLabels = (values: string[], selectedOptions: CascaderOption[]) => {\r\n    if (selectedOptions.length === 2) {\r\n      const key = selectedOptions[0].value;\r\n      const value = selectedOptions[1].value;\r\n      const query = `{${key}=\"${value}\"}`;\r\n      this.onChangeQuery(query, true);\r\n    }\r\n  };\r\n\r\n  onChangeQuery = (value: string, override?: boolean) => {\r\n    // Send text change to parent\r\n    const { query, onChange, onRunQuery } = this.props;\r\n    if (onChange) {\r\n      const nextQuery = { ...query, expr: value };\r\n      onChange(nextQuery);\r\n\r\n      if (override && onRunQuery) {\r\n        onRunQuery();\r\n      }\r\n    }\r\n  };\r\n\r\n  onTypeahead = async (typeahead: TypeaheadInput): Promise<TypeaheadOutput> => {\r\n    const { datasource } = this.props;\r\n\r\n    if (!datasource.languageProvider) {\r\n      return { suggestions: [] };\r\n    }\r\n\r\n    const lokiLanguageProvider = datasource.languageProvider as LokiLanguageProvider;\r\n    const { history, absoluteRange } = this.props;\r\n    const { prefix, text, value, wrapperClasses, labelKey } = typeahead;\r\n\r\n    const result = await lokiLanguageProvider.provideCompletionItems(\r\n      { text, value, prefix, wrapperClasses, labelKey },\r\n      { history, absoluteRange }\r\n    );\r\n\r\n    //console.log('handleTypeahead', wrapperClasses, text, prefix, nextChar, labelKey, result.context);\r\n\r\n    return result;\r\n  };\r\n\r\n  render() {\r\n    const { data, query, syntaxLoaded, logLabelOptions, onLoadOptions, onLabelsRefresh, datasource } = this.props;\r\n    const lokiLanguageProvider = datasource.languageProvider as LokiLanguageProvider;\r\n    const cleanText = datasource.languageProvider ? lokiLanguageProvider.cleanText : undefined;\r\n    const hasLogLabels = logLabelOptions && logLabelOptions.length > 0;\r\n    const chooserText = getChooserText(syntaxLoaded, hasLogLabels);\r\n    const buttonDisabled = !(syntaxLoaded && hasLogLabels);\r\n    const showError = data && data.error && data.error.refId === query.refId;\r\n\r\n    return (\r\n      <>\r\n        <div className=\"gf-form-inline\">\r\n          <div className=\"gf-form\">\r\n            <ButtonCascader\r\n              options={logLabelOptions || []}\r\n              disabled={buttonDisabled}\r\n              onChange={this.onChangeLogLabels}\r\n              loadData={onLoadOptions}\r\n              onPopupVisibleChange={isVisible => isVisible && onLabelsRefresh && onLabelsRefresh()}\r\n            >\r\n              {chooserText}\r\n            </ButtonCascader>\r\n          </div>\r\n          <div className=\"gf-form gf-form--grow\">\r\n            <QueryField\r\n              additionalPlugins={this.plugins}\r\n              cleanText={cleanText}\r\n              query={query.expr}\r\n              onTypeahead={this.onTypeahead}\r\n              onWillApplySuggestion={willApplySuggestion}\r\n              onChange={this.onChangeQuery}\r\n              onBlur={this.props.onBlur}\r\n              onRunQuery={this.props.onRunQuery}\r\n              placeholder=\"Enter a Loki query\"\r\n              portalOrigin=\"loki\"\r\n              syntaxLoaded={syntaxLoaded}\r\n            />\r\n          </div>\r\n        </div>\r\n        <div>{showError ? <div className=\"prom-query-field-info text-error\">{data.error.message}</div> : null}</div>\r\n      </>\r\n    );\r\n  }\r\n}\r\n","import { useState, useEffect } from 'react';\r\nimport { AbsoluteTimeRange } from '@grafana/data';\r\nimport { CascaderOption } from '@grafana/ui';\r\n\r\nimport LokiLanguageProvider from 'app/plugins/datasource/loki/language_provider';\r\nimport { useRefMounted } from 'app/core/hooks/useRefMounted';\r\n\r\n/**\r\n *\r\n * @param languageProvider\r\n * @param languageProviderInitialised\r\n * @param activeOption rc-cascader provided option used to fetch option's values that hasn't been loaded yet\r\n *\r\n * @description Fetches missing labels and enables labels refresh\r\n */\r\nexport const useLokiLabels = (\r\n  languageProvider: LokiLanguageProvider,\r\n  languageProviderInitialised: boolean,\r\n  activeOption: CascaderOption[],\r\n  absoluteRange: AbsoluteTimeRange\r\n) => {\r\n  const mounted = useRefMounted();\r\n\r\n  // State\r\n  const [logLabelOptions, setLogLabelOptions] = useState([]);\r\n  const [shouldTryRefreshLabels, setRefreshLabels] = useState(false);\r\n  const [shouldForceRefreshLabels, setForceRefreshLabels] = useState(false);\r\n\r\n  // Async\r\n  const fetchOptionValues = async (option: string) => {\r\n    await languageProvider.fetchLabelValues(option, absoluteRange);\r\n    if (mounted.current) {\r\n      setLogLabelOptions(languageProvider.logLabelOptions);\r\n    }\r\n  };\r\n\r\n  const tryLabelsRefresh = async () => {\r\n    await languageProvider.refreshLogLabels(absoluteRange, shouldForceRefreshLabels);\r\n\r\n    if (mounted.current) {\r\n      setRefreshLabels(false);\r\n      setForceRefreshLabels(false);\r\n      setLogLabelOptions(languageProvider.logLabelOptions);\r\n    }\r\n  };\r\n\r\n  // Effects\r\n\r\n  // This effect performs loading of options that hasn't been loaded yet\r\n  // It's a subject of activeOption state change only. This is because of specific behavior or rc-cascader\r\n  // https://github.com/react-component/cascader/blob/master/src/Cascader.jsx#L165\r\n  useEffect(() => {\r\n    if (languageProviderInitialised) {\r\n      const targetOption = activeOption[activeOption.length - 1];\r\n      if (targetOption) {\r\n        const nextOptions = logLabelOptions.map(option => {\r\n          if (option.value === targetOption.value) {\r\n            return {\r\n              ...option,\r\n              loading: true,\r\n            };\r\n          }\r\n          return option;\r\n        });\r\n        setLogLabelOptions(nextOptions); // to set loading\r\n        fetchOptionValues(targetOption.value);\r\n      }\r\n    }\r\n  }, [activeOption]);\r\n\r\n  // This effect is performed on shouldTryRefreshLabels or shouldForceRefreshLabels state change only.\r\n  // Since shouldTryRefreshLabels is reset AFTER the labels are refreshed we are secured in case of trying to refresh\r\n  // when previous refresh hasn't finished yet\r\n  useEffect(() => {\r\n    if (shouldTryRefreshLabels || shouldForceRefreshLabels) {\r\n      tryLabelsRefresh();\r\n    }\r\n  }, [shouldTryRefreshLabels, shouldForceRefreshLabels]);\r\n\r\n  return {\r\n    logLabelOptions,\r\n    setLogLabelOptions,\r\n    refreshLabels: () => setRefreshLabels(true),\r\n  };\r\n};\r\n","import { useState, useEffect } from 'react';\r\nimport Prism from 'prismjs';\r\nimport { AbsoluteTimeRange } from '@grafana/data';\r\nimport { CascaderOption } from '@grafana/ui';\r\nimport LokiLanguageProvider from 'app/plugins/datasource/loki/language_provider';\r\nimport { useLokiLabels } from 'app/plugins/datasource/loki/components/useLokiLabels';\r\nimport { useRefMounted } from 'app/core/hooks/useRefMounted';\r\n\r\nconst PRISM_SYNTAX = 'promql';\r\n\r\n/**\r\n *\r\n * @param languageProvider\r\n * @description Initializes given language provider, exposes Loki syntax and enables loading label option values\r\n */\r\nexport const useLokiSyntax = (languageProvider: LokiLanguageProvider, absoluteRange: AbsoluteTimeRange) => {\r\n  const mounted = useRefMounted();\r\n  // State\r\n  const [languageProviderInitialized, setLanguageProviderInitilized] = useState(false);\r\n  const [syntax, setSyntax] = useState(null);\r\n\r\n  /**\r\n   * Holds information about currently selected option from rc-cascader to perform effect\r\n   * that loads option values not fetched yet. Based on that useLokiLabels hook decides whether or not\r\n   * the option requires additional data fetching\r\n   */\r\n  const [activeOption, setActiveOption] = useState<CascaderOption[]>();\r\n\r\n  const { logLabelOptions, setLogLabelOptions, refreshLabels } = useLokiLabels(\r\n    languageProvider,\r\n    languageProviderInitialized,\r\n    activeOption,\r\n    absoluteRange\r\n  );\r\n\r\n  // Async\r\n  const initializeLanguageProvider = async () => {\r\n    languageProvider.initialRange = absoluteRange;\r\n    await languageProvider.start();\r\n    Prism.languages[PRISM_SYNTAX] = languageProvider.getSyntax();\r\n    if (mounted.current) {\r\n      setLogLabelOptions(languageProvider.logLabelOptions);\r\n      setSyntax(languageProvider.getSyntax());\r\n      setLanguageProviderInitilized(true);\r\n    }\r\n  };\r\n\r\n  // Effects\r\n  useEffect(() => {\r\n    initializeLanguageProvider();\r\n  }, []);\r\n\r\n  return {\r\n    isSyntaxReady: languageProviderInitialized,\r\n    syntax,\r\n    logLabelOptions,\r\n    setActiveOption,\r\n    refreshLabels,\r\n  };\r\n};\r\n","import React from 'react';\r\nimport _ from 'lodash';\r\n\r\nimport { SelectableValue } from '@grafana/data';\r\nimport { Segment } from '@grafana/ui';\r\nimport { getAggregationOptionsByMetric } from '../functions';\r\nimport { ValueTypes, MetricKind } from '../constants';\r\n\r\nexport interface Props {\r\n  onChange: (metricDescriptor: any) => void;\r\n  metricDescriptor: {\r\n    valueType: string;\r\n    metricKind: string;\r\n  };\r\n  crossSeriesReducer: string;\r\n  groupBys: string[];\r\n  children?: (renderProps: any) => JSX.Element;\r\n  templateVariableOptions: Array<SelectableValue<string>>;\r\n}\r\n\r\nexport interface State {\r\n  aggOptions: any[];\r\n  displayAdvancedOptions: boolean;\r\n}\r\n\r\nexport class Aggregations extends React.Component<Props, State> {\r\n  state: State = {\r\n    aggOptions: [],\r\n    displayAdvancedOptions: false,\r\n  };\r\n\r\n  componentDidMount() {\r\n    this.setAggOptions(this.props);\r\n  }\r\n\r\n  UNSAFE_componentWillReceiveProps(nextProps: Props) {\r\n    this.setAggOptions(nextProps);\r\n  }\r\n\r\n  setAggOptions({ metricDescriptor }: Props) {\r\n    let aggOptions: any[] = [];\r\n    if (metricDescriptor) {\r\n      aggOptions = getAggregationOptionsByMetric(\r\n        metricDescriptor.valueType as ValueTypes,\r\n        metricDescriptor.metricKind as MetricKind\r\n      ).map(a => ({\r\n        ...a,\r\n        label: a.text,\r\n      }));\r\n    }\r\n    this.setState({ aggOptions });\r\n  }\r\n\r\n  onToggleDisplayAdvanced = () => {\r\n    this.setState(state => ({\r\n      displayAdvancedOptions: !state.displayAdvancedOptions,\r\n    }));\r\n  };\r\n\r\n  render() {\r\n    const { displayAdvancedOptions, aggOptions } = this.state;\r\n    const { templateVariableOptions, onChange, crossSeriesReducer } = this.props;\r\n\r\n    return (\r\n      <>\r\n        <div className=\"gf-form-inline\">\r\n          <label className=\"gf-form-label query-keyword width-9\">Aggregation</label>\r\n          <Segment\r\n            onChange={({ value }) => onChange(value)}\r\n            value={[...aggOptions, ...templateVariableOptions].find(s => s.value === crossSeriesReducer)}\r\n            options={[\r\n              {\r\n                label: 'Template Variables',\r\n                options: templateVariableOptions,\r\n              },\r\n              {\r\n                label: 'Aggregations',\r\n                expanded: true,\r\n                options: aggOptions,\r\n              },\r\n            ]}\r\n            placeholder=\"Select Reducer\"\r\n          ></Segment>\r\n          <div className=\"gf-form gf-form--grow\">\r\n            <label className=\"gf-form-label gf-form-label--grow\">\r\n              <a onClick={this.onToggleDisplayAdvanced}>\r\n                <>\r\n                  <i className={`fa fa-caret-${displayAdvancedOptions ? 'down' : 'right'}`} /> Advanced Options\r\n                </>\r\n              </a>\r\n            </label>\r\n          </div>\r\n        </div>\r\n        {this.props.children(this.state.displayAdvancedOptions)}\r\n      </>\r\n    );\r\n  }\r\n}\r\n","import React, { Component } from 'react';\r\nimport { debounce } from 'lodash';\r\nimport { Input } from '@grafana/ui';\r\n\r\nexport interface Props {\r\n  onChange: (alignmentPeriod: any) => void;\r\n  value: string;\r\n}\r\n\r\nexport interface State {\r\n  value: string;\r\n}\r\n\r\nexport class AliasBy extends Component<Props, State> {\r\n  propagateOnChange: (value: any) => void;\r\n\r\n  constructor(props: Props) {\r\n    super(props);\r\n    this.propagateOnChange = debounce(this.props.onChange, 500);\r\n    this.state = { value: '' };\r\n  }\r\n\r\n  componentDidMount() {\r\n    this.setState({ value: this.props.value });\r\n  }\r\n\r\n  UNSAFE_componentWillReceiveProps(nextProps: Props) {\r\n    if (nextProps.value !== this.props.value) {\r\n      this.setState({ value: nextProps.value });\r\n    }\r\n  }\r\n\r\n  onChange = (e: React.ChangeEvent<HTMLInputElement>) => {\r\n    this.setState({ value: e.target.value });\r\n    this.propagateOnChange(e.target.value);\r\n  };\r\n\r\n  render() {\r\n    return (\r\n      <>\r\n        <div className=\"gf-form-inline\">\r\n          <div className=\"gf-form\">\r\n            <label className=\"gf-form-label query-keyword width-9\">Alias By</label>\r\n            <Input type=\"text\" className=\"gf-form-input width-24\" value={this.state.value} onChange={this.onChange} />\r\n          </div>\r\n          <div className=\"gf-form gf-form--grow\">\r\n            <div className=\"gf-form-label gf-form-label--grow\" />\r\n          </div>\r\n        </div>\r\n      </>\r\n    );\r\n  }\r\n}\r\n","import React, { FC } from 'react';\r\nimport _ from 'lodash';\r\n\r\nimport { TemplateSrv } from 'app/features/templating/template_srv';\r\nimport kbn from 'app/core/utils/kbn';\r\nimport { SelectableValue } from '@grafana/data';\r\nimport { Segment } from '@grafana/ui';\r\nimport { alignmentPeriods, alignOptions } from '../constants';\r\n\r\nexport interface Props {\r\n  onChange: (alignmentPeriod: any) => void;\r\n  templateSrv: TemplateSrv;\r\n  templateVariableOptions: Array<SelectableValue<string>>;\r\n  alignmentPeriod: string;\r\n  perSeriesAligner: string;\r\n  usedAlignmentPeriod: string;\r\n}\r\n\r\nexport const AlignmentPeriods: FC<Props> = ({\r\n  alignmentPeriod,\r\n  templateSrv,\r\n  templateVariableOptions,\r\n  onChange,\r\n  perSeriesAligner,\r\n  usedAlignmentPeriod,\r\n}) => {\r\n  const alignment = alignOptions.find(ap => ap.value === templateSrv.replace(perSeriesAligner));\r\n  const formatAlignmentText = `${kbn.secondsToHms(usedAlignmentPeriod)} interval (${alignment ? alignment.text : ''})`;\r\n  const options = alignmentPeriods.map(ap => ({\r\n    ...ap,\r\n    label: ap.text,\r\n  }));\r\n\r\n  return (\r\n    <>\r\n      <div className=\"gf-form-inline\">\r\n        <label className=\"gf-form-label query-keyword width-9\">Alignment Period</label>\r\n        <Segment\r\n          onChange={({ value }) => onChange(value)}\r\n          value={[...options, ...templateVariableOptions].find(s => s.value === alignmentPeriod)}\r\n          options={[\r\n            {\r\n              label: 'Template Variables',\r\n              options: templateVariableOptions,\r\n            },\r\n            {\r\n              label: 'Aggregations',\r\n              expanded: true,\r\n              options: options,\r\n            },\r\n          ]}\r\n          placeholder=\"Select Alignment\"\r\n        ></Segment>\r\n        <div className=\"gf-form gf-form--grow\">\r\n          {usedAlignmentPeriod && <label className=\"gf-form-label gf-form-label--grow\">{formatAlignmentText}</label>}\r\n        </div>\r\n      </div>\r\n    </>\r\n  );\r\n};\r\n","import React, { FC } from 'react';\r\n\r\nimport { SelectableValue } from '@grafana/data';\r\nimport { Segment } from '@grafana/ui';\r\n\r\nexport interface Props {\r\n  onChange: (perSeriesAligner: any) => void;\r\n  templateVariableOptions: Array<SelectableValue<string>>;\r\n  alignOptions: Array<SelectableValue<string>>;\r\n  perSeriesAligner: string;\r\n}\r\n\r\nexport const Alignments: FC<Props> = ({ perSeriesAligner, templateVariableOptions, onChange, alignOptions }) => {\r\n  return (\r\n    <>\r\n      <div className=\"gf-form-inline\">\r\n        <div className=\"gf-form offset-width-9\">\r\n          <label className=\"gf-form-label query-keyword width-15\">Aligner</label>\r\n          <Segment\r\n            onChange={({ value }) => onChange(value)}\r\n            value={[...alignOptions, ...templateVariableOptions].find(s => s.value === perSeriesAligner)}\r\n            options={[\r\n              {\r\n                label: 'Template Variables',\r\n                options: templateVariableOptions,\r\n              },\r\n              {\r\n                label: 'Alignment options',\r\n                expanded: true,\r\n                options: alignOptions,\r\n              },\r\n            ]}\r\n            placeholder=\"Select Alignment\"\r\n          ></Segment>\r\n        </div>\r\n      </div>\r\n    </>\r\n  );\r\n};\r\n","import React from 'react';\r\nimport { Input } from '@grafana/ui';\r\n\r\nimport { TemplateSrv } from 'app/features/templating/template_srv';\r\nimport { SelectableValue } from '@grafana/data';\r\n\r\nimport StackdriverDatasource from '../datasource';\r\nimport { Metrics, Filters, AnnotationsHelp } from './';\r\nimport { toOption } from '../functions';\r\nimport { AnnotationTarget, MetricDescriptor } from '../types';\r\n\r\nexport interface Props {\r\n  onQueryChange: (target: AnnotationTarget) => void;\r\n  target: AnnotationTarget;\r\n  datasource: StackdriverDatasource;\r\n  templateSrv: TemplateSrv;\r\n}\r\n\r\ninterface State extends AnnotationTarget {\r\n  variableOptionGroup: SelectableValue<string>;\r\n  variableOptions: Array<SelectableValue<string>>;\r\n  labels: any;\r\n  [key: string]: any;\r\n}\r\n\r\nconst DefaultTarget: State = {\r\n  defaultProject: 'loading project...',\r\n  metricType: '',\r\n  filters: [],\r\n  metricKind: '',\r\n  valueType: '',\r\n  refId: 'annotationQuery',\r\n  title: '',\r\n  text: '',\r\n  labels: {},\r\n  variableOptionGroup: {},\r\n  variableOptions: [],\r\n};\r\n\r\nexport class AnnotationQueryEditor extends React.Component<Props, State> {\r\n  state: State = DefaultTarget;\r\n\r\n  componentDidMount() {\r\n    const { target, datasource } = this.props;\r\n    const variableOptionGroup = {\r\n      label: 'Template Variables',\r\n      options: datasource.variables.map(toOption),\r\n    };\r\n\r\n    this.setState({\r\n      variableOptionGroup,\r\n      variableOptions: variableOptionGroup.options,\r\n      ...target,\r\n    });\r\n\r\n    datasource.getLabels(target.metricType, target.refId).then(labels => this.setState({ labels }));\r\n  }\r\n\r\n  onMetricTypeChange = ({ valueType, metricKind, type, unit }: MetricDescriptor) => {\r\n    const { onQueryChange, datasource } = this.props;\r\n    this.setState(\r\n      {\r\n        metricType: type,\r\n        unit,\r\n        valueType,\r\n        metricKind,\r\n      },\r\n      () => {\r\n        onQueryChange(this.state);\r\n      }\r\n    );\r\n    datasource.getLabels(type, this.state.refId).then(labels => this.setState({ labels }));\r\n  };\r\n\r\n  onChange(prop: string, value: string | string[]) {\r\n    this.setState({ [prop]: value }, () => {\r\n      this.props.onQueryChange(this.state);\r\n    });\r\n  }\r\n\r\n  render() {\r\n    const {\r\n      defaultProject,\r\n      metricType,\r\n      filters,\r\n      title,\r\n      text,\r\n      variableOptionGroup,\r\n      labels,\r\n      variableOptions,\r\n    } = this.state;\r\n    const { datasource } = this.props;\r\n\r\n    return (\r\n      <>\r\n        <Metrics\r\n          defaultProject={defaultProject}\r\n          metricType={metricType}\r\n          templateSrv={datasource.templateSrv}\r\n          datasource={datasource}\r\n          templateVariableOptions={variableOptions}\r\n          onChange={metric => this.onMetricTypeChange(metric)}\r\n        >\r\n          {metric => (\r\n            <>\r\n              <Filters\r\n                labels={labels}\r\n                filters={filters}\r\n                onChange={value => this.onChange('filters', value)}\r\n                variableOptionGroup={variableOptionGroup}\r\n              />\r\n            </>\r\n          )}\r\n        </Metrics>\r\n        <div className=\"gf-form gf-form-inline\">\r\n          <div className=\"gf-form\">\r\n            <span className=\"gf-form-label query-keyword width-9\">Title</span>\r\n            <Input\r\n              type=\"text\"\r\n              className=\"gf-form-input width-20\"\r\n              value={title}\r\n              onChange={e => this.onChange('title', e.target.value)}\r\n            />\r\n          </div>\r\n          <div className=\"gf-form\">\r\n            <span className=\"gf-form-label query-keyword width-9\">Text</span>\r\n            <Input\r\n              type=\"text\"\r\n              className=\"gf-form-input width-20\"\r\n              value={text}\r\n              onChange={e => this.onChange('text', e.target.value)}\r\n            />\r\n          </div>\r\n          <div className=\"gf-form gf-form--grow\">\r\n            <div className=\"gf-form-label gf-form-label--grow\" />\r\n          </div>\r\n        </div>\r\n\r\n        <AnnotationsHelp />\r\n      </>\r\n    );\r\n  }\r\n}\r\n","import React, { FC } from 'react';\r\n\r\nexport const AnnotationsHelp: FC = () => {\r\n  return (\r\n    <div className=\"gf-form grafana-info-box\" style={{ padding: 0 }}>\r\n      <pre className=\"gf-form-pre alert alert-info\" style={{ marginRight: 0 }}>\r\n        <h5>Annotation Query Format</h5>\r\n        <p>\r\n          An annotation is an event that is overlaid on top of graphs. Annotation rendering is expensive so it is\r\n          important to limit the number of rows returned.{' '}\r\n        </p>\r\n        <p>\r\n          The Title and Text fields support templating and can use data returned from the query. For example, the Title\r\n          field could have the following text:\r\n        </p>\r\n        <code>\r\n          {`${'{{metric.type}}'}`} has value: {`${'{{metric.value}}'}`}\r\n        </code>\r\n        <p>\r\n          Example Result: <code>monitoring.googleapis.com/uptime_check/http_status has this value: 502</code>\r\n        </p>\r\n        <label>Patterns:</label>\r\n        <p>\r\n          <code>{`${'{{metric.value}}'}`}</code> = value of the metric/point\r\n        </p>\r\n        <p>\r\n          <code>{`${'{{metric.type}}'}`}</code> = metric type e.g. compute.googleapis.com/instance/cpu/usage_time\r\n        </p>\r\n        <p>\r\n          <code>{`${'{{metric.name}}'}`}</code> = name part of metric e.g. instance/cpu/usage_time\r\n        </p>\r\n        <p>\r\n          <code>{`${'{{metric.service}}'}`}</code> = service part of metric e.g. compute\r\n        </p>\r\n        <p>\r\n          <code>{`${'{{metric.label.label_name}}'}`}</code> = Metric label metadata e.g. metric.label.instance_name\r\n        </p>\r\n        <p>\r\n          <code>{`${'{{resource.label.label_name}}'}`}</code> = Resource label metadata e.g. resource.label.zone\r\n        </p>\r\n      </pre>\r\n    </div>\r\n  );\r\n};\r\n","import React, { FunctionComponent, Fragment } from 'react';\r\nimport _ from 'lodash';\r\nimport { SelectableValue } from '@grafana/data';\r\nimport { Segment } from '@grafana/ui';\r\nimport { labelsToGroupedOptions, toOption } from '../functions';\r\nimport { Filter } from '../types';\r\n\r\nexport interface Props {\r\n  labels: { [key: string]: string[] };\r\n  filters: string[];\r\n  onChange: (filters: string[]) => void;\r\n  variableOptionGroup: SelectableValue<string>;\r\n}\r\n\r\nconst removeText = '-- remove filter --';\r\nconst removeOption: SelectableValue<string> = { label: removeText, value: removeText, icon: 'fa fa-remove' };\r\nconst operators = ['=', '!=', '=~', '!=~'];\r\nconst filtersToStringArray = (filters: Filter[]) =>\r\n  _.flatten(filters.map(({ key, operator, value, condition }) => [key, operator, value, condition]));\r\n\r\nconst stringArrayToFilters = (filterArray: string[]) =>\r\n  _.chunk(filterArray, 4).map(([key, operator, value, condition = 'AND']) => ({\r\n    key,\r\n    operator,\r\n    value,\r\n    condition,\r\n  }));\r\n\r\nexport const Filters: FunctionComponent<Props> = ({\r\n  labels = {},\r\n  filters: filterArray,\r\n  onChange,\r\n  variableOptionGroup,\r\n}) => {\r\n  const filters = stringArrayToFilters(filterArray);\r\n\r\n  const options = [removeOption, variableOptionGroup, ...labelsToGroupedOptions(Object.keys(labels))];\r\n\r\n  return (\r\n    <div className=\"gf-form-inline\">\r\n      <label className=\"gf-form-label query-keyword width-9\">Filter</label>\r\n      {filters.map(({ key, operator, value, condition }, index) => (\r\n        <Fragment key={index}>\r\n          <Segment\r\n            allowCustomValue\r\n            value={key}\r\n            options={options}\r\n            onChange={({ value: key }) => {\r\n              if (key === removeText) {\r\n                onChange(filtersToStringArray(filters.filter((_, i) => i !== index)));\r\n              } else {\r\n                onChange(\r\n                  filtersToStringArray(\r\n                    filters.map((f, i) => (i === index ? { key, operator, condition, value: '' } : f))\r\n                  )\r\n                );\r\n              }\r\n            }}\r\n          />\r\n          <Segment\r\n            value={operator}\r\n            className=\"gf-form-label query-segment-operator\"\r\n            options={operators.map(toOption)}\r\n            onChange={({ value: operator }) =>\r\n              onChange(filtersToStringArray(filters.map((f, i) => (i === index ? { ...f, operator } : f))))\r\n            }\r\n          />\r\n          <Segment\r\n            allowCustomValue\r\n            value={value}\r\n            placeholder=\"add filter value\"\r\n            options={\r\n              labels.hasOwnProperty(key) ? [variableOptionGroup, ...labels[key].map(toOption)] : [variableOptionGroup]\r\n            }\r\n            onChange={({ value }) =>\r\n              onChange(filtersToStringArray(filters.map((f, i) => (i === index ? { ...f, value } : f))))\r\n            }\r\n          />\r\n          {filters.length > 1 && index + 1 !== filters.length && (\r\n            <label className=\"gf-form-label query-keyword\">{condition}</label>\r\n          )}\r\n        </Fragment>\r\n      ))}\r\n      {Object.values(filters).every(({ value }) => value) && (\r\n        <Segment\r\n          allowCustomValue\r\n          Component={\r\n            <a className=\"gf-form-label query-part\">\r\n              <i className=\"fa fa-plus\" />\r\n            </a>\r\n          }\r\n          options={[variableOptionGroup, ...labelsToGroupedOptions(Object.keys(labels))]}\r\n          onChange={({ value: key }) =>\r\n            onChange(filtersToStringArray([...filters, { key, operator: '=', condition: 'AND', value: '' } as Filter]))\r\n          }\r\n        />\r\n      )}\r\n      <div className=\"gf-form gf-form--grow\">\r\n        <label className=\"gf-form-label gf-form-label--grow\"></label>\r\n      </div>\r\n    </div>\r\n  );\r\n};\r\n","import React, { FunctionComponent } from 'react';\r\nimport { SelectableValue } from '@grafana/data';\r\nimport { Segment } from '@grafana/ui';\r\nimport { labelsToGroupedOptions } from '../functions';\r\nimport { systemLabels } from '../constants';\r\n\r\nexport interface Props {\r\n  values: string[];\r\n  onChange: (values: string[]) => void;\r\n  variableOptionGroup: SelectableValue<string>;\r\n  groupBys: string[];\r\n}\r\n\r\nconst removeText = '-- remove group by --';\r\nconst removeOption: SelectableValue<string> = { label: removeText, value: removeText };\r\n\r\nexport const GroupBys: FunctionComponent<Props> = ({ groupBys = [], values = [], onChange, variableOptionGroup }) => {\r\n  const options = [removeOption, variableOptionGroup, ...labelsToGroupedOptions([...groupBys, ...systemLabels])];\r\n  return (\r\n    <div className=\"gf-form-inline\">\r\n      <label className=\"gf-form-label query-keyword width-9\">Group By</label>\r\n      {values &&\r\n        values.map((value, index) => (\r\n          <Segment\r\n            allowCustomValue\r\n            key={value + index}\r\n            value={value}\r\n            options={options}\r\n            onChange={({ value }) =>\r\n              onChange(\r\n                value === removeText\r\n                  ? values.filter((_, i) => i !== index)\r\n                  : values.map((v, i) => (i === index ? value : v))\r\n              )\r\n            }\r\n          />\r\n        ))}\r\n      {values.length !== groupBys.length && (\r\n        <Segment\r\n          Component={\r\n            <a className=\"gf-form-label query-part\">\r\n              <i className=\"fa fa-plus\" />\r\n            </a>\r\n          }\r\n          allowCustomValue\r\n          onChange={({ value }) => onChange([...values, value])}\r\n          options={[\r\n            variableOptionGroup,\r\n            ...labelsToGroupedOptions([...groupBys.filter(groupBy => !values.includes(groupBy)), ...systemLabels]),\r\n          ]}\r\n        />\r\n      )}\r\n      <div className=\"gf-form gf-form--grow\">\r\n        <label className=\"gf-form-label gf-form-label--grow\"></label>\r\n      </div>\r\n    </div>\r\n  );\r\n};\r\n","import React from 'react';\r\nimport { Project } from './Project';\r\nimport StackdriverDatasource from '../datasource';\r\nimport { MetricDescriptor } from '../types';\r\n\r\nexport interface Props {\r\n  datasource: StackdriverDatasource;\r\n  rawQuery: string;\r\n  lastQueryError: string;\r\n  metricDescriptor?: MetricDescriptor;\r\n}\r\n\r\ninterface State {\r\n  displayHelp: boolean;\r\n  displaRawQuery: boolean;\r\n}\r\n\r\nexport class Help extends React.Component<Props, State> {\r\n  state: State = {\r\n    displayHelp: false,\r\n    displaRawQuery: false,\r\n  };\r\n\r\n  onHelpClicked = () => {\r\n    this.setState({ displayHelp: !this.state.displayHelp });\r\n  };\r\n\r\n  onRawQueryClicked = () => {\r\n    this.setState({ displaRawQuery: !this.state.displaRawQuery });\r\n  };\r\n\r\n  shouldComponentUpdate(nextProps: Props) {\r\n    return nextProps.metricDescriptor !== null;\r\n  }\r\n\r\n  render() {\r\n    const { displayHelp, displaRawQuery } = this.state;\r\n    const { datasource, rawQuery, lastQueryError } = this.props;\r\n\r\n    return (\r\n      <>\r\n        <div className=\"gf-form-inline\">\r\n          <Project datasource={datasource} />\r\n          <div className=\"gf-form\" onClick={this.onHelpClicked}>\r\n            <label className=\"gf-form-label query-keyword pointer\">\r\n              Show Help <i className={`fa fa-caret-${displayHelp ? 'down' : 'right'}`} />\r\n            </label>\r\n          </div>\r\n\r\n          {rawQuery && (\r\n            <div className=\"gf-form\" onClick={this.onRawQueryClicked}>\r\n              <label className=\"gf-form-label query-keyword\">\r\n                Raw Query <i className={`fa fa-caret-${displaRawQuery ? 'down' : 'right'}`} ng-show=\"ctrl.showHelp\" />\r\n              </label>\r\n            </div>\r\n          )}\r\n\r\n          <div className=\"gf-form gf-form--grow\">\r\n            <div className=\"gf-form-label gf-form-label--grow\" />\r\n          </div>\r\n        </div>\r\n        {rawQuery && displaRawQuery && (\r\n          <div className=\"gf-form\">\r\n            <pre className=\"gf-form-pre\">{rawQuery}</pre>\r\n          </div>\r\n        )}\r\n\r\n        {displayHelp && (\r\n          <div className=\"gf-form grafana-info-box\" style={{ padding: 0 }}>\r\n            <pre className=\"gf-form-pre alert alert-info\" style={{ marginRight: 0 }}>\r\n              <h5>Alias Patterns</h5>Format the legend keys any way you want by using alias patterns. Format the legend\r\n              keys any way you want by using alias patterns.\r\n              <br /> <br />\r\n              Example:\r\n              <code>{`${'{{metricDescriptor.name}} - {{metricDescriptor.label.instance_name}}'}`}</code>\r\n              <br />\r\n              Result: &nbsp;&nbsp;<code>cpu/usage_time - server1-europe-west-1</code>\r\n              <br />\r\n              <br />\r\n              <strong>Patterns</strong>\r\n              <br />\r\n              <ul>\r\n                <li>\r\n                  <code>{`${'{{metricDescriptor.type}}'}`}</code> = metric type e.g.\r\n                  compute.googleapis.com/instance/cpu/usage_time\r\n                </li>\r\n                <li>\r\n                  <code>{`${'{{metricDescriptor.name}}'}`}</code> = name part of metric e.g. instance/cpu/usage_time\r\n                </li>\r\n                <li>\r\n                  <code>{`${'{{metricDescriptor.service}}'}`}</code> = service part of metric e.g. compute\r\n                </li>\r\n                <li>\r\n                  <code>{`${'{{metricDescriptor.label.label_name}}'}`}</code> = Metric label metadata e.g.\r\n                  metricDescriptor.label.instance_name\r\n                </li>\r\n                <li>\r\n                  <code>{`${'{{resource.label.label_name}}'}`}</code> = Resource label metadata e.g. resource.label.zone\r\n                </li>\r\n                <li>\r\n                  <code>{`${'{{metadata.system_labels.name}}'}`}</code> = Meta data system labels e.g.\r\n                  metadata.system_labels.name. For this to work, the needs to be included in the group by\r\n                </li>\r\n                <li>\r\n                  <code>{`${'{{metadata.user_labels.name}}'}`}</code> = Meta data user labels e.g.\r\n                  metadata.user_labels.name. For this to work, the needs to be included in the group by\r\n                </li>\r\n                <li>\r\n                  <code>{`${'{{bucket}}'}`}</code> = bucket boundary for distribution metrics when using a heatmap in\r\n                  Grafana\r\n                </li>\r\n              </ul>\r\n            </pre>\r\n          </div>\r\n        )}\r\n\r\n        {lastQueryError && (\r\n          <div className=\"gf-form\">\r\n            <pre className=\"gf-form-pre alert alert-error\">{lastQueryError}</pre>\r\n          </div>\r\n        )}\r\n      </>\r\n    );\r\n  }\r\n}\r\n","import React from 'react';\r\nimport _ from 'lodash';\r\n\r\nimport { TemplateSrv } from 'app/features/templating/template_srv';\r\nimport { SelectableValue } from '@grafana/data';\r\nimport StackdriverDatasource from '../datasource';\r\nimport appEvents from 'app/core/app_events';\r\nimport { Segment } from '@grafana/ui';\r\nimport { MetricDescriptor } from '../types';\r\nimport { CoreEvents } from 'app/types';\r\n\r\nexport interface Props {\r\n  onChange: (metricDescriptor: MetricDescriptor) => void;\r\n  templateSrv: TemplateSrv;\r\n  templateVariableOptions: Array<SelectableValue<string>>;\r\n  datasource: StackdriverDatasource;\r\n  defaultProject: string;\r\n  metricType: string;\r\n  children?: (renderProps: any) => JSX.Element;\r\n}\r\n\r\ninterface State {\r\n  metricDescriptors: MetricDescriptor[];\r\n  metrics: any[];\r\n  services: any[];\r\n  service: string;\r\n  metric: string;\r\n  metricDescriptor: MetricDescriptor;\r\n  defaultProject: string;\r\n}\r\n\r\nexport class Metrics extends React.Component<Props, State> {\r\n  state: State = {\r\n    metricDescriptors: [],\r\n    metrics: [],\r\n    services: [],\r\n    service: '',\r\n    metric: '',\r\n    metricDescriptor: null,\r\n    defaultProject: '',\r\n  };\r\n\r\n  constructor(props: Props) {\r\n    super(props);\r\n  }\r\n\r\n  componentDidMount() {\r\n    this.setState({ defaultProject: this.props.defaultProject }, () => {\r\n      this.getCurrentProject()\r\n        .then(this.loadMetricDescriptors.bind(this))\r\n        .then(this.initializeServiceAndMetrics.bind(this));\r\n    });\r\n  }\r\n\r\n  async getCurrentProject() {\r\n    return new Promise(async (resolve, reject) => {\r\n      try {\r\n        if (!this.state.defaultProject || this.state.defaultProject === 'loading project...') {\r\n          const defaultProject = await this.props.datasource.getDefaultProject();\r\n          this.setState({ defaultProject });\r\n        }\r\n        resolve(this.state.defaultProject);\r\n      } catch (error) {\r\n        appEvents.emit(CoreEvents.dsRequestError, error);\r\n        reject();\r\n      }\r\n    });\r\n  }\r\n\r\n  async loadMetricDescriptors() {\r\n    if (this.state.defaultProject !== 'loading project...') {\r\n      const metricDescriptors = await this.props.datasource.getMetricTypes(this.state.defaultProject);\r\n      this.setState({ metricDescriptors });\r\n      return metricDescriptors;\r\n    } else {\r\n      return [];\r\n    }\r\n  }\r\n\r\n  async initializeServiceAndMetrics() {\r\n    const { metricDescriptors } = this.state;\r\n    const services = this.getServicesList(metricDescriptors);\r\n    const metrics = this.getMetricsList(metricDescriptors);\r\n    const service = metrics.length > 0 ? metrics[0].service : '';\r\n    const metricDescriptor = this.getSelectedMetricDescriptor(this.props.metricType);\r\n    this.setState({ metricDescriptors, services, metrics, service: service, metricDescriptor });\r\n  }\r\n\r\n  getSelectedMetricDescriptor(metricType: string) {\r\n    return this.state.metricDescriptors.find(md => md.type === this.props.templateSrv.replace(metricType));\r\n  }\r\n\r\n  getMetricsList(metricDescriptors: MetricDescriptor[]) {\r\n    const selectedMetricDescriptor = this.getSelectedMetricDescriptor(this.props.metricType);\r\n    if (!selectedMetricDescriptor) {\r\n      return [];\r\n    }\r\n    const metricsByService = metricDescriptors\r\n      .filter(m => m.service === selectedMetricDescriptor.service)\r\n      .map(m => ({\r\n        service: m.service,\r\n        value: m.type,\r\n        label: m.displayName,\r\n        description: m.description,\r\n      }));\r\n    return metricsByService;\r\n  }\r\n\r\n  onServiceChange = ({ value: service }: any) => {\r\n    const { metricDescriptors } = this.state;\r\n    const { metricType, templateSrv } = this.props;\r\n\r\n    const metrics = metricDescriptors\r\n      .filter(m => m.service === templateSrv.replace(service))\r\n      .map(m => ({\r\n        service: m.service,\r\n        value: m.type,\r\n        label: m.displayName,\r\n        description: m.description,\r\n      }));\r\n\r\n    this.setState({ service, metrics });\r\n\r\n    if (metrics.length > 0 && !metrics.some(m => m.value === templateSrv.replace(metricType))) {\r\n      this.onMetricTypeChange(metrics[0]);\r\n    }\r\n  };\r\n\r\n  onMetricTypeChange = ({ value }: any) => {\r\n    const metricDescriptor = this.getSelectedMetricDescriptor(value);\r\n    this.setState({ metricDescriptor });\r\n    this.props.onChange({ ...metricDescriptor, type: value });\r\n  };\r\n\r\n  getServicesList(metricDescriptors: MetricDescriptor[]) {\r\n    const services = metricDescriptors.map(m => ({\r\n      value: m.service,\r\n      label: _.startCase(m.serviceShortName),\r\n    }));\r\n\r\n    return services.length > 0 ? _.uniqBy(services, s => s.value) : [];\r\n  }\r\n\r\n  render() {\r\n    const { services, service, metrics } = this.state;\r\n    const { metricType, templateVariableOptions } = this.props;\r\n\r\n    return (\r\n      <>\r\n        <div className=\"gf-form-inline\">\r\n          <span className=\"gf-form-label width-9 query-keyword\">Service</span>\r\n          <Segment\r\n            onChange={this.onServiceChange}\r\n            value={[...services, ...templateVariableOptions].find(s => s.value === service)}\r\n            options={[\r\n              {\r\n                label: 'Template Variables',\r\n                options: templateVariableOptions,\r\n              },\r\n              ...services,\r\n            ]}\r\n            placeholder=\"Select Services\"\r\n          ></Segment>\r\n          <div className=\"gf-form gf-form--grow\">\r\n            <div className=\"gf-form-label gf-form-label--grow\" />\r\n          </div>\r\n        </div>\r\n        <div className=\"gf-form-inline\">\r\n          <span className=\"gf-form-label width-9 query-keyword\">Metric</span>\r\n\r\n          <Segment\r\n            className=\"query-part\"\r\n            onChange={this.onMetricTypeChange}\r\n            value={[...metrics, ...templateVariableOptions].find(s => s.value === metricType)}\r\n            options={[\r\n              {\r\n                label: 'Template Variables',\r\n                options: templateVariableOptions,\r\n              },\r\n              ...metrics,\r\n            ]}\r\n            placeholder=\"Select Metric\"\r\n          ></Segment>\r\n          <div className=\"gf-form gf-form--grow\">\r\n            <div className=\"gf-form-label gf-form-label--grow\" />\r\n          </div>\r\n        </div>\r\n        {this.props.children(this.state.metricDescriptor)}\r\n      </>\r\n    );\r\n  }\r\n}\r\n","import React from 'react';\r\nimport { Input } from '@grafana/ui';\r\nimport StackdriverDatasource from '../datasource';\r\n\r\nexport interface Props {\r\n  datasource: StackdriverDatasource;\r\n}\r\n\r\ninterface State {\r\n  projectName: string;\r\n}\r\n\r\nexport class Project extends React.Component<Props, State> {\r\n  state: State = {\r\n    projectName: 'Loading project...',\r\n  };\r\n\r\n  async componentDidMount() {\r\n    const projectName = await this.props.datasource.getDefaultProject();\r\n    this.setState({ projectName });\r\n  }\r\n\r\n  render() {\r\n    const { projectName } = this.state;\r\n    return (\r\n      <div className=\"gf-form\">\r\n        <span className=\"gf-form-label width-9 query-keyword\">Project</span>\r\n        <Input className=\"gf-form-input width-15\" disabled type=\"text\" value={projectName} />\r\n      </div>\r\n    );\r\n  }\r\n}\r\n","import React from 'react';\r\nimport _ from 'lodash';\r\n\r\nimport { TemplateSrv } from 'app/features/templating/template_srv';\r\n\r\nimport { Aggregations, Metrics, Filters, GroupBys, Alignments, AlignmentPeriods, AliasBy, Help } from './';\r\nimport { StackdriverQuery, MetricDescriptor } from '../types';\r\nimport { getAlignmentPickerData, toOption } from '../functions';\r\nimport StackdriverDatasource from '../datasource';\r\nimport { TimeSeries, SelectableValue } from '@grafana/data';\r\nimport { PanelEvents } from '@grafana/data';\r\n\r\nexport interface Props {\r\n  onQueryChange: (target: StackdriverQuery) => void;\r\n  onExecuteQuery: () => void;\r\n  target: StackdriverQuery;\r\n  events: any;\r\n  datasource: StackdriverDatasource;\r\n  templateSrv: TemplateSrv;\r\n}\r\n\r\ninterface State extends StackdriverQuery {\r\n  variableOptions: Array<SelectableValue<string>>;\r\n  variableOptionGroup: SelectableValue<string>;\r\n  alignOptions: Array<SelectableValue<string>>;\r\n  lastQuery: string;\r\n  lastQueryError: string;\r\n  labels: any;\r\n  [key: string]: any;\r\n}\r\n\r\nexport const DefaultTarget: State = {\r\n  defaultProject: 'loading project...',\r\n  metricType: '',\r\n  metricKind: '',\r\n  valueType: '',\r\n  refId: '',\r\n  service: '',\r\n  unit: '',\r\n  crossSeriesReducer: 'REDUCE_MEAN',\r\n  alignmentPeriod: 'stackdriver-auto',\r\n  perSeriesAligner: 'ALIGN_MEAN',\r\n  groupBys: [],\r\n  filters: [],\r\n  filter: [],\r\n  aliasBy: '',\r\n  alignOptions: [],\r\n  lastQuery: '',\r\n  lastQueryError: '',\r\n  usedAlignmentPeriod: '',\r\n  labels: {},\r\n  variableOptionGroup: {},\r\n  variableOptions: [],\r\n};\r\n\r\nexport class QueryEditor extends React.Component<Props, State> {\r\n  state: State = DefaultTarget;\r\n\r\n  async componentDidMount() {\r\n    const { events, target, templateSrv, datasource } = this.props;\r\n    events.on(PanelEvents.dataReceived, this.onDataReceived.bind(this));\r\n    events.on(PanelEvents.dataError, this.onDataError.bind(this));\r\n    const { perSeriesAligner, alignOptions } = getAlignmentPickerData(target, templateSrv);\r\n    const variableOptionGroup = {\r\n      label: 'Template Variables',\r\n      expanded: false,\r\n      options: datasource.variables.map(toOption),\r\n    };\r\n    this.setState({\r\n      ...this.props.target,\r\n      alignOptions,\r\n      perSeriesAligner,\r\n      variableOptionGroup,\r\n      variableOptions: variableOptionGroup.options,\r\n    });\r\n\r\n    datasource.getLabels(target.metricType, target.refId, target.groupBys).then(labels => this.setState({ labels }));\r\n  }\r\n\r\n  componentWillUnmount() {\r\n    this.props.events.off(PanelEvents.dataReceived, this.onDataReceived);\r\n    this.props.events.off(PanelEvents.dataError, this.onDataError);\r\n  }\r\n\r\n  onDataReceived(dataList: TimeSeries[]) {\r\n    const series = dataList.find((item: any) => item.refId === this.props.target.refId);\r\n    if (series) {\r\n      this.setState({\r\n        lastQuery: decodeURIComponent(series.meta.rawQuery),\r\n        lastQueryError: '',\r\n        usedAlignmentPeriod: series.meta.alignmentPeriod,\r\n      });\r\n    }\r\n  }\r\n\r\n  onDataError(err: any) {\r\n    let lastQuery;\r\n    let lastQueryError;\r\n    if (err.data && err.data.error) {\r\n      lastQueryError = this.props.datasource.formatStackdriverError(err);\r\n    } else if (err.data && err.data.results) {\r\n      const queryRes = err.data.results[this.props.target.refId];\r\n      lastQuery = decodeURIComponent(queryRes.meta.rawQuery);\r\n      if (queryRes && queryRes.error) {\r\n        try {\r\n          lastQueryError = JSON.parse(queryRes.error).error.message;\r\n        } catch {\r\n          lastQueryError = queryRes.error;\r\n        }\r\n      }\r\n    }\r\n    this.setState({ lastQuery, lastQueryError });\r\n  }\r\n\r\n  onMetricTypeChange = async ({ valueType, metricKind, type, unit }: MetricDescriptor) => {\r\n    const { templateSrv, onQueryChange, onExecuteQuery, target } = this.props;\r\n    const { perSeriesAligner, alignOptions } = getAlignmentPickerData(\r\n      { valueType, metricKind, perSeriesAligner: this.state.perSeriesAligner },\r\n      templateSrv\r\n    );\r\n    const labels = await this.props.datasource.getLabels(type, target.refId, target.groupBys);\r\n    this.setState(\r\n      {\r\n        alignOptions,\r\n        perSeriesAligner,\r\n        metricType: type,\r\n        unit,\r\n        valueType,\r\n        metricKind,\r\n        labels,\r\n      },\r\n      () => {\r\n        onQueryChange(this.state);\r\n        onExecuteQuery();\r\n      }\r\n    );\r\n  };\r\n\r\n  onGroupBysChange(value: string[]) {\r\n    const { target, datasource } = this.props;\r\n    this.setState({ groupBys: value }, () => {\r\n      this.props.onQueryChange(this.state);\r\n      this.props.onExecuteQuery();\r\n    });\r\n    datasource.getLabels(target.metricType, target.refId, value).then(labels => this.setState({ labels }));\r\n  }\r\n\r\n  onPropertyChange(prop: string, value: string[]) {\r\n    this.setState({ [prop]: value }, () => {\r\n      this.props.onQueryChange(this.state);\r\n      this.props.onExecuteQuery();\r\n    });\r\n  }\r\n\r\n  render() {\r\n    const {\r\n      usedAlignmentPeriod,\r\n      defaultProject,\r\n      metricType,\r\n      crossSeriesReducer,\r\n      groupBys,\r\n      filters,\r\n      perSeriesAligner,\r\n      alignOptions,\r\n      alignmentPeriod,\r\n      aliasBy,\r\n      lastQuery,\r\n      lastQueryError,\r\n      labels,\r\n      variableOptionGroup,\r\n      variableOptions,\r\n    } = this.state;\r\n    const { datasource, templateSrv } = this.props;\r\n\r\n    return (\r\n      <>\r\n        <Metrics\r\n          templateSrv={templateSrv}\r\n          defaultProject={defaultProject}\r\n          metricType={metricType}\r\n          templateVariableOptions={variableOptions}\r\n          datasource={datasource}\r\n          onChange={this.onMetricTypeChange}\r\n        >\r\n          {metric => (\r\n            <>\r\n              <Filters\r\n                labels={labels}\r\n                filters={filters}\r\n                onChange={value => this.onPropertyChange('filters', value)}\r\n                variableOptionGroup={variableOptionGroup}\r\n              />\r\n              <GroupBys\r\n                groupBys={Object.keys(labels)}\r\n                values={groupBys}\r\n                onChange={this.onGroupBysChange.bind(this)}\r\n                variableOptionGroup={variableOptionGroup}\r\n              />\r\n              <Aggregations\r\n                metricDescriptor={metric}\r\n                templateVariableOptions={variableOptions}\r\n                crossSeriesReducer={crossSeriesReducer}\r\n                groupBys={groupBys}\r\n                onChange={value => this.onPropertyChange('crossSeriesReducer', value)}\r\n              >\r\n                {displayAdvancedOptions =>\r\n                  displayAdvancedOptions && (\r\n                    <Alignments\r\n                      alignOptions={alignOptions}\r\n                      templateVariableOptions={variableOptions}\r\n                      perSeriesAligner={perSeriesAligner}\r\n                      onChange={value => this.onPropertyChange('perSeriesAligner', value)}\r\n                    />\r\n                  )\r\n                }\r\n              </Aggregations>\r\n              <AlignmentPeriods\r\n                templateSrv={templateSrv}\r\n                templateVariableOptions={variableOptions}\r\n                alignmentPeriod={alignmentPeriod}\r\n                perSeriesAligner={perSeriesAligner}\r\n                usedAlignmentPeriod={usedAlignmentPeriod}\r\n                onChange={value => this.onPropertyChange('alignmentPeriod', value)}\r\n              />\r\n              <AliasBy value={aliasBy} onChange={value => this.onPropertyChange('aliasBy', value)} />\r\n              <Help datasource={datasource} rawQuery={lastQuery} lastQueryError={lastQueryError} />\r\n            </>\r\n          )}\r\n        </Metrics>\r\n      </>\r\n    );\r\n  }\r\n}\r\n","import React, { ChangeEvent, FC } from 'react';\r\n\r\ninterface Props {\r\n  onValueChange: (e: ChangeEvent<HTMLSelectElement>) => void;\r\n  options: any[];\r\n  value: string;\r\n  label: string;\r\n}\r\n\r\nexport const SimpleSelect: FC<Props> = props => {\r\n  const { label, onValueChange, value, options } = props;\r\n  return (\r\n    <div className=\"gf-form max-width-21\">\r\n      <span className=\"gf-form-label width-10 query-keyword\">{label}</span>\r\n      <div className=\"gf-form-select-wrapper max-width-12\">\r\n        <select className=\"gf-form-input\" required onChange={onValueChange} value={value}>\r\n          {options.map(({ value, name }, i) => (\r\n            <option key={i} value={value}>\r\n              {name}\r\n            </option>\r\n          ))}\r\n        </select>\r\n      </div>\r\n    </div>\r\n  );\r\n};\r\n","export { Project } from './Project';\r\nexport { Metrics } from './Metrics';\r\nexport { Help } from './Help';\r\nexport { GroupBys } from './GroupBys';\r\nexport { Filters } from './Filters';\r\nexport { AnnotationsHelp } from './AnnotationsHelp';\r\nexport { Alignments } from './Alignments';\r\nexport { AlignmentPeriods } from './AlignmentPeriods';\r\nexport { AliasBy } from './AliasBy';\r\nexport { Aggregations } from './Aggregations';\r\nexport { SimpleSelect } from './SimpleSelect';\r\n","export enum MetricKind {\r\n  METRIC_KIND_UNSPECIFIED = 'METRIC_KIND_UNSPECIFIED',\r\n  GAUGE = 'GAUGE',\r\n  DELTA = 'DELTA',\r\n  CUMULATIVE = 'CUMULATIVE',\r\n}\r\n\r\nexport enum ValueTypes {\r\n  VALUE_TYPE_UNSPECIFIED = 'VALUE_TYPE_UNSPECIFIED',\r\n  BOOL = 'BOOL',\r\n  INT64 = 'INT64',\r\n  DOUBLE = 'DOUBLE',\r\n  STRING = 'STRING',\r\n  DISTRIBUTION = 'DISTRIBUTION',\r\n  MONEY = 'MONEY',\r\n}\r\n\r\nexport const alignOptions = [\r\n  {\r\n    text: 'delta',\r\n    value: 'ALIGN_DELTA',\r\n    valueTypes: [ValueTypes.INT64, ValueTypes.DOUBLE, ValueTypes.MONEY, ValueTypes.DISTRIBUTION],\r\n    metricKinds: [MetricKind.CUMULATIVE, MetricKind.DELTA],\r\n  },\r\n  {\r\n    text: 'rate',\r\n    value: 'ALIGN_RATE',\r\n    valueTypes: [ValueTypes.INT64, ValueTypes.DOUBLE, ValueTypes.MONEY],\r\n    metricKinds: [MetricKind.CUMULATIVE, MetricKind.DELTA],\r\n  },\r\n  {\r\n    text: 'interpolate',\r\n    value: 'ALIGN_INTERPOLATE',\r\n    valueTypes: [ValueTypes.INT64, ValueTypes.DOUBLE, ValueTypes.MONEY],\r\n    metricKinds: [MetricKind.GAUGE],\r\n  },\r\n  {\r\n    text: 'next older',\r\n    value: 'ALIGN_NEXT_OLDER',\r\n    valueTypes: [\r\n      ValueTypes.INT64,\r\n      ValueTypes.DOUBLE,\r\n      ValueTypes.MONEY,\r\n      ValueTypes.DISTRIBUTION,\r\n      ValueTypes.STRING,\r\n      ValueTypes.VALUE_TYPE_UNSPECIFIED,\r\n      ValueTypes.BOOL,\r\n    ],\r\n    metricKinds: [MetricKind.GAUGE],\r\n  },\r\n  {\r\n    text: 'min',\r\n    value: 'ALIGN_MIN',\r\n    valueTypes: [ValueTypes.INT64, ValueTypes.DOUBLE, ValueTypes.MONEY],\r\n    metricKinds: [MetricKind.GAUGE, MetricKind.DELTA],\r\n  },\r\n  {\r\n    text: 'max',\r\n    value: 'ALIGN_MAX',\r\n    valueTypes: [ValueTypes.INT64, ValueTypes.DOUBLE, ValueTypes.MONEY],\r\n    metricKinds: [MetricKind.GAUGE, MetricKind.DELTA],\r\n  },\r\n  {\r\n    text: 'mean',\r\n    value: 'ALIGN_MEAN',\r\n    valueTypes: [ValueTypes.INT64, ValueTypes.DOUBLE, ValueTypes.MONEY],\r\n    metricKinds: [MetricKind.GAUGE, MetricKind.DELTA],\r\n  },\r\n  {\r\n    text: 'count',\r\n    value: 'ALIGN_COUNT',\r\n    valueTypes: [ValueTypes.INT64, ValueTypes.DOUBLE, ValueTypes.MONEY, ValueTypes.BOOL],\r\n    metricKinds: [MetricKind.GAUGE, MetricKind.DELTA],\r\n  },\r\n  {\r\n    text: 'sum',\r\n    value: 'ALIGN_SUM',\r\n    valueTypes: [ValueTypes.INT64, ValueTypes.DOUBLE, ValueTypes.MONEY, ValueTypes.DISTRIBUTION],\r\n    metricKinds: [MetricKind.GAUGE, MetricKind.DELTA],\r\n  },\r\n  {\r\n    text: 'stddev',\r\n    value: 'ALIGN_STDDEV',\r\n    valueTypes: [ValueTypes.INT64, ValueTypes.DOUBLE, ValueTypes.MONEY],\r\n    metricKinds: [MetricKind.GAUGE, MetricKind.DELTA],\r\n  },\r\n  {\r\n    text: 'count true',\r\n    value: 'ALIGN_COUNT_TRUE',\r\n    valueTypes: [ValueTypes.BOOL],\r\n    metricKinds: [MetricKind.GAUGE],\r\n  },\r\n  {\r\n    text: 'count false',\r\n    value: 'ALIGN_COUNT_FALSE',\r\n    valueTypes: [ValueTypes.BOOL],\r\n    metricKinds: [MetricKind.GAUGE],\r\n  },\r\n  {\r\n    text: 'fraction true',\r\n    value: 'ALIGN_FRACTION_TRUE',\r\n    valueTypes: [ValueTypes.BOOL],\r\n    metricKinds: [MetricKind.GAUGE],\r\n  },\r\n  {\r\n    text: 'percentile 99',\r\n    value: 'ALIGN_PERCENTILE_99',\r\n    valueTypes: [ValueTypes.DISTRIBUTION],\r\n    metricKinds: [MetricKind.GAUGE, MetricKind.DELTA],\r\n  },\r\n  {\r\n    text: 'percentile 95',\r\n    value: 'ALIGN_PERCENTILE_95',\r\n    valueTypes: [ValueTypes.DISTRIBUTION],\r\n    metricKinds: [MetricKind.GAUGE, MetricKind.DELTA],\r\n  },\r\n  {\r\n    text: 'percentile 50',\r\n    value: 'ALIGN_PERCENTILE_50',\r\n    valueTypes: [ValueTypes.DISTRIBUTION],\r\n    metricKinds: [MetricKind.GAUGE, MetricKind.DELTA],\r\n  },\r\n  {\r\n    text: 'percentile 05',\r\n    value: 'ALIGN_PERCENTILE_05',\r\n    valueTypes: [ValueTypes.DISTRIBUTION],\r\n    metricKinds: [MetricKind.GAUGE, MetricKind.DELTA],\r\n  },\r\n  {\r\n    text: 'percent change',\r\n    value: 'ALIGN_PERCENT_CHANGE',\r\n    valueTypes: [ValueTypes.INT64, ValueTypes.DOUBLE, ValueTypes.MONEY],\r\n    metricKinds: [MetricKind.GAUGE, MetricKind.DELTA],\r\n  },\r\n];\r\n\r\nexport const aggOptions = [\r\n  {\r\n    text: 'none',\r\n    value: 'REDUCE_NONE',\r\n    valueTypes: [\r\n      ValueTypes.INT64,\r\n      ValueTypes.DOUBLE,\r\n      ValueTypes.MONEY,\r\n      ValueTypes.DISTRIBUTION,\r\n      ValueTypes.BOOL,\r\n      ValueTypes.STRING,\r\n    ],\r\n    metricKinds: [MetricKind.GAUGE, MetricKind.DELTA, MetricKind.CUMULATIVE, MetricKind.METRIC_KIND_UNSPECIFIED],\r\n  },\r\n  {\r\n    text: 'mean',\r\n    value: 'REDUCE_MEAN',\r\n    valueTypes: [ValueTypes.INT64, ValueTypes.DOUBLE, ValueTypes.MONEY, ValueTypes.DISTRIBUTION],\r\n    metricKinds: [MetricKind.GAUGE, MetricKind.DELTA],\r\n  },\r\n  {\r\n    text: 'min',\r\n    value: 'REDUCE_MIN',\r\n    valueTypes: [ValueTypes.INT64, ValueTypes.DOUBLE, ValueTypes.MONEY],\r\n    metricKinds: [MetricKind.GAUGE, MetricKind.DELTA, MetricKind.CUMULATIVE, MetricKind.METRIC_KIND_UNSPECIFIED],\r\n  },\r\n  {\r\n    text: 'max',\r\n    value: 'REDUCE_MAX',\r\n    valueTypes: [ValueTypes.INT64, ValueTypes.DOUBLE, ValueTypes.MONEY],\r\n    metricKinds: [MetricKind.GAUGE, MetricKind.DELTA, MetricKind.CUMULATIVE, MetricKind.METRIC_KIND_UNSPECIFIED],\r\n  },\r\n  {\r\n    text: 'sum',\r\n    value: 'REDUCE_SUM',\r\n    valueTypes: [ValueTypes.INT64, ValueTypes.DOUBLE, ValueTypes.MONEY, ValueTypes.DISTRIBUTION],\r\n    metricKinds: [MetricKind.GAUGE, MetricKind.DELTA, MetricKind.CUMULATIVE, MetricKind.METRIC_KIND_UNSPECIFIED],\r\n  },\r\n  {\r\n    text: 'std. dev.',\r\n    value: 'REDUCE_STDDEV',\r\n    valueTypes: [ValueTypes.INT64, ValueTypes.DOUBLE, ValueTypes.MONEY, ValueTypes.DISTRIBUTION],\r\n    metricKinds: [MetricKind.GAUGE, MetricKind.DELTA, MetricKind.CUMULATIVE, MetricKind.METRIC_KIND_UNSPECIFIED],\r\n  },\r\n  {\r\n    text: 'count',\r\n    value: 'REDUCE_COUNT',\r\n    valueTypes: [\r\n      ValueTypes.INT64,\r\n      ValueTypes.DOUBLE,\r\n      ValueTypes.MONEY,\r\n      ValueTypes.DISTRIBUTION,\r\n      ValueTypes.BOOL,\r\n      ValueTypes.STRING,\r\n    ],\r\n    metricKinds: [MetricKind.GAUGE, MetricKind.DELTA, MetricKind.CUMULATIVE],\r\n  },\r\n  {\r\n    text: 'count true',\r\n    value: 'REDUCE_COUNT_TRUE',\r\n    valueTypes: [ValueTypes.BOOL],\r\n    metricKinds: [MetricKind.GAUGE, MetricKind.DELTA],\r\n  },\r\n  {\r\n    text: 'count false',\r\n    value: 'REDUCE_COUNT_FALSE',\r\n    valueTypes: [ValueTypes.BOOL],\r\n    metricKinds: [MetricKind.GAUGE, MetricKind.DELTA],\r\n  },\r\n  {\r\n    text: '99th percentile',\r\n    value: 'REDUCE_PERCENTILE_99',\r\n    valueTypes: [ValueTypes.INT64, ValueTypes.DOUBLE, ValueTypes.MONEY, ValueTypes.DISTRIBUTION],\r\n    metricKinds: [MetricKind.GAUGE, MetricKind.DELTA, MetricKind.CUMULATIVE],\r\n  },\r\n  {\r\n    text: '95th percentile',\r\n    value: 'REDUCE_PERCENTILE_95',\r\n    valueTypes: [ValueTypes.INT64, ValueTypes.DOUBLE, ValueTypes.MONEY, ValueTypes.DISTRIBUTION],\r\n    metricKinds: [MetricKind.GAUGE, MetricKind.DELTA, MetricKind.CUMULATIVE],\r\n  },\r\n  {\r\n    text: '50th percentile',\r\n    value: 'REDUCE_PERCENTILE_50',\r\n    valueTypes: [ValueTypes.INT64, ValueTypes.DOUBLE, ValueTypes.MONEY, ValueTypes.DISTRIBUTION],\r\n    metricKinds: [MetricKind.GAUGE, MetricKind.DELTA, MetricKind.CUMULATIVE],\r\n  },\r\n  {\r\n    text: '5th percentile',\r\n    value: 'REDUCE_PERCENTILE_05',\r\n    valueTypes: [ValueTypes.INT64, ValueTypes.DOUBLE, ValueTypes.MONEY, ValueTypes.DISTRIBUTION],\r\n    metricKinds: [MetricKind.GAUGE, MetricKind.DELTA, MetricKind.CUMULATIVE],\r\n  },\r\n];\r\n\r\nexport const alignmentPeriods = [\r\n  { text: 'grafana auto', value: 'grafana-auto' },\r\n  { text: 'stackdriver auto', value: 'stackdriver-auto' },\r\n  { text: '1m', value: '+60s' },\r\n  { text: '2m', value: '+120s' },\r\n  { text: '5m', value: '+300s' },\r\n  { text: '10m', value: '+600s' },\r\n  { text: '30m', value: '+1800s' },\r\n  { text: '1h', value: '+3600s' },\r\n  { text: '3h', value: '+7200s' },\r\n  { text: '6h', value: '+21600s' },\r\n  { text: '1d', value: '+86400s' },\r\n  { text: '3d', value: '+259200s' },\r\n  { text: '1w', value: '+604800s' },\r\n];\r\n\r\nexport const stackdriverUnitMappings = {\r\n  bit: 'bits',\r\n  By: 'bytes',\r\n  s: 's',\r\n  min: 'm',\r\n  h: 'h',\r\n  d: 'd',\r\n  us: 's',\r\n  ms: 'ms',\r\n  ns: 'ns',\r\n  percent: 'percent',\r\n  MiBy: 'mbytes',\r\n  'By/s': 'Bps',\r\n  GBy: 'decgbytes',\r\n};\r\n\r\nexport const systemLabels = [\r\n  'metadata.system_labels.cloud_account',\r\n  'metadata.system_labels.name',\r\n  'metadata.system_labels.region',\r\n  'metadata.system_labels.state',\r\n  'metadata.system_labels.instance_group',\r\n  'metadata.system_labels.node_name',\r\n  'metadata.system_labels.service_name',\r\n  'metadata.system_labels.top_level_controller_type',\r\n  'metadata.system_labels.top_level_controller_name',\r\n  'metadata.system_labels.container_image',\r\n];\r\n","import _ from 'lodash';\r\nimport { alignOptions, aggOptions, ValueTypes, MetricKind, systemLabels } from './constants';\r\nimport { SelectableValue } from '@grafana/data';\r\nimport { TemplateSrv } from 'app/features/templating/template_srv';\r\nimport { StackdriverQuery } from './types';\r\n\r\nexport const extractServicesFromMetricDescriptors = (metricDescriptors: any) => _.uniqBy(metricDescriptors, 'service');\r\n\r\nexport const getMetricTypesByService = (metricDescriptors: any, service: any) =>\r\n  metricDescriptors.filter((m: any) => m.service === service);\r\n\r\nexport const getMetricTypes = (\r\n  metricDescriptors: any[],\r\n  metricType: string,\r\n  interpolatedMetricType: any,\r\n  selectedService: any\r\n) => {\r\n  const metricTypes = getMetricTypesByService(metricDescriptors, selectedService).map((m: any) => ({\r\n    value: m.type,\r\n    name: m.displayName,\r\n  }));\r\n  const metricTypeExistInArray = metricTypes.some((m: any) => m.value === interpolatedMetricType);\r\n  const selectedMetricType = metricTypeExistInArray ? metricType : metricTypes[0].value;\r\n  return {\r\n    metricTypes,\r\n    selectedMetricType,\r\n  };\r\n};\r\n\r\nexport const getAlignmentOptionsByMetric = (metricValueType: any, metricKind: any) => {\r\n  return !metricValueType\r\n    ? []\r\n    : alignOptions.filter(i => {\r\n        return i.valueTypes.indexOf(metricValueType) !== -1 && i.metricKinds.indexOf(metricKind) !== -1;\r\n      });\r\n};\r\n\r\nexport const getAggregationOptionsByMetric = (valueType: ValueTypes, metricKind: MetricKind) => {\r\n  return !metricKind\r\n    ? []\r\n    : aggOptions.filter(i => {\r\n        return i.valueTypes.indexOf(valueType) !== -1 && i.metricKinds.indexOf(metricKind) !== -1;\r\n      });\r\n};\r\n\r\nexport const getLabelKeys = async (datasource: any, selectedMetricType: any) => {\r\n  const refId = 'handleLabelKeysQuery';\r\n  const labels = await datasource.getLabels(selectedMetricType, refId);\r\n  return [...Object.keys(labels), ...systemLabels];\r\n};\r\n\r\nexport const getAlignmentPickerData = (\r\n  { valueType, metricKind, perSeriesAligner }: Partial<StackdriverQuery>,\r\n  templateSrv: TemplateSrv\r\n) => {\r\n  const alignOptions = getAlignmentOptionsByMetric(valueType, metricKind).map(option => ({\r\n    ...option,\r\n    label: option.text,\r\n  }));\r\n  if (!alignOptions.some(o => o.value === templateSrv.replace(perSeriesAligner))) {\r\n    perSeriesAligner = alignOptions.length > 0 ? alignOptions[0].value : '';\r\n  }\r\n  return { alignOptions, perSeriesAligner };\r\n};\r\n\r\nexport const labelsToGroupedOptions = (groupBys: string[]) => {\r\n  const groups = groupBys.reduce((acc: any, curr: string) => {\r\n    const arr = curr.split('.').map(_.startCase);\r\n    const group = (arr.length === 2 ? arr : _.initial(arr)).join(' ');\r\n    const option = {\r\n      value: curr,\r\n      label: curr,\r\n    };\r\n    if (acc[group]) {\r\n      acc[group] = [...acc[group], option];\r\n    } else {\r\n      acc[group] = [option];\r\n    }\r\n    return acc;\r\n  }, {});\r\n  return Object.entries(groups).map(([label, options]) => ({ label, options, expanded: true }), []);\r\n};\r\n\r\nexport const toOption = (value: string) => ({ label: value, value } as SelectableValue<string>);\r\n","import _ from 'lodash';\r\nimport alertDef from '../../../features/alerting/state/alertDef';\r\nimport { PanelCtrl } from 'app/plugins/sdk';\r\n\r\nimport { dateMath, dateTime } from '@grafana/data';\r\nimport { PanelEvents } from '@grafana/data';\r\nimport { auto } from 'angular';\r\nimport { BackendSrv } from '@grafana/runtime';\r\n\r\nclass AlertListPanel extends PanelCtrl {\r\n  static templateUrl = 'module.html';\r\n  static scrollable = true;\r\n\r\n  showOptions = [\r\n    { text: 'Current state', value: 'current' },\r\n    { text: 'Recent state changes', value: 'changes' },\r\n  ];\r\n\r\n  sortOrderOptions = [\r\n    { text: 'Alphabetical (asc)', value: 1 },\r\n    { text: 'Alphabetical (desc)', value: 2 },\r\n    { text: 'Importance', value: 3 },\r\n  ];\r\n\r\n  stateFilter: any = {};\r\n  currentAlerts: any = [];\r\n  alertHistory: any = [];\r\n  noAlertsMessage: string;\r\n  templateSrv: string;\r\n\r\n  // Set and populate defaults\r\n  panelDefaults: any = {\r\n    show: 'current',\r\n    limit: 10,\r\n    stateFilter: [],\r\n    onlyAlertsOnDashboard: false,\r\n    sortOrder: 1,\r\n    dashboardFilter: '',\r\n    nameFilter: '',\r\n    folderId: null,\r\n  };\r\n\r\n  /** @ngInject */\r\n  constructor($scope: any, $injector: auto.IInjectorService, private backendSrv: BackendSrv) {\r\n    super($scope, $injector);\r\n    _.defaults(this.panel, this.panelDefaults);\r\n\r\n    this.events.on(PanelEvents.editModeInitialized, this.onInitEditMode.bind(this));\r\n    this.events.on(PanelEvents.refresh, this.onRefresh.bind(this));\r\n    this.templateSrv = this.$injector.get('templateSrv');\r\n\r\n    for (const key in this.panel.stateFilter) {\r\n      this.stateFilter[this.panel.stateFilter[key]] = true;\r\n    }\r\n  }\r\n\r\n  sortResult(alerts: any[]) {\r\n    if (this.panel.sortOrder === 3) {\r\n      return _.sortBy(alerts, a => {\r\n        // @ts-ignore\r\n        return alertDef.alertStateSortScore[a.state];\r\n      });\r\n    }\r\n\r\n    const result = _.sortBy(alerts, a => {\r\n      return a.name.toLowerCase();\r\n    });\r\n    if (this.panel.sortOrder === 2) {\r\n      result.reverse();\r\n    }\r\n\r\n    return result;\r\n  }\r\n\r\n  updateStateFilter() {\r\n    const result = [];\r\n\r\n    for (const key in this.stateFilter) {\r\n      if (this.stateFilter[key]) {\r\n        result.push(key);\r\n      }\r\n    }\r\n\r\n    this.panel.stateFilter = result;\r\n    this.onRefresh();\r\n  }\r\n\r\n  onRefresh() {\r\n    let getAlertsPromise;\r\n\r\n    if (this.panel.show === 'current') {\r\n      getAlertsPromise = this.getCurrentAlertState();\r\n    }\r\n\r\n    if (this.panel.show === 'changes') {\r\n      getAlertsPromise = this.getStateChanges();\r\n    }\r\n\r\n    getAlertsPromise.then(() => {\r\n      this.renderingCompleted();\r\n    });\r\n  }\r\n\r\n  onFolderChange(folder: any) {\r\n    this.panel.folderId = folder.id;\r\n    this.refresh();\r\n  }\r\n\r\n  getStateChanges() {\r\n    const params: any = {\r\n      limit: this.panel.limit,\r\n      type: 'alert',\r\n      newState: this.panel.stateFilter,\r\n    };\r\n\r\n    if (this.panel.onlyAlertsOnDashboard) {\r\n      params.dashboardId = this.dashboard.id;\r\n    }\r\n\r\n    params.from = dateMath.parse(this.dashboard.time.from).unix() * 1000;\r\n    params.to = dateMath.parse(this.dashboard.time.to).unix() * 1000;\r\n\r\n    return this.backendSrv.get(`/api/annotations`, params).then(res => {\r\n      this.alertHistory = _.map(res, al => {\r\n        al.time = this.dashboard.formatDate(al.time, 'MMM D, YYYY HH:mm:ss');\r\n        al.stateModel = alertDef.getStateDisplayModel(al.newState);\r\n        al.info = alertDef.getAlertAnnotationInfo(al);\r\n        return al;\r\n      });\r\n\r\n      this.noAlertsMessage = this.alertHistory.length === 0 ? 'No alerts in current time range' : '';\r\n\r\n      return this.alertHistory;\r\n    });\r\n  }\r\n\r\n  getCurrentAlertState() {\r\n    const params: any = {\r\n      state: this.panel.stateFilter,\r\n    };\r\n\r\n    if (this.panel.nameFilter) {\r\n      params.query = this.templateSrv.replace(this.panel.nameFilter, this.panel.scopedVars);\r\n    }\r\n\r\n    if (this.panel.folderId >= 0) {\r\n      params.folderId = this.panel.folderId;\r\n    }\r\n\r\n    if (this.panel.dashboardFilter) {\r\n      params.dashboardQuery = this.panel.dashboardFilter;\r\n    }\r\n\r\n    if (this.panel.onlyAlertsOnDashboard) {\r\n      params.dashboardId = this.dashboard.id;\r\n    }\r\n\r\n    if (this.panel.dashboardTags) {\r\n      params.dashboardTag = this.panel.dashboardTags;\r\n    }\r\n\r\n    return this.backendSrv.get(`/api/alerts`, params).then(res => {\r\n      this.currentAlerts = this.sortResult(\r\n        _.map(res, al => {\r\n          al.stateModel = alertDef.getStateDisplayModel(al.state);\r\n          al.newStateDateAgo = dateTime(al.newStateDate)\r\n            .locale('en')\r\n            .fromNow(true);\r\n          return al;\r\n        })\r\n      );\r\n      if (this.currentAlerts.length > this.panel.limit) {\r\n        this.currentAlerts = this.currentAlerts.slice(0, this.panel.limit);\r\n      }\r\n      this.noAlertsMessage = this.currentAlerts.length === 0 ? 'No alerts' : '';\r\n\r\n      return this.currentAlerts;\r\n    });\r\n  }\r\n\r\n  onInitEditMode() {\r\n    this.addEditorTab('Options', 'public/app/plugins/panel/alertlist/editor.html');\r\n  }\r\n}\r\n\r\nexport { AlertListPanel, AlertListPanel as PanelCtrl };\r\n","// Libraries\r\nimport React, { PureComponent, ChangeEvent } from 'react';\r\n\r\n// Components\r\nimport { PanelOptionsGroup, PanelOptionsGrid, Switch, FormField, FormLabel } from '@grafana/ui';\r\n\r\nimport { PanelEditorProps, toIntegerOrUndefined, toNumberString } from '@grafana/data';\r\n\r\n// Types\r\nimport { AnnoOptions } from './types';\r\nimport { TagBadge } from 'app/core/components/TagFilter/TagBadge';\r\n\r\ninterface State {\r\n  tag: string;\r\n}\r\n\r\nexport class AnnoListEditor extends PureComponent<PanelEditorProps<AnnoOptions>, State> {\r\n  constructor(props: PanelEditorProps<AnnoOptions>) {\r\n    super(props);\r\n\r\n    this.state = {\r\n      tag: '',\r\n    };\r\n  }\r\n\r\n  // Display\r\n  //-----------\r\n\r\n  onToggleShowUser = () =>\r\n    this.props.onOptionsChange({ ...this.props.options, showUser: !this.props.options.showUser });\r\n\r\n  onToggleShowTime = () =>\r\n    this.props.onOptionsChange({ ...this.props.options, showTime: !this.props.options.showTime });\r\n\r\n  onToggleShowTags = () =>\r\n    this.props.onOptionsChange({ ...this.props.options, showTags: !this.props.options.showTags });\r\n\r\n  // Navigate\r\n  //-----------\r\n\r\n  onNavigateBeforeChange = (event: ChangeEvent<HTMLInputElement>) => {\r\n    this.props.onOptionsChange({ ...this.props.options, navigateBefore: event.target.value });\r\n  };\r\n\r\n  onNavigateAfterChange = (event: ChangeEvent<HTMLInputElement>) => {\r\n    this.props.onOptionsChange({ ...this.props.options, navigateAfter: event.target.value });\r\n  };\r\n\r\n  onToggleNavigateToPanel = () =>\r\n    this.props.onOptionsChange({ ...this.props.options, navigateToPanel: !this.props.options.navigateToPanel });\r\n\r\n  // Search\r\n  //-----------\r\n  onLimitChange = (event: ChangeEvent<HTMLInputElement>) => {\r\n    const v = toIntegerOrUndefined(event.target.value);\r\n    this.props.onOptionsChange({ ...this.props.options, limit: v });\r\n  };\r\n\r\n  onToggleOnlyFromThisDashboard = () =>\r\n    this.props.onOptionsChange({\r\n      ...this.props.options,\r\n      onlyFromThisDashboard: !this.props.options.onlyFromThisDashboard,\r\n    });\r\n\r\n  onToggleOnlyInTimeRange = () =>\r\n    this.props.onOptionsChange({ ...this.props.options, onlyInTimeRange: !this.props.options.onlyInTimeRange });\r\n\r\n  // Tags\r\n  //-----------\r\n\r\n  onTagTextChange = (event: ChangeEvent<HTMLInputElement>) => {\r\n    this.setState({ tag: event.target.value });\r\n  };\r\n\r\n  onTagClick = (e: React.SyntheticEvent, tag: string) => {\r\n    e.stopPropagation();\r\n\r\n    const tags = this.props.options.tags.filter(item => item !== tag);\r\n    this.props.onOptionsChange({\r\n      ...this.props.options,\r\n      tags,\r\n    });\r\n  };\r\n\r\n  renderTags = (tags: string[]): JSX.Element => {\r\n    if (!tags || !tags.length) {\r\n      return null;\r\n    }\r\n    return (\r\n      <>\r\n        {tags.map(tag => {\r\n          return (\r\n            <span key={tag} onClick={e => this.onTagClick(e, tag)} className=\"pointer\">\r\n              <TagBadge label={tag} removeIcon={true} count={0} />\r\n            </span>\r\n          );\r\n        })}\r\n      </>\r\n    );\r\n  };\r\n\r\n  render() {\r\n    const { options } = this.props;\r\n    const labelWidth = 8;\r\n\r\n    return (\r\n      <PanelOptionsGrid>\r\n        <PanelOptionsGroup title=\"Display\">\r\n          <Switch\r\n            label=\"Show User\"\r\n            labelClass={`width-${labelWidth}`}\r\n            checked={options.showUser}\r\n            onChange={this.onToggleShowUser}\r\n          />\r\n          <Switch\r\n            label=\"Show Time\"\r\n            labelClass={`width-${labelWidth}`}\r\n            checked={options.showTime}\r\n            onChange={this.onToggleShowTime}\r\n          />\r\n          <Switch\r\n            label=\"Show Tags\"\r\n            labelClass={`width-${labelWidth}`}\r\n            checked={options.showTags}\r\n            onChange={this.onToggleShowTags}\r\n          />\r\n        </PanelOptionsGroup>\r\n        <PanelOptionsGroup title=\"Navigate\">\r\n          <FormField\r\n            label=\"Before\"\r\n            labelWidth={labelWidth}\r\n            onChange={this.onNavigateBeforeChange}\r\n            value={options.navigateBefore}\r\n          />\r\n          <FormField\r\n            label=\"After\"\r\n            labelWidth={labelWidth}\r\n            onChange={this.onNavigateAfterChange}\r\n            value={options.navigateAfter}\r\n          />\r\n          <Switch\r\n            label=\"To Panel\"\r\n            labelClass={`width-${labelWidth}`}\r\n            checked={options.navigateToPanel}\r\n            onChange={this.onToggleNavigateToPanel}\r\n          />\r\n        </PanelOptionsGroup>\r\n        <PanelOptionsGroup title=\"Search\">\r\n          <Switch\r\n            label=\"Only This Dashboard\"\r\n            labelClass={`width-12`}\r\n            checked={options.onlyFromThisDashboard}\r\n            onChange={this.onToggleOnlyFromThisDashboard}\r\n          />\r\n          <Switch\r\n            label=\"Within Time Range\"\r\n            labelClass={`width-12`}\r\n            checked={options.onlyInTimeRange}\r\n            onChange={this.onToggleOnlyInTimeRange}\r\n          />\r\n          <div className=\"form-field\">\r\n            <FormLabel width={6}>Tags</FormLabel>\r\n            {this.renderTags(options.tags)}\r\n            <input\r\n              type=\"text\"\r\n              className={`gf-form-input width-${8}`}\r\n              value={this.state.tag}\r\n              onChange={this.onTagTextChange}\r\n              onKeyPress={ev => {\r\n                if (this.state.tag && ev.key === 'Enter') {\r\n                  const tags = [...options.tags, this.state.tag];\r\n                  this.props.onOptionsChange({\r\n                    ...this.props.options,\r\n                    tags,\r\n                  });\r\n                  this.setState({ tag: '' });\r\n                  ev.preventDefault();\r\n                }\r\n              }}\r\n            />\r\n          </div>\r\n\r\n          <FormField\r\n            label=\"Limit\"\r\n            labelWidth={6}\r\n            onChange={this.onLimitChange}\r\n            value={toNumberString(options.limit)}\r\n            type=\"number\"\r\n          />\r\n        </PanelOptionsGroup>\r\n      </PanelOptionsGrid>\r\n    );\r\n  }\r\n}\r\n","// Libraries\r\nimport React, { PureComponent } from 'react';\r\n\r\n// Types\r\nimport { AnnoOptions } from './types';\r\nimport { PanelProps, dateTime, DurationUnit, AnnotationEvent, AppEvents } from '@grafana/data';\r\nimport { Tooltip } from '@grafana/ui';\r\nimport { getBackendSrv } from 'app/core/services/backend_srv';\r\nimport { AbstractList } from '@grafana/ui/src/components/List/AbstractList';\r\nimport { TagBadge } from 'app/core/components/TagFilter/TagBadge';\r\nimport { getDashboardSrv } from 'app/features/dashboard/services/DashboardSrv';\r\nimport appEvents from 'app/core/app_events';\r\n\r\nimport { updateLocation } from 'app/core/actions';\r\nimport { store } from 'app/store/store';\r\nimport { cx, css } from 'emotion';\r\n\r\ninterface UserInfo {\r\n  id: number;\r\n  login: string;\r\n  email: string;\r\n}\r\n\r\ninterface Props extends PanelProps<AnnoOptions> {}\r\ninterface State {\r\n  annotations: AnnotationEvent[];\r\n  timeInfo: string;\r\n  loaded: boolean;\r\n  queryUser?: UserInfo;\r\n  queryTags: string[];\r\n}\r\n\r\nexport class AnnoListPanel extends PureComponent<Props, State> {\r\n  constructor(props: Props) {\r\n    super(props);\r\n\r\n    this.state = {\r\n      annotations: [],\r\n      timeInfo: '',\r\n      loaded: false,\r\n      queryTags: [],\r\n    };\r\n  }\r\n\r\n  componentDidMount() {\r\n    this.doSearch();\r\n  }\r\n\r\n  componentDidUpdate(prevProps: Props, prevState: State) {\r\n    const { options, timeRange } = this.props;\r\n    const needsQuery =\r\n      options !== prevProps.options ||\r\n      this.state.queryTags !== prevState.queryTags ||\r\n      this.state.queryUser !== prevState.queryUser ||\r\n      timeRange !== prevProps.timeRange;\r\n\r\n    if (needsQuery) {\r\n      this.doSearch();\r\n    }\r\n  }\r\n\r\n  async doSearch() {\r\n    // http://docs.grafana.org/http_api/annotations/\r\n    // https://github.com/grafana/grafana/blob/master/public/app/core/services/backend_srv.ts\r\n    // https://github.com/grafana/grafana/blob/master/public/app/features/annotations/annotations_srv.ts\r\n\r\n    const { options } = this.props;\r\n    const { queryUser, queryTags } = this.state;\r\n\r\n    const params: any = {\r\n      tags: options.tags,\r\n      limit: options.limit,\r\n      type: 'annotation', // Skip the Annotations that are really alerts.  (Use the alerts panel!)\r\n    };\r\n\r\n    if (options.onlyFromThisDashboard) {\r\n      params.dashboardId = getDashboardSrv().getCurrent().id;\r\n    }\r\n\r\n    let timeInfo = '';\r\n    if (options.onlyInTimeRange) {\r\n      const { timeRange } = this.props;\r\n      params.from = timeRange.from.valueOf();\r\n      params.to = timeRange.to.valueOf();\r\n    } else {\r\n      timeInfo = 'All Time';\r\n    }\r\n\r\n    if (queryUser) {\r\n      params.userId = queryUser.id;\r\n    }\r\n\r\n    if (options.tags && options.tags.length) {\r\n      params.tags = options.tags;\r\n    }\r\n\r\n    if (queryTags.length) {\r\n      params.tags = params.tags ? [...params.tags, ...queryTags] : queryTags;\r\n    }\r\n\r\n    const annotations = await getBackendSrv().get('/api/annotations', params);\r\n    this.setState({\r\n      annotations,\r\n      timeInfo,\r\n      loaded: true,\r\n    });\r\n  }\r\n\r\n  onAnnoClick = (e: React.SyntheticEvent, anno: AnnotationEvent) => {\r\n    e.stopPropagation();\r\n    const { options } = this.props;\r\n    const dashboardSrv = getDashboardSrv();\r\n    const current = dashboardSrv.getCurrent();\r\n\r\n    const params: any = {\r\n      from: this._timeOffset(anno.time, options.navigateBefore, true),\r\n      to: this._timeOffset(anno.time, options.navigateAfter, false),\r\n    };\r\n\r\n    if (options.navigateToPanel) {\r\n      params.panelId = anno.panelId;\r\n      params.fullscreen = true;\r\n    }\r\n\r\n    if (current.id === anno.dashboardId) {\r\n      store.dispatch(\r\n        updateLocation({\r\n          query: params,\r\n          partial: true,\r\n        })\r\n      );\r\n      return;\r\n    }\r\n\r\n    getBackendSrv()\r\n      .get('/api/search', { dashboardIds: anno.dashboardId })\r\n      .then((res: any[]) => {\r\n        if (res && res.length && res[0].id === anno.dashboardId) {\r\n          const dash = res[0];\r\n          store.dispatch(\r\n            updateLocation({\r\n              query: params,\r\n              path: dash.url,\r\n            })\r\n          );\r\n          return;\r\n        }\r\n        appEvents.emit(AppEvents.alertWarning, ['Unknown Dashboard: ' + anno.dashboardId]);\r\n      });\r\n  };\r\n\r\n  _timeOffset(time: number, offset: string, subtract = false): number {\r\n    let incr = 5;\r\n    let unit = 'm';\r\n    const parts = /^(\\d+)(\\w)/.exec(offset);\r\n    if (parts && parts.length === 3) {\r\n      incr = parseInt(parts[1], 10);\r\n      unit = parts[2];\r\n    }\r\n\r\n    const t = dateTime(time);\r\n    if (subtract) {\r\n      incr *= -1;\r\n    }\r\n    return t.add(incr, unit as DurationUnit).valueOf();\r\n  }\r\n\r\n  onTagClick = (e: React.SyntheticEvent, tag: string, remove: boolean) => {\r\n    e.stopPropagation();\r\n    const queryTags = remove ? this.state.queryTags.filter(item => item !== tag) : [...this.state.queryTags, tag];\r\n\r\n    this.setState({ queryTags });\r\n  };\r\n\r\n  onUserClick = (e: React.SyntheticEvent, anno: AnnotationEvent) => {\r\n    e.stopPropagation();\r\n    this.setState({\r\n      queryUser: {\r\n        id: anno.userId,\r\n        login: anno.login,\r\n        email: anno.email,\r\n      },\r\n    });\r\n  };\r\n\r\n  onClearUser = () => {\r\n    this.setState({\r\n      queryUser: undefined,\r\n    });\r\n  };\r\n\r\n  renderTags = (tags: string[], remove: boolean): JSX.Element => {\r\n    if (!tags || !tags.length) {\r\n      return null;\r\n    }\r\n    return (\r\n      <>\r\n        {tags.map(tag => {\r\n          return (\r\n            <span key={tag} onClick={e => this.onTagClick(e, tag, remove)} className=\"pointer\">\r\n              <TagBadge label={tag} removeIcon={remove} count={0} />\r\n            </span>\r\n          );\r\n        })}\r\n      </>\r\n    );\r\n  };\r\n\r\n  renderItem = (anno: AnnotationEvent, index: number): JSX.Element => {\r\n    const { options } = this.props;\r\n    const { showUser, showTags, showTime } = options;\r\n    const dashboard = getDashboardSrv().getCurrent();\r\n\r\n    return (\r\n      <div className=\"dashlist-item\">\r\n        <span\r\n          className=\"dashlist-link pointer\"\r\n          onClick={e => {\r\n            this.onAnnoClick(e, anno);\r\n          }}\r\n        >\r\n          <span\r\n            className={cx([\r\n              'dashlist-title',\r\n              css`\r\n                margin-right: 8px;\r\n              `,\r\n            ])}\r\n          >\r\n            {anno.text}\r\n          </span>\r\n\r\n          <span className=\"pluginlist-message\">\r\n            {anno.login && showUser && (\r\n              <span className=\"graph-annotation\">\r\n                <Tooltip\r\n                  content={\r\n                    <span>\r\n                      Created by:\r\n                      <br /> {anno.email}\r\n                    </span>\r\n                  }\r\n                  theme=\"info\"\r\n                  placement=\"top\"\r\n                >\r\n                  <span onClick={e => this.onUserClick(e, anno)} className=\"graph-annotation__user\">\r\n                    <img src={anno.avatarUrl} />\r\n                  </span>\r\n                </Tooltip>\r\n              </span>\r\n            )}\r\n            {showTags && this.renderTags(anno.tags, false)}\r\n          </span>\r\n\r\n          <span className=\"pluginlist-version\">{showTime && <span>{dashboard.formatDate(anno.time)}</span>}</span>\r\n        </span>\r\n      </div>\r\n    );\r\n  };\r\n\r\n  render() {\r\n    const { height } = this.props;\r\n    const { loaded, annotations, queryUser, queryTags } = this.state;\r\n    if (!loaded) {\r\n      return <div>loading...</div>;\r\n    }\r\n\r\n    // Previously we showed inidication that it covered all time\r\n    // { timeInfo && (\r\n    //   <span className=\"panel-time-info\">\r\n    //     <i className=\"fa fa-clock-o\" /> {timeInfo}\r\n    //   </span>\r\n    // )}\r\n\r\n    const hasFilter = queryUser || queryTags.length > 0;\r\n\r\n    return (\r\n      <div style={{ height, overflow: 'scroll' }}>\r\n        {hasFilter && (\r\n          <div>\r\n            <b>Filter: &nbsp; </b>\r\n            {queryUser && (\r\n              <span onClick={this.onClearUser} className=\"pointer\">\r\n                {queryUser.email}\r\n              </span>\r\n            )}\r\n            {queryTags.length > 0 && this.renderTags(queryTags, true)}\r\n          </div>\r\n        )}\r\n\r\n        {annotations.length < 1 && <div className=\"panel-alert-list__no-alerts\">No Annotations Found</div>}\r\n\r\n        <AbstractList\r\n          items={annotations}\r\n          renderItem={this.renderItem}\r\n          getItemKey={item => {\r\n            return item.id + '';\r\n          }}\r\n          className=\"dashlist\"\r\n        />\r\n      </div>\r\n    );\r\n  }\r\n}\r\n","import { AnnoListPanel } from './AnnoListPanel';\r\nimport { AnnoOptions, defaults } from './types';\r\nimport { AnnoListEditor } from './AnnoListEditor';\r\nimport { PanelPlugin } from '@grafana/data';\r\n\r\nexport const plugin = new PanelPlugin<AnnoOptions>(AnnoListPanel)\r\n  .setDefaults(defaults)\r\n  .setEditor(AnnoListEditor)\r\n\r\n  // TODO, we should support this directly in the plugin infrastructure\r\n  .setPanelChangeHandler((options: AnnoOptions, prevPluginId: string, prevOptions: any) => {\r\n    if (prevPluginId === 'ryantxu-annolist-panel') {\r\n      return prevOptions as AnnoOptions;\r\n    }\r\n    return options;\r\n  });\r\n","export interface AnnoOptions {\n  limit: number;\n  tags: string[];\n  onlyFromThisDashboard: boolean;\n  onlyInTimeRange: boolean;\n\n  showTags: boolean;\n  showUser: boolean;\n  showTime: boolean;\n\n  navigateBefore: string;\n  navigateAfter: string;\n  navigateToPanel: boolean;\n}\n\nexport const defaults: AnnoOptions = {\n  limit: 10,\n  tags: [],\n  onlyFromThisDashboard: false,\n  onlyInTimeRange: false,\n\n  showTags: true,\n  showUser: true,\n  showTime: true,\n\n  navigateBefore: '10m',\n  navigateAfter: '10m',\n  navigateToPanel: true,\n};\n","import { PanelModel } from '@grafana/data';\nimport { sharedSingleStatMigrationHandler } from '@grafana/ui';\nimport { BarGaugeOptions } from './types';\n\nexport const barGaugePanelMigrationHandler = (panel: PanelModel<BarGaugeOptions>): Partial<BarGaugeOptions> => {\n  return sharedSingleStatMigrationHandler(panel);\n};\n","// Libraries\r\nimport React, { PureComponent } from 'react';\r\n\r\n// Services & Utils\r\nimport { config } from 'app/core/config';\r\n\r\nimport { BarGauge, VizRepeater, DataLinksContextMenu } from '@grafana/ui';\r\nimport { BarGaugeOptions } from './types';\r\nimport {\r\n  getFieldDisplayValues,\r\n  FieldDisplay,\r\n  PanelProps,\r\n  getDisplayValueAlignmentFactors,\r\n  DisplayValueAlignmentFactors,\r\n} from '@grafana/data';\r\nimport { getFieldLinksSupplier } from 'app/features/panel/panellinks/linkSuppliers';\r\n\r\nexport class BarGaugePanel extends PureComponent<PanelProps<BarGaugeOptions>> {\r\n  renderValue = (\r\n    value: FieldDisplay,\r\n    width: number,\r\n    height: number,\r\n    alignmentFactors: DisplayValueAlignmentFactors\r\n  ): JSX.Element => {\r\n    const { options } = this.props;\r\n    const { field, display, view, colIndex } = value;\r\n    const f = view.dataFrame.fields[colIndex];\r\n\r\n    return (\r\n      <DataLinksContextMenu links={getFieldLinksSupplier(value)}>\r\n        {({ openMenu, targetClassName }) => {\r\n          return (\r\n            <BarGauge\r\n              value={display}\r\n              width={width}\r\n              height={height}\r\n              orientation={options.orientation}\r\n              field={field}\r\n              display={f.display!}\r\n              theme={config.theme}\r\n              itemSpacing={this.getItemSpacing()}\r\n              displayMode={options.displayMode}\r\n              onClick={openMenu}\r\n              className={targetClassName}\r\n              alignmentFactors={alignmentFactors}\r\n              showUnfilled={options.showUnfilled}\r\n            />\r\n          );\r\n        }}\r\n      </DataLinksContextMenu>\r\n    );\r\n  };\r\n\r\n  getValues = (): FieldDisplay[] => {\r\n    const { data, options, replaceVariables } = this.props;\r\n    return getFieldDisplayValues({\r\n      ...options,\r\n      replaceVariables,\r\n      theme: config.theme,\r\n      data: data.series,\r\n      autoMinMax: true,\r\n    });\r\n  };\r\n\r\n  getItemSpacing(): number {\r\n    if (this.props.options.displayMode === 'lcd') {\r\n      return 2;\r\n    }\r\n\r\n    return 10;\r\n  }\r\n\r\n  render() {\r\n    const { height, width, options, data, renderCounter } = this.props;\r\n\r\n    return (\r\n      <VizRepeater\r\n        source={data}\r\n        getAlignmentFactors={getDisplayValueAlignmentFactors}\r\n        getValues={this.getValues}\r\n        renderValue={this.renderValue}\r\n        renderCounter={renderCounter}\r\n        width={width}\r\n        height={height}\r\n        itemSpacing={this.getItemSpacing()}\r\n        orientation={options.orientation}\r\n      />\r\n    );\r\n  }\r\n}\r\n","// Libraries\r\nimport React, { PureComponent } from 'react';\r\n\r\nimport {\r\n  ThresholdsEditor,\r\n  ValueMappingsEditor,\r\n  PanelOptionsGrid,\r\n  FieldDisplayEditor,\r\n  FieldPropertiesEditor,\r\n  PanelOptionsGroup,\r\n  FormLabel,\r\n  Select,\r\n  DataLinksEditor,\r\n  Switch,\r\n} from '@grafana/ui';\r\nimport {\r\n  ThresholdsConfig,\r\n  ValueMapping,\r\n  FieldDisplayOptions,\r\n  FieldConfig,\r\n  DataLink,\r\n  PanelEditorProps,\r\n} from '@grafana/data';\r\nimport { BarGaugeOptions, displayModes } from './types';\r\nimport { orientationOptions } from '../gauge/types';\r\nimport {\r\n  getDataLinksVariableSuggestions,\r\n  getCalculationValueDataLinksVariableSuggestions,\r\n} from 'app/features/panel/panellinks/link_srv';\r\nimport { config } from 'app/core/config';\r\n\r\nexport class BarGaugePanelEditor extends PureComponent<PanelEditorProps<BarGaugeOptions>> {\r\n  onThresholdsChanged = (thresholds: ThresholdsConfig) => {\r\n    const current = this.props.options.fieldOptions.defaults;\r\n    this.onDefaultsChange({\r\n      ...current,\r\n      thresholds,\r\n    });\r\n  };\r\n\r\n  onValueMappingsChanged = (mappings: ValueMapping[]) => {\r\n    const current = this.props.options.fieldOptions.defaults;\r\n    this.onDefaultsChange({\r\n      ...current,\r\n      mappings,\r\n    });\r\n  };\r\n\r\n  onDisplayOptionsChanged = (fieldOptions: FieldDisplayOptions) =>\r\n    this.props.onOptionsChange({\r\n      ...this.props.options,\r\n      fieldOptions,\r\n    });\r\n\r\n  onDefaultsChange = (field: FieldConfig) => {\r\n    this.onDisplayOptionsChanged({\r\n      ...this.props.options.fieldOptions,\r\n      defaults: field,\r\n    });\r\n  };\r\n\r\n  onOrientationChange = ({ value }: any) => this.props.onOptionsChange({ ...this.props.options, orientation: value });\r\n  onDisplayModeChange = ({ value }: any) => this.props.onOptionsChange({ ...this.props.options, displayMode: value });\r\n  onToggleShowUnfilled = () => {\r\n    this.props.onOptionsChange({ ...this.props.options, showUnfilled: !this.props.options.showUnfilled });\r\n  };\r\n\r\n  onDataLinksChanged = (links: DataLink[]) => {\r\n    this.onDefaultsChange({\r\n      ...this.props.options.fieldOptions.defaults,\r\n      links,\r\n    });\r\n  };\r\n  render() {\r\n    const { options } = this.props;\r\n    const { fieldOptions } = options;\r\n    const { defaults } = fieldOptions;\r\n\r\n    const suggestions = fieldOptions.values\r\n      ? getDataLinksVariableSuggestions(this.props.data.series)\r\n      : getCalculationValueDataLinksVariableSuggestions(this.props.data.series);\r\n    const labelWidth = 6;\r\n\r\n    return (\r\n      <>\r\n        <PanelOptionsGrid>\r\n          <PanelOptionsGroup title=\"Display\">\r\n            <FieldDisplayEditor onChange={this.onDisplayOptionsChanged} value={fieldOptions} labelWidth={labelWidth} />\r\n            <div className=\"form-field\">\r\n              <FormLabel width={labelWidth}>Orientation</FormLabel>\r\n              <Select\r\n                width={12}\r\n                options={orientationOptions}\r\n                defaultValue={orientationOptions[0]}\r\n                onChange={this.onOrientationChange}\r\n                value={orientationOptions.find(item => item.value === options.orientation)}\r\n              />\r\n            </div>\r\n            <div className=\"form-field\">\r\n              <FormLabel width={labelWidth}>Mode</FormLabel>\r\n              <Select\r\n                width={12}\r\n                options={displayModes}\r\n                defaultValue={displayModes[0]}\r\n                onChange={this.onDisplayModeChange}\r\n                value={displayModes.find(item => item.value === options.displayMode)}\r\n              />\r\n            </div>\r\n            {options.displayMode !== 'lcd' && (\r\n              <Switch\r\n                label=\"Unfilled\"\r\n                labelClass={`width-${labelWidth}`}\r\n                checked={options.showUnfilled}\r\n                onChange={this.onToggleShowUnfilled}\r\n              />\r\n            )}\r\n          </PanelOptionsGroup>\r\n          <PanelOptionsGroup title=\"Field\">\r\n            <FieldPropertiesEditor\r\n              showMinMax={true}\r\n              showTitle={true}\r\n              onChange={this.onDefaultsChange}\r\n              value={defaults}\r\n            />\r\n          </PanelOptionsGroup>\r\n\r\n          <ThresholdsEditor\r\n            onChange={this.onThresholdsChanged}\r\n            thresholds={defaults.thresholds}\r\n            theme={config.theme}\r\n            showAlphaUI={config.featureToggles.newEdit}\r\n          />\r\n        </PanelOptionsGrid>\r\n\r\n        <ValueMappingsEditor onChange={this.onValueMappingsChanged} valueMappings={defaults.mappings} />\r\n\r\n        <PanelOptionsGroup title=\"Data links\">\r\n          <DataLinksEditor\r\n            value={defaults.links}\r\n            onChange={this.onDataLinksChanged}\r\n            suggestions={suggestions}\r\n            maxLinks={10}\r\n          />\r\n        </PanelOptionsGroup>\r\n      </>\r\n    );\r\n  }\r\n}\r\n","import { sharedSingleStatPanelChangedHandler } from '@grafana/ui';\r\nimport { PanelPlugin } from '@grafana/data';\r\nimport { BarGaugePanel } from './BarGaugePanel';\r\nimport { BarGaugePanelEditor } from './BarGaugePanelEditor';\r\nimport { BarGaugeOptions, defaults } from './types';\r\nimport { barGaugePanelMigrationHandler } from './BarGaugeMigrations';\r\n\r\nexport const plugin = new PanelPlugin<BarGaugeOptions>(BarGaugePanel)\r\n  .setDefaults(defaults)\r\n  .setEditor(BarGaugePanelEditor)\r\n  .setPanelChangeHandler(sharedSingleStatPanelChangedHandler)\r\n  .setMigrationHandler(barGaugePanelMigrationHandler);\r\n","import { SingleStatBaseOptions, BarGaugeDisplayMode } from '@grafana/ui';\r\nimport { standardGaugeFieldOptions } from '../gauge/types';\r\nimport { VizOrientation, SelectableValue } from '@grafana/data';\r\n\r\nexport interface BarGaugeOptions extends SingleStatBaseOptions {\r\n  displayMode: BarGaugeDisplayMode;\r\n  showUnfilled: boolean;\r\n}\r\n\r\nexport const displayModes: Array<SelectableValue<string>> = [\r\n  { value: BarGaugeDisplayMode.Gradient, label: 'Gradient' },\r\n  { value: BarGaugeDisplayMode.Lcd, label: 'Retro LCD' },\r\n  { value: BarGaugeDisplayMode.Basic, label: 'Basic' },\r\n];\r\n\r\nexport const defaults: BarGaugeOptions = {\r\n  displayMode: BarGaugeDisplayMode.Lcd,\r\n  orientation: VizOrientation.Horizontal,\r\n  fieldOptions: standardGaugeFieldOptions,\r\n  showUnfilled: true,\r\n};\r\n","import _ from 'lodash';\r\nimport { PanelCtrl } from 'app/plugins/sdk';\r\nimport impressionSrv from 'app/core/services/impression_srv';\r\nimport { auto } from 'angular';\r\nimport { BackendSrv } from 'app/core/services/backend_srv';\r\nimport { DashboardSrv } from 'app/features/dashboard/services/DashboardSrv';\r\nimport { PanelEvents } from '@grafana/data';\r\n\r\nclass DashListCtrl extends PanelCtrl {\r\n  static templateUrl = 'module.html';\r\n  static scrollable = true;\r\n\r\n  groups: any[];\r\n  modes: any[];\r\n\r\n  panelDefaults: any = {\r\n    query: '',\r\n    limit: 10,\r\n    tags: [],\r\n    recent: false,\r\n    search: false,\r\n    starred: true,\r\n    headings: true,\r\n    folderId: null,\r\n  };\r\n\r\n  /** @ngInject */\r\n  constructor(\r\n    $scope: any,\r\n    $injector: auto.IInjectorService,\r\n    private backendSrv: BackendSrv,\r\n    private dashboardSrv: DashboardSrv\r\n  ) {\r\n    super($scope, $injector);\r\n    _.defaults(this.panel, this.panelDefaults);\r\n\r\n    if (this.panel.tag) {\r\n      this.panel.tags = [this.panel.tag];\r\n      delete this.panel.tag;\r\n    }\r\n\r\n    this.events.on(PanelEvents.refresh, this.onRefresh.bind(this));\r\n    this.events.on(PanelEvents.editModeInitialized, this.onInitEditMode.bind(this));\r\n\r\n    this.groups = [\r\n      { list: [], show: false, header: 'Starred dashboards' },\r\n      { list: [], show: false, header: 'Recently viewed dashboards' },\r\n      { list: [], show: false, header: 'Search' },\r\n    ];\r\n\r\n    // update capability\r\n    if (this.panel.mode) {\r\n      if (this.panel.mode === 'starred') {\r\n        this.panel.starred = true;\r\n        this.panel.headings = false;\r\n      }\r\n      if (this.panel.mode === 'recently viewed') {\r\n        this.panel.recent = true;\r\n        this.panel.starred = false;\r\n        this.panel.headings = false;\r\n      }\r\n      if (this.panel.mode === 'search') {\r\n        this.panel.search = true;\r\n        this.panel.starred = false;\r\n        this.panel.headings = false;\r\n      }\r\n      delete this.panel.mode;\r\n    }\r\n  }\r\n\r\n  onInitEditMode() {\r\n    this.modes = ['starred', 'search', 'recently viewed'];\r\n    this.addEditorTab('Options', 'public/app/plugins/panel/dashlist/editor.html');\r\n  }\r\n\r\n  onRefresh() {\r\n    const promises = [];\r\n\r\n    promises.push(this.getRecentDashboards());\r\n    promises.push(this.getStarred());\r\n    promises.push(this.getSearch());\r\n\r\n    return Promise.all(promises).then(this.renderingCompleted.bind(this));\r\n  }\r\n\r\n  getSearch() {\r\n    this.groups[2].show = this.panel.search;\r\n    if (!this.panel.search) {\r\n      return Promise.resolve();\r\n    }\r\n\r\n    const params = {\r\n      limit: this.panel.limit,\r\n      query: this.panel.query,\r\n      tag: this.panel.tags,\r\n      folderIds: this.panel.folderId,\r\n      type: 'dash-db',\r\n    };\r\n\r\n    return this.backendSrv.search(params).then(result => {\r\n      this.groups[2].list = result;\r\n    });\r\n  }\r\n\r\n  getStarred() {\r\n    this.groups[0].show = this.panel.starred;\r\n    if (!this.panel.starred) {\r\n      return Promise.resolve();\r\n    }\r\n\r\n    const params = { limit: this.panel.limit, starred: 'true' };\r\n    return this.backendSrv.search(params).then(result => {\r\n      this.groups[0].list = result;\r\n    });\r\n  }\r\n\r\n  starDashboard(dash: any, evt: any) {\r\n    this.dashboardSrv.starDashboard(dash.id, dash.isStarred).then((newState: any) => {\r\n      dash.isStarred = newState;\r\n    });\r\n\r\n    if (evt) {\r\n      evt.stopPropagation();\r\n      evt.preventDefault();\r\n    }\r\n  }\r\n\r\n  getRecentDashboards() {\r\n    this.groups[1].show = this.panel.recent;\r\n    if (!this.panel.recent) {\r\n      return Promise.resolve();\r\n    }\r\n\r\n    const dashIds = _.take(impressionSrv.getDashboardOpened(), this.panel.limit);\r\n    return this.backendSrv.search({ dashboardIds: dashIds, limit: this.panel.limit }).then(result => {\r\n      this.groups[1].list = dashIds\r\n        .map(orderId => {\r\n          return _.find(result, dashboard => {\r\n            return dashboard.id === orderId;\r\n          });\r\n        })\r\n        .filter(el => {\r\n          return el !== undefined;\r\n        });\r\n    });\r\n  }\r\n\r\n  onFolderChange(folder: any) {\r\n    this.panel.folderId = folder.id;\r\n    this.refresh();\r\n  }\r\n}\r\n\r\nexport { DashListCtrl, DashListCtrl as PanelCtrl };\r\n","import { sharedSingleStatPanelChangedHandler, sharedSingleStatMigrationHandler } from '@grafana/ui';\r\nimport { PanelModel } from '@grafana/data';\r\nimport { GaugeOptions } from './types';\r\n\r\n// This is called when the panel first loads\r\nexport const gaugePanelMigrationHandler = (panel: PanelModel<GaugeOptions>): Partial<GaugeOptions> => {\r\n  return sharedSingleStatMigrationHandler(panel);\r\n};\r\n\r\n// This is called when the panel changes from another panel\r\nexport const gaugePanelChangedHandler = (\r\n  options: Partial<GaugeOptions> | any,\r\n  prevPluginId: string,\r\n  prevOptions: any\r\n) => {\r\n  // This handles most config changes\r\n  const opts = sharedSingleStatPanelChangedHandler(options, prevPluginId, prevOptions) as GaugeOptions;\r\n\r\n  // Changing from angular singlestat\r\n  if (prevPluginId === 'singlestat' && prevOptions.angular) {\r\n    const gauge = prevOptions.angular.gauge;\r\n    if (gauge) {\r\n      opts.showThresholdMarkers = gauge.thresholdMarkers;\r\n      opts.showThresholdLabels = gauge.thresholdLabels;\r\n    }\r\n  }\r\n  return opts;\r\n};\r\n","// Libraries\r\nimport React, { PureComponent } from 'react';\r\n\r\n// Services & Utils\r\nimport { config } from 'app/core/config';\r\n\r\n// Components\r\nimport { Gauge, DataLinksContextMenu } from '@grafana/ui';\r\n\r\n// Types\r\nimport { GaugeOptions } from './types';\r\nimport { VizRepeater } from '@grafana/ui';\r\nimport { FieldDisplay, getFieldDisplayValues, VizOrientation, PanelProps } from '@grafana/data';\r\nimport { getFieldLinksSupplier } from 'app/features/panel/panellinks/linkSuppliers';\r\n\r\nexport class GaugePanel extends PureComponent<PanelProps<GaugeOptions>> {\r\n  renderValue = (value: FieldDisplay, width: number, height: number): JSX.Element => {\r\n    const { options } = this.props;\r\n    const { field, display } = value;\r\n\r\n    return (\r\n      <DataLinksContextMenu links={getFieldLinksSupplier(value)}>\r\n        {({ openMenu, targetClassName }) => {\r\n          return (\r\n            <Gauge\r\n              value={display}\r\n              width={width}\r\n              height={height}\r\n              field={field}\r\n              showThresholdLabels={options.showThresholdLabels}\r\n              showThresholdMarkers={options.showThresholdMarkers}\r\n              theme={config.theme}\r\n              onClick={openMenu}\r\n              className={targetClassName}\r\n            />\r\n          );\r\n        }}\r\n      </DataLinksContextMenu>\r\n    );\r\n  };\r\n\r\n  getValues = (): FieldDisplay[] => {\r\n    const { data, options, replaceVariables } = this.props;\r\n    return getFieldDisplayValues({\r\n      fieldOptions: options.fieldOptions,\r\n      replaceVariables,\r\n      theme: config.theme,\r\n      data: data.series,\r\n      autoMinMax: true,\r\n    });\r\n  };\r\n\r\n  render() {\r\n    const { height, width, data, renderCounter } = this.props;\r\n    return (\r\n      <VizRepeater\r\n        getValues={this.getValues}\r\n        renderValue={this.renderValue}\r\n        width={width}\r\n        height={height}\r\n        source={data}\r\n        renderCounter={renderCounter}\r\n        orientation={VizOrientation.Auto}\r\n      />\r\n    );\r\n  }\r\n}\r\n","// Libraries\r\nimport React, { PureComponent } from 'react';\r\nimport {\r\n  ThresholdsEditor,\r\n  PanelOptionsGrid,\r\n  ValueMappingsEditor,\r\n  FieldDisplayEditor,\r\n  FieldPropertiesEditor,\r\n  Switch,\r\n  PanelOptionsGroup,\r\n  DataLinksEditor,\r\n} from '@grafana/ui';\r\nimport {\r\n  PanelEditorProps,\r\n  FieldDisplayOptions,\r\n  ThresholdsConfig,\r\n  ValueMapping,\r\n  FieldConfig,\r\n  DataLink,\r\n} from '@grafana/data';\r\n\r\nimport { GaugeOptions } from './types';\r\nimport {\r\n  getCalculationValueDataLinksVariableSuggestions,\r\n  getDataLinksVariableSuggestions,\r\n} from 'app/features/panel/panellinks/link_srv';\r\nimport { config } from 'app/core/config';\r\n\r\nexport class GaugePanelEditor extends PureComponent<PanelEditorProps<GaugeOptions>> {\r\n  labelWidth = 6;\r\n\r\n  onToggleThresholdLabels = () =>\r\n    this.props.onOptionsChange({ ...this.props.options, showThresholdLabels: !this.props.options.showThresholdLabels });\r\n\r\n  onToggleThresholdMarkers = () =>\r\n    this.props.onOptionsChange({\r\n      ...this.props.options,\r\n      showThresholdMarkers: !this.props.options.showThresholdMarkers,\r\n    });\r\n\r\n  onThresholdsChanged = (thresholds: ThresholdsConfig) => {\r\n    const current = this.props.options.fieldOptions.defaults;\r\n    this.onDefaultsChange({\r\n      ...current,\r\n      thresholds,\r\n    });\r\n  };\r\n\r\n  onValueMappingsChanged = (mappings: ValueMapping[]) => {\r\n    const current = this.props.options.fieldOptions.defaults;\r\n    this.onDefaultsChange({\r\n      ...current,\r\n      mappings,\r\n    });\r\n  };\r\n\r\n  onDisplayOptionsChanged = (\r\n    fieldOptions: FieldDisplayOptions,\r\n    event?: React.SyntheticEvent<HTMLElement>,\r\n    callback?: () => void\r\n  ) =>\r\n    this.props.onOptionsChange(\r\n      {\r\n        ...this.props.options,\r\n        fieldOptions,\r\n      },\r\n      callback\r\n    );\r\n\r\n  onDefaultsChange = (field: FieldConfig, event?: React.SyntheticEvent<HTMLElement>, callback?: () => void) => {\r\n    this.onDisplayOptionsChanged(\r\n      {\r\n        ...this.props.options.fieldOptions,\r\n        defaults: field,\r\n      },\r\n      event,\r\n      callback\r\n    );\r\n  };\r\n\r\n  onDataLinksChanged = (links: DataLink[], callback?: () => void) => {\r\n    this.onDefaultsChange(\r\n      {\r\n        ...this.props.options.fieldOptions.defaults,\r\n        links,\r\n      },\r\n      undefined,\r\n      callback\r\n    );\r\n  };\r\n\r\n  render() {\r\n    const { options } = this.props;\r\n    const { fieldOptions, showThresholdLabels, showThresholdMarkers } = options;\r\n    const { defaults } = fieldOptions;\r\n\r\n    const suggestions = fieldOptions.values\r\n      ? getDataLinksVariableSuggestions(this.props.data.series)\r\n      : getCalculationValueDataLinksVariableSuggestions(this.props.data.series);\r\n\r\n    return (\r\n      <>\r\n        <PanelOptionsGrid>\r\n          <PanelOptionsGroup title=\"Display\">\r\n            <FieldDisplayEditor\r\n              onChange={this.onDisplayOptionsChanged}\r\n              value={fieldOptions}\r\n              labelWidth={this.labelWidth}\r\n            />\r\n            <Switch\r\n              label=\"Labels\"\r\n              labelClass={`width-${this.labelWidth}`}\r\n              checked={showThresholdLabels}\r\n              onChange={this.onToggleThresholdLabels}\r\n            />\r\n            <Switch\r\n              label=\"Markers\"\r\n              labelClass={`width-${this.labelWidth}`}\r\n              checked={showThresholdMarkers}\r\n              onChange={this.onToggleThresholdMarkers}\r\n            />\r\n          </PanelOptionsGroup>\r\n\r\n          <PanelOptionsGroup title=\"Field\">\r\n            <FieldPropertiesEditor\r\n              showMinMax={true}\r\n              showTitle={true}\r\n              onChange={this.onDefaultsChange}\r\n              value={defaults}\r\n            />\r\n          </PanelOptionsGroup>\r\n\r\n          <ThresholdsEditor\r\n            onChange={this.onThresholdsChanged}\r\n            thresholds={defaults.thresholds}\r\n            theme={config.theme}\r\n            showAlphaUI={config.featureToggles.newEdit}\r\n          />\r\n        </PanelOptionsGrid>\r\n\r\n        <ValueMappingsEditor onChange={this.onValueMappingsChanged} valueMappings={defaults.mappings} />\r\n\r\n        <PanelOptionsGroup title=\"Data links\">\r\n          <DataLinksEditor\r\n            value={defaults.links}\r\n            onChange={this.onDataLinksChanged}\r\n            suggestions={suggestions}\r\n            maxLinks={10}\r\n          />\r\n        </PanelOptionsGroup>\r\n      </>\r\n    );\r\n  }\r\n}\r\n","import { PanelPlugin } from '@grafana/data';\r\nimport { GaugePanelEditor } from './GaugePanelEditor';\r\nimport { GaugePanel } from './GaugePanel';\r\nimport { GaugeOptions, defaults } from './types';\r\nimport { gaugePanelMigrationHandler, gaugePanelChangedHandler } from './GaugeMigrations';\r\n\r\nexport const plugin = new PanelPlugin<GaugeOptions>(GaugePanel)\r\n  .setDefaults(defaults)\r\n  .setEditor(GaugePanelEditor)\r\n  .setPanelChangeHandler(gaugePanelChangedHandler)\r\n  .setMigrationHandler(gaugePanelMigrationHandler);\r\n","import { VizOrientation, FieldDisplayOptions, SelectableValue } from '@grafana/data';\r\nimport { SingleStatBaseOptions } from '@grafana/ui/src/components/SingleStatShared/SingleStatBaseOptions';\r\nimport { standardFieldDisplayOptions } from '../stat/types';\r\n\r\nexport interface GaugeOptions extends SingleStatBaseOptions {\r\n  showThresholdLabels: boolean;\r\n  showThresholdMarkers: boolean;\r\n}\r\n\r\nexport const standardGaugeFieldOptions: FieldDisplayOptions = {\r\n  ...standardFieldDisplayOptions,\r\n};\r\n\r\nexport const orientationOptions: Array<SelectableValue<VizOrientation>> = [\r\n  { value: VizOrientation.Auto, label: 'Auto' },\r\n  { value: VizOrientation.Horizontal, label: 'Horizontal' },\r\n  { value: VizOrientation.Vertical, label: 'Vertical' },\r\n];\r\n\r\nexport const defaults: GaugeOptions = {\r\n  showThresholdMarkers: true,\r\n  showThresholdLabels: false,\r\n  fieldOptions: standardGaugeFieldOptions,\r\n  orientation: VizOrientation.Auto,\r\n};\r\n","// Libraries\r\nimport React, { PureComponent } from 'react';\r\n\r\nimport { PanelProps } from '@grafana/data';\r\nimport { getDatasourceSrv } from 'app/features/plugins/datasource_srv';\r\nimport { getBackendSrv } from 'app/core/services/backend_srv';\r\nimport { contextSrv } from 'app/core/core';\r\nimport { getDashboardSrv } from 'app/features/dashboard/services/DashboardSrv';\r\n\r\ninterface Step {\r\n  title: string;\r\n  cta?: string;\r\n  icon: string;\r\n  href: string;\r\n  target?: string;\r\n  note?: string;\r\n  check: () => Promise<boolean>;\r\n  done?: boolean;\r\n}\r\n\r\ninterface State {\r\n  checksDone: boolean;\r\n}\r\n\r\nexport class GettingStarted extends PureComponent<PanelProps, State> {\r\n  stepIndex = 0;\r\n  readonly steps: Step[];\r\n\r\n  constructor(props: PanelProps) {\r\n    super(props);\r\n\r\n    this.state = {\r\n      checksDone: false,\r\n    };\r\n\r\n    this.steps = [\r\n      {\r\n        title: 'Install Grafana',\r\n        icon: 'icon-gf icon-gf-check',\r\n        href: 'http://docs.grafana.org/',\r\n        target: '_blank',\r\n        note: 'Review the installation docs',\r\n        check: () => Promise.resolve(true),\r\n      },\r\n      {\r\n        title: 'Create a data source',\r\n        cta: 'Add data source',\r\n        icon: 'gicon gicon-datasources',\r\n        href: 'datasources/new?gettingstarted',\r\n        check: () => {\r\n          return new Promise(resolve => {\r\n            resolve(\r\n              getDatasourceSrv()\r\n                .getMetricSources()\r\n                .filter(item => {\r\n                  return item.meta.builtIn !== true;\r\n                }).length > 0\r\n            );\r\n          });\r\n        },\r\n      },\r\n      {\r\n        title: 'Build a dashboard',\r\n        cta: 'New dashboard',\r\n        icon: 'gicon gicon-dashboard',\r\n        href: 'dashboard/new?gettingstarted',\r\n        check: () => {\r\n          return getBackendSrv()\r\n            .search({ limit: 1 })\r\n            .then(result => {\r\n              return result.length > 0;\r\n            });\r\n        },\r\n      },\r\n      {\r\n        title: 'Invite your team',\r\n        cta: 'Add Users',\r\n        icon: 'gicon gicon-team',\r\n        href: 'org/users?gettingstarted',\r\n        check: () => {\r\n          return getBackendSrv()\r\n            .get('/api/org/users/lookup')\r\n            .then((res: any) => {\r\n              /* return res.length > 1; */\r\n              return false;\r\n            });\r\n        },\r\n      },\r\n      {\r\n        title: 'Install apps & plugins',\r\n        cta: 'Explore plugin repository',\r\n        icon: 'gicon gicon-plugins',\r\n        href: 'https://grafana.com/plugins?utm_source=grafana_getting_started',\r\n        check: () => {\r\n          return getBackendSrv()\r\n            .get('/api/plugins', { embedded: 0, core: 0 })\r\n            .then((plugins: any[]) => {\r\n              return plugins.length > 0;\r\n            });\r\n        },\r\n      },\r\n    ];\r\n  }\r\n\r\n  componentDidMount() {\r\n    this.stepIndex = -1;\r\n    return this.nextStep().then((res: any) => {\r\n      this.setState({ checksDone: true });\r\n    });\r\n  }\r\n\r\n  nextStep(): any {\r\n    if (this.stepIndex === this.steps.length - 1) {\r\n      return Promise.resolve();\r\n    }\r\n\r\n    this.stepIndex += 1;\r\n    const currentStep = this.steps[this.stepIndex];\r\n    return currentStep.check().then(passed => {\r\n      if (passed) {\r\n        currentStep.done = true;\r\n        return this.nextStep();\r\n      }\r\n      return Promise.resolve();\r\n    });\r\n  }\r\n\r\n  dismiss = () => {\r\n    const { id } = this.props;\r\n    const dashboard = getDashboardSrv().getCurrent();\r\n    const panel = dashboard.getPanelById(id);\r\n    dashboard.removePanel(panel);\r\n    getBackendSrv()\r\n      .request({\r\n        method: 'PUT',\r\n        url: '/api/user/helpflags/1',\r\n        showSuccessAlert: false,\r\n      })\r\n      .then((res: any) => {\r\n        contextSrv.user.helpFlags1 = res.helpFlags1;\r\n      });\r\n  };\r\n\r\n  render() {\r\n    const { checksDone } = this.state;\r\n    if (!checksDone) {\r\n      return <div>checking...</div>;\r\n    }\r\n\r\n    return (\r\n      <div className=\"progress-tracker-container\">\r\n        <button className=\"progress-tracker-close-btn\" onClick={this.dismiss}>\r\n          <i className=\"fa fa-remove\" />\r\n        </button>\r\n        <div className=\"progress-tracker\">\r\n          {this.steps.map((step, index) => {\r\n            return (\r\n              <div key={index} className={step.done ? 'progress-step completed' : 'progress-step active'}>\r\n                <a className=\"progress-link\" href={step.href} target={step.target} title={step.note}>\r\n                  <span className=\"progress-marker\">\r\n                    <i className={step.icon} />\r\n                  </span>\r\n                  <span className=\"progress-text\">{step.title}</span>\r\n                </a>\r\n                <a className=\"btn-small progress-step-cta\" href={step.href} target={step.target}>\r\n                  {step.cta}\r\n                </a>\r\n              </div>\r\n            );\r\n          })}\r\n        </div>\r\n      </div>\r\n    );\r\n  }\r\n}\r\n","import { PanelPlugin } from '@grafana/data';\r\nimport { GettingStarted } from './GettingStarted';\r\n\r\n// Simplest possible panel plugin\r\nexport const plugin = new PanelPlugin(GettingStarted);\r\n","import { ContextMenuItem } from '@grafana/ui';\r\nimport { FlotDataPoint } from '@grafana/data';\r\n\r\nexport class GraphContextMenuCtrl {\r\n  private source?: FlotDataPoint | null;\r\n  private scope?: any;\r\n  menuItemsSupplier?: () => ContextMenuItem[];\r\n  scrollContextElement: HTMLElement | null;\r\n  position: {\r\n    x: number;\r\n    y: number;\r\n  };\r\n\r\n  isVisible: boolean;\r\n\r\n  constructor($scope: any) {\r\n    this.isVisible = false;\r\n    this.scope = $scope;\r\n  }\r\n\r\n  onClose = () => {\r\n    if (this.scrollContextElement) {\r\n      this.scrollContextElement.removeEventListener('scroll', this.onClose);\r\n    }\r\n\r\n    this.scope.$apply(() => {\r\n      this.isVisible = false;\r\n    });\r\n  };\r\n\r\n  toggleMenu = (event?: { pageX: number; pageY: number }) => {\r\n    this.isVisible = !this.isVisible;\r\n    if (this.isVisible && this.scrollContextElement) {\r\n      this.scrollContextElement.addEventListener('scroll', this.onClose);\r\n    }\r\n\r\n    if (this.source) {\r\n      this.position = {\r\n        x: this.source.pageX,\r\n        y: this.source.pageY,\r\n      };\r\n    } else {\r\n      this.position = {\r\n        x: event ? event.pageX : 0,\r\n        y: event ? event.pageY : 0,\r\n      };\r\n    }\r\n  };\r\n\r\n  // Sets element which is considered as a scroll context of given context menu.\r\n  // Having access to this element allows scroll event attachement for menu to be closed when user scrolls\r\n  setScrollContextElement = (el: HTMLElement | null) => {\r\n    this.scrollContextElement = el;\r\n  };\r\n\r\n  setSource = (source: FlotDataPoint | null) => {\r\n    this.source = source;\r\n  };\r\n\r\n  getSource = () => {\r\n    return this.source;\r\n  };\r\n\r\n  setMenuItemsSupplier = (menuItemsSupplier: () => ContextMenuItem[]) => {\r\n    this.menuItemsSupplier = menuItemsSupplier;\r\n  };\r\n}\r\n","import _ from 'lodash';\r\nimport React, { PureComponent } from 'react';\r\nimport { TimeSeries } from 'app/core/core';\r\nimport { CustomScrollbar } from '@grafana/ui';\r\nimport { LegendItem, LEGEND_STATS } from './LegendSeriesItem';\r\n\r\ntype Sort = 'min' | 'max' | 'avg' | 'current' | 'total';\r\ninterface LegendProps {\r\n  seriesList: TimeSeries[];\r\n  optionalClass?: string;\r\n}\r\n\r\ninterface LegendEventHandlers {\r\n  onToggleSeries?: (hiddenSeries: any) => void;\r\n  onToggleSort?: (sortBy: any, sortDesc: any) => void;\r\n  onToggleAxis?: (series: TimeSeries) => void;\r\n  onColorChange?: (series: TimeSeries, color: string) => void;\r\n}\r\n\r\ninterface LegendComponentEventHandlers {\r\n  onToggleSeries?: (series: TimeSeries, event: any) => void;\r\n  onToggleSort?: (sortBy: Sort, sortDesc: any) => void;\r\n  onToggleAxis?: (series: TimeSeries) => void;\r\n  onColorChange?: (series: TimeSeries, color: string) => void;\r\n}\r\n\r\ninterface LegendDisplayProps {\r\n  hiddenSeries: any;\r\n  hideEmpty?: boolean;\r\n  hideZero?: boolean;\r\n  alignAsTable?: boolean;\r\n  rightSide?: boolean;\r\n  sideWidth?: number;\r\n}\r\n\r\ninterface LegendValuesProps {\r\n  values?: boolean;\r\n  min?: boolean;\r\n  max?: boolean;\r\n  avg?: boolean;\r\n  current?: boolean;\r\n  total?: boolean;\r\n}\r\n\r\ninterface LegendSortProps {\r\n  sort?: Sort;\r\n  sortDesc?: boolean;\r\n}\r\n\r\nexport type GraphLegendProps = LegendProps &\r\n  LegendDisplayProps &\r\n  LegendValuesProps &\r\n  LegendSortProps &\r\n  LegendEventHandlers;\r\nexport type LegendComponentProps = LegendProps &\r\n  LegendDisplayProps &\r\n  LegendValuesProps &\r\n  LegendSortProps &\r\n  LegendComponentEventHandlers;\r\n\r\ninterface LegendState {\r\n  hiddenSeries: { [seriesAlias: string]: boolean };\r\n}\r\n\r\nexport class GraphLegend extends PureComponent<GraphLegendProps, LegendState> {\r\n  static defaultProps: Partial<GraphLegendProps> = {\r\n    values: false,\r\n    min: false,\r\n    max: false,\r\n    avg: false,\r\n    current: false,\r\n    total: false,\r\n    alignAsTable: false,\r\n    rightSide: false,\r\n    sort: undefined,\r\n    sortDesc: false,\r\n    optionalClass: '',\r\n    onToggleSeries: () => {},\r\n    onToggleSort: () => {},\r\n    onToggleAxis: () => {},\r\n    onColorChange: () => {},\r\n  };\r\n\r\n  constructor(props: GraphLegendProps) {\r\n    super(props);\r\n    this.state = {\r\n      hiddenSeries: this.props.hiddenSeries,\r\n    };\r\n  }\r\n\r\n  sortLegend() {\r\n    let seriesList: TimeSeries[] = [...this.props.seriesList] || [];\r\n    if (this.props.sort && this.props[this.props.sort] && this.props.alignAsTable) {\r\n      seriesList = _.sortBy(seriesList, series => {\r\n        let sort = series.stats[this.props.sort];\r\n        if (sort === null) {\r\n          sort = -Infinity;\r\n        }\r\n        return sort;\r\n      }) as TimeSeries[];\r\n      if (this.props.sortDesc) {\r\n        seriesList = seriesList.reverse();\r\n      }\r\n    }\r\n    return seriesList;\r\n  }\r\n\r\n  onToggleSeries = (series: TimeSeries, event: any) => {\r\n    let hiddenSeries = { ...this.state.hiddenSeries };\r\n    if (event.ctrlKey || event.metaKey || event.shiftKey) {\r\n      if (hiddenSeries[series.alias]) {\r\n        delete hiddenSeries[series.alias];\r\n      } else {\r\n        hiddenSeries[series.alias] = true;\r\n      }\r\n    } else {\r\n      hiddenSeries = this.toggleSeriesExclusiveMode(series);\r\n    }\r\n    this.setState({ hiddenSeries: hiddenSeries });\r\n    this.props.onToggleSeries(hiddenSeries);\r\n  };\r\n\r\n  toggleSeriesExclusiveMode(series: TimeSeries) {\r\n    const hiddenSeries = { ...this.state.hiddenSeries };\r\n\r\n    if (hiddenSeries[series.alias]) {\r\n      delete hiddenSeries[series.alias];\r\n    }\r\n\r\n    // check if every other series is hidden\r\n    const alreadyExclusive = this.props.seriesList.every(value => {\r\n      if (value.alias === series.alias) {\r\n        return true;\r\n      }\r\n\r\n      return hiddenSeries[value.alias];\r\n    });\r\n\r\n    if (alreadyExclusive) {\r\n      // remove all hidden series\r\n      this.props.seriesList.forEach(value => {\r\n        delete hiddenSeries[value.alias];\r\n      });\r\n    } else {\r\n      // hide all but this serie\r\n      this.props.seriesList.forEach(value => {\r\n        if (value.alias === series.alias) {\r\n          return;\r\n        }\r\n\r\n        hiddenSeries[value.alias] = true;\r\n      });\r\n    }\r\n\r\n    return hiddenSeries;\r\n  }\r\n\r\n  render() {\r\n    const {\r\n      optionalClass,\r\n      rightSide,\r\n      sideWidth,\r\n      sort,\r\n      sortDesc,\r\n      hideEmpty,\r\n      hideZero,\r\n      values,\r\n      min,\r\n      max,\r\n      avg,\r\n      current,\r\n      total,\r\n    } = this.props;\r\n    const seriesValuesProps = { values, min, max, avg, current, total };\r\n    const hiddenSeries = this.state.hiddenSeries;\r\n    const seriesHideProps = { hideEmpty, hideZero };\r\n    const sortProps = { sort, sortDesc };\r\n    const seriesList = this.sortLegend().filter(series => !series.hideFromLegend(seriesHideProps));\r\n    const legendClass = `${this.props.alignAsTable ? 'graph-legend-table' : ''} ${optionalClass}`;\r\n\r\n    // Set min-width if side style and there is a value, otherwise remove the CSS property\r\n    // Set width so it works with IE11\r\n    const width: any = rightSide && sideWidth ? sideWidth : undefined;\r\n    const ieWidth: any = rightSide && sideWidth ? sideWidth - 1 : undefined;\r\n    const legendStyle: React.CSSProperties = {\r\n      minWidth: width,\r\n      width: ieWidth,\r\n    };\r\n\r\n    const legendProps: LegendComponentProps = {\r\n      seriesList: seriesList,\r\n      hiddenSeries: hiddenSeries,\r\n      onToggleSeries: this.onToggleSeries,\r\n      onToggleAxis: this.props.onToggleAxis,\r\n      onToggleSort: this.props.onToggleSort,\r\n      onColorChange: this.props.onColorChange,\r\n      ...seriesValuesProps,\r\n      ...sortProps,\r\n    };\r\n\r\n    return (\r\n      <div className={`graph-legend-content ${legendClass}`} style={legendStyle}>\r\n        {this.props.alignAsTable ? <LegendTable {...legendProps} /> : <LegendSeriesList {...legendProps} />}\r\n      </div>\r\n    );\r\n  }\r\n}\r\n\r\nclass LegendSeriesList extends PureComponent<LegendComponentProps> {\r\n  render() {\r\n    const { seriesList, hiddenSeries, values, min, max, avg, current, total } = this.props;\r\n    const seriesValuesProps = { values, min, max, avg, current, total };\r\n    return seriesList.map((series, i) => (\r\n      <LegendItem\r\n        // This trick required because TimeSeries.id is not unique (it's just TimeSeries.alias).\r\n        // In future would be good to make id unique across the series list.\r\n        key={`${series.id}-${i}`}\r\n        series={series}\r\n        hidden={hiddenSeries[series.alias]}\r\n        {...seriesValuesProps}\r\n        onLabelClick={this.props.onToggleSeries}\r\n        onColorChange={this.props.onColorChange}\r\n        onToggleAxis={this.props.onToggleAxis}\r\n      />\r\n    ));\r\n  }\r\n}\r\n\r\nclass LegendTable extends PureComponent<Partial<LegendComponentProps>> {\r\n  onToggleSort = (stat: Sort) => {\r\n    let sortDesc = this.props.sortDesc;\r\n    let sortBy = this.props.sort;\r\n    if (stat !== sortBy) {\r\n      sortDesc = null;\r\n    }\r\n\r\n    // if already sort ascending, disable sorting\r\n    if (sortDesc === false) {\r\n      sortBy = null;\r\n      sortDesc = null;\r\n    } else {\r\n      sortDesc = !sortDesc;\r\n      sortBy = stat;\r\n    }\r\n    this.props.onToggleSort(sortBy, sortDesc);\r\n  };\r\n\r\n  render() {\r\n    const seriesList = this.props.seriesList;\r\n    const { values, min, max, avg, current, total, sort, sortDesc, hiddenSeries } = this.props;\r\n    const seriesValuesProps: any = { values, min, max, avg, current, total };\r\n    return (\r\n      <table>\r\n        <colgroup>\r\n          <col style={{ width: '100%' }} />\r\n        </colgroup>\r\n        <thead>\r\n          <tr>\r\n            <th style={{ textAlign: 'left' }} />\r\n            {LEGEND_STATS.map(\r\n              statName =>\r\n                seriesValuesProps[statName] && (\r\n                  <LegendTableHeaderItem\r\n                    key={statName}\r\n                    statName={statName}\r\n                    sort={sort}\r\n                    sortDesc={sortDesc}\r\n                    onClick={this.onToggleSort}\r\n                  />\r\n                )\r\n            )}\r\n          </tr>\r\n        </thead>\r\n        <tbody>\r\n          {seriesList.map((series, i) => (\r\n            <LegendItem\r\n              key={`${series.id}-${i}`}\r\n              asTable={true}\r\n              series={series}\r\n              hidden={hiddenSeries[series.alias]}\r\n              onLabelClick={this.props.onToggleSeries}\r\n              onColorChange={this.props.onColorChange}\r\n              onToggleAxis={this.props.onToggleAxis}\r\n              {...seriesValuesProps}\r\n            />\r\n          ))}\r\n        </tbody>\r\n      </table>\r\n    );\r\n  }\r\n}\r\n\r\ninterface LegendTableHeaderProps {\r\n  statName: string;\r\n  onClick?: (statName: string) => void;\r\n}\r\n\r\nclass LegendTableHeaderItem extends PureComponent<LegendTableHeaderProps & LegendSortProps> {\r\n  onClick = () => this.props.onClick(this.props.statName);\r\n\r\n  render() {\r\n    const { statName, sort, sortDesc } = this.props;\r\n    return (\r\n      <th className=\"pointer\" onClick={this.onClick}>\r\n        {statName}\r\n        {sort === statName && <span className={sortDesc ? 'fa fa-caret-down' : 'fa fa-caret-up'} />}\r\n      </th>\r\n    );\r\n  }\r\n}\r\n\r\nexport class Legend extends PureComponent<GraphLegendProps> {\r\n  render() {\r\n    return (\r\n      <CustomScrollbar hideHorizontalTrack>\r\n        <GraphLegend {...this.props} />\r\n      </CustomScrollbar>\r\n    );\r\n  }\r\n}\r\n\r\nexport default Legend;\r\n","import React, { PureComponent } from 'react';\r\nimport classNames from 'classnames';\r\nimport { TimeSeries } from 'app/core/core';\r\nimport { SeriesColorPicker } from '@grafana/ui';\r\n\r\nexport const LEGEND_STATS = ['min', 'max', 'avg', 'current', 'total'];\r\n\r\nexport interface LegendLabelProps {\r\n  series: TimeSeries;\r\n  asTable?: boolean;\r\n  hidden?: boolean;\r\n  onLabelClick: (series: any, event: any) => void;\r\n  onColorChange: (series: any, color: string) => void;\r\n  onToggleAxis: (series: any) => void;\r\n}\r\n\r\nexport interface LegendValuesProps {\r\n  values?: boolean;\r\n  min?: boolean;\r\n  max?: boolean;\r\n  avg?: boolean;\r\n  current?: boolean;\r\n  total?: boolean;\r\n}\r\n\r\ntype LegendItemProps = LegendLabelProps & LegendValuesProps;\r\n\r\ninterface LegendItemState {\r\n  yaxis: number;\r\n}\r\n\r\nexport class LegendItem extends PureComponent<LegendItemProps, LegendItemState> {\r\n  static defaultProps = {\r\n    asTable: false,\r\n    hidden: false,\r\n    onLabelClick: () => {},\r\n    onColorChange: () => {},\r\n    onToggleAxis: () => {},\r\n  };\r\n\r\n  constructor(props: LegendItemProps) {\r\n    super(props);\r\n    this.state = {\r\n      yaxis: this.props.series.yaxis,\r\n    };\r\n  }\r\n\r\n  onLabelClick = (e: any) => this.props.onLabelClick(this.props.series, e);\r\n\r\n  onToggleAxis = () => {\r\n    const yaxis = this.state.yaxis === 2 ? 1 : 2;\r\n    const info = { alias: this.props.series.alias, yaxis: yaxis };\r\n    this.setState({ yaxis: yaxis });\r\n    this.props.onToggleAxis(info);\r\n  };\r\n\r\n  onColorChange = (color: string) => {\r\n    this.props.onColorChange(this.props.series, color);\r\n    // Because of PureComponent nature it makes only shallow props comparison and changing of series.color doesn't run\r\n    // component re-render. In this case we can't rely on color, selected by user, because it may be overwritten\r\n    // by series overrides. So we need to use forceUpdate() to make sure we have proper series color.\r\n    this.forceUpdate();\r\n  };\r\n\r\n  renderLegendValues() {\r\n    const { series, asTable } = this.props;\r\n    const legendValueItems = [];\r\n    for (const valueName of LEGEND_STATS) {\r\n      // @ts-ignore\r\n      if (this.props[valueName]) {\r\n        const valueFormatted = series.formatValue(series.stats[valueName]);\r\n        legendValueItems.push(\r\n          <LegendValue key={valueName} valueName={valueName} value={valueFormatted} asTable={asTable} />\r\n        );\r\n      }\r\n    }\r\n    return legendValueItems;\r\n  }\r\n\r\n  render() {\r\n    const { series, values, asTable, hidden } = this.props;\r\n    const seriesOptionClasses = classNames({\r\n      'graph-legend-series-hidden': hidden,\r\n      'graph-legend-series--right-y': series.yaxis === 2,\r\n    });\r\n    const valueItems = values ? this.renderLegendValues() : [];\r\n    const seriesLabel = (\r\n      <LegendSeriesLabel\r\n        label={series.alias}\r\n        color={series.color}\r\n        yaxis={this.state.yaxis}\r\n        onLabelClick={this.onLabelClick}\r\n        onColorChange={this.onColorChange}\r\n        onToggleAxis={this.onToggleAxis}\r\n      />\r\n    );\r\n\r\n    if (asTable) {\r\n      return (\r\n        <tr className={`graph-legend-series ${seriesOptionClasses}`}>\r\n          <td>{seriesLabel}</td>\r\n          {valueItems}\r\n        </tr>\r\n      );\r\n    } else {\r\n      return (\r\n        <div className={`graph-legend-series ${seriesOptionClasses}`}>\r\n          {seriesLabel}\r\n          {valueItems}\r\n        </div>\r\n      );\r\n    }\r\n  }\r\n}\r\n\r\ninterface LegendSeriesLabelProps {\r\n  label: string;\r\n  color: string;\r\n  yaxis?: number;\r\n  onLabelClick?: (event: any) => void;\r\n}\r\n\r\nclass LegendSeriesLabel extends PureComponent<LegendSeriesLabelProps & LegendSeriesIconProps> {\r\n  static defaultProps: Partial<LegendSeriesLabelProps> = {\r\n    yaxis: undefined,\r\n    onLabelClick: () => {},\r\n  };\r\n\r\n  render() {\r\n    const { label, color, yaxis } = this.props;\r\n    const { onColorChange, onToggleAxis } = this.props;\r\n    return [\r\n      <LegendSeriesIcon\r\n        key=\"icon\"\r\n        color={color}\r\n        yaxis={yaxis}\r\n        onColorChange={onColorChange}\r\n        onToggleAxis={onToggleAxis}\r\n      />,\r\n      <a className=\"graph-legend-alias pointer\" title={label} key=\"label\" onClick={e => this.props.onLabelClick(e)}>\r\n        {label}\r\n      </a>,\r\n    ];\r\n  }\r\n}\r\n\r\ninterface LegendSeriesIconProps {\r\n  color: string;\r\n  yaxis?: number;\r\n  onColorChange?: (color: string) => void;\r\n  onToggleAxis?: () => void;\r\n}\r\n\r\ninterface LegendSeriesIconState {\r\n  color: string;\r\n}\r\n\r\nfunction SeriesIcon({ color }: { color: string }) {\r\n  return <i className=\"fa fa-minus pointer\" style={{ color }} />;\r\n}\r\n\r\nclass LegendSeriesIcon extends PureComponent<LegendSeriesIconProps, LegendSeriesIconState> {\r\n  static defaultProps: Partial<LegendSeriesIconProps> = {\r\n    yaxis: undefined,\r\n    onColorChange: () => {},\r\n    onToggleAxis: () => {},\r\n  };\r\n\r\n  render() {\r\n    return (\r\n      <SeriesColorPicker\r\n        yaxis={this.props.yaxis}\r\n        color={this.props.color}\r\n        onChange={this.props.onColorChange}\r\n        onToggleAxis={this.props.onToggleAxis}\r\n        enableNamedColors\r\n      >\r\n        {({ ref, showColorPicker, hideColorPicker }) => (\r\n          <span ref={ref} onClick={showColorPicker} onMouseLeave={hideColorPicker} className=\"graph-legend-icon\">\r\n            <SeriesIcon color={this.props.color} />\r\n          </span>\r\n        )}\r\n      </SeriesColorPicker>\r\n    );\r\n  }\r\n}\r\n\r\ninterface LegendValueProps {\r\n  value: string;\r\n  valueName: string;\r\n  asTable?: boolean;\r\n}\r\n\r\nfunction LegendValue(props: LegendValueProps) {\r\n  const value = props.value;\r\n  const valueName = props.valueName;\r\n  if (props.asTable) {\r\n    return <td className={`graph-legend-value ${valueName}`}>{value}</td>;\r\n  }\r\n  return <div className={`graph-legend-value ${valueName}`}>{value}</div>;\r\n}\r\n","import _ from 'lodash';\r\n\r\n/**\r\n * To align two Y axes by Y level\r\n * @param yAxes data [{min: min_y1, min: max_y1}, {min: min_y2, max: max_y2}]\r\n * @param level Y level\r\n */\r\nexport function alignYLevel(yAxes: any, level: any) {\r\n  if (isNaN(level) || !checkCorrectAxis(yAxes)) {\r\n    return;\r\n  }\r\n\r\n  const [yLeft, yRight] = yAxes;\r\n  moveLevelToZero(yLeft, yRight, level);\r\n\r\n  expandStuckValues(yLeft, yRight);\r\n\r\n  // one of graphs on zero\r\n  const zero = yLeft.min === 0 || yRight.min === 0 || yLeft.max === 0 || yRight.max === 0;\r\n\r\n  const oneSide = checkOneSide(yLeft, yRight);\r\n\r\n  if (zero && oneSide) {\r\n    yLeft.min = yLeft.max > 0 ? 0 : yLeft.min;\r\n    yLeft.max = yLeft.max > 0 ? yLeft.max : 0;\r\n    yRight.min = yRight.max > 0 ? 0 : yRight.min;\r\n    yRight.max = yRight.max > 0 ? yRight.max : 0;\r\n  } else {\r\n    if (checkOppositeSides(yLeft, yRight)) {\r\n      if (yLeft.min >= 0) {\r\n        yLeft.min = -yLeft.max;\r\n        yRight.max = -yRight.min;\r\n      } else {\r\n        yLeft.max = -yLeft.min;\r\n        yRight.min = -yRight.max;\r\n      }\r\n    } else {\r\n      const rate = getRate(yLeft, yRight);\r\n\r\n      if (oneSide) {\r\n        // all graphs above the Y level\r\n        if (yLeft.min > 0) {\r\n          yLeft.min = yLeft.max / rate;\r\n          yRight.min = yRight.max / rate;\r\n        } else {\r\n          yLeft.max = yLeft.min / rate;\r\n          yRight.max = yRight.min / rate;\r\n        }\r\n      } else {\r\n        if (checkTwoCross(yLeft, yRight)) {\r\n          yLeft.min = yRight.min ? yRight.min * rate : yLeft.min;\r\n          yRight.min = yLeft.min ? yLeft.min / rate : yRight.min;\r\n          yLeft.max = yRight.max ? yRight.max * rate : yLeft.max;\r\n          yRight.max = yLeft.max ? yLeft.max / rate : yRight.max;\r\n        } else {\r\n          yLeft.min = yLeft.min > 0 ? yRight.min * rate : yLeft.min;\r\n          yRight.min = yRight.min > 0 ? yLeft.min / rate : yRight.min;\r\n          yLeft.max = yLeft.max < 0 ? yRight.max * rate : yLeft.max;\r\n          yRight.max = yRight.max < 0 ? yLeft.max / rate : yRight.max;\r\n        }\r\n      }\r\n    }\r\n  }\r\n\r\n  restoreLevelFromZero(yLeft, yRight, level);\r\n}\r\n\r\nfunction expandStuckValues(yLeft: { max: number; min: number }, yRight: { max: number; min: number }) {\r\n  // wide Y min and max using increased wideFactor\r\n  const wideFactor = 0.25;\r\n  if (yLeft.max === yLeft.min) {\r\n    yLeft.min -= wideFactor;\r\n    yLeft.max += wideFactor;\r\n  }\r\n  if (yRight.max === yRight.min) {\r\n    yRight.min -= wideFactor;\r\n    yRight.max += wideFactor;\r\n  }\r\n}\r\n\r\nfunction moveLevelToZero(yLeft: { min: number; max: number }, yRight: { min: number; max: number }, level: number) {\r\n  if (level !== 0) {\r\n    yLeft.min -= level;\r\n    yLeft.max -= level;\r\n    yRight.min -= level;\r\n    yRight.max -= level;\r\n  }\r\n}\r\n\r\nfunction restoreLevelFromZero(\r\n  yLeft: { min: number; max: number },\r\n  yRight: { min: number; max: number },\r\n  level: number\r\n) {\r\n  if (level !== 0) {\r\n    yLeft.min += level;\r\n    yLeft.max += level;\r\n    yRight.min += level;\r\n    yRight.max += level;\r\n  }\r\n}\r\n\r\ninterface AxisSide {\r\n  max: number;\r\n  min: number;\r\n}\r\n\r\nfunction checkCorrectAxis(axis: any[]) {\r\n  return axis.length === 2 && checkCorrectAxes(axis[0]) && checkCorrectAxes(axis[1]);\r\n}\r\n\r\nfunction checkCorrectAxes(axes: any) {\r\n  return 'min' in axes && 'max' in axes;\r\n}\r\n\r\nfunction checkOneSide(yLeft: AxisSide, yRight: AxisSide) {\r\n  // on the one hand with respect to zero\r\n  return (yLeft.min >= 0 && yRight.min >= 0) || (yLeft.max <= 0 && yRight.max <= 0);\r\n}\r\n\r\nfunction checkTwoCross(yLeft: AxisSide, yRight: AxisSide) {\r\n  // both across zero\r\n  return yLeft.min <= 0 && yLeft.max >= 0 && yRight.min <= 0 && yRight.max >= 0;\r\n}\r\n\r\nfunction checkOppositeSides(yLeft: AxisSide, yRight: AxisSide) {\r\n  // on the opposite sides with respect to zero\r\n  return (yLeft.min >= 0 && yRight.max <= 0) || (yLeft.max <= 0 && yRight.min >= 0);\r\n}\r\n\r\nfunction getRate(yLeft: AxisSide, yRight: AxisSide) {\r\n  let rateLeft, rateRight, rate;\r\n  if (checkTwoCross(yLeft, yRight)) {\r\n    rateLeft = yRight.min ? yLeft.min / yRight.min : 0;\r\n    rateRight = yRight.max ? yLeft.max / yRight.max : 0;\r\n  } else {\r\n    if (checkOneSide(yLeft, yRight)) {\r\n      const absLeftMin = Math.abs(yLeft.min);\r\n      const absLeftMax = Math.abs(yLeft.max);\r\n      const absRightMin = Math.abs(yRight.min);\r\n      const absRightMax = Math.abs(yRight.max);\r\n      const upLeft = _.max([absLeftMin, absLeftMax]);\r\n      const downLeft = _.min([absLeftMin, absLeftMax]);\r\n      const upRight = _.max([absRightMin, absRightMax]);\r\n      const downRight = _.min([absRightMin, absRightMax]);\r\n\r\n      rateLeft = downLeft ? upLeft / downLeft : upLeft;\r\n      rateRight = downRight ? upRight / downRight : upRight;\r\n    } else {\r\n      if (yLeft.min > 0 || yRight.min > 0) {\r\n        rateLeft = yLeft.max / yRight.max;\r\n        rateRight = 0;\r\n      } else {\r\n        rateLeft = 0;\r\n        rateRight = yLeft.min / yRight.min;\r\n      }\r\n    }\r\n  }\r\n\r\n  rate = rateLeft > rateRight ? rateLeft : rateRight;\r\n\r\n  return rate;\r\n}\r\n","import { e2e } from '@grafana/e2e';\r\nimport { GraphCtrl } from './module';\r\n\r\nexport class AxesEditorCtrl {\r\n  panel: any;\r\n  panelCtrl: GraphCtrl;\r\n  logScales: any;\r\n  xAxisModes: any;\r\n  xAxisStatOptions: any;\r\n  xNameSegment: any;\r\n  selectors: typeof e2e.pages.Dashboard.Panels.Visualization.Graph.VisualizationTab.selectors;\r\n\r\n  /** @ngInject */\r\n  constructor(private $scope: any) {\r\n    this.panelCtrl = $scope.ctrl as GraphCtrl;\r\n    this.panel = this.panelCtrl.panel;\r\n    this.$scope.ctrl = this;\r\n\r\n    this.logScales = {\r\n      linear: 1,\r\n      'log (base 2)': 2,\r\n      'log (base 10)': 10,\r\n      'log (base 32)': 32,\r\n      'log (base 1024)': 1024,\r\n    };\r\n\r\n    this.xAxisModes = {\r\n      Time: 'time',\r\n      Series: 'series',\r\n      Histogram: 'histogram',\r\n      // 'Data field': 'field',\r\n    };\r\n\r\n    this.xAxisStatOptions = [\r\n      { text: 'Avg', value: 'avg' },\r\n      { text: 'Min', value: 'min' },\r\n      { text: 'Max', value: 'max' },\r\n      { text: 'Total', value: 'total' },\r\n      { text: 'Count', value: 'count' },\r\n      { text: 'Current', value: 'current' },\r\n    ];\r\n\r\n    if (this.panel.xaxis.mode === 'custom') {\r\n      if (!this.panel.xaxis.name) {\r\n        this.panel.xaxis.name = 'specify field';\r\n      }\r\n    }\r\n    this.selectors = e2e.pages.Dashboard.Panels.Visualization.Graph.VisualizationTab.selectors;\r\n  }\r\n\r\n  setUnitFormat(axis: { format: any }) {\r\n    return (unit: string) => {\r\n      axis.format = unit;\r\n      this.panelCtrl.render();\r\n    };\r\n  }\r\n\r\n  render() {\r\n    this.panelCtrl.render();\r\n  }\r\n\r\n  xAxisModeChanged() {\r\n    this.panelCtrl.processor.setPanelDefaultsForNewXAxisMode();\r\n    this.panelCtrl.onDataFramesReceived(this.panelCtrl.dataList);\r\n  }\r\n\r\n  xAxisValueChanged() {\r\n    this.panelCtrl.onDataFramesReceived(this.panelCtrl.dataList);\r\n  }\r\n}\r\n\r\n/** @ngInject */\r\nexport function axesEditorComponent() {\r\n  'use strict';\r\n  return {\r\n    restrict: 'E',\r\n    scope: true,\r\n    templateUrl: 'public/app/plugins/panel/graph/axes_editor.html',\r\n    controller: AxesEditorCtrl,\r\n  };\r\n}\r\n","import _ from 'lodash';\r\nimport { colors } from '@grafana/ui';\r\nimport { getColorFromHexRgbOrName, TimeRange, FieldType, Field, DataFrame, getTimeField } from '@grafana/data';\r\nimport TimeSeries from 'app/core/time_series2';\r\nimport config from 'app/core/config';\r\n\r\ntype Options = {\r\n  dataList: DataFrame[];\r\n  range?: TimeRange;\r\n};\r\n\r\nexport class DataProcessor {\r\n  constructor(private panel: any) {}\r\n\r\n  getSeriesList(options: Options): TimeSeries[] {\r\n    const list: TimeSeries[] = [];\r\n    const { dataList, range } = options;\r\n\r\n    if (!dataList || !dataList.length) {\r\n      return list;\r\n    }\r\n\r\n    for (let i = 0; i < dataList.length; i++) {\r\n      const series = dataList[i];\r\n      const { timeField } = getTimeField(series);\r\n      if (!timeField) {\r\n        continue;\r\n      }\r\n\r\n      const seriesName = series.name ? series.name : series.refId;\r\n      for (let j = 0; j < series.fields.length; j++) {\r\n        const field = series.fields[j];\r\n        if (field.type !== FieldType.number) {\r\n          continue;\r\n        }\r\n\r\n        let name = field.config && field.config.title ? field.config.title : field.name;\r\n\r\n        if (seriesName && dataList.length > 0 && name !== seriesName) {\r\n          name = seriesName + ' ' + name;\r\n        }\r\n\r\n        const datapoints = [];\r\n        for (let r = 0; r < series.length; r++) {\r\n          datapoints.push([field.values.get(r), timeField.values.get(r)]);\r\n        }\r\n        list.push(this.toTimeSeries(field, name, i, j, datapoints, list.length, range));\r\n      }\r\n    }\r\n\r\n    // Merge all the rows if we want to show a histogram\r\n    if (this.panel.xaxis.mode === 'histogram' && !this.panel.stack && list.length > 1) {\r\n      const first = list[0];\r\n      first.alias = first.aliasEscaped = 'Count';\r\n      for (let i = 1; i < list.length; i++) {\r\n        first.datapoints = first.datapoints.concat(list[i].datapoints);\r\n      }\r\n      return [first];\r\n    }\r\n\r\n    return list;\r\n  }\r\n\r\n  private toTimeSeries(\r\n    field: Field,\r\n    alias: string,\r\n    dataFrameIndex: number,\r\n    fieldIndex: number,\r\n    datapoints: any[][],\r\n    index: number,\r\n    range?: TimeRange\r\n  ) {\r\n    const colorIndex = index % colors.length;\r\n    const color = this.panel.aliasColors[alias] || colors[colorIndex];\r\n\r\n    const series = new TimeSeries({\r\n      datapoints: datapoints || [],\r\n      alias: alias,\r\n      color: getColorFromHexRgbOrName(color, config.theme.type),\r\n      unit: field.config ? field.config.unit : undefined,\r\n      dataFrameIndex,\r\n      fieldIndex,\r\n    });\r\n\r\n    if (datapoints && datapoints.length > 0 && range) {\r\n      const last = datapoints[datapoints.length - 1][1];\r\n      const from = range.from;\r\n\r\n      if (last - from.valueOf() < -10000) {\r\n        series.isOutsideRange = true;\r\n      }\r\n    }\r\n    return series;\r\n  }\r\n\r\n  setPanelDefaultsForNewXAxisMode() {\r\n    switch (this.panel.xaxis.mode) {\r\n      case 'time': {\r\n        this.panel.bars = false;\r\n        this.panel.lines = true;\r\n        this.panel.points = false;\r\n        this.panel.legend.show = true;\r\n        this.panel.tooltip.shared = true;\r\n        this.panel.xaxis.values = [];\r\n        break;\r\n      }\r\n      case 'series': {\r\n        this.panel.bars = true;\r\n        this.panel.lines = false;\r\n        this.panel.points = false;\r\n        this.panel.stack = false;\r\n        this.panel.legend.show = false;\r\n        this.panel.tooltip.shared = false;\r\n        this.panel.xaxis.values = ['total'];\r\n        break;\r\n      }\r\n      case 'histogram': {\r\n        this.panel.bars = true;\r\n        this.panel.lines = false;\r\n        this.panel.points = false;\r\n        this.panel.stack = false;\r\n        this.panel.legend.show = false;\r\n        this.panel.tooltip.shared = false;\r\n        break;\r\n      }\r\n    }\r\n  }\r\n\r\n  validateXAxisSeriesValue() {\r\n    switch (this.panel.xaxis.mode) {\r\n      case 'series': {\r\n        if (this.panel.xaxis.values.length === 0) {\r\n          this.panel.xaxis.values = ['total'];\r\n          return;\r\n        }\r\n\r\n        const validOptions = this.getXAxisValueOptions({});\r\n        const found: any = _.find(validOptions, { value: this.panel.xaxis.values[0] });\r\n        if (!found) {\r\n          this.panel.xaxis.values = ['total'];\r\n        }\r\n        return;\r\n      }\r\n    }\r\n  }\r\n\r\n  getXAxisValueOptions(options: any) {\r\n    switch (this.panel.xaxis.mode) {\r\n      case 'series': {\r\n        return [\r\n          { text: 'Avg', value: 'avg' },\r\n          { text: 'Min', value: 'min' },\r\n          { text: 'Max', value: 'max' },\r\n          { text: 'Total', value: 'total' },\r\n          { text: 'Count', value: 'count' },\r\n        ];\r\n      }\r\n    }\r\n\r\n    return [];\r\n  }\r\n\r\n  pluckDeep(obj: any, property: string) {\r\n    const propertyParts = property.split('.');\r\n    let value = obj;\r\n    for (let i = 0; i < propertyParts.length; ++i) {\r\n      if (value[propertyParts[i]]) {\r\n        value = value[propertyParts[i]];\r\n      } else {\r\n        return undefined;\r\n      }\r\n    }\r\n    return value;\r\n  }\r\n}\r\n","import 'vendor/flot/jquery.flot';\r\nimport 'vendor/flot/jquery.flot.selection';\r\nimport 'vendor/flot/jquery.flot.time';\r\nimport 'vendor/flot/jquery.flot.stack';\r\nimport 'vendor/flot/jquery.flot.stackpercent';\r\nimport 'vendor/flot/jquery.flot.fillbelow';\r\nimport 'vendor/flot/jquery.flot.crosshair';\r\nimport 'vendor/flot/jquery.flot.dashes';\r\nimport './jquery.flot.events';\r\n\r\nimport $ from 'jquery';\r\nimport _ from 'lodash';\r\nimport { tickStep } from 'app/core/utils/ticks';\r\nimport { appEvents, coreModule, updateLegendValues } from 'app/core/core';\r\nimport GraphTooltip from './graph_tooltip';\r\nimport { ThresholdManager } from './threshold_manager';\r\nimport { TimeRegionManager } from './time_region_manager';\r\nimport { EventManager } from 'app/features/annotations/all';\r\nimport { convertToHistogramData } from './histogram';\r\nimport { alignYLevel } from './align_yaxes';\r\nimport config from 'app/core/config';\r\nimport React from 'react';\r\nimport ReactDOM from 'react-dom';\r\nimport { GraphLegendProps, Legend } from './Legend/Legend';\r\n\r\nimport { GraphCtrl } from './module';\r\nimport { ContextMenuGroup, ContextMenuItem } from '@grafana/ui';\r\nimport { provideTheme, getCurrentTheme } from 'app/core/utils/ConfigProvider';\r\nimport {\r\n  toUtc,\r\n  LinkModelSupplier,\r\n  DataFrameView,\r\n  getValueFormat,\r\n  FieldDisplay,\r\n  getDisplayProcessor,\r\n  getFlotPairsConstant,\r\n  PanelEvents,\r\n  formattedValueToString,\r\n  FieldType,\r\n} from '@grafana/data';\r\nimport { GraphContextMenuCtrl } from './GraphContextMenuCtrl';\r\nimport { TimeSrv } from 'app/features/dashboard/services/TimeSrv';\r\nimport { ContextSrv } from 'app/core/services/context_srv';\r\nimport { getFieldLinksSupplier } from 'app/features/panel/panellinks/linkSuppliers';\r\nimport { CoreEvents } from 'app/types';\r\n\r\nconst LegendWithThemeProvider = provideTheme(Legend);\r\n\r\nclass GraphElement {\r\n  ctrl: GraphCtrl;\r\n  contextMenu: GraphContextMenuCtrl;\r\n  tooltip: any;\r\n  dashboard: any;\r\n  annotations: object[];\r\n  panel: any;\r\n  plot: any;\r\n  sortedSeries: any[];\r\n  data: any[];\r\n  panelWidth: number;\r\n  eventManager: EventManager;\r\n  thresholdManager: ThresholdManager;\r\n  timeRegionManager: TimeRegionManager;\r\n  legendElem: HTMLElement;\r\n\r\n  constructor(private scope: any, private elem: JQuery, private timeSrv: TimeSrv) {\r\n    this.ctrl = scope.ctrl;\r\n    this.contextMenu = scope.ctrl.contextMenuCtrl;\r\n    this.dashboard = this.ctrl.dashboard;\r\n    this.panel = this.ctrl.panel;\r\n    this.annotations = [];\r\n\r\n    this.panelWidth = 0;\r\n    this.eventManager = new EventManager(this.ctrl);\r\n    this.thresholdManager = new ThresholdManager(this.ctrl);\r\n    this.timeRegionManager = new TimeRegionManager(this.ctrl, config.theme.type);\r\n    // @ts-ignore\r\n    this.tooltip = new GraphTooltip(this.elem, this.ctrl.dashboard, this.scope, () => {\r\n      return this.sortedSeries;\r\n    });\r\n\r\n    // panel events\r\n    this.ctrl.events.on(PanelEvents.panelTeardown, this.onPanelTeardown.bind(this));\r\n    this.ctrl.events.on(PanelEvents.render, this.onRender.bind(this));\r\n\r\n    // global events\r\n    appEvents.on(CoreEvents.graphHover, this.onGraphHover.bind(this), scope);\r\n    appEvents.on(CoreEvents.graphHoverClear, this.onGraphHoverClear.bind(this), scope);\r\n    this.elem.bind('plotselected', this.onPlotSelected.bind(this));\r\n    this.elem.bind('plotclick', this.onPlotClick.bind(this));\r\n\r\n    // get graph legend element\r\n    if (this.elem && this.elem.parent) {\r\n      this.legendElem = this.elem.parent().find('.graph-legend')[0];\r\n    }\r\n  }\r\n\r\n  onRender(renderData: any[]) {\r\n    this.data = renderData || this.data;\r\n    if (!this.data) {\r\n      return;\r\n    }\r\n\r\n    this.annotations = this.ctrl.annotations || [];\r\n    this.buildFlotPairs(this.data);\r\n    const graphHeight = this.elem.height();\r\n    updateLegendValues(this.data, this.panel, graphHeight);\r\n\r\n    if (!this.panel.legend.show) {\r\n      if (this.legendElem.hasChildNodes()) {\r\n        ReactDOM.unmountComponentAtNode(this.legendElem);\r\n      }\r\n      this.renderPanel();\r\n      return;\r\n    }\r\n\r\n    const { values, min, max, avg, current, total } = this.panel.legend;\r\n    const { alignAsTable, rightSide, sideWidth, sort, sortDesc, hideEmpty, hideZero } = this.panel.legend;\r\n    const legendOptions = { alignAsTable, rightSide, sideWidth, sort, sortDesc, hideEmpty, hideZero };\r\n    const valueOptions = { values, min, max, avg, current, total };\r\n    const legendProps: GraphLegendProps = {\r\n      seriesList: this.data,\r\n      hiddenSeries: this.ctrl.hiddenSeries,\r\n      ...legendOptions,\r\n      ...valueOptions,\r\n      onToggleSeries: this.ctrl.onToggleSeries,\r\n      onToggleSort: this.ctrl.onToggleSort,\r\n      onColorChange: this.ctrl.onColorChange,\r\n      onToggleAxis: this.ctrl.onToggleAxis,\r\n    };\r\n\r\n    const legendReactElem = React.createElement(LegendWithThemeProvider, legendProps);\r\n    ReactDOM.render(legendReactElem, this.legendElem, () => this.renderPanel());\r\n  }\r\n\r\n  onGraphHover(evt: any) {\r\n    // ignore other graph hover events if shared tooltip is disabled\r\n    if (!this.dashboard.sharedTooltipModeEnabled()) {\r\n      return;\r\n    }\r\n\r\n    // ignore if we are the emitter\r\n    if (!this.plot || evt.panel.id === this.panel.id || this.ctrl.otherPanelInFullscreenMode()) {\r\n      return;\r\n    }\r\n\r\n    this.tooltip.show(evt.pos);\r\n  }\r\n\r\n  onPanelTeardown() {\r\n    if (this.plot) {\r\n      this.plot.destroy();\r\n      this.plot = null;\r\n    }\r\n\r\n    this.tooltip.destroy();\r\n    this.elem.off();\r\n    this.elem.remove();\r\n\r\n    ReactDOM.unmountComponentAtNode(this.legendElem);\r\n  }\r\n\r\n  onGraphHoverClear(event: any, info: any) {\r\n    if (this.plot) {\r\n      this.tooltip.clear(this.plot);\r\n    }\r\n  }\r\n\r\n  onPlotSelected(event: JQueryEventObject, ranges: any) {\r\n    if (this.panel.xaxis.mode !== 'time') {\r\n      // Skip if panel in histogram or series mode\r\n      this.plot.clearSelection();\r\n      return;\r\n    }\r\n\r\n    if ((ranges.ctrlKey || ranges.metaKey) && (this.dashboard.meta.canEdit || this.dashboard.meta.canMakeEditable)) {\r\n      // Add annotation\r\n      setTimeout(() => {\r\n        this.eventManager.updateTime(ranges.xaxis);\r\n      }, 100);\r\n    } else {\r\n      this.scope.$apply(() => {\r\n        this.timeSrv.setTime({\r\n          from: toUtc(ranges.xaxis.from),\r\n          to: toUtc(ranges.xaxis.to),\r\n        });\r\n      });\r\n    }\r\n  }\r\n\r\n  getContextMenuItemsSupplier = (\r\n    flotPosition: { x: number; y: number },\r\n    linksSupplier?: LinkModelSupplier<FieldDisplay>\r\n  ): (() => ContextMenuGroup[]) => {\r\n    return () => {\r\n      // Fixed context menu items\r\n      const items: ContextMenuGroup[] = [\r\n        {\r\n          items: [\r\n            {\r\n              label: 'Add annotation',\r\n              icon: 'gicon gicon-annotation',\r\n              onClick: () => this.eventManager.updateTime({ from: flotPosition.x, to: null }),\r\n            },\r\n          ],\r\n        },\r\n      ];\r\n\r\n      if (!linksSupplier) {\r\n        return items;\r\n      }\r\n\r\n      const dataLinks = [\r\n        {\r\n          items: linksSupplier.getLinks(this.panel.scopedVars).map<ContextMenuItem>(link => {\r\n            return {\r\n              label: link.title,\r\n              url: link.href,\r\n              target: link.target,\r\n              icon: `fa ${link.target === '_self' ? 'fa-link' : 'fa-external-link'}`,\r\n              onClick: link.onClick,\r\n            };\r\n          }),\r\n        },\r\n      ];\r\n\r\n      return [...items, ...dataLinks];\r\n    };\r\n  };\r\n\r\n  onPlotClick(event: JQueryEventObject, pos: any, item: any) {\r\n    const scrollContextElement = this.elem.closest('.view') ? this.elem.closest('.view').get()[0] : null;\r\n    const contextMenuSourceItem = item;\r\n\r\n    if (this.panel.xaxis.mode !== 'time') {\r\n      // Skip if panel in histogram or series mode\r\n      return;\r\n    }\r\n\r\n    if ((pos.ctrlKey || pos.metaKey) && (this.dashboard.meta.canEdit || this.dashboard.meta.canMakeEditable)) {\r\n      // Skip if range selected (added in \"plotselected\" event handler)\r\n      if (pos.x !== pos.x1) {\r\n        return;\r\n      }\r\n      setTimeout(() => {\r\n        this.eventManager.updateTime({ from: pos.x, to: null });\r\n      }, 100);\r\n      return;\r\n    } else {\r\n      this.tooltip.clear(this.plot);\r\n      let linksSupplier: LinkModelSupplier<FieldDisplay>;\r\n\r\n      if (item) {\r\n        // pickup y-axis index to know which field's config to apply\r\n        const yAxisConfig = this.panel.yaxes[item.series.yaxis.n === 2 ? 1 : 0];\r\n        const dataFrame = this.ctrl.dataList[item.series.dataFrameIndex];\r\n        const field = dataFrame.fields[item.series.fieldIndex];\r\n\r\n        let links = this.panel.options.dataLinks || [];\r\n        if (field.config.links && field.config.links.length) {\r\n          // Append the configured links to the panel datalinks\r\n          links = [...links, ...field.config.links];\r\n        }\r\n        const fieldConfig = {\r\n          decimals: yAxisConfig.decimals,\r\n          links,\r\n        };\r\n        const fieldDisplay = getDisplayProcessor({\r\n          field: { config: fieldConfig, type: FieldType.number },\r\n          theme: getCurrentTheme(),\r\n        })(field.values.get(item.dataIndex));\r\n        linksSupplier = links.length\r\n          ? getFieldLinksSupplier({\r\n              display: fieldDisplay,\r\n              name: field.name,\r\n              view: new DataFrameView(dataFrame),\r\n              rowIndex: item.dataIndex,\r\n              colIndex: item.series.fieldIndex,\r\n              field: fieldConfig,\r\n            })\r\n          : undefined;\r\n      }\r\n\r\n      this.scope.$apply(() => {\r\n        // Setting nearest CustomScrollbar element as a scroll context for graph context menu\r\n        this.contextMenu.setScrollContextElement(scrollContextElement);\r\n        this.contextMenu.setSource(contextMenuSourceItem);\r\n        this.contextMenu.setMenuItemsSupplier(this.getContextMenuItemsSupplier(pos, linksSupplier) as any);\r\n        this.contextMenu.toggleMenu(pos);\r\n      });\r\n    }\r\n  }\r\n\r\n  shouldAbortRender() {\r\n    if (!this.data) {\r\n      return true;\r\n    }\r\n\r\n    if (this.panelWidth === 0) {\r\n      return true;\r\n    }\r\n\r\n    return false;\r\n  }\r\n\r\n  drawHook(plot: any) {\r\n    // add left axis labels\r\n    if (this.panel.yaxes[0].label && this.panel.yaxes[0].show) {\r\n      $(\"<div class='axisLabel left-yaxis-label flot-temp-elem'></div>\")\r\n        .text(this.panel.yaxes[0].label)\r\n        .appendTo(this.elem);\r\n    }\r\n\r\n    // add right axis labels\r\n    if (this.panel.yaxes[1].label && this.panel.yaxes[1].show) {\r\n      $(\"<div class='axisLabel right-yaxis-label flot-temp-elem'></div>\")\r\n        .text(this.panel.yaxes[1].label)\r\n        .appendTo(this.elem);\r\n    }\r\n\r\n    if (this.ctrl.dataWarning) {\r\n      $(`<div class=\"datapoints-warning flot-temp-elem\">${this.ctrl.dataWarning.title}</div>`).appendTo(this.elem);\r\n    }\r\n\r\n    this.thresholdManager.draw(plot);\r\n    this.timeRegionManager.draw(plot);\r\n  }\r\n\r\n  processOffsetHook(plot: any, gridMargin: { left: number; right: number }) {\r\n    const left = this.panel.yaxes[0];\r\n    const right = this.panel.yaxes[1];\r\n    if (left.show && left.label) {\r\n      gridMargin.left = 20;\r\n    }\r\n    if (right.show && right.label) {\r\n      gridMargin.right = 20;\r\n    }\r\n\r\n    // apply y-axis min/max options\r\n    const yaxis = plot.getYAxes();\r\n    for (let i = 0; i < yaxis.length; i++) {\r\n      const axis: any = yaxis[i];\r\n      const panelOptions = this.panel.yaxes[i];\r\n      axis.options.max = axis.options.max !== null ? axis.options.max : panelOptions.max;\r\n      axis.options.min = axis.options.min !== null ? axis.options.min : panelOptions.min;\r\n    }\r\n  }\r\n\r\n  processRangeHook(plot: any) {\r\n    const yAxes = plot.getYAxes();\r\n    const align = this.panel.yaxis.align || false;\r\n\r\n    if (yAxes.length > 1 && align === true) {\r\n      const level = this.panel.yaxis.alignLevel || 0;\r\n      alignYLevel(yAxes, parseFloat(level));\r\n    }\r\n  }\r\n\r\n  // Series could have different timeSteps,\r\n  // let's find the smallest one so that bars are correctly rendered.\r\n  // In addition, only take series which are rendered as bars for this.\r\n  getMinTimeStepOfSeries(data: any[]) {\r\n    let min = Number.MAX_VALUE;\r\n\r\n    for (let i = 0; i < data.length; i++) {\r\n      if (!data[i].stats.timeStep) {\r\n        continue;\r\n      }\r\n      if (this.panel.bars) {\r\n        if (data[i].bars && data[i].bars.show === false) {\r\n          continue;\r\n        }\r\n      } else {\r\n        if (typeof data[i].bars === 'undefined' || typeof data[i].bars.show === 'undefined' || !data[i].bars.show) {\r\n          continue;\r\n        }\r\n      }\r\n\r\n      if (data[i].stats.timeStep < min) {\r\n        min = data[i].stats.timeStep;\r\n      }\r\n    }\r\n\r\n    return min;\r\n  }\r\n\r\n  // Function for rendering panel\r\n  renderPanel() {\r\n    this.panelWidth = this.elem.width();\r\n    if (this.shouldAbortRender()) {\r\n      return;\r\n    }\r\n\r\n    // give space to alert editing\r\n    this.thresholdManager.prepare(this.elem, this.data);\r\n\r\n    // un-check dashes if lines are unchecked\r\n    this.panel.dashes = this.panel.lines ? this.panel.dashes : false;\r\n\r\n    // Populate element\r\n    const options: any = this.buildFlotOptions(this.panel);\r\n    this.prepareXAxis(options, this.panel);\r\n    this.configureYAxisOptions(this.data, options);\r\n    this.thresholdManager.addFlotOptions(options, this.panel);\r\n    this.timeRegionManager.addFlotOptions(options, this.panel);\r\n    this.eventManager.addFlotEvents(this.annotations, options);\r\n    this.sortedSeries = this.sortSeries(this.data, this.panel);\r\n    this.callPlot(options, true);\r\n  }\r\n\r\n  buildFlotPairs(data: any) {\r\n    for (let i = 0; i < data.length; i++) {\r\n      const series = data[i];\r\n      series.data = series.getFlotPairs(series.nullPointMode || this.panel.nullPointMode);\r\n\r\n      if (series.transform === 'constant') {\r\n        series.data = getFlotPairsConstant(series.data, this.ctrl.range);\r\n      }\r\n\r\n      // if hidden remove points and disable stack\r\n      if (this.ctrl.hiddenSeries[series.alias]) {\r\n        series.data = [];\r\n        series.stack = false;\r\n      }\r\n    }\r\n  }\r\n\r\n  prepareXAxis(options: any, panel: any) {\r\n    switch (panel.xaxis.mode) {\r\n      case 'series': {\r\n        options.series.bars.barWidth = 0.7;\r\n        options.series.bars.align = 'center';\r\n\r\n        for (let i = 0; i < this.data.length; i++) {\r\n          const series = this.data[i];\r\n          series.data = [[i + 1, series.stats[panel.xaxis.values[0]]]];\r\n        }\r\n\r\n        this.addXSeriesAxis(options);\r\n        break;\r\n      }\r\n      case 'histogram': {\r\n        let bucketSize: number;\r\n\r\n        if (this.data.length) {\r\n          let histMin = _.min(_.map(this.data, s => s.stats.min));\r\n          let histMax = _.max(_.map(this.data, s => s.stats.max));\r\n          const ticks = panel.xaxis.buckets || this.panelWidth / 50;\r\n          if (panel.xaxis.min != null) {\r\n            const isInvalidXaxisMin = tickStep(panel.xaxis.min, histMax, ticks) <= 0;\r\n            histMin = isInvalidXaxisMin ? histMin : panel.xaxis.min;\r\n          }\r\n          if (panel.xaxis.max != null) {\r\n            const isInvalidXaxisMax = tickStep(histMin, panel.xaxis.max, ticks) <= 0;\r\n            histMax = isInvalidXaxisMax ? histMax : panel.xaxis.max;\r\n          }\r\n          bucketSize = tickStep(histMin, histMax, ticks);\r\n          options.series.bars.barWidth = bucketSize * 0.8;\r\n          this.data = convertToHistogramData(this.data, bucketSize, this.ctrl.hiddenSeries, histMin, histMax);\r\n        } else {\r\n          bucketSize = 0;\r\n        }\r\n\r\n        this.addXHistogramAxis(options, bucketSize);\r\n        break;\r\n      }\r\n      case 'table': {\r\n        options.series.bars.barWidth = 0.7;\r\n        options.series.bars.align = 'center';\r\n        this.addXTableAxis(options);\r\n        break;\r\n      }\r\n      default: {\r\n        options.series.bars.barWidth = this.getMinTimeStepOfSeries(this.data) / 1.5;\r\n        options.series.bars.align = 'center';\r\n        this.addTimeAxis(options);\r\n        break;\r\n      }\r\n    }\r\n  }\r\n\r\n  callPlot(options: any, incrementRenderCounter: boolean) {\r\n    try {\r\n      this.plot = $.plot(this.elem, this.sortedSeries, options);\r\n      if (this.ctrl.renderError) {\r\n        delete this.ctrl.error;\r\n      }\r\n    } catch (e) {\r\n      console.log('flotcharts error', e);\r\n      this.ctrl.error = e.message || 'Render Error';\r\n      this.ctrl.renderError = true;\r\n    }\r\n\r\n    if (incrementRenderCounter) {\r\n      this.ctrl.renderingCompleted();\r\n    }\r\n  }\r\n\r\n  buildFlotOptions(panel: any) {\r\n    let gridColor = '#c8c8c8';\r\n    if (config.bootData.user.lightTheme === true) {\r\n      gridColor = '#a1a1a1';\r\n    }\r\n    const stack = panel.stack ? true : null;\r\n    const options: any = {\r\n      hooks: {\r\n        draw: [this.drawHook.bind(this)],\r\n        processOffset: [this.processOffsetHook.bind(this)],\r\n        processRange: [this.processRangeHook.bind(this)],\r\n      },\r\n      legend: { show: false },\r\n      series: {\r\n        stackpercent: panel.stack ? panel.percentage : false,\r\n        stack: panel.percentage ? null : stack,\r\n        lines: {\r\n          show: panel.lines,\r\n          zero: false,\r\n          fill: this.translateFillOption(panel.fill),\r\n          fillColor: this.getFillGradient(panel.fillGradient),\r\n          lineWidth: panel.dashes ? 0 : panel.linewidth,\r\n          steps: panel.steppedLine,\r\n        },\r\n        dashes: {\r\n          show: panel.dashes,\r\n          lineWidth: panel.linewidth,\r\n          dashLength: [panel.dashLength, panel.spaceLength],\r\n        },\r\n        bars: {\r\n          show: panel.bars,\r\n          fill: 1,\r\n          barWidth: 1,\r\n          zero: false,\r\n          lineWidth: 0,\r\n        },\r\n        points: {\r\n          show: panel.points,\r\n          fill: 1,\r\n          fillColor: false,\r\n          radius: panel.points ? panel.pointradius : 2,\r\n        },\r\n        shadowSize: 0,\r\n      },\r\n      yaxes: [],\r\n      xaxis: {},\r\n      grid: {\r\n        minBorderMargin: 0,\r\n        markings: [],\r\n        backgroundColor: null,\r\n        borderWidth: 0,\r\n        hoverable: true,\r\n        clickable: true,\r\n        color: gridColor,\r\n        margin: { left: 0, right: 0 },\r\n        labelMarginX: 0,\r\n        mouseActiveRadius: 30,\r\n      },\r\n      selection: {\r\n        mode: 'x',\r\n        color: '#666',\r\n      },\r\n      crosshair: {\r\n        mode: 'x',\r\n      },\r\n    };\r\n    return options;\r\n  }\r\n\r\n  sortSeries(series: any, panel: any) {\r\n    const sortBy = panel.legend.sort;\r\n    const sortOrder = panel.legend.sortDesc;\r\n    const haveSortBy = sortBy !== null && sortBy !== undefined && panel.legend[sortBy];\r\n    const haveSortOrder = sortOrder !== null && sortOrder !== undefined;\r\n    const shouldSortBy = panel.stack && haveSortBy && haveSortOrder && panel.legend.alignAsTable;\r\n    const sortDesc = panel.legend.sortDesc === true ? -1 : 1;\r\n\r\n    if (shouldSortBy) {\r\n      return _.sortBy(series, s => s.stats[sortBy] * sortDesc);\r\n    } else {\r\n      return _.sortBy(series, s => s.zindex);\r\n    }\r\n  }\r\n\r\n  getFillGradient(amount: number) {\r\n    if (!amount) {\r\n      return null;\r\n    }\r\n\r\n    return {\r\n      colors: [{ opacity: 0.0 }, { opacity: amount / 10 }],\r\n    };\r\n  }\r\n\r\n  translateFillOption(fill: number) {\r\n    if (this.panel.percentage && this.panel.stack) {\r\n      return fill === 0 ? 0.001 : fill / 10;\r\n    } else {\r\n      return fill / 10;\r\n    }\r\n  }\r\n\r\n  addTimeAxis(options: any) {\r\n    const ticks = this.panelWidth / 100;\r\n    const min = _.isUndefined(this.ctrl.range.from) ? null : this.ctrl.range.from.valueOf();\r\n    const max = _.isUndefined(this.ctrl.range.to) ? null : this.ctrl.range.to.valueOf();\r\n\r\n    options.xaxis = {\r\n      timezone: this.dashboard.getTimezone(),\r\n      show: this.panel.xaxis.show,\r\n      mode: 'time',\r\n      min: min,\r\n      max: max,\r\n      label: 'Datetime',\r\n      ticks: ticks,\r\n      timeformat: this.time_format(ticks, min, max),\r\n    };\r\n  }\r\n\r\n  addXSeriesAxis(options: any) {\r\n    const ticks = _.map(this.data, (series, index) => {\r\n      return [index + 1, series.alias];\r\n    });\r\n\r\n    options.xaxis = {\r\n      timezone: this.dashboard.getTimezone(),\r\n      show: this.panel.xaxis.show,\r\n      mode: null,\r\n      min: 0,\r\n      max: ticks.length + 1,\r\n      label: 'Datetime',\r\n      ticks: ticks,\r\n    };\r\n  }\r\n\r\n  addXHistogramAxis(options: any, bucketSize: number) {\r\n    let ticks: number | number[];\r\n    let min: number | undefined;\r\n    let max: number | undefined;\r\n\r\n    const defaultTicks = this.panelWidth / 50;\r\n\r\n    if (this.data.length && bucketSize) {\r\n      const tickValues = [];\r\n\r\n      for (const d of this.data) {\r\n        for (const point of d.data) {\r\n          tickValues[point[0]] = true;\r\n        }\r\n      }\r\n\r\n      ticks = Object.keys(tickValues).map(v => Number(v));\r\n      min = _.min(ticks)!;\r\n      max = _.max(ticks)!;\r\n\r\n      // Adjust tick step\r\n      let tickStep = bucketSize;\r\n      let ticksNum = Math.floor((max - min) / tickStep);\r\n      while (ticksNum > defaultTicks) {\r\n        tickStep = tickStep * 2;\r\n        ticksNum = Math.ceil((max - min) / tickStep);\r\n      }\r\n\r\n      // Expand ticks for pretty view\r\n      min = Math.floor(min / tickStep) * tickStep;\r\n      // 1.01 is 101% - ensure we have enough space for last bar\r\n      max = Math.ceil((max * 1.01) / tickStep) * tickStep;\r\n\r\n      ticks = [];\r\n      for (let i = min; i <= max; i += tickStep) {\r\n        ticks.push(i);\r\n      }\r\n    } else {\r\n      // Set defaults if no data\r\n      ticks = defaultTicks / 2;\r\n      min = 0;\r\n      max = 1;\r\n    }\r\n\r\n    options.xaxis = {\r\n      timezone: this.dashboard.getTimezone(),\r\n      show: this.panel.xaxis.show,\r\n      mode: null,\r\n      min: min,\r\n      max: max,\r\n      label: 'Histogram',\r\n      ticks: ticks,\r\n    };\r\n\r\n    // Use 'short' format for histogram values\r\n    this.configureAxisMode(options.xaxis, 'short');\r\n  }\r\n\r\n  addXTableAxis(options: any) {\r\n    let ticks = _.map(this.data, (series, seriesIndex) => {\r\n      return _.map(series.datapoints, (point, pointIndex) => {\r\n        const tickIndex = seriesIndex * series.datapoints.length + pointIndex;\r\n        return [tickIndex + 1, point[1]];\r\n      });\r\n    });\r\n    // @ts-ignore, potential bug? is this _.flattenDeep?\r\n    ticks = _.flatten(ticks, true);\r\n\r\n    options.xaxis = {\r\n      timezone: this.dashboard.getTimezone(),\r\n      show: this.panel.xaxis.show,\r\n      mode: null,\r\n      min: 0,\r\n      max: ticks.length + 1,\r\n      label: 'Datetime',\r\n      ticks: ticks,\r\n    };\r\n  }\r\n\r\n  configureYAxisOptions(data: any, options: any) {\r\n    const defaults = {\r\n      position: 'left',\r\n      show: this.panel.yaxes[0].show,\r\n      index: 1,\r\n      logBase: this.panel.yaxes[0].logBase || 1,\r\n      min: this.parseNumber(this.panel.yaxes[0].min),\r\n      max: this.parseNumber(this.panel.yaxes[0].max),\r\n      tickDecimals: this.panel.yaxes[0].decimals,\r\n    };\r\n\r\n    options.yaxes.push(defaults);\r\n\r\n    if (_.find(data, { yaxis: 2 })) {\r\n      const secondY = _.clone(defaults);\r\n      secondY.index = 2;\r\n      secondY.show = this.panel.yaxes[1].show;\r\n      secondY.logBase = this.panel.yaxes[1].logBase || 1;\r\n      secondY.position = 'right';\r\n      secondY.min = this.parseNumber(this.panel.yaxes[1].min);\r\n      secondY.max = this.parseNumber(this.panel.yaxes[1].max);\r\n      secondY.tickDecimals = this.panel.yaxes[1].decimals;\r\n      options.yaxes.push(secondY);\r\n\r\n      this.applyLogScale(options.yaxes[1], data);\r\n      this.configureAxisMode(\r\n        options.yaxes[1],\r\n        this.panel.percentage && this.panel.stack ? 'percent' : this.panel.yaxes[1].format\r\n      );\r\n    }\r\n    this.applyLogScale(options.yaxes[0], data);\r\n    this.configureAxisMode(\r\n      options.yaxes[0],\r\n      this.panel.percentage && this.panel.stack ? 'percent' : this.panel.yaxes[0].format\r\n    );\r\n  }\r\n\r\n  parseNumber(value: any) {\r\n    if (value === null || typeof value === 'undefined') {\r\n      return null;\r\n    }\r\n\r\n    return _.toNumber(value);\r\n  }\r\n\r\n  applyLogScale(axis: any, data: any) {\r\n    if (axis.logBase === 1) {\r\n      return;\r\n    }\r\n\r\n    const minSetToZero = axis.min === 0;\r\n\r\n    if (axis.min < Number.MIN_VALUE) {\r\n      axis.min = null;\r\n    }\r\n    if (axis.max < Number.MIN_VALUE) {\r\n      axis.max = null;\r\n    }\r\n\r\n    let series, i;\r\n    let max = axis.max,\r\n      min = axis.min;\r\n\r\n    for (i = 0; i < data.length; i++) {\r\n      series = data[i];\r\n      if (series.yaxis === axis.index) {\r\n        if (!max || max < series.stats.max) {\r\n          max = series.stats.max;\r\n        }\r\n        if (!min || min > series.stats.logmin) {\r\n          min = series.stats.logmin;\r\n        }\r\n      }\r\n    }\r\n\r\n    axis.transform = (v: number) => {\r\n      return v < Number.MIN_VALUE ? null : Math.log(v) / Math.log(axis.logBase);\r\n    };\r\n    axis.inverseTransform = (v: any) => {\r\n      return Math.pow(axis.logBase, v);\r\n    };\r\n\r\n    if (!max && !min) {\r\n      max = axis.inverseTransform(+2);\r\n      min = axis.inverseTransform(-2);\r\n    } else if (!max) {\r\n      max = min * axis.inverseTransform(+4);\r\n    } else if (!min) {\r\n      min = max * axis.inverseTransform(-4);\r\n    }\r\n\r\n    if (axis.min) {\r\n      min = axis.inverseTransform(Math.ceil(axis.transform(axis.min)));\r\n    } else {\r\n      min = axis.min = axis.inverseTransform(Math.floor(axis.transform(min)));\r\n    }\r\n    if (axis.max) {\r\n      max = axis.inverseTransform(Math.floor(axis.transform(axis.max)));\r\n    } else {\r\n      max = axis.max = axis.inverseTransform(Math.ceil(axis.transform(max)));\r\n    }\r\n\r\n    if (!min || min < Number.MIN_VALUE || !max || max < Number.MIN_VALUE) {\r\n      return;\r\n    }\r\n\r\n    if (Number.isFinite(min) && Number.isFinite(max)) {\r\n      if (minSetToZero) {\r\n        axis.min = 0.1;\r\n        min = 1;\r\n      }\r\n\r\n      axis.ticks = this.generateTicksForLogScaleYAxis(min, max, axis.logBase);\r\n      if (minSetToZero) {\r\n        axis.ticks.unshift(0.1);\r\n      }\r\n      if (axis.ticks[axis.ticks.length - 1] > axis.max) {\r\n        axis.max = axis.ticks[axis.ticks.length - 1];\r\n      }\r\n    } else {\r\n      axis.ticks = [1, 2];\r\n      delete axis.min;\r\n      delete axis.max;\r\n    }\r\n  }\r\n\r\n  generateTicksForLogScaleYAxis(min: any, max: number, logBase: number) {\r\n    let ticks = [];\r\n\r\n    let nextTick;\r\n    for (nextTick = min; nextTick <= max; nextTick *= logBase) {\r\n      ticks.push(nextTick);\r\n    }\r\n\r\n    const maxNumTicks = Math.ceil(this.ctrl.height / 25);\r\n    const numTicks = ticks.length;\r\n    if (numTicks > maxNumTicks) {\r\n      const factor = Math.ceil(numTicks / maxNumTicks) * logBase;\r\n      ticks = [];\r\n\r\n      for (nextTick = min; nextTick <= max * factor; nextTick *= factor) {\r\n        ticks.push(nextTick);\r\n      }\r\n    }\r\n\r\n    return ticks;\r\n  }\r\n\r\n  configureAxisMode(axis: { tickFormatter: (val: any, axis: any) => string }, format: string) {\r\n    axis.tickFormatter = (val, axis) => {\r\n      const formatter = getValueFormat(format);\r\n\r\n      if (!formatter) {\r\n        throw new Error(`Unit '${format}' is not supported`);\r\n      }\r\n      return formattedValueToString(formatter(val, axis.tickDecimals, axis.scaledDecimals));\r\n    };\r\n  }\r\n\r\n  time_format(ticks: number, min: number | null, max: number | null) {\r\n    if (min && max && ticks) {\r\n      const range = max - min;\r\n      const secPerTick = range / ticks / 1000;\r\n      // Need have 10 millisecond margin on the day range\r\n      // As sometimes last 24 hour dashboard evaluates to more than 86400000\r\n      const oneDay = 86400010;\r\n      const oneYear = 31536000000;\r\n\r\n      if (secPerTick <= 45) {\r\n        return '%H:%M:%S';\r\n      }\r\n      if (secPerTick <= 7200 || range <= oneDay) {\r\n        return '%H:%M';\r\n      }\r\n      if (secPerTick <= 80000) {\r\n        return '%m/%d %H:%M';\r\n      }\r\n      if (secPerTick <= 2419200 || range <= oneYear) {\r\n        return '%m/%d';\r\n      }\r\n      return '%Y-%m';\r\n    }\r\n\r\n    return '%H:%M';\r\n  }\r\n}\r\n\r\n/** @ngInject */\r\nfunction graphDirective(timeSrv: TimeSrv, popoverSrv: any, contextSrv: ContextSrv) {\r\n  return {\r\n    restrict: 'A',\r\n    template: '',\r\n    link: (scope: any, elem: JQuery) => {\r\n      return new GraphElement(scope, elem, timeSrv);\r\n    },\r\n  };\r\n}\r\n\r\ncoreModule.directive('grafanaGraph', graphDirective);\r\nexport { GraphElement, graphDirective };\r\n","import $ from 'jquery';\r\nimport { appEvents } from 'app/core/core';\r\nimport { CoreEvents } from 'app/types';\r\nimport { sanitize } from 'app/core/utils/text';\r\n\r\nexport default function GraphTooltip(this: any, elem: any, dashboard: any, scope: any, getSeriesFn: any) {\r\n  const self = this;\r\n  const ctrl = scope.ctrl;\r\n  const panel = ctrl.panel;\r\n\r\n  const $tooltip = $('<div class=\"graph-tooltip\">');\r\n\r\n  this.destroy = () => {\r\n    $tooltip.remove();\r\n  };\r\n\r\n  this.findHoverIndexFromDataPoints = (posX: number, series: any, last: number) => {\r\n    const ps = series.datapoints.pointsize;\r\n    const initial = last * ps;\r\n    const len = series.datapoints.points.length;\r\n    let j;\r\n    for (j = initial; j < len; j += ps) {\r\n      // Special case of a non stepped line, highlight the very last point just before a null point\r\n      if (\r\n        (!series.lines.steps && series.datapoints.points[initial] != null && series.datapoints.points[j] == null) ||\r\n        //normal case\r\n        series.datapoints.points[j] > posX\r\n      ) {\r\n        return Math.max(j - ps, 0) / ps;\r\n      }\r\n    }\r\n    return j / ps - 1;\r\n  };\r\n\r\n  this.findHoverIndexFromData = (posX: any, series: any) => {\r\n    let lower = 0;\r\n    let upper = series.data.length - 1;\r\n    let middle;\r\n    while (true) {\r\n      if (lower > upper) {\r\n        return Math.max(upper, 0);\r\n      }\r\n      middle = Math.floor((lower + upper) / 2);\r\n      if (series.data[middle][0] === posX) {\r\n        return middle;\r\n      } else if (series.data[middle][0] < posX) {\r\n        lower = middle + 1;\r\n      } else {\r\n        upper = middle - 1;\r\n      }\r\n    }\r\n  };\r\n\r\n  this.renderAndShow = (absoluteTime: string, innerHtml: string, pos: { pageX: number; pageY: any }, xMode: string) => {\r\n    if (xMode === 'time') {\r\n      innerHtml = '<div class=\"graph-tooltip-time\">' + absoluteTime + '</div>' + innerHtml;\r\n    }\r\n    $tooltip.html(innerHtml).place_tt(pos.pageX + 20, pos.pageY);\r\n  };\r\n\r\n  this.getMultiSeriesPlotHoverInfo = function(seriesList: any[], pos: { x: number }) {\r\n    let value, i, series, hoverIndex, hoverDistance, pointTime, yaxis;\r\n    // 3 sub-arrays, 1st for hidden series, 2nd for left yaxis, 3rd for right yaxis.\r\n    let results: any = [[], [], []];\r\n\r\n    //now we know the current X (j) position for X and Y values\r\n    let lastValue = 0; //needed for stacked values\r\n\r\n    let minDistance, minTime;\r\n\r\n    for (i = 0; i < seriesList.length; i++) {\r\n      series = seriesList[i];\r\n\r\n      if (!series.data.length || (panel.legend.hideEmpty && series.allIsNull)) {\r\n        // Init value so that it does not brake series sorting\r\n        results[0].push({ hidden: true, value: 0 });\r\n        continue;\r\n      }\r\n\r\n      if (!series.data.length || (panel.legend.hideZero && series.allIsZero)) {\r\n        // Init value so that it does not brake series sorting\r\n        results[0].push({ hidden: true, value: 0 });\r\n        continue;\r\n      }\r\n\r\n      if (series.hideTooltip) {\r\n        results[0].push({ hidden: true, value: 0 });\r\n        continue;\r\n      }\r\n\r\n      hoverIndex = this.findHoverIndexFromData(pos.x, series);\r\n      hoverDistance = pos.x - series.data[hoverIndex][0];\r\n      pointTime = series.data[hoverIndex][0];\r\n\r\n      // Take the closest point before the cursor, or if it does not exist, the closest after\r\n      if (\r\n        !minDistance ||\r\n        (hoverDistance >= 0 && (hoverDistance < minDistance || minDistance < 0)) ||\r\n        (hoverDistance < 0 && hoverDistance > minDistance)\r\n      ) {\r\n        minDistance = hoverDistance;\r\n        minTime = pointTime;\r\n      }\r\n\r\n      if (series.stack) {\r\n        if (panel.tooltip.value_type === 'individual') {\r\n          value = series.data[hoverIndex][1];\r\n        } else if (!series.stack) {\r\n          value = series.data[hoverIndex][1];\r\n        } else {\r\n          lastValue += series.data[hoverIndex][1];\r\n          value = lastValue;\r\n        }\r\n      } else {\r\n        value = series.data[hoverIndex][1];\r\n      }\r\n\r\n      // Highlighting multiple Points depending on the plot type\r\n      if (series.lines.steps || series.stack) {\r\n        // stacked and steppedLine plots can have series with different length.\r\n        // Stacked series can increase its length on each new stacked serie if null points found,\r\n        // to speed the index search we begin always on the last found hoverIndex.\r\n        hoverIndex = this.findHoverIndexFromDataPoints(pos.x, series, hoverIndex);\r\n      }\r\n\r\n      // Be sure we have a yaxis so that it does not brake series sorting\r\n      yaxis = 0;\r\n      if (series.yaxis) {\r\n        yaxis = series.yaxis.n;\r\n      }\r\n\r\n      results[yaxis].push({\r\n        value: value,\r\n        hoverIndex: hoverIndex,\r\n        color: series.color,\r\n        label: series.aliasEscaped,\r\n        time: pointTime,\r\n        distance: hoverDistance,\r\n        index: i,\r\n      });\r\n    }\r\n\r\n    // Contat the 3 sub-arrays\r\n    results = results[0].concat(results[1], results[2]);\r\n\r\n    // Time of the point closer to pointer\r\n    results.time = minTime;\r\n\r\n    return results;\r\n  };\r\n\r\n  elem.mouseleave(() => {\r\n    if (panel.tooltip.shared) {\r\n      const plot = elem.data().plot;\r\n      if (plot) {\r\n        $tooltip.detach();\r\n        plot.unhighlight();\r\n      }\r\n    }\r\n    appEvents.emit(CoreEvents.graphHoverClear);\r\n  });\r\n\r\n  elem.bind('plothover', (event: any, pos: { panelRelY: number; pageY: number }, item: any) => {\r\n    self.show(pos, item);\r\n\r\n    // broadcast to other graph panels that we are hovering!\r\n    pos.panelRelY = (pos.pageY - elem.offset().top) / elem.height();\r\n    appEvents.emit(CoreEvents.graphHover, { pos: pos, panel: panel });\r\n  });\r\n\r\n  elem.bind('plotclick', (event: any, pos: any, item: any) => {\r\n    appEvents.emit(CoreEvents.graphClicked, { pos: pos, panel: panel, item: item });\r\n  });\r\n\r\n  elem.bind('plotleave', () => {\r\n    if (!panel.tooltip.shared) {\r\n      return;\r\n    }\r\n\r\n    const plot = elem.data().plot;\r\n    if (plot) {\r\n      $tooltip.detach();\r\n      plot.unhighlight();\r\n    }\r\n  });\r\n\r\n  this.clear = (plot: { clearCrosshair: () => void; unhighlight: () => void }) => {\r\n    $tooltip.detach();\r\n    plot.clearCrosshair();\r\n    plot.unhighlight();\r\n  };\r\n\r\n  this.show = (pos: any, item: any) => {\r\n    const plot = elem.data().plot;\r\n    const plotData = plot.getData();\r\n    const xAxes = plot.getXAxes();\r\n    const xMode = xAxes[0].options.mode;\r\n    const seriesList = getSeriesFn();\r\n    let allSeriesMode = panel.tooltip.shared;\r\n    let group, value, absoluteTime, hoverInfo, i, series, seriesHtml, tooltipFormat;\r\n\r\n    // if panelRelY is defined another panel wants us to show a tooltip\r\n    // get pageX from position on x axis and pageY from relative position in original panel\r\n    if (pos.panelRelY) {\r\n      const pointOffset = plot.pointOffset({ x: pos.x });\r\n      if (Number.isNaN(pointOffset.left) || pointOffset.left < 0 || pointOffset.left > elem.width()) {\r\n        self.clear(plot);\r\n        return;\r\n      }\r\n      pos.pageX = elem.offset().left + pointOffset.left;\r\n      pos.pageY = elem.offset().top + elem.height() * pos.panelRelY;\r\n      const isVisible =\r\n        pos.pageY >= $(window).scrollTop() && pos.pageY <= $(window).innerHeight() + $(window).scrollTop();\r\n      if (!isVisible) {\r\n        self.clear(plot);\r\n        return;\r\n      }\r\n      plot.setCrosshair(pos);\r\n      allSeriesMode = true;\r\n\r\n      if (dashboard.sharedCrosshairModeOnly()) {\r\n        // if only crosshair mode we are done\r\n        return;\r\n      }\r\n    }\r\n\r\n    if (seriesList.length === 0) {\r\n      return;\r\n    }\r\n\r\n    if (seriesList[0].hasMsResolution) {\r\n      tooltipFormat = 'YYYY-MM-DD HH:mm:ss.SSS';\r\n    } else {\r\n      tooltipFormat = 'YYYY-MM-DD HH:mm:ss';\r\n    }\r\n\r\n    if (allSeriesMode) {\r\n      plot.unhighlight();\r\n\r\n      const seriesHoverInfo = self.getMultiSeriesPlotHoverInfo(plotData, pos);\r\n\r\n      seriesHtml = '';\r\n\r\n      absoluteTime = dashboard.formatDate(seriesHoverInfo.time, tooltipFormat);\r\n\r\n      // Dynamically reorder the hovercard for the current time point if the\r\n      // option is enabled.\r\n      if (panel.tooltip.sort === 2) {\r\n        seriesHoverInfo.sort((a: { value: number }, b: { value: number }) => {\r\n          return b.value - a.value;\r\n        });\r\n      } else if (panel.tooltip.sort === 1) {\r\n        seriesHoverInfo.sort((a: { value: number }, b: { value: number }) => {\r\n          return a.value - b.value;\r\n        });\r\n      }\r\n\r\n      for (i = 0; i < seriesHoverInfo.length; i++) {\r\n        hoverInfo = seriesHoverInfo[i];\r\n\r\n        if (hoverInfo.hidden) {\r\n          continue;\r\n        }\r\n\r\n        let highlightClass = '';\r\n        if (item && hoverInfo.index === item.seriesIndex) {\r\n          highlightClass = 'graph-tooltip-list-item--highlight';\r\n        }\r\n\r\n        series = seriesList[hoverInfo.index];\r\n        value = sanitize(series.formatValue(hoverInfo.value));\r\n\r\n        const color = sanitize(hoverInfo.color);\r\n        const label = sanitize(hoverInfo.label);\r\n\r\n        seriesHtml +=\r\n          '<div class=\"graph-tooltip-list-item ' + highlightClass + '\"><div class=\"graph-tooltip-series-name\">';\r\n        seriesHtml += '<i class=\"fa fa-minus\" style=\"color:' + color + ';\"></i> ' + label + ':</div>';\r\n        seriesHtml += '<div class=\"graph-tooltip-value\">' + value + '</div></div>';\r\n        plot.highlight(hoverInfo.index, hoverInfo.hoverIndex);\r\n      }\r\n\r\n      self.renderAndShow(absoluteTime, seriesHtml, pos, xMode);\r\n    } else if (item) {\r\n      // single series tooltip\r\n      const color = sanitize(item.series.color);\r\n      series = seriesList[item.seriesIndex];\r\n      group = '<div class=\"graph-tooltip-list-item\"><div class=\"graph-tooltip-series-name\">';\r\n      group += '<i class=\"fa fa-minus\" style=\"color:' + color + ';\"></i> ' + series.aliasEscaped + ':</div>';\r\n\r\n      if (panel.stack && panel.tooltip.value_type === 'individual') {\r\n        value = item.datapoint[1] - item.datapoint[2];\r\n      } else {\r\n        value = item.datapoint[1];\r\n      }\r\n\r\n      value = sanitize(series.formatValue(value));\r\n      absoluteTime = dashboard.formatDate(item.datapoint[0], tooltipFormat);\r\n\r\n      group += '<div class=\"graph-tooltip-value\">' + value + '</div>';\r\n\r\n      self.renderAndShow(absoluteTime, group, pos, xMode);\r\n    } else {\r\n      // no hit\r\n      $tooltip.detach();\r\n    }\r\n  };\r\n}\r\n","import _ from 'lodash';\r\nimport TimeSeries from 'app/core/time_series2';\r\n\r\n/**\r\n * Convert series into array of series values.\r\n * @param data Array of series\r\n */\r\nexport function getSeriesValues(dataList: TimeSeries[]): number[] {\r\n  const VALUE_INDEX = 0;\r\n  const values = [];\r\n\r\n  // Count histogam stats\r\n  for (let i = 0; i < dataList.length; i++) {\r\n    const series = dataList[i];\r\n    const datapoints = series.datapoints;\r\n    for (let j = 0; j < datapoints.length; j++) {\r\n      if (datapoints[j][VALUE_INDEX] !== null) {\r\n        values.push(datapoints[j][VALUE_INDEX]);\r\n      }\r\n    }\r\n  }\r\n\r\n  return values;\r\n}\r\n\r\n/**\r\n * Convert array of values into timeseries-like histogram:\r\n * [[val_1, count_1], [val_2, count_2], ..., [val_n, count_n]]\r\n * @param values\r\n * @param bucketSize\r\n */\r\nexport function convertValuesToHistogram(values: number[], bucketSize: number, min: number, max: number): any[] {\r\n  const histogram: any = {};\r\n\r\n  const minBound = getBucketBound(min, bucketSize);\r\n  const maxBound = getBucketBound(max, bucketSize);\r\n  let bound = minBound;\r\n  let n = 0;\r\n  while (bound <= maxBound) {\r\n    histogram[bound] = 0;\r\n    bound = minBound + bucketSize * n;\r\n    n++;\r\n  }\r\n\r\n  for (let i = 0; i < values.length; i++) {\r\n    // filter out values outside the min and max boundaries\r\n    if (values[i] < min || values[i] > max) {\r\n      continue;\r\n    }\r\n    const bound = getBucketBound(values[i], bucketSize);\r\n    histogram[bound] = histogram[bound] + 1;\r\n  }\r\n\r\n  const histogamSeries = _.map(histogram, (count, bound) => {\r\n    return [Number(bound), count];\r\n  });\r\n\r\n  // Sort by Y axis values\r\n  return _.sortBy(histogamSeries, point => point[0]);\r\n}\r\n\r\n/**\r\n * Convert series into array of histogram data.\r\n * @param data Array of series\r\n * @param bucketSize\r\n */\r\nexport function convertToHistogramData(\r\n  data: any,\r\n  bucketSize: number,\r\n  hiddenSeries: any,\r\n  min: number,\r\n  max: number\r\n): any[] {\r\n  return data.map((series: any) => {\r\n    const values = getSeriesValues([series]);\r\n    series.histogram = true;\r\n    if (!hiddenSeries[series.alias]) {\r\n      const histogram = convertValuesToHistogram(values, bucketSize, min, max);\r\n      series.data = histogram;\r\n    } else {\r\n      series.data = [];\r\n    }\r\n    return series;\r\n  });\r\n}\r\n\r\nfunction getBucketBound(value: number, bucketSize: number): number {\r\n  return Math.floor(value / bucketSize) * bucketSize;\r\n}\r\n","import angular from 'angular';\r\nimport $ from 'jquery';\r\nimport _ from 'lodash';\r\n//@ts-ignore\r\nimport Drop from 'tether-drop';\r\nimport { CreatePlotOverlay } from '@grafana/data';\r\n\r\n/** @ngInject */\r\nconst createAnnotationToolip: CreatePlotOverlay = (element, event, plot) => {\r\n  const injector = angular.element(document).injector();\r\n  const content = document.createElement('div');\r\n  content.innerHTML = '<annotation-tooltip event=\"event\" on-edit=\"onEdit()\"></annotation-tooltip>';\r\n\r\n  injector.invoke([\r\n    '$compile',\r\n    '$rootScope',\r\n    ($compile, $rootScope) => {\r\n      const eventManager = plot.getOptions().events.manager;\r\n      const tmpScope = $rootScope.$new(true);\r\n      tmpScope.event = event;\r\n      tmpScope.onEdit = () => {\r\n        eventManager.editEvent(event);\r\n      };\r\n\r\n      $compile(content)(tmpScope);\r\n      tmpScope.$digest();\r\n      tmpScope.$destroy();\r\n\r\n      const drop = new Drop({\r\n        target: element[0],\r\n        content: content,\r\n        position: 'bottom center',\r\n        classes: 'drop-popover drop-popover--annotation',\r\n        openOn: 'hover',\r\n        hoverCloseDelay: 200,\r\n        tetherOptions: {\r\n          constraints: [{ to: 'window', pin: true, attachment: 'both' }],\r\n        },\r\n      });\r\n\r\n      drop.open();\r\n\r\n      drop.on('close', () => {\r\n        setTimeout(() => {\r\n          drop.destroy();\r\n        });\r\n      });\r\n    },\r\n  ]);\r\n};\r\n\r\nlet markerElementToAttachTo: any = null;\r\n\r\n/** @ngInject */\r\nconst createEditPopover: CreatePlotOverlay = (element, event, plot) => {\r\n  const eventManager = plot.getOptions().events.manager;\r\n  if (eventManager.editorOpen) {\r\n    // update marker element to attach to (needed in case of legend on the right\r\n    // when there is a double render pass and the initial marker element is removed)\r\n    markerElementToAttachTo = element;\r\n    return;\r\n  }\r\n\r\n  // mark as openend\r\n  eventManager.editorOpened();\r\n  // set marker elment to attache to\r\n  markerElementToAttachTo = element;\r\n\r\n  // wait for element to be attached and positioned\r\n  setTimeout(() => {\r\n    const injector = angular.element(document).injector();\r\n    const content = document.createElement('div');\r\n    content.innerHTML = '<event-editor panel-ctrl=\"panelCtrl\" event=\"event\" close=\"close()\"></event-editor>';\r\n\r\n    injector.invoke([\r\n      '$compile',\r\n      '$rootScope',\r\n      ($compile, $rootScope) => {\r\n        const scope = $rootScope.$new(true);\r\n        let drop: any;\r\n\r\n        scope.event = event;\r\n        scope.panelCtrl = eventManager.panelCtrl;\r\n        scope.close = () => {\r\n          drop.close();\r\n        };\r\n\r\n        $compile(content)(scope);\r\n        scope.$digest();\r\n\r\n        drop = new Drop({\r\n          target: markerElementToAttachTo[0],\r\n          content: content,\r\n          position: 'bottom center',\r\n          classes: 'drop-popover drop-popover--form',\r\n          openOn: 'click',\r\n          tetherOptions: {\r\n            constraints: [{ to: 'window', pin: true, attachment: 'both' }],\r\n          },\r\n        });\r\n\r\n        drop.open();\r\n        eventManager.editorOpened();\r\n\r\n        drop.on('close', () => {\r\n          // need timeout here in order call drop.destroy\r\n          setTimeout(() => {\r\n            eventManager.editorClosed();\r\n            scope.$destroy();\r\n            drop.destroy();\r\n          });\r\n        });\r\n      },\r\n    ]);\r\n  }, 100);\r\n};\r\n\r\nexport { createEditPopover, createAnnotationToolip };\r\n\r\n/*\r\n * jquery.flot.events\r\n *\r\n * description: Flot plugin for adding events/markers to the plot\r\n * version: 0.2.5\r\n * authors:\r\n *    Alexander Wunschik <alex@wunschik.net>\r\n *    Joel Oughton <joeloughton@gmail.com>\r\n *    Nicolas Joseph <www.nicolasjoseph.com>\r\n *\r\n * website: https://github.com/mojoaxel/flot-events\r\n *\r\n * released under MIT License and GPLv2+\r\n */\r\n\r\n/**\r\n * A class that allows for the drawing an remove of some object\r\n */\r\nexport class DrawableEvent {\r\n  _object: any;\r\n  _drawFunc: any;\r\n  _clearFunc: any;\r\n  _moveFunc: any;\r\n  _position: any;\r\n  _width: any;\r\n  _height: any;\r\n\r\n  /** @ngInject */\r\n  constructor(\r\n    object: JQuery,\r\n    drawFunc: any,\r\n    clearFunc: any,\r\n    moveFunc: any,\r\n    left: number,\r\n    top: number,\r\n    width: number,\r\n    height: number\r\n  ) {\r\n    this._object = object;\r\n    this._drawFunc = drawFunc;\r\n    this._clearFunc = clearFunc;\r\n    this._moveFunc = moveFunc;\r\n    this._position = { left, top };\r\n    this._width = width;\r\n    this._height = height;\r\n  }\r\n\r\n  width() {\r\n    return this._width;\r\n  }\r\n  height() {\r\n    return this._height;\r\n  }\r\n  position() {\r\n    return this._position;\r\n  }\r\n  draw() {\r\n    this._drawFunc(this._object);\r\n  }\r\n  clear() {\r\n    this._clearFunc(this._object);\r\n  }\r\n  getObject() {\r\n    return this._object;\r\n  }\r\n  moveTo(position: { left: number; top: number }) {\r\n    this._position = position;\r\n    this._moveFunc(this._object, this._position);\r\n  }\r\n}\r\n\r\n/**\r\n * Event class that stores options (eventType, min, max, title, description) and the object to draw.\r\n */\r\nexport class VisualEvent {\r\n  _parent: any;\r\n  _options: any;\r\n  _drawableEvent: any;\r\n  _hidden: any;\r\n\r\n  /** @ngInject */\r\n  constructor(options: any, drawableEvent: DrawableEvent) {\r\n    this._options = options;\r\n    this._drawableEvent = drawableEvent;\r\n    this._hidden = false;\r\n  }\r\n\r\n  visual() {\r\n    return this._drawableEvent;\r\n  }\r\n  getOptions() {\r\n    return this._options;\r\n  }\r\n  getParent() {\r\n    return this._parent;\r\n  }\r\n  isHidden() {\r\n    return this._hidden;\r\n  }\r\n  hide() {\r\n    this._hidden = true;\r\n  }\r\n  unhide() {\r\n    this._hidden = false;\r\n  }\r\n}\r\n\r\n/**\r\n * A Class that handles the event-markers inside the given plot\r\n */\r\nexport class EventMarkers {\r\n  _events: any;\r\n  _types: any;\r\n  _plot: any;\r\n  eventsEnabled: any;\r\n\r\n  /** @ngInject */\r\n  constructor(plot: any) {\r\n    this._events = [];\r\n    this._types = [];\r\n    this._plot = plot;\r\n    this.eventsEnabled = false;\r\n  }\r\n\r\n  getEvents() {\r\n    return this._events;\r\n  }\r\n\r\n  setTypes(types: any) {\r\n    return (this._types = types);\r\n  }\r\n\r\n  /**\r\n   * create internal objects for the given events\r\n   */\r\n  setupEvents(events: any[]) {\r\n    const parts = _.partition(events, 'isRegion');\r\n    const regions = parts[0];\r\n    events = parts[1];\r\n\r\n    $.each(events, (index, event) => {\r\n      const ve = new VisualEvent(event, this._buildDiv(event));\r\n      this._events.push(ve);\r\n    });\r\n\r\n    $.each(regions, (index, event) => {\r\n      const vre = new VisualEvent(event, this._buildRegDiv(event));\r\n      this._events.push(vre);\r\n    });\r\n\r\n    this._events.sort((a: any, b: any) => {\r\n      const ao = a.getOptions(),\r\n        bo = b.getOptions();\r\n      if (ao.min > bo.min) {\r\n        return 1;\r\n      }\r\n      if (ao.min < bo.min) {\r\n        return -1;\r\n      }\r\n      return 0;\r\n    });\r\n  }\r\n\r\n  /**\r\n   * draw the events to the plot\r\n   */\r\n  drawEvents() {\r\n    // var o = this._plot.getPlotOffset();\r\n\r\n    $.each(this._events, (index, event) => {\r\n      // check event is inside the graph range\r\n      if (this._insidePlot(event.getOptions().min) && !event.isHidden()) {\r\n        event.visual().draw();\r\n      } else {\r\n        event\r\n          .visual()\r\n          .getObject()\r\n          .hide();\r\n      }\r\n    });\r\n  }\r\n\r\n  /**\r\n   * update the position of the event-markers (e.g. after scrolling or zooming)\r\n   */\r\n  updateEvents() {\r\n    const o = this._plot.getPlotOffset();\r\n    let left;\r\n    let top;\r\n    const xaxis = this._plot.getXAxes()[this._plot.getOptions().events.xaxis - 1];\r\n\r\n    $.each(this._events, (index, event) => {\r\n      top = o.top + this._plot.height() - event.visual().height();\r\n      left = xaxis.p2c(event.getOptions().min) + o.left - event.visual().width() / 2;\r\n      event.visual().moveTo({ top: top, left: left });\r\n    });\r\n  }\r\n\r\n  /**\r\n   * remove all events from the plot\r\n   */\r\n  _clearEvents() {\r\n    $.each(this._events, (index, val) => {\r\n      val.visual().clear();\r\n    });\r\n    this._events = [];\r\n  }\r\n\r\n  /**\r\n   * create a DOM element for the given event\r\n   */\r\n  _buildDiv(event: { eventType: any; min: any; editModel: any }) {\r\n    const that = this;\r\n\r\n    const container = this._plot.getPlaceholder();\r\n    const o = this._plot.getPlotOffset();\r\n    const xaxis = this._plot.getXAxes()[this._plot.getOptions().events.xaxis - 1];\r\n    let top, left, color, markerSize, markerShow, lineStyle, lineWidth;\r\n    let markerTooltip;\r\n\r\n    // map the eventType to a types object\r\n    const eventTypeId = event.eventType;\r\n\r\n    if (this._types === null || !this._types[eventTypeId] || !this._types[eventTypeId].color) {\r\n      color = '#666';\r\n    } else {\r\n      color = this._types[eventTypeId].color;\r\n    }\r\n\r\n    if (this._types === null || !this._types[eventTypeId] || !this._types[eventTypeId].markerSize) {\r\n      markerSize = 8; //default marker size\r\n    } else {\r\n      markerSize = this._types[eventTypeId].markerSize;\r\n    }\r\n\r\n    if (this._types === null || !this._types[eventTypeId] || this._types[eventTypeId].markerShow === undefined) {\r\n      markerShow = true;\r\n    } else {\r\n      markerShow = this._types[eventTypeId].markerShow;\r\n    }\r\n\r\n    if (this._types === null || !this._types[eventTypeId] || this._types[eventTypeId].markerTooltip === undefined) {\r\n      markerTooltip = true;\r\n    } else {\r\n      markerTooltip = this._types[eventTypeId].markerTooltip;\r\n    }\r\n\r\n    if (this._types == null || !this._types[eventTypeId] || !this._types[eventTypeId].lineStyle) {\r\n      lineStyle = 'dashed'; //default line style\r\n    } else {\r\n      lineStyle = this._types[eventTypeId].lineStyle.toLowerCase();\r\n    }\r\n\r\n    if (this._types == null || !this._types[eventTypeId] || this._types[eventTypeId].lineWidth === undefined) {\r\n      lineWidth = 1; //default line width\r\n    } else {\r\n      lineWidth = this._types[eventTypeId].lineWidth;\r\n    }\r\n\r\n    let topOffset = xaxis.options.eventSectionHeight || 0;\r\n    topOffset = topOffset / 3;\r\n\r\n    top = o.top + this._plot.height() + topOffset;\r\n    left = xaxis.p2c(event.min) + o.left;\r\n\r\n    const line = $('<div class=\"events_line flot-temp-elem\"></div>')\r\n      .css({\r\n        position: 'absolute',\r\n        opacity: 0.8,\r\n        left: left + 'px',\r\n        top: 8,\r\n        width: lineWidth + 'px',\r\n        height: this._plot.height() + topOffset * 0.8,\r\n        'border-left-width': lineWidth + 'px',\r\n        'border-left-style': lineStyle,\r\n        'border-left-color': color,\r\n        color: color,\r\n      })\r\n      .appendTo(container);\r\n\r\n    if (markerShow) {\r\n      const marker = $('<div class=\"events_marker\"></div>').css({\r\n        position: 'absolute',\r\n        left: -markerSize - Math.round(lineWidth / 2) + 'px',\r\n        'font-size': 0,\r\n        'line-height': 0,\r\n        width: 0,\r\n        height: 0,\r\n        'border-left': markerSize + 'px solid transparent',\r\n        'border-right': markerSize + 'px solid transparent',\r\n      });\r\n\r\n      marker.appendTo(line);\r\n\r\n      if (\r\n        this._types[eventTypeId] &&\r\n        this._types[eventTypeId].position &&\r\n        this._types[eventTypeId].position.toUpperCase() === 'BOTTOM'\r\n      ) {\r\n        marker.css({\r\n          top: top - markerSize - 8 + 'px',\r\n          'border-top': 'none',\r\n          'border-bottom': markerSize + 'px solid ' + color,\r\n        });\r\n      } else {\r\n        marker.css({\r\n          top: '0px',\r\n          'border-top': markerSize + 'px solid ' + color,\r\n          'border-bottom': 'none',\r\n        });\r\n      }\r\n\r\n      marker.data({\r\n        event: event,\r\n      });\r\n\r\n      const mouseenter = function(this: any) {\r\n        createAnnotationToolip(marker, $(this).data('event'), that._plot);\r\n      };\r\n\r\n      if (event.editModel) {\r\n        createEditPopover(marker, event.editModel, that._plot);\r\n      }\r\n\r\n      const mouseleave = () => {\r\n        that._plot.clearSelection();\r\n      };\r\n\r\n      if (markerTooltip) {\r\n        marker.css({ cursor: 'help' });\r\n        marker.hover(mouseenter, mouseleave);\r\n      }\r\n    }\r\n\r\n    const drawableEvent = new DrawableEvent(\r\n      line,\r\n      function drawFunc(obj: { show: () => void }) {\r\n        obj.show();\r\n      },\r\n      (obj: { remove: () => void }) => {\r\n        obj.remove();\r\n      },\r\n      (obj: any, position: { top: any; left: any }) => {\r\n        obj.css({\r\n          top: position.top,\r\n          left: position.left,\r\n        });\r\n      },\r\n      left,\r\n      top,\r\n      line.width(),\r\n      line.height()\r\n    );\r\n\r\n    return drawableEvent;\r\n  }\r\n\r\n  /**\r\n   * create a DOM element for the given region\r\n   */\r\n  _buildRegDiv(event: { eventType: any; min: number; timeEnd: number; editModel: any }) {\r\n    const that = this;\r\n\r\n    const container = this._plot.getPlaceholder();\r\n    const o = this._plot.getPlotOffset();\r\n    const xaxis = this._plot.getXAxes()[this._plot.getOptions().events.xaxis - 1];\r\n    let top,\r\n      left,\r\n      lineWidth: number,\r\n      regionWidth,\r\n      lineStyle: string | number | cssPropertySetter,\r\n      color: string,\r\n      markerTooltip;\r\n\r\n    // map the eventType to a types object\r\n    const eventTypeId = event.eventType;\r\n\r\n    if (this._types === null || !this._types[eventTypeId] || !this._types[eventTypeId].color) {\r\n      color = '#666';\r\n    } else {\r\n      color = this._types[eventTypeId].color;\r\n    }\r\n\r\n    if (this._types === null || !this._types[eventTypeId] || this._types[eventTypeId].markerTooltip === undefined) {\r\n      markerTooltip = true;\r\n    } else {\r\n      markerTooltip = this._types[eventTypeId].markerTooltip;\r\n    }\r\n\r\n    if (this._types == null || !this._types[eventTypeId] || this._types[eventTypeId].lineWidth === undefined) {\r\n      lineWidth = 1; //default line width\r\n    } else {\r\n      lineWidth = this._types[eventTypeId].lineWidth;\r\n    }\r\n\r\n    if (this._types == null || !this._types[eventTypeId] || !this._types[eventTypeId].lineStyle) {\r\n      lineStyle = 'dashed'; //default line style\r\n    } else {\r\n      lineStyle = this._types[eventTypeId].lineStyle.toLowerCase();\r\n    }\r\n\r\n    const topOffset = 2;\r\n    top = o.top + this._plot.height() + topOffset;\r\n\r\n    const timeFrom = Math.min(event.min, event.timeEnd);\r\n    const timeTo = Math.max(event.min, event.timeEnd);\r\n    left = xaxis.p2c(timeFrom) + o.left;\r\n    const right = xaxis.p2c(timeTo) + o.left;\r\n    regionWidth = right - left;\r\n\r\n    _.each([left, right], position => {\r\n      const line = $('<div class=\"events_line flot-temp-elem\"></div>').css({\r\n        position: 'absolute',\r\n        opacity: 0.8,\r\n        left: position + 'px',\r\n        top: 8,\r\n        width: lineWidth + 'px',\r\n        height: this._plot.height() + topOffset,\r\n        'border-left-width': lineWidth + 'px',\r\n        'border-left-style': lineStyle,\r\n        'border-left-color': color,\r\n        color: color,\r\n      });\r\n      line.appendTo(container);\r\n    });\r\n\r\n    const region = $('<div class=\"events_marker region_marker flot-temp-elem\"></div>').css({\r\n      position: 'absolute',\r\n      opacity: 0.5,\r\n      left: left + 'px',\r\n      top: top,\r\n      width: Math.round(regionWidth + lineWidth) + 'px',\r\n      height: '0.5rem',\r\n      'border-left-color': color,\r\n      color: color,\r\n      'background-color': color,\r\n    });\r\n    region.appendTo(container);\r\n\r\n    region.data({\r\n      event: event,\r\n    });\r\n\r\n    const mouseenter = function(this: any) {\r\n      createAnnotationToolip(region, $(this).data('event'), that._plot);\r\n    };\r\n\r\n    if (event.editModel) {\r\n      createEditPopover(region, event.editModel, that._plot);\r\n    }\r\n\r\n    const mouseleave = () => {\r\n      that._plot.clearSelection();\r\n    };\r\n\r\n    if (markerTooltip) {\r\n      region.css({ cursor: 'help' });\r\n      region.hover(mouseenter, mouseleave);\r\n    }\r\n\r\n    const drawableEvent = new DrawableEvent(\r\n      region,\r\n      function drawFunc(obj: { show: () => void }) {\r\n        obj.show();\r\n      },\r\n      (obj: { remove: () => void }) => {\r\n        obj.remove();\r\n      },\r\n      (obj: { css: (arg0: { top: any; left: any }) => void }, position: { top: any; left: any }) => {\r\n        obj.css({\r\n          top: position.top,\r\n          left: position.left,\r\n        });\r\n      },\r\n      left,\r\n      top,\r\n      region.width(),\r\n      region.height()\r\n    );\r\n\r\n    return drawableEvent;\r\n  }\r\n\r\n  /**\r\n   * check if the event is inside visible range\r\n   */\r\n  _insidePlot(x: any) {\r\n    const xaxis = this._plot.getXAxes()[this._plot.getOptions().events.xaxis - 1];\r\n    const xc = xaxis.p2c(x);\r\n    return xc > 0 && xc < xaxis.p2c(xaxis.max);\r\n  }\r\n}\r\n\r\n/**\r\n * initialize the plugin for the given plot\r\n */\r\n\r\n/** @ngInject */\r\nexport function init(this: any, plot: any) {\r\n  /*jshint validthis:true */\r\n  const that = this;\r\n  const eventMarkers = new EventMarkers(plot);\r\n\r\n  plot.getEvents = () => {\r\n    return eventMarkers._events;\r\n  };\r\n\r\n  plot.hideEvents = () => {\r\n    $.each(eventMarkers._events, (index, event) => {\r\n      event\r\n        .visual()\r\n        .getObject()\r\n        .hide();\r\n    });\r\n  };\r\n\r\n  plot.showEvents = () => {\r\n    plot.hideEvents();\r\n    $.each(eventMarkers._events, (index, event) => {\r\n      event.hide();\r\n    });\r\n\r\n    that.eventMarkers.drawEvents();\r\n  };\r\n\r\n  // change events on an existing plot\r\n  plot.setEvents = (events: any[]) => {\r\n    if (eventMarkers.eventsEnabled) {\r\n      eventMarkers.setupEvents(events);\r\n    }\r\n  };\r\n\r\n  plot.hooks.processOptions.push((plot: any, options: any) => {\r\n    // enable the plugin\r\n    if (options.events.data != null) {\r\n      eventMarkers.eventsEnabled = true;\r\n    }\r\n  });\r\n\r\n  plot.hooks.draw.push((plot: any) => {\r\n    const options = plot.getOptions();\r\n\r\n    if (eventMarkers.eventsEnabled) {\r\n      // check for first run\r\n      if (eventMarkers.getEvents().length < 1) {\r\n        eventMarkers.setTypes(options.events.types);\r\n        eventMarkers.setupEvents(options.events.data);\r\n      } else {\r\n        eventMarkers.updateEvents();\r\n      }\r\n    }\r\n\r\n    eventMarkers.drawEvents();\r\n  });\r\n}\r\n\r\nconst defaultOptions: any = {\r\n  events: {\r\n    data: null,\r\n    types: null,\r\n    xaxis: 1,\r\n    position: 'BOTTOM',\r\n  },\r\n};\r\n\r\n$.plot.plugins.push({\r\n  init: init,\r\n  options: defaultOptions,\r\n  name: 'events',\r\n  version: '0.2.5',\r\n});\r\n","import './graph';\r\nimport './series_overrides_ctrl';\r\nimport './thresholds_form';\r\nimport './time_regions_form';\r\n\r\nimport template from './template';\r\nimport _ from 'lodash';\r\n\r\nimport { MetricsPanelCtrl } from 'app/plugins/sdk';\r\nimport { DataProcessor } from './data_processor';\r\nimport { axesEditorComponent } from './axes_editor';\r\nimport config from 'app/core/config';\r\nimport TimeSeries from 'app/core/time_series2';\r\nimport { VariableSuggestion } from '@grafana/ui';\r\nimport { getProcessedDataFrames } from 'app/features/dashboard/state/runRequest';\r\nimport { getColorFromHexRgbOrName, PanelEvents, DataFrame, DataLink, DateTimeInput } from '@grafana/data';\r\n\r\nimport { GraphContextMenuCtrl } from './GraphContextMenuCtrl';\r\nimport { getDataLinksVariableSuggestions } from 'app/features/panel/panellinks/link_srv';\r\n\r\nimport { auto } from 'angular';\r\nimport { AnnotationsSrv } from 'app/features/annotations/all';\r\nimport { CoreEvents } from 'app/types';\r\n\r\nclass GraphCtrl extends MetricsPanelCtrl {\r\n  static template = template;\r\n\r\n  renderError: boolean;\r\n  hiddenSeries: any = {};\r\n  hiddenSeriesTainted = false;\r\n  seriesList: TimeSeries[] = [];\r\n  dataList: DataFrame[] = [];\r\n  annotations: any = [];\r\n  alertState: any;\r\n\r\n  annotationsPromise: any;\r\n  dataWarning: any;\r\n  colors: any = [];\r\n  subTabIndex: number;\r\n  processor: DataProcessor;\r\n  contextMenuCtrl: GraphContextMenuCtrl;\r\n  linkVariableSuggestions: VariableSuggestion[] = [];\r\n\r\n  panelDefaults: any = {\r\n    // datasource name, null = default datasource\r\n    datasource: null,\r\n    // sets client side (flot) or native graphite png renderer (png)\r\n    renderer: 'flot',\r\n    yaxes: [\r\n      {\r\n        label: null,\r\n        show: true,\r\n        logBase: 1,\r\n        min: null,\r\n        max: null,\r\n        format: 'short',\r\n      },\r\n      {\r\n        label: null,\r\n        show: true,\r\n        logBase: 1,\r\n        min: null,\r\n        max: null,\r\n        format: 'short',\r\n      },\r\n    ],\r\n    xaxis: {\r\n      show: true,\r\n      mode: 'time',\r\n      name: null,\r\n      values: [],\r\n      buckets: null,\r\n    },\r\n    yaxis: {\r\n      align: false,\r\n      alignLevel: null,\r\n    },\r\n    // show/hide lines\r\n    lines: true,\r\n    // fill factor\r\n    fill: 1,\r\n    // fill gradient\r\n    fillGradient: 0,\r\n    // line width in pixels\r\n    linewidth: 1,\r\n    // show/hide dashed line\r\n    dashes: false,\r\n    // show/hide line\r\n    hiddenSeries: false,\r\n    // length of a dash\r\n    dashLength: 10,\r\n    // length of space between two dashes\r\n    spaceLength: 10,\r\n    // show hide points\r\n    points: false,\r\n    // point radius in pixels\r\n    pointradius: 2,\r\n    // show hide bars\r\n    bars: false,\r\n    // enable/disable stacking\r\n    stack: false,\r\n    // stack percentage mode\r\n    percentage: false,\r\n    // legend options\r\n    legend: {\r\n      show: true, // disable/enable legend\r\n      values: false, // disable/enable legend values\r\n      min: false,\r\n      max: false,\r\n      current: false,\r\n      total: false,\r\n      avg: false,\r\n    },\r\n    // how null points should be handled\r\n    nullPointMode: 'null',\r\n    // staircase line mode\r\n    steppedLine: false,\r\n    // tooltip options\r\n    tooltip: {\r\n      value_type: 'individual',\r\n      shared: true,\r\n      sort: 0,\r\n    },\r\n    // time overrides\r\n    timeFrom: null,\r\n    timeShift: null,\r\n    // metric queries\r\n    targets: [{}],\r\n    // series color overrides\r\n    aliasColors: {},\r\n    // other style overrides\r\n    seriesOverrides: [],\r\n    thresholds: [],\r\n    timeRegions: [],\r\n    options: {\r\n      dataLinks: [],\r\n    },\r\n  };\r\n\r\n  /** @ngInject */\r\n  constructor($scope: any, $injector: auto.IInjectorService, private annotationsSrv: AnnotationsSrv) {\r\n    super($scope, $injector);\r\n\r\n    _.defaults(this.panel, this.panelDefaults);\r\n    _.defaults(this.panel.tooltip, this.panelDefaults.tooltip);\r\n    _.defaults(this.panel.legend, this.panelDefaults.legend);\r\n    _.defaults(this.panel.xaxis, this.panelDefaults.xaxis);\r\n    _.defaults(this.panel.options, this.panelDefaults.options);\r\n\r\n    this.useDataFrames = true;\r\n    this.processor = new DataProcessor(this.panel);\r\n    this.contextMenuCtrl = new GraphContextMenuCtrl($scope);\r\n\r\n    this.events.on(PanelEvents.render, this.onRender.bind(this));\r\n    this.events.on(CoreEvents.dataFramesReceived, this.onDataFramesReceived.bind(this));\r\n    this.events.on(PanelEvents.dataSnapshotLoad, this.onDataSnapshotLoad.bind(this));\r\n    this.events.on(PanelEvents.editModeInitialized, this.onInitEditMode.bind(this));\r\n    this.events.on(PanelEvents.initPanelActions, this.onInitPanelActions.bind(this));\r\n\r\n    this.onDataLinksChange = this.onDataLinksChange.bind(this);\r\n  }\r\n\r\n  onInitEditMode() {\r\n    this.addEditorTab('Display options', 'public/app/plugins/panel/graph/tab_display.html');\r\n    this.addEditorTab('Axes', axesEditorComponent);\r\n    this.addEditorTab('Legend', 'public/app/plugins/panel/graph/tab_legend.html');\r\n    this.addEditorTab('Thresholds & Time Regions', 'public/app/plugins/panel/graph/tab_thresholds_time_regions.html');\r\n    this.addEditorTab('Data links', 'public/app/plugins/panel/graph/tab_drilldown_links.html');\r\n    this.subTabIndex = 0;\r\n    this.hiddenSeriesTainted = false;\r\n  }\r\n\r\n  onInitPanelActions(actions: any[]) {\r\n    actions.push({ text: 'Export CSV', click: 'ctrl.exportCsv()' });\r\n    actions.push({ text: 'Toggle legend', click: 'ctrl.toggleLegend()', shortcut: 'p l' });\r\n  }\r\n\r\n  issueQueries(datasource: any) {\r\n    this.annotationsPromise = this.annotationsSrv.getAnnotations({\r\n      dashboard: this.dashboard,\r\n      panel: this.panel,\r\n      range: this.range,\r\n    });\r\n\r\n    /* Wait for annotationSrv requests to get datasources to\r\n     * resolve before issuing queries. This allows the annotations\r\n     * service to fire annotations queries before graph queries\r\n     * (but not wait for completion). This resolves\r\n     * issue 11806.\r\n     */\r\n    return this.annotationsSrv.datasourcePromises.then((r: any) => {\r\n      return super.issueQueries(datasource);\r\n    });\r\n  }\r\n\r\n  zoomOut(evt: any) {\r\n    this.publishAppEvent(CoreEvents.zoomOut, 2);\r\n  }\r\n\r\n  onDataSnapshotLoad(snapshotData: any) {\r\n    this.annotationsPromise = this.annotationsSrv.getAnnotations({\r\n      dashboard: this.dashboard,\r\n      panel: this.panel,\r\n      range: this.range,\r\n    });\r\n\r\n    const frames = getProcessedDataFrames(snapshotData);\r\n    this.onDataFramesReceived(frames);\r\n  }\r\n\r\n  onDataFramesReceived(data: DataFrame[]) {\r\n    this.dataList = data;\r\n    this.seriesList = this.processor.getSeriesList({\r\n      dataList: this.dataList,\r\n      range: this.range,\r\n    });\r\n\r\n    this.linkVariableSuggestions = getDataLinksVariableSuggestions(data);\r\n\r\n    this.dataWarning = null;\r\n    const datapointsCount = this.seriesList.reduce((prev, series) => {\r\n      return prev + series.datapoints.length;\r\n    }, 0);\r\n\r\n    if (datapointsCount === 0) {\r\n      this.dataWarning = {\r\n        title: 'No data',\r\n        tip: 'No data returned from query',\r\n      };\r\n    } else {\r\n      for (const series of this.seriesList) {\r\n        if (series.isOutsideRange) {\r\n          this.dataWarning = {\r\n            title: 'Data outside time range',\r\n            tip: 'Can be caused by timezone mismatch or missing time filter in query',\r\n          };\r\n          break;\r\n        }\r\n      }\r\n    }\r\n\r\n    this.annotationsPromise.then(\r\n      (result: { alertState: any; annotations: any }) => {\r\n        this.loading = false;\r\n        this.alertState = result.alertState;\r\n        this.annotations = result.annotations;\r\n        this.render(this.seriesList);\r\n      },\r\n      () => {\r\n        this.loading = false;\r\n        this.render(this.seriesList);\r\n      }\r\n    );\r\n  }\r\n\r\n  onRender() {\r\n    if (!this.seriesList) {\r\n      return;\r\n    }\r\n\r\n    for (const series of this.seriesList) {\r\n      series.applySeriesOverrides(this.panel.seriesOverrides);\r\n\r\n      if (series.unit) {\r\n        this.panel.yaxes[series.yaxis - 1].format = series.unit;\r\n      }\r\n      if (this.hiddenSeriesTainted === false && series.hiddenSeries === true) {\r\n        this.hiddenSeries[series.alias] = true;\r\n      }\r\n    }\r\n  }\r\n\r\n  onColorChange = (series: any, color: string) => {\r\n    series.setColor(getColorFromHexRgbOrName(color, config.theme.type));\r\n    this.panel.aliasColors[series.alias] = color;\r\n    this.render();\r\n  };\r\n\r\n  onToggleSeries = (hiddenSeries: any) => {\r\n    this.hiddenSeriesTainted = true;\r\n    this.hiddenSeries = hiddenSeries;\r\n    this.render();\r\n  };\r\n\r\n  onToggleSort = (sortBy: any, sortDesc: any) => {\r\n    this.panel.legend.sort = sortBy;\r\n    this.panel.legend.sortDesc = sortDesc;\r\n    this.render();\r\n  };\r\n\r\n  onToggleAxis = (info: { alias: any; yaxis: any }) => {\r\n    let override: any = _.find(this.panel.seriesOverrides, { alias: info.alias });\r\n    if (!override) {\r\n      override = { alias: info.alias };\r\n      this.panel.seriesOverrides.push(override);\r\n    }\r\n    override.yaxis = info.yaxis;\r\n    this.render();\r\n  };\r\n\r\n  onDataLinksChange(dataLinks: DataLink[]) {\r\n    this.panel.updateOptions({\r\n      ...this.panel.options,\r\n      dataLinks,\r\n    });\r\n  }\r\n\r\n  addSeriesOverride(override: any) {\r\n    this.panel.seriesOverrides.push(override || {});\r\n  }\r\n\r\n  removeSeriesOverride(override: any) {\r\n    this.panel.seriesOverrides = _.without(this.panel.seriesOverrides, override);\r\n    this.render();\r\n  }\r\n\r\n  toggleLegend() {\r\n    this.panel.legend.show = !this.panel.legend.show;\r\n    this.render();\r\n  }\r\n\r\n  legendValuesOptionChanged() {\r\n    const legend = this.panel.legend;\r\n    legend.values = legend.min || legend.max || legend.avg || legend.current || legend.total;\r\n    this.render();\r\n  }\r\n\r\n  exportCsv() {\r\n    const scope = this.$scope.$new(true);\r\n    scope.seriesList = this.seriesList\r\n      .filter(series => !this.panel.legend.hideEmpty || !series.allIsNull)\r\n      .filter(series => !this.panel.legend.hideZero || !series.allIsZero);\r\n    this.publishAppEvent(CoreEvents.showModal, {\r\n      templateHtml: '<export-data-modal data=\"seriesList\"></export-data-modal>',\r\n      scope,\r\n      modalClass: 'modal--narrow',\r\n    });\r\n  }\r\n\r\n  onContextMenuClose = () => {\r\n    this.contextMenuCtrl.toggleMenu();\r\n  };\r\n\r\n  formatDate = (date: DateTimeInput, format?: string) => {\r\n    return this.dashboard.formatDate.apply(this.dashboard, [date, format]);\r\n  };\r\n\r\n  getDataFrameByRefId = (refId: string) => {\r\n    return this.dataList.filter(dataFrame => dataFrame.refId === refId)[0];\r\n  };\r\n}\r\n\r\nexport { GraphCtrl, GraphCtrl as PanelCtrl };\r\n","import _ from 'lodash';\r\nimport coreModule from 'app/core/core_module';\r\n\r\n/** @ngInject */\r\nexport function SeriesOverridesCtrl($scope: any, $element: JQuery, popoverSrv: any) {\r\n  $scope.overrideMenu = [];\r\n  $scope.currentOverrides = [];\r\n  $scope.override = $scope.override || {};\r\n  $scope.colorPickerModel = {};\r\n\r\n  $scope.addOverrideOption = (name: string, propertyName: string, values: any) => {\r\n    const option = {\r\n      text: name,\r\n      propertyName: propertyName,\r\n      index: $scope.overrideMenu.length,\r\n      values,\r\n      submenu: _.map(values, value => {\r\n        return { text: String(value), value: value };\r\n      }),\r\n    };\r\n\r\n    $scope.overrideMenu.push(option);\r\n  };\r\n\r\n  $scope.setOverride = (item: { propertyName: string }, subItem: { value: any }) => {\r\n    // handle color overrides\r\n    if (item.propertyName === 'color') {\r\n      $scope.openColorSelector($scope.override['color']);\r\n      return;\r\n    }\r\n\r\n    $scope.override[item.propertyName] = subItem.value;\r\n\r\n    // automatically disable lines for this series and the fill below to series\r\n    // can be removed by the user if they still want lines\r\n    if (item.propertyName === 'fillBelowTo') {\r\n      $scope.override['lines'] = false;\r\n      $scope.ctrl.addSeriesOverride({ alias: subItem.value, lines: false });\r\n    }\r\n\r\n    $scope.updateCurrentOverrides();\r\n    $scope.ctrl.render();\r\n  };\r\n\r\n  $scope.colorSelected = (color: any) => {\r\n    $scope.override['color'] = color;\r\n    $scope.updateCurrentOverrides();\r\n    $scope.ctrl.render();\r\n\r\n    // update picker model so that the picker UI will also update\r\n    $scope.colorPickerModel.series.color = color;\r\n  };\r\n\r\n  $scope.openColorSelector = (color: any) => {\r\n    $scope.colorPickerModel = {\r\n      autoClose: true,\r\n      colorSelected: $scope.colorSelected,\r\n      series: { color },\r\n    };\r\n\r\n    popoverSrv.show({\r\n      element: $element.find('.dropdown')[0],\r\n      position: 'top center',\r\n      openOn: 'click',\r\n      template: '<series-color-picker-popover color=\"series.color\" onColorChange=\"colorSelected\" />',\r\n      classNames: 'drop-popover drop-popover--transparent',\r\n      model: $scope.colorPickerModel,\r\n      onClose: () => {\r\n        $scope.ctrl.render();\r\n      },\r\n    });\r\n  };\r\n\r\n  $scope.removeOverride = (option: { propertyName: string | number }) => {\r\n    delete $scope.override[option.propertyName];\r\n    $scope.updateCurrentOverrides();\r\n    $scope.ctrl.refresh();\r\n  };\r\n\r\n  $scope.getSeriesNames = () => {\r\n    return _.map($scope.ctrl.seriesList, series => {\r\n      return series.alias;\r\n    });\r\n  };\r\n\r\n  $scope.updateCurrentOverrides = () => {\r\n    $scope.currentOverrides = [];\r\n    _.each($scope.overrideMenu, option => {\r\n      const value = $scope.override[option.propertyName];\r\n      if (_.isUndefined(value)) {\r\n        return;\r\n      }\r\n      $scope.currentOverrides.push({\r\n        name: option.text,\r\n        propertyName: option.propertyName,\r\n        value: String(value),\r\n      });\r\n    });\r\n  };\r\n\r\n  $scope.addOverrideOption('Bars', 'bars', [true, false]);\r\n  $scope.addOverrideOption('Lines', 'lines', [true, false]);\r\n  $scope.addOverrideOption('Line fill', 'fill', [0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10]);\r\n  $scope.addOverrideOption('Fill gradient', 'fillGradient', [0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10]);\r\n  $scope.addOverrideOption('Line width', 'linewidth', [0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10]);\r\n  $scope.addOverrideOption('Null point mode', 'nullPointMode', ['connected', 'null', 'null as zero']);\r\n  $scope.addOverrideOption('Fill below to', 'fillBelowTo', $scope.getSeriesNames());\r\n  $scope.addOverrideOption('Staircase line', 'steppedLine', [true, false]);\r\n  $scope.addOverrideOption('Dashes', 'dashes', [true, false]);\r\n  $scope.addOverrideOption('Hidden Series', 'hiddenSeries', [true, false]);\r\n  $scope.addOverrideOption('Dash Length', 'dashLength', [\r\n    1,\r\n    2,\r\n    3,\r\n    4,\r\n    5,\r\n    6,\r\n    7,\r\n    8,\r\n    9,\r\n    10,\r\n    11,\r\n    12,\r\n    13,\r\n    14,\r\n    15,\r\n    16,\r\n    17,\r\n    18,\r\n    19,\r\n    20,\r\n  ]);\r\n  $scope.addOverrideOption('Dash Space', 'spaceLength', [\r\n    1,\r\n    2,\r\n    3,\r\n    4,\r\n    5,\r\n    6,\r\n    7,\r\n    8,\r\n    9,\r\n    10,\r\n    11,\r\n    12,\r\n    13,\r\n    14,\r\n    15,\r\n    16,\r\n    17,\r\n    18,\r\n    19,\r\n    20,\r\n  ]);\r\n  $scope.addOverrideOption('Points', 'points', [true, false]);\r\n  $scope.addOverrideOption('Points Radius', 'pointradius', [1, 2, 3, 4, 5]);\r\n  $scope.addOverrideOption('Stack', 'stack', [true, false, 'A', 'B', 'C', 'D']);\r\n  $scope.addOverrideOption('Color', 'color', ['change']);\r\n  $scope.addOverrideOption('Y-axis', 'yaxis', [1, 2]);\r\n  $scope.addOverrideOption('Z-index', 'zindex', [-3, -2, -1, 0, 1, 2, 3]);\r\n  $scope.addOverrideOption('Transform', 'transform', ['constant', 'negative-Y']);\r\n  $scope.addOverrideOption('Legend', 'legend', [true, false]);\r\n  $scope.addOverrideOption('Hide in tooltip', 'hideTooltip', [true, false]);\r\n  $scope.updateCurrentOverrides();\r\n}\r\n\r\ncoreModule.controller('SeriesOverridesCtrl', SeriesOverridesCtrl);\r\n","const template = `\r\n<div class=\"graph-panel\" ng-class=\"{'graph-panel--legend-right': ctrl.panel.legend.rightSide}\">\r\n  <div class=\"graph-panel__chart\" grafana-graph ng-dblclick=\"ctrl.zoomOut()\">\r\n  </div>\r\n\r\n  <div class=\"graph-legend\">\r\n    <div class=\"graph-legend-content\" graph-legend></div>\r\n  </div>\r\n  <div ng-if=\"ctrl.contextMenuCtrl.isVisible\">\r\n    <graph-context-menu\r\n      items=\"ctrl.contextMenuCtrl.menuItemsSupplier()\"\r\n      onClose=\"ctrl.onContextMenuClose\"\r\n      getContextMenuSource=\"ctrl.contextMenuCtrl.getSource\"\r\n      formatSourceDate=\"ctrl.formatDate\"\r\n      x=\"ctrl.contextMenuCtrl.position.x\"\r\n      y=\"ctrl.contextMenuCtrl.position.y\"\r\n    ></graph-context-menu>\r\n  </div>\r\n</div>\r\n`;\r\n\r\nexport default template;\r\n","import 'vendor/flot/jquery.flot';\r\nimport $ from 'jquery';\r\nimport _ from 'lodash';\r\nimport { getColorFromHexRgbOrName } from '@grafana/data';\r\nimport { CoreEvents } from 'app/types';\r\nimport { PanelCtrl } from 'app/features/panel/panel_ctrl';\r\n\r\nexport class ThresholdManager {\r\n  plot: any;\r\n  placeholder: any;\r\n  height: any;\r\n  thresholds: any;\r\n  needsCleanup: boolean;\r\n  hasSecondYAxis: any;\r\n\r\n  constructor(private panelCtrl: PanelCtrl) {}\r\n\r\n  getHandleHtml(handleIndex: any, model: { colorMode: string }, valueStr: any) {\r\n    let stateClass = model.colorMode;\r\n    if (model.colorMode === 'custom') {\r\n      stateClass = 'critical';\r\n    }\r\n\r\n    return `\r\n    <div class=\"alert-handle-wrapper alert-handle-wrapper--T${handleIndex}\">\r\n      <div class=\"alert-handle-line alert-handle-line--${stateClass}\">\r\n      </div>\r\n      <div class=\"alert-handle\" data-handle-index=\"${handleIndex}\">\r\n        <i class=\"icon-gf icon-gf-${stateClass} alert-state-${stateClass}\"></i>\r\n        <span class=\"alert-handle-value\">${valueStr}<i class=\"alert-handle-grip\"></i></span>\r\n      </div>\r\n    </div>`;\r\n  }\r\n\r\n  initDragging(evt: any) {\r\n    const handleElem = $(evt.currentTarget).parents('.alert-handle-wrapper');\r\n    const handleIndex = $(evt.currentTarget).data('handleIndex');\r\n\r\n    let lastY: number | null = null;\r\n    let posTop: number;\r\n    const plot = this.plot;\r\n    const panelCtrl = this.panelCtrl;\r\n    const model = this.thresholds[handleIndex];\r\n\r\n    function dragging(evt: any) {\r\n      if (lastY === null) {\r\n        lastY = evt.clientY;\r\n      } else {\r\n        const diff = evt.clientY - lastY;\r\n        posTop = posTop + diff;\r\n        lastY = evt.clientY;\r\n        handleElem.css({ top: posTop + diff });\r\n      }\r\n    }\r\n\r\n    function stopped() {\r\n      // calculate graph level\r\n      let graphValue = plot.c2p({ left: 0, top: posTop }).y;\r\n      graphValue = parseInt(graphValue.toFixed(0), 10);\r\n      model.value = graphValue;\r\n\r\n      handleElem.off('mousemove', dragging);\r\n      document.removeEventListener('mouseup', stopped);\r\n\r\n      // trigger digest and render\r\n      panelCtrl.$scope.$apply(() => {\r\n        panelCtrl.render();\r\n        panelCtrl.events.emit(CoreEvents.thresholdChanged, {\r\n          threshold: model,\r\n          handleIndex: handleIndex,\r\n        });\r\n      });\r\n    }\r\n\r\n    lastY = null;\r\n    posTop = handleElem.position().top;\r\n\r\n    handleElem.on('mousemove', dragging);\r\n    document.addEventListener('mouseup', stopped);\r\n  }\r\n\r\n  cleanUp() {\r\n    this.placeholder.find('.alert-handle-wrapper').remove();\r\n    this.needsCleanup = false;\r\n  }\r\n\r\n  renderHandle(handleIndex: number, defaultHandleTopPos: number) {\r\n    const model = this.thresholds[handleIndex];\r\n    const value = model.value;\r\n    let valueStr = value;\r\n    let handleTopPos = 0;\r\n\r\n    // handle no value\r\n    if (!_.isNumber(value)) {\r\n      valueStr = '';\r\n      handleTopPos = defaultHandleTopPos;\r\n    } else {\r\n      const valueCanvasPos = this.plot.p2c({ x: 0, y: value });\r\n      handleTopPos = Math.round(Math.min(Math.max(valueCanvasPos.top, 0), this.height) - 6);\r\n    }\r\n\r\n    const handleElem = $(this.getHandleHtml(handleIndex, model, valueStr));\r\n    this.placeholder.append(handleElem);\r\n\r\n    handleElem.toggleClass('alert-handle-wrapper--no-value', valueStr === '');\r\n    handleElem.css({ top: handleTopPos });\r\n  }\r\n\r\n  shouldDrawHandles() {\r\n    // @ts-ignore\r\n    return !this.hasSecondYAxis && this.panelCtrl.editingThresholds && this.panelCtrl.panel.thresholds.length > 0;\r\n  }\r\n\r\n  prepare(elem: JQuery, data: any[]) {\r\n    this.hasSecondYAxis = false;\r\n    for (let i = 0; i < data.length; i++) {\r\n      if (data[i].yaxis > 1) {\r\n        this.hasSecondYAxis = true;\r\n        break;\r\n      }\r\n    }\r\n\r\n    if (this.shouldDrawHandles()) {\r\n      const thresholdMargin = this.panelCtrl.panel.thresholds.length > 1 ? '220px' : '110px';\r\n      elem.css('margin-right', thresholdMargin);\r\n    } else if (this.needsCleanup) {\r\n      elem.css('margin-right', '0');\r\n    }\r\n  }\r\n\r\n  draw(plot: any) {\r\n    this.thresholds = this.panelCtrl.panel.thresholds;\r\n    this.plot = plot;\r\n    this.placeholder = plot.getPlaceholder();\r\n\r\n    if (this.needsCleanup) {\r\n      this.cleanUp();\r\n    }\r\n\r\n    if (!this.shouldDrawHandles()) {\r\n      return;\r\n    }\r\n\r\n    this.height = plot.height();\r\n\r\n    if (this.thresholds.length > 0) {\r\n      this.renderHandle(0, 10);\r\n    }\r\n    if (this.thresholds.length > 1) {\r\n      this.renderHandle(1, this.height - 30);\r\n    }\r\n\r\n    this.placeholder.off('mousedown', '.alert-handle');\r\n    this.placeholder.on('mousedown', '.alert-handle', this.initDragging.bind(this));\r\n    this.needsCleanup = true;\r\n  }\r\n\r\n  addFlotOptions(options: any, panel: any) {\r\n    if (!panel.thresholds || panel.thresholds.length === 0) {\r\n      return;\r\n    }\r\n\r\n    let gtLimit = Infinity;\r\n    let ltLimit = -Infinity;\r\n    let i, threshold, other;\r\n\r\n    for (i = 0; i < panel.thresholds.length; i++) {\r\n      threshold = panel.thresholds[i];\r\n      if (!_.isNumber(threshold.value)) {\r\n        continue;\r\n      }\r\n\r\n      let limit;\r\n      switch (threshold.op) {\r\n        case 'gt': {\r\n          limit = gtLimit;\r\n          // if next threshold is less then op and greater value, then use that as limit\r\n          if (panel.thresholds.length > i + 1) {\r\n            other = panel.thresholds[i + 1];\r\n            if (other.value > threshold.value) {\r\n              limit = other.value;\r\n              ltLimit = limit;\r\n            }\r\n          }\r\n          break;\r\n        }\r\n        case 'lt': {\r\n          limit = ltLimit;\r\n          // if next threshold is less then op and greater value, then use that as limit\r\n          if (panel.thresholds.length > i + 1) {\r\n            other = panel.thresholds[i + 1];\r\n            if (other.value < threshold.value) {\r\n              limit = other.value;\r\n              gtLimit = limit;\r\n            }\r\n          }\r\n          break;\r\n        }\r\n      }\r\n\r\n      let fillColor, lineColor;\r\n\r\n      switch (threshold.colorMode) {\r\n        case 'critical': {\r\n          fillColor = 'rgba(234, 112, 112, 0.12)';\r\n          lineColor = 'rgba(237, 46, 24, 0.60)';\r\n          break;\r\n        }\r\n        case 'warning': {\r\n          fillColor = 'rgba(235, 138, 14, 0.12)';\r\n          lineColor = 'rgba(247, 149, 32, 0.60)';\r\n          break;\r\n        }\r\n        case 'ok': {\r\n          fillColor = 'rgba(11, 237, 50, 0.090)';\r\n          lineColor = 'rgba(6,163,69, 0.60)';\r\n          break;\r\n        }\r\n        case 'custom': {\r\n          fillColor = threshold.fillColor;\r\n          lineColor = threshold.lineColor;\r\n          break;\r\n        }\r\n      }\r\n\r\n      // fill\r\n      if (threshold.fill) {\r\n        if (threshold.yaxis === 'right' && this.hasSecondYAxis) {\r\n          options.grid.markings.push({\r\n            y2axis: { from: threshold.value, to: limit },\r\n            color: getColorFromHexRgbOrName(fillColor),\r\n          });\r\n        } else {\r\n          options.grid.markings.push({\r\n            yaxis: { from: threshold.value, to: limit },\r\n            color: getColorFromHexRgbOrName(fillColor),\r\n          });\r\n        }\r\n      }\r\n      if (threshold.line) {\r\n        if (threshold.yaxis === 'right' && this.hasSecondYAxis) {\r\n          options.grid.markings.push({\r\n            y2axis: { from: threshold.value, to: threshold.value },\r\n            color: getColorFromHexRgbOrName(lineColor),\r\n          });\r\n        } else {\r\n          options.grid.markings.push({\r\n            yaxis: { from: threshold.value, to: threshold.value },\r\n            color: getColorFromHexRgbOrName(lineColor),\r\n          });\r\n        }\r\n      }\r\n    }\r\n  }\r\n}\r\n","import coreModule from 'app/core/core_module';\r\nimport config from 'app/core/config';\r\nimport tinycolor from 'tinycolor2';\r\nexport class ThresholdFormCtrl {\r\n  panelCtrl: any;\r\n  panel: any;\r\n  disabled: boolean;\r\n\r\n  /** @ngInject */\r\n  constructor($scope: any) {\r\n    this.panel = this.panelCtrl.panel;\r\n\r\n    if (this.panel.alert) {\r\n      this.disabled = true;\r\n    }\r\n\r\n    const unbindDestroy = $scope.$on('$destroy', () => {\r\n      this.panelCtrl.editingThresholds = false;\r\n      this.panelCtrl.render();\r\n      unbindDestroy();\r\n    });\r\n\r\n    this.panelCtrl.editingThresholds = true;\r\n  }\r\n\r\n  addThreshold() {\r\n    this.panel.thresholds.push({\r\n      value: undefined,\r\n      colorMode: 'critical',\r\n      op: 'gt',\r\n      fill: true,\r\n      line: true,\r\n      yaxis: 'left',\r\n    });\r\n    this.panelCtrl.render();\r\n  }\r\n\r\n  removeThreshold(index: number) {\r\n    this.panel.thresholds.splice(index, 1);\r\n    this.panelCtrl.render();\r\n  }\r\n\r\n  render() {\r\n    this.panelCtrl.render();\r\n  }\r\n\r\n  onFillColorChange(index: number) {\r\n    return (newColor: string) => {\r\n      this.panel.thresholds[index].fillColor = newColor;\r\n      this.render();\r\n    };\r\n  }\r\n\r\n  onLineColorChange(index: number) {\r\n    return (newColor: string) => {\r\n      this.panel.thresholds[index].lineColor = newColor;\r\n      this.render();\r\n    };\r\n  }\r\n\r\n  onThresholdTypeChange(index: number) {\r\n    // Because of the ng-model binding, threshold's color mode is already set here\r\n    if (this.panel.thresholds[index].colorMode === 'custom') {\r\n      this.panel.thresholds[index].fillColor = tinycolor(config.theme.colors.blueBase)\r\n        .setAlpha(0.2)\r\n        .toRgbString();\r\n      this.panel.thresholds[index].lineColor = tinycolor(config.theme.colors.blueShade)\r\n        .setAlpha(0.6)\r\n        .toRgbString();\r\n    }\r\n    this.panelCtrl.render();\r\n  }\r\n}\r\n\r\ncoreModule.directive('graphThresholdForm', () => {\r\n  return {\r\n    restrict: 'E',\r\n    templateUrl: 'public/app/plugins/panel/graph/thresholds_form.html',\r\n    controller: ThresholdFormCtrl,\r\n    bindToController: true,\r\n    controllerAs: 'ctrl',\r\n    scope: {\r\n      panelCtrl: '=',\r\n    },\r\n  };\r\n});\r\n","import 'vendor/flot/jquery.flot';\r\nimport _ from 'lodash';\r\nimport { GrafanaThemeType, getColorFromHexRgbOrName, dateTime, DateTime, AbsoluteTimeRange } from '@grafana/data';\r\n\r\ntype TimeRegionColorDefinition = {\r\n  fill: string | null;\r\n  line: string | null;\r\n};\r\n\r\nexport const colorModes: any = {\r\n  gray: {\r\n    themeDependent: true,\r\n    title: 'Gray',\r\n    darkColor: { fill: 'rgba(255, 255, 255, 0.09)', line: 'rgba(255, 255, 255, 0.2)' },\r\n    lightColor: { fill: 'rgba(0, 0, 0, 0.09)', line: 'rgba(0, 0, 0, 0.2)' },\r\n  },\r\n  red: {\r\n    title: 'Red',\r\n    color: { fill: 'rgba(234, 112, 112, 0.12)', line: 'rgba(237, 46, 24, 0.60)' },\r\n  },\r\n  green: {\r\n    title: 'Green',\r\n    color: { fill: 'rgba(11, 237, 50, 0.090)', line: 'rgba(6,163,69, 0.60)' },\r\n  },\r\n  blue: {\r\n    title: 'Blue',\r\n    color: { fill: 'rgba(11, 125, 238, 0.12)', line: 'rgba(11, 125, 238, 0.60)' },\r\n  },\r\n  yellow: {\r\n    title: 'Yellow',\r\n    color: { fill: 'rgba(235, 138, 14, 0.12)', line: 'rgba(247, 149, 32, 0.60)' },\r\n  },\r\n  custom: { title: 'Custom' },\r\n};\r\n\r\nexport function getColorModes() {\r\n  return _.map(Object.keys(colorModes), key => {\r\n    return {\r\n      key,\r\n      value: colorModes[key].title,\r\n    };\r\n  });\r\n}\r\n\r\nfunction getColor(timeRegion: any, theme: GrafanaThemeType): TimeRegionColorDefinition {\r\n  if (Object.keys(colorModes).indexOf(timeRegion.colorMode) === -1) {\r\n    timeRegion.colorMode = 'red';\r\n  }\r\n\r\n  if (timeRegion.colorMode === 'custom') {\r\n    return {\r\n      fill: timeRegion.fill && timeRegion.fillColor ? getColorFromHexRgbOrName(timeRegion.fillColor, theme) : null,\r\n      line: timeRegion.line && timeRegion.lineColor ? getColorFromHexRgbOrName(timeRegion.lineColor, theme) : null,\r\n    };\r\n  }\r\n\r\n  const colorMode = colorModes[timeRegion.colorMode];\r\n\r\n  if (colorMode.themeDependent === true) {\r\n    return theme === GrafanaThemeType.Light ? colorMode.lightColor : colorMode.darkColor;\r\n  }\r\n\r\n  return {\r\n    fill: timeRegion.fill ? getColorFromHexRgbOrName(colorMode.color.fill, theme) : null,\r\n    line: timeRegion.fill ? getColorFromHexRgbOrName(colorMode.color.line, theme) : null,\r\n  };\r\n}\r\n\r\nexport class TimeRegionManager {\r\n  plot: any;\r\n  timeRegions: any;\r\n\r\n  constructor(private panelCtrl: any, private theme: GrafanaThemeType = GrafanaThemeType.Dark) {}\r\n\r\n  draw(plot: any) {\r\n    this.timeRegions = this.panelCtrl.panel.timeRegions;\r\n    this.plot = plot;\r\n  }\r\n\r\n  addFlotOptions(options: any, panel: any) {\r\n    if (!panel.timeRegions || panel.timeRegions.length === 0) {\r\n      return;\r\n    }\r\n\r\n    const tRange = {\r\n      from: dateTime(this.panelCtrl.range.from).utc(),\r\n      to: dateTime(this.panelCtrl.range.to).utc(),\r\n    };\r\n\r\n    let i: number,\r\n      hRange: { from: any; to: any },\r\n      timeRegion: any,\r\n      regions: AbsoluteTimeRange[],\r\n      fromStart: DateTime,\r\n      fromEnd: DateTime,\r\n      timeRegionColor: TimeRegionColorDefinition;\r\n\r\n    const timeRegionsCopy = panel.timeRegions.map((a: any) => ({ ...a }));\r\n\r\n    for (i = 0; i < timeRegionsCopy.length; i++) {\r\n      timeRegion = timeRegionsCopy[i];\r\n\r\n      if (!(timeRegion.fromDayOfWeek || timeRegion.from) && !(timeRegion.toDayOfWeek || timeRegion.to)) {\r\n        continue;\r\n      }\r\n\r\n      if (timeRegion.from && !timeRegion.to) {\r\n        timeRegion.to = timeRegion.from;\r\n      }\r\n\r\n      if (!timeRegion.from && timeRegion.to) {\r\n        timeRegion.from = timeRegion.to;\r\n      }\r\n\r\n      hRange = {\r\n        from: this.parseTimeRange(timeRegion.from),\r\n        to: this.parseTimeRange(timeRegion.to),\r\n      };\r\n\r\n      if (!timeRegion.fromDayOfWeek && timeRegion.toDayOfWeek) {\r\n        timeRegion.fromDayOfWeek = timeRegion.toDayOfWeek;\r\n      }\r\n\r\n      if (!timeRegion.toDayOfWeek && timeRegion.fromDayOfWeek) {\r\n        timeRegion.toDayOfWeek = timeRegion.fromDayOfWeek;\r\n      }\r\n\r\n      if (timeRegion.fromDayOfWeek) {\r\n        hRange.from.dayOfWeek = Number(timeRegion.fromDayOfWeek);\r\n      }\r\n\r\n      if (timeRegion.toDayOfWeek) {\r\n        hRange.to.dayOfWeek = Number(timeRegion.toDayOfWeek);\r\n      }\r\n\r\n      if (hRange.from.dayOfWeek && hRange.from.h === null && hRange.from.m === null) {\r\n        hRange.from.h = 0;\r\n        hRange.from.m = 0;\r\n        hRange.from.s = 0;\r\n      }\r\n\r\n      if (hRange.to.dayOfWeek && hRange.to.h === null && hRange.to.m === null) {\r\n        hRange.to.h = 23;\r\n        hRange.to.m = 59;\r\n        hRange.to.s = 59;\r\n      }\r\n\r\n      if (!hRange.from || !hRange.to) {\r\n        continue;\r\n      }\r\n\r\n      regions = [];\r\n\r\n      fromStart = dateTime(tRange.from);\r\n      fromStart.set('hour', 0);\r\n      fromStart.set('minute', 0);\r\n      fromStart.set('second', 0);\r\n      fromStart.add(hRange.from.h, 'hours');\r\n      fromStart.add(hRange.from.m, 'minutes');\r\n      fromStart.add(hRange.from.s, 'seconds');\r\n\r\n      while (fromStart.unix() <= tRange.to.unix()) {\r\n        while (hRange.from.dayOfWeek && hRange.from.dayOfWeek !== fromStart.isoWeekday()) {\r\n          fromStart.add(24, 'hours');\r\n        }\r\n\r\n        if (fromStart.unix() > tRange.to.unix()) {\r\n          break;\r\n        }\r\n\r\n        fromEnd = dateTime(fromStart);\r\n\r\n        if (hRange.from.h <= hRange.to.h) {\r\n          fromEnd.add(hRange.to.h - hRange.from.h, 'hours');\r\n        } else if (hRange.from.h > hRange.to.h) {\r\n          while (fromEnd.hour() !== hRange.to.h) {\r\n            fromEnd.add(1, 'hours');\r\n          }\r\n        } else {\r\n          fromEnd.add(24 - hRange.from.h, 'hours');\r\n\r\n          while (fromEnd.hour() !== hRange.to.h) {\r\n            fromEnd.add(1, 'hours');\r\n          }\r\n        }\r\n\r\n        fromEnd.set('minute', hRange.to.m);\r\n        fromEnd.set('second', hRange.to.s);\r\n\r\n        while (hRange.to.dayOfWeek && hRange.to.dayOfWeek !== fromEnd.isoWeekday()) {\r\n          fromEnd.add(24, 'hours');\r\n        }\r\n\r\n        const outsideRange =\r\n          (fromStart.unix() < tRange.from.unix() && fromEnd.unix() < tRange.from.unix()) ||\r\n          (fromStart.unix() > tRange.to.unix() && fromEnd.unix() > tRange.to.unix());\r\n\r\n        if (!outsideRange) {\r\n          regions.push({ from: fromStart.valueOf(), to: fromEnd.valueOf() });\r\n        }\r\n\r\n        fromStart.add(24, 'hours');\r\n      }\r\n\r\n      timeRegionColor = getColor(timeRegion, this.theme);\r\n\r\n      for (let j = 0; j < regions.length; j++) {\r\n        const r = regions[j];\r\n        if (timeRegion.fill) {\r\n          options.grid.markings.push({\r\n            xaxis: { from: r.from, to: r.to },\r\n            color: timeRegionColor.fill,\r\n          });\r\n        }\r\n\r\n        if (timeRegion.line) {\r\n          options.grid.markings.push({\r\n            xaxis: { from: r.from, to: r.from },\r\n            color: timeRegionColor.line,\r\n          });\r\n          options.grid.markings.push({\r\n            xaxis: { from: r.to, to: r.to },\r\n            color: timeRegionColor.line,\r\n          });\r\n        }\r\n      }\r\n    }\r\n  }\r\n\r\n  parseTimeRange(str: string) {\r\n    const timeRegex = /^([\\d]+):?(\\d{2})?/;\r\n    const result: any = { h: null, m: null };\r\n    const match = timeRegex.exec(str);\r\n\r\n    if (!match) {\r\n      return result;\r\n    }\r\n\r\n    if (match.length > 1) {\r\n      result.h = Number(match[1]);\r\n      result.m = 0;\r\n\r\n      if (match.length > 2 && match[2] !== undefined) {\r\n        result.m = Number(match[2]);\r\n      }\r\n\r\n      if (result.h > 23) {\r\n        result.h = 23;\r\n      }\r\n\r\n      if (result.m > 59) {\r\n        result.m = 59;\r\n      }\r\n    }\r\n\r\n    return result;\r\n  }\r\n}\r\n","import coreModule from 'app/core/core_module';\r\nimport { getColorModes } from './time_region_manager';\r\n\r\nexport class TimeRegionFormCtrl {\r\n  panelCtrl: any;\r\n  panel: any;\r\n  disabled: boolean;\r\n  colorModes: any;\r\n\r\n  /** @ngInject */\r\n  constructor($scope: any) {\r\n    this.panel = this.panelCtrl.panel;\r\n\r\n    const unbindDestroy = $scope.$on('$destroy', () => {\r\n      this.panelCtrl.editingTimeRegions = false;\r\n      this.panelCtrl.render();\r\n      unbindDestroy();\r\n    });\r\n\r\n    this.colorModes = getColorModes();\r\n    this.panelCtrl.editingTimeRegions = true;\r\n  }\r\n\r\n  render() {\r\n    this.panelCtrl.render();\r\n  }\r\n\r\n  addTimeRegion() {\r\n    this.panel.timeRegions.push({\r\n      op: 'time',\r\n      fromDayOfWeek: undefined,\r\n      from: undefined,\r\n      toDayOfWeek: undefined,\r\n      to: undefined,\r\n      colorMode: 'background6',\r\n      fill: true,\r\n      line: false,\r\n      // Default colors for new\r\n      fillColor: 'rgba(234, 112, 112, 0.12)',\r\n      lineColor: 'rgba(237, 46, 24, 0.60)',\r\n    });\r\n    this.panelCtrl.render();\r\n  }\r\n\r\n  removeTimeRegion(index: number) {\r\n    this.panel.timeRegions.splice(index, 1);\r\n    this.panelCtrl.render();\r\n  }\r\n\r\n  onFillColorChange(index: number) {\r\n    return (newColor: string) => {\r\n      this.panel.timeRegions[index].fillColor = newColor;\r\n      this.render();\r\n    };\r\n  }\r\n\r\n  onLineColorChange(index: number) {\r\n    return (newColor: string) => {\r\n      this.panel.timeRegions[index].lineColor = newColor;\r\n      this.render();\r\n    };\r\n  }\r\n}\r\n\r\ncoreModule.directive('graphTimeRegionForm', () => {\r\n  return {\r\n    restrict: 'E',\r\n    templateUrl: 'public/app/plugins/panel/graph/time_regions_form.html',\r\n    controller: TimeRegionFormCtrl,\r\n    bindToController: true,\r\n    controllerAs: 'ctrl',\r\n    scope: {\r\n      panelCtrl: '=',\r\n    },\r\n  };\r\n});\r\n","import React from 'react';\r\nimport { LegendOptions, PanelOptionsGroup, Switch, Input, StatsPicker } from '@grafana/ui';\r\n\r\nexport interface GraphLegendEditorLegendOptions extends LegendOptions {\r\n  stats?: string[];\r\n  decimals?: number;\r\n  sortBy?: string;\r\n  sortDesc?: boolean;\r\n}\r\n\r\ninterface GraphLegendEditorProps {\r\n  options: GraphLegendEditorLegendOptions;\r\n  onChange: (options: GraphLegendEditorLegendOptions) => void;\r\n}\r\n\r\nexport const GraphLegendEditor: React.FunctionComponent<GraphLegendEditorProps> = props => {\r\n  const { options, onChange } = props;\r\n\r\n  const onStatsChanged = (stats: string[]) => {\r\n    onChange({\r\n      ...options,\r\n      stats,\r\n    });\r\n  };\r\n\r\n  const onOptionToggle = (option: keyof LegendOptions) => (event?: React.ChangeEvent<HTMLInputElement>) => {\r\n    const newOption: Partial<LegendOptions> = {};\r\n    if (!event) {\r\n      return;\r\n    }\r\n\r\n    if (option === 'placement') {\r\n      newOption[option] = event.target.checked ? 'right' : 'under';\r\n    } else {\r\n      newOption[option] = event.target.checked;\r\n    }\r\n\r\n    onChange({\r\n      ...options,\r\n      ...newOption,\r\n    });\r\n  };\r\n\r\n  const labelWidth = 8;\r\n  return (\r\n    <PanelOptionsGroup title=\"Legend\">\r\n      <div className=\"section gf-form-group\">\r\n        <h4>Options</h4>\r\n        <Switch\r\n          label=\"Show legend\"\r\n          labelClass={`width-${labelWidth}`}\r\n          checked={options.isVisible}\r\n          onChange={onOptionToggle('isVisible')}\r\n        />\r\n        <Switch\r\n          label=\"Display as table\"\r\n          labelClass={`width-${labelWidth}`}\r\n          checked={options.asTable}\r\n          onChange={onOptionToggle('asTable')}\r\n        />\r\n        <Switch\r\n          label=\"To the right\"\r\n          labelClass={`width-${labelWidth}`}\r\n          checked={options.placement === 'right'}\r\n          onChange={onOptionToggle('placement')}\r\n        />\r\n      </div>\r\n\r\n      <div className=\"section gf-form-group\">\r\n        <h4>Show</h4>\r\n        <div className=\"gf-form\">\r\n          <StatsPicker\r\n            allowMultiple={true}\r\n            stats={options.stats ? options.stats : []}\r\n            onChange={onStatsChanged}\r\n            placeholder={'Pick Values'}\r\n          />\r\n        </div>\r\n\r\n        <div className=\"gf-form\">\r\n          <div className=\"gf-form-label\">Decimals</div>\r\n          <Input\r\n            className=\"gf-form-input width-5\"\r\n            type=\"number\"\r\n            value={options.decimals}\r\n            placeholder=\"Auto\"\r\n            onChange={event => {\r\n              onChange({\r\n                ...options,\r\n                decimals: parseInt(event.target.value, 10),\r\n              });\r\n            }}\r\n          />\r\n        </div>\r\n      </div>\r\n\r\n      <div className=\"section gf-form-group\">\r\n        <h4>Hidden series</h4>\r\n        {/* <Switch label=\"With only nulls\" checked={!!options.hideEmpty} onChange={onOptionToggle('hideEmpty')} /> */}\r\n        <Switch label=\"With only zeros\" checked={!!options.hideZero} onChange={onOptionToggle('hideZero')} />\r\n      </div>\r\n    </PanelOptionsGroup>\r\n  );\r\n};\r\n","import React from 'react';\r\nimport { GraphWithLegend, Chart } from '@grafana/ui';\r\nimport { PanelProps } from '@grafana/data';\r\nimport { Options } from './types';\r\nimport { GraphPanelController } from './GraphPanelController';\r\nimport { LegendDisplayMode } from '@grafana/ui/src/components/Legend/Legend';\r\n\r\ninterface GraphPanelProps extends PanelProps<Options> {}\r\n\r\nexport const GraphPanel: React.FunctionComponent<GraphPanelProps> = ({\r\n  data,\r\n  timeRange,\r\n  timeZone,\r\n  width,\r\n  height,\r\n  options,\r\n  onOptionsChange,\r\n  onChangeTimeRange,\r\n}) => {\r\n  if (!data) {\r\n    return (\r\n      <div className=\"panel-empty\">\r\n        <p>No data found in response</p>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  const {\r\n    graph: { showLines, showBars, showPoints },\r\n    legend: legendOptions,\r\n    tooltipOptions,\r\n  } = options;\r\n\r\n  const graphProps = {\r\n    showBars,\r\n    showLines,\r\n    showPoints,\r\n    tooltipOptions,\r\n  };\r\n  const { asTable, isVisible, ...legendProps } = legendOptions;\r\n  return (\r\n    <GraphPanelController\r\n      data={data}\r\n      timeZone={timeZone}\r\n      options={options}\r\n      onOptionsChange={onOptionsChange}\r\n      onChangeTimeRange={onChangeTimeRange}\r\n    >\r\n      {({ onSeriesToggle, onHorizontalRegionSelected, ...controllerApi }) => {\r\n        return (\r\n          <GraphWithLegend\r\n            timeRange={timeRange}\r\n            timeZone={timeZone}\r\n            width={width}\r\n            height={height}\r\n            displayMode={asTable ? LegendDisplayMode.Table : LegendDisplayMode.List}\r\n            isLegendVisible={isVisible}\r\n            sortLegendBy={legendOptions.sortBy}\r\n            sortLegendDesc={legendOptions.sortDesc}\r\n            onSeriesToggle={onSeriesToggle}\r\n            onHorizontalRegionSelected={onHorizontalRegionSelected}\r\n            {...graphProps}\r\n            {...legendProps}\r\n            {...controllerApi}\r\n          >\r\n            <Chart.Tooltip mode={tooltipOptions.mode} />\r\n          </GraphWithLegend>\r\n        );\r\n      }}\r\n    </GraphPanelController>\r\n  );\r\n};\r\n","import React from 'react';\r\nimport { GraphSeriesToggler } from '@grafana/ui';\r\nimport { PanelData, GraphSeriesXY, AbsoluteTimeRange, TimeZone } from '@grafana/data';\r\n\r\nimport { getGraphSeriesModel } from './getGraphSeriesModel';\r\nimport { Options, SeriesOptions } from './types';\r\nimport { SeriesColorChangeHandler, SeriesAxisToggleHandler } from '@grafana/ui/src/components/Graph/GraphWithLegend';\r\n\r\ninterface GraphPanelControllerAPI {\r\n  series: GraphSeriesXY[];\r\n  onSeriesAxisToggle: SeriesAxisToggleHandler;\r\n  onSeriesColorChange: SeriesColorChangeHandler;\r\n  onSeriesToggle: (label: string, event: React.MouseEvent<HTMLElement>) => void;\r\n  onToggleSort: (sortBy: string) => void;\r\n  onHorizontalRegionSelected: (from: number, to: number) => void;\r\n}\r\n\r\ninterface GraphPanelControllerProps {\r\n  children: (api: GraphPanelControllerAPI) => JSX.Element;\r\n  options: Options;\r\n  data: PanelData;\r\n  timeZone: TimeZone;\r\n  onOptionsChange: (options: Options) => void;\r\n  onChangeTimeRange: (timeRange: AbsoluteTimeRange) => void;\r\n}\r\n\r\ninterface GraphPanelControllerState {\r\n  graphSeriesModel: GraphSeriesXY[];\r\n}\r\n\r\nexport class GraphPanelController extends React.Component<GraphPanelControllerProps, GraphPanelControllerState> {\r\n  constructor(props: GraphPanelControllerProps) {\r\n    super(props);\r\n\r\n    this.onSeriesColorChange = this.onSeriesColorChange.bind(this);\r\n    this.onSeriesAxisToggle = this.onSeriesAxisToggle.bind(this);\r\n    this.onToggleSort = this.onToggleSort.bind(this);\r\n    this.onHorizontalRegionSelected = this.onHorizontalRegionSelected.bind(this);\r\n\r\n    this.state = {\r\n      graphSeriesModel: getGraphSeriesModel(\r\n        props.data.series,\r\n        props.timeZone,\r\n        props.options.series,\r\n        props.options.graph,\r\n        props.options.legend,\r\n        props.options.fieldOptions\r\n      ),\r\n    };\r\n  }\r\n\r\n  static getDerivedStateFromProps(props: GraphPanelControllerProps, state: GraphPanelControllerState) {\r\n    return {\r\n      ...state,\r\n      graphSeriesModel: getGraphSeriesModel(\r\n        props.data.series,\r\n        props.timeZone,\r\n        props.options.series,\r\n        props.options.graph,\r\n        props.options.legend,\r\n        props.options.fieldOptions\r\n      ),\r\n    };\r\n  }\r\n\r\n  onSeriesOptionsUpdate(label: string, optionsUpdate: SeriesOptions) {\r\n    const { onOptionsChange, options } = this.props;\r\n    const updatedSeriesOptions: { [label: string]: SeriesOptions } = { ...options.series };\r\n    updatedSeriesOptions[label] = optionsUpdate;\r\n    onOptionsChange({\r\n      ...options,\r\n      series: updatedSeriesOptions,\r\n    });\r\n  }\r\n\r\n  onSeriesAxisToggle(label: string, yAxis: number) {\r\n    const {\r\n      options: { series },\r\n    } = this.props;\r\n    const seriesOptionsUpdate: SeriesOptions = series[label]\r\n      ? {\r\n          ...series[label],\r\n          yAxis: {\r\n            ...series[label].yAxis,\r\n            index: yAxis,\r\n          },\r\n        }\r\n      : {\r\n          yAxis: {\r\n            index: yAxis,\r\n          },\r\n        };\r\n    this.onSeriesOptionsUpdate(label, seriesOptionsUpdate);\r\n  }\r\n\r\n  onSeriesColorChange(label: string, color: string) {\r\n    const {\r\n      options: { series },\r\n    } = this.props;\r\n    const seriesOptionsUpdate: SeriesOptions = series[label]\r\n      ? {\r\n          ...series[label],\r\n          color,\r\n        }\r\n      : {\r\n          color,\r\n        };\r\n\r\n    this.onSeriesOptionsUpdate(label, seriesOptionsUpdate);\r\n  }\r\n\r\n  onToggleSort(sortBy: string) {\r\n    const { onOptionsChange, options } = this.props;\r\n    onOptionsChange({\r\n      ...options,\r\n      legend: {\r\n        ...options.legend,\r\n        sortBy,\r\n        sortDesc: sortBy === options.legend.sortBy ? !options.legend.sortDesc : false,\r\n      },\r\n    });\r\n  }\r\n\r\n  onHorizontalRegionSelected(from: number, to: number) {\r\n    const { onChangeTimeRange } = this.props;\r\n    onChangeTimeRange({ from, to });\r\n  }\r\n\r\n  render() {\r\n    const { children } = this.props;\r\n    const { graphSeriesModel } = this.state;\r\n\r\n    return (\r\n      <GraphSeriesToggler series={graphSeriesModel}>\r\n        {({ onSeriesToggle, toggledSeries }) => {\r\n          return children({\r\n            series: toggledSeries,\r\n            onSeriesColorChange: this.onSeriesColorChange,\r\n            onSeriesAxisToggle: this.onSeriesAxisToggle,\r\n            onToggleSort: this.onToggleSort,\r\n            onSeriesToggle: onSeriesToggle,\r\n            onHorizontalRegionSelected: this.onHorizontalRegionSelected,\r\n          });\r\n        }}\r\n      </GraphSeriesToggler>\r\n    );\r\n  }\r\n}\r\n","//// Libraries\r\nimport _ from 'lodash';\r\nimport React, { PureComponent } from 'react';\r\n\r\n// Types\r\nimport { PanelEditorProps, FieldConfig } from '@grafana/data';\r\nimport {\r\n  Switch,\r\n  LegendOptions,\r\n  GraphTooltipOptions,\r\n  PanelOptionsGrid,\r\n  PanelOptionsGroup,\r\n  FieldPropertiesEditor,\r\n  Select,\r\n} from '@grafana/ui';\r\nimport { Options, GraphOptions } from './types';\r\nimport { GraphLegendEditor } from './GraphLegendEditor';\r\n\r\nexport class GraphPanelEditor extends PureComponent<PanelEditorProps<Options>> {\r\n  onGraphOptionsChange = (options: Partial<GraphOptions>) => {\r\n    this.props.onOptionsChange({\r\n      ...this.props.options,\r\n      graph: {\r\n        ...this.props.options.graph,\r\n        ...options,\r\n      },\r\n    });\r\n  };\r\n\r\n  onLegendOptionsChange = (options: LegendOptions) => {\r\n    this.props.onOptionsChange({ ...this.props.options, legend: options });\r\n  };\r\n\r\n  onTooltipOptionsChange = (options: GraphTooltipOptions) => {\r\n    this.props.onOptionsChange({ ...this.props.options, tooltipOptions: options });\r\n  };\r\n\r\n  onToggleLines = () => {\r\n    this.onGraphOptionsChange({ showLines: !this.props.options.graph.showLines });\r\n  };\r\n\r\n  onToggleBars = () => {\r\n    this.onGraphOptionsChange({ showBars: !this.props.options.graph.showBars });\r\n  };\r\n\r\n  onTogglePoints = () => {\r\n    this.onGraphOptionsChange({ showPoints: !this.props.options.graph.showPoints });\r\n  };\r\n\r\n  onDefaultsChange = (field: FieldConfig) => {\r\n    this.props.onOptionsChange({\r\n      ...this.props.options,\r\n      fieldOptions: {\r\n        ...this.props.options.fieldOptions,\r\n        defaults: field,\r\n      },\r\n    });\r\n  };\r\n\r\n  render() {\r\n    const {\r\n      graph: { showBars, showPoints, showLines },\r\n      tooltipOptions: { mode },\r\n    } = this.props.options;\r\n\r\n    return (\r\n      <>\r\n        <div className=\"section gf-form-group\">\r\n          <h5 className=\"section-heading\">Draw Modes</h5>\r\n          <Switch label=\"Lines\" labelClass=\"width-5\" checked={showLines} onChange={this.onToggleLines} />\r\n          <Switch label=\"Bars\" labelClass=\"width-5\" checked={showBars} onChange={this.onToggleBars} />\r\n          <Switch label=\"Points\" labelClass=\"width-5\" checked={showPoints} onChange={this.onTogglePoints} />\r\n        </div>\r\n        <PanelOptionsGrid>\r\n          <PanelOptionsGroup title=\"Field\">\r\n            <FieldPropertiesEditor\r\n              showMinMax={false}\r\n              onChange={this.onDefaultsChange}\r\n              value={this.props.options.fieldOptions.defaults}\r\n            />\r\n          </PanelOptionsGroup>\r\n          <PanelOptionsGroup title=\"Tooltip\">\r\n            <Select\r\n              value={{ value: mode, label: mode === 'single' ? 'Single' : 'All series' }}\r\n              onChange={value => {\r\n                this.onTooltipOptionsChange({ mode: value.value as any });\r\n              }}\r\n              options={[\r\n                { label: 'All series', value: 'multi' },\r\n                { label: 'Single', value: 'single' },\r\n              ]}\r\n            />\r\n          </PanelOptionsGroup>\r\n          <GraphLegendEditor options={this.props.options.legend} onChange={this.onLegendOptionsChange} />\r\n        </PanelOptionsGrid>\r\n      </>\r\n    );\r\n  }\r\n}\r\n","import { colors } from '@grafana/ui';\r\nimport {\r\n  getFlotPairs,\r\n  getDisplayProcessor,\r\n  NullValueMode,\r\n  reduceField,\r\n  FieldType,\r\n  DisplayValue,\r\n  GraphSeriesXY,\r\n  getTimeField,\r\n  DataFrame,\r\n  FieldDisplayOptions,\r\n  getSeriesTimeStep,\r\n  TimeZone,\r\n  hasMsResolution,\r\n  MS_DATE_TIME_FORMAT,\r\n  DEFAULT_DATE_TIME_FORMAT,\r\n  FieldColor,\r\n  FieldColorMode,\r\n} from '@grafana/data';\r\n\r\nimport { SeriesOptions, GraphOptions } from './types';\r\nimport { GraphLegendEditorLegendOptions } from './GraphLegendEditor';\r\n\r\nexport const getGraphSeriesModel = (\r\n  dataFrames: DataFrame[],\r\n  timeZone: TimeZone,\r\n  seriesOptions: SeriesOptions,\r\n  graphOptions: GraphOptions,\r\n  legendOptions: GraphLegendEditorLegendOptions,\r\n  fieldOptions?: FieldDisplayOptions\r\n) => {\r\n  const graphs: GraphSeriesXY[] = [];\r\n\r\n  const displayProcessor = getDisplayProcessor({\r\n    field: {\r\n      config: {\r\n        unit: fieldOptions?.defaults?.unit,\r\n        decimals: legendOptions.decimals,\r\n      },\r\n    },\r\n  });\r\n\r\n  let fieldColumnIndex = -1;\r\n  for (const series of dataFrames) {\r\n    const { timeField } = getTimeField(series);\r\n    if (!timeField) {\r\n      continue;\r\n    }\r\n\r\n    for (const field of series.fields) {\r\n      if (field.type !== FieldType.number) {\r\n        continue;\r\n      }\r\n      // Storing index of series field for future inspection\r\n      fieldColumnIndex++;\r\n\r\n      // Use external calculator just to make sure it works :)\r\n      const points = getFlotPairs({\r\n        xField: timeField,\r\n        yField: field,\r\n        nullValueMode: NullValueMode.Null,\r\n      });\r\n\r\n      if (points.length > 0) {\r\n        const seriesStats = reduceField({ field, reducers: legendOptions.stats });\r\n        let statsDisplayValues: DisplayValue[];\r\n\r\n        if (legendOptions.stats) {\r\n          statsDisplayValues = legendOptions.stats.map<DisplayValue>(stat => {\r\n            const statDisplayValue = displayProcessor(seriesStats[stat]);\r\n\r\n            return {\r\n              ...statDisplayValue,\r\n              title: stat,\r\n            };\r\n          });\r\n        }\r\n\r\n        let color: FieldColor;\r\n        if (seriesOptions[field.name] && seriesOptions[field.name].color) {\r\n          // Case when panel has settings provided via SeriesOptions, i.e. graph panel\r\n          color = {\r\n            mode: FieldColorMode.Fixed,\r\n            fixedColor: seriesOptions[field.name].color,\r\n          };\r\n        } else if (field.config && field.config.color) {\r\n          // Case when color settings are set on field, i.e. Explore logs histogram (see makeSeriesForLogs)\r\n          color = field.config.color;\r\n        } else {\r\n          color = {\r\n            mode: FieldColorMode.Fixed,\r\n            fixedColor: colors[graphs.length % colors.length],\r\n          };\r\n        }\r\n\r\n        field.config = fieldOptions\r\n          ? {\r\n              ...field.config,\r\n              unit: fieldOptions.defaults.unit,\r\n              decimals: fieldOptions.defaults.decimals,\r\n              color,\r\n            }\r\n          : { ...field.config, color };\r\n\r\n        field.display = getDisplayProcessor({ field });\r\n\r\n        // Time step is used to determine bars width when graph is rendered as bar chart\r\n        const timeStep = getSeriesTimeStep(timeField);\r\n        const useMsDateFormat = hasMsResolution(timeField);\r\n\r\n        timeField.display = getDisplayProcessor({\r\n          timeZone,\r\n          field: {\r\n            ...timeField,\r\n            type: timeField.type,\r\n            config: {\r\n              unit: `time:${useMsDateFormat ? MS_DATE_TIME_FORMAT : DEFAULT_DATE_TIME_FORMAT}`,\r\n            },\r\n          },\r\n        });\r\n\r\n        graphs.push({\r\n          label: field.name,\r\n          data: points,\r\n          color: field.config.color?.fixedColor,\r\n          info: statsDisplayValues,\r\n          isVisible: true,\r\n          yAxis: {\r\n            index: (seriesOptions[field.name] && seriesOptions[field.name].yAxis) || 1,\r\n          },\r\n          // This index is used later on to retrieve appropriate series/time for X and Y axes\r\n          seriesIndex: fieldColumnIndex,\r\n          timeField: { ...timeField },\r\n          valueField: { ...field },\r\n          timeStep,\r\n        });\r\n      }\r\n    }\r\n  }\r\n\r\n  return graphs;\r\n};\r\n","import { PanelPlugin } from '@grafana/data';\r\nimport { GraphPanelEditor } from './GraphPanelEditor';\r\nimport { GraphPanel } from './GraphPanel';\r\nimport { Options, defaults } from './types';\r\n\r\nexport const plugin = new PanelPlugin<Options>(GraphPanel).setDefaults(defaults).setEditor(GraphPanelEditor);\r\n","import { LegendOptions, GraphTooltipOptions } from '@grafana/ui';\r\nimport { YAxis, FieldDisplayOptions } from '@grafana/data';\r\n\r\nimport { GraphLegendEditorLegendOptions } from './GraphLegendEditor';\r\n// TODO move out from single stat\r\nimport { standardFieldDisplayOptions } from '../stat/types';\r\n\r\nexport interface SeriesOptions {\r\n  color?: string;\r\n  yAxis?: YAxis;\r\n  [key: string]: any;\r\n}\r\nexport interface GraphOptions {\r\n  showBars: boolean;\r\n  showLines: boolean;\r\n  showPoints: boolean;\r\n}\r\n\r\nexport interface Options {\r\n  graph: GraphOptions;\r\n  legend: LegendOptions & GraphLegendEditorLegendOptions;\r\n  series: {\r\n    [alias: string]: SeriesOptions;\r\n  };\r\n  fieldOptions: FieldDisplayOptions;\r\n  tooltipOptions: GraphTooltipOptions;\r\n}\r\n\r\nexport const defaults: Options = {\r\n  graph: {\r\n    showBars: false,\r\n    showLines: true,\r\n    showPoints: false,\r\n  },\r\n  legend: {\r\n    asTable: false,\r\n    isVisible: true,\r\n    placement: 'under',\r\n  },\r\n  series: {},\r\n  fieldOptions: { ...standardFieldDisplayOptions },\r\n  tooltipOptions: { mode: 'single' },\r\n};\r\n","import kbn from 'app/core/utils/kbn';\r\nexport class AxesEditorCtrl {\r\n  panel: any;\r\n  panelCtrl: any;\r\n  unitFormats: any;\r\n  logScales: any;\r\n  dataFormats: any;\r\n  yBucketBoundModes: any;\r\n\r\n  /** @ngInject */\r\n  constructor($scope: any, uiSegmentSrv: any) {\r\n    $scope.editor = this;\r\n    this.panelCtrl = $scope.ctrl;\r\n    this.panel = this.panelCtrl.panel;\r\n    this.unitFormats = kbn.getUnitFormats();\r\n\r\n    this.logScales = {\r\n      linear: 1,\r\n      'log (base 2)': 2,\r\n      'log (base 10)': 10,\r\n      'log (base 32)': 32,\r\n      'log (base 1024)': 1024,\r\n    };\r\n\r\n    this.dataFormats = {\r\n      'Time series': 'timeseries',\r\n      'Time series buckets': 'tsbuckets',\r\n    };\r\n\r\n    this.yBucketBoundModes = {\r\n      Auto: 'auto',\r\n      Upper: 'upper',\r\n      Lower: 'lower',\r\n      Middle: 'middle',\r\n    };\r\n  }\r\n\r\n  setUnitFormat(subItem: any) {\r\n    this.panel.yAxis.format = subItem.value;\r\n    this.panelCtrl.render();\r\n  }\r\n}\r\n\r\n/** @ngInject */\r\nexport function axesEditor() {\r\n  'use strict';\r\n  return {\r\n    restrict: 'E',\r\n    scope: true,\r\n    templateUrl: 'public/app/plugins/panel/heatmap/partials/axes_editor.html',\r\n    controller: AxesEditorCtrl,\r\n  };\r\n}\r\n","import _ from 'lodash';\r\nimport $ from 'jquery';\r\nimport * as d3 from 'd3';\r\nimport { contextSrv } from 'app/core/core';\r\nimport { tickStep } from 'app/core/utils/ticks';\r\nimport { getColorScale, getOpacityScale } from './color_scale';\r\nimport coreModule from 'app/core/core_module';\r\nimport { PanelEvents, GrafanaThemeType, getColorFromHexRgbOrName } from '@grafana/data';\r\n\r\nconst LEGEND_HEIGHT_PX = 6;\r\nconst LEGEND_WIDTH_PX = 100;\r\nconst LEGEND_TICK_SIZE = 0;\r\nconst LEGEND_VALUE_MARGIN = 0;\r\nconst LEGEND_PADDING_LEFT = 10;\r\nconst LEGEND_SEGMENT_WIDTH = 10;\r\n\r\n/**\r\n * Color legend for heatmap editor.\r\n */\r\ncoreModule.directive('colorLegend', () => {\r\n  return {\r\n    restrict: 'E',\r\n    template: '<div class=\"heatmap-color-legend\"><svg width=\"16.5rem\" height=\"24px\"></svg></div>',\r\n    link: (scope: any, elem, attrs) => {\r\n      const ctrl = scope.ctrl;\r\n      const panel = scope.ctrl.panel;\r\n\r\n      render();\r\n\r\n      ctrl.events.on(PanelEvents.render, () => {\r\n        render();\r\n      });\r\n\r\n      function render() {\r\n        const legendElem = $(elem).find('svg');\r\n        const legendWidth = Math.floor(legendElem.outerWidth());\r\n\r\n        if (panel.color.mode === 'spectrum') {\r\n          const colorScheme: any = _.find(ctrl.colorSchemes, {\r\n            value: panel.color.colorScheme,\r\n          });\r\n          const colorScale = getColorScale(colorScheme, contextSrv.user.lightTheme, legendWidth);\r\n          drawSimpleColorLegend(elem, colorScale);\r\n        } else if (panel.color.mode === 'opacity') {\r\n          const colorOptions = panel.color;\r\n          drawSimpleOpacityLegend(elem, colorOptions);\r\n        }\r\n      }\r\n    },\r\n  };\r\n});\r\n\r\n/**\r\n * Heatmap legend with scale values.\r\n */\r\ncoreModule.directive('heatmapLegend', () => {\r\n  return {\r\n    restrict: 'E',\r\n    template: `<div class=\"heatmap-color-legend\"><svg width=\"${LEGEND_WIDTH_PX}px\" height=\"${LEGEND_HEIGHT_PX}px\"></svg></div>`,\r\n    link: (scope: any, elem, attrs) => {\r\n      const ctrl = scope.ctrl;\r\n      const panel = scope.ctrl.panel;\r\n\r\n      render();\r\n      ctrl.events.on(PanelEvents.render, () => {\r\n        render();\r\n      });\r\n\r\n      function render() {\r\n        clearLegend(elem);\r\n        if (!_.isEmpty(ctrl.data) && !_.isEmpty(ctrl.data.cards)) {\r\n          const cardStats = ctrl.data.cardStats;\r\n          const rangeFrom = _.isNil(panel.color.min) ? Math.min(cardStats.min, 0) : panel.color.min;\r\n          const rangeTo = _.isNil(panel.color.max) ? cardStats.max : panel.color.max;\r\n          const maxValue = cardStats.max;\r\n          const minValue = cardStats.min;\r\n\r\n          if (panel.color.mode === 'spectrum') {\r\n            const colorScheme: any = _.find(ctrl.colorSchemes, {\r\n              value: panel.color.colorScheme,\r\n            });\r\n            drawColorLegend(elem, colorScheme, rangeFrom, rangeTo, maxValue, minValue);\r\n          } else if (panel.color.mode === 'opacity') {\r\n            const colorOptions = panel.color;\r\n            drawOpacityLegend(elem, colorOptions, rangeFrom, rangeTo, maxValue, minValue);\r\n          }\r\n        }\r\n      }\r\n    },\r\n  };\r\n});\r\n\r\nfunction drawColorLegend(\r\n  elem: JQuery,\r\n  colorScheme: any,\r\n  rangeFrom: number,\r\n  rangeTo: number,\r\n  maxValue: number,\r\n  minValue: number\r\n) {\r\n  const legendElem = $(elem).find('svg');\r\n  const legend = d3.select(legendElem.get(0));\r\n  clearLegend(elem);\r\n\r\n  const legendWidth = Math.floor(legendElem.outerWidth()) - 30;\r\n  const legendHeight = legendElem.attr('height');\r\n\r\n  const rangeStep = ((rangeTo - rangeFrom) / legendWidth) * LEGEND_SEGMENT_WIDTH;\r\n  const widthFactor = legendWidth / (rangeTo - rangeFrom);\r\n  const valuesRange = d3.range(rangeFrom, rangeTo, rangeStep);\r\n\r\n  const colorScale = getColorScale(colorScheme, contextSrv.user.lightTheme, maxValue, minValue);\r\n  legend\r\n    .append('g')\r\n    .attr('class', 'legend-color-bar')\r\n    .attr('transform', 'translate(' + LEGEND_PADDING_LEFT + ',0)')\r\n    .selectAll('.heatmap-color-legend-rect')\r\n    .data(valuesRange)\r\n    .enter()\r\n    .append('rect')\r\n    .attr('x', d => Math.round((d - rangeFrom) * widthFactor))\r\n    .attr('y', 0)\r\n    .attr('width', Math.round(rangeStep * widthFactor + 1)) // Overlap rectangles to prevent gaps\r\n    .attr('height', legendHeight)\r\n    .attr('stroke-width', 0)\r\n    .attr('fill', d => colorScale(d));\r\n\r\n  drawLegendValues(elem, rangeFrom, rangeTo, maxValue, minValue, legendWidth, valuesRange);\r\n}\r\n\r\nfunction drawOpacityLegend(\r\n  elem: JQuery,\r\n  options: { cardColor: null },\r\n  rangeFrom: number,\r\n  rangeTo: number,\r\n  maxValue: any,\r\n  minValue: number\r\n) {\r\n  const legendElem = $(elem).find('svg');\r\n  const legend = d3.select(legendElem.get(0));\r\n  clearLegend(elem);\r\n\r\n  const legendWidth = Math.floor(legendElem.outerWidth()) - 30;\r\n  const legendHeight = legendElem.attr('height');\r\n\r\n  const rangeStep = ((rangeTo - rangeFrom) / legendWidth) * LEGEND_SEGMENT_WIDTH;\r\n  const widthFactor = legendWidth / (rangeTo - rangeFrom);\r\n  const valuesRange = d3.range(rangeFrom, rangeTo, rangeStep);\r\n\r\n  const opacityScale = getOpacityScale(options, maxValue, minValue);\r\n  legend\r\n    .append('g')\r\n    .attr('class', 'legend-color-bar')\r\n    .attr('transform', 'translate(' + LEGEND_PADDING_LEFT + ',0)')\r\n    .selectAll('.heatmap-opacity-legend-rect')\r\n    .data(valuesRange)\r\n    .enter()\r\n    .append('rect')\r\n    .attr('x', d => Math.round((d - rangeFrom) * widthFactor))\r\n    .attr('y', 0)\r\n    .attr('width', Math.round(rangeStep * widthFactor))\r\n    .attr('height', legendHeight)\r\n    .attr('stroke-width', 0)\r\n    .attr('fill', options.cardColor)\r\n    .style('opacity', d => opacityScale(d));\r\n\r\n  drawLegendValues(elem, rangeFrom, rangeTo, maxValue, minValue, legendWidth, valuesRange);\r\n}\r\n\r\nfunction drawLegendValues(\r\n  elem: JQuery,\r\n  rangeFrom: number,\r\n  rangeTo: number,\r\n  maxValue: any,\r\n  minValue: any,\r\n  legendWidth: number,\r\n  valuesRange: number[]\r\n) {\r\n  const legendElem = $(elem).find('svg');\r\n  const legend = d3.select(legendElem.get(0));\r\n\r\n  if (legendWidth <= 0 || legendElem.get(0).childNodes.length === 0) {\r\n    return;\r\n  }\r\n\r\n  const legendValueScale = d3\r\n    .scaleLinear()\r\n    .domain([rangeFrom, rangeTo])\r\n    .range([0, legendWidth]);\r\n\r\n  const ticks = buildLegendTicks(rangeFrom, rangeTo, maxValue, minValue);\r\n  const xAxis = d3\r\n    .axisBottom(legendValueScale)\r\n    .tickValues(ticks)\r\n    .tickSize(LEGEND_TICK_SIZE);\r\n\r\n  const colorRect = legendElem.find(':first-child');\r\n  const posY = getSvgElemHeight(legendElem) + LEGEND_VALUE_MARGIN;\r\n  const posX = getSvgElemX(colorRect) + LEGEND_PADDING_LEFT;\r\n\r\n  d3.select(legendElem.get(0))\r\n    .append('g')\r\n    .attr('class', 'axis')\r\n    .attr('transform', 'translate(' + posX + ',' + posY + ')')\r\n    .call(xAxis);\r\n\r\n  legend\r\n    .select('.axis')\r\n    .select('.domain')\r\n    .remove();\r\n}\r\n\r\nfunction drawSimpleColorLegend(elem: JQuery, colorScale: any) {\r\n  const legendElem = $(elem).find('svg');\r\n  clearLegend(elem);\r\n\r\n  const legendWidth = Math.floor(legendElem.outerWidth());\r\n  const legendHeight = legendElem.attr('height');\r\n\r\n  if (legendWidth) {\r\n    const valuesNumber = Math.floor(legendWidth / 2);\r\n    const rangeStep = Math.floor(legendWidth / valuesNumber);\r\n    const valuesRange = d3.range(0, legendWidth, rangeStep);\r\n\r\n    const legend = d3.select(legendElem.get(0));\r\n    const legendRects = legend.selectAll('.heatmap-color-legend-rect').data(valuesRange);\r\n\r\n    legendRects\r\n      .enter()\r\n      .append('rect')\r\n      .attr('x', d => d)\r\n      .attr('y', 0)\r\n      .attr('width', rangeStep + 1) // Overlap rectangles to prevent gaps\r\n      .attr('height', legendHeight)\r\n      .attr('stroke-width', 0)\r\n      .attr('fill', d => colorScale(d));\r\n  }\r\n}\r\n\r\nfunction drawSimpleOpacityLegend(elem: JQuery, options: { colorScale: string; exponent: number; cardColor: string }) {\r\n  const legendElem = $(elem).find('svg');\r\n  clearLegend(elem);\r\n\r\n  const legend = d3.select(legendElem.get(0));\r\n  const legendWidth = Math.floor(legendElem.outerWidth());\r\n  const legendHeight = legendElem.attr('height');\r\n\r\n  if (legendWidth) {\r\n    let legendOpacityScale: any;\r\n    if (options.colorScale === 'linear') {\r\n      legendOpacityScale = d3\r\n        .scaleLinear()\r\n        .domain([0, legendWidth])\r\n        .range([0, 1]);\r\n    } else if (options.colorScale === 'sqrt') {\r\n      legendOpacityScale = d3\r\n        .scalePow()\r\n        .exponent(options.exponent)\r\n        .domain([0, legendWidth])\r\n        .range([0, 1]);\r\n    }\r\n\r\n    const rangeStep = 10;\r\n    const valuesRange = d3.range(0, legendWidth, rangeStep);\r\n    const legendRects = legend.selectAll('.heatmap-opacity-legend-rect').data(valuesRange);\r\n\r\n    legendRects\r\n      .enter()\r\n      .append('rect')\r\n      .attr('x', d => d)\r\n      .attr('y', 0)\r\n      .attr('width', rangeStep)\r\n      .attr('height', legendHeight)\r\n      .attr('stroke-width', 0)\r\n      .attr(\r\n        'fill',\r\n        getColorFromHexRgbOrName(\r\n          options.cardColor,\r\n          contextSrv.user.lightTheme ? GrafanaThemeType.Light : GrafanaThemeType.Dark\r\n        )\r\n      )\r\n      .style('opacity', d => legendOpacityScale(d));\r\n  }\r\n}\r\n\r\nfunction clearLegend(elem: JQuery) {\r\n  const legendElem = $(elem).find('svg');\r\n  legendElem.empty();\r\n}\r\n\r\nfunction getSvgElemX(elem: JQuery) {\r\n  const svgElem: any = elem.get(0) as any;\r\n  if (svgElem && svgElem.x && svgElem.x.baseVal) {\r\n    return svgElem.x.baseVal.value;\r\n  } else {\r\n    return 0;\r\n  }\r\n}\r\n\r\nfunction getSvgElemHeight(elem: JQuery) {\r\n  const svgElem: any = elem.get(0);\r\n  if (svgElem && svgElem.height && svgElem.height.baseVal) {\r\n    return svgElem.height.baseVal.value;\r\n  } else {\r\n    return 0;\r\n  }\r\n}\r\n\r\nfunction buildLegendTicks(rangeFrom: number, rangeTo: number, maxValue: number, minValue: number) {\r\n  const range = rangeTo - rangeFrom;\r\n  const tickStepSize = tickStep(rangeFrom, rangeTo, 3);\r\n  const ticksNum = Math.ceil(range / tickStepSize);\r\n  const firstTick = getFirstCloseTick(rangeFrom, tickStepSize);\r\n  let ticks = [];\r\n\r\n  for (let i = 0; i < ticksNum; i++) {\r\n    const current = firstTick + tickStepSize * i;\r\n    // Add user-defined min and max if it had been set\r\n    if (isValueCloseTo(minValue, current, tickStepSize)) {\r\n      ticks.push(minValue);\r\n      continue;\r\n    } else if (minValue < current) {\r\n      ticks.push(minValue);\r\n    }\r\n    if (isValueCloseTo(maxValue, current, tickStepSize)) {\r\n      ticks.push(maxValue);\r\n      continue;\r\n    } else if (maxValue < current) {\r\n      ticks.push(maxValue);\r\n    }\r\n    ticks.push(current);\r\n  }\r\n  if (!isValueCloseTo(maxValue, rangeTo, tickStepSize)) {\r\n    ticks.push(maxValue);\r\n  }\r\n  ticks.push(rangeTo);\r\n  ticks = _.sortBy(_.uniq(ticks));\r\n  return ticks;\r\n}\r\n\r\nfunction isValueCloseTo(val: number, valueTo: number, step: number) {\r\n  const diff = Math.abs(val - valueTo);\r\n  return diff < step * 0.3;\r\n}\r\n\r\nfunction getFirstCloseTick(minValue: number, step: number) {\r\n  if (minValue < 0) {\r\n    return Math.floor(minValue / step) * step;\r\n  }\r\n  return 0;\r\n}\r\n","import * as d3 from 'd3';\r\nimport * as d3ScaleChromatic from 'd3-scale-chromatic';\r\n\r\nexport function getColorScale(colorScheme: any, lightTheme: boolean, maxValue: number, minValue = 0): (d: any) => any {\r\n  //@ts-ignore\r\n  const colorInterpolator = d3ScaleChromatic[colorScheme.value];\r\n  const colorScaleInverted = colorScheme.invert === 'always' || colorScheme.invert === (lightTheme ? 'light' : 'dark');\r\n\r\n  const start = colorScaleInverted ? maxValue : minValue;\r\n  const end = colorScaleInverted ? minValue : maxValue;\r\n\r\n  return d3.scaleSequential(colorInterpolator).domain([start, end]);\r\n}\r\n\r\nexport function getOpacityScale(\r\n  options: { cardColor?: null; colorScale?: any; exponent?: any },\r\n  maxValue: number,\r\n  minValue = 0\r\n) {\r\n  let legendOpacityScale;\r\n  if (options.colorScale === 'linear') {\r\n    legendOpacityScale = d3\r\n      .scaleLinear()\r\n      .domain([minValue, maxValue])\r\n      .range([0, 1]);\r\n  } else if (options.colorScale === 'sqrt') {\r\n    legendOpacityScale = d3\r\n      .scalePow()\r\n      .exponent(options.exponent)\r\n      .domain([minValue, maxValue])\r\n      .range([0, 1]);\r\n  }\r\n  return legendOpacityScale;\r\n}\r\n","export class HeatmapDisplayEditorCtrl {\r\n  panel: any;\r\n  panelCtrl: any;\r\n\r\n  /** @ngInject */\r\n  constructor($scope: any) {\r\n    $scope.editor = this;\r\n    this.panelCtrl = $scope.ctrl;\r\n    this.panel = this.panelCtrl.panel;\r\n\r\n    this.panelCtrl.render();\r\n  }\r\n}\r\n\r\n/** @ngInject */\r\nexport function heatmapDisplayEditor() {\r\n  'use strict';\r\n  return {\r\n    restrict: 'E',\r\n    scope: true,\r\n    templateUrl: 'public/app/plugins/panel/heatmap/partials/display_editor.html',\r\n    controller: HeatmapDisplayEditorCtrl,\r\n  };\r\n}\r\n","import { MetricsPanelCtrl } from 'app/plugins/sdk';\r\nimport _ from 'lodash';\r\nimport kbn from 'app/core/utils/kbn';\r\nimport TimeSeries from 'app/core/time_series2';\r\nimport { axesEditor } from './axes_editor';\r\nimport { heatmapDisplayEditor } from './display_editor';\r\nimport rendering from './rendering';\r\nimport {\r\n  convertToHeatMap,\r\n  convertToCards,\r\n  histogramToHeatmap,\r\n  calculateBucketSize,\r\n  sortSeriesByLabel,\r\n} from './heatmap_data_converter';\r\nimport { auto } from 'angular';\r\nimport { getProcessedDataFrames } from 'app/features/dashboard/state/runRequest';\r\nimport { DataProcessor } from '../graph/data_processor';\r\nimport { LegacyResponseData, PanelEvents, DataFrame } from '@grafana/data';\r\nimport { CoreEvents } from 'app/types';\r\n\r\nconst X_BUCKET_NUMBER_DEFAULT = 30;\r\nconst Y_BUCKET_NUMBER_DEFAULT = 10;\r\n\r\nconst panelDefaults: any = {\r\n  heatmap: {},\r\n  cards: {\r\n    cardPadding: null,\r\n    cardRound: null,\r\n  },\r\n  color: {\r\n    mode: 'spectrum',\r\n    cardColor: '#b4ff00',\r\n    colorScale: 'sqrt',\r\n    exponent: 0.5,\r\n    colorScheme: 'interpolateOranges',\r\n  },\r\n  legend: {\r\n    show: false,\r\n  },\r\n  dataFormat: 'timeseries',\r\n  yBucketBound: 'auto',\r\n  reverseYBuckets: false,\r\n  xAxis: {\r\n    show: true,\r\n  },\r\n  yAxis: {\r\n    show: true,\r\n    format: 'short',\r\n    decimals: null,\r\n    logBase: 1,\r\n    splitFactor: null,\r\n    min: null,\r\n    max: null,\r\n  },\r\n  xBucketSize: null,\r\n  xBucketNumber: null,\r\n  yBucketSize: null,\r\n  yBucketNumber: null,\r\n  tooltip: {\r\n    show: true,\r\n    showHistogram: false,\r\n  },\r\n  highlightCards: true,\r\n  hideZeroBuckets: false,\r\n};\r\n\r\nconst colorModes = ['opacity', 'spectrum'];\r\nconst opacityScales = ['linear', 'sqrt'];\r\n\r\n// Schemes from d3-scale-chromatic\r\n// https://github.com/d3/d3-scale-chromatic\r\nconst colorSchemes = [\r\n  // Diverging\r\n  { name: 'Spectral', value: 'interpolateSpectral', invert: 'always' },\r\n  { name: 'RdYlGn', value: 'interpolateRdYlGn', invert: 'always' },\r\n\r\n  // Sequential (Single Hue)\r\n  { name: 'Blues', value: 'interpolateBlues', invert: 'dark' },\r\n  { name: 'Greens', value: 'interpolateGreens', invert: 'dark' },\r\n  { name: 'Greys', value: 'interpolateGreys', invert: 'dark' },\r\n  { name: 'Oranges', value: 'interpolateOranges', invert: 'dark' },\r\n  { name: 'Purples', value: 'interpolatePurples', invert: 'dark' },\r\n  { name: 'Reds', value: 'interpolateReds', invert: 'dark' },\r\n\r\n  // Sequential (Multi-Hue)\r\n  { name: 'Turbo', value: 'interpolateTurbo', invert: 'light' },\r\n  { name: 'Cividis', value: 'interpolateCividis', invert: 'light' },\r\n  { name: 'Viridis', value: 'interpolateViridis', invert: 'light' },\r\n  { name: 'Magma', value: 'interpolateMagma', invert: 'light' },\r\n  { name: 'Inferno', value: 'interpolateInferno', invert: 'light' },\r\n  { name: 'Plasma', value: 'interpolatePlasma', invert: 'light' },\r\n  { name: 'Warm', value: 'interpolateWarm', invert: 'light' },\r\n  { name: 'Cool', value: 'interpolateCool', invert: 'light' },\r\n  { name: 'Cubehelix', value: 'interpolateCubehelixDefault', invert: 'light' },\r\n  { name: 'BuGn', value: 'interpolateBuGn', invert: 'dark' },\r\n  { name: 'BuPu', value: 'interpolateBuPu', invert: 'dark' },\r\n  { name: 'GnBu', value: 'interpolateGnBu', invert: 'dark' },\r\n  { name: 'OrRd', value: 'interpolateOrRd', invert: 'dark' },\r\n  { name: 'PuBuGn', value: 'interpolatePuBuGn', invert: 'dark' },\r\n  { name: 'PuBu', value: 'interpolatePuBu', invert: 'dark' },\r\n  { name: 'PuRd', value: 'interpolatePuRd', invert: 'dark' },\r\n  { name: 'RdPu', value: 'interpolateRdPu', invert: 'dark' },\r\n  { name: 'YlGnBu', value: 'interpolateYlGnBu', invert: 'dark' },\r\n  { name: 'YlGn', value: 'interpolateYlGn', invert: 'dark' },\r\n  { name: 'YlOrBr', value: 'interpolateYlOrBr', invert: 'dark' },\r\n  { name: 'YlOrRd', value: 'interpolateYlOrRd', invert: 'dark' },\r\n];\r\n\r\nconst dsSupportHistogramSort = ['elasticsearch'];\r\n\r\nexport class HeatmapCtrl extends MetricsPanelCtrl {\r\n  static templateUrl = 'module.html';\r\n\r\n  opacityScales: any = [];\r\n  colorModes: any = [];\r\n  colorSchemes: any = [];\r\n  selectionActivated: boolean;\r\n  unitFormats: any;\r\n  data: any;\r\n  series: TimeSeries[];\r\n  dataWarning: any;\r\n  decimals: number;\r\n  scaledDecimals: number;\r\n\r\n  processor: DataProcessor; // Shared with graph panel\r\n\r\n  /** @ngInject */\r\n  constructor($scope: any, $injector: auto.IInjectorService) {\r\n    super($scope, $injector);\r\n    this.selectionActivated = false;\r\n\r\n    _.defaultsDeep(this.panel, panelDefaults);\r\n    this.opacityScales = opacityScales;\r\n    this.colorModes = colorModes;\r\n    this.colorSchemes = colorSchemes;\r\n\r\n    // Use DataFrames\r\n    this.useDataFrames = true;\r\n    this.processor = new DataProcessor({\r\n      xaxis: { mode: 'custom' }, // NOT: 'histogram' :)\r\n      aliasColors: {}, // avoids null reference\r\n    });\r\n\r\n    // Bind grafana panel events\r\n    this.events.on(PanelEvents.render, this.onRender.bind(this));\r\n    this.events.on(CoreEvents.dataFramesReceived, this.onDataFramesReceived.bind(this));\r\n    this.events.on(PanelEvents.dataSnapshotLoad, this.onSnapshotLoad.bind(this));\r\n    this.events.on(PanelEvents.editModeInitialized, this.onInitEditMode.bind(this));\r\n\r\n    this.onCardColorChange = this.onCardColorChange.bind(this);\r\n  }\r\n\r\n  onInitEditMode() {\r\n    this.addEditorTab('Axes', axesEditor, 2);\r\n    this.addEditorTab('Display', heatmapDisplayEditor, 3);\r\n    this.unitFormats = kbn.getUnitFormats();\r\n  }\r\n\r\n  zoomOut(evt: any) {\r\n    this.publishAppEvent(CoreEvents.zoomOut, 2);\r\n  }\r\n\r\n  onRender() {\r\n    if (!this.range || !this.series) {\r\n      return;\r\n    }\r\n\r\n    if (this.panel.dataFormat === 'tsbuckets') {\r\n      this.convertHistogramToHeatmapData();\r\n    } else {\r\n      this.convertTimeSeriesToHeatmapData();\r\n    }\r\n  }\r\n\r\n  convertTimeSeriesToHeatmapData() {\r\n    let xBucketSize, yBucketSize, bucketsData, heatmapStats;\r\n    const logBase = this.panel.yAxis.logBase;\r\n\r\n    const xBucketNumber = this.panel.xBucketNumber || X_BUCKET_NUMBER_DEFAULT;\r\n    const xBucketSizeByNumber = Math.floor((this.range.to.valueOf() - this.range.from.valueOf()) / xBucketNumber);\r\n\r\n    // Parse X bucket size (number or interval)\r\n    const isIntervalString = kbn.interval_regex.test(this.panel.xBucketSize);\r\n    if (isIntervalString) {\r\n      xBucketSize = kbn.interval_to_ms(this.panel.xBucketSize);\r\n    } else if (\r\n      isNaN(Number(this.panel.xBucketSize)) ||\r\n      this.panel.xBucketSize === '' ||\r\n      this.panel.xBucketSize === null\r\n    ) {\r\n      xBucketSize = xBucketSizeByNumber;\r\n    } else {\r\n      xBucketSize = Number(this.panel.xBucketSize);\r\n    }\r\n\r\n    // Calculate Y bucket size\r\n    heatmapStats = this.parseSeries(this.series);\r\n    const yBucketNumber = this.panel.yBucketNumber || Y_BUCKET_NUMBER_DEFAULT;\r\n    if (logBase !== 1) {\r\n      yBucketSize = this.panel.yAxis.splitFactor;\r\n    } else {\r\n      if (heatmapStats.max === heatmapStats.min) {\r\n        if (heatmapStats.max) {\r\n          yBucketSize = heatmapStats.max / Y_BUCKET_NUMBER_DEFAULT;\r\n        } else {\r\n          yBucketSize = 1;\r\n        }\r\n      } else {\r\n        yBucketSize = (heatmapStats.max - heatmapStats.min) / yBucketNumber;\r\n      }\r\n      yBucketSize = this.panel.yBucketSize || yBucketSize;\r\n    }\r\n\r\n    bucketsData = convertToHeatMap(this.series, yBucketSize, xBucketSize, logBase);\r\n\r\n    // Set default Y range if no data\r\n    if (!heatmapStats.min && !heatmapStats.max) {\r\n      heatmapStats = { min: -1, max: 1, minLog: 1 };\r\n      yBucketSize = 1;\r\n    }\r\n\r\n    const { cards, cardStats } = convertToCards(bucketsData, this.panel.hideZeroBuckets);\r\n\r\n    this.data = {\r\n      buckets: bucketsData,\r\n      heatmapStats: heatmapStats,\r\n      xBucketSize: xBucketSize,\r\n      yBucketSize: yBucketSize,\r\n      cards: cards,\r\n      cardStats: cardStats,\r\n    };\r\n  }\r\n\r\n  convertHistogramToHeatmapData() {\r\n    const panelDatasource = this.getPanelDataSourceType();\r\n    let xBucketSize, yBucketSize, bucketsData, tsBuckets;\r\n\r\n    // Try to sort series by bucket bound, if datasource doesn't do it.\r\n    if (!_.includes(dsSupportHistogramSort, panelDatasource)) {\r\n      this.series.sort(sortSeriesByLabel);\r\n    }\r\n\r\n    if (this.panel.reverseYBuckets) {\r\n      this.series.reverse();\r\n    }\r\n\r\n    // Convert histogram to heatmap. Each histogram bucket represented by the series which name is\r\n    // a top (or bottom, depends of datasource) bucket bound. Further, these values will be used as Y axis labels.\r\n    bucketsData = histogramToHeatmap(this.series);\r\n\r\n    tsBuckets = _.map(this.series, 'label');\r\n    const yBucketBound = this.panel.yBucketBound;\r\n    if (\r\n      (panelDatasource === 'prometheus' && yBucketBound !== 'lower' && yBucketBound !== 'middle') ||\r\n      yBucketBound === 'upper'\r\n    ) {\r\n      // Prometheus labels are upper inclusive bounds, so add empty bottom bucket label.\r\n      tsBuckets = [''].concat(tsBuckets);\r\n    } else {\r\n      // Elasticsearch uses labels as lower bucket bounds, so add empty top bucket label.\r\n      // Use this as a default mode as well.\r\n      tsBuckets.push('');\r\n    }\r\n\r\n    // Calculate bucket size based on heatmap data\r\n    const xBucketBoundSet = _.map(_.keys(bucketsData), key => Number(key));\r\n    xBucketSize = calculateBucketSize(xBucketBoundSet);\r\n    // Always let yBucketSize=1 in 'tsbuckets' mode\r\n    yBucketSize = 1;\r\n\r\n    const { cards, cardStats } = convertToCards(bucketsData, this.panel.hideZeroBuckets);\r\n\r\n    this.data = {\r\n      buckets: bucketsData,\r\n      xBucketSize: xBucketSize,\r\n      yBucketSize: yBucketSize,\r\n      tsBuckets: tsBuckets,\r\n      cards: cards,\r\n      cardStats: cardStats,\r\n    };\r\n  }\r\n\r\n  getPanelDataSourceType() {\r\n    if (this.datasource && this.datasource.meta && this.datasource.meta.id) {\r\n      return this.datasource.meta.id;\r\n    } else {\r\n      return 'unknown';\r\n    }\r\n  }\r\n\r\n  // This should only be called from the snapshot callback\r\n  onSnapshotLoad(dataList: LegacyResponseData[]) {\r\n    this.onDataFramesReceived(getProcessedDataFrames(dataList));\r\n  }\r\n\r\n  // Directly support DataFrame\r\n  onDataFramesReceived(data: DataFrame[]) {\r\n    this.series = this.processor.getSeriesList({ dataList: data, range: this.range }).map(ts => {\r\n      ts.color = null; // remove whatever the processor set\r\n      ts.flotpairs = ts.getFlotPairs(this.panel.nullPointMode);\r\n      return ts;\r\n    });\r\n\r\n    this.dataWarning = null;\r\n    const datapointsCount = _.reduce(\r\n      this.series,\r\n      (sum, series) => {\r\n        return sum + series.datapoints.length;\r\n      },\r\n      0\r\n    );\r\n\r\n    if (datapointsCount === 0) {\r\n      this.dataWarning = {\r\n        title: 'No data points',\r\n        tip: 'No datapoints returned from data query',\r\n      };\r\n    } else {\r\n      for (const series of this.series) {\r\n        if (series.isOutsideRange) {\r\n          this.dataWarning = {\r\n            title: 'Data points outside time range',\r\n            tip: 'Can be caused by timezone mismatch or missing time filter in query',\r\n          };\r\n          break;\r\n        }\r\n      }\r\n    }\r\n\r\n    this.render();\r\n  }\r\n\r\n  onDataError() {\r\n    this.series = [];\r\n    this.render();\r\n  }\r\n\r\n  onCardColorChange(newColor: any) {\r\n    this.panel.color.cardColor = newColor;\r\n    this.render();\r\n  }\r\n\r\n  parseSeries(series: TimeSeries[]) {\r\n    const min = _.min(_.map(series, s => s.stats.min));\r\n    const minLog = _.min(_.map(series, s => s.stats.logmin));\r\n    const max = _.max(_.map(series, s => s.stats.max));\r\n\r\n    return {\r\n      max,\r\n      min,\r\n      minLog,\r\n    };\r\n  }\r\n\r\n  parseHistogramSeries(series: TimeSeries[]) {\r\n    const bounds = _.map(series, s => Number(s.alias));\r\n    const min = _.min(bounds);\r\n    const minLog = _.min(bounds);\r\n    const max = _.max(bounds);\r\n\r\n    return {\r\n      max: max,\r\n      min: min,\r\n      minLog: minLog,\r\n    };\r\n  }\r\n\r\n  link(scope: any, elem: any, attrs: any, ctrl: any) {\r\n    rendering(scope, elem, attrs, ctrl);\r\n  }\r\n}\r\n","import _ from 'lodash';\r\nimport { TimeSeries } from 'app/core/core';\r\nimport { Bucket, HeatmapCard, HeatmapCardStats, YBucket, XBucket } from './types';\r\n\r\nconst VALUE_INDEX = 0;\r\nconst TIME_INDEX = 1;\r\n\r\n/**\r\n * Convert histogram represented by the list of series to heatmap object.\r\n * @param seriesList List of time series\r\n */\r\nfunction histogramToHeatmap(seriesList: TimeSeries[]) {\r\n  const heatmap: any = {};\r\n\r\n  for (let i = 0; i < seriesList.length; i++) {\r\n    const series = seriesList[i];\r\n    const bound = i;\r\n    if (isNaN(bound)) {\r\n      return heatmap;\r\n    }\r\n\r\n    for (const point of series.datapoints) {\r\n      const count = point[VALUE_INDEX];\r\n      const time = point[TIME_INDEX];\r\n\r\n      if (!_.isNumber(count)) {\r\n        continue;\r\n      }\r\n\r\n      let bucket = heatmap[time];\r\n      if (!bucket) {\r\n        bucket = heatmap[time] = { x: time, buckets: {} };\r\n      }\r\n\r\n      bucket.buckets[bound] = {\r\n        y: bound,\r\n        count: count,\r\n        bounds: {\r\n          top: null,\r\n          bottom: bound,\r\n        },\r\n        values: [],\r\n        points: [],\r\n      };\r\n    }\r\n  }\r\n\r\n  return heatmap;\r\n}\r\n\r\n/**\r\n * Sort series representing histogram by label value.\r\n */\r\nfunction sortSeriesByLabel(s1: { label: string }, s2: { label: string }) {\r\n  let label1, label2;\r\n\r\n  try {\r\n    // fail if not integer. might happen with bad queries\r\n    label1 = parseHistogramLabel(s1.label);\r\n    label2 = parseHistogramLabel(s2.label);\r\n  } catch (err) {\r\n    console.log(err.message || err);\r\n    return 0;\r\n  }\r\n\r\n  if (label1 > label2) {\r\n    return 1;\r\n  }\r\n\r\n  if (label1 < label2) {\r\n    return -1;\r\n  }\r\n\r\n  return 0;\r\n}\r\n\r\nfunction parseHistogramLabel(label: string): number {\r\n  if (label === '+Inf' || label === 'inf') {\r\n    return +Infinity;\r\n  }\r\n  const value = Number(label);\r\n  if (isNaN(value)) {\r\n    throw new Error(`Error parsing histogram label: ${label} is not a number`);\r\n  }\r\n  return value;\r\n}\r\n\r\n/**\r\n * Convert buckets into linear array of \"cards\" - objects, represented heatmap elements.\r\n * @param  {Object} buckets\r\n * @return {Object}          Array of \"card\" objects and stats\r\n */\r\nfunction convertToCards(buckets: any, hideZero = false): { cards: HeatmapCard[]; cardStats: HeatmapCardStats } {\r\n  let min = 0,\r\n    max = 0;\r\n  const cards: HeatmapCard[] = [];\r\n  _.forEach(buckets, xBucket => {\r\n    _.forEach(xBucket.buckets, yBucket => {\r\n      const card: HeatmapCard = {\r\n        x: xBucket.x,\r\n        y: yBucket.y,\r\n        yBounds: yBucket.bounds,\r\n        values: yBucket.values,\r\n        count: yBucket.count,\r\n      };\r\n      if (!hideZero || card.count !== 0) {\r\n        cards.push(card);\r\n      }\r\n\r\n      if (cards.length === 1) {\r\n        min = yBucket.count;\r\n        max = yBucket.count;\r\n      }\r\n\r\n      min = yBucket.count < min ? yBucket.count : min;\r\n      max = yBucket.count > max ? yBucket.count : max;\r\n    });\r\n  });\r\n\r\n  const cardStats = { min, max };\r\n  return { cards, cardStats };\r\n}\r\n\r\n/**\r\n * Special method for log scales. When series converted into buckets with log scale,\r\n * for simplification, 0 values are converted into 0, not into -Infinity. On the other hand, we mean\r\n * that all values less than series minimum, is 0 values, and we create special \"minimum\" bucket for\r\n * that values (actually, there're no values less than minimum, so this bucket is empty).\r\n *  8-16|    | ** |    |  * |  **|\r\n *   4-8|  * |*  *|*   |** *| *  |\r\n *   2-4| * *|    | ***|    |*   |\r\n *   1-2|*   |    |    |    |    | This bucket contains minimum series value\r\n * 0.5-1|____|____|____|____|____| This bucket should be displayed as 0 on graph\r\n *     0|____|____|____|____|____| This bucket is for 0 values (should actually be -Infinity)\r\n * So we should merge two bottom buckets into one (0-value bucket).\r\n *\r\n * @param  {Object} buckets  Heatmap buckets\r\n * @param  {Number} minValue Minimum series value\r\n * @return {Object}          Transformed buckets\r\n */\r\nfunction mergeZeroBuckets(buckets: any, minValue: number) {\r\n  _.forEach(buckets, xBucket => {\r\n    const yBuckets = xBucket.buckets;\r\n\r\n    const emptyBucket: any = {\r\n      bounds: { bottom: 0, top: 0 },\r\n      values: [],\r\n      points: [],\r\n      count: 0,\r\n    };\r\n\r\n    const nullBucket = yBuckets[0] || emptyBucket;\r\n    const minBucket = yBuckets[minValue] || emptyBucket;\r\n\r\n    const newBucket: any = {\r\n      y: 0,\r\n      bounds: { bottom: minValue, top: minBucket.bounds.top || minValue },\r\n      values: [],\r\n      points: [],\r\n      count: 0,\r\n    };\r\n\r\n    newBucket.points = nullBucket.points.concat(minBucket.points);\r\n    newBucket.values = nullBucket.values.concat(minBucket.values);\r\n    newBucket.count = newBucket.values.length;\r\n\r\n    if (newBucket.count === 0) {\r\n      return;\r\n    }\r\n\r\n    delete yBuckets[minValue];\r\n    yBuckets[0] = newBucket;\r\n  });\r\n\r\n  return buckets;\r\n}\r\n\r\n/**\r\n * Convert set of time series into heatmap buckets\r\n * @return {Object}    Heatmap object:\r\n * {\r\n *   xBucketBound_1: {\r\n *     x: xBucketBound_1,\r\n *     buckets: {\r\n *       yBucketBound_1: {\r\n *         y: yBucketBound_1,\r\n *         bounds: {bottom, top}\r\n *         values: [val_1, val_2, ..., val_K],\r\n *         points: [[val_Y, val_X, series_name], ..., [...]],\r\n *         seriesStat: {seriesName_1: val_1, seriesName_2: val_2}\r\n *       },\r\n *       ...\r\n *       yBucketBound_M: {}\r\n *     },\r\n *     values: [val_1, val_2, ..., val_K],\r\n *     points: [\r\n *       [val_Y, val_X, series_name], (point_1)\r\n *       ...\r\n *       [...] (point_K)\r\n *     ]\r\n *   },\r\n *   xBucketBound_2: {},\r\n *   ...\r\n *   xBucketBound_N: {}\r\n * }\r\n */\r\nfunction convertToHeatMap(seriesList: TimeSeries[], yBucketSize: number, xBucketSize: number, logBase = 1) {\r\n  const heatmap = {};\r\n\r\n  for (const series of seriesList) {\r\n    const datapoints = series.datapoints;\r\n    const seriesName = series.label;\r\n\r\n    // Slice series into X axis buckets\r\n    // |    | ** |    |  * |  **|\r\n    // |  * |*  *|*   |** *| *  |\r\n    // |** *|    | ***|    |*   |\r\n    // |____|____|____|____|____|_\r\n    //\r\n    _.forEach(datapoints, point => {\r\n      const bucketBound = getBucketBound(point[TIME_INDEX], xBucketSize);\r\n      pushToXBuckets(heatmap, point, bucketBound, seriesName);\r\n    });\r\n  }\r\n\r\n  // Slice X axis buckets into Y (value) buckets\r\n  // |  **|     |2|,\r\n  // | *  | --\\ |1|,\r\n  // |*   | --/ |1|,\r\n  // |____|     |0|\r\n  //\r\n  _.forEach(heatmap, (xBucket: any) => {\r\n    if (logBase !== 1) {\r\n      xBucket.buckets = convertToLogScaleValueBuckets(xBucket, yBucketSize, logBase);\r\n    } else {\r\n      xBucket.buckets = convertToValueBuckets(xBucket, yBucketSize);\r\n    }\r\n  });\r\n\r\n  return heatmap;\r\n}\r\n\r\nfunction pushToXBuckets(buckets: any, point: any[], bucketNum: number, seriesName: string) {\r\n  const value = point[VALUE_INDEX];\r\n  if (value === null || value === undefined || isNaN(value)) {\r\n    return;\r\n  }\r\n\r\n  // Add series name to point for future identification\r\n  const pointExt = _.concat(point, seriesName);\r\n\r\n  if (buckets[bucketNum] && buckets[bucketNum].values) {\r\n    buckets[bucketNum].values.push(value);\r\n    buckets[bucketNum].points.push(pointExt);\r\n  } else {\r\n    buckets[bucketNum] = {\r\n      x: bucketNum,\r\n      values: [value],\r\n      points: [pointExt],\r\n    };\r\n  }\r\n}\r\n\r\nfunction pushToYBuckets(\r\n  buckets: Bucket,\r\n  bucketNum: number,\r\n  value: any,\r\n  point: string[],\r\n  bounds: { bottom: number; top: number }\r\n) {\r\n  let count = 1;\r\n  // Use the 3rd argument as scale/count\r\n  if (point.length > 3) {\r\n    count = parseInt(point[2], 10);\r\n  }\r\n  if (buckets[bucketNum]) {\r\n    buckets[bucketNum].values.push(value);\r\n    buckets[bucketNum].points.push(point);\r\n    buckets[bucketNum].count += count;\r\n  } else {\r\n    buckets[bucketNum] = {\r\n      y: bucketNum,\r\n      bounds: bounds,\r\n      values: [value],\r\n      points: [point],\r\n      count: count,\r\n    };\r\n  }\r\n}\r\n\r\nfunction getValueBucketBound(value: any, yBucketSize: number, logBase: number) {\r\n  if (logBase === 1) {\r\n    return getBucketBound(value, yBucketSize);\r\n  } else {\r\n    return getLogScaleBucketBound(value, yBucketSize, logBase);\r\n  }\r\n}\r\n\r\n/**\r\n * Find bucket for given value (for linear scale)\r\n */\r\nfunction getBucketBounds(value: number, bucketSize: number) {\r\n  let bottom, top;\r\n  bottom = Math.floor(value / bucketSize) * bucketSize;\r\n  top = (Math.floor(value / bucketSize) + 1) * bucketSize;\r\n\r\n  return { bottom, top };\r\n}\r\n\r\nfunction getBucketBound(value: number, bucketSize: number) {\r\n  const bounds = getBucketBounds(value, bucketSize);\r\n  return bounds.bottom;\r\n}\r\n\r\nfunction convertToValueBuckets(xBucket: { values: any; points: any }, bucketSize: number) {\r\n  const values = xBucket.values;\r\n  const points = xBucket.points;\r\n  const buckets = {};\r\n\r\n  _.forEach(values, (val, index) => {\r\n    const bounds = getBucketBounds(val, bucketSize);\r\n    const bucketNum = bounds.bottom;\r\n    pushToYBuckets(buckets, bucketNum, val, points[index], bounds);\r\n  });\r\n\r\n  return buckets;\r\n}\r\n\r\n/**\r\n * Find bucket for given value (for log scales)\r\n */\r\nfunction getLogScaleBucketBounds(value: number, yBucketSplitFactor: number, logBase: number) {\r\n  let top, bottom;\r\n  if (value === 0) {\r\n    return { bottom: 0, top: 0 };\r\n  }\r\n\r\n  const valueLog = logp(value, logBase);\r\n  let pow, powTop;\r\n  if (yBucketSplitFactor === 1 || !yBucketSplitFactor) {\r\n    pow = Math.floor(valueLog);\r\n    powTop = pow + 1;\r\n  } else {\r\n    const additionalBucketSize = 1 / yBucketSplitFactor;\r\n    let additionalLog = valueLog - Math.floor(valueLog);\r\n    additionalLog = Math.floor(additionalLog / additionalBucketSize) * additionalBucketSize;\r\n    pow = Math.floor(valueLog) + additionalLog;\r\n    powTop = pow + additionalBucketSize;\r\n  }\r\n  bottom = Math.pow(logBase, pow);\r\n  top = Math.pow(logBase, powTop);\r\n\r\n  return { bottom, top };\r\n}\r\n\r\nfunction getLogScaleBucketBound(value: number, yBucketSplitFactor: number, logBase: number) {\r\n  const bounds = getLogScaleBucketBounds(value, yBucketSplitFactor, logBase);\r\n  return bounds.bottom;\r\n}\r\n\r\nfunction convertToLogScaleValueBuckets(\r\n  xBucket: { values: any; points: any },\r\n  yBucketSplitFactor: number,\r\n  logBase: number\r\n) {\r\n  const values = xBucket.values;\r\n  const points = xBucket.points;\r\n\r\n  const buckets = {};\r\n  _.forEach(values, (val, index) => {\r\n    const bounds = getLogScaleBucketBounds(val, yBucketSplitFactor, logBase);\r\n    const bucketNum = bounds.bottom;\r\n    pushToYBuckets(buckets, bucketNum, val, points[index], bounds);\r\n  });\r\n\r\n  return buckets;\r\n}\r\n\r\n/**\r\n * Logarithm for custom base\r\n * @param value\r\n * @param base logarithm base\r\n */\r\nfunction logp(value: number, base: number) {\r\n  return Math.log(value) / Math.log(base);\r\n}\r\n\r\n/**\r\n * Calculate size of Y bucket from given buckets bounds.\r\n * @param bounds Array of Y buckets bounds\r\n * @param logBase Logarithm base\r\n */\r\nfunction calculateBucketSize(bounds: number[], logBase = 1): number {\r\n  let bucketSize = Infinity;\r\n\r\n  if (bounds.length === 0) {\r\n    return 0;\r\n  } else if (bounds.length === 1) {\r\n    return bounds[0];\r\n  } else {\r\n    bounds = _.sortBy(bounds);\r\n    for (let i = 1; i < bounds.length; i++) {\r\n      const distance = getDistance(bounds[i], bounds[i - 1], logBase);\r\n      bucketSize = distance < bucketSize ? distance : bucketSize;\r\n    }\r\n  }\r\n\r\n  return bucketSize;\r\n}\r\n\r\n/**\r\n * Calculate distance between two numbers in given scale (linear or logarithmic).\r\n * @param a\r\n * @param b\r\n * @param logBase\r\n */\r\nfunction getDistance(a: number, b: number, logBase = 1): number {\r\n  if (logBase === 1) {\r\n    // Linear distance\r\n    return Math.abs(b - a);\r\n  } else {\r\n    // logarithmic distance\r\n    const ratio = Math.max(a, b) / Math.min(a, b);\r\n    return logp(ratio, logBase);\r\n  }\r\n}\r\n\r\n/**\r\n * Compare two heatmap data objects\r\n * @param objA\r\n * @param objB\r\n */\r\nfunction isHeatmapDataEqual(objA: any, objB: any): boolean {\r\n  let isEql = !emptyXOR(objA, objB);\r\n\r\n  _.forEach(objA, (xBucket: XBucket, x) => {\r\n    if (objB[x]) {\r\n      if (emptyXOR(xBucket.buckets, objB[x].buckets)) {\r\n        isEql = false;\r\n        return false;\r\n      }\r\n\r\n      _.forEach(xBucket.buckets, (yBucket: YBucket, y) => {\r\n        if (objB[x].buckets && objB[x].buckets[y]) {\r\n          if (objB[x].buckets[y].values) {\r\n            isEql = _.isEqual(_.sortBy(yBucket.values), _.sortBy(objB[x].buckets[y].values));\r\n            if (!isEql) {\r\n              return false;\r\n            } else {\r\n              return true;\r\n            }\r\n          } else {\r\n            isEql = false;\r\n            return false;\r\n          }\r\n        } else {\r\n          isEql = false;\r\n          return false;\r\n        }\r\n      });\r\n\r\n      if (!isEql) {\r\n        return false;\r\n      } else {\r\n        return true;\r\n      }\r\n    } else {\r\n      isEql = false;\r\n      return false;\r\n    }\r\n  });\r\n\r\n  return isEql;\r\n}\r\n\r\nfunction emptyXOR(foo: any, bar: any): boolean {\r\n  return (_.isEmpty(foo) || _.isEmpty(bar)) && !(_.isEmpty(foo) && _.isEmpty(bar));\r\n}\r\n\r\nexport {\r\n  convertToHeatMap,\r\n  histogramToHeatmap,\r\n  convertToCards,\r\n  mergeZeroBuckets,\r\n  getValueBucketBound,\r\n  isHeatmapDataEqual,\r\n  calculateBucketSize,\r\n  sortSeriesByLabel,\r\n};\r\n","import * as d3 from 'd3';\r\nimport $ from 'jquery';\r\nimport _ from 'lodash';\r\nimport { getValueBucketBound } from './heatmap_data_converter';\r\nimport { getValueFormat, formattedValueToString } from '@grafana/data';\r\n\r\nconst TOOLTIP_PADDING_X = 30;\r\nconst TOOLTIP_PADDING_Y = 5;\r\nconst HISTOGRAM_WIDTH = 160;\r\nconst HISTOGRAM_HEIGHT = 40;\r\n\r\nexport class HeatmapTooltip {\r\n  tooltip: any;\r\n  scope: any;\r\n  dashboard: any;\r\n  panelCtrl: any;\r\n  panel: any;\r\n  heatmapPanel: any;\r\n  mouseOverBucket: boolean;\r\n  originalFillColor: any;\r\n\r\n  constructor(elem: JQuery, scope: any) {\r\n    this.scope = scope;\r\n    this.dashboard = scope.ctrl.dashboard;\r\n    this.panelCtrl = scope.ctrl;\r\n    this.panel = scope.ctrl.panel;\r\n    this.heatmapPanel = elem;\r\n    this.mouseOverBucket = false;\r\n    this.originalFillColor = null;\r\n\r\n    elem.on('mouseleave', this.onMouseLeave.bind(this));\r\n  }\r\n\r\n  onMouseLeave() {\r\n    this.destroy();\r\n  }\r\n\r\n  onMouseMove(e: any) {\r\n    if (!this.panel.tooltip.show) {\r\n      return;\r\n    }\r\n\r\n    this.move(e);\r\n  }\r\n\r\n  add() {\r\n    this.tooltip = d3\r\n      .select('body')\r\n      .append('div')\r\n      .attr('class', 'heatmap-tooltip graph-tooltip grafana-tooltip');\r\n  }\r\n\r\n  destroy() {\r\n    if (this.tooltip) {\r\n      this.tooltip.remove();\r\n    }\r\n\r\n    this.tooltip = null;\r\n  }\r\n\r\n  show(pos: { panelRelY: any }, data: any) {\r\n    if (!this.panel.tooltip.show || !data) {\r\n      return;\r\n    }\r\n    // shared tooltip mode\r\n    if (pos.panelRelY) {\r\n      return;\r\n    }\r\n\r\n    const { xBucketIndex, yBucketIndex } = this.getBucketIndexes(pos, data);\r\n\r\n    if (!data.buckets[xBucketIndex]) {\r\n      this.destroy();\r\n      return;\r\n    }\r\n\r\n    if (!this.tooltip) {\r\n      this.add();\r\n    }\r\n\r\n    let boundBottom, boundTop, valuesNumber;\r\n    const xData = data.buckets[xBucketIndex];\r\n    // Search in special 'zero' bucket also\r\n    const yData: any = _.find(xData.buckets, (bucket, bucketIndex) => {\r\n      return bucket.bounds.bottom === yBucketIndex || bucketIndex === yBucketIndex.toString();\r\n    });\r\n\r\n    const tooltipTimeFormat = 'YYYY-MM-DD HH:mm:ss';\r\n    const time = this.dashboard.formatDate(xData.x, tooltipTimeFormat);\r\n\r\n    // Decimals override. Code from panel/graph/graph.ts\r\n    let countValueFormatter, bucketBoundFormatter;\r\n    if (_.isNumber(this.panel.tooltipDecimals)) {\r\n      countValueFormatter = this.countValueFormatter(this.panel.tooltipDecimals, null);\r\n      bucketBoundFormatter = this.panelCtrl.tickValueFormatter(this.panelCtrl.decimals, null);\r\n    } else {\r\n      // auto decimals\r\n      // legend and tooltip gets one more decimal precision\r\n      // than graph legend ticks\r\n      const decimals = (this.panelCtrl.decimals || -1) + 1;\r\n      countValueFormatter = this.countValueFormatter(decimals, this.panelCtrl.scaledDecimals + 2);\r\n      bucketBoundFormatter = this.panelCtrl.tickValueFormatter(decimals, this.panelCtrl.scaledDecimals + 2);\r\n    }\r\n\r\n    let tooltipHtml = `<div class=\"graph-tooltip-time\">${time}</div>\r\n      <div class=\"heatmap-histogram\"></div>`;\r\n\r\n    if (yData) {\r\n      if (yData.bounds) {\r\n        if (data.tsBuckets) {\r\n          // Use Y-axis labels\r\n          const tickFormatter = (valIndex: string | number) => {\r\n            return data.tsBucketsFormatted ? data.tsBucketsFormatted[valIndex] : data.tsBuckets[valIndex];\r\n          };\r\n\r\n          boundBottom = tickFormatter(yBucketIndex);\r\n          if (this.panel.yBucketBound !== 'middle') {\r\n            boundTop = yBucketIndex < data.tsBuckets.length - 1 ? tickFormatter(yBucketIndex + 1) : '';\r\n          }\r\n        } else {\r\n          // Display 0 if bucket is a special 'zero' bucket\r\n          const bottom = yData.y ? yData.bounds.bottom : 0;\r\n          boundBottom = bucketBoundFormatter(bottom);\r\n          boundTop = bucketBoundFormatter(yData.bounds.top);\r\n        }\r\n        valuesNumber = countValueFormatter(yData.count);\r\n        const boundStr = boundTop && boundBottom ? `${boundBottom} - ${boundTop}` : boundBottom || boundTop;\r\n        tooltipHtml += `<div>\r\n          bucket: <b>${boundStr}</b> <br>\r\n          count: <b>${valuesNumber}</b> <br>\r\n        </div>`;\r\n      } else {\r\n        // currently no bounds for pre bucketed data\r\n        tooltipHtml += `<div>count: <b>${yData.count}</b><br></div>`;\r\n      }\r\n    } else {\r\n      if (!this.panel.tooltip.showHistogram) {\r\n        this.destroy();\r\n        return;\r\n      }\r\n      boundBottom = yBucketIndex;\r\n      boundTop = '';\r\n      valuesNumber = 0;\r\n    }\r\n\r\n    this.tooltip.html(tooltipHtml);\r\n\r\n    if (this.panel.tooltip.showHistogram) {\r\n      this.addHistogram(xData);\r\n    }\r\n\r\n    this.move(pos);\r\n  }\r\n\r\n  getBucketIndexes(pos: { panelRelY?: any; x?: any; y?: any }, data: any) {\r\n    const xBucketIndex = this.getXBucketIndex(pos.x, data);\r\n    const yBucketIndex = this.getYBucketIndex(pos.y, data);\r\n    return { xBucketIndex, yBucketIndex };\r\n  }\r\n\r\n  getXBucketIndex(x: number, data: { buckets: any; xBucketSize: number }) {\r\n    // First try to find X bucket by checking x pos is in the\r\n    // [bucket.x, bucket.x + xBucketSize] interval\r\n    const xBucket: any = _.find(data.buckets, bucket => {\r\n      return x > bucket.x && x - bucket.x <= data.xBucketSize;\r\n    });\r\n    return xBucket ? xBucket.x : getValueBucketBound(x, data.xBucketSize, 1);\r\n  }\r\n\r\n  getYBucketIndex(y: number, data: { tsBuckets: any; yBucketSize: number }) {\r\n    if (data.tsBuckets) {\r\n      return Math.floor(y);\r\n    }\r\n    const yBucketIndex = getValueBucketBound(y, data.yBucketSize, this.panel.yAxis.logBase);\r\n    return yBucketIndex;\r\n  }\r\n\r\n  getSharedTooltipPos(pos: { pageX: any; x: any; pageY: any; panelRelY: number }) {\r\n    // get pageX from position on x axis and pageY from relative position in original panel\r\n    pos.pageX = this.heatmapPanel.offset().left + this.scope.xScale(pos.x);\r\n    pos.pageY = this.heatmapPanel.offset().top + this.scope.chartHeight * pos.panelRelY;\r\n    return pos;\r\n  }\r\n\r\n  addHistogram(data: { x: string | number }) {\r\n    const xBucket = this.scope.ctrl.data.buckets[data.x];\r\n    const yBucketSize = this.scope.ctrl.data.yBucketSize;\r\n    let min: number, max: number, ticks: number;\r\n    if (this.scope.ctrl.data.tsBuckets) {\r\n      min = 0;\r\n      max = this.scope.ctrl.data.tsBuckets.length - 1;\r\n      ticks = this.scope.ctrl.data.tsBuckets.length;\r\n    } else {\r\n      min = this.scope.ctrl.data.yAxis.min;\r\n      max = this.scope.ctrl.data.yAxis.max;\r\n      ticks = this.scope.ctrl.data.yAxis.ticks;\r\n    }\r\n    let histogramData = _.map(xBucket.buckets, bucket => {\r\n      const count = bucket.count !== undefined ? bucket.count : bucket.values.length;\r\n      return [bucket.bounds.bottom, count];\r\n    });\r\n    histogramData = _.filter(histogramData, d => {\r\n      return d[0] >= min && d[0] <= max;\r\n    });\r\n\r\n    const scale = this.scope.yScale.copy();\r\n    const histXScale = scale.domain([min, max]).range([0, HISTOGRAM_WIDTH]);\r\n\r\n    let barWidth: number;\r\n    if (this.panel.yAxis.logBase === 1) {\r\n      barWidth = Math.floor((HISTOGRAM_WIDTH / (max - min)) * yBucketSize * 0.9);\r\n    } else {\r\n      const barNumberFactor = yBucketSize ? yBucketSize : 1;\r\n      barWidth = Math.floor((HISTOGRAM_WIDTH / ticks / barNumberFactor) * 0.9);\r\n    }\r\n    barWidth = Math.max(barWidth, 1);\r\n\r\n    // Normalize histogram Y axis\r\n    const histogramDomain = _.reduce(\r\n      _.map(histogramData, d => d[1]),\r\n      (sum, val) => sum + val,\r\n      0\r\n    );\r\n    const histYScale = d3\r\n      .scaleLinear()\r\n      .domain([0, histogramDomain])\r\n      .range([0, HISTOGRAM_HEIGHT]);\r\n\r\n    const histogram = this.tooltip\r\n      .select('.heatmap-histogram')\r\n      .append('svg')\r\n      .attr('width', HISTOGRAM_WIDTH)\r\n      .attr('height', HISTOGRAM_HEIGHT);\r\n\r\n    histogram\r\n      .selectAll('.bar')\r\n      .data(histogramData)\r\n      .enter()\r\n      .append('rect')\r\n      .attr('x', (d: any[]) => {\r\n        return histXScale(d[0]);\r\n      })\r\n      .attr('width', barWidth)\r\n      .attr('y', (d: any[]) => {\r\n        return HISTOGRAM_HEIGHT - histYScale(d[1]);\r\n      })\r\n      .attr('height', (d: any[]) => {\r\n        return histYScale(d[1]);\r\n      });\r\n  }\r\n\r\n  move(pos: { panelRelY?: any; pageX?: any; pageY?: any }) {\r\n    if (!this.tooltip) {\r\n      return;\r\n    }\r\n\r\n    const elem = $(this.tooltip.node())[0];\r\n    const tooltipWidth = elem.clientWidth;\r\n    const tooltipHeight = elem.clientHeight;\r\n\r\n    let left = pos.pageX + TOOLTIP_PADDING_X;\r\n    let top = pos.pageY + TOOLTIP_PADDING_Y;\r\n\r\n    if (pos.pageX + tooltipWidth + 40 > window.innerWidth) {\r\n      left = pos.pageX - tooltipWidth - TOOLTIP_PADDING_X;\r\n    }\r\n\r\n    if (pos.pageY - window.pageYOffset + tooltipHeight + 20 > window.innerHeight) {\r\n      top = pos.pageY - tooltipHeight - TOOLTIP_PADDING_Y;\r\n    }\r\n\r\n    return this.tooltip.style('left', left + 'px').style('top', top + 'px');\r\n  }\r\n\r\n  countValueFormatter(decimals: number, scaledDecimals: any = null) {\r\n    const fmt = getValueFormat('short');\r\n    return (value: number) => {\r\n      return formattedValueToString(fmt(value, decimals, scaledDecimals));\r\n    };\r\n  }\r\n}\r\n","import './color_legend';\nimport { HeatmapCtrl } from './heatmap_ctrl';\n\nexport { HeatmapCtrl as PanelCtrl };\n","import _ from 'lodash';\r\nimport $ from 'jquery';\r\nimport * as d3 from 'd3';\r\nimport { appEvents, contextSrv } from 'app/core/core';\r\nimport * as ticksUtils from 'app/core/utils/ticks';\r\nimport { HeatmapTooltip } from './heatmap_tooltip';\r\nimport { mergeZeroBuckets } from './heatmap_data_converter';\r\nimport { getColorScale, getOpacityScale } from './color_scale';\r\nimport {\r\n  toUtc,\r\n  PanelEvents,\r\n  GrafanaThemeType,\r\n  getColorFromHexRgbOrName,\r\n  getValueFormat,\r\n  formattedValueToString,\r\n} from '@grafana/data';\r\nimport { CoreEvents } from 'app/types';\r\n\r\nconst MIN_CARD_SIZE = 1,\r\n  CARD_PADDING = 1,\r\n  CARD_ROUND = 0,\r\n  DATA_RANGE_WIDING_FACTOR = 1.2,\r\n  DEFAULT_X_TICK_SIZE_PX = 100,\r\n  DEFAULT_Y_TICK_SIZE_PX = 50,\r\n  X_AXIS_TICK_PADDING = 10,\r\n  Y_AXIS_TICK_PADDING = 5,\r\n  MIN_SELECTION_WIDTH = 2;\r\n\r\nexport default function rendering(scope: any, elem: any, attrs: any, ctrl: any) {\r\n  return new HeatmapRenderer(scope, elem, attrs, ctrl);\r\n}\r\nexport class HeatmapRenderer {\r\n  width: number;\r\n  height: number;\r\n  yScale: any;\r\n  xScale: any;\r\n  chartWidth: number;\r\n  chartHeight: number;\r\n  chartTop: number;\r\n  chartBottom: number;\r\n  yAxisWidth: number;\r\n  xAxisHeight: number;\r\n  cardPadding: number;\r\n  cardRound: number;\r\n  cardWidth: number;\r\n  cardHeight: number;\r\n  colorScale: any;\r\n  opacityScale: any;\r\n  mouseUpHandler: any;\r\n  data: any;\r\n  panel: any;\r\n  $heatmap: any;\r\n  tooltip: HeatmapTooltip;\r\n  heatmap: any;\r\n  timeRange: any;\r\n\r\n  selection: any;\r\n  padding: any;\r\n  margin: any;\r\n  dataRangeWidingFactor: number;\r\n  constructor(private scope: any, private elem: any, attrs: any, private ctrl: any) {\r\n    // $heatmap is JQuery object, but heatmap is D3\r\n    this.$heatmap = this.elem.find('.heatmap-panel');\r\n    this.tooltip = new HeatmapTooltip(this.$heatmap, this.scope);\r\n\r\n    this.selection = {\r\n      active: false,\r\n      x1: -1,\r\n      x2: -1,\r\n    };\r\n\r\n    this.padding = { left: 0, right: 0, top: 0, bottom: 0 };\r\n    this.margin = { left: 25, right: 15, top: 10, bottom: 20 };\r\n    this.dataRangeWidingFactor = DATA_RANGE_WIDING_FACTOR;\r\n\r\n    this.ctrl.events.on(PanelEvents.render, this.onRender.bind(this));\r\n\r\n    this.ctrl.tickValueFormatter = this.tickValueFormatter.bind(this);\r\n\r\n    /////////////////////////////\r\n    // Selection and crosshair //\r\n    /////////////////////////////\r\n\r\n    // Shared crosshair and tooltip\r\n    appEvents.on(CoreEvents.graphHover, this.onGraphHover.bind(this), this.scope);\r\n\r\n    appEvents.on(CoreEvents.graphHoverClear, this.onGraphHoverClear.bind(this), this.scope);\r\n\r\n    // Register selection listeners\r\n    this.$heatmap.on('mousedown', this.onMouseDown.bind(this));\r\n    this.$heatmap.on('mousemove', this.onMouseMove.bind(this));\r\n    this.$heatmap.on('mouseleave', this.onMouseLeave.bind(this));\r\n  }\r\n\r\n  onGraphHoverClear() {\r\n    this.clearCrosshair();\r\n  }\r\n\r\n  onGraphHover(event: { pos: any }) {\r\n    this.drawSharedCrosshair(event.pos);\r\n  }\r\n\r\n  onRender() {\r\n    this.render();\r\n    this.ctrl.renderingCompleted();\r\n  }\r\n\r\n  setElementHeight() {\r\n    try {\r\n      let height = this.ctrl.height || this.panel.height || this.ctrl.row.height;\r\n      if (_.isString(height)) {\r\n        height = parseInt(height.replace('px', ''), 10);\r\n      }\r\n\r\n      height -= this.panel.legend.show ? 28 : 11; // bottom padding and space for legend\r\n\r\n      this.$heatmap.css('height', height + 'px');\r\n\r\n      return true;\r\n    } catch (e) {\r\n      // IE throws errors sometimes\r\n      return false;\r\n    }\r\n  }\r\n\r\n  getYAxisWidth(elem: any) {\r\n    const axisText = elem.selectAll('.axis-y text').nodes();\r\n    const maxTextWidth = _.max(\r\n      _.map(axisText, text => {\r\n        // Use SVG getBBox method\r\n        return text.getBBox().width;\r\n      })\r\n    );\r\n\r\n    return maxTextWidth;\r\n  }\r\n\r\n  getXAxisHeight(elem: any) {\r\n    const axisLine = elem.select('.axis-x line');\r\n    if (!axisLine.empty()) {\r\n      const axisLinePosition = parseFloat(elem.select('.axis-x line').attr('y2'));\r\n      const canvasWidth = parseFloat(elem.attr('height'));\r\n      return canvasWidth - axisLinePosition;\r\n    } else {\r\n      // Default height\r\n      return 30;\r\n    }\r\n  }\r\n\r\n  addXAxis() {\r\n    this.scope.xScale = this.xScale = d3\r\n      .scaleTime()\r\n      .domain([this.timeRange.from, this.timeRange.to])\r\n      .range([0, this.chartWidth]);\r\n\r\n    const ticks = this.chartWidth / DEFAULT_X_TICK_SIZE_PX;\r\n    const grafanaTimeFormatter = ticksUtils.grafanaTimeFormat(ticks, this.timeRange.from, this.timeRange.to);\r\n    let timeFormat;\r\n    const dashboardTimeZone = this.ctrl.dashboard.getTimezone();\r\n    if (dashboardTimeZone === 'utc') {\r\n      timeFormat = d3.utcFormat(grafanaTimeFormatter);\r\n    } else {\r\n      timeFormat = d3.timeFormat(grafanaTimeFormatter);\r\n    }\r\n\r\n    const xAxis = d3\r\n      .axisBottom(this.xScale)\r\n      .ticks(ticks)\r\n      .tickFormat(timeFormat)\r\n      .tickPadding(X_AXIS_TICK_PADDING)\r\n      .tickSize(this.chartHeight);\r\n\r\n    const posY = this.margin.top;\r\n    const posX = this.yAxisWidth;\r\n    this.heatmap\r\n      .append('g')\r\n      .attr('class', 'axis axis-x')\r\n      .attr('transform', 'translate(' + posX + ',' + posY + ')')\r\n      .call(xAxis);\r\n\r\n    // Remove horizontal line in the top of axis labels (called domain in d3)\r\n    this.heatmap\r\n      .select('.axis-x')\r\n      .select('.domain')\r\n      .remove();\r\n  }\r\n\r\n  addYAxis() {\r\n    let ticks = Math.ceil(this.chartHeight / DEFAULT_Y_TICK_SIZE_PX);\r\n    let tickInterval = ticksUtils.tickStep(this.data.heatmapStats.min, this.data.heatmapStats.max, ticks);\r\n    let { yMin, yMax } = this.wideYAxisRange(this.data.heatmapStats.min, this.data.heatmapStats.max, tickInterval);\r\n\r\n    // Rewrite min and max if it have been set explicitly\r\n    yMin = this.panel.yAxis.min !== null ? this.panel.yAxis.min : yMin;\r\n    yMax = this.panel.yAxis.max !== null ? this.panel.yAxis.max : yMax;\r\n\r\n    // Adjust ticks after Y range widening\r\n    tickInterval = ticksUtils.tickStep(yMin, yMax, ticks);\r\n    ticks = Math.ceil((yMax - yMin) / tickInterval);\r\n\r\n    const decimalsAuto = ticksUtils.getPrecision(tickInterval);\r\n    let decimals = this.panel.yAxis.decimals === null ? decimalsAuto : this.panel.yAxis.decimals;\r\n    // Calculate scaledDecimals for log scales using tick size (as in jquery.flot.js)\r\n    const flotTickSize = ticksUtils.getFlotTickSize(yMin, yMax, ticks, decimalsAuto);\r\n    const scaledDecimals = ticksUtils.getScaledDecimals(decimals, flotTickSize);\r\n    this.ctrl.decimals = decimals;\r\n    this.ctrl.scaledDecimals = scaledDecimals;\r\n\r\n    // Set default Y min and max if no data\r\n    if (_.isEmpty(this.data.buckets)) {\r\n      yMax = 1;\r\n      yMin = -1;\r\n      ticks = 3;\r\n      decimals = 1;\r\n    }\r\n\r\n    this.data.yAxis = {\r\n      min: yMin,\r\n      max: yMax,\r\n      ticks: ticks,\r\n    };\r\n\r\n    this.scope.yScale = this.yScale = d3\r\n      .scaleLinear()\r\n      .domain([yMin, yMax])\r\n      .range([this.chartHeight, 0]);\r\n\r\n    const yAxis = d3\r\n      .axisLeft(this.yScale)\r\n      .ticks(ticks)\r\n      .tickFormat(this.tickValueFormatter(decimals, scaledDecimals))\r\n      .tickSizeInner(0 - this.width)\r\n      .tickSizeOuter(0)\r\n      .tickPadding(Y_AXIS_TICK_PADDING);\r\n\r\n    this.heatmap\r\n      .append('g')\r\n      .attr('class', 'axis axis-y')\r\n      .call(yAxis);\r\n\r\n    // Calculate Y axis width first, then move axis into visible area\r\n    const posY = this.margin.top;\r\n    const posX = this.getYAxisWidth(this.heatmap) + Y_AXIS_TICK_PADDING;\r\n    this.heatmap.select('.axis-y').attr('transform', 'translate(' + posX + ',' + posY + ')');\r\n\r\n    // Remove vertical line in the right of axis labels (called domain in d3)\r\n    this.heatmap\r\n      .select('.axis-y')\r\n      .select('.domain')\r\n      .remove();\r\n  }\r\n\r\n  // Wide Y values range and anjust to bucket size\r\n  wideYAxisRange(min: number, max: number, tickInterval: number) {\r\n    const yWiding = (max * (this.dataRangeWidingFactor - 1) - min * (this.dataRangeWidingFactor - 1)) / 2;\r\n    let yMin, yMax;\r\n\r\n    if (tickInterval === 0) {\r\n      yMax = max * this.dataRangeWidingFactor;\r\n      yMin = min - min * (this.dataRangeWidingFactor - 1);\r\n    } else {\r\n      yMax = Math.ceil((max + yWiding) / tickInterval) * tickInterval;\r\n      yMin = Math.floor((min - yWiding) / tickInterval) * tickInterval;\r\n    }\r\n\r\n    // Don't wide axis below 0 if all values are positive\r\n    if (min >= 0 && yMin < 0) {\r\n      yMin = 0;\r\n    }\r\n\r\n    return { yMin, yMax };\r\n  }\r\n\r\n  addLogYAxis() {\r\n    const logBase = this.panel.yAxis.logBase;\r\n    let { yMin, yMax } = this.adjustLogRange(this.data.heatmapStats.minLog, this.data.heatmapStats.max, logBase);\r\n\r\n    yMin =\r\n      this.panel.yAxis.min && this.panel.yAxis.min !== '0' ? this.adjustLogMin(this.panel.yAxis.min, logBase) : yMin;\r\n    yMax = this.panel.yAxis.max !== null ? this.adjustLogMax(this.panel.yAxis.max, logBase) : yMax;\r\n\r\n    // Set default Y min and max if no data\r\n    if (_.isEmpty(this.data.buckets)) {\r\n      yMax = Math.pow(logBase, 2);\r\n      yMin = 1;\r\n    }\r\n\r\n    this.scope.yScale = this.yScale = d3\r\n      .scaleLog()\r\n      .base(this.panel.yAxis.logBase)\r\n      .domain([yMin, yMax])\r\n      .range([this.chartHeight, 0]);\r\n\r\n    const domain = this.yScale.domain();\r\n    const tickValues = this.logScaleTickValues(domain, logBase);\r\n\r\n    const decimalsAuto = ticksUtils.getPrecision(yMin);\r\n    const decimals = this.panel.yAxis.decimals || decimalsAuto;\r\n\r\n    // Calculate scaledDecimals for log scales using tick size (as in jquery.flot.js)\r\n    const flotTickSize = ticksUtils.getFlotTickSize(yMin, yMax, tickValues.length, decimalsAuto);\r\n    const scaledDecimals = ticksUtils.getScaledDecimals(decimals, flotTickSize);\r\n    this.ctrl.decimals = decimals;\r\n    this.ctrl.scaledDecimals = scaledDecimals;\r\n\r\n    this.data.yAxis = {\r\n      min: yMin,\r\n      max: yMax,\r\n      ticks: tickValues.length,\r\n    };\r\n\r\n    const yAxis = d3\r\n      .axisLeft(this.yScale)\r\n      .tickValues(tickValues)\r\n      .tickFormat(this.tickValueFormatter(decimals, scaledDecimals))\r\n      .tickSizeInner(0 - this.width)\r\n      .tickSizeOuter(0)\r\n      .tickPadding(Y_AXIS_TICK_PADDING);\r\n\r\n    this.heatmap\r\n      .append('g')\r\n      .attr('class', 'axis axis-y')\r\n      .call(yAxis);\r\n\r\n    // Calculate Y axis width first, then move axis into visible area\r\n    const posY = this.margin.top;\r\n    const posX = this.getYAxisWidth(this.heatmap) + Y_AXIS_TICK_PADDING;\r\n    this.heatmap.select('.axis-y').attr('transform', 'translate(' + posX + ',' + posY + ')');\r\n\r\n    // Set first tick as pseudo 0\r\n    if (yMin < 1) {\r\n      this.heatmap\r\n        .select('.axis-y')\r\n        .select('.tick text')\r\n        .text('0');\r\n    }\r\n\r\n    // Remove vertical line in the right of axis labels (called domain in d3)\r\n    this.heatmap\r\n      .select('.axis-y')\r\n      .select('.domain')\r\n      .remove();\r\n  }\r\n\r\n  addYAxisFromBuckets() {\r\n    const tsBuckets = this.data.tsBuckets;\r\n\r\n    this.scope.yScale = this.yScale = d3\r\n      .scaleLinear()\r\n      .domain([0, tsBuckets.length - 1])\r\n      .range([this.chartHeight, 0]);\r\n\r\n    const tickValues = _.map(tsBuckets, (b, i) => i);\r\n    const decimalsAuto = _.max(_.map(tsBuckets, ticksUtils.getStringPrecision));\r\n    const decimals = this.panel.yAxis.decimals === null ? decimalsAuto : this.panel.yAxis.decimals;\r\n    this.ctrl.decimals = decimals;\r\n\r\n    const tickValueFormatter = this.tickValueFormatter.bind(this);\r\n    function tickFormatter(valIndex: string) {\r\n      let valueFormatted = tsBuckets[valIndex];\r\n      if (!_.isNaN(_.toNumber(valueFormatted)) && valueFormatted !== '') {\r\n        // Try to format numeric tick labels\r\n        valueFormatted = tickValueFormatter(decimals)(_.toNumber(valueFormatted));\r\n      }\r\n      return valueFormatted;\r\n    }\r\n\r\n    const tsBucketsFormatted = _.map(tsBuckets, (v, i) => tickFormatter(i));\r\n    this.data.tsBucketsFormatted = tsBucketsFormatted;\r\n\r\n    const yAxis = d3\r\n      .axisLeft(this.yScale)\r\n      .tickValues(tickValues)\r\n      .tickFormat(tickFormatter)\r\n      .tickSizeInner(0 - this.width)\r\n      .tickSizeOuter(0)\r\n      .tickPadding(Y_AXIS_TICK_PADDING);\r\n\r\n    this.heatmap\r\n      .append('g')\r\n      .attr('class', 'axis axis-y')\r\n      .call(yAxis);\r\n\r\n    // Calculate Y axis width first, then move axis into visible area\r\n    const posY = this.margin.top;\r\n    const posX = this.getYAxisWidth(this.heatmap) + Y_AXIS_TICK_PADDING;\r\n    this.heatmap.select('.axis-y').attr('transform', 'translate(' + posX + ',' + posY + ')');\r\n\r\n    if (this.panel.yBucketBound === 'middle' && tickValues && tickValues.length) {\r\n      // Shift Y axis labels to the middle of bucket\r\n      const tickShift = 0 - this.chartHeight / (tickValues.length - 1) / 2;\r\n      this.heatmap.selectAll('.axis-y text').attr('transform', 'translate(' + 0 + ',' + tickShift + ')');\r\n    }\r\n\r\n    // Remove vertical line in the right of axis labels (called domain in d3)\r\n    this.heatmap\r\n      .select('.axis-y')\r\n      .select('.domain')\r\n      .remove();\r\n  }\r\n\r\n  // Adjust data range to log base\r\n  adjustLogRange(min: number, max: number, logBase: number) {\r\n    let yMin = this.data.heatmapStats.minLog;\r\n    if (this.data.heatmapStats.minLog > 1 || !this.data.heatmapStats.minLog) {\r\n      yMin = 1;\r\n    } else {\r\n      yMin = this.adjustLogMin(this.data.heatmapStats.minLog, logBase);\r\n    }\r\n\r\n    // Adjust max Y value to log base\r\n    const yMax = this.adjustLogMax(this.data.heatmapStats.max, logBase);\r\n\r\n    return { yMin, yMax };\r\n  }\r\n\r\n  adjustLogMax(max: number, base: number) {\r\n    return Math.pow(base, Math.ceil(ticksUtils.logp(max, base)));\r\n  }\r\n\r\n  adjustLogMin(min: number, base: number) {\r\n    return Math.pow(base, Math.floor(ticksUtils.logp(min, base)));\r\n  }\r\n\r\n  logScaleTickValues(domain: any[], base: number) {\r\n    const domainMin = domain[0];\r\n    const domainMax = domain[1];\r\n    const tickValues = [];\r\n\r\n    if (domainMin < 1) {\r\n      const underOneTicks = Math.floor(ticksUtils.logp(domainMin, base));\r\n      for (let i = underOneTicks; i < 0; i++) {\r\n        const tickValue = Math.pow(base, i);\r\n        tickValues.push(tickValue);\r\n      }\r\n    }\r\n\r\n    const ticks = Math.ceil(ticksUtils.logp(domainMax, base));\r\n    for (let i = 0; i <= ticks; i++) {\r\n      const tickValue = Math.pow(base, i);\r\n      tickValues.push(tickValue);\r\n    }\r\n\r\n    return tickValues;\r\n  }\r\n\r\n  tickValueFormatter(decimals: number, scaledDecimals: any = null) {\r\n    const format = this.panel.yAxis.format;\r\n    return (value: any) => {\r\n      try {\r\n        if (format !== 'none') {\r\n          const v = getValueFormat(format)(value, decimals, scaledDecimals);\r\n          return formattedValueToString(v);\r\n        }\r\n      } catch (err) {\r\n        console.error(err.message || err);\r\n      }\r\n      return value;\r\n    };\r\n  }\r\n\r\n  fixYAxisTickSize() {\r\n    this.heatmap\r\n      .select('.axis-y')\r\n      .selectAll('.tick line')\r\n      .attr('x2', this.chartWidth);\r\n  }\r\n\r\n  addAxes() {\r\n    this.chartHeight = this.height - this.margin.top - this.margin.bottom;\r\n    this.chartTop = this.margin.top;\r\n    this.chartBottom = this.chartTop + this.chartHeight;\r\n    if (this.panel.dataFormat === 'tsbuckets') {\r\n      this.addYAxisFromBuckets();\r\n    } else {\r\n      if (this.panel.yAxis.logBase === 1) {\r\n        this.addYAxis();\r\n      } else {\r\n        this.addLogYAxis();\r\n      }\r\n    }\r\n\r\n    this.yAxisWidth = this.getYAxisWidth(this.heatmap) + Y_AXIS_TICK_PADDING;\r\n    this.chartWidth = this.width - this.yAxisWidth - this.margin.right;\r\n    this.fixYAxisTickSize();\r\n\r\n    this.addXAxis();\r\n    this.xAxisHeight = this.getXAxisHeight(this.heatmap);\r\n\r\n    if (!this.panel.yAxis.show) {\r\n      this.heatmap\r\n        .select('.axis-y')\r\n        .selectAll('line')\r\n        .style('opacity', 0);\r\n    }\r\n\r\n    if (!this.panel.xAxis.show) {\r\n      this.heatmap\r\n        .select('.axis-x')\r\n        .selectAll('line')\r\n        .style('opacity', 0);\r\n    }\r\n  }\r\n\r\n  addHeatmapCanvas() {\r\n    const heatmapElem = this.$heatmap[0];\r\n\r\n    this.width = Math.floor(this.$heatmap.width()) - this.padding.right;\r\n    this.height = Math.floor(this.$heatmap.height()) - this.padding.bottom;\r\n\r\n    this.cardPadding = this.panel.cards.cardPadding !== null ? this.panel.cards.cardPadding : CARD_PADDING;\r\n    this.cardRound = this.panel.cards.cardRound !== null ? this.panel.cards.cardRound : CARD_ROUND;\r\n\r\n    if (this.heatmap) {\r\n      this.heatmap.remove();\r\n    }\r\n\r\n    this.heatmap = d3\r\n      .select(heatmapElem)\r\n      .append('svg')\r\n      .attr('width', this.width)\r\n      .attr('height', this.height);\r\n  }\r\n\r\n  addHeatmap() {\r\n    this.addHeatmapCanvas();\r\n    this.addAxes();\r\n\r\n    if (this.panel.yAxis.logBase !== 1 && this.panel.dataFormat !== 'tsbuckets') {\r\n      const logBase = this.panel.yAxis.logBase;\r\n      const domain = this.yScale.domain();\r\n      const tickValues = this.logScaleTickValues(domain, logBase);\r\n      this.data.buckets = mergeZeroBuckets(this.data.buckets, _.min(tickValues)!);\r\n    }\r\n\r\n    const cardsData = this.data.cards;\r\n    const cardStats = this.data.cardStats;\r\n    const maxValueAuto = cardStats.max;\r\n    const minValueAuto = Math.min(cardStats.min, 0);\r\n    const maxValue = _.isNil(this.panel.color.max) ? maxValueAuto : this.panel.color.max;\r\n    const minValue = _.isNil(this.panel.color.min) ? minValueAuto : this.panel.color.min;\r\n    const colorScheme: any = _.find(this.ctrl.colorSchemes, {\r\n      value: this.panel.color.colorScheme,\r\n    });\r\n    this.colorScale = getColorScale(colorScheme, contextSrv.user.lightTheme, maxValue, minValue);\r\n    this.opacityScale = getOpacityScale(this.panel.color, maxValue, minValue);\r\n    this.setCardSize();\r\n\r\n    let cards = this.heatmap.selectAll('.heatmap-card').data(cardsData);\r\n    cards.append('title');\r\n    cards = cards\r\n      .enter()\r\n      .append('rect')\r\n      .attr('x', this.getCardX.bind(this))\r\n      .attr('width', this.getCardWidth.bind(this))\r\n      .attr('y', this.getCardY.bind(this))\r\n      .attr('height', this.getCardHeight.bind(this))\r\n      .attr('rx', this.cardRound)\r\n      .attr('ry', this.cardRound)\r\n      .attr('class', 'bordered heatmap-card')\r\n      .style('fill', this.getCardColor.bind(this))\r\n      .style('stroke', this.getCardColor.bind(this))\r\n      .style('stroke-width', 0)\r\n      .style('opacity', this.getCardOpacity.bind(this));\r\n\r\n    const $cards = this.$heatmap.find('.heatmap-card');\r\n    $cards\r\n      .on('mouseenter', (event: any) => {\r\n        this.tooltip.mouseOverBucket = true;\r\n        this.highlightCard(event);\r\n      })\r\n      .on('mouseleave', (event: any) => {\r\n        this.tooltip.mouseOverBucket = false;\r\n        this.resetCardHighLight(event);\r\n      });\r\n  }\r\n\r\n  highlightCard(event: any) {\r\n    const color = d3.select(event.target).style('fill');\r\n    const highlightColor = d3.color(color).darker(2);\r\n    const strokeColor = d3.color(color).brighter(4);\r\n    const currentCard = d3.select(event.target);\r\n    this.tooltip.originalFillColor = color;\r\n    currentCard\r\n      .style('fill', highlightColor.toString())\r\n      .style('stroke', strokeColor.toString())\r\n      .style('stroke-width', 1);\r\n  }\r\n\r\n  resetCardHighLight(event: any) {\r\n    d3.select(event.target)\r\n      .style('fill', this.tooltip.originalFillColor)\r\n      .style('stroke', this.tooltip.originalFillColor)\r\n      .style('stroke-width', 0);\r\n  }\r\n\r\n  setCardSize() {\r\n    const xGridSize = Math.floor(this.xScale(this.data.xBucketSize) - this.xScale(0));\r\n    let yGridSize = Math.floor(this.yScale(this.yScale.invert(0) - this.data.yBucketSize));\r\n\r\n    if (this.panel.yAxis.logBase !== 1) {\r\n      const base = this.panel.yAxis.logBase;\r\n      const splitFactor = this.data.yBucketSize || 1;\r\n      yGridSize = Math.floor((this.yScale(1) - this.yScale(base)) / splitFactor);\r\n    }\r\n\r\n    const cardWidth = xGridSize - this.cardPadding * 2;\r\n    this.cardWidth = Math.max(cardWidth, MIN_CARD_SIZE);\r\n    this.cardHeight = yGridSize ? yGridSize - this.cardPadding * 2 : 0;\r\n  }\r\n\r\n  getCardX(d: { x: any }) {\r\n    let x;\r\n    if (this.xScale(d.x) < 0) {\r\n      // Cut card left to prevent overlay\r\n      x = this.yAxisWidth + this.cardPadding;\r\n    } else {\r\n      x = this.xScale(d.x) + this.yAxisWidth + this.cardPadding;\r\n    }\r\n\r\n    return x;\r\n  }\r\n\r\n  getCardWidth(d: { x: any }) {\r\n    let w = this.cardWidth;\r\n    if (this.xScale(d.x) < 0) {\r\n      // Cut card left to prevent overlay\r\n      w = this.xScale(d.x) + this.cardWidth;\r\n    } else if (this.xScale(d.x) + this.cardWidth > this.chartWidth) {\r\n      // Cut card right to prevent overlay\r\n      w = this.chartWidth - this.xScale(d.x) - this.cardPadding;\r\n    }\r\n\r\n    // Card width should be MIN_CARD_SIZE at least, but cut cards shouldn't be displayed\r\n    w = w > 0 ? Math.max(w, MIN_CARD_SIZE) : 0;\r\n    return w;\r\n  }\r\n\r\n  getCardY(d: { y: number }) {\r\n    let y = this.yScale(d.y) + this.chartTop - this.cardHeight - this.cardPadding;\r\n    if (this.panel.yAxis.logBase !== 1 && d.y === 0) {\r\n      y = this.chartBottom - this.cardHeight - this.cardPadding;\r\n    } else {\r\n      if (y < this.chartTop) {\r\n        y = this.chartTop;\r\n      }\r\n    }\r\n\r\n    return y;\r\n  }\r\n\r\n  getCardHeight(d: { y: number }) {\r\n    const y = this.yScale(d.y) + this.chartTop - this.cardHeight - this.cardPadding;\r\n    let h = this.cardHeight;\r\n\r\n    if (this.panel.yAxis.logBase !== 1 && d.y === 0) {\r\n      return this.cardHeight;\r\n    }\r\n\r\n    // Cut card height to prevent overlay\r\n    if (y < this.chartTop) {\r\n      h = this.yScale(d.y) - this.cardPadding;\r\n    } else if (this.yScale(d.y) > this.chartBottom) {\r\n      h = this.chartBottom - y;\r\n    } else if (y + this.cardHeight > this.chartBottom) {\r\n      h = this.chartBottom - y;\r\n    }\r\n\r\n    // Height can't be more than chart height\r\n    h = Math.min(h, this.chartHeight);\r\n    // Card height should be MIN_CARD_SIZE at least\r\n    h = Math.max(h, MIN_CARD_SIZE);\r\n\r\n    return h;\r\n  }\r\n\r\n  getCardColor(d: { count: any }) {\r\n    if (this.panel.color.mode === 'opacity') {\r\n      return getColorFromHexRgbOrName(\r\n        this.panel.color.cardColor,\r\n        contextSrv.user.lightTheme ? GrafanaThemeType.Light : GrafanaThemeType.Dark\r\n      );\r\n    } else {\r\n      return this.colorScale(d.count);\r\n    }\r\n  }\r\n\r\n  getCardOpacity(d: { count: any }) {\r\n    if (this.panel.color.mode === 'opacity') {\r\n      return this.opacityScale(d.count);\r\n    } else {\r\n      return 1;\r\n    }\r\n  }\r\n\r\n  getEventOffset(event: any) {\r\n    const elemOffset = this.$heatmap.offset();\r\n    const x = Math.floor(event.clientX - elemOffset.left);\r\n    const y = Math.floor(event.clientY - elemOffset.top);\r\n    return { x, y };\r\n  }\r\n\r\n  onMouseDown(event: any) {\r\n    const offset = this.getEventOffset(event);\r\n    this.selection.active = true;\r\n    this.selection.x1 = offset.x;\r\n\r\n    this.mouseUpHandler = () => {\r\n      this.onMouseUp();\r\n    };\r\n\r\n    $(document).one('mouseup', this.mouseUpHandler.bind(this));\r\n  }\r\n\r\n  onMouseUp() {\r\n    $(document).unbind('mouseup', this.mouseUpHandler.bind(this));\r\n    this.mouseUpHandler = null;\r\n    this.selection.active = false;\r\n\r\n    const selectionRange = Math.abs(this.selection.x2 - this.selection.x1);\r\n    if (this.selection.x2 >= 0 && selectionRange > MIN_SELECTION_WIDTH) {\r\n      const timeFrom = this.xScale.invert(Math.min(this.selection.x1, this.selection.x2) - this.yAxisWidth);\r\n      const timeTo = this.xScale.invert(Math.max(this.selection.x1, this.selection.x2) - this.yAxisWidth);\r\n\r\n      this.ctrl.timeSrv.setTime({\r\n        from: toUtc(timeFrom),\r\n        to: toUtc(timeTo),\r\n      });\r\n    }\r\n\r\n    this.clearSelection();\r\n  }\r\n\r\n  onMouseLeave() {\r\n    appEvents.emit(CoreEvents.graphHoverClear);\r\n    this.clearCrosshair();\r\n  }\r\n\r\n  onMouseMove(event: any) {\r\n    if (!this.heatmap) {\r\n      return;\r\n    }\r\n\r\n    const offset = this.getEventOffset(event);\r\n    if (this.selection.active) {\r\n      // Clear crosshair and tooltip\r\n      this.clearCrosshair();\r\n      this.tooltip.destroy();\r\n\r\n      this.selection.x2 = this.limitSelection(offset.x);\r\n      this.drawSelection(this.selection.x1, this.selection.x2);\r\n    } else {\r\n      const pos = this.getEventPos(event, offset);\r\n      this.drawCrosshair(offset.x);\r\n      this.tooltip.show(pos, this.data);\r\n      this.emitGraphHoverEvent(pos);\r\n    }\r\n  }\r\n\r\n  getEventPos(event: { pageX: any; pageY: any }, offset: { x: any; y: any }) {\r\n    const x = this.xScale.invert(offset.x - this.yAxisWidth).valueOf();\r\n    const y = this.yScale.invert(offset.y - this.chartTop);\r\n    const pos: any = {\r\n      pageX: event.pageX,\r\n      pageY: event.pageY,\r\n      x: x,\r\n      x1: x,\r\n      y: y,\r\n      y1: y,\r\n      panelRelY: null,\r\n      offset,\r\n    };\r\n\r\n    return pos;\r\n  }\r\n\r\n  emitGraphHoverEvent(pos: { panelRelY: number; offset: { y: number } }) {\r\n    // Set minimum offset to prevent showing legend from another panel\r\n    pos.panelRelY = Math.max(pos.offset.y / this.height, 0.001);\r\n    // broadcast to other graph panels that we are hovering\r\n    appEvents.emit(CoreEvents.graphHover, { pos: pos, panel: this.panel });\r\n  }\r\n\r\n  limitSelection(x2: number) {\r\n    x2 = Math.max(x2, this.yAxisWidth);\r\n    x2 = Math.min(x2, this.chartWidth + this.yAxisWidth);\r\n    return x2;\r\n  }\r\n\r\n  drawSelection(posX1: number, posX2: number) {\r\n    if (this.heatmap) {\r\n      this.heatmap.selectAll('.heatmap-selection').remove();\r\n      const selectionX = Math.min(posX1, posX2);\r\n      const selectionWidth = Math.abs(posX1 - posX2);\r\n\r\n      if (selectionWidth > MIN_SELECTION_WIDTH) {\r\n        this.heatmap\r\n          .append('rect')\r\n          .attr('class', 'heatmap-selection')\r\n          .attr('x', selectionX)\r\n          .attr('width', selectionWidth)\r\n          .attr('y', this.chartTop)\r\n          .attr('height', this.chartHeight);\r\n      }\r\n    }\r\n  }\r\n\r\n  clearSelection() {\r\n    this.selection.x1 = -1;\r\n    this.selection.x2 = -1;\r\n\r\n    if (this.heatmap) {\r\n      this.heatmap.selectAll('.heatmap-selection').remove();\r\n    }\r\n  }\r\n\r\n  drawCrosshair(position: number) {\r\n    if (this.heatmap) {\r\n      this.heatmap.selectAll('.heatmap-crosshair').remove();\r\n\r\n      let posX = position;\r\n      posX = Math.max(posX, this.yAxisWidth);\r\n      posX = Math.min(posX, this.chartWidth + this.yAxisWidth);\r\n\r\n      this.heatmap\r\n        .append('g')\r\n        .attr('class', 'heatmap-crosshair')\r\n        .attr('transform', 'translate(' + posX + ',0)')\r\n        .append('line')\r\n        .attr('x1', 1)\r\n        .attr('y1', this.chartTop)\r\n        .attr('x2', 1)\r\n        .attr('y2', this.chartBottom)\r\n        .attr('stroke-width', 1);\r\n    }\r\n  }\r\n\r\n  drawSharedCrosshair(pos: { x: any }) {\r\n    if (this.heatmap && this.ctrl.dashboard.graphTooltip !== 0) {\r\n      const posX = this.xScale(pos.x) + this.yAxisWidth;\r\n      this.drawCrosshair(posX);\r\n    }\r\n  }\r\n\r\n  clearCrosshair() {\r\n    if (this.heatmap) {\r\n      this.heatmap.selectAll('.heatmap-crosshair').remove();\r\n    }\r\n  }\r\n\r\n  render() {\r\n    this.data = this.ctrl.data;\r\n    this.panel = this.ctrl.panel;\r\n    this.timeRange = this.ctrl.range;\r\n\r\n    if (!this.setElementHeight() || !this.data) {\r\n      return;\r\n    }\r\n\r\n    // Draw default axes and return if no data\r\n    if (_.isEmpty(this.data.buckets)) {\r\n      this.addHeatmapCanvas();\r\n      this.addAxes();\r\n      return;\r\n    }\r\n\r\n    this.addHeatmap();\r\n    this.scope.yAxisWidth = this.yAxisWidth;\r\n    this.scope.xAxisHeight = this.xAxisHeight;\r\n    this.scope.chartHeight = this.chartHeight;\r\n    this.scope.chartWidth = this.chartWidth;\r\n    this.scope.chartTop = this.chartTop;\r\n  }\r\n}\r\n","// Libraries\r\nimport React, { PureComponent, FC } from 'react';\r\nimport { css, cx } from 'emotion';\r\n\r\n// Utils & Services\r\nimport { PanelPlugin } from '@grafana/data';\r\nimport { stylesFactory, styleMixins } from '@grafana/ui';\r\nimport config from 'app/core/config';\r\n\r\n// Types\r\nimport { PanelProps } from '@grafana/data';\r\n\r\nexport interface Props extends PanelProps {}\r\n\r\nexport class GrafanaLinksPanel extends PureComponent<Props> {\r\n  render() {\r\n    const styles = getStyles();\r\n\r\n    return (\r\n      <>\r\n        <div className={styles.list}>\r\n          <HomeLink\r\n            title=\"Documentation\"\r\n            icon=\"fa fa-book\"\r\n            url=\"https://grafana.com/docs/grafana/latest?utm_source=grafana_homelinks\"\r\n            target=\"_blank\"\r\n          />\r\n          <HomeLink\r\n            title=\"Getting started\"\r\n            icon=\"fa fa-bolt\"\r\n            url=\"https://grafana.com/docs/grafana/latest/guides/getting_started/?utm_source=grafana_homelinks\"\r\n            target=\"_blank\"\r\n          />\r\n          <HomeLink\r\n            title=\"Community forum\"\r\n            icon=\"fa fa-comments\"\r\n            url=\"https://community.grafana.com?utm_source=grafana_homelinks\"\r\n            target=\"_blank\"\r\n          />\r\n          <HomeLink\r\n            title=\"Report a bug\"\r\n            icon=\"fa fa-bug\"\r\n            url=\"https://github.com/grafana/grafana/issues/new?template=1-bug_report.md\"\r\n            target=\"_blank\"\r\n          />\r\n        </div>\r\n        <VersionFooter />\r\n      </>\r\n    );\r\n  }\r\n}\r\n\r\ninterface HomeLinkProps {\r\n  title: string;\r\n  url: string;\r\n  target?: string;\r\n  icon: string;\r\n}\r\n\r\nexport const HomeLink: FC<HomeLinkProps> = ({ title, url, target, icon }) => {\r\n  const styles = getStyles();\r\n\r\n  return (\r\n    <a className={styles.item} href={url} target={target}>\r\n      <i className={cx(icon, styles.icon)} />\r\n      {title}\r\n    </a>\r\n  );\r\n};\r\n\r\nexport const VersionFooter: FC = () => {\r\n  const styles = getStyles();\r\n  const { version, commit } = config.buildInfo;\r\n\r\n  return (\r\n    <div className={styles.footer}>\r\n      Version {version} ({commit})\r\n    </div>\r\n  );\r\n};\r\n\r\nexport const getStyles = stylesFactory(() => {\r\n  const { theme } = config;\r\n\r\n  return {\r\n    list: css`\r\n      display: flex;\r\n      flex-direction: column;\r\n      padding: ${theme.spacing.md};\r\n    `,\r\n    icon: css`\r\n      padding-right: ${theme.spacing.sm};\r\n    `,\r\n    footer: css`\r\n      ${styleMixins.listItem(theme)}\r\n      position: absolute;\r\n      bottom: 0;\r\n      width: 100%;\r\n      text-align: center;\r\n      padding: ${theme.spacing.sm};\r\n      border-radius: 0;\r\n      box-shadow: none;\r\n      color: ${theme.colors.textWeak};\r\n    `,\r\n    item: css`\r\n      ${styleMixins.listItem(theme)}\r\n      padding: ${theme.spacing.sm};\r\n      display: flex;\r\n      margin-bottom: ${theme.spacing.xs};\r\n      align-items: center;\r\n    `,\r\n  };\r\n});\r\n\r\nexport const plugin = new PanelPlugin(GrafanaLinksPanel).setDefaults({}).setNoPadding();\r\n","import React from 'react';\r\nimport { LogRows, CustomScrollbar } from '@grafana/ui';\r\nimport { LogsDedupStrategy, PanelProps } from '@grafana/data';\r\nimport { Options } from './types';\r\nimport { dataFrameToLogsModel } from 'app/core/logs_model';\r\nimport { sortLogsResult } from 'app/core/utils/explore';\r\n\r\ninterface LogsPanelProps extends PanelProps<Options> {}\r\n\r\nexport const LogsPanel: React.FunctionComponent<LogsPanelProps> = ({\r\n  data,\r\n  timeZone,\r\n  options: { showLabels, showTime, wrapLogMessage, sortOrder },\r\n  width,\r\n}) => {\r\n  if (!data) {\r\n    return (\r\n      <div className=\"panel-empty\">\r\n        <p>No data found in response</p>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  const newResults = data ? dataFrameToLogsModel(data.series, data.request.intervalMs, timeZone) : null;\r\n  const sortedNewResults = sortLogsResult(newResults, sortOrder);\r\n\r\n  return (\r\n    <CustomScrollbar autoHide>\r\n      <LogRows\r\n        logRows={sortedNewResults.rows}\r\n        dedupStrategy={LogsDedupStrategy.none}\r\n        highlighterExpressions={[]}\r\n        showLabels={showLabels}\r\n        showTime={showTime}\r\n        wrapLogMessage={wrapLogMessage}\r\n        timeZone={timeZone}\r\n        allowDetails={true}\r\n      />\r\n    </CustomScrollbar>\r\n  );\r\n};\r\n","// Libraries\r\nimport React, { PureComponent } from 'react';\r\nimport { Switch, PanelOptionsGrid, PanelOptionsGroup, FormLabel, Select } from '@grafana/ui';\r\n\r\n// Types\r\nimport { Options } from './types';\r\nimport { SortOrder } from 'app/core/utils/explore';\r\nimport { PanelEditorProps, SelectableValue } from '@grafana/data';\r\n\r\nconst sortOrderOptions = [\r\n  { value: SortOrder.Descending, label: 'Descending' },\r\n  { value: SortOrder.Ascending, label: 'Ascending' },\r\n];\r\n\r\nexport class LogsPanelEditor extends PureComponent<PanelEditorProps<Options>> {\r\n  onToggleLabels = () => {\r\n    const { options, onOptionsChange } = this.props;\r\n    const { showLabels } = options;\r\n\r\n    onOptionsChange({ ...options, showLabels: !showLabels });\r\n  };\r\n\r\n  onToggleTime = () => {\r\n    const { options, onOptionsChange } = this.props;\r\n    const { showTime } = options;\r\n\r\n    onOptionsChange({ ...options, showTime: !showTime });\r\n  };\r\n\r\n  onTogglewrapLogMessage = () => {\r\n    const { options, onOptionsChange } = this.props;\r\n    const { wrapLogMessage } = options;\r\n\r\n    onOptionsChange({ ...options, wrapLogMessage: !wrapLogMessage });\r\n  };\r\n\r\n  onShowValuesChange = (item: SelectableValue<SortOrder>) => {\r\n    const { options, onOptionsChange } = this.props;\r\n    onOptionsChange({ ...options, sortOrder: item.value });\r\n  };\r\n\r\n  render() {\r\n    const { showLabels, showTime, wrapLogMessage, sortOrder } = this.props.options;\r\n    const value = sortOrderOptions.filter(option => option.value === sortOrder)[0];\r\n\r\n    return (\r\n      <>\r\n        <PanelOptionsGrid>\r\n          <PanelOptionsGroup title=\"Columns\">\r\n            <Switch label=\"Time\" labelClass=\"width-10\" checked={showTime} onChange={this.onToggleTime} />\r\n            <Switch label=\"Labels\" labelClass=\"width-10\" checked={showLabels} onChange={this.onToggleLabels} />\r\n            <Switch\r\n              label=\"Wrap lines\"\r\n              labelClass=\"width-10\"\r\n              checked={wrapLogMessage}\r\n              onChange={this.onTogglewrapLogMessage}\r\n            />\r\n            <div className=\"gf-form\">\r\n              <FormLabel>Order</FormLabel>\r\n              <Select options={sortOrderOptions} value={value} onChange={this.onShowValuesChange} />\r\n            </div>\r\n          </PanelOptionsGroup>\r\n        </PanelOptionsGrid>\r\n      </>\r\n    );\r\n  }\r\n}\r\n","import { PanelPlugin } from '@grafana/data';\r\nimport { Options, defaults } from './types';\r\nimport { LogsPanel } from './LogsPanel';\r\nimport { LogsPanelEditor } from './LogsPanelEditor';\r\n\r\nexport const plugin = new PanelPlugin<Options>(LogsPanel).setDefaults(defaults).setEditor(LogsPanelEditor);\r\n","import { SortOrder } from 'app/core/utils/explore';\r\n\r\nexport interface Options {\r\n  showLabels: boolean;\r\n  showTime: boolean;\r\n  wrapLogMessage: boolean;\r\n  sortOrder: SortOrder;\r\n}\r\n\r\nexport const defaults: Options = {\r\n  showLabels: false,\r\n  showTime: true,\r\n  wrapLogMessage: true,\r\n  sortOrder: SortOrder.Descending,\r\n};\r\n","// Libraries\r\nimport React, { PureComponent } from 'react';\r\nimport { css } from 'emotion';\r\n\r\n// Utils & Services\r\nimport { GrafanaTheme } from '@grafana/data';\r\nimport { stylesFactory, CustomScrollbar, styleMixins } from '@grafana/ui';\r\nimport config from 'app/core/config';\r\nimport { feedToDataFrame } from './utils';\r\nimport { sanitize } from 'app/core/utils/text';\r\nimport { loadRSSFeed } from './rss';\r\n\r\n// Types\r\nimport { PanelProps, DataFrameView, dateTime } from '@grafana/data';\r\nimport { NewsOptions, NewsItem, DEFAULT_FEED_URL } from './types';\r\n\r\ninterface Props extends PanelProps<NewsOptions> {}\r\n\r\ninterface State {\r\n  news?: DataFrameView<NewsItem>;\r\n  isError?: boolean;\r\n}\r\n\r\nexport class NewsPanel extends PureComponent<Props, State> {\r\n  constructor(props: Props) {\r\n    super(props);\r\n\r\n    this.state = {};\r\n  }\r\n\r\n  componentDidMount(): void {\r\n    this.loadFeed();\r\n  }\r\n\r\n  componentDidUpdate(prevProps: Props): void {\r\n    if (this.props.options.feedUrl !== prevProps.options.feedUrl) {\r\n      this.loadFeed();\r\n    }\r\n  }\r\n\r\n  async loadFeed() {\r\n    const { options } = this.props;\r\n    try {\r\n      const url = options.feedUrl ?? DEFAULT_FEED_URL;\r\n      const res = await loadRSSFeed(url);\r\n      const frame = feedToDataFrame(res);\r\n      this.setState({\r\n        news: new DataFrameView<NewsItem>(frame),\r\n        isError: false,\r\n      });\r\n    } catch (err) {\r\n      console.error('Error Loading News', err);\r\n      this.setState({\r\n        news: undefined,\r\n        isError: true,\r\n      });\r\n    }\r\n  }\r\n\r\n  render() {\r\n    const { isError, news } = this.state;\r\n    const styles = getStyles(config.theme);\r\n\r\n    if (isError) {\r\n      return <div>Error Loading News</div>;\r\n    }\r\n    if (!news) {\r\n      return <div>loading...</div>;\r\n    }\r\n\r\n    return (\r\n      <div className={styles.container}>\r\n        <CustomScrollbar>\r\n          {news.map((item, index) => {\r\n            return (\r\n              <div key={index} className={styles.item}>\r\n                <a href={item.link} target=\"_blank\">\r\n                  <div className={styles.title}>{item.title}</div>\r\n                  <div className={styles.date}>{dateTime(item.date).format('MMM DD')} </div>\r\n                  <div className={styles.content} dangerouslySetInnerHTML={{ __html: sanitize(item.content) }} />\r\n                </a>\r\n              </div>\r\n            );\r\n          })}\r\n        </CustomScrollbar>\r\n      </div>\r\n    );\r\n  }\r\n}\r\n\r\nconst getStyles = stylesFactory((theme: GrafanaTheme) => ({\r\n  container: css`\r\n    height: 100%;\r\n  `,\r\n  item: css`\r\n    ${styleMixins.listItem(theme)}\r\n    padding: ${theme.spacing.sm};\r\n    position: relative;\r\n    margin-bottom: 4px;\r\n    margin-right: ${theme.spacing.sm};\r\n  `,\r\n  title: css`\r\n    color: ${theme.colors.linkExternal};\r\n    max-width: calc(100% - 70px);\r\n    font-size: 16px;\r\n    margin-bottom: ${theme.spacing.sm};\r\n  `,\r\n  content: css`\r\n    p {\r\n      margin-bottom: 4px;\r\n    }\r\n  `,\r\n  date: css`\r\n    position: absolute;\r\n    top: 0;\r\n    right: 0;\r\n    background: ${theme.colors.panelBg};\r\n    width: 55px;\r\n    text-align: right;\r\n    padding: ${theme.spacing.xs};\r\n    font-weight: 500;\r\n    border-radius: 0 0 0 3px;\r\n    color: ${theme.colors.textWeak};\r\n  `,\r\n}));\r\n","import React, { PureComponent } from 'react';\r\nimport { FormField, PanelOptionsGroup, Button } from '@grafana/ui';\r\nimport { PanelEditorProps } from '@grafana/data';\r\nimport { NewsOptions, DEFAULT_FEED_URL } from './types';\r\n\r\nconst PROXY_PREFIX = 'https://cors-anywhere.herokuapp.com/';\r\n\r\ninterface State {\r\n  feedUrl: string;\r\n}\r\n\r\nexport class NewsPanelEditor extends PureComponent<PanelEditorProps<NewsOptions>, State> {\r\n  constructor(props: PanelEditorProps<NewsOptions>) {\r\n    super(props);\r\n\r\n    this.state = {\r\n      feedUrl: props.options.feedUrl,\r\n    };\r\n  }\r\n\r\n  onUpdatePanel = () =>\r\n    this.props.onOptionsChange({\r\n      ...this.props.options,\r\n      feedUrl: this.state.feedUrl,\r\n    });\r\n\r\n  onFeedUrlChange = ({ target }: any) => this.setState({ feedUrl: target.value });\r\n\r\n  onSetProxyPrefix = () => {\r\n    const feedUrl = PROXY_PREFIX + this.state.feedUrl;\r\n    this.setState({ feedUrl });\r\n    this.props.onOptionsChange({\r\n      ...this.props.options,\r\n      feedUrl,\r\n    });\r\n  };\r\n\r\n  render() {\r\n    const feedUrl = this.state.feedUrl || '';\r\n    const suggestProxy = feedUrl && !feedUrl.startsWith(PROXY_PREFIX);\r\n    return (\r\n      <>\r\n        <PanelOptionsGroup title=\"Feed\">\r\n          <div className=\"gf-form\">\r\n            <FormField\r\n              label=\"URL\"\r\n              labelWidth={4}\r\n              inputWidth={30}\r\n              value={feedUrl || ''}\r\n              placeholder={DEFAULT_FEED_URL}\r\n              onChange={this.onFeedUrlChange}\r\n              onBlur={this.onUpdatePanel}\r\n            />\r\n          </div>\r\n          {suggestProxy && (\r\n            <div>\r\n              <br />\r\n              <div>If the feed is unable to connect, consider a CORS proxy</div>\r\n              <Button variant=\"inverse\" onClick={this.onSetProxyPrefix}>\r\n                Use Proxy\r\n              </Button>\r\n            </div>\r\n          )}\r\n        </PanelOptionsGroup>\r\n      </>\r\n    );\r\n  }\r\n}\r\n","import { PanelPlugin } from '@grafana/data';\r\nimport { NewsPanel } from './NewsPanel';\r\nimport { NewsPanelEditor } from './NewsPanelEditor';\r\nimport { defaults, NewsOptions } from './types';\r\n\r\nexport const plugin = new PanelPlugin<NewsOptions>(NewsPanel).setDefaults(defaults).setEditor(NewsPanelEditor);\r\n","import { RssFeed, RssItem } from './types';\r\n\r\nexport async function loadRSSFeed(url: string): Promise<RssFeed> {\r\n  const rsp = await fetch(url);\r\n  const txt = await rsp.text();\r\n  const domParser = new DOMParser();\r\n  const doc = domParser.parseFromString(txt, 'text/xml');\r\n  const feed: RssFeed = {\r\n    items: [],\r\n  };\r\n\r\n  const getProperty = (node: Element, property: string) => {\r\n    const propNode = node.querySelector(property);\r\n    if (propNode) {\r\n      return propNode.textContent ?? '';\r\n    }\r\n    return '';\r\n  };\r\n\r\n  doc.querySelectorAll('item').forEach(node => {\r\n    const item: RssItem = {\r\n      title: getProperty(node, 'title'),\r\n      link: getProperty(node, 'link'),\r\n      content: getProperty(node, 'description'),\r\n      pubDate: getProperty(node, 'pubDate'),\r\n    };\r\n\r\n    feed.items.push(item);\r\n  });\r\n\r\n  return feed;\r\n}\r\n","export const DEFAULT_FEED_URL = 'https://grafana.com/blog/news.xml';\r\n\r\nexport interface NewsOptions {\r\n  feedUrl?: string;\r\n}\r\n\r\nexport const defaults: NewsOptions = {\r\n  // will default to grafana blog\r\n};\r\n\r\nexport interface NewsItem {\r\n  date: number;\r\n  title: string;\r\n  link: string;\r\n  content: string;\r\n}\r\n\r\n/**\r\n * Helper class for rss-parser\r\n */\r\nexport interface RssFeed {\r\n  title?: string;\r\n  description?: string;\r\n  items: RssItem[];\r\n}\r\n\r\nexport interface RssItem {\r\n  title: string;\r\n  link: string;\r\n  pubDate?: string;\r\n  content?: string;\r\n  contentSnippet?: string;\r\n}\r\n","import { RssFeed } from './types';\r\nimport { ArrayVector, FieldType, DataFrame, dateTime } from '@grafana/data';\r\n\r\nexport function feedToDataFrame(feed: RssFeed): DataFrame {\r\n  const date = new ArrayVector<number>([]);\r\n  const title = new ArrayVector<string>([]);\r\n  const link = new ArrayVector<string>([]);\r\n  const content = new ArrayVector<string>([]);\r\n\r\n  for (const item of feed.items) {\r\n    const val = dateTime(item.pubDate);\r\n\r\n    try {\r\n      date.buffer.push(val.valueOf());\r\n      title.buffer.push(item.title);\r\n      link.buffer.push(item.link);\r\n\r\n      if (item.content) {\r\n        const body = item.content.replace(/<\\/?[^>]+(>|$)/g, '');\r\n        content.buffer.push(body);\r\n      }\r\n    } catch (err) {\r\n      console.warn('Error reading news item:', err, item);\r\n    }\r\n  }\r\n\r\n  return {\r\n    fields: [\r\n      { name: 'date', type: FieldType.time, config: { title: 'Date' }, values: date },\r\n      { name: 'title', type: FieldType.string, config: {}, values: title },\r\n      { name: 'link', type: FieldType.string, config: {}, values: link },\r\n      { name: 'content', type: FieldType.string, config: {}, values: content },\r\n    ],\r\n    length: date.length,\r\n  };\r\n}\r\n","// Libraries\r\nimport React, { PureComponent } from 'react';\r\n\r\n// Components\r\nimport { Select, FormLabel, PanelOptionsGroup } from '@grafana/ui';\r\n\r\n// Types\r\nimport { PanelEditorProps } from '@grafana/data';\r\nimport { FormField, PieChartType } from '@grafana/ui';\r\nimport { PieChartOptions } from './types';\r\n\r\nconst labelWidth = 8;\r\n\r\nconst pieChartOptions = [\r\n  { value: PieChartType.PIE, label: 'Pie' },\r\n  { value: PieChartType.DONUT, label: 'Donut' },\r\n];\r\n\r\nexport class PieChartOptionsBox extends PureComponent<PanelEditorProps<PieChartOptions>> {\r\n  onPieTypeChange = (pieType: any) => this.props.onOptionsChange({ ...this.props.options, pieType: pieType.value });\r\n  onStrokeWidthChange = ({ target }: any) =>\r\n    this.props.onOptionsChange({ ...this.props.options, strokeWidth: target.value });\r\n\r\n  render() {\r\n    const { options } = this.props;\r\n    const { pieType, strokeWidth } = options;\r\n\r\n    return (\r\n      <PanelOptionsGroup title=\"PieChart\">\r\n        <div className=\"gf-form\">\r\n          <FormLabel width={labelWidth}>Type</FormLabel>\r\n          <Select\r\n            width={12}\r\n            options={pieChartOptions}\r\n            onChange={this.onPieTypeChange}\r\n            value={pieChartOptions.find(option => option.value === pieType)}\r\n          />\r\n        </div>\r\n        <div className=\"gf-form\">\r\n          <FormField\r\n            label=\"Divider width\"\r\n            labelWidth={labelWidth}\r\n            onChange={this.onStrokeWidthChange}\r\n            value={strokeWidth}\r\n          />\r\n        </div>\r\n      </PanelOptionsGroup>\r\n    );\r\n  }\r\n}\r\n","// Libraries\r\nimport React, { PureComponent } from 'react';\r\n\r\n// Services & Utils\r\nimport { config } from 'app/core/config';\r\n\r\n// Components\r\nimport { PieChart } from '@grafana/ui';\r\nimport { getFieldDisplayValues } from '@grafana/data';\r\n\r\n// Types\r\nimport { PieChartOptions } from './types';\r\nimport { PanelProps } from '@grafana/data';\r\n\r\ninterface Props extends PanelProps<PieChartOptions> {}\r\n\r\nexport class PieChartPanel extends PureComponent<Props> {\r\n  render() {\r\n    const { width, height, options, data, replaceVariables } = this.props;\r\n\r\n    const values = getFieldDisplayValues({\r\n      fieldOptions: options.fieldOptions,\r\n      data: data.series,\r\n      theme: config.theme,\r\n      replaceVariables: replaceVariables,\r\n    }).map(v => v.display);\r\n\r\n    return (\r\n      <PieChart\r\n        width={width}\r\n        height={height}\r\n        values={values}\r\n        pieType={options.pieType}\r\n        strokeWidth={options.strokeWidth}\r\n        theme={config.theme}\r\n      />\r\n    );\r\n  }\r\n}\r\n","import React, { PureComponent } from 'react';\r\nimport {\r\n  PanelOptionsGrid,\r\n  ValueMappingsEditor,\r\n  FieldDisplayEditor,\r\n  FieldPropertiesEditor,\r\n  PanelOptionsGroup,\r\n} from '@grafana/ui';\r\nimport { ValueMapping, FieldConfig, PanelEditorProps, FieldDisplayOptions } from '@grafana/data';\r\n\r\nimport { PieChartOptionsBox } from './PieChartOptionsBox';\r\nimport { PieChartOptions } from './types';\r\n\r\nexport class PieChartPanelEditor extends PureComponent<PanelEditorProps<PieChartOptions>> {\r\n  onValueMappingsChanged = (mappings: ValueMapping[]) => {\r\n    const current = this.props.options.fieldOptions.defaults;\r\n    this.onDefaultsChange({\r\n      ...current,\r\n      mappings,\r\n    });\r\n  };\r\n\r\n  onDisplayOptionsChanged = (fieldOptions: FieldDisplayOptions) =>\r\n    this.props.onOptionsChange({\r\n      ...this.props.options,\r\n      fieldOptions,\r\n    });\r\n\r\n  onDefaultsChange = (field: FieldConfig) => {\r\n    this.onDisplayOptionsChanged({\r\n      ...this.props.options.fieldOptions,\r\n      defaults: field,\r\n    });\r\n  };\r\n\r\n  render() {\r\n    const { onOptionsChange, options, data } = this.props;\r\n    const { fieldOptions } = options;\r\n    const { defaults } = fieldOptions;\r\n\r\n    return (\r\n      <>\r\n        <PanelOptionsGrid>\r\n          <PanelOptionsGroup title=\"Display\">\r\n            <FieldDisplayEditor onChange={this.onDisplayOptionsChanged} value={fieldOptions} />\r\n          </PanelOptionsGroup>\r\n\r\n          <PanelOptionsGroup title=\"Field (default)\">\r\n            <FieldPropertiesEditor showMinMax={true} onChange={this.onDefaultsChange} value={defaults} />\r\n          </PanelOptionsGroup>\r\n\r\n          <PieChartOptionsBox data={data} onOptionsChange={onOptionsChange} options={options} />\r\n        </PanelOptionsGrid>\r\n\r\n        <ValueMappingsEditor onChange={this.onValueMappingsChanged} valueMappings={defaults.mappings} />\r\n      </>\r\n    );\r\n  }\r\n}\r\n","import { PanelPlugin } from '@grafana/data';\r\nimport { PieChartPanelEditor } from './PieChartPanelEditor';\r\nimport { PieChartPanel } from './PieChartPanel';\r\nimport { PieChartOptions, defaults } from './types';\r\n\r\nexport const plugin = new PanelPlugin<PieChartOptions>(PieChartPanel)\r\n  .setDefaults(defaults)\r\n  .setEditor(PieChartPanelEditor);\r\n","import { PieChartType, SingleStatBaseOptions } from '@grafana/ui';\r\nimport { standardFieldDisplayOptions } from '../stat/types';\r\nimport { ReducerID, VizOrientation } from '@grafana/data';\r\n\r\nexport interface PieChartOptions extends SingleStatBaseOptions {\r\n  pieType: PieChartType;\r\n  strokeWidth: number;\r\n}\r\n\r\nexport const defaults: PieChartOptions = {\r\n  pieType: PieChartType.PIE,\r\n  strokeWidth: 1,\r\n  orientation: VizOrientation.Auto,\r\n  fieldOptions: {\r\n    ...standardFieldDisplayOptions,\r\n    calcs: [ReducerID.last],\r\n    defaults: {\r\n      unit: 'short',\r\n    },\r\n  },\r\n};\r\n","import _ from 'lodash';\r\nimport { PanelCtrl } from '../../../features/panel/panel_ctrl';\r\nimport { auto } from 'angular';\r\nimport { BackendSrv } from '@grafana/runtime';\r\nimport { PanelEvents } from '@grafana/data';\r\nimport { ContextSrv } from '../../../core/services/context_srv';\r\nimport { CoreEvents } from 'app/types';\r\n\r\nclass PluginListCtrl extends PanelCtrl {\r\n  static templateUrl = 'module.html';\r\n  static scrollable = true;\r\n\r\n  pluginList: any[];\r\n  viewModel: any;\r\n  isAdmin: boolean;\r\n\r\n  // Set and populate defaults\r\n  panelDefaults = {};\r\n\r\n  /** @ngInject */\r\n  constructor($scope: any, $injector: auto.IInjectorService, private backendSrv: BackendSrv, contextSrv: ContextSrv) {\r\n    super($scope, $injector);\r\n\r\n    _.defaults(this.panel, this.panelDefaults);\r\n\r\n    this.isAdmin = contextSrv.hasRole('Admin');\r\n    this.events.on(PanelEvents.editModeInitialized, this.onInitEditMode.bind(this));\r\n    this.pluginList = [];\r\n    this.viewModel = [\r\n      { header: 'Installed Apps', list: [], type: 'app' },\r\n      { header: 'Installed Panels', list: [], type: 'panel' },\r\n      { header: 'Installed Datasources', list: [], type: 'datasource' },\r\n    ];\r\n\r\n    this.update();\r\n  }\r\n\r\n  onInitEditMode() {\r\n    this.addEditorTab('Options', 'public/app/plugins/panel/pluginlist/editor.html');\r\n  }\r\n\r\n  gotoPlugin(plugin: { id: any }, evt: any) {\r\n    if (evt) {\r\n      evt.stopPropagation();\r\n    }\r\n    this.$location.url(`plugins/${plugin.id}/edit`);\r\n  }\r\n\r\n  updateAvailable(plugin: any, $event: any) {\r\n    $event.stopPropagation();\r\n    $event.preventDefault();\r\n\r\n    const modalScope = this.$scope.$new(true);\r\n    modalScope.plugin = plugin;\r\n\r\n    this.publishAppEvent(CoreEvents.showModal, {\r\n      src: 'public/app/features/plugins/partials/update_instructions.html',\r\n      scope: modalScope,\r\n    });\r\n  }\r\n\r\n  update() {\r\n    this.backendSrv.get('api/plugins', { embedded: 0, core: 0 }).then(plugins => {\r\n      this.pluginList = plugins;\r\n      this.viewModel[0].list = _.filter(plugins, { type: 'app' });\r\n      this.viewModel[1].list = _.filter(plugins, { type: 'panel' });\r\n      this.viewModel[2].list = _.filter(plugins, { type: 'datasource' });\r\n\r\n      for (const plugin of this.pluginList) {\r\n        if (plugin.hasUpdate) {\r\n          plugin.state = 'has-update';\r\n        } else if (!plugin.enabled) {\r\n          plugin.state = 'not-enabled';\r\n        }\r\n      }\r\n    });\r\n  }\r\n}\r\n\r\nexport { PluginListCtrl, PluginListCtrl as PanelCtrl };\r\n","import _ from 'lodash';\r\nimport { auto } from 'angular';\r\nimport $ from 'jquery';\r\nimport 'vendor/flot/jquery.flot';\r\nimport 'vendor/flot/jquery.flot.gauge';\r\nimport 'app/features/panel/panellinks/link_srv';\r\n\r\nimport {\r\n  DataFrame,\r\n  DisplayValue,\r\n  Field,\r\n  fieldReducers,\r\n  FieldType,\r\n  GraphSeriesValue,\r\n  KeyValue,\r\n  LinkModel,\r\n  reduceField,\r\n  ReducerID,\r\n  LegacyResponseData,\r\n  getFlotPairs,\r\n  getDisplayProcessor,\r\n  getColorFromHexRgbOrName,\r\n  PanelEvents,\r\n  formattedValueToString,\r\n} from '@grafana/data';\r\n\r\nimport { convertOldAngularValueMapping } from '@grafana/ui';\r\n\r\nimport { CoreEvents } from 'app/types';\r\nimport config from 'app/core/config';\r\nimport { MetricsPanelCtrl } from 'app/plugins/sdk';\r\nimport { LinkSrv } from 'app/features/panel/panellinks/link_srv';\r\nimport { getProcessedDataFrames } from 'app/features/dashboard/state/runRequest';\r\n\r\nconst BASE_FONT_SIZE = 38;\r\n\r\nexport interface ShowData {\r\n  field: Field;\r\n  value: any;\r\n  sparkline: GraphSeriesValue[][];\r\n  display: DisplayValue;\r\n\r\n  scopedVars: any;\r\n\r\n  thresholds: any[];\r\n  colorMap: any;\r\n}\r\n\r\nclass SingleStatCtrl extends MetricsPanelCtrl {\r\n  static templateUrl = 'module.html';\r\n\r\n  data: Partial<ShowData> = {};\r\n\r\n  fontSizes: any[];\r\n  fieldNames: string[] = [];\r\n\r\n  invalidGaugeRange: boolean;\r\n  panel: any;\r\n  events: any;\r\n  valueNameOptions: any[] = [\r\n    { value: 'min', text: 'Min' },\r\n    { value: 'max', text: 'Max' },\r\n    { value: 'avg', text: 'Average' },\r\n    { value: 'current', text: 'Current' },\r\n    { value: 'total', text: 'Total' },\r\n    { value: 'name', text: 'Name' },\r\n    { value: 'first', text: 'First' },\r\n    { value: 'delta', text: 'Delta' },\r\n    { value: 'diff', text: 'Difference' },\r\n    { value: 'range', text: 'Range' },\r\n    { value: 'last_time', text: 'Time of last point' },\r\n  ];\r\n\r\n  // Set and populate defaults\r\n  panelDefaults: any = {\r\n    links: [],\r\n    datasource: null,\r\n    maxDataPoints: 100,\r\n    interval: null,\r\n    targets: [{}],\r\n    cacheTimeout: null,\r\n    format: 'none',\r\n    prefix: '',\r\n    postfix: '',\r\n    nullText: null,\r\n    valueMaps: [{ value: 'null', op: '=', text: 'N/A' }],\r\n    mappingTypes: [\r\n      { name: 'value to text', value: 1 },\r\n      { name: 'range to text', value: 2 },\r\n    ],\r\n    rangeMaps: [{ from: 'null', to: 'null', text: 'N/A' }],\r\n    mappingType: 1,\r\n    nullPointMode: 'connected',\r\n    valueName: 'avg',\r\n    prefixFontSize: '50%',\r\n    valueFontSize: '80%',\r\n    postfixFontSize: '50%',\r\n    thresholds: '',\r\n    colorBackground: false,\r\n    colorValue: false,\r\n    colors: ['#299c46', 'rgba(237, 129, 40, 0.89)', '#d44a3a'],\r\n    sparkline: {\r\n      show: false,\r\n      full: false,\r\n      ymin: null,\r\n      ymax: null,\r\n      lineColor: 'rgb(31, 120, 193)',\r\n      fillColor: 'rgba(31, 118, 189, 0.18)',\r\n    },\r\n    gauge: {\r\n      show: false,\r\n      minValue: 0,\r\n      maxValue: 100,\r\n      thresholdMarkers: true,\r\n      thresholdLabels: false,\r\n    },\r\n    tableColumn: '',\r\n  };\r\n\r\n  /** @ngInject */\r\n  constructor($scope: any, $injector: auto.IInjectorService, private linkSrv: LinkSrv, private $sanitize: any) {\r\n    super($scope, $injector);\r\n    _.defaults(this.panel, this.panelDefaults);\r\n\r\n    this.events.on(CoreEvents.dataFramesReceived, this.onFramesReceived.bind(this));\r\n    this.events.on(PanelEvents.dataSnapshotLoad, this.onSnapshotLoad.bind(this));\r\n    this.events.on(PanelEvents.editModeInitialized, this.onInitEditMode.bind(this));\r\n\r\n    this.useDataFrames = true;\r\n\r\n    this.onSparklineColorChange = this.onSparklineColorChange.bind(this);\r\n    this.onSparklineFillChange = this.onSparklineFillChange.bind(this);\r\n  }\r\n\r\n  onInitEditMode() {\r\n    this.fontSizes = ['20%', '30%', '50%', '70%', '80%', '100%', '110%', '120%', '150%', '170%', '200%'];\r\n    this.addEditorTab('Options', 'public/app/plugins/panel/singlestat/editor.html', 2);\r\n    this.addEditorTab('Value Mappings', 'public/app/plugins/panel/singlestat/mappings.html', 3);\r\n  }\r\n\r\n  migrateToGaugePanel(migrate: boolean) {\r\n    if (migrate) {\r\n      this.onPluginTypeChange(config.panels['gauge']);\r\n    } else {\r\n      this.panel.gauge.show = false;\r\n      this.render();\r\n    }\r\n  }\r\n\r\n  setUnitFormat() {\r\n    return (unit: string) => {\r\n      this.panel.format = unit;\r\n      this.refresh();\r\n    };\r\n  }\r\n\r\n  onSnapshotLoad(dataList: LegacyResponseData[]) {\r\n    this.onFramesReceived(getProcessedDataFrames(dataList));\r\n  }\r\n\r\n  onFramesReceived(frames: DataFrame[]) {\r\n    const { panel } = this;\r\n\r\n    if (frames && frames.length > 1) {\r\n      this.data = {\r\n        value: 0,\r\n        display: {\r\n          text: 'Only queries that return single series/table is supported',\r\n          numeric: NaN,\r\n        },\r\n      };\r\n      this.render();\r\n      return;\r\n    }\r\n\r\n    const distinct = getDistinctNames(frames);\r\n    let fieldInfo = distinct.byName[panel.tableColumn]; //\r\n    this.fieldNames = distinct.names;\r\n\r\n    if (!fieldInfo) {\r\n      fieldInfo = distinct.first;\r\n    }\r\n\r\n    if (!fieldInfo) {\r\n      const processor = getDisplayProcessor({\r\n        field: {\r\n          config: {\r\n            mappings: convertOldAngularValueMapping(this.panel),\r\n            noValue: 'No Data',\r\n          },\r\n        },\r\n        theme: config.theme,\r\n      });\r\n      // When we don't have any field\r\n      this.data = {\r\n        value: null,\r\n        display: processor(null),\r\n      };\r\n    } else {\r\n      this.data = this.processField(fieldInfo);\r\n    }\r\n\r\n    this.render();\r\n  }\r\n\r\n  processField(fieldInfo: FieldInfo) {\r\n    const { panel, dashboard } = this;\r\n\r\n    const name = fieldInfo.field.config.title || fieldInfo.field.name;\r\n    let calc = panel.valueName;\r\n    let calcField = fieldInfo.field;\r\n    let val: any = undefined;\r\n\r\n    if ('name' === calc) {\r\n      val = name;\r\n    } else {\r\n      if ('last_time' === calc) {\r\n        if (fieldInfo.frame.firstTimeField) {\r\n          calcField = fieldInfo.frame.firstTimeField;\r\n          calc = ReducerID.last;\r\n        }\r\n      }\r\n\r\n      // Normalize functions (avg -> mean, etc)\r\n      const r = fieldReducers.getIfExists(calc);\r\n      if (r) {\r\n        calc = r.id;\r\n        // With strings, don't accidentally use a math function\r\n        if (calcField.type === FieldType.string) {\r\n          const avoid = [ReducerID.mean, ReducerID.sum];\r\n          if (avoid.includes(calc)) {\r\n            calc = panel.valueName = ReducerID.first;\r\n          }\r\n        }\r\n      } else {\r\n        calc = ReducerID.lastNotNull;\r\n      }\r\n\r\n      // Calculate the value\r\n      val = reduceField({\r\n        field: calcField,\r\n        reducers: [calc],\r\n      })[calc];\r\n    }\r\n\r\n    const processor = getDisplayProcessor({\r\n      field: {\r\n        ...fieldInfo.field,\r\n        config: {\r\n          ...fieldInfo.field.config,\r\n          unit: panel.format,\r\n          decimals: panel.decimals,\r\n          mappings: convertOldAngularValueMapping(panel),\r\n        },\r\n      },\r\n      theme: config.theme,\r\n      timeZone: dashboard.getTimezone(),\r\n    });\r\n\r\n    const sparkline: any[] = [];\r\n    const data = {\r\n      field: fieldInfo.field,\r\n      value: val,\r\n      display: processor(val),\r\n      scopedVars: _.extend({}, panel.scopedVars),\r\n      sparkline,\r\n    };\r\n\r\n    data.scopedVars['__name'] = { value: name };\r\n    panel.tableColumn = this.fieldNames.length > 1 ? name : '';\r\n\r\n    // Get the fields for a sparkline\r\n    if (panel.sparkline && panel.sparkline.show && fieldInfo.frame.firstTimeField) {\r\n      data.sparkline = getFlotPairs({\r\n        xField: fieldInfo.frame.firstTimeField,\r\n        yField: fieldInfo.field,\r\n        nullValueMode: panel.nullPointMode,\r\n      });\r\n    }\r\n\r\n    return data;\r\n  }\r\n\r\n  canModifyText() {\r\n    return !this.panel.gauge.show;\r\n  }\r\n\r\n  setColoring(options: { background: any }) {\r\n    if (options.background) {\r\n      this.panel.colorValue = false;\r\n      this.panel.colors = ['rgba(71, 212, 59, 0.4)', 'rgba(245, 150, 40, 0.73)', 'rgba(225, 40, 40, 0.59)'];\r\n    } else {\r\n      this.panel.colorBackground = false;\r\n      this.panel.colors = ['rgba(50, 172, 45, 0.97)', 'rgba(237, 129, 40, 0.89)', 'rgba(245, 54, 54, 0.9)'];\r\n    }\r\n    this.render();\r\n  }\r\n\r\n  invertColorOrder() {\r\n    const tmp = this.panel.colors[0];\r\n    this.panel.colors[0] = this.panel.colors[2];\r\n    this.panel.colors[2] = tmp;\r\n    this.render();\r\n  }\r\n\r\n  onColorChange(panelColorIndex: number) {\r\n    return (color: string) => {\r\n      this.panel.colors[panelColorIndex] = color;\r\n      this.render();\r\n    };\r\n  }\r\n\r\n  onSparklineColorChange(newColor: string) {\r\n    this.panel.sparkline.lineColor = newColor;\r\n    this.render();\r\n  }\r\n\r\n  onSparklineFillChange(newColor: string) {\r\n    this.panel.sparkline.fillColor = newColor;\r\n    this.render();\r\n  }\r\n\r\n  removeValueMap(map: any) {\r\n    const index = _.indexOf(this.panel.valueMaps, map);\r\n    this.panel.valueMaps.splice(index, 1);\r\n    this.render();\r\n  }\r\n\r\n  addValueMap() {\r\n    this.panel.valueMaps.push({ value: '', op: '=', text: '' });\r\n  }\r\n\r\n  removeRangeMap(rangeMap: any) {\r\n    const index = _.indexOf(this.panel.rangeMaps, rangeMap);\r\n    this.panel.rangeMaps.splice(index, 1);\r\n    this.render();\r\n  }\r\n\r\n  addRangeMap() {\r\n    this.panel.rangeMaps.push({ from: '', to: '', text: '' });\r\n  }\r\n\r\n  link(scope: any, elem: JQuery, attrs: any, ctrl: any) {\r\n    const $location = this.$location;\r\n    const linkSrv = this.linkSrv;\r\n    const $timeout = this.$timeout;\r\n    const $sanitize = this.$sanitize;\r\n    const panel = ctrl.panel;\r\n    const templateSrv = this.templateSrv;\r\n    let linkInfo: LinkModel<any> | null = null;\r\n    const $panelContainer = elem.find('.panel-container');\r\n    elem = elem.find('.singlestat-panel');\r\n\r\n    function applyColoringThresholds(valueString: string) {\r\n      const data = ctrl.data;\r\n      const color = getColorForValue(data, data.value);\r\n      if (color) {\r\n        return '<span style=\"color:' + color + '\">' + valueString + '</span>';\r\n      }\r\n\r\n      return valueString;\r\n    }\r\n\r\n    function getSpan(className: string, fontSizePercent: string, applyColoring: any, value: string) {\r\n      value = $sanitize(templateSrv.replace(value, ctrl.data.scopedVars));\r\n      value = applyColoring ? applyColoringThresholds(value) : value;\r\n      const pixelSize = (parseInt(fontSizePercent, 10) / 100) * BASE_FONT_SIZE;\r\n      return '<span class=\"' + className + '\" style=\"font-size:' + pixelSize + 'px\">' + value + '</span>';\r\n    }\r\n\r\n    function getBigValueHtml() {\r\n      const data: ShowData = ctrl.data;\r\n      let body = '<div class=\"singlestat-panel-value-container\">';\r\n\r\n      if (panel.prefix) {\r\n        body += getSpan('singlestat-panel-prefix', panel.prefixFontSize, panel.colorPrefix, panel.prefix);\r\n      }\r\n\r\n      body += getSpan(\r\n        'singlestat-panel-value',\r\n        panel.valueFontSize,\r\n        panel.colorValue,\r\n        formattedValueToString(data.display)\r\n      );\r\n\r\n      if (panel.postfix) {\r\n        body += getSpan('singlestat-panel-postfix', panel.postfixFontSize, panel.colorPostfix, panel.postfix);\r\n      }\r\n\r\n      body += '</div>';\r\n\r\n      return body;\r\n    }\r\n\r\n    function getValueText() {\r\n      const data: ShowData = ctrl.data;\r\n      let result = panel.prefix ? templateSrv.replace(panel.prefix, data.scopedVars) : '';\r\n      result += formattedValueToString(data.display);\r\n      result += panel.postfix ? templateSrv.replace(panel.postfix, data.scopedVars) : '';\r\n\r\n      return result;\r\n    }\r\n\r\n    function addGauge() {\r\n      const data: ShowData = ctrl.data;\r\n      const width = elem.width();\r\n      const height = elem.height();\r\n      // Allow to use a bit more space for wide gauges\r\n      const dimension = Math.min(width, height * 1.3);\r\n\r\n      ctrl.invalidGaugeRange = false;\r\n      if (panel.gauge.minValue > panel.gauge.maxValue) {\r\n        ctrl.invalidGaugeRange = true;\r\n        return;\r\n      }\r\n\r\n      const plotCanvas = $('<div></div>');\r\n      const plotCss = {\r\n        top: '5px',\r\n        margin: 'auto',\r\n        position: 'relative',\r\n        height: height * 0.9 + 'px',\r\n        width: dimension + 'px',\r\n      };\r\n\r\n      plotCanvas.css(plotCss);\r\n\r\n      const thresholds = [];\r\n\r\n      for (let i = 0; i < data.thresholds.length; i++) {\r\n        thresholds.push({\r\n          value: data.thresholds[i],\r\n          color: data.colorMap[i],\r\n        });\r\n      }\r\n      thresholds.push({\r\n        value: panel.gauge.maxValue,\r\n        color: data.colorMap[data.colorMap.length - 1],\r\n      });\r\n\r\n      const bgColor = config.bootData.user.lightTheme ? 'rgb(230,230,230)' : 'rgb(38,38,38)';\r\n\r\n      const fontScale = parseInt(panel.valueFontSize, 10) / 100;\r\n      const fontSize = Math.min(dimension / 5, 100) * fontScale;\r\n      // Reduce gauge width if threshold labels enabled\r\n      const gaugeWidthReduceRatio = panel.gauge.thresholdLabels ? 1.5 : 1;\r\n      const gaugeWidth = Math.min(dimension / 6, 60) / gaugeWidthReduceRatio;\r\n      const thresholdMarkersWidth = gaugeWidth / 5;\r\n      const thresholdLabelFontSize = fontSize / 2.5;\r\n\r\n      const options: any = {\r\n        series: {\r\n          gauges: {\r\n            gauge: {\r\n              min: panel.gauge.minValue,\r\n              max: panel.gauge.maxValue,\r\n              background: { color: bgColor },\r\n              border: { color: null },\r\n              shadow: { show: false },\r\n              width: gaugeWidth,\r\n            },\r\n            frame: { show: false },\r\n            label: { show: false },\r\n            layout: { margin: 0, thresholdWidth: 0 },\r\n            cell: { border: { width: 0 } },\r\n            threshold: {\r\n              values: thresholds,\r\n              label: {\r\n                show: panel.gauge.thresholdLabels,\r\n                margin: thresholdMarkersWidth + 1,\r\n                font: { size: thresholdLabelFontSize },\r\n              },\r\n              show: panel.gauge.thresholdMarkers,\r\n              width: thresholdMarkersWidth,\r\n            },\r\n            value: {\r\n              color: panel.colorValue ? getColorForValue(data, data.display.numeric) : null,\r\n              formatter: () => {\r\n                return getValueText();\r\n              },\r\n              font: {\r\n                size: fontSize,\r\n                family: config.theme.typography.fontFamily.sansSerif,\r\n              },\r\n            },\r\n            show: true,\r\n          },\r\n        },\r\n      };\r\n\r\n      elem.append(plotCanvas);\r\n\r\n      const plotSeries = {\r\n        data: [[0, data.value]],\r\n      };\r\n\r\n      $.plot(plotCanvas, [plotSeries], options);\r\n    }\r\n\r\n    function addSparkline() {\r\n      const data: ShowData = ctrl.data;\r\n      const width = elem.width();\r\n      if (width < 30) {\r\n        // element has not gotten it's width yet\r\n        // delay sparkline render\r\n        setTimeout(addSparkline, 30);\r\n        return;\r\n      }\r\n      if (!data.sparkline || !data.sparkline.length) {\r\n        // no sparkline data\r\n        return;\r\n      }\r\n\r\n      const height = ctrl.height;\r\n      const plotCanvas = $('<div></div>');\r\n      const plotCss: any = {};\r\n      plotCss.position = 'absolute';\r\n      plotCss.bottom = '0px';\r\n\r\n      if (panel.sparkline.full) {\r\n        plotCss.left = '0px';\r\n        plotCss.width = width + 'px';\r\n        const dynamicHeightMargin = height <= 100 ? 5 : Math.round(height / 100) * 15 + 5;\r\n        plotCss.height = height - dynamicHeightMargin + 'px';\r\n      } else {\r\n        plotCss.left = '0px';\r\n        plotCss.width = width + 'px';\r\n        plotCss.height = Math.floor(height * 0.25) + 'px';\r\n      }\r\n\r\n      plotCanvas.css(plotCss);\r\n\r\n      const options = {\r\n        legend: { show: false },\r\n        series: {\r\n          lines: {\r\n            show: true,\r\n            fill: 1,\r\n            lineWidth: 1,\r\n            fillColor: getColorFromHexRgbOrName(panel.sparkline.fillColor, config.theme.type),\r\n            zero: false,\r\n          },\r\n        },\r\n        yaxis: {\r\n          show: false,\r\n          min: panel.sparkline.ymin,\r\n          max: panel.sparkline.ymax,\r\n        },\r\n        xaxis: {\r\n          show: false,\r\n          mode: 'time',\r\n          min: ctrl.range.from.valueOf(),\r\n          max: ctrl.range.to.valueOf(),\r\n        },\r\n        grid: { hoverable: false, show: false },\r\n      };\r\n\r\n      elem.append(plotCanvas);\r\n\r\n      const plotSeries = {\r\n        data: data.sparkline,\r\n        color: getColorFromHexRgbOrName(panel.sparkline.lineColor, config.theme.type),\r\n      };\r\n\r\n      $.plot(plotCanvas, [plotSeries], options);\r\n    }\r\n\r\n    function render() {\r\n      if (!ctrl.data) {\r\n        return;\r\n      }\r\n      const { data, panel } = ctrl;\r\n\r\n      // get thresholds\r\n      data.thresholds = panel.thresholds\r\n        ? panel.thresholds.split(',').map((strVale: string) => {\r\n            return Number(strVale.trim());\r\n          })\r\n        : [];\r\n\r\n      // Map panel colors to hex or rgb/a values\r\n      if (panel.colors) {\r\n        data.colorMap = panel.colors.map((color: string) => getColorFromHexRgbOrName(color, config.theme.type));\r\n      }\r\n\r\n      const body = panel.gauge.show ? '' : getBigValueHtml();\r\n\r\n      if (panel.colorBackground) {\r\n        const color = getColorForValue(data, data.display.numeric);\r\n        if (color) {\r\n          $panelContainer.css('background-color', color);\r\n          if (scope.fullscreen) {\r\n            elem.css('background-color', color);\r\n          } else {\r\n            elem.css('background-color', '');\r\n          }\r\n        } else {\r\n          $panelContainer.css('background-color', '');\r\n          elem.css('background-color', '');\r\n        }\r\n      } else {\r\n        $panelContainer.css('background-color', '');\r\n        elem.css('background-color', '');\r\n      }\r\n\r\n      elem.html(body);\r\n\r\n      if (panel.sparkline.show) {\r\n        addSparkline();\r\n      }\r\n\r\n      if (panel.gauge.show) {\r\n        addGauge();\r\n      }\r\n\r\n      elem.toggleClass('pointer', panel.links.length > 0);\r\n\r\n      if (panel.links.length > 0) {\r\n        linkInfo = linkSrv.getDataLinkUIModel(panel.links[0], data.scopedVars, {});\r\n      } else {\r\n        linkInfo = null;\r\n      }\r\n    }\r\n\r\n    function hookupDrilldownLinkTooltip() {\r\n      // drilldown link tooltip\r\n      const drilldownTooltip = $('<div id=\"tooltip\" class=\"\">hello</div>\"');\r\n\r\n      elem.mouseleave(() => {\r\n        if (panel.links.length === 0) {\r\n          return;\r\n        }\r\n        $timeout(() => {\r\n          drilldownTooltip.detach();\r\n        });\r\n      });\r\n\r\n      elem.click(evt => {\r\n        if (!linkInfo) {\r\n          return;\r\n        }\r\n        // ignore title clicks in title\r\n        if ($(evt).parents('.panel-header').length > 0) {\r\n          return;\r\n        }\r\n\r\n        if (linkInfo.target === '_blank') {\r\n          window.open(linkInfo.href, '_blank');\r\n          return;\r\n        }\r\n\r\n        if (linkInfo.href.indexOf('http') === 0) {\r\n          window.location.href = linkInfo.href;\r\n        } else {\r\n          $timeout(() => {\r\n            $location.url(linkInfo.href);\r\n          });\r\n        }\r\n\r\n        drilldownTooltip.detach();\r\n      });\r\n\r\n      elem.mousemove(e => {\r\n        if (!linkInfo) {\r\n          return;\r\n        }\r\n\r\n        drilldownTooltip.text('click to go to: ' + linkInfo.title);\r\n        drilldownTooltip.place_tt(e.pageX, e.pageY - 50);\r\n      });\r\n    }\r\n\r\n    hookupDrilldownLinkTooltip();\r\n\r\n    this.events.on(PanelEvents.render, () => {\r\n      render();\r\n      ctrl.renderingCompleted();\r\n    });\r\n  }\r\n}\r\n\r\nfunction getColorForValue(data: any, value: number) {\r\n  if (!_.isFinite(value)) {\r\n    return null;\r\n  }\r\n\r\n  for (let i = data.thresholds.length; i > 0; i--) {\r\n    if (value >= data.thresholds[i - 1]) {\r\n      return data.colorMap[i];\r\n    }\r\n  }\r\n\r\n  return _.first(data.colorMap);\r\n}\r\n\r\n//------------------------------------------------\r\n// Private utility functions\r\n// Somethign like this should be avaliable in a\r\n//  DataFrame[] abstraction helper\r\n//------------------------------------------------\r\n\r\ninterface FrameInfo {\r\n  firstTimeField?: Field;\r\n  frame: DataFrame;\r\n}\r\n\r\ninterface FieldInfo {\r\n  field: Field;\r\n  frame: FrameInfo;\r\n}\r\n\r\ninterface DistinctFieldsInfo {\r\n  first?: FieldInfo;\r\n  byName: KeyValue<FieldInfo>;\r\n  names: string[];\r\n}\r\n\r\nfunction getDistinctNames(data: DataFrame[]): DistinctFieldsInfo {\r\n  const distinct: DistinctFieldsInfo = {\r\n    byName: {},\r\n    names: [],\r\n  };\r\n  for (const frame of data) {\r\n    const info: FrameInfo = { frame };\r\n    for (const field of frame.fields) {\r\n      if (field.type === FieldType.time) {\r\n        if (!info.firstTimeField) {\r\n          info.firstTimeField = field;\r\n        }\r\n      } else {\r\n        const f = { field, frame: info };\r\n        if (!distinct.first) {\r\n          distinct.first = f;\r\n        }\r\n        let t = field.config.title;\r\n        if (t && !distinct.byName[t]) {\r\n          distinct.byName[t] = f;\r\n          distinct.names.push(t);\r\n        }\r\n        t = field.name;\r\n        if (t && !distinct.byName[t]) {\r\n          distinct.byName[t] = f;\r\n          distinct.names.push(t);\r\n        }\r\n      }\r\n    }\r\n  }\r\n  return distinct;\r\n}\r\n\r\nexport { SingleStatCtrl, SingleStatCtrl as PanelCtrl, getColorForValue };\r\n","// Libraries\r\nimport React, { PureComponent } from 'react';\r\n\r\n// Utils & Services\r\nimport { config } from 'app/core/config';\r\n\r\n// Types\r\nimport { StatPanelOptions } from './types';\r\nimport { VizRepeater, BigValue, DataLinksContextMenu, BigValueSparkline, BigValueGraphMode } from '@grafana/ui';\r\n\r\nimport {\r\n  PanelProps,\r\n  getFieldDisplayValues,\r\n  FieldDisplay,\r\n  ReducerID,\r\n  getDisplayValueAlignmentFactors,\r\n  DisplayValueAlignmentFactors,\r\n  VizOrientation,\r\n} from '@grafana/data';\r\n\r\nimport { getFieldLinksSupplier } from 'app/features/panel/panellinks/linkSuppliers';\r\n\r\nexport class StatPanel extends PureComponent<PanelProps<StatPanelOptions>> {\r\n  renderValue = (\r\n    value: FieldDisplay,\r\n    width: number,\r\n    height: number,\r\n    alignmentFactors: DisplayValueAlignmentFactors\r\n  ): JSX.Element => {\r\n    const { timeRange, options } = this.props;\r\n    let sparkline: BigValueSparkline | undefined;\r\n\r\n    if (value.sparkline) {\r\n      sparkline = {\r\n        data: value.sparkline,\r\n        xMin: timeRange.from.valueOf(),\r\n        xMax: timeRange.to.valueOf(),\r\n        yMin: value.field.min,\r\n        yMax: value.field.max,\r\n      };\r\n\r\n      const calc = options.fieldOptions.calcs[0];\r\n      if (calc === ReducerID.last) {\r\n        sparkline.highlightIndex = sparkline.data.length - 1;\r\n      }\r\n    }\r\n\r\n    return (\r\n      <DataLinksContextMenu links={getFieldLinksSupplier(value)}>\r\n        {({ openMenu, targetClassName }) => {\r\n          return (\r\n            <BigValue\r\n              value={value.display}\r\n              sparkline={sparkline}\r\n              colorMode={options.colorMode}\r\n              graphMode={options.graphMode}\r\n              justifyMode={options.justifyMode}\r\n              alignmentFactors={alignmentFactors}\r\n              width={width}\r\n              height={height}\r\n              theme={config.theme}\r\n              onClick={openMenu}\r\n              className={targetClassName}\r\n            />\r\n          );\r\n        }}\r\n      </DataLinksContextMenu>\r\n    );\r\n  };\r\n\r\n  getValues = (): FieldDisplay[] => {\r\n    const { data, options, replaceVariables } = this.props;\r\n\r\n    return getFieldDisplayValues({\r\n      ...options,\r\n      replaceVariables,\r\n      theme: config.theme,\r\n      data: data.series,\r\n      sparkline: options.graphMode !== BigValueGraphMode.None,\r\n      autoMinMax: true,\r\n    });\r\n  };\r\n\r\n  render() {\r\n    const { height, options, width, data, renderCounter } = this.props;\r\n\r\n    return (\r\n      <VizRepeater\r\n        getValues={this.getValues}\r\n        getAlignmentFactors={getDisplayValueAlignmentFactors}\r\n        renderValue={this.renderValue}\r\n        width={width}\r\n        height={height}\r\n        source={data}\r\n        renderCounter={renderCounter}\r\n        orientation={getOrientation(width, height, options.orientation)}\r\n      />\r\n    );\r\n  }\r\n}\r\n\r\n/**\r\n * Stat panel custom auto orientation\r\n */\r\nfunction getOrientation(width: number, height: number, orientation: VizOrientation): VizOrientation {\r\n  if (orientation !== VizOrientation.Auto) {\r\n    return orientation;\r\n  }\r\n\r\n  if (width / height > 2) {\r\n    return VizOrientation.Vertical;\r\n  } else {\r\n    return VizOrientation.Horizontal;\r\n  }\r\n}\r\n","// Libraries\r\nimport React, { PureComponent } from 'react';\r\n\r\nimport {\r\n  ThresholdsEditor,\r\n  PanelOptionsGrid,\r\n  ValueMappingsEditor,\r\n  FieldDisplayEditor,\r\n  FieldPropertiesEditor,\r\n  PanelOptionsGroup,\r\n  DataLinksEditor,\r\n  FormLabel,\r\n  Select,\r\n} from '@grafana/ui';\r\n\r\nimport {\r\n  ThresholdsConfig,\r\n  ValueMapping,\r\n  FieldConfig,\r\n  DataLink,\r\n  PanelEditorProps,\r\n  FieldDisplayOptions,\r\n} from '@grafana/data';\r\n\r\nimport { StatPanelOptions, colorModes, graphModes, justifyModes } from './types';\r\nimport { orientationOptions } from '../gauge/types';\r\n\r\nimport {\r\n  getDataLinksVariableSuggestions,\r\n  getCalculationValueDataLinksVariableSuggestions,\r\n} from 'app/features/panel/panellinks/link_srv';\r\nimport { config } from 'app/core/config';\r\n\r\nexport class StatPanelEditor extends PureComponent<PanelEditorProps<StatPanelOptions>> {\r\n  onThresholdsChanged = (thresholds: ThresholdsConfig) => {\r\n    const current = this.props.options.fieldOptions.defaults;\r\n    this.onDefaultsChange({\r\n      ...current,\r\n      thresholds,\r\n    });\r\n  };\r\n\r\n  onValueMappingsChanged = (mappings: ValueMapping[]) => {\r\n    const current = this.props.options.fieldOptions.defaults;\r\n    this.onDefaultsChange({\r\n      ...current,\r\n      mappings,\r\n    });\r\n  };\r\n\r\n  onDisplayOptionsChanged = (fieldOptions: FieldDisplayOptions) =>\r\n    this.props.onOptionsChange({\r\n      ...this.props.options,\r\n      fieldOptions,\r\n    });\r\n\r\n  onColorModeChanged = ({ value }: any) => this.props.onOptionsChange({ ...this.props.options, colorMode: value });\r\n  onGraphModeChanged = ({ value }: any) => this.props.onOptionsChange({ ...this.props.options, graphMode: value });\r\n  onJustifyModeChanged = ({ value }: any) => this.props.onOptionsChange({ ...this.props.options, justifyMode: value });\r\n  onOrientationChange = ({ value }: any) => this.props.onOptionsChange({ ...this.props.options, orientation: value });\r\n\r\n  onDefaultsChange = (field: FieldConfig) => {\r\n    this.onDisplayOptionsChanged({\r\n      ...this.props.options.fieldOptions,\r\n      defaults: field,\r\n    });\r\n  };\r\n\r\n  onDataLinksChanged = (links: DataLink[]) => {\r\n    this.onDefaultsChange({\r\n      ...this.props.options.fieldOptions.defaults,\r\n      links,\r\n    });\r\n  };\r\n\r\n  render() {\r\n    const { options } = this.props;\r\n    const { fieldOptions } = options;\r\n    const { defaults } = fieldOptions;\r\n    const suggestions = fieldOptions.values\r\n      ? getDataLinksVariableSuggestions(this.props.data.series)\r\n      : getCalculationValueDataLinksVariableSuggestions(this.props.data.series);\r\n\r\n    return (\r\n      <>\r\n        <PanelOptionsGrid>\r\n          <PanelOptionsGroup title=\"Display\">\r\n            <FieldDisplayEditor onChange={this.onDisplayOptionsChanged} value={fieldOptions} labelWidth={8} />\r\n            <div className=\"form-field\">\r\n              <FormLabel width={8}>Orientation</FormLabel>\r\n              <Select\r\n                width={12}\r\n                options={orientationOptions}\r\n                defaultValue={orientationOptions[0]}\r\n                onChange={this.onOrientationChange}\r\n                value={orientationOptions.find(item => item.value === options.orientation)}\r\n              />\r\n            </div>\r\n            <div className=\"form-field\">\r\n              <FormLabel width={8}>Color</FormLabel>\r\n              <Select\r\n                width={12}\r\n                options={colorModes}\r\n                defaultValue={colorModes[0]}\r\n                onChange={this.onColorModeChanged}\r\n                value={colorModes.find(item => item.value === options.colorMode)}\r\n              />\r\n            </div>\r\n            <div className=\"form-field\">\r\n              <FormLabel width={8}>Graph</FormLabel>\r\n              <Select\r\n                width={12}\r\n                options={graphModes}\r\n                defaultValue={graphModes[0]}\r\n                onChange={this.onGraphModeChanged}\r\n                value={graphModes.find(item => item.value === options.graphMode)}\r\n              />\r\n            </div>\r\n            <div className=\"form-field\">\r\n              <FormLabel width={8}>Justify</FormLabel>\r\n              <Select\r\n                width={12}\r\n                options={justifyModes}\r\n                defaultValue={justifyModes[0]}\r\n                onChange={this.onJustifyModeChanged}\r\n                value={justifyModes.find(item => item.value === options.justifyMode)}\r\n              />\r\n            </div>\r\n          </PanelOptionsGroup>\r\n\r\n          <PanelOptionsGroup title=\"Field\">\r\n            <FieldPropertiesEditor\r\n              showMinMax={true}\r\n              onChange={this.onDefaultsChange}\r\n              value={defaults}\r\n              showTitle={true}\r\n            />\r\n          </PanelOptionsGroup>\r\n\r\n          <ThresholdsEditor\r\n            onChange={this.onThresholdsChanged}\r\n            thresholds={defaults.thresholds}\r\n            theme={config.theme}\r\n            showAlphaUI={config.featureToggles.newEdit}\r\n          />\r\n        </PanelOptionsGrid>\r\n\r\n        <ValueMappingsEditor onChange={this.onValueMappingsChanged} valueMappings={defaults.mappings} />\r\n\r\n        <PanelOptionsGroup title=\"Data links\">\r\n          <DataLinksEditor\r\n            value={defaults.links}\r\n            onChange={this.onDataLinksChanged}\r\n            suggestions={suggestions}\r\n            maxLinks={10}\r\n          />\r\n        </PanelOptionsGroup>\r\n      </>\r\n    );\r\n  }\r\n}\r\n","import { sharedSingleStatMigrationHandler, sharedSingleStatPanelChangedHandler } from '@grafana/ui';\r\nimport { PanelPlugin } from '@grafana/data';\r\nimport { StatPanelOptions, defaults } from './types';\r\nimport { StatPanel } from './StatPanel';\r\nimport { StatPanelEditor } from './StatPanelEditor';\r\n\r\nexport const plugin = new PanelPlugin<StatPanelOptions>(StatPanel)\r\n  .setDefaults(defaults)\r\n  .setEditor(StatPanelEditor)\r\n  .setNoPadding()\r\n  .setPanelChangeHandler(sharedSingleStatPanelChangedHandler)\r\n  .setMigrationHandler(sharedSingleStatMigrationHandler);\r\n","import { SingleStatBaseOptions, BigValueColorMode, BigValueGraphMode, BigValueJustifyMode } from '@grafana/ui';\r\nimport { VizOrientation, ReducerID, FieldDisplayOptions, SelectableValue, ThresholdsMode } from '@grafana/data';\r\n\r\n// Structure copied from angular\r\nexport interface StatPanelOptions extends SingleStatBaseOptions {\r\n  graphMode: BigValueGraphMode;\r\n  colorMode: BigValueColorMode;\r\n  justifyMode: BigValueJustifyMode;\r\n}\r\n\r\nexport const colorModes: Array<SelectableValue<BigValueColorMode>> = [\r\n  { value: BigValueColorMode.Value, label: 'Value' },\r\n  { value: BigValueColorMode.Background, label: 'Background' },\r\n];\r\n\r\nexport const graphModes: Array<SelectableValue<BigValueGraphMode>> = [\r\n  { value: BigValueGraphMode.None, label: 'None' },\r\n  { value: BigValueGraphMode.Area, label: 'Area graph' },\r\n];\r\n\r\nexport const justifyModes: Array<SelectableValue<BigValueJustifyMode>> = [\r\n  { value: BigValueJustifyMode.Auto, label: 'Auto' },\r\n  { value: BigValueJustifyMode.Center, label: 'Center' },\r\n];\r\n\r\nexport const standardFieldDisplayOptions: FieldDisplayOptions = {\r\n  values: false,\r\n  calcs: [ReducerID.mean],\r\n  defaults: {\r\n    thresholds: {\r\n      mode: ThresholdsMode.Absolute,\r\n      steps: [\r\n        { value: -Infinity, color: 'green' },\r\n        { value: 80, color: 'red' }, // 80%\r\n      ],\r\n    },\r\n    mappings: [],\r\n  },\r\n  overrides: [],\r\n};\r\n\r\nexport const defaults: StatPanelOptions = {\r\n  graphMode: BigValueGraphMode.Area,\r\n  colorMode: BigValueColorMode.Value,\r\n  justifyMode: BigValueJustifyMode.Auto,\r\n  fieldOptions: standardFieldDisplayOptions,\r\n  orientation: VizOrientation.Auto,\r\n};\r\n","import _ from 'lodash';\r\nimport { getValueFormats } from '@grafana/data';\r\n\r\nexport class ColumnOptionsCtrl {\r\n  panel: any;\r\n  panelCtrl: any;\r\n  colorModes: any;\r\n  columnStyles: any;\r\n  columnTypes: any;\r\n  fontSizes: any;\r\n  dateFormats: any;\r\n  addColumnSegment: any;\r\n  unitFormats: any;\r\n  getColumnNames: any;\r\n  activeStyleIndex: number;\r\n  mappingTypes: any;\r\n\r\n  alignTypes: any;\r\n  static readonly alignTypesEnum = [\r\n    { text: 'auto', value: '' },\r\n    { text: 'left', value: 'left' },\r\n    { text: 'center', value: 'center' },\r\n    { text: 'right', value: 'right' },\r\n  ];\r\n\r\n  /** @ngInject */\r\n  constructor($scope: any) {\r\n    $scope.editor = this;\r\n\r\n    this.activeStyleIndex = 0;\r\n    this.panelCtrl = $scope.ctrl;\r\n    this.panel = this.panelCtrl.panel;\r\n    this.unitFormats = getValueFormats();\r\n    this.colorModes = [\r\n      { text: 'Disabled', value: null },\r\n      { text: 'Cell', value: 'cell' },\r\n      { text: 'Value', value: 'value' },\r\n      { text: 'Row', value: 'row' },\r\n    ];\r\n    this.columnTypes = [\r\n      { text: 'Number', value: 'number' },\r\n      { text: 'String', value: 'string' },\r\n      { text: 'Date', value: 'date' },\r\n      { text: 'Hidden', value: 'hidden' },\r\n    ];\r\n    this.fontSizes = ['80%', '90%', '100%', '110%', '120%', '130%', '150%', '160%', '180%', '200%', '220%', '250%'];\r\n    this.dateFormats = [\r\n      { text: 'YYYY-MM-DD HH:mm:ss', value: 'YYYY-MM-DD HH:mm:ss' },\r\n      { text: 'YYYY-MM-DD HH:mm:ss.SSS', value: 'YYYY-MM-DD HH:mm:ss.SSS' },\r\n      { text: 'MM/DD/YY h:mm:ss a', value: 'MM/DD/YY h:mm:ss a' },\r\n      { text: 'MMMM D, YYYY LT', value: 'MMMM D, YYYY LT' },\r\n      { text: 'YYYY-MM-DD', value: 'YYYY-MM-DD' },\r\n    ];\r\n    this.mappingTypes = [\r\n      { text: 'Value to text', value: 1 },\r\n      { text: 'Range to text', value: 2 },\r\n    ];\r\n    this.alignTypes = ColumnOptionsCtrl.alignTypesEnum;\r\n\r\n    this.getColumnNames = () => {\r\n      if (!this.panelCtrl.table) {\r\n        return [];\r\n      }\r\n      return _.map(this.panelCtrl.table.columns, (col: any) => {\r\n        return col.text;\r\n      });\r\n    };\r\n\r\n    this.onColorChange = this.onColorChange.bind(this);\r\n  }\r\n\r\n  render() {\r\n    this.panelCtrl.render();\r\n  }\r\n\r\n  setUnitFormat(column: any, subItem: any) {\r\n    column.unit = subItem.value;\r\n    this.panelCtrl.render();\r\n  }\r\n\r\n  addColumnStyle() {\r\n    const newStyleRule: object = {\r\n      unit: 'short',\r\n      type: 'number',\r\n      alias: '',\r\n      decimals: 2,\r\n      colors: ['rgba(245, 54, 54, 0.9)', 'rgba(237, 129, 40, 0.89)', 'rgba(50, 172, 45, 0.97)'],\r\n      colorMode: null,\r\n      pattern: '',\r\n      dateFormat: 'YYYY-MM-DD HH:mm:ss',\r\n      thresholds: [],\r\n      mappingType: 1,\r\n      align: 'auto',\r\n    };\r\n\r\n    const styles = this.panel.styles;\r\n    const stylesCount = styles.length;\r\n    let indexToInsert = stylesCount;\r\n\r\n    // check if last is a catch all rule, then add it before that one\r\n    if (stylesCount > 0) {\r\n      const last = styles[stylesCount - 1];\r\n      if (last.pattern === '/.*/') {\r\n        indexToInsert = stylesCount - 1;\r\n      }\r\n    }\r\n\r\n    styles.splice(indexToInsert, 0, newStyleRule);\r\n    this.activeStyleIndex = indexToInsert;\r\n  }\r\n\r\n  removeColumnStyle(style: any) {\r\n    this.panel.styles = _.without(this.panel.styles, style);\r\n  }\r\n\r\n  invertColorOrder(index: number) {\r\n    const ref = this.panel.styles[index].colors;\r\n    const copy = ref[0];\r\n    ref[0] = ref[2];\r\n    ref[2] = copy;\r\n    this.panelCtrl.render();\r\n  }\r\n\r\n  onColorChange(style: any, colorIndex: number) {\r\n    return (newColor: string) => {\r\n      style.colors[colorIndex] = newColor;\r\n      this.render();\r\n    };\r\n  }\r\n\r\n  addValueMap(style: any) {\r\n    if (!style.valueMaps) {\r\n      style.valueMaps = [];\r\n    }\r\n    style.valueMaps.push({ value: '', text: '' });\r\n    this.panelCtrl.render();\r\n  }\r\n\r\n  removeValueMap(style: any, index: number) {\r\n    style.valueMaps.splice(index, 1);\r\n    this.panelCtrl.render();\r\n  }\r\n\r\n  addRangeMap(style: any) {\r\n    if (!style.rangeMaps) {\r\n      style.rangeMaps = [];\r\n    }\r\n    style.rangeMaps.push({ from: '', to: '', text: '' });\r\n    this.panelCtrl.render();\r\n  }\r\n\r\n  removeRangeMap(style: any, index: number) {\r\n    style.rangeMaps.splice(index, 1);\r\n    this.panelCtrl.render();\r\n  }\r\n}\r\n\r\nexport function columnOptionsTab(uiSegmentSrv: any) {\r\n  'use strict';\r\n  return {\r\n    restrict: 'E',\r\n    scope: true,\r\n    templateUrl: 'public/app/plugins/panel/table/column_options.html',\r\n    controller: ColumnOptionsCtrl,\r\n  };\r\n}\r\n","import _ from 'lodash';\r\nimport { transformers } from './transformers';\r\nimport { ColumnStyle } from './types';\r\n\r\nexport class TablePanelEditorCtrl {\r\n  panel: any;\r\n  panelCtrl: any;\r\n  transformers: any;\r\n  fontSizes: any;\r\n  addColumnSegment: any;\r\n  getColumnNames: any;\r\n  canSetColumns: boolean;\r\n  columnsHelpMessage: string;\r\n\r\n  /** @ngInject */\r\n  constructor($scope: any, private uiSegmentSrv: any) {\r\n    $scope.editor = this;\r\n    this.panelCtrl = $scope.ctrl;\r\n    this.panel = this.panelCtrl.panel;\r\n    this.transformers = transformers;\r\n    this.fontSizes = ['80%', '90%', '100%', '110%', '120%', '130%', '150%', '160%', '180%', '200%', '220%', '250%'];\r\n    this.addColumnSegment = uiSegmentSrv.newPlusButton();\r\n    this.updateTransformHints();\r\n  }\r\n\r\n  updateTransformHints() {\r\n    this.canSetColumns = false;\r\n    this.columnsHelpMessage = '';\r\n\r\n    switch (this.panel.transform) {\r\n      case 'timeseries_aggregations': {\r\n        this.canSetColumns = true;\r\n        break;\r\n      }\r\n      case 'json': {\r\n        this.canSetColumns = true;\r\n        break;\r\n      }\r\n      case 'table': {\r\n        this.columnsHelpMessage = 'Columns and their order are determined by the data query';\r\n      }\r\n    }\r\n  }\r\n\r\n  getColumnOptions() {\r\n    if (!this.panelCtrl.dataRaw) {\r\n      return Promise.resolve([]);\r\n    }\r\n    const columns = this.transformers[this.panel.transform].getColumns(this.panelCtrl.dataRaw);\r\n    const segments = _.map(columns, (c: any) => this.uiSegmentSrv.newSegment({ value: c.text }));\r\n    return Promise.resolve(segments);\r\n  }\r\n\r\n  addColumn() {\r\n    const columns = transformers[this.panel.transform].getColumns(this.panelCtrl.dataRaw);\r\n    const column: any = _.find(columns, { text: this.addColumnSegment.value });\r\n\r\n    if (column) {\r\n      this.panel.columns.push(column);\r\n      this.render();\r\n    }\r\n\r\n    const plusButton = this.uiSegmentSrv.newPlusButton();\r\n    this.addColumnSegment.html = plusButton.html;\r\n    this.addColumnSegment.value = plusButton.value;\r\n  }\r\n\r\n  transformChanged() {\r\n    this.panel.columns = [];\r\n    if (this.panel.transform === 'timeseries_aggregations') {\r\n      this.panel.columns.push({ text: 'Avg', value: 'avg' });\r\n    }\r\n\r\n    this.updateTransformHints();\r\n    this.render();\r\n  }\r\n\r\n  render() {\r\n    this.panelCtrl.render();\r\n  }\r\n\r\n  removeColumn(column: ColumnStyle) {\r\n    this.panel.columns = _.without(this.panel.columns, column);\r\n    this.panelCtrl.render();\r\n  }\r\n}\r\n\r\nexport function tablePanelEditor(uiSegmentSrv: any) {\r\n  'use strict';\r\n  return {\r\n    restrict: 'E',\r\n    scope: true,\r\n    templateUrl: 'public/app/plugins/panel/table/editor.html',\r\n    controller: TablePanelEditorCtrl,\r\n  };\r\n}\r\n","import _ from 'lodash';\r\nimport $ from 'jquery';\r\nimport { MetricsPanelCtrl } from 'app/plugins/sdk';\r\nimport config from 'app/core/config';\r\nimport { transformDataToTable } from './transformers';\r\nimport { tablePanelEditor } from './editor';\r\nimport { columnOptionsTab } from './column_options';\r\nimport { TableRenderer } from './renderer';\r\nimport { isTableData } from '@grafana/data';\r\nimport { TemplateSrv } from 'app/features/templating/template_srv';\r\nimport { PanelEvents } from '@grafana/data';\r\nimport { CoreEvents } from 'app/types';\r\n\r\nclass TablePanelCtrl extends MetricsPanelCtrl {\r\n  static templateUrl = 'module.html';\r\n\r\n  pageIndex: number;\r\n  dataRaw: any;\r\n  table: any;\r\n  renderer: any;\r\n\r\n  panelDefaults: any = {\r\n    targets: [{}],\r\n    transform: 'timeseries_to_columns',\r\n    pageSize: null,\r\n    showHeader: true,\r\n    styles: [\r\n      {\r\n        type: 'date',\r\n        pattern: 'Time',\r\n        alias: 'Time',\r\n        dateFormat: 'YYYY-MM-DD HH:mm:ss',\r\n        align: 'auto',\r\n      },\r\n      {\r\n        unit: 'short',\r\n        type: 'number',\r\n        alias: '',\r\n        decimals: 2,\r\n        colors: ['rgba(245, 54, 54, 0.9)', 'rgba(237, 129, 40, 0.89)', 'rgba(50, 172, 45, 0.97)'],\r\n        colorMode: null,\r\n        pattern: '/.*/',\r\n        thresholds: [],\r\n        align: 'right',\r\n      },\r\n    ],\r\n    columns: [],\r\n\r\n    fontSize: '100%',\r\n    sort: { col: 0, desc: true },\r\n  };\r\n\r\n  /** @ngInject */\r\n  constructor(\r\n    $scope: any,\r\n    $injector: any,\r\n    templateSrv: TemplateSrv,\r\n    private annotationsSrv: any,\r\n    private $sanitize: any,\r\n    private variableSrv: any\r\n  ) {\r\n    super($scope, $injector);\r\n\r\n    this.pageIndex = 0;\r\n\r\n    if (this.panel.styles === void 0) {\r\n      this.panel.styles = this.panel.columns;\r\n      this.panel.columns = this.panel.fields;\r\n      delete this.panel.columns;\r\n      delete this.panel.fields;\r\n    }\r\n\r\n    _.defaults(this.panel, this.panelDefaults);\r\n\r\n    this.events.on(PanelEvents.dataReceived, this.onDataReceived.bind(this));\r\n    this.events.on(PanelEvents.dataSnapshotLoad, this.onDataReceived.bind(this));\r\n    this.events.on(PanelEvents.editModeInitialized, this.onInitEditMode.bind(this));\r\n    this.events.on(PanelEvents.initPanelActions, this.onInitPanelActions.bind(this));\r\n  }\r\n\r\n  onInitEditMode() {\r\n    this.addEditorTab('Options', tablePanelEditor, 2);\r\n    this.addEditorTab('Column Styles', columnOptionsTab, 3);\r\n  }\r\n\r\n  onInitPanelActions(actions: any[]) {\r\n    actions.push({ text: 'Export CSV', click: 'ctrl.exportCsv()' });\r\n  }\r\n\r\n  issueQueries(datasource: any) {\r\n    this.pageIndex = 0;\r\n\r\n    if (this.panel.transform === 'annotations') {\r\n      return this.annotationsSrv\r\n        .getAnnotations({\r\n          dashboard: this.dashboard,\r\n          panel: this.panel,\r\n          range: this.range,\r\n        })\r\n        .then((anno: any) => {\r\n          this.loading = false;\r\n          this.dataRaw = anno;\r\n          this.pageIndex = 0;\r\n          this.render();\r\n          return { data: this.dataRaw }; // Not used\r\n        });\r\n    }\r\n\r\n    return super.issueQueries(datasource);\r\n  }\r\n\r\n  onDataReceived(dataList: any) {\r\n    this.dataRaw = dataList;\r\n    this.pageIndex = 0;\r\n\r\n    // automatically correct transform mode based on data\r\n    if (this.dataRaw && this.dataRaw.length) {\r\n      if (isTableData(this.dataRaw[0])) {\r\n        this.panel.transform = 'table';\r\n      } else {\r\n        if (this.dataRaw[0].type === 'docs') {\r\n          this.panel.transform = 'json';\r\n        } else {\r\n          if (this.panel.transform === 'table' || this.panel.transform === 'json') {\r\n            this.panel.transform = 'timeseries_to_rows';\r\n          }\r\n        }\r\n      }\r\n    }\r\n\r\n    this.render();\r\n  }\r\n\r\n  render() {\r\n    this.table = transformDataToTable(this.dataRaw, this.panel);\r\n    this.table.sort(this.panel.sort);\r\n\r\n    this.renderer = new TableRenderer(\r\n      this.panel,\r\n      this.table,\r\n      this.dashboard.isTimezoneUtc(),\r\n      this.$sanitize,\r\n      this.templateSrv,\r\n      config.theme.type\r\n    );\r\n\r\n    return super.render(this.table);\r\n  }\r\n\r\n  toggleColumnSort(col: any, colIndex: any) {\r\n    // remove sort flag from current column\r\n    if (this.table.columns[this.panel.sort.col]) {\r\n      this.table.columns[this.panel.sort.col].sort = false;\r\n    }\r\n\r\n    if (this.panel.sort.col === colIndex) {\r\n      if (this.panel.sort.desc) {\r\n        this.panel.sort.desc = false;\r\n      } else {\r\n        this.panel.sort.col = null;\r\n      }\r\n    } else {\r\n      this.panel.sort.col = colIndex;\r\n      this.panel.sort.desc = true;\r\n    }\r\n    this.render();\r\n  }\r\n\r\n  exportCsv() {\r\n    const scope = this.$scope.$new(true);\r\n    scope.tableData = this.renderer.render_values();\r\n    scope.panel = 'table';\r\n    this.publishAppEvent(CoreEvents.showModal, {\r\n      templateHtml: '<export-data-modal panel=\"panel\" data=\"tableData\"></export-data-modal>',\r\n      scope,\r\n      modalClass: 'modal--narrow',\r\n    });\r\n  }\r\n\r\n  link(scope: any, elem: JQuery, attrs: any, ctrl: TablePanelCtrl) {\r\n    let data: any;\r\n    const panel = ctrl.panel;\r\n    let pageCount = 0;\r\n\r\n    function getTableHeight() {\r\n      let panelHeight = ctrl.height;\r\n\r\n      if (pageCount > 1) {\r\n        panelHeight -= 26;\r\n      }\r\n\r\n      return panelHeight - 31 + 'px';\r\n    }\r\n\r\n    function appendTableRows(tbodyElem: JQuery) {\r\n      ctrl.renderer.setTable(data);\r\n      tbodyElem.empty();\r\n      tbodyElem.html(ctrl.renderer.render(ctrl.pageIndex));\r\n    }\r\n\r\n    function switchPage(e: any) {\r\n      const el = $(e.currentTarget);\r\n      ctrl.pageIndex = parseInt(el.text(), 10) - 1;\r\n      renderPanel();\r\n    }\r\n\r\n    function appendPaginationControls(footerElem: JQuery) {\r\n      footerElem.empty();\r\n\r\n      const pageSize = panel.pageSize || 100;\r\n      pageCount = Math.ceil(data.rows.length / pageSize);\r\n      if (pageCount === 1) {\r\n        return;\r\n      }\r\n\r\n      const startPage = Math.max(ctrl.pageIndex - 3, 0);\r\n      const endPage = Math.min(pageCount, startPage + 9);\r\n\r\n      const paginationList = $('<ul></ul>');\r\n\r\n      for (let i = startPage; i < endPage; i++) {\r\n        const activeClass = i === ctrl.pageIndex ? 'active' : '';\r\n        const pageLinkElem = $(\r\n          '<li><a class=\"table-panel-page-link pointer ' + activeClass + '\">' + (i + 1) + '</a></li>'\r\n        );\r\n        paginationList.append(pageLinkElem);\r\n      }\r\n\r\n      footerElem.append(paginationList);\r\n    }\r\n\r\n    function renderPanel() {\r\n      const panelElem = elem.parents('.panel-content');\r\n      const rootElem = elem.find('.table-panel-scroll');\r\n      const tbodyElem = elem.find('tbody');\r\n      const footerElem = elem.find('.table-panel-footer');\r\n\r\n      elem.css({ 'font-size': panel.fontSize });\r\n      panelElem.addClass('table-panel-content');\r\n\r\n      appendTableRows(tbodyElem);\r\n      appendPaginationControls(footerElem);\r\n\r\n      rootElem.css({ 'max-height': getTableHeight() });\r\n    }\r\n\r\n    // hook up link tooltips\r\n    elem.tooltip({\r\n      selector: '[data-link-tooltip]',\r\n    });\r\n\r\n    function addFilterClicked(e: any) {\r\n      const filterData = $(e.currentTarget).data();\r\n      const options = {\r\n        datasource: panel.datasource,\r\n        key: data.columns[filterData.column].text,\r\n        value: data.rows[filterData.row][filterData.column],\r\n        operator: filterData.operator,\r\n      };\r\n\r\n      ctrl.variableSrv.setAdhocFilter(options);\r\n    }\r\n\r\n    elem.on('click', '.table-panel-page-link', switchPage);\r\n    elem.on('click', '.table-panel-filter-link', addFilterClicked);\r\n\r\n    const unbindDestroy = scope.$on('$destroy', () => {\r\n      elem.off('click', '.table-panel-page-link');\r\n      elem.off('click', '.table-panel-filter-link');\r\n      unbindDestroy();\r\n    });\r\n\r\n    ctrl.events.on(PanelEvents.render, (renderData: any) => {\r\n      data = renderData || data;\r\n      if (data) {\r\n        renderPanel();\r\n      }\r\n      ctrl.renderingCompleted();\r\n    });\r\n  }\r\n}\r\n\r\nexport { TablePanelCtrl, TablePanelCtrl as PanelCtrl };\r\n","import _ from 'lodash';\r\nimport {\r\n  dateTime,\r\n  escapeStringForRegex,\r\n  formattedValueToString,\r\n  getColorFromHexRgbOrName,\r\n  getValueFormat,\r\n  GrafanaThemeType,\r\n  ScopedVars,\r\n  stringStartsAsRegEx,\r\n  stringToJsRegex,\r\n  unEscapeStringFromRegex,\r\n} from '@grafana/data';\r\nimport { TemplateSrv } from 'app/features/templating/template_srv';\r\nimport { ColumnRender, TableRenderModel, ColumnStyle } from './types';\r\nimport { ColumnOptionsCtrl } from './column_options';\r\nimport { sanitizeUrl } from 'app/core/utils/text';\r\n\r\nexport class TableRenderer {\r\n  formatters: any[];\r\n  colorState: any;\r\n\r\n  constructor(\r\n    private panel: { styles: ColumnStyle[]; pageSize: number },\r\n    private table: TableRenderModel,\r\n    private isUtc: boolean,\r\n    private sanitize: (v: any) => any,\r\n    private templateSrv: TemplateSrv,\r\n    private theme?: GrafanaThemeType\r\n  ) {\r\n    this.initColumns();\r\n  }\r\n\r\n  setTable(table: TableRenderModel) {\r\n    this.table = table;\r\n\r\n    this.initColumns();\r\n  }\r\n\r\n  initColumns() {\r\n    this.formatters = [];\r\n    this.colorState = {};\r\n\r\n    for (let colIndex = 0; colIndex < this.table.columns.length; colIndex++) {\r\n      const column = this.table.columns[colIndex];\r\n      column.title = column.text;\r\n\r\n      for (let i = 0; i < this.panel.styles.length; i++) {\r\n        const style = this.panel.styles[i];\r\n\r\n        const escapedPattern = stringStartsAsRegEx(style.pattern)\r\n          ? style.pattern\r\n          : escapeStringForRegex(unEscapeStringFromRegex(style.pattern));\r\n        const regex = stringToJsRegex(escapedPattern);\r\n        if (column.text.match(regex)) {\r\n          column.style = style;\r\n\r\n          if (style.alias) {\r\n            column.title = column.text.replace(regex, style.alias);\r\n          }\r\n\r\n          break;\r\n        }\r\n      }\r\n\r\n      this.formatters[colIndex] = this.createColumnFormatter(column);\r\n    }\r\n  }\r\n\r\n  getColorForValue(value: number, style: ColumnStyle) {\r\n    if (!style.thresholds || !style.colors) {\r\n      return null;\r\n    }\r\n    for (let i = style.thresholds.length; i > 0; i--) {\r\n      if (value >= style.thresholds[i - 1]) {\r\n        return getColorFromHexRgbOrName(style.colors[i], this.theme);\r\n      }\r\n    }\r\n    return getColorFromHexRgbOrName(_.first(style.colors), this.theme);\r\n  }\r\n\r\n  defaultCellFormatter(v: any, style: ColumnStyle) {\r\n    if (v === null || v === void 0 || v === undefined) {\r\n      return '';\r\n    }\r\n\r\n    if (_.isArray(v)) {\r\n      v = v.join(', ');\r\n    }\r\n\r\n    if (style && style.sanitize) {\r\n      return this.sanitize(v);\r\n    } else {\r\n      return _.escape(v);\r\n    }\r\n  }\r\n\r\n  createColumnFormatter(column: ColumnRender) {\r\n    if (!column.style) {\r\n      return this.defaultCellFormatter;\r\n    }\r\n\r\n    if (column.style.type === 'hidden') {\r\n      return (v: any): undefined => undefined;\r\n    }\r\n\r\n    if (column.style.type === 'date') {\r\n      return (v: any) => {\r\n        if (v === undefined || v === null) {\r\n          return '-';\r\n        }\r\n\r\n        if (_.isArray(v)) {\r\n          v = v[0];\r\n        }\r\n\r\n        // if is an epoch (numeric string and len > 12)\r\n        if (_.isString(v) && !isNaN(v as any) && v.length > 12) {\r\n          v = parseInt(v, 10);\r\n        }\r\n\r\n        let date = dateTime(v);\r\n\r\n        if (this.isUtc) {\r\n          date = date.utc();\r\n        }\r\n\r\n        return date.format(column.style.dateFormat);\r\n      };\r\n    }\r\n\r\n    if (column.style.type === 'string') {\r\n      return (v: any): any => {\r\n        if (_.isArray(v)) {\r\n          v = v.join(', ');\r\n        }\r\n\r\n        const mappingType = column.style.mappingType || 0;\r\n\r\n        if (mappingType === 1 && column.style.valueMaps) {\r\n          for (let i = 0; i < column.style.valueMaps.length; i++) {\r\n            const map = column.style.valueMaps[i];\r\n\r\n            if (v === null) {\r\n              if (map.value === 'null') {\r\n                return map.text;\r\n              }\r\n              continue;\r\n            }\r\n\r\n            // Allow both numeric and string values to be mapped\r\n            if ((!_.isString(v) && Number(map.value) === Number(v)) || map.value === v) {\r\n              this.setColorState(v, column.style);\r\n              return this.defaultCellFormatter(map.text, column.style);\r\n            }\r\n          }\r\n        }\r\n\r\n        if (mappingType === 2 && column.style.rangeMaps) {\r\n          for (let i = 0; i < column.style.rangeMaps.length; i++) {\r\n            const map = column.style.rangeMaps[i];\r\n\r\n            if (v === null) {\r\n              if (map.from === 'null' && map.to === 'null') {\r\n                return map.text;\r\n              }\r\n              continue;\r\n            }\r\n\r\n            if (Number(map.from) <= Number(v) && Number(map.to) >= Number(v)) {\r\n              this.setColorState(v, column.style);\r\n              return this.defaultCellFormatter(map.text, column.style);\r\n            }\r\n          }\r\n        }\r\n\r\n        if (v === null || v === void 0) {\r\n          return '-';\r\n        }\r\n\r\n        this.setColorState(v, column.style);\r\n        return this.defaultCellFormatter(v, column.style);\r\n      };\r\n    }\r\n\r\n    if (column.style.type === 'number') {\r\n      const valueFormatter = getValueFormat(column.unit || column.style.unit);\r\n\r\n      return (v: any): any => {\r\n        if (v === null || v === void 0) {\r\n          return '-';\r\n        }\r\n\r\n        if (isNaN(v) || _.isArray(v)) {\r\n          return this.defaultCellFormatter(v, column.style);\r\n        }\r\n\r\n        this.setColorState(v, column.style);\r\n        return formattedValueToString(valueFormatter(v, column.style.decimals, null));\r\n      };\r\n    }\r\n\r\n    return (value: any) => {\r\n      return this.defaultCellFormatter(value, column.style);\r\n    };\r\n  }\r\n\r\n  setColorState(value: any, style: ColumnStyle) {\r\n    if (!style.colorMode) {\r\n      return;\r\n    }\r\n\r\n    if (value === null || value === void 0 || _.isArray(value)) {\r\n      return;\r\n    }\r\n\r\n    const numericValue = Number(value);\r\n    if (isNaN(numericValue)) {\r\n      return;\r\n    }\r\n\r\n    this.colorState[style.colorMode] = this.getColorForValue(numericValue, style);\r\n  }\r\n\r\n  renderRowVariables(rowIndex: number) {\r\n    const scopedVars: ScopedVars = {};\r\n    let cellVariable;\r\n    const row = this.table.rows[rowIndex];\r\n    for (let i = 0; i < row.length; i++) {\r\n      cellVariable = `__cell_${i}`;\r\n      scopedVars[cellVariable] = { value: row[i], text: row[i] ? row[i].toString() : '' };\r\n    }\r\n    return scopedVars;\r\n  }\r\n\r\n  formatColumnValue(colIndex: number, value: any) {\r\n    const fmt = this.formatters[colIndex];\r\n    if (fmt) {\r\n      return fmt(value);\r\n    }\r\n    return value;\r\n  }\r\n\r\n  renderCell(columnIndex: number, rowIndex: number, value: any, addWidthHack = false) {\r\n    value = this.formatColumnValue(columnIndex, value);\r\n\r\n    const column = this.table.columns[columnIndex];\r\n    const cellStyles = [];\r\n    let cellStyle = '';\r\n    const cellClasses = [];\r\n    let cellClass = '';\r\n\r\n    if (this.colorState.cell) {\r\n      cellStyles.push('background-color:' + this.colorState.cell);\r\n      cellClasses.push('table-panel-color-cell');\r\n      this.colorState.cell = null;\r\n    } else if (this.colorState.value) {\r\n      cellStyles.push('color:' + this.colorState.value);\r\n      this.colorState.value = null;\r\n    }\r\n    // because of the fixed table headers css only solution\r\n    // there is an issue if header cell is wider the cell\r\n    // this hack adds header content to cell (not visible)\r\n    let columnHtml = '';\r\n    if (addWidthHack) {\r\n      columnHtml = '<div class=\"table-panel-width-hack\">' + this.table.columns[columnIndex].title + '</div>';\r\n    }\r\n\r\n    if (value === undefined) {\r\n      cellStyles.push('display:none');\r\n      column.hidden = true;\r\n    } else {\r\n      column.hidden = false;\r\n    }\r\n\r\n    if (column.hidden === true) {\r\n      return '';\r\n    }\r\n\r\n    if (column.style && column.style.preserveFormat) {\r\n      cellClasses.push('table-panel-cell-pre');\r\n    }\r\n\r\n    if (column.style && column.style.align) {\r\n      const textAlign = _.find(ColumnOptionsCtrl.alignTypesEnum, ['text', column.style.align]);\r\n      if (textAlign && textAlign['value']) {\r\n        cellStyles.push(`text-align:${textAlign['value']}`);\r\n      }\r\n    }\r\n\r\n    if (cellStyles.length) {\r\n      cellStyle = ' style=\"' + cellStyles.join(';') + '\"';\r\n    }\r\n\r\n    if (column.style && column.style.link) {\r\n      // Render cell as link\r\n      const scopedVars = this.renderRowVariables(rowIndex);\r\n      scopedVars['__cell'] = { value: value, text: value ? value.toString() : '' };\r\n\r\n      const cellLink = this.templateSrv.replace(column.style.linkUrl, scopedVars, encodeURIComponent);\r\n      const sanitizedCellLink = sanitizeUrl(cellLink);\r\n\r\n      const cellLinkTooltip = this.templateSrv.replace(column.style.linkTooltip, scopedVars);\r\n      const cellTarget = column.style.linkTargetBlank ? '_blank' : '';\r\n\r\n      cellClasses.push('table-panel-cell-link');\r\n\r\n      columnHtml += `\r\n        <a href=\"${sanitizedCellLink}\" target=\"${cellTarget}\" data-link-tooltip data-original-title=\"${cellLinkTooltip}\" data-placement=\"right\"${cellStyle}>\r\n          ${value}\r\n        </a>\r\n      `;\r\n    } else {\r\n      columnHtml += value;\r\n    }\r\n\r\n    if (column.filterable) {\r\n      cellClasses.push('table-panel-cell-filterable');\r\n      columnHtml += `\r\n        <a class=\"table-panel-filter-link\" data-link-tooltip data-original-title=\"Filter out value\" data-placement=\"bottom\"\r\n           data-row=\"${rowIndex}\" data-column=\"${columnIndex}\" data-operator=\"!=\">\r\n          <i class=\"fa fa-search-minus\"></i>\r\n        </a>\r\n        <a class=\"table-panel-filter-link\" data-link-tooltip data-original-title=\"Filter for value\" data-placement=\"bottom\"\r\n           data-row=\"${rowIndex}\" data-column=\"${columnIndex}\" data-operator=\"=\">\r\n          <i class=\"fa fa-search-plus\"></i>\r\n        </a>`;\r\n    }\r\n\r\n    if (cellClasses.length) {\r\n      cellClass = ' class=\"' + cellClasses.join(' ') + '\"';\r\n    }\r\n\r\n    columnHtml = '<td' + cellClass + cellStyle + '>' + columnHtml + '</td>';\r\n    return columnHtml;\r\n  }\r\n\r\n  render(page: number) {\r\n    const pageSize = this.panel.pageSize || 100;\r\n    const startPos = page * pageSize;\r\n    const endPos = Math.min(startPos + pageSize, this.table.rows.length);\r\n    let html = '';\r\n\r\n    for (let y = startPos; y < endPos; y++) {\r\n      const row = this.table.rows[y];\r\n      let cellHtml = '';\r\n      let rowStyle = '';\r\n      const rowClasses = [];\r\n      let rowClass = '';\r\n      for (let i = 0; i < this.table.columns.length; i++) {\r\n        cellHtml += this.renderCell(i, y, row[i], y === startPos);\r\n      }\r\n\r\n      if (this.colorState.row) {\r\n        rowStyle = ' style=\"background-color:' + this.colorState.row + '\"';\r\n        rowClasses.push('table-panel-color-row');\r\n        this.colorState.row = null;\r\n      }\r\n\r\n      if (rowClasses.length) {\r\n        rowClass = ' class=\"' + rowClasses.join(' ') + '\"';\r\n      }\r\n\r\n      html += '<tr ' + rowClass + rowStyle + '>' + cellHtml + '</tr>';\r\n    }\r\n\r\n    return html;\r\n  }\r\n\r\n  render_values() {\r\n    const rows = [];\r\n    const visibleColumns = this.table.columns.filter(column => !column.hidden);\r\n\r\n    for (let y = 0; y < this.table.rows.length; y++) {\r\n      const row = this.table.rows[y];\r\n      const newRow = [];\r\n      for (let i = 0; i < this.table.columns.length; i++) {\r\n        if (!this.table.columns[i].hidden) {\r\n          newRow.push(this.formatColumnValue(i, row[i]));\r\n        }\r\n      }\r\n      rows.push(newRow);\r\n    }\r\n    return {\r\n      columns: visibleColumns,\r\n      rows: rows,\r\n    };\r\n  }\r\n}\r\n","import _ from 'lodash';\r\nimport flatten from 'app/core/utils/flatten';\r\nimport TimeSeries from 'app/core/time_series2';\r\nimport TableModel, { mergeTablesIntoModel } from 'app/core/table_model';\r\nimport { TableTransform } from './types';\r\nimport { Column, TableData } from '@grafana/data';\r\n\r\nconst transformers: { [key: string]: TableTransform } = {};\r\nexport const timeSeriesFormatFilterer = (data: any): any[] => {\r\n  if (!Array.isArray(data)) {\r\n    return data.datapoints ? [data] : [];\r\n  }\r\n\r\n  return data.reduce((acc, series) => {\r\n    if (!series.datapoints) {\r\n      return acc;\r\n    }\r\n\r\n    return acc.concat(series);\r\n  }, []);\r\n};\r\n\r\nexport const tableDataFormatFilterer = (data: any): any[] => {\r\n  if (!Array.isArray(data)) {\r\n    return data.columns ? [data] : [];\r\n  }\r\n\r\n  return data.reduce((acc, series) => {\r\n    if (!series.columns) {\r\n      return acc;\r\n    }\r\n\r\n    return acc.concat(series);\r\n  }, []);\r\n};\r\n\r\ntransformers['timeseries_to_rows'] = {\r\n  description: 'Time series to rows',\r\n  getColumns: () => {\r\n    return [];\r\n  },\r\n  transform: (data, panel, model) => {\r\n    model.columns = [{ text: 'Time', type: 'date' }, { text: 'Metric' }, { text: 'Value' }];\r\n    const filteredData = timeSeriesFormatFilterer(data);\r\n\r\n    for (let i = 0; i < filteredData.length; i++) {\r\n      const series = filteredData[i];\r\n      for (let y = 0; y < series.datapoints.length; y++) {\r\n        const dp = series.datapoints[y];\r\n        model.rows.push([dp[1], series.target, dp[0]]);\r\n      }\r\n    }\r\n  },\r\n};\r\n\r\ntransformers['timeseries_to_columns'] = {\r\n  description: 'Time series to columns',\r\n  getColumns: () => {\r\n    return [];\r\n  },\r\n  transform: (data, panel, model) => {\r\n    model.columns.push({ text: 'Time', type: 'date' });\r\n\r\n    // group by time\r\n    const points: any = {};\r\n    const filteredData = timeSeriesFormatFilterer(data);\r\n\r\n    for (let i = 0; i < filteredData.length; i++) {\r\n      const series = filteredData[i];\r\n      model.columns.push({ text: series.target });\r\n\r\n      for (let y = 0; y < series.datapoints.length; y++) {\r\n        const dp = series.datapoints[y];\r\n        const timeKey = dp[1].toString();\r\n\r\n        if (!points[timeKey]) {\r\n          points[timeKey] = { time: dp[1] };\r\n          points[timeKey][i] = dp[0];\r\n        } else {\r\n          points[timeKey][i] = dp[0];\r\n        }\r\n      }\r\n    }\r\n\r\n    for (const time in points) {\r\n      const point = points[time];\r\n      const values = [point.time];\r\n\r\n      for (let i = 0; i < filteredData.length; i++) {\r\n        const value = point[i];\r\n        values.push(value);\r\n      }\r\n\r\n      model.rows.push(values);\r\n    }\r\n  },\r\n};\r\n\r\ntransformers['timeseries_aggregations'] = {\r\n  description: 'Time series aggregations',\r\n  getColumns: () => {\r\n    return [\r\n      { text: 'Avg', value: 'avg' },\r\n      { text: 'Min', value: 'min' },\r\n      { text: 'Max', value: 'max' },\r\n      { text: 'Total', value: 'total' },\r\n      { text: 'Current', value: 'current' },\r\n      { text: 'Count', value: 'count' },\r\n    ];\r\n  },\r\n  transform: (data, panel, model) => {\r\n    let i, y;\r\n    model.columns.push({ text: 'Metric' });\r\n\r\n    for (i = 0; i < panel.columns.length; i++) {\r\n      model.columns.push({ text: panel.columns[i].text });\r\n    }\r\n\r\n    const filteredData = timeSeriesFormatFilterer(data);\r\n\r\n    for (i = 0; i < filteredData.length; i++) {\r\n      const series = new TimeSeries({\r\n        datapoints: filteredData[i].datapoints,\r\n        alias: filteredData[i].target,\r\n      });\r\n\r\n      series.getFlotPairs('connected');\r\n      const cells = [series.alias];\r\n\r\n      for (y = 0; y < panel.columns.length; y++) {\r\n        cells.push(series.stats[panel.columns[y].value]);\r\n      }\r\n\r\n      model.rows.push(cells);\r\n    }\r\n  },\r\n};\r\n\r\ntransformers['annotations'] = {\r\n  description: 'Annotations',\r\n  getColumns: () => {\r\n    return [];\r\n  },\r\n  transform: (data, panel, model) => {\r\n    model.columns.push({ text: 'Time', type: 'date' });\r\n    model.columns.push({ text: 'Title' });\r\n    model.columns.push({ text: 'Text' });\r\n    model.columns.push({ text: 'Tags' });\r\n\r\n    if (!data || !data.annotations || data.annotations.length === 0) {\r\n      return;\r\n    }\r\n\r\n    for (let i = 0; i < data.annotations.length; i++) {\r\n      const evt = data.annotations[i];\r\n      model.rows.push([evt.time, evt.title, evt.text, evt.tags]);\r\n    }\r\n  },\r\n};\r\n\r\ntransformers['table'] = {\r\n  description: 'Table',\r\n  getColumns: data => {\r\n    if (!data || data.length === 0) {\r\n      return [];\r\n    }\r\n\r\n    // Single query returns data columns as is\r\n    if (data.length === 1) {\r\n      return [...data[0].columns];\r\n    }\r\n\r\n    const filteredData = tableDataFormatFilterer(data);\r\n\r\n    // Track column indexes: name -> index\r\n    const columnNames: any = {};\r\n\r\n    // Union of all columns\r\n    const columns = filteredData.reduce((acc: Column[], series: TableData) => {\r\n      series.columns.forEach(col => {\r\n        const { text } = col;\r\n        if (columnNames[text] === undefined) {\r\n          columnNames[text] = acc.length;\r\n          acc.push(col);\r\n        }\r\n      });\r\n      return acc;\r\n    }, []);\r\n\r\n    return columns;\r\n  },\r\n  transform: (data: any[], panel, model) => {\r\n    if (!data || data.length === 0) {\r\n      return;\r\n    }\r\n    const filteredData = tableDataFormatFilterer(data);\r\n    const noTableIndex = _.findIndex(filteredData, d => 'columns' in d && 'rows' in d);\r\n    if (noTableIndex < 0) {\r\n      throw {\r\n        message: `Result of query #${String.fromCharCode(\r\n          65 + noTableIndex\r\n        )} is not in table format, try using another transform.`,\r\n      };\r\n    }\r\n\r\n    mergeTablesIntoModel(model, ...filteredData);\r\n  },\r\n};\r\n\r\ntransformers['json'] = {\r\n  description: 'JSON Data',\r\n  getColumns: data => {\r\n    if (!data || data.length === 0) {\r\n      return [];\r\n    }\r\n\r\n    const names: any = {};\r\n    for (let i = 0; i < data.length; i++) {\r\n      const series = data[i];\r\n      if (series.type !== 'docs') {\r\n        continue;\r\n      }\r\n\r\n      // only look at 100 docs\r\n      const maxDocs = Math.min(series.datapoints.length, 100);\r\n      for (let y = 0; y < maxDocs; y++) {\r\n        const doc = series.datapoints[y];\r\n        const flattened = flatten(doc, {});\r\n        for (const propName in flattened) {\r\n          names[propName] = true;\r\n        }\r\n      }\r\n    }\r\n\r\n    return _.map(names, (value, key) => {\r\n      return { text: key, value: key };\r\n    });\r\n  },\r\n  transform: (data, panel, model) => {\r\n    let i, y, z;\r\n\r\n    for (const column of panel.columns) {\r\n      const tableCol: any = { text: column.text };\r\n\r\n      // if filterable data then set columns to filterable\r\n      if (data.length > 0 && data[0].filterable) {\r\n        tableCol.filterable = true;\r\n      }\r\n\r\n      model.columns.push(tableCol);\r\n    }\r\n\r\n    if (model.columns.length === 0) {\r\n      model.columns.push({ text: 'JSON' });\r\n    }\r\n\r\n    for (i = 0; i < data.length; i++) {\r\n      const series = data[i];\r\n\r\n      for (y = 0; y < series.datapoints.length; y++) {\r\n        const dp = series.datapoints[y];\r\n        const values = [];\r\n\r\n        if (_.isObject(dp) && panel.columns.length > 0) {\r\n          const flattened = flatten(dp);\r\n          for (z = 0; z < panel.columns.length; z++) {\r\n            values.push(flattened[panel.columns[z].value]);\r\n          }\r\n        } else {\r\n          values.push(JSON.stringify(dp));\r\n        }\r\n\r\n        model.rows.push(values);\r\n      }\r\n    }\r\n  },\r\n};\r\n\r\nfunction transformDataToTable(data: any, panel: any) {\r\n  const model = new TableModel();\r\n\r\n  if (!data || data.length === 0) {\r\n    return model;\r\n  }\r\n\r\n  const transformer = transformers[panel.transform];\r\n  if (!transformer) {\r\n    throw { message: 'Transformer ' + panel.transform + ' not found' };\r\n  }\r\n\r\n  transformer.transform(data, panel, model);\r\n  return model;\r\n}\r\n\r\nexport { transformers, transformDataToTable };\r\n","// Libraries\r\nimport React, { Component } from 'react';\r\n\r\n// Types\r\nimport { Table } from '@grafana/ui';\r\nimport { PanelProps, applyFieldOverrides } from '@grafana/data';\r\nimport { Options } from './types';\r\nimport { config } from 'app/core/config';\r\n\r\ninterface Props extends PanelProps<Options> {}\r\n\r\nconst paddingBottom = 16;\r\n\r\nexport class TablePanel extends Component<Props> {\r\n  constructor(props: Props) {\r\n    super(props);\r\n  }\r\n\r\n  render() {\r\n    const { data, height, width, replaceVariables, options } = this.props;\r\n\r\n    if (data.series.length < 1) {\r\n      return <div>No Table Data...</div>;\r\n    }\r\n\r\n    const dataProcessed = applyFieldOverrides({\r\n      data: data.series,\r\n      fieldOptions: options.fieldOptions,\r\n      theme: config.theme,\r\n      replaceVariables,\r\n    })[0];\r\n\r\n    return <Table height={height - paddingBottom} width={width} data={dataProcessed} />;\r\n  }\r\n}\r\n","//// Libraries\r\nimport _ from 'lodash';\r\nimport React, { PureComponent } from 'react';\r\n\r\n// Types\r\nimport { PanelEditorProps } from '@grafana/data';\r\nimport { Switch } from '@grafana/ui';\r\nimport { Options } from './types';\r\n\r\nexport class TablePanelEditor extends PureComponent<PanelEditorProps<Options>> {\r\n  onToggleShowHeader = () => {\r\n    this.props.onOptionsChange({ ...this.props.options, showHeader: !this.props.options.showHeader });\r\n  };\r\n\r\n  render() {\r\n    const { showHeader } = this.props.options;\r\n\r\n    return (\r\n      <div>\r\n        <div className=\"section gf-form-group\">\r\n          <h5 className=\"section-heading\">Header</h5>\r\n          <Switch label=\"Show\" labelClass=\"width-6\" checked={showHeader} onChange={this.onToggleShowHeader} />\r\n        </div>\r\n      </div>\r\n    );\r\n  }\r\n}\r\n","import { PanelPlugin } from '@grafana/data';\r\n\r\nimport { TablePanelEditor } from './TablePanelEditor';\r\nimport { TablePanel } from './TablePanel';\r\nimport { Options, defaults } from './types';\r\n\r\nexport const plugin = new PanelPlugin<Options>(TablePanel)\r\n  .setNoPadding()\r\n  .setDefaults(defaults)\r\n  .setEditor(TablePanelEditor);\r\n","import { FieldConfigSource } from '@grafana/data';\r\n\r\nexport interface Options {\r\n  fieldOptions: FieldConfigSource;\r\n  showHeader: boolean;\r\n}\r\n\r\nexport const defaults: Options = {\r\n  fieldOptions: {\r\n    defaults: {},\r\n    overrides: [],\r\n  },\r\n  showHeader: true,\r\n};\r\n","import _ from 'lodash';\r\nimport { PanelCtrl } from 'app/plugins/sdk';\r\n\r\nimport { sanitize, escapeHtml } from 'app/core/utils/text';\r\nimport config from 'app/core/config';\r\nimport { auto, ISCEService } from 'angular';\r\nimport { TemplateSrv } from 'app/features/templating/template_srv';\r\nimport { PanelEvents } from '@grafana/data';\r\nimport { renderMarkdown } from '@grafana/data';\r\n\r\nconst defaultContent = `\r\n# Title\r\n\r\nFor markdown syntax help: [commonmark.org/help](https://commonmark.org/help/)\r\n\r\n\r\n\r\n`;\r\n\r\nexport class TextPanelCtrl extends PanelCtrl {\r\n  static templateUrl = `public/app/plugins/panel/text/module.html`;\r\n  static scrollable = true;\r\n\r\n  content: string;\r\n  // Set and populate defaults\r\n  panelDefaults = {\r\n    mode: 'markdown', // 'html', 'markdown', 'text'\r\n    content: defaultContent,\r\n  };\r\n\r\n  /** @ngInject */\r\n  constructor(\r\n    $scope: any,\r\n    $injector: auto.IInjectorService,\r\n    private templateSrv: TemplateSrv,\r\n    private $sce: ISCEService\r\n  ) {\r\n    super($scope, $injector);\r\n\r\n    _.defaults(this.panel, this.panelDefaults);\r\n\r\n    this.events.on(PanelEvents.editModeInitialized, this.onInitEditMode.bind(this));\r\n    this.events.on(PanelEvents.refresh, this.onRefresh.bind(this));\r\n    this.events.on(PanelEvents.render, this.onRender.bind(this));\r\n\r\n    const renderWhenChanged = (scope: any) => {\r\n      const { panel } = scope.ctrl;\r\n      return [panel.content, panel.mode].join();\r\n    };\r\n\r\n    $scope.$watch(\r\n      renderWhenChanged,\r\n      _.throttle(() => {\r\n        this.render();\r\n      }, 100)\r\n    );\r\n  }\r\n\r\n  onInitEditMode() {\r\n    this.addEditorTab('Options', 'public/app/plugins/panel/text/editor.html');\r\n\r\n    if (this.panel.mode === 'text') {\r\n      this.panel.mode = 'markdown';\r\n    }\r\n  }\r\n\r\n  onRefresh() {\r\n    this.render();\r\n  }\r\n\r\n  onRender() {\r\n    if (this.panel.mode === 'markdown') {\r\n      this.renderMarkdown(this.panel.content);\r\n    } else if (this.panel.mode === 'html') {\r\n      this.updateContent(this.panel.content);\r\n    }\r\n    this.renderingCompleted();\r\n  }\r\n\r\n  renderText(content: string) {\r\n    const safeContent = escapeHtml(content).replace(/\\n/g, '<br/>');\r\n    this.updateContent(safeContent);\r\n  }\r\n\r\n  renderMarkdown(content: string) {\r\n    this.$scope.$applyAsync(() => {\r\n      this.updateContent(renderMarkdown(content));\r\n    });\r\n  }\r\n\r\n  updateContent(html: string) {\r\n    try {\r\n      html = this.templateSrv.replace(html, this.panel.scopedVars, 'html');\r\n    } catch (e) {\r\n      console.log('Text panel error: ', e);\r\n    }\r\n\r\n    this.content = this.$sce.trustAsHtml(config.disableSanitizeHtml ? html : sanitize(html));\r\n  }\r\n}\r\n\r\nexport { TextPanelCtrl as PanelCtrl };\r\n","// Libraries\r\nimport React, { PureComponent } from 'react';\r\nimport { debounce } from 'lodash';\r\nimport { renderMarkdown } from '@grafana/data';\r\n\r\n// Utils\r\nimport { sanitize } from 'app/core/utils/text';\r\nimport config from 'app/core/config';\r\n\r\n// Types\r\nimport { TextOptions } from './types';\r\nimport { PanelProps } from '@grafana/data';\r\n\r\ninterface Props extends PanelProps<TextOptions> {}\r\ninterface State {\r\n  html: string;\r\n}\r\n\r\nexport class TextPanel extends PureComponent<Props, State> {\r\n  constructor(props: Props) {\r\n    super(props);\r\n\r\n    this.state = {\r\n      html: this.processContent(props.options),\r\n    };\r\n  }\r\n\r\n  updateHTML = debounce(() => {\r\n    const html = this.processContent(this.props.options);\r\n    if (html !== this.state.html) {\r\n      this.setState({ html });\r\n    }\r\n  }, 150);\r\n\r\n  componentDidUpdate(prevProps: Props) {\r\n    // Since any change could be referenced in a template variable,\r\n    // This needs to process everytime (with debounce)\r\n    this.updateHTML();\r\n  }\r\n\r\n  prepareHTML(html: string): string {\r\n    const { replaceVariables } = this.props;\r\n\r\n    html = replaceVariables(html, {}, 'html');\r\n\r\n    return config.disableSanitizeHtml ? html : sanitize(html);\r\n  }\r\n\r\n  prepareText(content: string): string {\r\n    return this.prepareHTML(\r\n      content\r\n        .replace(/&/g, '&amp;')\r\n        .replace(/>/g, '&gt;')\r\n        .replace(/</g, '&lt;')\r\n        .replace(/\\n/g, '<br/>')\r\n    );\r\n  }\r\n\r\n  prepareMarkdown(content: string): string {\r\n    return this.prepareHTML(renderMarkdown(content));\r\n  }\r\n\r\n  processContent(options: TextOptions): string {\r\n    const { mode, content } = options;\r\n\r\n    if (!content) {\r\n      return '';\r\n    }\r\n\r\n    if (mode === 'markdown') {\r\n      return this.prepareMarkdown(content);\r\n    }\r\n    if (mode === 'html') {\r\n      return this.prepareHTML(content);\r\n    }\r\n\r\n    return this.prepareText(content);\r\n  }\r\n\r\n  render() {\r\n    const { html } = this.state;\r\n\r\n    return <div className=\"markdown-html panel-text-content\" dangerouslySetInnerHTML={{ __html: html }} />;\r\n  }\r\n}\r\n","// Libraries\r\nimport React, { PureComponent, ChangeEvent } from 'react';\r\n\r\n// Components\r\nimport { PanelOptionsGroup, Select } from '@grafana/ui';\r\nimport { PanelEditorProps, SelectableValue } from '@grafana/data';\r\n\r\n// Types\r\nimport { TextOptions, TextMode } from './types';\r\n\r\nexport class TextPanelEditor extends PureComponent<PanelEditorProps<TextOptions>> {\r\n  modes: Array<SelectableValue<TextMode>> = [\r\n    { value: 'markdown', label: 'Markdown' },\r\n    { value: 'text', label: 'Text' },\r\n    { value: 'html', label: 'HTML' },\r\n  ];\r\n\r\n  onModeChange = (item: SelectableValue<TextMode>) =>\r\n    this.props.onOptionsChange({ ...this.props.options, mode: item.value! });\r\n\r\n  onContentChange = (evt: ChangeEvent<HTMLTextAreaElement>) => {\r\n    this.props.onOptionsChange({ ...this.props.options, content: (evt.target as any).value });\r\n  };\r\n\r\n  render() {\r\n    const { mode, content } = this.props.options;\r\n\r\n    return (\r\n      <PanelOptionsGroup title=\"Text\">\r\n        <div className=\"gf-form-inline\">\r\n          <div className=\"gf-form\">\r\n            <span className=\"gf-form-label\">Mode</span>\r\n            <Select onChange={this.onModeChange} value={this.modes.find(e => mode === e.value)} options={this.modes} />\r\n          </div>\r\n        </div>\r\n        <textarea value={content} onChange={this.onContentChange} className=\"gf-form-input\" rows={10} />\r\n      </PanelOptionsGroup>\r\n    );\r\n  }\r\n}\r\n","import { PanelPlugin } from '@grafana/data';\r\n\r\nimport { TextPanelEditor } from './TextPanelEditor';\r\nimport { TextPanel } from './TextPanel';\r\nimport { TextOptions, defaults } from './types';\r\n\r\nexport const plugin = new PanelPlugin<TextOptions>(TextPanel)\r\n  .setDefaults(defaults)\r\n  .setEditor(TextPanelEditor)\r\n  .setPanelChangeHandler((options: TextOptions, prevPluginId: string, prevOptions: any) => {\r\n    if (prevPluginId === 'text') {\r\n      return prevOptions as TextOptions;\r\n    }\r\n    return options;\r\n  });\r\n","export type TextMode = 'html' | 'markdown' | 'text';\r\nexport interface TextOptions {\r\n  mode: TextMode;\r\n  content: string;\r\n}\r\n\r\nexport const defaults: TextOptions = {\r\n  mode: 'markdown',\r\n  content: `# Title\r\n\r\nFor markdown syntax help: [commonmark.org/help](https://commonmark.org/help/)\r\n\r\n\r\n`,\r\n};\r\n","import { PanelCtrl } from 'app/features/panel/panel_ctrl';\r\nimport { MetricsPanelCtrl } from 'app/features/panel/metrics_panel_ctrl';\r\nimport { QueryCtrl } from 'app/features/panel/query_ctrl';\r\nimport { alertTab } from 'app/features/alerting/AlertTabCtrl';\r\nimport { loadPluginCss } from '@grafana/runtime';\r\n\r\nexport { PanelCtrl, MetricsPanelCtrl, QueryCtrl, alertTab, loadPluginCss };\r\n","// Libraries\r\nimport _ from 'lodash';\r\nimport $ from 'jquery';\r\n// @ts-ignore\r\nimport Drop from 'tether-drop';\r\n\r\n// Utils and servies\r\nimport { colors } from '@grafana/ui';\r\nimport { setBackendSrv, BackendSrv, setDataSourceSrv } from '@grafana/runtime';\r\nimport config from 'app/core/config';\r\nimport coreModule from 'app/core/core_module';\r\nimport { profiler } from 'app/core/profiler';\r\nimport appEvents from 'app/core/app_events';\r\nimport { TimeSrv, setTimeSrv } from 'app/features/dashboard/services/TimeSrv';\r\nimport { DatasourceSrv } from 'app/features/plugins/datasource_srv';\r\nimport { KeybindingSrv, setKeybindingSrv } from 'app/core/services/keybindingSrv';\r\nimport { AngularLoader, setAngularLoader } from 'app/core/services/AngularLoader';\r\nimport { configureStore } from 'app/store/configureStore';\r\n\r\nimport { LocationUpdate, setLocationSrv } from '@grafana/runtime';\r\nimport { updateLocation } from 'app/core/actions';\r\n\r\n// Types\r\nimport { KioskUrlValue, CoreEvents, AppEventEmitter, AppEventConsumer } from 'app/types';\r\nimport { setLinkSrv, LinkSrv } from 'app/features/panel/panellinks/link_srv';\r\nimport { UtilSrv } from 'app/core/services/util_srv';\r\nimport { ContextSrv } from 'app/core/services/context_srv';\r\nimport { BridgeSrv } from 'app/core/services/bridge_srv';\r\nimport { PlaylistSrv } from 'app/features/playlist/playlist_srv';\r\nimport { DashboardSrv, setDashboardSrv } from 'app/features/dashboard/services/DashboardSrv';\r\nimport { ILocationService, ITimeoutService, IRootScopeService, IAngularEvent } from 'angular';\r\nimport { AppEvent, AppEvents } from '@grafana/data';\r\n\r\nexport type GrafanaRootScope = IRootScopeService & AppEventEmitter & AppEventConsumer & { colors: string[] };\r\n\r\nexport class GrafanaCtrl {\r\n  /** @ngInject */\r\n  constructor(\r\n    $scope: any,\r\n    utilSrv: UtilSrv,\r\n    $rootScope: GrafanaRootScope,\r\n    contextSrv: ContextSrv,\r\n    bridgeSrv: BridgeSrv,\r\n    backendSrv: BackendSrv,\r\n    timeSrv: TimeSrv,\r\n    linkSrv: LinkSrv,\r\n    datasourceSrv: DatasourceSrv,\r\n    keybindingSrv: KeybindingSrv,\r\n    dashboardSrv: DashboardSrv,\r\n    angularLoader: AngularLoader\r\n  ) {\r\n    // make angular loader service available to react components\r\n    setAngularLoader(angularLoader);\r\n    setBackendSrv(backendSrv);\r\n    setDataSourceSrv(datasourceSrv);\r\n    setTimeSrv(timeSrv);\r\n    setLinkSrv(linkSrv);\r\n    setKeybindingSrv(keybindingSrv);\r\n    setDashboardSrv(dashboardSrv);\r\n\r\n    const store = configureStore();\r\n    setLocationSrv({\r\n      update: (opt: LocationUpdate) => {\r\n        store.dispatch(updateLocation(opt));\r\n      },\r\n    });\r\n\r\n    $scope.init = () => {\r\n      $scope.contextSrv = contextSrv;\r\n      $scope.appSubUrl = config.appSubUrl;\r\n      $scope._ = _;\r\n\r\n      profiler.init(config, $rootScope);\r\n      utilSrv.init();\r\n      bridgeSrv.init();\r\n    };\r\n\r\n    $rootScope.colors = colors;\r\n\r\n    $rootScope.onAppEvent = function<T>(\r\n      event: AppEvent<T> | string,\r\n      callback: (event: IAngularEvent, ...args: any[]) => void,\r\n      localScope?: any\r\n    ) {\r\n      let unbind;\r\n      if (typeof event === 'string') {\r\n        unbind = $rootScope.$on(event, callback);\r\n      } else {\r\n        unbind = $rootScope.$on(event.name, callback);\r\n      }\r\n\r\n      let callerScope = this;\r\n      if (callerScope.$id === 1 && !localScope) {\r\n        console.log('warning rootScope onAppEvent called without localscope');\r\n      }\r\n      if (localScope) {\r\n        callerScope = localScope;\r\n      }\r\n      callerScope.$on('$destroy', unbind);\r\n    };\r\n\r\n    $rootScope.appEvent = <T>(event: AppEvent<T> | string, payload?: T | any) => {\r\n      if (typeof event === 'string') {\r\n        $rootScope.$emit(event, payload);\r\n        appEvents.emit(event, payload);\r\n      } else {\r\n        $rootScope.$emit(event.name, payload);\r\n        appEvents.emit(event, payload);\r\n      }\r\n    };\r\n\r\n    $scope.init();\r\n  }\r\n}\r\n\r\nfunction setViewModeBodyClass(body: JQuery, mode: KioskUrlValue) {\r\n  body.removeClass('view-mode--tv');\r\n  body.removeClass('view-mode--kiosk');\r\n  body.removeClass('view-mode--inactive');\r\n\r\n  switch (mode) {\r\n    case 'tv': {\r\n      body.addClass('view-mode--tv');\r\n      break;\r\n    }\r\n    // 1 & true for legacy states\r\n    case '1':\r\n    case true: {\r\n      body.addClass('view-mode--kiosk');\r\n      break;\r\n    }\r\n  }\r\n}\r\n\r\n/** @ngInject */\r\nexport function grafanaAppDirective(\r\n  playlistSrv: PlaylistSrv,\r\n  contextSrv: ContextSrv,\r\n  $timeout: ITimeoutService,\r\n  $rootScope: IRootScopeService,\r\n  $location: ILocationService\r\n) {\r\n  return {\r\n    restrict: 'E',\r\n    controller: GrafanaCtrl,\r\n    link: (scope: IRootScopeService & AppEventEmitter, elem: JQuery) => {\r\n      const body = $('body');\r\n      // see https://github.com/zenorocha/clipboard.js/issues/155\r\n      $.fn.modal.Constructor.prototype.enforceFocus = () => {};\r\n\r\n      $('.preloader').remove();\r\n\r\n      appEvents.on(CoreEvents.toggleSidemenuMobile, () => {\r\n        body.toggleClass('sidemenu-open--xs');\r\n      });\r\n\r\n      appEvents.on(CoreEvents.toggleSidemenuHidden, () => {\r\n        body.toggleClass('sidemenu-hidden');\r\n      });\r\n\r\n      appEvents.on(CoreEvents.playlistStarted, () => {\r\n        elem.toggleClass('view-mode--playlist', true);\r\n      });\r\n\r\n      appEvents.on(CoreEvents.playlistStopped, () => {\r\n        elem.toggleClass('view-mode--playlist', false);\r\n      });\r\n\r\n      // check if we are in server side render\r\n      if (document.cookie.indexOf('renderKey') !== -1) {\r\n        body.addClass('body--phantomjs');\r\n      }\r\n\r\n      // tooltip removal fix\r\n      // manage page classes\r\n      let pageClass: string;\r\n      scope.$on('$routeChangeSuccess', (evt: any, data: any) => {\r\n        if (pageClass) {\r\n          body.removeClass(pageClass);\r\n        }\r\n\r\n        if (data.$$route) {\r\n          pageClass = data.$$route.pageClass;\r\n          if (pageClass) {\r\n            body.addClass(pageClass);\r\n          }\r\n        }\r\n\r\n        // clear body class sidemenu states\r\n        body.removeClass('sidemenu-open--xs');\r\n\r\n        $('#tooltip, .tooltip').remove();\r\n\r\n        // check for kiosk url param\r\n        setViewModeBodyClass(body, data.params.kiosk);\r\n\r\n        // close all drops\r\n        for (const drop of Drop.drops) {\r\n          drop.destroy();\r\n        }\r\n\r\n        appEvents.emit(CoreEvents.hideDashSearch);\r\n      });\r\n\r\n      // handle kiosk mode\r\n      appEvents.on(CoreEvents.toggleKioskMode, (options: { exit?: boolean }) => {\r\n        const search: { kiosk?: KioskUrlValue } = $location.search();\r\n\r\n        if (options && options.exit) {\r\n          search.kiosk = '1';\r\n        }\r\n\r\n        switch (search.kiosk) {\r\n          case 'tv': {\r\n            search.kiosk = true;\r\n            appEvents.emit(AppEvents.alertSuccess, ['Press ESC to exit Kiosk mode']);\r\n            break;\r\n          }\r\n          case '1':\r\n          case true: {\r\n            delete search.kiosk;\r\n            break;\r\n          }\r\n          default: {\r\n            search.kiosk = 'tv';\r\n          }\r\n        }\r\n\r\n        $timeout(() => $location.search(search));\r\n        setViewModeBodyClass(body, search.kiosk!);\r\n      });\r\n\r\n      // handle in active view state class\r\n      let lastActivity = new Date().getTime();\r\n      let activeUser = true;\r\n      const inActiveTimeLimit = 60 * 5000;\r\n\r\n      function checkForInActiveUser() {\r\n        if (!activeUser) {\r\n          return;\r\n        }\r\n        // only go to activity low mode on dashboard page\r\n        if (!body.hasClass('page-dashboard')) {\r\n          return;\r\n        }\r\n\r\n        if (new Date().getTime() - lastActivity > inActiveTimeLimit) {\r\n          activeUser = false;\r\n          body.addClass('view-mode--inactive');\r\n        }\r\n      }\r\n\r\n      function userActivityDetected() {\r\n        lastActivity = new Date().getTime();\r\n        if (!activeUser) {\r\n          activeUser = true;\r\n          body.removeClass('view-mode--inactive');\r\n        }\r\n      }\r\n\r\n      // mouse and keyboard is user activity\r\n      body.mousemove(userActivityDetected);\r\n      body.keydown(userActivityDetected);\r\n      // set useCapture = true to catch event here\r\n      document.addEventListener('wheel', userActivityDetected, { capture: true, passive: true });\r\n      // treat tab change as activity\r\n      document.addEventListener('visibilitychange', userActivityDetected);\r\n\r\n      // check every 2 seconds\r\n      setInterval(checkForInActiveUser, 2000);\r\n\r\n      appEvents.on(CoreEvents.toggleViewMode, () => {\r\n        lastActivity = 0;\r\n        checkForInActiveUser();\r\n      });\r\n\r\n      // handle document clicks that should hide things\r\n      body.click(evt => {\r\n        const target = $(evt.target);\r\n        if (target.parents().length === 0) {\r\n          return;\r\n        }\r\n\r\n        // ensure dropdown menu doesn't impact on z-index\r\n        body.find('.dropdown-menu-open').removeClass('dropdown-menu-open');\r\n\r\n        // for stuff that animates, slides out etc, clicking it needs to\r\n        // hide it right away\r\n        const clickAutoHide = target.closest('[data-click-hide]');\r\n        if (clickAutoHide.length) {\r\n          const clickAutoHideParent = clickAutoHide.parent();\r\n          clickAutoHide.detach();\r\n          setTimeout(() => {\r\n            clickAutoHideParent.append(clickAutoHide);\r\n          }, 100);\r\n        }\r\n\r\n        // hide search\r\n        if (body.find('.search-container').length > 0) {\r\n          if (target.parents('.search-results-container, .search-field-wrapper').length === 0) {\r\n            scope.$apply(() => {\r\n              scope.appEvent(CoreEvents.hideDashSearch);\r\n            });\r\n          }\r\n        }\r\n\r\n        // hide popovers\r\n        const popover = elem.find('.popover');\r\n        if (popover.length > 0 && target.parents('.graph-legend').length === 0) {\r\n          popover.hide();\r\n        }\r\n      });\r\n    },\r\n  };\r\n}\r\n\r\ncoreModule.directive('grafanaApp', grafanaAppDirective);\r\n","// Libraries\r\nimport React from 'react';\r\nimport ReactDOM from 'react-dom';\r\nimport { Provider } from 'react-redux';\r\n\r\n// Utils and services\r\nimport coreModule from 'app/core/core_module';\r\nimport { store } from 'app/store/store';\r\nimport { ContextSrv } from 'app/core/services/context_srv';\r\nimport { provideTheme } from 'app/core/utils/ConfigProvider';\r\nimport { ErrorBoundaryAlert } from '@grafana/ui';\r\nimport { GrafanaRootScope } from './GrafanaCtrl';\r\n\r\nfunction WrapInProvider(store: any, Component: any, props: any) {\r\n  return (\r\n    <Provider store={store}>\r\n      <ErrorBoundaryAlert style=\"page\">\r\n        <Component {...props} />\r\n      </ErrorBoundaryAlert>\r\n    </Provider>\r\n  );\r\n}\r\n\r\n/** @ngInject */\r\nexport function reactContainer(\r\n  $route: any,\r\n  $location: any,\r\n  $injector: any,\r\n  $rootScope: GrafanaRootScope,\r\n  contextSrv: ContextSrv\r\n) {\r\n  return {\r\n    restrict: 'E',\r\n    template: '',\r\n    link(scope: any, elem: JQuery) {\r\n      // Check permissions for this component\r\n      const roles: string[] = $route.current.locals.roles;\r\n      if (roles && roles.length) {\r\n        if (!roles.some(r => contextSrv.hasRole(r))) {\r\n          $location.url('/');\r\n        }\r\n      }\r\n\r\n      let { component } = $route.current.locals;\r\n      // Dynamic imports return whole module, need to extract default export\r\n      if (component.default) {\r\n        component = component.default;\r\n      }\r\n\r\n      const props = {\r\n        $injector: $injector,\r\n        $rootScope: $rootScope,\r\n        $scope: scope,\r\n        $contextSrv: contextSrv,\r\n        routeInfo: $route.current.$$route.routeInfo,\r\n      };\r\n\r\n      document.body.classList.add('is-react');\r\n\r\n      ReactDOM.render(WrapInProvider(store, provideTheme(component), props), elem[0]);\r\n\r\n      scope.$on('$destroy', () => {\r\n        document.body.classList.remove('is-react');\r\n        ReactDOM.unmountComponentAtNode(elem[0]);\r\n      });\r\n    },\r\n  };\r\n}\r\n\r\ncoreModule.directive('reactContainer', reactContainer);\r\n","import coreModule from 'app/core/core_module';\r\nimport locationUtil from 'app/core/utils/location_util';\r\nimport { UrlQueryMap } from '@grafana/runtime';\r\nimport { DashboardLoaderSrv } from 'app/features/dashboard/services/DashboardLoaderSrv';\r\nimport { BackendSrv } from 'app/core/services/backend_srv';\r\nimport { ILocationService } from 'angular';\r\nimport { Scope, CoreEvents, AppEventEmitter } from 'app/types';\r\n\r\nexport class LoadDashboardCtrl {\r\n  /** @ngInject */\r\n  constructor(\r\n    $scope: Scope & AppEventEmitter,\r\n    $routeParams: UrlQueryMap,\r\n    dashboardLoaderSrv: DashboardLoaderSrv,\r\n    backendSrv: BackendSrv,\r\n    $location: ILocationService,\r\n    $browser: any\r\n  ) {\r\n    $scope.appEvent(CoreEvents.dashboardFetchStart);\r\n\r\n    if (!$routeParams.uid && !$routeParams.slug) {\r\n      backendSrv.get('/api/dashboards/home').then((homeDash: { redirectUri: string; meta: any }) => {\r\n        if (homeDash.redirectUri) {\r\n          const newUrl = locationUtil.stripBaseFromUrl(homeDash.redirectUri);\r\n          $location.path(newUrl);\r\n        } else {\r\n          const meta = homeDash.meta;\r\n          meta.canSave = meta.canShare = meta.canStar = false;\r\n          $scope.initDashboard(homeDash, $scope);\r\n        }\r\n      });\r\n      return;\r\n    }\r\n\r\n    // if no uid, redirect to new route based on slug\r\n    if (!($routeParams.type === 'script' || $routeParams.type === 'snapshot') && !$routeParams.uid) {\r\n      // @ts-ignore\r\n      backendSrv.getDashboardBySlug($routeParams.slug).then(res => {\r\n        if (res) {\r\n          $location.path(locationUtil.stripBaseFromUrl(res.meta.url)).replace();\r\n        }\r\n      });\r\n      return;\r\n    }\r\n\r\n    dashboardLoaderSrv.loadDashboard($routeParams.type, $routeParams.slug, $routeParams.uid).then((result: any) => {\r\n      if (result.meta.url) {\r\n        const url = locationUtil.stripBaseFromUrl(result.meta.url);\r\n\r\n        if (url !== $location.path()) {\r\n          // replace url to not create additional history items and then return so that initDashboard below isn't executed multiple times.\r\n          $location.path(url).replace();\r\n          return;\r\n        }\r\n      }\r\n\r\n      result.meta.autofitpanels = $routeParams.autofitpanels;\r\n      result.meta.kiosk = $routeParams.kiosk;\r\n\r\n      $scope.initDashboard(result, $scope);\r\n    });\r\n  }\r\n}\r\n\r\nexport class NewDashboardCtrl {\r\n  /** @ngInject */\r\n  constructor($scope: any, $routeParams: UrlQueryMap) {\r\n    $scope.initDashboard(\r\n      {\r\n        meta: {\r\n          canStar: false,\r\n          canShare: false,\r\n          isNew: true,\r\n          folderId: Number($routeParams.folderId),\r\n        },\r\n        dashboard: {\r\n          title: 'New dashboard',\r\n          panels: [\r\n            {\r\n              type: 'add-panel',\r\n              gridPos: { x: 0, y: 0, w: 12, h: 9 },\r\n              title: 'Panel Title',\r\n            },\r\n          ],\r\n        },\r\n      },\r\n      $scope\r\n    );\r\n  }\r\n}\r\n\r\ncoreModule.controller('LoadDashboardCtrl', LoadDashboardCtrl);\r\ncoreModule.controller('NewDashboardCtrl', NewDashboardCtrl);\r\n","import { route } from 'angular';\r\n\r\ninterface RegisterRoutesHandler {\r\n  ($routeProvider: route.IRouteProvider): any;\r\n}\r\n\r\nconst handlers: RegisterRoutesHandler[] = [];\r\n\r\nexport function applyRouteRegistrationHandlers($routeProvider: route.IRouteProvider) {\r\n  for (const handler of handlers) {\r\n    handler($routeProvider);\r\n  }\r\n}\r\n\r\nexport function addRouteRegistrationHandler(fn: RegisterRoutesHandler) {\r\n  handlers.push(fn);\r\n}\r\n","import './dashboard_loaders';\r\nimport './ReactContainer';\r\nimport { applyRouteRegistrationHandlers } from './registry';\r\n// Pages\r\nimport CreateFolderCtrl from 'app/features/folders/CreateFolderCtrl';\r\nimport FolderDashboardsCtrl from 'app/features/folders/FolderDashboardsCtrl';\r\nimport DashboardImportCtrl from 'app/features/manage-dashboards/DashboardImportCtrl';\r\nimport LdapPage from 'app/features/admin/ldap/LdapPage';\r\nimport UserAdminPage from 'app/features/admin/UserAdminPage';\r\nimport config from 'app/core/config';\r\nimport { ILocationProvider, route } from 'angular';\r\n// Types\r\nimport { DashboardRouteInfo } from 'app/types';\r\nimport { LoginPage } from 'app/core/components/Login/LoginPage';\r\nimport { SafeDynamicImport } from '../core/components/DynamicImports/SafeDynamicImport';\r\n\r\n/** @ngInject */\r\nexport function setupAngularRoutes($routeProvider: route.IRouteProvider, $locationProvider: ILocationProvider) {\r\n  $locationProvider.html5Mode(true);\r\n\r\n  // Routes here are guarded both here and server side for react-container routes or just on the server for angular\r\n  // ones. That means angular ones could be navigated to in case there is a client side link some where.\r\n\r\n  const importDashboardPage = () =>\r\n    SafeDynamicImport(import(/* webpackChunkName: \"DashboardPage\" */ '../features/dashboard/containers/DashboardPage'));\r\n\r\n  $routeProvider\r\n    .when('/', {\r\n      template: '<react-container />',\r\n      //@ts-ignore\r\n      pageClass: 'page-dashboard',\r\n      routeInfo: DashboardRouteInfo.Home,\r\n      reloadOnSearch: false,\r\n      resolve: {\r\n        component: importDashboardPage,\r\n      },\r\n    })\r\n    .when('/d/:uid/:slug', {\r\n      template: '<react-container />',\r\n      pageClass: 'page-dashboard',\r\n      routeInfo: DashboardRouteInfo.Normal,\r\n      reloadOnSearch: false,\r\n      resolve: {\r\n        component: importDashboardPage,\r\n      },\r\n    })\r\n    .when('/d/:uid', {\r\n      template: '<react-container />',\r\n      pageClass: 'page-dashboard',\r\n      reloadOnSearch: false,\r\n      routeInfo: DashboardRouteInfo.Normal,\r\n      resolve: {\r\n        component: importDashboardPage,\r\n      },\r\n    })\r\n    .when('/dashboard/:type/:slug', {\r\n      template: '<react-container />',\r\n      pageClass: 'page-dashboard',\r\n      routeInfo: DashboardRouteInfo.Normal,\r\n      reloadOnSearch: false,\r\n      resolve: {\r\n        component: importDashboardPage,\r\n      },\r\n    })\r\n    .when('/dashboard/new', {\r\n      template: '<react-container />',\r\n      pageClass: 'page-dashboard',\r\n      routeInfo: DashboardRouteInfo.New,\r\n      reloadOnSearch: false,\r\n      resolve: {\r\n        component: importDashboardPage,\r\n      },\r\n    })\r\n    .when('/d-solo/:uid/:slug', {\r\n      template: '<react-container />',\r\n      pageClass: 'dashboard-solo',\r\n      routeInfo: DashboardRouteInfo.Normal,\r\n      reloadOnSearch: false,\r\n      resolve: {\r\n        component: () =>\r\n          SafeDynamicImport(\r\n            import(/* webpackChunkName: \"SoloPanelPage\" */ '../features/dashboard/containers/SoloPanelPage')\r\n          ),\r\n      },\r\n    })\r\n    .when('/d-solo/:uid', {\r\n      template: '<react-container />',\r\n      pageClass: 'dashboard-solo',\r\n      routeInfo: DashboardRouteInfo.Normal,\r\n      reloadOnSearch: false,\r\n      resolve: {\r\n        component: () =>\r\n          SafeDynamicImport(\r\n            import(/* webpackChunkName: \"SoloPanelPage\" */ '../features/dashboard/containers/SoloPanelPage')\r\n          ),\r\n      },\r\n    })\r\n    .when('/dashboard-solo/:type/:slug', {\r\n      template: '<react-container />',\r\n      pageClass: 'dashboard-solo',\r\n      routeInfo: DashboardRouteInfo.Normal,\r\n      reloadOnSearch: false,\r\n      resolve: {\r\n        component: () =>\r\n          SafeDynamicImport(\r\n            import(/* webpackChunkName: \"SoloPanelPage\" */ '../features/dashboard/containers/SoloPanelPage')\r\n          ),\r\n      },\r\n    })\r\n    .when('/dashboard/import', {\r\n      templateUrl: 'public/app/features/manage-dashboards/partials/dashboard_import.html',\r\n      controller: DashboardImportCtrl,\r\n      controllerAs: 'ctrl',\r\n    })\r\n    .when('/datasources', {\r\n      template: '<react-container />',\r\n      resolve: {\r\n        component: () =>\r\n          SafeDynamicImport(\r\n            import(/* webpackChunkName: \"DataSourcesListPage\"*/ 'app/features/datasources/DataSourcesListPage')\r\n          ),\r\n      },\r\n    })\r\n    .when('/datasources/edit/:id/', {\r\n      template: '<react-container />',\r\n      reloadOnSearch: false, // for tabs\r\n      resolve: {\r\n        component: () =>\r\n          SafeDynamicImport(\r\n            import(\r\n              /* webpackChunkName: \"DataSourceSettingsPage\"*/ '../features/datasources/settings/DataSourceSettingsPage'\r\n            )\r\n          ),\r\n      },\r\n    })\r\n    .when('/datasources/edit/:id/dashboards', {\r\n      template: '<react-container />',\r\n      resolve: {\r\n        component: () =>\r\n          SafeDynamicImport(\r\n            import(/* webpackChunkName: \"DataSourceDashboards\"*/ 'app/features/datasources/DataSourceDashboards')\r\n          ),\r\n      },\r\n    })\r\n    .when('/datasources/new', {\r\n      template: '<react-container />',\r\n      resolve: {\r\n        component: () =>\r\n          SafeDynamicImport(\r\n            import(/* webpackChunkName: \"NewDataSourcePage\"*/ '../features/datasources/NewDataSourcePage')\r\n          ),\r\n      },\r\n    })\r\n    .when('/dashboards', {\r\n      templateUrl: 'public/app/features/manage-dashboards/partials/dashboard_list.html',\r\n      controller: 'DashboardListCtrl',\r\n      controllerAs: 'ctrl',\r\n    })\r\n    .when('/dashboards/folder/new', {\r\n      templateUrl: 'public/app/features/folders/partials/create_folder.html',\r\n      controller: CreateFolderCtrl,\r\n      controllerAs: 'ctrl',\r\n    })\r\n    .when('/dashboards/f/:uid/:slug/permissions', {\r\n      template: '<react-container />',\r\n      resolve: {\r\n        component: () =>\r\n          SafeDynamicImport(\r\n            import(/* webpackChunkName: \"FolderPermissions\"*/ 'app/features/folders/FolderPermissions')\r\n          ),\r\n      },\r\n    })\r\n    .when('/dashboards/f/:uid/:slug/settings', {\r\n      template: '<react-container />',\r\n      resolve: {\r\n        component: () =>\r\n          SafeDynamicImport(\r\n            import(/* webpackChunkName: \"FolderSettingsPage\"*/ 'app/features/folders/FolderSettingsPage')\r\n          ),\r\n      },\r\n    })\r\n    .when('/dashboards/f/:uid/:slug', {\r\n      templateUrl: 'public/app/features/folders/partials/folder_dashboards.html',\r\n      controller: FolderDashboardsCtrl,\r\n      controllerAs: 'ctrl',\r\n    })\r\n    .when('/dashboards/f/:uid', {\r\n      templateUrl: 'public/app/features/folders/partials/folder_dashboards.html',\r\n      controller: FolderDashboardsCtrl,\r\n      controllerAs: 'ctrl',\r\n    })\r\n    .when('/explore', {\r\n      template: '<react-container />',\r\n      reloadOnSearch: false,\r\n      resolve: {\r\n        roles: () => (config.viewersCanEdit ? [] : ['Editor', 'Admin']),\r\n        component: () => SafeDynamicImport(import(/* webpackChunkName: \"explore\" */ 'app/features/explore/Wrapper')),\r\n      },\r\n    })\r\n    .when('/a/:pluginId/', {\r\n      // Someday * and will get a ReactRouter under that path!\r\n      template: '<react-container />',\r\n      reloadOnSearch: false,\r\n      resolve: {\r\n        component: () =>\r\n          SafeDynamicImport(import(/* webpackChunkName: \"AppRootPage\" */ 'app/features/plugins/AppRootPage')),\r\n      },\r\n    })\r\n    .when('/org', {\r\n      template: '<react-container />',\r\n      resolve: {\r\n        component: () =>\r\n          SafeDynamicImport(import(/* webpackChunkName: \"OrgDetailsPage\" */ '../features/org/OrgDetailsPage')),\r\n      },\r\n    })\r\n    .when('/org/new', {\r\n      templateUrl: 'public/app/features/org/partials/newOrg.html',\r\n      controller: 'NewOrgCtrl',\r\n    })\r\n    .when('/org/users', {\r\n      template: '<react-container />',\r\n      resolve: {\r\n        component: () =>\r\n          SafeDynamicImport(import(/* webpackChunkName: \"UsersListPage\" */ 'app/features/users/UsersListPage')),\r\n      },\r\n    })\r\n    .when('/org/users/invite', {\r\n      templateUrl: 'public/app/features/org/partials/invite.html',\r\n      controller: 'UserInviteCtrl',\r\n      controllerAs: 'ctrl',\r\n    })\r\n    .when('/org/apikeys', {\r\n      template: '<react-container />',\r\n      resolve: {\r\n        roles: () => ['Editor', 'Admin'],\r\n        component: () =>\r\n          SafeDynamicImport(import(/* webpackChunkName: \"ApiKeysPage\" */ 'app/features/api-keys/ApiKeysPage')),\r\n      },\r\n    })\r\n    .when('/org/teams', {\r\n      template: '<react-container />',\r\n      resolve: {\r\n        roles: () => (config.editorsCanAdmin ? [] : ['Editor', 'Admin']),\r\n        component: () => SafeDynamicImport(import(/* webpackChunkName: \"TeamList\" */ 'app/features/teams/TeamList')),\r\n      },\r\n    })\r\n    .when('/org/teams/new', {\r\n      template: '<react-container />',\r\n      resolve: {\r\n        roles: () => (config.editorsCanAdmin ? [] : ['Admin']),\r\n        component: () =>\r\n          SafeDynamicImport(import(/* webpackChunkName: \"CreateTeam\" */ 'app/features/teams/CreateTeam')),\r\n      },\r\n    })\r\n    .when('/org/teams/edit/:id/:page?', {\r\n      template: '<react-container />',\r\n      resolve: {\r\n        roles: () => (config.editorsCanAdmin ? [] : ['Admin']),\r\n        component: () => SafeDynamicImport(import(/* webpackChunkName: \"TeamPages\" */ 'app/features/teams/TeamPages')),\r\n      },\r\n    })\r\n    .when('/profile', {\r\n      templateUrl: 'public/app/features/profile/partials/profile.html',\r\n      controller: 'ProfileCtrl',\r\n      controllerAs: 'ctrl',\r\n    })\r\n    .when('/profile/password', {\r\n      template: '<react-container />',\r\n      resolve: {\r\n        component: () =>\r\n          SafeDynamicImport(\r\n            import(/* webPackChunkName: \"ChangePasswordPage\" */ 'app/features/profile/ChangePasswordPage')\r\n          ),\r\n      },\r\n    })\r\n    .when('/profile/select-org', {\r\n      templateUrl: 'public/app/features/org/partials/select_org.html',\r\n      controller: 'SelectOrgCtrl',\r\n    })\r\n    // ADMIN\r\n    .when('/admin', {\r\n      templateUrl: 'public/app/features/admin/partials/admin_home.html',\r\n      controller: 'AdminHomeCtrl',\r\n      controllerAs: 'ctrl',\r\n    })\r\n    .when('/admin/settings', {\r\n      template: '<react-container />',\r\n      resolve: {\r\n        component: () =>\r\n          SafeDynamicImport(import(/* webpackChunkName: \"AdminSettings\" */ 'app/features/admin/AdminSettings')),\r\n      },\r\n    })\r\n    .when('/admin/upgrading', {\r\n      template: '<react-container />',\r\n      resolve: {\r\n        component: () => SafeDynamicImport(import('app/features/admin/UpgradePage')),\r\n      },\r\n    })\r\n    .when('/admin/users', {\r\n      templateUrl: 'public/app/features/admin/partials/users.html',\r\n      controller: 'AdminListUsersCtrl',\r\n      controllerAs: 'ctrl',\r\n    })\r\n    .when('/admin/users/create', {\r\n      templateUrl: 'public/app/features/admin/partials/new_user.html',\r\n      controller: 'AdminEditUserCtrl',\r\n    })\r\n    // .when('/admin/users/edit/:id', {\r\n    //   templateUrl: 'public/app/features/admin/partials/edit_user.html',\r\n    //   controller: 'AdminEditUserCtrl',\r\n    // })\r\n    .when('/admin/users/edit/:id', {\r\n      template: '<react-container />',\r\n      resolve: {\r\n        component: () => UserAdminPage,\r\n      },\r\n    })\r\n    .when('/admin/orgs', {\r\n      templateUrl: 'public/app/features/admin/partials/orgs.html',\r\n      controller: 'AdminListOrgsCtrl',\r\n      controllerAs: 'ctrl',\r\n    })\r\n    .when('/admin/orgs/edit/:id', {\r\n      templateUrl: 'public/app/features/admin/partials/edit_org.html',\r\n      controller: 'AdminEditOrgCtrl',\r\n      controllerAs: 'ctrl',\r\n    })\r\n    .when('/admin/stats', {\r\n      template: '<react-container />',\r\n      resolve: {\r\n        component: () =>\r\n          SafeDynamicImport(import(/* webpackChunkName: \"ServerStats\" */ 'app/features/admin/ServerStats')),\r\n      },\r\n    })\r\n    .when('/admin/ldap', {\r\n      template: '<react-container />',\r\n      resolve: {\r\n        component: () => LdapPage,\r\n      },\r\n    })\r\n    // LOGIN / SIGNUP\r\n    .when('/login', {\r\n      template: '<react-container/>',\r\n      resolve: {\r\n        component: () => LoginPage,\r\n      },\r\n      pageClass: 'login-page sidemenu-hidden',\r\n    })\r\n    .when('/invite/:code', {\r\n      templateUrl: 'public/app/partials/signup_invited.html',\r\n      controller: 'InvitedCtrl',\r\n      pageClass: 'sidemenu-hidden',\r\n    })\r\n    .when('/signup', {\r\n      templateUrl: 'public/app/partials/signup_step2.html',\r\n      controller: 'SignUpCtrl',\r\n      pageClass: 'sidemenu-hidden',\r\n    })\r\n    .when('/user/password/send-reset-email', {\r\n      templateUrl: 'public/app/partials/reset_password.html',\r\n      controller: 'ResetPasswordCtrl',\r\n      pageClass: 'sidemenu-hidden',\r\n    })\r\n    .when('/user/password/reset', {\r\n      templateUrl: 'public/app/partials/reset_password.html',\r\n      controller: 'ResetPasswordCtrl',\r\n      pageClass: 'sidemenu-hidden',\r\n    })\r\n    .when('/dashboard/snapshots', {\r\n      templateUrl: 'public/app/features/manage-dashboards/partials/snapshot_list.html',\r\n      controller: 'SnapshotListCtrl',\r\n      controllerAs: 'ctrl',\r\n    })\r\n    .when('/plugins', {\r\n      template: '<react-container />',\r\n      resolve: {\r\n        component: () =>\r\n          SafeDynamicImport(import(/* webpackChunkName: \"PluginListPage\" */ 'app/features/plugins/PluginListPage')),\r\n      },\r\n    })\r\n    .when('/plugins/:pluginId/', {\r\n      template: '<react-container />',\r\n      reloadOnSearch: false, // tabs from query parameters\r\n      resolve: {\r\n        component: () =>\r\n          SafeDynamicImport(import(/* webpackChunkName: \"PluginPage\" */ '../features/plugins/PluginPage')),\r\n      },\r\n    })\r\n    .when('/plugins/:pluginId/page/:slug', {\r\n      templateUrl: 'public/app/features/plugins/partials/plugin_page.html',\r\n      controller: 'AppPageCtrl',\r\n      controllerAs: 'ctrl',\r\n    })\r\n    .when('/alerting', {\r\n      redirectTo: '/alerting/list',\r\n    })\r\n    .when('/alerting/list', {\r\n      template: '<react-container />',\r\n      reloadOnSearch: false,\r\n      resolve: {\r\n        component: () =>\r\n          SafeDynamicImport(import(/* webpackChunkName: \"AlertRuleList\" */ 'app/features/alerting/AlertRuleList')),\r\n      },\r\n    })\r\n    .when('/alerting/notifications', {\r\n      templateUrl: 'public/app/features/alerting/partials/notifications_list.html',\r\n      controller: 'AlertNotificationsListCtrl',\r\n      controllerAs: 'ctrl',\r\n    })\r\n    .when('/alerting/notification/new', {\r\n      templateUrl: 'public/app/features/alerting/partials/notification_edit.html',\r\n      controller: 'AlertNotificationEditCtrl',\r\n      controllerAs: 'ctrl',\r\n    })\r\n    .when('/alerting/notification/:id/edit', {\r\n      templateUrl: 'public/app/features/alerting/partials/notification_edit.html',\r\n      controller: 'AlertNotificationEditCtrl',\r\n      controllerAs: 'ctrl',\r\n    })\r\n    .otherwise({\r\n      templateUrl: 'public/app/partials/error.html',\r\n      controller: 'ErrorCtrl',\r\n    });\r\n\r\n  applyRouteRegistrationHandlers($routeProvider);\r\n}\r\n","import { configureStore as reduxConfigureStore } from '@reduxjs/toolkit';\r\nimport { createLogger } from 'redux-logger';\r\nimport thunk from 'redux-thunk';\r\n\r\nimport { setStore } from './store';\r\nimport { StoreState } from 'app/types/store';\r\nimport { toggleLogActionsMiddleware } from 'app/core/middlewares/application';\r\nimport { addReducer, createRootReducer } from '../core/reducers/root';\r\nimport { buildInitialState } from '../core/reducers/navModel';\r\n\r\nexport function addRootReducer(reducers: any) {\r\n  // this is ok now because we add reducers before configureStore is called\r\n  // in the future if we want to add reducers during runtime\r\n  // we'll have to solve this in a more dynamic way\r\n  addReducer(reducers);\r\n}\r\n\r\nexport function configureStore() {\r\n  const logger = createLogger({\r\n    predicate: (getState: () => StoreState) => {\r\n      return getState().application.logActions;\r\n    },\r\n  });\r\n\r\n  const middleware = process.env.NODE_ENV !== 'production' ? [toggleLogActionsMiddleware, thunk, logger] : [thunk];\r\n\r\n  const store = reduxConfigureStore({\r\n    reducer: createRootReducer(),\r\n    middleware,\r\n    devTools: process.env.NODE_ENV !== 'production',\r\n    preloadedState: {\r\n      navIndex: buildInitialState(),\r\n    },\r\n  });\r\n\r\n  setStore(store);\r\n  return store;\r\n}\r\n","import { StoreState } from 'app/types';\r\nimport { Store } from 'redux';\r\n\r\nexport let store: Store<StoreState>;\r\n\r\nexport function setStore(newStore: Store<StoreState>) {\r\n  store = newStore;\r\n}\r\n","export enum OrgRole {\r\n  Viewer = 'Viewer',\r\n  Editor = 'Editor',\r\n  Admin = 'Admin',\r\n}\r\n\r\nexport interface DashboardAclDTO {\r\n  id?: number;\r\n  dashboardId?: number;\r\n  userId?: number;\r\n  userLogin?: string;\r\n  userEmail?: string;\r\n  teamId?: number;\r\n  team?: string;\r\n  permission?: PermissionLevel;\r\n  role?: OrgRole;\r\n  icon?: string;\r\n  inherited?: boolean;\r\n}\r\n\r\nexport interface DashboardAclUpdateDTO {\r\n  userId: number;\r\n  teamId: number;\r\n  role: OrgRole;\r\n  permission: PermissionLevel;\r\n}\r\n\r\nexport interface DashboardAcl {\r\n  id?: number;\r\n  dashboardId?: number;\r\n  userId?: number;\r\n  userLogin?: string;\r\n  userEmail?: string;\r\n  teamId?: number;\r\n  team?: string;\r\n  permission?: PermissionLevel;\r\n  role?: OrgRole;\r\n  icon?: string;\r\n  name?: string;\r\n  inherited?: boolean;\r\n  sortRank?: number;\r\n  userAvatarUrl?: string;\r\n  teamAvatarUrl?: string;\r\n}\r\n\r\nexport interface DashboardPermissionInfo {\r\n  value: PermissionLevel;\r\n  label: string;\r\n  description: string;\r\n}\r\n\r\nexport interface NewDashboardAclItem {\r\n  teamId: number;\r\n  userId: number;\r\n  role?: OrgRole;\r\n  permission: PermissionLevel;\r\n  type: AclTarget;\r\n}\r\n\r\nexport enum PermissionLevel {\r\n  View = 1,\r\n  Edit = 2,\r\n  Admin = 4,\r\n}\r\n\r\nexport enum DataSourcePermissionLevel {\r\n  Query = 1,\r\n  Admin = 2,\r\n}\r\n\r\nexport enum AclTarget {\r\n  Team = 'Team',\r\n  User = 'User',\r\n  Viewer = 'Viewer',\r\n  Editor = 'Editor',\r\n}\r\n\r\nexport interface AclTargetInfo {\r\n  value: AclTarget;\r\n  text: string;\r\n}\r\n\r\nexport const dataSourceAclLevels = [\r\n  { value: DataSourcePermissionLevel.Query, label: 'Query', description: 'Can query data source.' },\r\n];\r\n\r\nexport const dashboardAclTargets: AclTargetInfo[] = [\r\n  { value: AclTarget.Team, text: 'Team' },\r\n  { value: AclTarget.User, text: 'User' },\r\n  { value: AclTarget.Viewer, text: 'Everyone With Viewer Role' },\r\n  { value: AclTarget.Editor, text: 'Everyone With Editor Role' },\r\n];\r\n\r\nexport const dashboardPermissionLevels: DashboardPermissionInfo[] = [\r\n  { value: PermissionLevel.View, label: 'View', description: 'Can view dashboards.' },\r\n  { value: PermissionLevel.Edit, label: 'Edit', description: 'Can add, edit and delete dashboards.' },\r\n  {\r\n    value: PermissionLevel.Admin,\r\n    label: 'Admin',\r\n    description: 'Can add/remove permissions and can add, edit and delete dashboards.',\r\n  },\r\n];\r\n\r\nexport enum TeamPermissionLevel {\r\n  Member = 0,\r\n  Admin = 4,\r\n}\r\n\r\nexport interface TeamPermissionInfo {\r\n  value: TeamPermissionLevel;\r\n  label: string;\r\n  description: string;\r\n}\r\n\r\nexport const teamsPermissionLevels: TeamPermissionInfo[] = [\r\n  { value: TeamPermissionLevel.Member, label: 'Member', description: 'Is team member' },\r\n  {\r\n    value: TeamPermissionLevel.Admin,\r\n    label: 'Admin',\r\n    description: 'Can add/remove permissions, members and delete team.',\r\n  },\r\n];\r\n","export interface AppNotification {\r\n  id: number;\r\n  severity: AppNotificationSeverity;\r\n  icon: string;\r\n  title: string;\r\n  text: string;\r\n  component?: React.ReactElement;\r\n  timeout: AppNotificationTimeout;\r\n}\r\n\r\nexport enum AppNotificationSeverity {\r\n  Success = 'success',\r\n  Warning = 'warning',\r\n  Error = 'error',\r\n  Info = 'info',\r\n}\r\n\r\nexport enum AppNotificationTimeout {\r\n  Warning = 5000,\r\n  Success = 3000,\r\n  Error = 7000,\r\n}\r\n\r\nexport interface AppNotificationsState {\r\n  appNotifications: AppNotification[];\r\n}\r\n","import { DashboardAcl } from './acl';\r\nimport { DataQuery } from '@grafana/data';\r\n\r\nexport interface MutableDashboard {\r\n  title: string;\r\n  meta: DashboardMeta;\r\n  destroy: () => void;\r\n}\r\n\r\nexport interface DashboardDTO {\r\n  redirectUri?: string;\r\n  dashboard: DashboardDataDTO;\r\n  meta: DashboardMeta;\r\n}\r\n\r\nexport interface DashboardMeta {\r\n  canSave?: boolean;\r\n  canEdit?: boolean;\r\n  canDelete?: boolean;\r\n  canShare?: boolean;\r\n  canStar?: boolean;\r\n  canAdmin?: boolean;\r\n  url?: string;\r\n  folderId?: number;\r\n  fullscreen?: boolean;\r\n  fromExplore?: boolean;\r\n  isEditing?: boolean;\r\n  canMakeEditable?: boolean;\r\n  submenuEnabled?: boolean;\r\n  provisioned?: boolean;\r\n  provisionedExternalId?: string;\r\n  focusPanelId?: number;\r\n  isStarred?: boolean;\r\n  showSettings?: boolean;\r\n  expires?: string;\r\n  isSnapshot?: boolean;\r\n  folderTitle?: string;\r\n  folderUrl?: string;\r\n  created?: string;\r\n}\r\n\r\nexport interface DashboardDataDTO {\r\n  title: string;\r\n}\r\n\r\nexport enum DashboardRouteInfo {\r\n  Home = 'home-dashboard',\r\n  New = 'new-dashboard',\r\n  Normal = 'normal-dashboard',\r\n  Scripted = 'scripted-dashboard',\r\n}\r\n\r\nexport enum DashboardInitPhase {\r\n  NotStarted = 'Not started',\r\n  Fetching = 'Fetching',\r\n  Services = 'Services',\r\n  Failed = 'Failed',\r\n  Completed = 'Completed',\r\n}\r\n\r\nexport interface DashboardInitError {\r\n  message: string;\r\n  error: any;\r\n}\r\n\r\nexport const KIOSK_MODE_TV = 'tv';\r\nexport type KioskUrlValue = 'tv' | '1' | true;\r\n\r\nexport interface DashboardState {\r\n  model: MutableDashboard | null;\r\n  initPhase: DashboardInitPhase;\r\n  isInitSlow: boolean;\r\n  initError?: DashboardInitError;\r\n  permissions: DashboardAcl[] | null;\r\n  modifiedQueries?: {\r\n    panelId: number;\r\n    queries: DataQuery[];\r\n  };\r\n}\r\n","import { DataFrame, eventFactory, TimeRange } from '@grafana/data';\r\nimport { IHttpResponse } from 'angular';\r\nimport { DashboardModel } from 'app/features/dashboard/state';\r\n\r\n/**\r\n * Event Payloads\r\n */\r\n\r\nexport interface ShowDashSearchPayload {\r\n  query?: string;\r\n}\r\n\r\nexport interface LocationChangePayload {\r\n  href: string;\r\n}\r\n\r\nexport interface ShowModalPayload {\r\n  model?: any;\r\n  modalClass?: string;\r\n  src?: string;\r\n  templateHtml?: string;\r\n  backdrop?: any;\r\n  scope?: any;\r\n}\r\n\r\nexport interface ShowConfirmModalPayload {\r\n  title?: string;\r\n  text?: string;\r\n  text2?: string;\r\n  text2htmlBind?: boolean;\r\n  confirmText?: string;\r\n  altActionText?: string;\r\n  yesText?: string;\r\n  noText?: string;\r\n  icon?: string;\r\n\r\n  onConfirm?: () => void;\r\n  onAltAction?: () => void;\r\n}\r\n\r\ntype DataSourceResponsePayload = IHttpResponse<any>;\r\n\r\nexport interface SaveDashboardPayload {\r\n  overwrite?: boolean;\r\n  folderId?: number;\r\n  makeEditable?: boolean;\r\n}\r\n\r\nexport interface GraphHoverPayload {\r\n  pos: any;\r\n  panel: {\r\n    id: number;\r\n  };\r\n}\r\n\r\nexport interface ToggleKioskModePayload {\r\n  exit?: boolean;\r\n}\r\n\r\nexport interface GraphClickedPayload {\r\n  pos: any;\r\n  panel: any;\r\n  item: any;\r\n}\r\n\r\nexport interface ThresholdChangedPayload {\r\n  threshold: any;\r\n  handleIndex: any;\r\n}\r\n\r\nexport interface DashScrollPayload {\r\n  restore?: boolean;\r\n  animate?: boolean;\r\n  pos?: number;\r\n}\r\n\r\n/**\r\n * Events\r\n */\r\n\r\nexport const showDashSearch = eventFactory<ShowDashSearchPayload>('show-dash-search');\r\nexport const hideDashSearch = eventFactory('hide-dash-search');\r\nexport const hideDashEditor = eventFactory('hide-dash-editor');\r\nexport const dashScroll = eventFactory<DashScrollPayload>('dash-scroll');\r\nexport const dashLinksUpdated = eventFactory('dash-links-updated');\r\nexport const saveDashboard = eventFactory<SaveDashboardPayload>('save-dashboard');\r\nexport const dashboardFetchStart = eventFactory('dashboard-fetch-start');\r\nexport const dashboardSaved = eventFactory<DashboardModel>('dashboard-saved');\r\nexport const removePanel = eventFactory<number>('remove-panel');\r\n\r\nexport const searchQuery = eventFactory('search-query');\r\n\r\nexport const locationChange = eventFactory<LocationChangePayload>('location-change');\r\n\r\nexport const timepickerOpen = eventFactory('timepickerOpen');\r\nexport const timepickerClosed = eventFactory('timepickerClosed');\r\n\r\nexport const showModal = eventFactory<ShowModalPayload>('show-modal');\r\nexport const showConfirmModal = eventFactory<ShowConfirmModalPayload>('confirm-modal');\r\nexport const hideModal = eventFactory('hide-modal');\r\n\r\nexport const dsRequestResponse = eventFactory<DataSourceResponsePayload>('ds-request-response');\r\nexport const dsRequestError = eventFactory<any>('ds-request-error');\r\n\r\nexport const graphHover = eventFactory<GraphHoverPayload>('graph-hover');\r\nexport const graphHoverClear = eventFactory('graph-hover-clear');\r\n\r\nexport const toggleSidemenuMobile = eventFactory('toggle-sidemenu-mobile');\r\nexport const toggleSidemenuHidden = eventFactory('toggle-sidemenu-hidden');\r\n\r\nexport const playlistStarted = eventFactory('playlist-started');\r\nexport const playlistStopped = eventFactory('playlist-stopped');\r\n\r\nexport const toggleKioskMode = eventFactory<ToggleKioskModePayload>('toggle-kiosk-mode');\r\nexport const toggleViewMode = eventFactory('toggle-view-mode');\r\n\r\nexport const timeRangeUpdated = eventFactory<TimeRange>('time-range-updated');\r\n\r\nexport const repeatsProcessed = eventFactory('repeats-processed');\r\nexport const rowExpanded = eventFactory('row-expanded');\r\nexport const rowCollapsed = eventFactory('row-collapsed');\r\nexport const templateVariableValueUpdated = eventFactory('template-variable-value-updated');\r\nexport const submenuVisibilityChanged = eventFactory<boolean>('submenu-visibility-changed');\r\n\r\nexport const dataFramesReceived = eventFactory<DataFrame[]>('data-frames-received');\r\n\r\nexport const graphClicked = eventFactory<GraphClickedPayload>('graph-click');\r\n\r\nexport const thresholdChanged = eventFactory<ThresholdChangedPayload>('threshold-changed');\r\n\r\nexport const zoomOut = eventFactory<number>('zoom-out');\r\n\r\nexport const shiftTime = eventFactory<number>('shift-time');\r\n\r\nexport const elasticQueryUpdated = eventFactory('elastic-query-updated');\r\n\r\nexport const layoutModeChanged = eventFactory<string>('layout-mode-changed');\r\n\r\nexport const jsonDiffReady = eventFactory('json-diff-ready');\r\n\r\nexport const closeTimepicker = eventFactory('closeTimepicker');\r\n\r\nexport const routeUpdated = eventFactory('$routeUpdate');\r\n","import { Unsubscribable } from 'rxjs';\r\nimport {\r\n  HistoryItem,\r\n  DataQuery,\r\n  DataSourceApi,\r\n  QueryHint,\r\n  PanelData,\r\n  DataQueryRequest,\r\n  RawTimeRange,\r\n  LogLevel,\r\n  TimeRange,\r\n  LogsModel,\r\n  LogsDedupStrategy,\r\n  AbsoluteTimeRange,\r\n  GraphSeriesXY,\r\n  DataFrame,\r\n} from '@grafana/data';\r\n\r\nimport { Emitter } from 'app/core/core';\r\n\r\nexport enum ExploreMode {\r\n  Metrics = 'Metrics',\r\n  Logs = 'Logs',\r\n}\r\n\r\nexport enum ExploreId {\r\n  left = 'left',\r\n  right = 'right',\r\n}\r\n\r\n/**\r\n * Global Explore state\r\n */\r\nexport interface ExploreState {\r\n  /**\r\n   * True if split view is active.\r\n   */\r\n  split: boolean;\r\n  /**\r\n   * True if time interval for panels are synced. Only possible with split mode.\r\n   */\r\n  syncedTimes: boolean;\r\n  /**\r\n   * Explore state of the left split (left is default in non-split view).\r\n   */\r\n  left: ExploreItemState;\r\n  /**\r\n   * Explore state of the right area in split view.\r\n   */\r\n  right: ExploreItemState;\r\n}\r\n\r\nexport interface ExploreItemState {\r\n  /**\r\n   * Width used for calculating the graph interval (can't have more datapoints than pixels)\r\n   */\r\n  containerWidth: number;\r\n  /**\r\n   * Datasource instance that has been selected. Datasource-specific logic can be run on this object.\r\n   */\r\n  datasourceInstance?: DataSourceApi;\r\n  /**\r\n   * Current data source name or null if default\r\n   */\r\n  requestedDatasourceName: string | null;\r\n  /**\r\n   * True if the datasource is loading. `null` if the loading has not started yet.\r\n   */\r\n  datasourceLoading?: boolean;\r\n  /**\r\n   * True if there is no datasource to be selected.\r\n   */\r\n  datasourceMissing: boolean;\r\n  /**\r\n   * Emitter to send events to the rest of Grafana.\r\n   */\r\n  eventBridge?: Emitter;\r\n  /**\r\n   * List of timeseries to be shown in the Explore graph result viewer.\r\n   */\r\n  graphResult?: GraphSeriesXY[];\r\n  /**\r\n   * History of recent queries. Datasource-specific and initialized via localStorage.\r\n   */\r\n  history: HistoryItem[];\r\n  /**\r\n   * Queries for this Explore, e.g., set via URL. Each query will be\r\n   * converted to a query row.\r\n   */\r\n  queries: DataQuery[];\r\n  /**\r\n   * True if this Explore area has been initialized.\r\n   * Used to distinguish URL state injection versus split view state injection.\r\n   */\r\n  initialized: boolean;\r\n  /**\r\n   * Log line substrings to be highlighted as you type in a query field.\r\n   * Currently supports only the first query row.\r\n   */\r\n  logsHighlighterExpressions?: string[];\r\n  /**\r\n   * Log query result to be displayed in the logs result viewer.\r\n   */\r\n  logsResult?: LogsModel;\r\n\r\n  /**\r\n   * Time range for this Explore. Managed by the time picker and used by all query runs.\r\n   */\r\n  range: TimeRange;\r\n\r\n  absoluteRange: AbsoluteTimeRange;\r\n  /**\r\n   * True if scanning for more results is active.\r\n   */\r\n  scanning?: boolean;\r\n  /**\r\n   * Current scanning range to be shown to the user while scanning is active.\r\n   */\r\n  scanRange?: RawTimeRange;\r\n  /**\r\n   * True if graph result viewer is expanded. Query runs will contain graph queries.\r\n   */\r\n  showingGraph: boolean;\r\n  /**\r\n   * True if table result viewer is expanded. Query runs will contain table queries.\r\n   */\r\n  showingTable: boolean;\r\n\r\n  loading: boolean;\r\n  /**\r\n   * Table model that combines all query table results into a single table.\r\n   */\r\n  tableResult?: DataFrame;\r\n\r\n  /**\r\n   * React keys for rendering of QueryRows\r\n   */\r\n  queryKeys: string[];\r\n\r\n  /**\r\n   * Current logs deduplication strategy\r\n   */\r\n  dedupStrategy?: LogsDedupStrategy;\r\n\r\n  /**\r\n   * Currently hidden log series\r\n   */\r\n  hiddenLogLevels?: LogLevel[];\r\n\r\n  /**\r\n   * How often query should be refreshed\r\n   */\r\n  refreshInterval?: string;\r\n\r\n  /**\r\n   * Copy of the state of the URL which is in store.location.query. This is duplicated here so we can diff the two\r\n   * after a change to see if we need to sync url state back to redux store (like on clicking Back in browser).\r\n   */\r\n  urlState: ExploreUrlState;\r\n\r\n  /**\r\n   * Map of what changed between real url and local urlState so we can partially update just the things that are needed.\r\n   */\r\n  update: ExploreUpdateState;\r\n\r\n  latency: number;\r\n  supportedModes: ExploreMode[];\r\n  mode: ExploreMode;\r\n\r\n  /**\r\n   * If true, the view is in live tailing mode.\r\n   */\r\n  isLive: boolean;\r\n\r\n  /**\r\n   * If true, the live tailing view is paused.\r\n   */\r\n  isPaused: boolean;\r\n  urlReplaced: boolean;\r\n\r\n  querySubscription?: Unsubscribable;\r\n\r\n  queryResponse: PanelData;\r\n\r\n  /**\r\n   * Panel Id that is set if we come to explore from a penel. Used so we can get back to it and optionally modify the\r\n   * query of that panel.\r\n   */\r\n  originPanelId?: number;\r\n}\r\n\r\nexport interface ExploreUpdateState {\r\n  datasource: boolean;\r\n  queries: boolean;\r\n  range: boolean;\r\n  mode: boolean;\r\n  ui: boolean;\r\n}\r\n\r\nexport interface ExploreUIState {\r\n  showingTable: boolean;\r\n  showingGraph: boolean;\r\n  showingLogs: boolean;\r\n  dedupStrategy?: LogsDedupStrategy;\r\n}\r\n\r\nexport interface ExploreUrlState {\r\n  datasource: string;\r\n  queries: any[]; // Should be a DataQuery, but we're going to strip refIds, so typing makes less sense\r\n  mode: ExploreMode;\r\n  range: RawTimeRange;\r\n  ui: ExploreUIState;\r\n  originPanelId?: number;\r\n  context?: string;\r\n}\r\n\r\nexport interface QueryOptions {\r\n  minInterval: string;\r\n  maxDataPoints?: number;\r\n  liveStreaming?: boolean;\r\n  showingGraph?: boolean;\r\n  showingTable?: boolean;\r\n  mode?: ExploreMode;\r\n}\r\n\r\nexport interface QueryTransaction {\r\n  id: string;\r\n  done: boolean;\r\n  error?: string | JSX.Element;\r\n  hints?: QueryHint[];\r\n  latency: number;\r\n  request: DataQueryRequest;\r\n  queries: DataQuery[];\r\n  result?: any; // Table model / Timeseries[] / Logs\r\n  scanning?: boolean;\r\n}\r\n","export * from './teams';\r\nexport * from './alerting';\r\nexport * from './location';\r\nexport * from './folders';\r\nexport * from './dashboard';\r\nexport * from './acl';\r\nexport * from './apiKeys';\r\nexport * from './user';\r\nexport * from './datasources';\r\nexport * from './plugins';\r\nexport * from './organization';\r\nexport * from './appNotifications';\r\nexport * from './search';\r\nexport * from './explore';\r\nexport * from './store';\r\nexport * from './ldap';\r\nexport * from './appEvent';\r\nexport * from './angular';\r\n\r\nimport * as CoreEvents from './events';\r\nexport { CoreEvents };\r\n","export enum DashboardSearchHitType {\r\n  DashHitDB = 'dash-db',\r\n  DashHitHome = 'dash-home',\r\n  DashHitFolder = 'dash-folder',\r\n}\r\nexport interface DashboardSearchHit {\r\n  id: number;\r\n  uid: string;\r\n  title: string;\r\n  uri: string;\r\n  url: string;\r\n  slug: string;\r\n  type: DashboardSearchHitType;\r\n  tags: string[];\r\n  isStarred: boolean;\r\n  folderId: number;\r\n  folderUid: string;\r\n  folderTitle: string;\r\n  folderUrl: string;\r\n}\r\n","/**\n * AngularStrap - Twitter Bootstrap directives for AngularJS\n * @version v0.7.5 - 2013-07-21\n * @link http://mgcrea.github.com/angular-strap\n * @author Olivier Louvignes <olivier@mg-crea.com>\n * @license MIT License, http://www.opensource.org/licenses/MIT\n */\nangular.module('$strap.config', []).value('$strapConfig', {});\nangular.module('$strap.filters', ['$strap.config']);\nangular.module('$strap.directives', ['$strap.config']);\nangular.module('$strap', [\n  '$strap.filters',\n  '$strap.directives',\n  '$strap.config'\n]);\n'use strict';\nangular.module('$strap.directives').factory('$modal', [\n  '$rootScope',\n  '$compile',\n  '$http',\n  '$timeout',\n  '$q',\n  '$templateCache',\n  '$strapConfig',\n  function ($rootScope, $compile, $http, $timeout, $q, $templateCache, $strapConfig) {\n    var ModalFactory = function ModalFactory(config) {\n      function Modal(config) {\n        var options = angular.extend({ show: true }, $strapConfig.modal, config);\n        var scope = options.scope ? options.scope : $rootScope.$new()\n        var templateUrl = options.template;\n        return $q.when(options.templateHtml || $templateCache.get(templateUrl) || $http.get(templateUrl, { cache: true }).then(function (res) {\n          return res.data;\n        })).then(function onSuccess(template) {\n          var id = scope.$id;\n          if (templateUrl) {\n            id += templateUrl.replace('.html', '').replace(/[\\/|\\.|:]/g, '-');\n          }\n          // grafana change, removed fade\n          var $modal = $('<div class=\"modal hide\" tabindex=\"-1\"></div>').attr('id', id).html(template);\n          if (options.modalClass)\n            $modal.addClass(options.modalClass);\n          $('body').append($modal);\n          $timeout(function () {\n            $compile($modal)(scope);\n          });\n          scope.$modal = function (name) {\n            $modal.modal(name);\n          };\n          angular.forEach([\n            'show',\n            'hide'\n          ], function (name) {\n            scope[name] = function () {\n              $modal.modal(name);\n            };\n          });\n          scope.dismiss = scope.hide;\n          angular.forEach([\n            'show',\n            'shown',\n            'hide',\n            'hidden'\n          ], function (name) {\n            $modal.on(name, function (ev) {\n              scope.$emit('modal-' + name, ev);\n            });\n          });\n          $modal.on('shown', function (ev) {\n            $('input[autofocus], textarea[autofocus]', $modal).first().trigger('focus');\n          });\n          $modal.on('hidden', function (ev) {\n            if (!options.persist)\n              scope.$destroy();\n          });\n          scope.$on('$destroy', function () {\n            $modal.remove();\n          });\n          $modal.modal(options);\n          return $modal;\n        });\n      }\n      return new Modal(config);\n    };\n    return ModalFactory;\n  }\n])\n\n'use strict';\nangular.module('$strap.directives').directive('bsTooltip', [\n  '$parse',\n  '$compile',\n  function ($parse, $compile) {\n    return {\n      restrict: 'A',\n      scope: true,\n      link: function postLink(scope, element, attrs, ctrl) {\n        var getter = $parse(attrs.bsTooltip), setter = getter.assign, value = getter(scope);\n        scope.$watch(attrs.bsTooltip, function (newValue, oldValue) {\n          if (newValue !== oldValue) {\n            value = newValue;\n          }\n        });\n        // Grafana change, always hide other tooltips\n        if (true) {\n          element.on('show', function (ev) {\n            $('.tooltip.in').each(function () {\n              var $this = $(this), tooltip = $this.data('tooltip');\n              if (tooltip && !tooltip.$element.is(element)) {\n                $this.tooltip('hide');\n              }\n            });\n          });\n        }\n        element.tooltip({\n          title: function () {\n            return angular.isFunction(value) ? value.apply(null, arguments) : value;\n          },\n          html: true,\n          container: 'body', // Grafana change\n        });\n        var tooltip = element.data('tooltip');\n        tooltip.show = function () {\n          var r = $.fn.tooltip.Constructor.prototype.show.apply(this, arguments);\n          this.tip().data('tooltip', this);\n          return r;\n        };\n        scope._tooltip = function (event) {\n          element.tooltip(event);\n        };\n        scope.hide = function () {\n          element.tooltip('hide');\n        };\n        scope.show = function () {\n          element.tooltip('show');\n        };\n        scope.dismiss = scope.hide;\n      }\n    };\n  }\n]);\n\n'use strict';\nangular.module('$strap.directives').directive('bsTypeahead', [\n  '$parse',\n  function ($parse) {\n    return {\n      restrict: 'A',\n      require: '?ngModel',\n      link: function postLink(scope, element, attrs, controller) {\n        var getter = $parse(attrs.bsTypeahead), setter = getter.assign, value = getter(scope);\n        scope.$watch(attrs.bsTypeahead, function (newValue, oldValue) {\n          if (newValue !== oldValue) {\n            value = newValue;\n          }\n        });\n        element.attr('data-provide', 'typeahead');\n        element.typeahead({\n          source: function (query) {\n            return angular.isFunction(value) ? value.apply(null, arguments) : value;\n          },\n          minLength: attrs.minLength || 1,\n          items: attrs.items,\n          updater: function (value) {\n            if (controller) {\n              scope.$apply(function () {\n                controller.$setViewValue(value);\n              });\n            }\n            scope.$emit('typeahead-updated', value);\n            return value;\n          }\n        });\n        var typeahead = element.data('typeahead');\n        typeahead.lookup = function (ev) {\n          var items;\n          this.query = this.$element.val() || '';\n          if (this.query.length < this.options.minLength) {\n            return this.shown ? this.hide() : this;\n          }\n          items = $.isFunction(this.source) ? this.source(this.query, $.proxy(this.process, this)) : this.source;\n          return items ? this.process(items) : this;\n        };\n        if (!!attrs.matchAll) {\n          typeahead.matcher = function (item) {\n            return true;\n          };\n        }\n        if (attrs.minLength === '0') {\n          setTimeout(function () {\n            element.on('focus', function () {\n              element.val().length === 0 && setTimeout(element.typeahead.bind(element, 'lookup'), 200);\n            });\n          });\n        }\n      }\n    };\n  }\n]);\n","/* ===================================================\n * bootstrap-transition.js v2.3.2\n * http://getbootstrap.com/2.3.2/javascript.html#transitions\n * ===================================================\n * Copyright 2013 Twitter, Inc.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n * ========================================================== */\n\n\n!function ($) {\n\n  \"use strict\"; // jshint ;_;\n\n\n  /* CSS TRANSITION SUPPORT (http://www.modernizr.com/)\n   * ======================================================= */\n\n  $(function () {\n\n    $.support.transition = (function () {\n\n      var transitionEnd = (function () {\n\n        var el = document.createElement('bootstrap')\n          , transEndEventNames = {\n               'WebkitTransition' : 'webkitTransitionEnd'\n            ,  'MozTransition'    : 'transitionend'\n            ,  'OTransition'      : 'oTransitionEnd otransitionend'\n            ,  'transition'       : 'transitionend'\n            }\n          , name\n\n        for (name in transEndEventNames){\n          if (el.style[name] !== undefined) {\n            return transEndEventNames[name]\n          }\n        }\n\n      }())\n\n      return transitionEnd && {\n        end: transitionEnd\n      }\n\n    })()\n\n  })\n\n}(window.jQuery);/* ==========================================================\n * bootstrap-alert.js v2.3.2\n * http://getbootstrap.com/2.3.2/javascript.html#alerts\n * ==========================================================\n * Copyright 2013 Twitter, Inc.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n * ========================================================== */\n\n\n!function ($) {\n\n  \"use strict\"; // jshint ;_;\n\n/* ============================================================\n * bootstrap-dropdown.js v2.3.2\n * http://getbootstrap.com/2.3.2/javascript.html#dropdowns\n * ============================================================\n * Copyright 2013 Twitter, Inc.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n * ============================================================ */\n\n\n /* DROPDOWN CLASS DEFINITION\n  * ========================= */\n\n  var toggle = '[data-toggle=dropdown]'\n    , Dropdown = function (element) {\n        var $el = $(element).on('click.dropdown.data-api', this.toggle)\n        $('html').on('click.dropdown.data-api', function () {\n          $el.parent().removeClass('open')\n        })\n      }\n\n  Dropdown.prototype = {\n\n    constructor: Dropdown\n\n  , toggle: function (e) {\n      var $this = $(this)\n        , $parent\n        , isActive\n\n      if ($this.is('.disabled, :disabled')) return\n\n      $parent = getParent($this)\n\n      isActive = $parent.hasClass('open')\n\n      clearMenus()\n\n      if (!isActive) {\n        if ('ontouchstart' in document.documentElement) {\n          // if mobile we we use a backdrop because click events don't delegate\n          $('<div class=\"dropdown-backdrop\"/>').insertBefore($(this)).on('click', clearMenus)\n        }\n        $parent.toggleClass('open')\n      }\n\n      $this.focus()\n\n      return false\n    }\n\n  , keydown: function (e) {\n      var $this\n        , $items\n        , $active\n        , $parent\n        , isActive\n        , index\n\n      if (!/(38|40|27)/.test(e.keyCode)) return\n\n      $this = $(this)\n\n      e.preventDefault()\n      e.stopPropagation()\n\n      if ($this.is('.disabled, :disabled')) return\n\n      $parent = getParent($this)\n\n      isActive = $parent.hasClass('open')\n\n      if (!isActive || (isActive && e.keyCode == 27)) {\n        if (e.which == 27) $parent.find(toggle).focus()\n        return $this.click()\n      }\n\n      $items = $('[role=menu] li:not(.divider):visible a', $parent)\n\n      if (!$items.length) return\n\n      index = $items.index($items.filter(':focus'))\n\n      if (e.keyCode == 38 && index > 0) index--                                        // up\n      if (e.keyCode == 40 && index < $items.length - 1) index++                        // down\n      if (!~index) index = 0\n\n      $items\n        .eq(index)\n        .focus()\n    }\n\n  }\n\n  function clearMenus() {\n    $('.dropdown-backdrop').remove()\n    $(toggle).each(function () {\n      getParent($(this)).removeClass('open')\n    })\n  }\n\n  function getParent($this) {\n    var selector = $this.attr('data-target')\n      , $parent\n\n    if (!selector) {\n      selector = $this.attr('href')\n      // grafana backport fix from bootstrap 3\n      selector = selector && /#[A-Za-z]/.test(selector) && selector.replace(/.*(?=#[^\\s]*$)/, '') //strip for ie7\n    }\n\n    $parent = selector && $(selector)\n\n    if (!$parent || !$parent.length) $parent = $this.parent()\n\n    return $parent\n  }\n\n\n  /* DROPDOWN PLUGIN DEFINITION\n   * ========================== */\n\n  var old = $.fn.dropdown\n\n  $.fn.dropdown = function (option) {\n    return this.each(function () {\n      var $this = $(this)\n        , data = $this.data('dropdown')\n      if (!data) $this.data('dropdown', (data = new Dropdown(this)))\n      if (typeof option == 'string') data[option].call($this)\n    })\n  }\n\n  $.fn.dropdown.Constructor = Dropdown\n\n\n /* DROPDOWN NO CONFLICT\n  * ==================== */\n\n  $.fn.dropdown.noConflict = function () {\n    $.fn.dropdown = old\n    return this\n  }\n\n\n  /* APPLY TO STANDARD DROPDOWN ELEMENTS\n   * =================================== */\n\n  $(document)\n    .on('click.dropdown.data-api', clearMenus)\n    .on('click.dropdown.data-api', '.dropdown form', function (e) { e.stopPropagation() })\n    .on('click.dropdown.data-api'  , toggle, Dropdown.prototype.toggle)\n    .on('keydown.dropdown.data-api', toggle + ', [role=menu]' , Dropdown.prototype.keydown)\n\n}(window.jQuery);\n/* =========================================================\n * bootstrap-modal.js v2.3.2\n * http://getbootstrap.com/2.3.2/javascript.html#modals\n * =========================================================\n * Copyright 2013 Twitter, Inc.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n * ========================================================= */\n\n\n!function ($) {\n\n  \"use strict\"; // jshint ;_;\n\n\n /* MODAL CLASS DEFINITION\n  * ====================== */\n\n  var Modal = function (element, options) {\n    this.options = options\n    this.$element = $(element)\n      .delegate('[data-dismiss=\"modal\"]', 'click.dismiss.modal', $.proxy(this.hide, this))\n    this.options.remote && this.$element.find('.modal-body').load(this.options.remote)\n  }\n\n  Modal.prototype = {\n\n      constructor: Modal\n\n    , toggle: function () {\n        return this[!this.isShown ? 'show' : 'hide']()\n      }\n\n    , show: function () {\n        var that = this\n          , e = $.Event('show')\n\n        this.$element.trigger(e)\n\n        if (this.isShown || e.isDefaultPrevented()) return\n\n        this.isShown = true\n\n        this.escape()\n\n        this.backdrop(function () {\n          var transition = $.support.transition && that.$element.hasClass('fade')\n\n          if (!that.$element.parent().length) {\n            that.$element.appendTo(document.body) //don't move modals dom position\n          }\n\n          that.$element.show()\n\n          if (transition) {\n            that.$element[0].offsetWidth // force reflow\n          }\n\n          that.$element\n            .addClass('in')\n            .attr('aria-hidden', false)\n\n          that.enforceFocus()\n\n          transition ?\n            that.$element.one($.support.transition.end, function () { that.$element.focus().trigger('shown') }) :\n            that.$element.focus().trigger('shown')\n\n        })\n      }\n\n    , hide: function (e) {\n        e && e.preventDefault()\n\n        var that = this\n\n        e = $.Event('hide')\n\n        this.$element.trigger(e)\n\n        if (!this.isShown || e.isDefaultPrevented()) return\n\n        this.isShown = false\n\n        this.escape()\n\n        $(document).off('focusin.modal')\n\n        this.$element\n          .removeClass('in')\n          .attr('aria-hidden', true)\n\n        $.support.transition && this.$element.hasClass('fade') ?\n          this.hideWithTransition() :\n          this.hideModal()\n      }\n\n    , enforceFocus: function () {\n        var that = this\n        $(document).on('focusin.modal', function (e) {\n          if (that.$element[0] !== e.target && !that.$element.has(e.target).length) {\n            that.$element.focus()\n          }\n        })\n      }\n\n    , escape: function () {\n        var that = this\n        if (this.isShown && this.options.keyboard) {\n          this.$element.on('keyup.dismiss.modal', function ( e ) {\n            e.which == 27 && that.hide()\n          })\n        } else if (!this.isShown) {\n          this.$element.off('keyup.dismiss.modal')\n        }\n      }\n\n    , hideWithTransition: function () {\n        var that = this\n          , timeout = setTimeout(function () {\n              that.$element.off($.support.transition.end)\n              that.hideModal()\n            }, 500)\n\n        this.$element.one($.support.transition.end, function () {\n          clearTimeout(timeout)\n          that.hideModal()\n        })\n      }\n\n    , hideModal: function () {\n        var that = this\n        this.$element.hide()\n        this.backdrop(function () {\n          that.removeBackdrop()\n          that.$element.trigger('hidden')\n        })\n      }\n\n    , removeBackdrop: function () {\n        this.$backdrop && this.$backdrop.remove()\n        this.$backdrop = null\n      }\n\n    , backdrop: function (callback) {\n        var that = this\n          , animate = this.$element.hasClass('fade') ? 'fade' : ''\n\n        if (this.isShown && this.options.backdrop) {\n          var doAnimate = $.support.transition && animate\n\n          this.$backdrop = $('<div class=\"modal-backdrop ' + animate + '\" />')\n            .appendTo(document.body)\n\n          this.$backdrop.click(\n            this.options.backdrop == 'static' ?\n              $.proxy(this.$element[0].focus, this.$element[0])\n            : $.proxy(this.hide, this)\n          )\n\n          if (doAnimate) this.$backdrop[0].offsetWidth // force reflow\n\n          this.$backdrop.addClass('in')\n\n          if (!callback) return\n\n          doAnimate ?\n            this.$backdrop.one($.support.transition.end, callback) :\n            callback()\n\n        } else if (!this.isShown && this.$backdrop) {\n          this.$backdrop.removeClass('in')\n\n          $.support.transition && this.$element.hasClass('fade')?\n            this.$backdrop.one($.support.transition.end, callback) :\n            callback()\n\n        } else if (callback) {\n          callback()\n        }\n      }\n  }\n\n\n /* MODAL PLUGIN DEFINITION\n  * ======================= */\n\n  var old = $.fn.modal\n\n  $.fn.modal = function (option) {\n    return this.each(function () {\n      var $this = $(this)\n        , data = $this.data('modal')\n        , options = $.extend({}, $.fn.modal.defaults, $this.data(), typeof option == 'object' && option)\n      if (!data) $this.data('modal', (data = new Modal(this, options)))\n      if (typeof option == 'string') data[option]()\n      else if (options.show) data.show()\n    })\n  }\n\n  $.fn.modal.defaults = {\n      backdrop: true\n    , keyboard: true\n    , show: true\n  }\n\n  $.fn.modal.Constructor = Modal\n\n\n /* MODAL NO CONFLICT\n  * ================= */\n\n  $.fn.modal.noConflict = function () {\n    $.fn.modal = old\n    return this\n  }\n\n\n /* MODAL DATA-API\n  * ============== */\n\n  $(document).on('click.modal.data-api', '[data-toggle=\"modal\"]', function (e) {\n    var $this = $(this)\n      , href = $this.attr('href')\n      , $target = $($this.attr('data-target') || (href && href.replace(/.*(?=#[^\\s]+$)/, ''))) //strip for ie7\n      , option = $target.data('modal') ? 'toggle' : $.extend({ remote:!/#/.test(href) && href }, $target.data(), $this.data())\n\n    e.preventDefault()\n\n    $target\n      .modal(option)\n      .one('hide', function () {\n        $this.focus()\n      })\n  })\n\n}(window.jQuery);\n/* ===========================================================\n * bootstrap-tooltip.js v2.3.2\n * http://getbootstrap.com/2.3.2/javascript.html#tooltips\n * Inspired by the original jQuery.tipsy by Jason Frame\n * ===========================================================\n * Copyright 2013 Twitter, Inc.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n * ========================================================== */\n\n\n!function ($) {\n\n  \"use strict\"; // jshint ;_;\n\n\n /* TOOLTIP PUBLIC CLASS DEFINITION\n  * =============================== */\n\n  var Tooltip = function (element, options) {\n    this.init('tooltip', element, options)\n  }\n\n  Tooltip.prototype = {\n\n    constructor: Tooltip\n\n  , init: function (type, element, options) {\n      var eventIn\n        , eventOut\n        , triggers\n        , trigger\n        , i\n\n      this.type = type\n      this.$element = $(element)\n      this.options = this.getOptions(options)\n      this.enabled = true\n\n      triggers = this.options.trigger.split(' ')\n\n      for (i = triggers.length; i--;) {\n        trigger = triggers[i]\n        if (trigger == 'click') {\n          this.$element.on('click.' + this.type, this.options.selector, $.proxy(this.toggle, this))\n        } else if (trigger != 'manual') {\n          eventIn = trigger == 'hover' ? 'mouseenter' : 'focus'\n          eventOut = trigger == 'hover' ? 'mouseleave' : 'blur'\n          this.$element.on(eventIn + '.' + this.type, this.options.selector, $.proxy(this.enter, this))\n          this.$element.on(eventOut + '.' + this.type, this.options.selector, $.proxy(this.leave, this))\n        }\n      }\n\n      this.options.selector ?\n        (this._options = $.extend({}, this.options, { trigger: 'manual', selector: '' })) :\n        this.fixTitle()\n    }\n\n  , getOptions: function (options) {\n      options = $.extend({}, $.fn[this.type].defaults, this.$element.data(), options)\n\n      if (options.delay && typeof options.delay == 'number') {\n        options.delay = {\n          show: options.delay\n        , hide: options.delay\n        }\n      }\n\n      return options\n    }\n\n  , enter: function (e) {\n      var defaults = $.fn[this.type].defaults\n        , options = {}\n        , self\n\n      this._options && $.each(this._options, function (key, value) {\n        if (defaults[key] != value) options[key] = value\n      }, this)\n\n      self = $(e.currentTarget)[this.type](options).data(this.type)\n\n      if (!self.options.delay || !self.options.delay.show) return self.show()\n\n      clearTimeout(this.timeout)\n      self.hoverState = 'in'\n      this.timeout = setTimeout(function() {\n        if (self.hoverState == 'in') self.show()\n      }, self.options.delay.show)\n    }\n\n  , leave: function (e) {\n      var self = $(e.currentTarget)[this.type](this._options).data(this.type)\n\n      if (this.timeout) clearTimeout(this.timeout)\n      if (!self.options.delay || !self.options.delay.hide) return self.hide()\n\n      self.hoverState = 'out'\n      this.timeout = setTimeout(function() {\n        if (self.hoverState == 'out') self.hide()\n      }, self.options.delay.hide)\n    }\n\n  , show: function () {\n      var $tip\n        , pos\n        , actualWidth\n        , actualHeight\n        , placement\n        , tp\n        , e = $.Event('show')\n\n      if (this.hasContent() && this.enabled) {\n        this.$element.trigger(e)\n        if (e.isDefaultPrevented()) return\n        $tip = this.tip()\n        this.setContent()\n\n        if (this.options.animation) {\n          $tip.addClass('fade')\n        }\n\n        placement = typeof this.options.placement == 'function' ?\n          this.options.placement.call(this, $tip[0], this.$element[0]) :\n          this.options.placement\n\n        $tip\n          .detach()\n          .css({ top: 0, left: 0, display: 'block' })\n\n        this.options.container ? $tip.appendTo(this.options.container) : $tip.insertAfter(this.$element)\n\n        pos = this.getPosition()\n\n        actualWidth = $tip[0].offsetWidth\n        actualHeight = $tip[0].offsetHeight\n\n        switch (placement) {\n          case 'bottom':\n            tp = {top: pos.top + pos.height, left: pos.left + pos.width / 2 - actualWidth / 2}\n            break\n          case 'top':\n            tp = {top: pos.top - actualHeight, left: pos.left + pos.width / 2 - actualWidth / 2}\n            break\n          case 'left':\n            tp = {top: pos.top + pos.height / 2 - actualHeight / 2, left: pos.left - actualWidth}\n            break\n          case 'right':\n            tp = {top: pos.top + pos.height / 2 - actualHeight / 2, left: pos.left + pos.width}\n            break\n\n          // extend placements (top)\n          case 'topLeft':\n            tp = {top: pos.top - actualHeight,  left: pos.left + pos.width / 2 - (actualWidth * .10)};\n            break;\n          case 'topRight':\n            tp = {top: pos.top - actualHeight, left: pos.left + pos.width / 2 - (actualWidth * .90)};\n            break;\n\n          // extend placements (right)\n          case 'rightTop':\n            tp = {top: pos.top + pos.height / 2 - (actualHeight *.10), left: pos.left + pos.width};\n            break;\n          case 'rightBottom':\n            tp = {top: pos.top + pos.height / 2 - (actualHeight * .90), left: pos.left + pos.width};\n            break;\n\n          // extend placements (bottom)\n          case 'bottomLeft':\n            tp = {top: pos.top + pos.height, left: pos.left + pos.width / 2 - (actualWidth * .10)};\n            break;\n          case 'bottomRight':\n            tp = {top: pos.top + pos.height, left: pos.left + pos.width / 2 - (actualWidth * .90)};\n            break;\n\n          // extend placements (left)\n          case 'leftTop':\n            tp = {top: pos.top + pos.height / 2 - (actualHeight *.10), left: pos.left - actualWidth};\n            break;\n          case 'leftBottom':\n            tp = {top: pos.top + pos.height / 2 - (actualHeight * .90), left: pos.left - actualWidth};\n            break;\n\n\n        }\n\n        this.applyPlacement(tp, placement)\n        this.$element.trigger('shown')\n      }\n    }\n\n  , applyPlacement: function(offset, placement){\n      var $tip = this.tip()\n        , width = $tip[0].offsetWidth\n        , height = $tip[0].offsetHeight\n        , actualWidth\n        , actualHeight\n        , delta\n        , replace\n\n      $tip\n        .offset(offset)\n        .addClass(placement)\n        .addClass('in')\n\n      actualWidth = $tip[0].offsetWidth\n      actualHeight = $tip[0].offsetHeight\n\n      if (placement == 'top' && actualHeight != height) {\n        offset.top = offset.top + height - actualHeight\n        replace = true\n      }\n\n      if (placement == 'bottom' || placement == 'top') {\n        delta = 0\n\n        if (offset.left < 0){\n          delta = offset.left * -2\n          offset.left = 0\n          $tip.offset(offset)\n          actualWidth = $tip[0].offsetWidth\n          actualHeight = $tip[0].offsetHeight\n        }\n\n        this.replaceArrow(delta - width + actualWidth, actualWidth, 'left')\n      } else {\n        this.replaceArrow(actualHeight - height, actualHeight, 'top')\n      }\n\n      if (replace) $tip.offset(offset)\n    }\n\n  , replaceArrow: function(delta, dimension, position){\n      this\n        .arrow()\n        .css(position, delta ? (50 * (1 - delta / dimension) + \"%\") : '')\n    }\n\n  , setContent: function () {\n      var $tip = this.tip()\n        , title = this.getTitle()\n\n      $tip.find('.tooltip-inner')[this.options.html ? 'html' : 'text'](title)\n      $tip.removeClass('fade in top bottom left right')\n    }\n\n  , hide: function () {\n      var that = this\n        , $tip = this.tip()\n        , e = $.Event('hide')\n\n      this.$element.trigger(e)\n      if (e.isDefaultPrevented()) return\n\n      $tip.removeClass('in')\n\n      function removeWithAnimation() {\n        var timeout = setTimeout(function () {\n          $tip.off($.support.transition.end).detach()\n        }, 500)\n\n        $tip.one($.support.transition.end, function () {\n          clearTimeout(timeout)\n          $tip.detach()\n        })\n      }\n\n      $.support.transition && this.$tip.hasClass('fade') ?\n        removeWithAnimation() :\n        $tip.detach()\n\n      this.$element.trigger('hidden')\n\n      return this\n    }\n\n  , fixTitle: function () {\n      var $e = this.$element\n      if ($e.attr('title') || typeof($e.attr('data-original-title')) != 'string') {\n        $e.attr('data-original-title', $e.attr('title') || '').attr('title', '')\n      }\n    }\n\n  , hasContent: function () {\n      return this.getTitle()\n    }\n\n  , getPosition: function () {\n      var el = this.$element[0]\n      return $.extend({}, (typeof el.getBoundingClientRect == 'function') ? el.getBoundingClientRect() : {\n        width: el.offsetWidth\n      , height: el.offsetHeight\n      }, this.$element.offset())\n    }\n\n  , getTitle: function () {\n      var title\n        , $e = this.$element\n        , o = this.options\n\n      title = $e.attr('data-original-title')\n        || (typeof o.title == 'function' ? o.title.call($e[0]) :  o.title)\n\n      return title\n    }\n\n  , tip: function () {\n      return this.$tip = this.$tip || $(this.options.template)\n    }\n\n  , arrow: function(){\n      return this.$arrow = this.$arrow || this.tip().find(\".tooltip-arrow\")\n    }\n\n  , validate: function () {\n      if (!this.$element[0].parentNode) {\n        this.hide()\n        this.$element = null\n        this.options = null\n      }\n    }\n\n  , enable: function () {\n      this.enabled = true\n    }\n\n  , disable: function () {\n      this.enabled = false\n    }\n\n  , toggleEnabled: function () {\n      this.enabled = !this.enabled\n    }\n\n  , toggle: function (e) {\n      var self = e ? $(e.currentTarget)[this.type](this._options).data(this.type) : this\n      self.tip().hasClass('in') ? self.hide() : self.show()\n    }\n\n  , destroy: function () {\n      this.hide().$element.off('.' + this.type).removeData(this.type)\n    }\n\n  }\n\n\n /* TOOLTIP PLUGIN DEFINITION\n  * ========================= */\n\n  var old = $.fn.tooltip\n\n  $.fn.tooltip = function ( option ) {\n    return this.each(function () {\n      var $this = $(this)\n        , data = $this.data('tooltip')\n        , options = typeof option == 'object' && option\n      if (!data) $this.data('tooltip', (data = new Tooltip(this, options)))\n      if (typeof option == 'string') data[option]()\n    })\n  }\n\n  $.fn.tooltip.Constructor = Tooltip\n\n  $.fn.tooltip.defaults = {\n    animation: true\n  , placement: 'top'\n  , selector: false\n  , template: '<div class=\"tooltip\"><div class=\"tooltip-arrow\"></div><div class=\"tooltip-inner\"></div></div>'\n  , trigger: 'hover focus'\n  , title: ''\n  , delay: 0\n  , html: false\n  , container: false\n  }\n\n\n /* TOOLTIP NO CONFLICT\n  * =================== */\n\n  $.fn.tooltip.noConflict = function () {\n    $.fn.tooltip = old\n    return this\n  }\n\n}(window.jQuery);\n\n/* ========================================================\n * bootstrap-tab.js v2.3.2\n * http://getbootstrap.com/2.3.2/javascript.html#tabs\n * ========================================================\n * Copyright 2013 Twitter, Inc.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n * ======================================================== */\n\n\n!function ($) {\n\n  \"use strict\"; // jshint ;_;\n\n\n /* TAB CLASS DEFINITION\n  * ==================== */\n\n  var Tab = function (element) {\n    this.element = $(element)\n  }\n\n  Tab.prototype = {\n\n    constructor: Tab\n\n  , show: function () {\n      var $this = this.element\n        , $ul = $this.closest('ul:not(.dropdown-menu)')\n        , selector = $this.attr('data-target')\n        , previous\n        , $target\n        , e\n\n      if (!selector) {\n        selector = $this.attr('href')\n        selector = selector && selector.replace(/.*(?=#[^\\s]*$)/, '') //strip for ie7\n      }\n\n      if ( $this.parent('li').hasClass('active') ) return\n\n      previous = $ul.find('.active:last a')[0]\n\n      e = $.Event('show', {\n        relatedTarget: previous\n      })\n\n      $this.trigger(e)\n\n      if (e.isDefaultPrevented()) return\n\n      $target = $(selector)\n\n      this.activate($this.parent('li'), $ul)\n      this.activate($target, $target.parent(), function () {\n        $this.trigger({\n          type: 'shown'\n        , relatedTarget: previous\n        })\n      })\n    }\n\n  , activate: function ( element, container, callback) {\n      var $active = container.find('> .active')\n        , transition = callback\n            && $.support.transition\n            && $active.hasClass('fade')\n\n      function next() {\n        $active\n          .removeClass('active')\n          .find('> .dropdown-menu > .active')\n          .removeClass('active')\n\n        element.addClass('active')\n\n        if (transition) {\n          element[0].offsetWidth // reflow for transition\n          element.addClass('in')\n        } else {\n          element.removeClass('fade')\n        }\n\n        if ( element.parent('.dropdown-menu') ) {\n          element.closest('li.dropdown').addClass('active')\n        }\n\n        callback && callback()\n      }\n\n      transition ?\n        $active.one($.support.transition.end, next) :\n        next()\n\n      $active.removeClass('in')\n    }\n  }\n\n\n /* TAB PLUGIN DEFINITION\n  * ===================== */\n\n  var old = $.fn.tab\n\n  $.fn.tab = function ( option ) {\n    return this.each(function () {\n      var $this = $(this)\n        , data = $this.data('tab')\n      if (!data) $this.data('tab', (data = new Tab(this)))\n      if (typeof option == 'string') data[option]()\n    })\n  }\n\n  $.fn.tab.Constructor = Tab\n\n\n /* TAB NO CONFLICT\n  * =============== */\n\n  $.fn.tab.noConflict = function () {\n    $.fn.tab = old\n    return this\n  }\n\n\n /* TAB DATA-API\n  * ============ */\n\n  $(document).on('click.tab.data-api', '[data-toggle=\"tab\"], [data-toggle=\"pill\"]', function (e) {\n    e.preventDefault()\n    $(this).tab('show')\n  })\n\n}(window.jQuery);/* =============================================================\n * bootstrap-typeahead.js v2.3.2\n * http://getbootstrap.com/2.3.2/javascript.html#typeahead\n * =============================================================\n * Copyright 2013 Twitter, Inc.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n * ============================================================ */\n\n\n!function($){\n\n  \"use strict\"; // jshint ;_;\n\n\n /* TYPEAHEAD PUBLIC CLASS DEFINITION\n  * ================================= */\n\n  var Typeahead = function (element, options) {\n    this.$element = $(element)\n    this.options = $.extend({}, $.fn.typeahead.defaults, options)\n    this.matcher = this.options.matcher || this.matcher\n    this.sorter = this.options.sorter || this.sorter\n    this.highlighter = this.options.highlighter || this.highlighter\n    this.updater = this.options.updater || this.updater\n    this.source = this.options.source\n    this.$menu = $(this.options.menu)\n    this.shown = false\n    this.listen()\n  }\n\n  Typeahead.prototype = {\n\n    constructor: Typeahead\n\n  , select: function () {\n    // CHANGE (rashidkpc) If nothing is selected, use existing value\n      var val = this.$menu.find('.active').attr('data-value') || this.$element.val();\n      this.$element\n        .val(this.updater(val))\n        .change()\n      return this.hide()\n    }\n\n  , updater: function (item) {\n      return item\n    }\n\n  , show: function () {\n      var pos = $.extend({}, this.$element.position(), {\n        height: this.$element[0].offsetHeight\n      })\n\n      this.$menu\n        .insertAfter(this.$element)\n        .css({\n          top: pos.top + pos.height\n        , left: pos.left\n        })\n        .show()\n\n      this.shown = true\n      return this\n    }\n\n  , hide: function () {\n      this.$menu.hide()\n      this.shown = false\n      return this\n    }\n\n  , lookup: function (event) {\n      var items\n\n      this.query = this.$element.val()\n\n      if (!this.query || this.query.length < this.options.minLength) {\n        return this.shown ? this.hide() : this\n      }\n\n      items = $.isFunction(this.source) ? this.source(this.query, $.proxy(this.process, this)) : this.source\n\n      return items ? this.process(items) : this\n    }\n\n    , process: function (items) {\n      var that = this\n\n      items = $.grep(items, function (item) {\n        return that.matcher(item)\n      })\n\n      items = this.sorter(items)\n\n      if (!items.length) {\n        return this.shown ? this.hide() : this\n      }\n\n      return this.render(items.slice(0, this.options.items)).show()\n    }\n\n  , matcher: function (item) {\n      return ~item.toLowerCase().indexOf(this.query.toLowerCase())\n    }\n\n  , sorter: function (items) {\n      var beginswith = []\n        , caseSensitive = []\n        , caseInsensitive = []\n        , item\n\n      while (item = items.shift()) {\n        if (!item.toLowerCase().indexOf(this.query.toLowerCase())) beginswith.push(item)\n        else if (~item.indexOf(this.query)) caseSensitive.push(item)\n        else caseInsensitive.push(item)\n      }\n\n      return beginswith.concat(caseSensitive, caseInsensitive)\n    }\n\n  , highlighter: function (item) {\n      var query = this.query.replace(/[\\-\\[\\]{}()*+?.,\\\\\\^$|#\\s]/g, '\\\\$&')\n      if (!query) {\n        return item;\n      }\n      return item.replace(new RegExp('(' + query + ')', 'ig'), function ($1, match) {\n        return '<strong>' + match + '</strong>'\n      });\n    }\n\n  , render: function (items) {\n      var that = this\n\n      items = $(items).map(function (i, item) {\n        i = $(that.options.item).attr('data-value', item)\n        i.find('a').html(that.highlighter(item))\n        return i[0]\n      })\n\n      // CHANGE (rashidpc) Do not select first element by default\n      // items.first().addClass('active')\n      this.$menu.html(items)\n      return this\n    }\n\n  , next: function (event) {\n      var active = this.$menu.find('.active').removeClass('active')\n        , next = active.next()\n\n      if (!next.length) {\n        next = $(this.$menu.find('li')[0])\n      }\n\n      next.addClass('active')\n    }\n\n  , prev: function (event) {\n      var active = this.$menu.find('.active').removeClass('active')\n        , prev = active.prev()\n\n      if (!prev.length) {\n        prev = this.$menu.find('li').last()\n      }\n\n      prev.addClass('active')\n    }\n\n  , listen: function () {\n      this.$element\n        .on('focus',    $.proxy(this.focus, this))\n        .on('blur',     $.proxy(this.blur, this))\n        .on('keypress', $.proxy(this.keypress, this))\n        .on('keyup',    $.proxy(this.keyup, this))\n\n      if (this.eventSupported('keydown')) {\n        this.$element.on('keydown', $.proxy(this.keydown, this))\n      }\n\n      this.$menu\n        .on('click', $.proxy(this.click, this))\n        .on('mouseenter', 'li', $.proxy(this.mouseenter, this))\n        .on('mouseleave', 'li', $.proxy(this.mouseleave, this))\n    },\n\n    destroy: function () {\n      this.$element.off().removeData('typeahead');\n      this.$menu.off();\n    }\n\n  , eventSupported: function(eventName) {\n      var isSupported = eventName in this.$element\n      if (!isSupported) {\n        this.$element.setAttribute(eventName, 'return;')\n        isSupported = typeof this.$element[eventName] === 'function'\n      }\n      return isSupported\n    }\n\n  , move: function (e) {\n      if (!this.shown) return\n\n      // grafana change, shift+left parenthesis\n      if (e.shiftKey && e.keyCode === 40) {\n        return;\n      }\n\n      switch(e.keyCode) {\n        case 9: // tab\n        case 13: // enter\n        case 27: // escape\n          e.preventDefault()\n          break\n\n        case 38: // up arrow\n          e.preventDefault()\n          this.prev()\n          break\n\n        case 40: // down arrow\n          e.preventDefault()\n          this.next()\n          break\n      }\n\n      e.stopPropagation()\n    }\n\n  , keydown: function (e) {\n      this.suppressKeyPressRepeat = ~$.inArray(e.keyCode, [40,38,9,13,27,57])\n      this.move(e)\n    }\n\n  , keypress: function (e) {\n      if (this.suppressKeyPressRepeat) return\n      this.move(e)\n    }\n\n  , keyup: function (e) {\n      switch(e.keyCode) {\n        case 40: // down arrow\n        case 38: // up arrow\n        case 16: // shift\n        case 17: // ctrl\n        case 18: // alt\n          break\n\n        case 9: // tab\n        case 13: // enter\n          if (!this.shown) return\n          this.select()\n          break\n\n        case 27: // escape\n          if (!this.shown) return\n          this.hide()\n          break\n\n        default:\n          this.lookup();\n      }\n\n      if(e.keyCode === 13 && typeof this.$menu.find('.active').attr('data-value') === 'undefined') {\n        // CHANGE (rashidkpc). Enter was hit, nothing was selected from typeahead, submit form\n        this.$element.submit();\n      } else {\n        e.stopPropagation()\n        e.preventDefault()\n      }\n\n  }\n\n  , focus: function (e) {\n      this.focused = true\n    }\n\n  , blur: function (e) {\n      this.focused = false\n      if (!this.mousedover && this.shown) this.hide()\n    }\n\n  , click: function (e) {\n      e.stopPropagation()\n      e.preventDefault()\n      this.select()\n      this.$element.focus()\n    }\n\n  , mouseenter: function (e) {\n      this.mousedover = true\n      this.$menu.find('.active').removeClass('active')\n      $(e.currentTarget).addClass('active')\n    }\n\n  , mouseleave: function (e) {\n      this.mousedover = false\n      if (!this.focused && this.shown) this.hide()\n    }\n\n  }\n\n\n  /* TYPEAHEAD PLUGIN DEFINITION\n   * =========================== */\n\n  var old = $.fn.typeahead\n\n  $.fn.typeahead = function (option) {\n    return this.each(function () {\n      var $this = $(this)\n        , data = $this.data('typeahead')\n        , options = typeof option == 'object' && option\n      if (!data) $this.data('typeahead', (data = new Typeahead(this, options)))\n      if (typeof option == 'string') data[option]()\n    })\n  }\n\n  $.fn.typeahead.defaults = {\n    source: []\n  , items: 8\n  , menu: '<ul class=\"typeahead dropdown-menu\"></ul>'\n  , item: '<li><a href=\"#\"></a></li>'\n  , minLength: 1\n  }\n\n  $.fn.typeahead.Constructor = Typeahead\n\n\n /* TYPEAHEAD NO CONFLICT\n  * =================== */\n\n  $.fn.typeahead.noConflict = function () {\n    $.fn.typeahead = old\n    return this\n  }\n\n\n /* TYPEAHEAD DATA-API\n  * ================== */\n\n  $(document).on('focus.typeahead.data-api', '[data-provide=\"typeahead\"]', function (e) {\n    var $this = $(this)\n    if ($this.data('typeahead')) return\n    $this.typeahead($this.data())\n  })\n\n}(window.jQuery);\n/* ==========================================================\n * bootstrap-affix.js v2.3.2\n * http://getbootstrap.com/2.3.2/javascript.html#affix\n * ==========================================================\n * Copyright 2013 Twitter, Inc.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n * ========================================================== */\n\n\n!function ($) {\n\n  \"use strict\"; // jshint ;_;\n\n\n /* AFFIX CLASS DEFINITION\n  * ====================== */\n\n  var Affix = function (element, options) {\n    this.options = $.extend({}, $.fn.affix.defaults, options)\n    this.$window = $(window)\n      .on('scroll.affix.data-api', $.proxy(this.checkPosition, this))\n      .on('click.affix.data-api',  $.proxy(function () { setTimeout($.proxy(this.checkPosition, this), 1) }, this))\n    this.$element = $(element)\n    this.checkPosition()\n  }\n\n  Affix.prototype.checkPosition = function () {\n    if (!this.$element.is(':visible')) return\n\n    var scrollHeight = $(document).height()\n      , scrollTop = this.$window.scrollTop()\n      , position = this.$element.offset()\n      , offset = this.options.offset\n      , offsetBottom = offset.bottom\n      , offsetTop = offset.top\n      , reset = 'affix affix-top affix-bottom'\n      , affix\n\n    if (typeof offset != 'object') offsetBottom = offsetTop = offset\n    if (typeof offsetTop == 'function') offsetTop = offset.top()\n    if (typeof offsetBottom == 'function') offsetBottom = offset.bottom()\n\n    affix = this.unpin != null && (scrollTop + this.unpin <= position.top) ?\n      false    : offsetBottom != null && (position.top + this.$element.height() >= scrollHeight - offsetBottom) ?\n      'bottom' : offsetTop != null && scrollTop <= offsetTop ?\n      'top'    : false\n\n    if (this.affixed === affix) return\n\n    this.affixed = affix\n    this.unpin = affix == 'bottom' ? position.top - scrollTop : null\n\n    this.$element.removeClass(reset).addClass('affix' + (affix ? '-' + affix : ''))\n  }\n\n\n /* AFFIX PLUGIN DEFINITION\n  * ======================= */\n\n  var old = $.fn.affix\n\n  $.fn.affix = function (option) {\n    return this.each(function () {\n      var $this = $(this)\n        , data = $this.data('affix')\n        , options = typeof option == 'object' && option\n      if (!data) $this.data('affix', (data = new Affix(this, options)))\n      if (typeof option == 'string') data[option]()\n    })\n  }\n\n  $.fn.affix.Constructor = Affix\n\n  $.fn.affix.defaults = {\n    offset: 0\n  }\n\n\n /* AFFIX NO CONFLICT\n  * ================= */\n\n  $.fn.affix.noConflict = function () {\n    $.fn.affix = old\n    return this\n  }\n\n\n /* AFFIX DATA-API\n  * ============== */\n\n  $(window).on('load', function () {\n    $('[data-spy=\"affix\"]').each(function () {\n      var $spy = $(this)\n        , data = $spy.data()\n\n      data.offset = data.offset || {}\n\n      data.offsetBottom && (data.offset.bottom = data.offsetBottom)\n      data.offsetTop && (data.offset.top = data.offsetTop)\n\n      $spy.affix(data)\n    })\n  })\n\n\n}(window.jQuery);\n","/* Flot plugin for showing crosshairs when the mouse hovers over the plot.\n\nCopyright (c) 2007-2014 IOLA and Ole Laursen.\nLicensed under the MIT license.\n\nThe plugin supports these options:\n\n\tcrosshair: {\n\t\tmode: null or \"x\" or \"y\" or \"xy\"\n\t\tcolor: color\n\t\tlineWidth: number\n\t}\n\nSet the mode to one of \"x\", \"y\" or \"xy\". The \"x\" mode enables a vertical\ncrosshair that lets you trace the values on the x axis, \"y\" enables a\nhorizontal crosshair and \"xy\" enables them both. \"color\" is the color of the\ncrosshair (default is \"rgba(170, 0, 0, 0.80)\"), \"lineWidth\" is the width of\nthe drawn lines (default is 1).\n\nThe plugin also adds four public methods:\n\n  - setCrosshair( pos )\n\n    Set the position of the crosshair. Note that this is cleared if the user\n    moves the mouse. \"pos\" is in coordinates of the plot and should be on the\n    form { x: xpos, y: ypos } (you can use x2/x3/... if you're using multiple\n    axes), which is coincidentally the same format as what you get from a\n    \"plothover\" event. If \"pos\" is null, the crosshair is cleared.\n\n  - clearCrosshair()\n\n    Clear the crosshair.\n\n  - lockCrosshair(pos)\n\n    Cause the crosshair to lock to the current location, no longer updating if\n    the user moves the mouse. Optionally supply a position (passed on to\n    setCrosshair()) to move it to.\n\n    Example usage:\n\n\tvar myFlot = $.plot( $(\"#graph\"), ..., { crosshair: { mode: \"x\" } } };\n\t$(\"#graph\").bind( \"plothover\", function ( evt, position, item ) {\n\t\tif ( item ) {\n\t\t\t// Lock the crosshair to the data point being hovered\n\t\t\tmyFlot.lockCrosshair({\n\t\t\t\tx: item.datapoint[ 0 ],\n\t\t\t\ty: item.datapoint[ 1 ]\n\t\t\t});\n\t\t} else {\n\t\t\t// Return normal crosshair operation\n\t\t\tmyFlot.unlockCrosshair();\n\t\t}\n\t});\n\n  - unlockCrosshair()\n\n    Free the crosshair to move again after locking it.\n*/\n\n(function ($) {\n    var options = {\n        crosshair: {\n            mode: null, // one of null, \"x\", \"y\" or \"xy\",\n            color: \"rgba(170, 0, 0, 0.80)\",\n            lineWidth: 1\n        }\n    };\n    \n    function init(plot) {\n        // position of crosshair in pixels\n        var crosshair = { x: -1, y: -1, locked: false };\n\n        plot.setCrosshair = function setCrosshair(pos) {\n            if (!pos)\n                crosshair.x = -1;\n            else {\n                var o = plot.p2c(pos);\n                crosshair.x = Math.max(0, Math.min(o.left, plot.width()));\n                crosshair.y = Math.max(0, Math.min(o.top, plot.height()));\n            }\n            \n            plot.triggerRedrawOverlay();\n        };\n        \n        plot.clearCrosshair = plot.setCrosshair; // passes null for pos\n        \n        plot.lockCrosshair = function lockCrosshair(pos) {\n            if (pos)\n                plot.setCrosshair(pos);\n            crosshair.locked = true;\n        };\n\n        plot.unlockCrosshair = function unlockCrosshair() {\n            crosshair.locked = false;\n        };\n\n        function onMouseOut(e) {\n            if (crosshair.locked)\n                return;\n\n            if (crosshair.x != -1) {\n                crosshair.x = -1;\n                plot.triggerRedrawOverlay();\n            }\n        }\n\n        function onMouseMove(e) {\n            if (crosshair.locked)\n                return;\n                \n            if (plot.getSelection && plot.getSelection()) {\n                crosshair.x = -1; // hide the crosshair while selecting\n                return;\n            }\n                \n            var offset = plot.offset();\n            crosshair.x = Math.max(0, Math.min(e.pageX - offset.left, plot.width()));\n            crosshair.y = Math.max(0, Math.min(e.pageY - offset.top, plot.height()));\n            plot.triggerRedrawOverlay();\n        }\n        \n        plot.hooks.bindEvents.push(function (plot, eventHolder) {\n            if (!plot.getOptions().crosshair.mode)\n                return;\n\n            eventHolder.mouseout(onMouseOut);\n            eventHolder.mousemove(onMouseMove);\n        });\n\n        plot.hooks.drawOverlay.push(function (plot, ctx) {\n            var c = plot.getOptions().crosshair;\n            if (!c.mode)\n                return;\n\n            var plotOffset = plot.getPlotOffset();\n            \n            ctx.save();\n            ctx.translate(plotOffset.left, plotOffset.top);\n\n            if (crosshair.x != -1) {\n                var adj = plot.getOptions().crosshair.lineWidth % 2 ? 0.5 : 0;\n\n                ctx.strokeStyle = c.color;\n                ctx.lineWidth = c.lineWidth;\n                ctx.lineJoin = \"round\";\n\n                ctx.beginPath();\n                if (c.mode.indexOf(\"x\") != -1) {\n                    var drawX = Math.floor(crosshair.x) + adj;\n                    ctx.moveTo(drawX, 0);\n                    ctx.lineTo(drawX, plot.height());\n                }\n                if (c.mode.indexOf(\"y\") != -1) {\n                    var drawY = Math.floor(crosshair.y) + adj;\n                    ctx.moveTo(0, drawY);\n                    ctx.lineTo(plot.width(), drawY);\n                }\n                ctx.stroke();\n            }\n            ctx.restore();\n        });\n\n        plot.hooks.shutdown.push(function (plot, eventHolder) {\n            eventHolder.unbind(\"mouseout\", onMouseOut);\n            eventHolder.unbind(\"mousemove\", onMouseMove);\n        });\n    }\n    \n    $.plot.plugins.push({\n        init: init,\n        options: options,\n        name: 'crosshair',\n        version: '1.0'\n    });\n})(jQuery);\n","/*\n * jQuery.flot.dashes\n *\n * options = {\n *   series: {\n *     dashes: {\n *\n *       // show\n *       // default: false\n *       // Whether to show dashes for the series.\n *       show: <boolean>,\n *\n *       // lineWidth\n *       // default: 2\n *       // The width of the dashed line in pixels.\n *       lineWidth: <number>,\n *\n *       // dashLength\n *       // default: 10\n *       // Controls the length of the individual dashes and the amount of\n *       // space between them.\n *       // If this is a number, the dashes and spaces will have that length.\n *       // If this is an array, it is read as [ dashLength, spaceLength ]\n *       dashLength: <number> or <array[2]>\n *     }\n *   }\n * }\n */\n(function($){\n\n  function init(plot) {\n\n    plot.hooks.processDatapoints.push(function(plot, series, datapoints) {\n\n      if (!series.dashes.show) return;\n\n      plot.hooks.draw.push(function(plot, ctx) {\n\n        var plotOffset = plot.getPlotOffset(),\n          axisx = series.xaxis,\n          axisy = series.yaxis;\n\n        function plotDashes(xoffset, yoffset) {\n\n          var points = datapoints.points,\n            ps = datapoints.pointsize,\n            prevx = null,\n            prevy = null,\n            dashRemainder = 0,\n            dashOn = true,\n            dashOnLength,\n            dashOffLength;\n\n          if (series.dashes.dashLength[0]) {\n            dashOnLength = series.dashes.dashLength[0];\n            if (series.dashes.dashLength[1]) {\n              dashOffLength = series.dashes.dashLength[1];\n            } else {\n              dashOffLength = dashOnLength;\n            }\n          } else {\n            dashOffLength = dashOnLength = series.dashes.dashLength;\n          }\n\n          ctx.beginPath();\n\n          for (var i = ps; i < points.length; i += ps) {\n\n            var x1 = points[i - ps],\n              y1 = points[i - ps + 1],\n              x2 = points[i],\n              y2 = points[i + 1];\n\n            if (x1 == null || x2 == null) continue;\n\n            // clip with ymin\n            if (y1 <= y2 && y1 < axisy.min) {\n              if (y2 < axisy.min) continue;   // line segment is outside\n              // compute new intersection point\n              x1 = (axisy.min - y1) / (y2 - y1) * (x2 - x1) + x1;\n              y1 = axisy.min;\n            } else if (y2 <= y1 && y2 < axisy.min) {\n              if (y1 < axisy.min) continue;\n              x2 = (axisy.min - y1) / (y2 - y1) * (x2 - x1) + x1;\n              y2 = axisy.min;\n            }\n\n            // clip with ymax\n            if (y1 >= y2 && y1 > axisy.max) {\n              if (y2 > axisy.max) continue;\n              x1 = (axisy.max - y1) / (y2 - y1) * (x2 - x1) + x1;\n              y1 = axisy.max;\n            } else if (y2 >= y1 && y2 > axisy.max) {\n              if (y1 > axisy.max) continue;\n              x2 = (axisy.max - y1) / (y2 - y1) * (x2 - x1) + x1;\n              y2 = axisy.max;\n            }\n\n            // clip with xmin\n            if (x1 <= x2 && x1 < axisx.min) {\n              if (x2 < axisx.min) continue;\n              y1 = (axisx.min - x1) / (x2 - x1) * (y2 - y1) + y1;\n              x1 = axisx.min;\n            } else if (x2 <= x1 && x2 < axisx.min) {\n              if (x1 < axisx.min) continue;\n              y2 = (axisx.min - x1) / (x2 - x1) * (y2 - y1) + y1;\n              x2 = axisx.min;\n            }\n\n            // clip with xmax\n            if (x1 >= x2 && x1 > axisx.max) {\n              if (x2 > axisx.max) continue;\n              y1 = (axisx.max - x1) / (x2 - x1) * (y2 - y1) + y1;\n              x1 = axisx.max;\n            } else if (x2 >= x1 && x2 > axisx.max) {\n              if (x1 > axisx.max) continue;\n              y2 = (axisx.max - x1) / (x2 - x1) * (y2 - y1) + y1;\n              x2 = axisx.max;\n            }\n\n            if (x1 != prevx || y1 != prevy) {\n              ctx.moveTo(axisx.p2c(x1) + xoffset, axisy.p2c(y1) + yoffset);\n            }\n\n            var ax1 = axisx.p2c(x1) + xoffset,\n              ay1 = axisy.p2c(y1) + yoffset,\n              ax2 = axisx.p2c(x2) + xoffset,\n              ay2 = axisy.p2c(y2) + yoffset,\n              dashOffset;\n\n            function lineSegmentOffset(segmentLength) {\n\n              var c = Math.sqrt(Math.pow(ax2 - ax1, 2) + Math.pow(ay2 - ay1, 2));\n\n              if (c <= segmentLength) {\n                return {\n                  deltaX: ax2 - ax1,\n                  deltaY: ay2 - ay1,\n                  distance: c,\n                  remainder: segmentLength - c\n                }\n              } else {\n                var xsign = ax2 > ax1 ? 1 : -1,\n                  ysign = ay2 > ay1 ? 1 : -1;\n                return {\n                  deltaX: xsign * Math.sqrt(Math.pow(segmentLength, 2) / (1 + Math.pow((ay2 - ay1)/(ax2 - ax1), 2))),\n                  deltaY: ysign * Math.sqrt(Math.pow(segmentLength, 2) - Math.pow(segmentLength, 2) / (1 + Math.pow((ay2 - ay1)/(ax2 - ax1), 2))),\n                  distance: segmentLength,\n                  remainder: 0\n                };\n              }\n            }\n            //-end lineSegmentOffset\n\n            do {\n\n              dashOffset = lineSegmentOffset(\n                dashRemainder > 0 ? dashRemainder :\n                  dashOn ? dashOnLength : dashOffLength);\n\n              if (dashOffset.deltaX != 0 || dashOffset.deltaY != 0) {\n                if (dashOn) {\n                  ctx.lineTo(ax1 + dashOffset.deltaX, ay1 + dashOffset.deltaY);\n                } else {\n                  ctx.moveTo(ax1 + dashOffset.deltaX, ay1 + dashOffset.deltaY);\n                }\n              }\n\n              dashOn = !dashOn;\n              dashRemainder = dashOffset.remainder;\n              ax1 += dashOffset.deltaX;\n              ay1 += dashOffset.deltaY;\n\n            } while (dashOffset.distance > 0);\n\n            prevx = x2;\n            prevy = y2;\n          }\n\n          ctx.stroke();\n        }\n        //-end plotDashes\n\n        ctx.save();\n        ctx.translate(plotOffset.left, plotOffset.top);\n        ctx.lineJoin = 'round';\n\n        var lw = series.dashes.lineWidth,\n          sw = series.shadowSize;\n\n        // FIXME: consider another form of shadow when filling is turned on\n        if (lw > 0 && sw > 0) {\n          // draw shadow as a thick and thin line with transparency\n          ctx.lineWidth = sw;\n          ctx.strokeStyle = \"rgba(0,0,0,0.1)\";\n          // position shadow at angle from the mid of line\n          var angle = Math.PI/18;\n          plotDashes(Math.sin(angle) * (lw/2 + sw/2), Math.cos(angle) * (lw/2 + sw/2));\n          ctx.lineWidth = sw/2;\n          plotDashes(Math.sin(angle) * (lw/2 + sw/4), Math.cos(angle) * (lw/2 + sw/4));\n        }\n\n        ctx.lineWidth = lw;\n        ctx.strokeStyle = series.color;\n\n        if (lw > 0) {\n          plotDashes(0, 0);\n        }\n\n        ctx.restore();\n\n      });\n      //-end draw hook\n\n    });\n    //-end processDatapoints hook\n\n  }\n  //-end init\n\n  $.plot.plugins.push({\n    init: init,\n    options: {\n      series: {\n        dashes: {\n          show: false,\n          lineWidth: 2,\n          dashLength: 10\n        }\n      }\n    },\n    name: 'dashes',\n    version: '0.1'\n  });\n\n})(jQuery)\n","(function($) {\r\n    \"use strict\";\r\n\r\n    var options = {\r\n        series: {\r\n            fillBelowTo: null\r\n        }\r\n    };\r\n\r\n    function init(plot) {\r\n        function findBelowSeries( series, allseries ) {\r\n\r\n            var i;\r\n\r\n            for ( i = 0; i < allseries.length; ++i ) {\r\n                if ( allseries[ i ].id === series.fillBelowTo ) {\r\n                    return allseries[ i ];\r\n                }\r\n            }\r\n\r\n            return null;\r\n        }\r\n\r\n        /* top and bottom doesn't actually matter for this, we're just using it to help make this easier to think about */\r\n        /* this is a vector cross product operation */\r\n        function segmentIntersection(top_left_x, top_left_y, top_right_x, top_right_y, bottom_left_x, bottom_left_y, bottom_right_x, bottom_right_y) {\r\n            var top_delta_x, top_delta_y, bottom_delta_x, bottom_delta_y,\r\n                s, t;\r\n\r\n            top_delta_x = top_right_x - top_left_x;\r\n            top_delta_y = top_right_y - top_left_y;\r\n            bottom_delta_x = bottom_right_x - bottom_left_x;\r\n            bottom_delta_y = bottom_right_y - bottom_left_y;\r\n\r\n            s = (\r\n                (-top_delta_y * (top_left_x - bottom_left_x)) + (top_delta_x * (top_left_y - bottom_left_y))\r\n            ) / (\r\n                -bottom_delta_x * top_delta_y + top_delta_x * bottom_delta_y\r\n            );\r\n\r\n            t = (\r\n                (bottom_delta_x * (top_left_y - bottom_left_y)) - (bottom_delta_y * (top_left_x - bottom_left_x))\r\n            ) / (\r\n                -bottom_delta_x * top_delta_y + top_delta_x * bottom_delta_y\r\n            );\r\n\r\n            // Collision detected\r\n            if (s >= 0 && s <= 1 && t >= 0 && t <= 1) {\r\n                return [\r\n                    top_left_x + (t * top_delta_x), // X\r\n                    top_left_y + (t * top_delta_y) // Y\r\n                ];\r\n            }\r\n\r\n            // No collision\r\n            return null;\r\n        }\r\n\r\n        function plotDifferenceArea(plot, ctx, series) {\r\n            if ( series.fillBelowTo === null ) {\r\n                return;\r\n            }\r\n\r\n            var otherseries,\r\n\r\n                ps,\r\n                points,\r\n\r\n                otherps,\r\n                otherpoints,\r\n\r\n                plotOffset,\r\n                fillStyle;\r\n\r\n            function openPolygon(x, y) {\r\n                ctx.beginPath();\r\n                ctx.moveTo(\r\n                    series.xaxis.p2c(x) + plotOffset.left,\r\n                    series.yaxis.p2c(y) + plotOffset.top\r\n                );\r\n\r\n            }\r\n\r\n            function closePolygon() {\r\n                ctx.closePath();\r\n                ctx.fill();\r\n            }\r\n\r\n            function validateInput() {\r\n                if (points.length/ps !== otherpoints.length/otherps) {\r\n                    console.error(\"Refusing to graph inconsistent number of points\");\r\n                    return false;\r\n                }\r\n\r\n                var i;\r\n                for (i = 0; i < (points.length / ps); i++) {\r\n                    if (\r\n                        points[i * ps] !== null &&\r\n                        otherpoints[i * otherps] !== null &&\r\n                        points[i * ps] !== otherpoints[i * otherps]\r\n                    ) {\r\n                        console.error(\"Refusing to graph points without matching value\");\r\n                        return false;\r\n                    }\r\n                }\r\n\r\n                return true;\r\n            }\r\n\r\n            function findNextStart(start_i, end_i) {\r\n                console.assert(end_i > start_i, \"expects the end index to be greater than the start index\");\r\n\r\n                var start = (\r\n                        start_i === 0 ||\r\n                        points[start_i - 1] === null ||\r\n                        otherpoints[start_i - 1] === null\r\n                    ),\r\n                    equal = false,\r\n                    i,\r\n                    intersect;\r\n\r\n                for (i = start_i; i < end_i; i++) {\r\n                    // Take note of null points\r\n                    if (\r\n                        points[(i * ps) + 1] === null ||\r\n                        otherpoints[(i * ps) + 1] === null\r\n                    ) {\r\n                        equal = false;\r\n                        start = true;\r\n                    }\r\n\r\n                    // Take note of equal points\r\n                    else if (points[(i * ps) + 1] === otherpoints[(i * otherps) + 1]) {\r\n                        equal = true;\r\n                        start = false;\r\n                    }\r\n\r\n\r\n                    else if (points[(i * ps) + 1] > otherpoints[(i * otherps) + 1]) {\r\n                        // If we begin above the desired point\r\n                        if (start) {\r\n                            openPolygon(points[i * ps], points[(i * ps) + 1]);\r\n                        }\r\n\r\n                        // If an equal point preceeds this, start the polygon at that equal point\r\n                        else if (equal) {\r\n                            openPolygon(points[(i - 1) * ps], points[((i - 1) * ps) + 1]);\r\n                        }\r\n\r\n                        // Otherwise, find the intersection point, and start it there\r\n                        else {\r\n                            intersect = intersectionPoint(i);\r\n                            openPolygon(intersect[0], intersect[1]);\r\n                        }\r\n\r\n                        topTraversal(i, end_i);\r\n                        return;\r\n                    }\r\n\r\n                    // If we go below equal, equal at any preceeding point is irrelevant\r\n                    else {\r\n                        start = false;\r\n                        equal = false;\r\n                    }\r\n                }\r\n            }\r\n\r\n            function intersectionPoint(right_i) {\r\n                console.assert(right_i > 0, \"expects the second point in the series line segment\");\r\n\r\n                var i, intersect;\r\n\r\n                for (i = 1; i < (otherpoints.length/otherps); i++) {\r\n                    intersect = segmentIntersection(\r\n                        points[(right_i - 1) * ps], points[((right_i - 1) * ps) + 1],\r\n                        points[right_i * ps], points[(right_i * ps) + 1],\r\n\r\n                        otherpoints[(i - 1) * otherps], otherpoints[((i - 1) * otherps) + 1],\r\n                        otherpoints[i * otherps], otherpoints[(i * otherps) + 1]\r\n                    );\r\n\r\n                    if (intersect !== null) {\r\n                        return intersect;\r\n                    }\r\n                }\r\n\r\n                console.error(\"intersectionPoint() should only be called when an intersection happens\");\r\n            }\r\n\r\n            function bottomTraversal(start_i, end_i) {\r\n                console.assert(start_i >= end_i, \"the start should be the rightmost point, and the end should be the leftmost (excluding the equal or intersecting point)\");\r\n\r\n                var i;\r\n\r\n                for (i = start_i; i >= end_i; i--) {\r\n                    ctx.lineTo(\r\n                        otherseries.xaxis.p2c(otherpoints[i * otherps]) + plotOffset.left,\r\n                        otherseries.yaxis.p2c(otherpoints[(i * otherps) + 1]) + plotOffset.top\r\n                    );\r\n                }\r\n\r\n                closePolygon();\r\n            }\r\n\r\n            function topTraversal(start_i, end_i) {\r\n                console.assert(start_i <= end_i, \"the start should be the rightmost point, and the end should be the leftmost (excluding the equal or intersecting point)\");\r\n\r\n                var i,\r\n                    intersect;\r\n\r\n                for (i = start_i; i < end_i; i++) {\r\n                    if (points[(i * ps) + 1] === null && i > start_i) {\r\n                        bottomTraversal(i - 1, start_i);\r\n                        findNextStart(i, end_i);\r\n                        return;\r\n                    }\r\n\r\n                    else if (points[(i * ps) + 1] === otherpoints[(i * otherps) + 1]) {\r\n                        bottomTraversal(i, start_i);\r\n                        findNextStart(i, end_i);\r\n                        return;\r\n                    }\r\n\r\n                    else if (points[(i * ps) + 1] < otherpoints[(i * otherps) + 1]) {\r\n                        intersect = intersectionPoint(i);\r\n                        ctx.lineTo(\r\n                            series.xaxis.p2c(intersect[0]) + plotOffset.left,\r\n                            series.yaxis.p2c(intersect[1]) + plotOffset.top\r\n                        );\r\n                        bottomTraversal(i, start_i);\r\n                        findNextStart(i, end_i);\r\n                        return;\r\n\r\n                    }\r\n\r\n                    else {\r\n                        ctx.lineTo(\r\n                            series.xaxis.p2c(points[i * ps]) + plotOffset.left,\r\n                            series.yaxis.p2c(points[(i * ps) + 1]) + plotOffset.top\r\n                        );\r\n                    }\r\n                }\r\n\r\n                bottomTraversal(end_i, start_i);\r\n            }\r\n\r\n\r\n            // Begin processing\r\n\r\n            otherseries = findBelowSeries( series, plot.getData() );\r\n\r\n            if ( !otherseries ) {\r\n                return;\r\n            }\r\n\r\n            ps = series.datapoints.pointsize;\r\n            points = series.datapoints.points;\r\n            otherps = otherseries.datapoints.pointsize;\r\n            otherpoints = otherseries.datapoints.points;\r\n            plotOffset = plot.getPlotOffset();\r\n\r\n            if (!validateInput()) {\r\n                return;\r\n            }\r\n\r\n\r\n            // Flot's getFillStyle() should probably be exposed somewhere\r\n            fillStyle = $.color.parse(series.color);\r\n            fillStyle.a = 0.4;\r\n            fillStyle.normalize();\r\n            ctx.fillStyle = fillStyle.toString();\r\n\r\n\r\n            // Begin recursive bi-directional traversal\r\n            findNextStart(0, points.length/ps);\r\n        }\r\n\r\n        plot.hooks.drawSeries.push(plotDifferenceArea);\r\n    }\r\n\r\n    $.plot.plugins.push({\r\n        init: init,\r\n        options: options,\r\n        name: \"fillbelow\",\r\n        version: \"0.1.0\"\r\n    });\r\n\r\n})(jQuery);\r\n","/*!\r\n * jquery.flot.gauge v1.1.0 *\r\n *\r\n * Flot plugin for rendering gauge charts.\r\n *\r\n * Copyright (c) 2015 @toyoty99.\r\n * Licensed under the MIT license.\r\n */\r\n\r\n/**\r\n * @module flot.gauge\r\n */\r\n(function($) {\r\n\r\n\r\n    /**\r\n     * Gauge class\r\n     *\r\n     * @class Gauge\r\n     */\r\n    var Gauge = (function() {\r\n        /**\r\n         * context of canvas\r\n         *\r\n         * @property context\r\n         * @type Object\r\n         */\r\n        var context;\r\n        /**\r\n         * placeholder of canvas\r\n         *\r\n         * @property placeholder\r\n         * @type Object\r\n         */\r\n        var placeholder;\r\n        /**\r\n         * options of plot\r\n         *\r\n         * @property options\r\n         * @type Object\r\n         */\r\n        var options;\r\n        /**\r\n         * options of gauge\r\n         *\r\n         * @property gaugeOptions\r\n         * @type Object\r\n         */\r\n        var gaugeOptions;\r\n        /**\r\n         * data series\r\n         *\r\n         * @property series\r\n         * @type Array\r\n         */\r\n        var series;\r\n        /**\r\n         * logger\r\n         *\r\n         * @property logger\r\n         * @type Object\r\n         */\r\n        var logger;\r\n\r\n        /**\r\n         * constructor\r\n         *\r\n         * @class Gauge\r\n         * @constructor\r\n         * @param  {Object} gaugeOptions gauge options\r\n         */\r\n        var Gauge = function(plot, ctx) {\r\n            context = ctx;\r\n            placeholder = plot.getPlaceholder();\r\n            options = plot.getOptions();\r\n            gaugeOptions = options.series.gauges;\r\n            series = plot.getData();\r\n            logger = getLogger(gaugeOptions.debug);\r\n        }\r\n\r\n        /**\r\n         * calculate layout\r\n         *\r\n         * @method calculateLayout\r\n         * @return the calculated layout properties\r\n         */\r\n        Gauge.prototype.calculateLayout = function() {\r\n\r\n            var canvasWidth = placeholder.width();\r\n            var canvasHeight = placeholder.height();\r\n\r\n\r\n\r\n            // calculate cell size\r\n            var columns = Math.min(series.length, gaugeOptions.layout.columns);\r\n            var rows = Math.ceil(series.length / columns);\r\n\r\n\r\n\r\n            var margin = gaugeOptions.layout.margin;\r\n            var hMargin = gaugeOptions.layout.hMargin;\r\n            var vMargin = gaugeOptions.layout.vMargin;\r\n            var cellWidth = (canvasWidth - (margin * 2) - (hMargin * (columns - 1))) / columns;\r\n            var cellHeight = (canvasHeight - (margin * 2) - (vMargin * (rows - 1))) / rows;\r\n            if (gaugeOptions.layout.square) {\r\n                var cell = Math.min(cellWidth, cellHeight);\r\n                cellWidth = cell;\r\n                cellHeight = cell;\r\n            }\r\n\r\n\r\n\r\n            // calculate 'auto' values\r\n            calculateAutoValues(gaugeOptions, cellWidth);\r\n\r\n            // calculate maximum radius\r\n            var cellMargin = gaugeOptions.cell.margin;\r\n            var labelMargin = 0;\r\n            var labelFontSize = 0;\r\n            if (gaugeOptions.label.show) {\r\n                labelMargin = gaugeOptions.label.margin;\r\n                labelFontSize = gaugeOptions.label.font.size;\r\n            }\r\n            var valueMargin = 0;\r\n            var valueFontSize = 0;\r\n            if (gaugeOptions.value.show) {\r\n                valueMargin = gaugeOptions.value.margin;\r\n                valueFontSize = gaugeOptions.value.font.size;\r\n            }\r\n            var thresholdWidth = 0;\r\n            if (gaugeOptions.threshold.show) {\r\n                thresholdWidth = gaugeOptions.threshold.width;\r\n            }\r\n            var thresholdLabelMargin = 0;\r\n            var thresholdLabelFontSize = 0;\r\n            if (gaugeOptions.threshold.label.show) {\r\n                thresholdLabelMargin = gaugeOptions.threshold.label.margin;\r\n                thresholdLabelFontSize = gaugeOptions.threshold.label.font.size;\r\n            }\r\n\r\n            var maxRadiusH = (cellWidth / 2) - cellMargin - thresholdWidth - (thresholdLabelMargin * 2) - thresholdLabelFontSize;\r\n\r\n            var startAngle = gaugeOptions.gauge.startAngle;\r\n            var endAngle = gaugeOptions.gauge.endAngle;\r\n            var dAngle = (endAngle - startAngle) / 100;\r\n            var heightRatioV = -1;\r\n            for (var a = startAngle; a < endAngle; a += dAngle) {\r\n                heightRatioV = Math.max(heightRatioV, Math.sin(toRad(a)));\r\n            }\r\n            heightRatioV = Math.max(heightRatioV, Math.sin(toRad(endAngle)));\r\n            var outerRadiusV = (cellHeight - (cellMargin * 2) - (labelMargin * 2) - labelFontSize) / (1 + heightRatioV);\r\n            if (outerRadiusV * heightRatioV < valueMargin + (valueFontSize / 2)) {\r\n                outerRadiusV = cellHeight - (cellMargin * 2) - (labelMargin * 2) - labelFontSize - valueMargin - (valueFontSize / 2);\r\n            }\r\n            var maxRadiusV = outerRadiusV - (thresholdLabelMargin * 2) - thresholdLabelFontSize - thresholdWidth;\r\n\r\n            var radius = Math.min(maxRadiusH, maxRadiusV);\r\n\r\n\r\n            var width = gaugeOptions.gauge.width;\r\n            if (width >= radius) {\r\n                width = Math.max(3, radius / 3);\r\n            }\r\n\r\n\r\n            var outerRadius = (thresholdLabelMargin * 2) + thresholdLabelFontSize + thresholdWidth + radius;\r\n            var gaugeOuterHeight = Math.max(outerRadius * (1 + heightRatioV), outerRadius + valueMargin + (valueFontSize / 2));\r\n\r\n            return {\r\n                canvasWidth: canvasWidth,\r\n                canvasHeight: canvasHeight,\r\n                margin: margin,\r\n                hMargin: hMargin,\r\n                vMargin: vMargin,\r\n                columns: columns,\r\n                rows: rows,\r\n                cellWidth: cellWidth,\r\n                cellHeight: cellHeight,\r\n                cellMargin: cellMargin,\r\n                labelMargin: labelMargin,\r\n                labelFontSize: labelFontSize,\r\n                valueMargin: valueMargin,\r\n                valueFontSize: valueFontSize,\r\n                width: width,\r\n                radius: radius,\r\n                thresholdWidth: thresholdWidth,\r\n                thresholdLabelMargin: thresholdLabelMargin,\r\n                thresholdLabelFontSize: thresholdLabelFontSize,\r\n                gaugeOuterHeight: gaugeOuterHeight\r\n            };\r\n        }\r\n\r\n        /**\r\n         * calculate the values which are set as 'auto'\r\n         *\r\n         * @method calculateAutoValues\r\n         * @param  {Object} gaugeOptionsi the options of the gauge\r\n         * @param  {Number} cellWidth the width of cell\r\n         */\r\n        function calculateAutoValues(gaugeOptionsi, cellWidth) {\r\n\r\n            if (gaugeOptionsi.gauge.width === \"auto\") {\r\n                gaugeOptionsi.gauge.width = Math.max(5, cellWidth / 8);\r\n            }\r\n            if (gaugeOptionsi.label.margin === \"auto\") {\r\n                gaugeOptionsi.label.margin = Math.max(1, cellWidth / 20);\r\n            }\r\n            if (gaugeOptionsi.label.font.size === \"auto\") {\r\n                gaugeOptionsi.label.font.size = Math.max(5, cellWidth / 8);\r\n            }\r\n            if (gaugeOptionsi.value.margin === \"auto\") {\r\n                gaugeOptionsi.value.margin = Math.max(1, cellWidth / 30);\r\n            }\r\n            if (gaugeOptionsi.value.font.size === \"auto\") {\r\n                gaugeOptionsi.value.font.size = Math.max(5, cellWidth / 9);\r\n            }\r\n            if (gaugeOptionsi.threshold.width === \"auto\") {\r\n                gaugeOptionsi.threshold.width = Math.max(3, cellWidth / 100);\r\n            }\r\n            if (gaugeOptionsi.threshold.label.margin === \"auto\") {\r\n                gaugeOptionsi.threshold.label.margin = Math.max(3, cellWidth / 40);\r\n            }\r\n            if (gaugeOptionsi.threshold.label.font.size === \"auto\") {\r\n                gaugeOptionsi.threshold.label.font.size = Math.max(5, cellWidth / 15);\r\n            }\r\n\r\n        }\r\n        Gauge.prototype.calculateAutoValues = calculateAutoValues;\r\n\r\n        /**\r\n         * calculate the layout of the cell inside\r\n         *\r\n         * @method calculateCellLayout\r\n         * @param  {Object} gaugeOptionsi the options of the gauge\r\n         * @param  {Number} cellWidth the width of cell\r\n         * @param  {Number} i the index of the series\r\n         * @return the calculated cell layout properties\r\n         */\r\n        Gauge.prototype.calculateCellLayout = function(gaugeOptionsi, layout, i) {\r\n\r\n            // calculate top, left and center\r\n            var c = col(layout.columns, i);\r\n            var r = row(layout.columns, i);\r\n            var x = layout.margin + (layout.cellWidth + layout.hMargin) * c;\r\n            var y = layout.margin + (layout.cellHeight + layout.vMargin) * r;\r\n            var cx = x + (layout.cellWidth / 2);\r\n            var cy = y + layout.cellMargin + (layout.labelMargin * 2) + layout.labelFontSize + layout.thresholdWidth\r\n                        + layout.thresholdLabelFontSize + (layout.thresholdLabelMargin * 2) + layout.radius;\r\n            var blank = layout.cellHeight - (layout.cellMargin * 2) - (layout.labelMargin * 2) - layout.labelFontSize - layout.gaugeOuterHeight;\r\n            var offsetY = 0;\r\n            if (gaugeOptionsi.cell.vAlign === \"middle\") {\r\n                offsetY = (blank / 2);\r\n            } else if (gaugeOptionsi.cell.vAlign === \"bottom\") {\r\n                offsetY = blank;\r\n            }\r\n            cy += offsetY;\r\n\r\n            return {\r\n                col: c,\r\n                row: r,\r\n                x: x,\r\n                y: y,\r\n                offsetY: offsetY,\r\n                cellWidth: layout.cellWidth,\r\n                cellHeight: layout.cellHeight,\r\n                cellMargin: layout.cellMargin,\r\n                cx: cx,\r\n                cy: cy\r\n            }\r\n        }\r\n\r\n        /**\r\n         * draw the background of chart\r\n         *\r\n         * @method drawBackground\r\n         * @param  {Object} layout the layout properties\r\n         */\r\n        Gauge.prototype.drawBackground = function(layout) {\r\n\r\n            if (!gaugeOptions.frame.show) {\r\n                return;\r\n            }\r\n            context.save();\r\n            context.strokeStyle = options.grid.borderColor;\r\n            context.lineWidth = options.grid.borderWidth;\r\n            context.strokeRect(0, 0, layout.canvasWidth, layout.canvasHeight);\r\n            if (options.grid.backgroundColor) {\r\n                context.fillStyle = options.grid.backgroundColor;\r\n                context.fillRect(0, 0, layout.canvasWidth, layout.canvasHeight);\r\n            }\r\n            context.restore();\r\n        }\r\n\r\n        /**\r\n         * draw the background of cell\r\n         *\r\n         * @method drawCellBackground\r\n         * @param  {Object} gaugeOptionsi the options of the gauge\r\n         * @param  {Object} cellLayout the cell layout properties\r\n         */\r\n        Gauge.prototype.drawCellBackground = function(gaugeOptionsi, cellLayout) {\r\n\r\n            context.save();\r\n            if (gaugeOptionsi.cell.border && gaugeOptionsi.cell.border.show && gaugeOptionsi.cell.border.color && gaugeOptionsi.cell.border.width) {\r\n                context.strokeStyle = gaugeOptionsi.cell.border.color;\r\n                context.lineWidth = gaugeOptionsi.cell.border.width;\r\n                context.strokeRect(cellLayout.x, cellLayout.y, cellLayout.cellWidth, cellLayout.cellHeight);\r\n            }\r\n            if (gaugeOptionsi.cell.background && gaugeOptionsi.cell.background.color) {\r\n                context.fillStyle = gaugeOptionsi.cell.background.color;\r\n                context.fillRect(cellLayout.x, cellLayout.y, cellLayout.cellWidth, cellLayout.cellHeight);\r\n            }\r\n            context.restore();\r\n        }\r\n\r\n        /**\r\n         * draw the gauge\r\n         *\r\n         * @method drawGauge\r\n         * @param  {Object} gaugeOptionsi the options of the gauge\r\n         * @param  {Object} layout the layout properties\r\n         * @param  {Object} cellLayout the cell layout properties\r\n         * @param  {String} label the label of data\r\n         * @param  {Number} data the value of the gauge\r\n         */\r\n        Gauge.prototype.drawGauge = function(gaugeOptionsi, layout, cellLayout, label, data) {\r\n\r\n\r\n            var blur = gaugeOptionsi.gauge.shadow.show ? gaugeOptionsi.gauge.shadow.blur : 0;\r\n\r\n\r\n            // draw gauge frame\r\n            drawArcWithShadow(\r\n                cellLayout.cx, // center x\r\n                cellLayout.cy, // center y\r\n                layout.radius,\r\n                layout.width,\r\n                toRad(gaugeOptionsi.gauge.startAngle),\r\n                toRad(gaugeOptionsi.gauge.endAngle),\r\n                gaugeOptionsi.gauge.border.color,      // line color\r\n                gaugeOptionsi.gauge.border.width,      // line width\r\n                gaugeOptionsi.gauge.background.color,  // fill color\r\n                blur);\r\n\r\n            // draw gauge\r\n            var c1 = getColor(gaugeOptionsi, data);\r\n            var a2 = calculateAngle(gaugeOptionsi, layout, data);\r\n            drawArcWithShadow(\r\n                cellLayout.cx, // center x\r\n                cellLayout.cy, // center y\r\n                layout.radius - 1,\r\n                layout.width - 2,\r\n                toRad(gaugeOptionsi.gauge.startAngle),\r\n                toRad(a2),\r\n                c1,           // line color\r\n                1,            // line width\r\n                c1,           // fill color\r\n                blur);\r\n        }\r\n\r\n        /**\r\n         * decide the color of the data from the threshold options\r\n         *\r\n         * @method getColor\r\n         * @private\r\n         * @param  {Object} gaugeOptionsi the options of the gauge\r\n         * @param  {Number} data the value of the gauge\r\n         */\r\n        function getColor(gaugeOptionsi, data) {\r\n            var color;\r\n            for (var i = 0; i < gaugeOptionsi.threshold.values.length; i++) {\r\n                var threshold = gaugeOptionsi.threshold.values[i];\r\n                color = threshold.color;\r\n                if (data < threshold.value) {\r\n                    break;\r\n                }\r\n            }\r\n            return color;\r\n        }\r\n\r\n        /**\r\n         * calculate the angle of the data\r\n         *\r\n         * @method calculateAngle\r\n         * @private\r\n         * @param  {Object} gaugeOptionsi the options of the gauge\r\n         * @param  {Object} layout the layout properties\r\n         * @param  {Number} data the value of the gauge\r\n         */\r\n        function calculateAngle(gaugeOptionsi, layout, data) {\r\n            var a =\r\n                gaugeOptionsi.gauge.startAngle\r\n                    + (gaugeOptionsi.gauge.endAngle - gaugeOptionsi.gauge.startAngle)\r\n                        * ((data - gaugeOptionsi.gauge.min) / (gaugeOptionsi.gauge.max - gaugeOptionsi.gauge.min));\r\n\r\n            if (a < gaugeOptionsi.gauge.startAngle) {\r\n                a = gaugeOptionsi.gauge.startAngle;\r\n            } else if (a > gaugeOptionsi.gauge.endAngle) {\r\n                a = gaugeOptionsi.gauge.endAngle;\r\n            }\r\n            return a;\r\n        }\r\n\r\n        /**\r\n         * draw the arc of the threshold\r\n         *\r\n         * @method drawThreshold\r\n         * @param  {Object} gaugeOptionsi the options of the gauge\r\n         * @param  {Object} layout the layout properties\r\n         * @param  {Object} cellLayout the cell layout properties\r\n         */\r\n        Gauge.prototype.drawThreshold = function(gaugeOptionsi, layout, cellLayout) {\r\n\r\n            var a1 = gaugeOptionsi.gauge.startAngle;\r\n            for (var i = 0; i < gaugeOptionsi.threshold.values.length; i++) {\r\n                var threshold = gaugeOptionsi.threshold.values[i];\r\n                c1 = threshold.color;\r\n                a2 = calculateAngle(gaugeOptionsi, layout, threshold.value);\r\n                drawArc(\r\n                    context,\r\n                    cellLayout.cx, // center x\r\n                    cellLayout.cy, // center y\r\n                    layout.radius + layout.thresholdWidth,\r\n                    layout.thresholdWidth - 2,\r\n                    toRad(a1),\r\n                    toRad(a2),\r\n                    c1,           // line color\r\n                    1,            // line width\r\n                    c1);          // fill color\r\n                a1 = a2;\r\n            }\r\n        }\r\n\r\n        /**\r\n         * draw an arc with a shadow\r\n         *\r\n         * @method drawArcWithShadow\r\n         * @private\r\n         * @param  {Number} cx the x position of the center\r\n         * @param  {Number} cy the y position of the center\r\n         * @param  {Number} r the radius of an arc\r\n         * @param  {Number} w the width of an arc\r\n         * @param  {Number} rd1 the start angle of an arc in radians\r\n         * @param  {Number} rd2 the end angle of an arc in radians\r\n         * @param  {String} lc the color of a line\r\n         * @param  {Number} lw the widht of a line\r\n         * @param  {String} fc the fill color  of an arc\r\n         * @param  {Number} blur the shdow blur\r\n         */\r\n        function drawArcWithShadow(cx, cy, r, w, rd1, rd2, lc, lw, fc, blur) {\r\n            if (rd1 === rd2) {\r\n                return;\r\n            }\r\n            context.save();\r\n\r\n            drawArc(context, cx, cy, r, w, rd1, rd2, lc, lw, fc);\r\n\r\n            if (blur) {\r\n                drawArc(context, cx, cy, r, w, rd1, rd2);\r\n                context.clip();\r\n                context.shadowOffsetX = 0;\r\n                context.shadowOffsetY = 0;\r\n                context.shadowBlur = 10;\r\n                context.shadowColor = \"gray\";\r\n                drawArc(context, cx, cy, r + 1, w + 2, rd1, rd2, lc, 1);\r\n            }\r\n            context.restore();\r\n        }\r\n\r\n        /**\r\n         * draw the label of the gauge\r\n         *\r\n         * @method drawLable\r\n         * @param  {Object} gaugeOptionsi the options of the gauge\r\n         * @param  {Object} layout the layout properties\r\n         * @param  {Object} cellLayout the cell layout properties\r\n         * @param  {Number} i the index of the series\r\n         * @param  {Object} item the item of the series\r\n         */\r\n        Gauge.prototype.drawLable = function(gaugeOptionsi, layout, cellLayout, i, item) {\r\n\r\n            drawText(\r\n                cellLayout.cx,\r\n                cellLayout.y + cellLayout.cellMargin + layout.labelMargin + cellLayout.offsetY,\r\n                \"flotGagueLabel\" + i,\r\n                gaugeOptionsi.label.formatter ? gaugeOptionsi.label.formatter(item.label, item.data[0][1]) : text,\r\n                gaugeOptionsi.label);\r\n        }\r\n\r\n        /**\r\n         * draw the value of the gauge\r\n         *\r\n         * @method drawValue\r\n         * @param  {Object} gaugeOptionsi the options of the gauge\r\n         * @param  {Object} layout the layout properties\r\n         * @param  {Object} cellLayout the cell layout properties\r\n         * @param  {Number} i the index of the series\r\n         * @param  {Object} item the item of the series\r\n         */\r\n        Gauge.prototype.drawValue = function(gaugeOptionsi, layout, cellLayout, i, item) {\r\n\r\n            drawText(\r\n                cellLayout.cx,\r\n                cellLayout.cy - (gaugeOptionsi.value.font.size / 2),\r\n                \"flotGagueValue\" + i,\r\n                gaugeOptionsi.value.formatter ? gaugeOptionsi.value.formatter(item.label, item.data[0][1]) : text,\r\n                gaugeOptionsi.value);\r\n        }\r\n\r\n        /**\r\n         * draw the values of the threshold\r\n         *\r\n         * @method drawThresholdValues\r\n         * @param  {Object} gaugeOptionsi the options of the gauge\r\n         * @param  {Object} layout the layout properties\r\n         * @param  {Object} cellLayout the cell layout properties\r\n         * @param  {Number} i the index of the series\r\n         */\r\n        Gauge.prototype.drawThresholdValues = function(gaugeOptionsi, layout, cellLayout, i) {\r\n\r\n            // min, max\r\n            drawThresholdValue(gaugeOptionsi, layout, cellLayout, \"Min\" + i, gaugeOptionsi.gauge.min, gaugeOptionsi.gauge.startAngle);\r\n            drawThresholdValue(gaugeOptionsi, layout, cellLayout, \"Max\" + i, gaugeOptionsi.gauge.max, gaugeOptionsi.gauge.endAngle);\r\n            // threshold values\r\n            for (var j = 0; j < gaugeOptionsi.threshold.values.length; j++) {\r\n                var threshold = gaugeOptionsi.threshold.values[j];\r\n                if (threshold.value > gaugeOptionsi.gauge.min && threshold.value < gaugeOptionsi.gauge.max) {\r\n                    var a = calculateAngle(gaugeOptionsi, layout, threshold.value);\r\n                    drawThresholdValue(gaugeOptionsi, layout, cellLayout, i + \"_\" + j, threshold.value, a);\r\n                }\r\n            }\r\n        }\r\n\r\n        /**\r\n         * draw the value of the threshold\r\n         *\r\n         * @method drawThresholdValue\r\n         * @param  {Object} gaugeOptionsi the options of the gauge\r\n         * @param  {Object} layout the layout properties\r\n         * @param  {Object} cellLayout the cell layout properties\r\n         * @param  {Number} i the index of the series\r\n         * @param  {Number} value the value of the threshold\r\n         * @param  {Number} a the angle of the value drawn\r\n         */\r\n        function drawThresholdValue(gaugeOptionsi, layout, cellLayout, i, value, a) {\r\n            drawText(\r\n                cellLayout.cx\r\n                    + ((layout.thresholdLabelMargin + (layout.thresholdLabelFontSize / 2) + layout.radius)\r\n                        * Math.cos(toRad(a))),\r\n                cellLayout.cy\r\n                    + ((layout.thresholdLabelMargin + (layout.thresholdLabelFontSize / 2) + layout.radius)\r\n                        * Math.sin(toRad(a))),\r\n                \"flotGagueThresholdValue\" + i,\r\n                gaugeOptionsi.threshold.label.formatter ? gaugeOptionsi.threshold.label.formatter(value) : value,\r\n                gaugeOptionsi.threshold.label,\r\n                a);\r\n        }\r\n\r\n        /**\r\n         * draw a text\r\n         *\r\n         * the textOptions is assumed as follows:\r\n         *\r\n         *   textOptions: {\r\n         *       background: {\r\n         *           color: null,\r\n         *           opacity: 0\r\n         *       },\r\n         *       font: {\r\n         *           size: \"auto\"\r\n         *           family: \"\\\" \\\",sans-serif\"\r\n         *       },\r\n         *       color: null\r\n         *   }\r\n         *\r\n         * @method drawText\r\n         * @private\r\n         * @param  {Number} x the x position of the text drawn (left top)\r\n         * @param  {Number} y the y position of the text drawn (left top)\r\n         * @param  {String} id the id of the dom element\r\n         * @param  {String} text the text drawn\r\n         * @param  {Object} textOptions the option of the text\r\n         * @param  {Number} [a] the angle of the value drawn\r\n         */\r\n        function drawText(x, y, id, text, textOptions, a) {\r\n            var span = $(placeholder).find(\"#\" + id);\r\n            var exists = span.length;\r\n            if (!exists) {\r\n                span = $(\"<span></span>\")\r\n                span.attr(\"id\", id);\r\n                span.attr(\"class\", \"flot-temp-elem\");\r\n                placeholder.append(span);\r\n            }\r\n\r\n            span.css(\"position\", \"absolute\");\r\n            span.css(\"top\", y + \"px\");\r\n            span.css(\"white-space\", \"nowrap\");\r\n\r\n            if (textOptions.font.size) {\r\n              span.css(\"font-size\", textOptions.font.size + \"px\");\r\n            }\r\n            if (textOptions.font.family) {\r\n              span.css(\"font-family\", textOptions.font.family);\r\n            }\r\n            if (textOptions.color) {\r\n              span.css(\"color\", textOptions.color);\r\n            }\r\n            if (textOptions.background.color) {\r\n              span.css(\"background-color\", textOptions.background.color);\r\n            }\r\n            if (textOptions.background.opacity) {\r\n              span.css(\"opacity\", textOptions.background.opacity);\r\n            }\r\n            span.text(text);\r\n            // after append, readjust the left position\r\n            span.css(\"left\", x + \"px\"); // for redraw, resetting the left position is needed here\r\n            span.css(\"left\", (parseInt(span.css(\"left\")) - (span.width()/ 2)) + \"px\");\r\n\r\n            // at last, set angle\r\n            if (!exists && a) {\r\n                span.css(\"top\", (parseInt(span.css(\"top\")) - (span.height()/ 2)) + \"px\");\r\n                span.css(\"transform\", \"rotate(\" + ((180 * a) + 90) + \"deg)\"); // not supported for ie8\r\n            }\r\n        }\r\n\r\n        return Gauge;\r\n    })();\r\n    /**\r\n     * get a instance of Logger\r\n     *\r\n     * @method  getLogger\r\n     * @for flot.gauge\r\n     * @private\r\n     * @param  {Object} debugOptions the options of debug\r\n     */\r\n    function getLogger(debugOptions) {\r\n        return typeof Logger !== \"undefined\" ? new Logger(debugOptions) : null;\r\n    }\r\n\r\n    /**\r\n     * calculate the index of columns for the specified data\r\n     *\r\n     * @method col\r\n     * @for flot.gauge\r\n     * @param  {Number} columns the number of columns\r\n     * @param  {Number} i       the index of the series\r\n     * @return the index of columns\r\n     */\r\n    function col(columns, i) {\r\n        return i % columns;\r\n    }\r\n\r\n    /**\r\n     * calculate the index of rows for the specified data\r\n     *\r\n     * @method row\r\n     * @for flot.gauge\r\n     * @param  {Number} columns the number of rows\r\n     * @param  {Number} i       the index of the series\r\n     * @return the index of rows\r\n     */\r\n    function row(columns, i) {\r\n        return Math.floor(i / columns);\r\n    }\r\n\r\n    /**\r\n     * calculate the angle in radians\r\n     *\r\n     * internally, use a number without PI (0 - 2).\r\n     * so, in this function, multiply PI\r\n     *\r\n     * @method toRad\r\n     * @for flot.gauge\r\n     * @param  {Number} a the number of angle without PI\r\n     * @return the angle in radians\r\n     */\r\n    function toRad(a) {\r\n        return a * Math.PI;\r\n    }\r\n\r\n    /**\r\n     * draw an arc\r\n     *\r\n     * @method drawArc\r\n     * @for flot.gauge\r\n     * @param  {Object} context the context of canvas\r\n     * @param  {Number} cx the x position of the center\r\n     * @param  {Number} cy the y position of the center\r\n     * @param  {Number} r the radius of an arc\r\n     * @param  {Number} w the width of an arc\r\n     * @param  {Number} rd1 the start angle of an arc in radians\r\n     * @param  {Number} rd2 the end angle of an arc in radians\r\n     * @param  {String} lc the color of a line\r\n     * @param  {Number} lw the widht of a line\r\n     * @param  {String} fc the fill color  of an arc\r\n     */\r\n    function drawArc(context, cx, cy, r, w, rd1, rd2, lc, lw, fc) {\r\n        if (rd1 === rd2) {\r\n            return;\r\n        }\r\n        var counterClockwise = false;\r\n        context.save();\r\n        context.beginPath();\r\n        context.arc(cx, cy, r, rd1, rd2, counterClockwise);\r\n        context.lineTo(cx + (r - w) * Math.cos(rd2),\r\n                       cy + (r - w) * Math.sin(rd2));\r\n        context.arc(cx, cy, r - w, rd2, rd1, !counterClockwise);\r\n        context.closePath();\r\n        if (lw) {\r\n            context.lineWidth = lw;\r\n        }\r\n        if (lc) {\r\n            context.strokeStyle = lc;\r\n            context.stroke();\r\n        }\r\n        if (fc) {\r\n            context.fillStyle = fc;\r\n            context.fill();\r\n        }\r\n        context.restore();\r\n    }\r\n\r\n    /**\r\n     * initialize plugin\r\n     *\r\n     * @method init\r\n     * @for flot.gauge\r\n     * @private\r\n     * @param  {Object} plot a instance of plot\r\n     */\r\n    function init (plot) {\r\n        // add processOptions hook\r\n        plot.hooks.processOptions.push(function(plot, options) {\r\n            var logger = getLogger(options.series.gauges.debug);\r\n\r\n\r\n\r\n\r\n            // turn 'grid' and 'legend' off\r\n            if (options.series.gauges.show) {\r\n                options.grid.show = false;\r\n                options.legend.show = false;\r\n            }\r\n\r\n            // sort threshold\r\n            var thresholds = options.series.gauges.threshold.values;\r\n\r\n            thresholds.sort(function(a, b) {\r\n                if (a.value < b.value) {\r\n                    return -1;\r\n                } else if (a.value > b.value) {\r\n                    return 1;\r\n                } else {\r\n                    return 0;\r\n                }\r\n            });\r\n\r\n\r\n\r\n        });\r\n\r\n        // add draw hook\r\n        plot.hooks.draw.push(function(plot, context) {\r\n            var options = plot.getOptions();\r\n            var gaugeOptions = options.series.gauges;\r\n\r\n            var logger = getLogger(gaugeOptions.debug);\r\n\r\n\r\n            if (!gaugeOptions.show) {\r\n                return;\r\n            }\r\n\r\n            var series = plot.getData();\r\n\r\n            if (!series || !series.length) {\r\n                return; // if no series were passed\r\n            }\r\n\r\n            var gauge = new Gauge(plot, context);\r\n\r\n            // calculate layout\r\n            var layout = gauge.calculateLayout();\r\n\r\n            // debug layout\r\n            if (gaugeOptions.debug.layout) {\r\n\r\n            }\r\n\r\n            // draw background\r\n            gauge.drawBackground(layout)\r\n\r\n            // draw cells (label, gauge, value, threshold)\r\n            for (var i = 0; i < series.length; i++) {\r\n                var item = series[i];\r\n\r\n                var gaugeOptionsi = $.extend({}, gaugeOptions, item.gauges);\r\n                if (item.gauges) {\r\n                    // re-calculate 'auto' values\r\n                    gauge.calculateAutoValues(gaugeOptionsi, layout.cellWidth);\r\n                }\r\n\r\n                // calculate cell layout\r\n                var cellLayout = gauge.calculateCellLayout(gaugeOptionsi, layout, i);\r\n\r\n                // draw cell background\r\n                gauge.drawCellBackground(gaugeOptionsi, cellLayout)\r\n                // debug layout\r\n                if (gaugeOptionsi.debug.layout) {\r\n\r\n                }\r\n                // draw label\r\n                if (gaugeOptionsi.label.show) {\r\n                    gauge.drawLable(gaugeOptionsi, layout, cellLayout, i, item);\r\n                }\r\n                // draw gauge\r\n                gauge.drawGauge(gaugeOptionsi, layout, cellLayout, item.label, item.data[0][1]);\r\n                // draw threshold\r\n                if (gaugeOptionsi.threshold.show) {\r\n                    gauge.drawThreshold(gaugeOptionsi, layout, cellLayout);\r\n                }\r\n                if (gaugeOptionsi.threshold.label.show) {\r\n                    gauge.drawThresholdValues(gaugeOptionsi, layout, cellLayout, i)\r\n                }\r\n                // draw value\r\n                if (gaugeOptionsi.value.show) {\r\n                    gauge.drawValue(gaugeOptionsi, layout, cellLayout, i, item);\r\n                }\r\n            }\r\n        });\r\n    }\r\n\r\n    /**\r\n     * [defaults description]\r\n     *\r\n     * @property defaults\r\n     * @type {Object}\r\n     */\r\n    var defaults = {\r\n        series: {\r\n            gauges: {\r\n                debug: {\r\n                    log: false,\r\n                    layout: false,\r\n                    alert: false\r\n                },\r\n                show: false,\r\n                layout: {\r\n                    margin: 5,\r\n                    columns: 3,\r\n                    hMargin: 5,\r\n                    vMargin: 5,\r\n                    square: false\r\n                },\r\n                frame: {\r\n                    show: true\r\n                },\r\n                cell: {\r\n                    background: {\r\n                        color: null\r\n                    },\r\n                    border: {\r\n                        show: true,\r\n                        color: \"black\",\r\n                        width: 1\r\n                    },\r\n                    margin: 5,\r\n                    vAlign: \"middle\" // 'top' or 'middle' or 'bottom'\r\n                },\r\n                gauge: {\r\n                    width: \"auto\", // a specified number, or 'auto'\r\n                    startAngle: 0.9, // 0 - 2 factor of the radians\r\n                    endAngle: 2.1, // 0 - 2 factor of the radians\r\n                    min: 0,\r\n                    max: 100,\r\n                    background: {\r\n                        color: \"white\"\r\n                    },\r\n                    border: {\r\n                        color: \"lightgray\",\r\n                        width: 2\r\n                    },\r\n                    shadow: {\r\n                        show: true,\r\n                        blur: 5\r\n                    }\r\n                },\r\n                label: {\r\n                    show: true,\r\n                    margin: \"auto\", // a specified number, or 'auto'\r\n                    background: {\r\n                        color: null,\r\n                        opacity: 0\r\n                    },\r\n                    font: {\r\n                        size: \"auto\", // a specified number, or 'auto'\r\n                        family: \"sans-serif\"\r\n                    },\r\n                    color: null,\r\n                    formatter: function(label, value) {\r\n                        return label;\r\n                    }\r\n                },\r\n                value: {\r\n                    show: true,\r\n                    margin: \"auto\", // a specified number, or 'auto'\r\n                    background: {\r\n                        color: null,\r\n                        opacity: 0\r\n                    },\r\n                    font: {\r\n                        size: \"auto\", // a specified number, or 'auto'\r\n                        family: \"sans-serif\"\r\n                    },\r\n                    color: null,\r\n                    formatter: function(label, value) {\r\n                        return parseInt(value);\r\n                    }\r\n                },\r\n                threshold: {\r\n                    show: true,\r\n                    width: \"auto\", // a specified number, or 'auto'\r\n                    label: {\r\n                        show: true,\r\n                        margin: \"auto\", // a specified number, or 'auto'\r\n                        background: {\r\n                            color: null,\r\n                            opacity: 0\r\n                        },\r\n                        font: {\r\n                            size: \"auto\", // a specified number, or 'auto'\r\n                            family: \",sans-serif\"\r\n                        },\r\n                        color: null,\r\n                        formatter: function(value) {\r\n                            return value;\r\n                        }\r\n                    },\r\n                    values: [\r\n\r\n                    ]\r\n                }\r\n            }\r\n        }\r\n    };\r\n\r\n    // register the gauge plugin\r\n    $.plot.plugins.push({\r\n        init: init,\r\n        options: defaults,\r\n        name: \"gauge\",\r\n        version: \"1.1.0\"\r\n    });\r\n\r\n})(jQuery);\r\n\r\n","/* Javascript plotting library for jQuery, version 0.8.3.\r\n\r\nCopyright (c) 2007-2014 IOLA and Ole Laursen.\r\nLicensed under the MIT license.\r\n\r\n*/\r\n\r\n// first an inline dependency, jquery.colorhelpers.js, we inline it here\r\n// for convenience\r\n\r\n/* Plugin for jQuery for working with colors.\r\n *\r\n * Version 1.1.\r\n *\r\n * Inspiration from jQuery color animation plugin by John Resig.\r\n *\r\n * Released under the MIT license by Ole Laursen, October 2009.\r\n *\r\n * Examples:\r\n *\r\n *   $.color.parse(\"#fff\").scale('rgb', 0.25).add('a', -0.5).toString()\r\n *   var c = $.color.extract($(\"#mydiv\"), 'background-color');\r\n *   console.log(c.r, c.g, c.b, c.a);\r\n *   $.color.make(100, 50, 25, 0.4).toString() // returns \"rgba(100,50,25,0.4)\"\r\n *\r\n * Note that .scale() and .add() return the same modified object\r\n * instead of making a new one.\r\n *\r\n * V. 1.1: Fix error handling so e.g. parsing an empty string does\r\n * produce a color rather than just crashing.\r\n */\r\n(function($){$.color={};$.color.make=function(r,g,b,a){var o={};o.r=r||0;o.g=g||0;o.b=b||0;o.a=a!=null?a:1;o.add=function(c,d){for(var i=0;i<c.length;++i)o[c.charAt(i)]+=d;return o.normalize()};o.scale=function(c,f){for(var i=0;i<c.length;++i)o[c.charAt(i)]*=f;return o.normalize()};o.toString=function(){if(o.a>=1){return\"rgb(\"+[o.r,o.g,o.b].join(\",\")+\")\"}else{return\"rgba(\"+[o.r,o.g,o.b,o.a].join(\",\")+\")\"}};o.normalize=function(){function clamp(min,value,max){return value<min?min:value>max?max:value}o.r=clamp(0,parseInt(o.r),255);o.g=clamp(0,parseInt(o.g),255);o.b=clamp(0,parseInt(o.b),255);o.a=clamp(0,o.a,1);return o};o.clone=function(){return $.color.make(o.r,o.b,o.g,o.a)};return o.normalize()};$.color.extract=function(elem,css){var c;do{c=elem.css(css).toLowerCase();if(c!=\"\"&&c!=\"transparent\")break;elem=elem.parent()}while(elem.length&&!$.nodeName(elem.get(0),\"body\"));if(c==\"rgba(0, 0, 0, 0)\")c=\"transparent\";return $.color.parse(c)};$.color.parse=function(str){var res,m=$.color.make;if(res=/rgb\\(\\s*([0-9]{1,3})\\s*,\\s*([0-9]{1,3})\\s*,\\s*([0-9]{1,3})\\s*\\)/.exec(str))return m(parseInt(res[1],10),parseInt(res[2],10),parseInt(res[3],10));if(res=/rgba\\(\\s*([0-9]{1,3})\\s*,\\s*([0-9]{1,3})\\s*,\\s*([0-9]{1,3})\\s*,\\s*([0-9]+(?:\\.[0-9]+)?)\\s*\\)/.exec(str))return m(parseInt(res[1],10),parseInt(res[2],10),parseInt(res[3],10),parseFloat(res[4]));if(res=/rgb\\(\\s*([0-9]+(?:\\.[0-9]+)?)\\%\\s*,\\s*([0-9]+(?:\\.[0-9]+)?)\\%\\s*,\\s*([0-9]+(?:\\.[0-9]+)?)\\%\\s*\\)/.exec(str))return m(parseFloat(res[1])*2.55,parseFloat(res[2])*2.55,parseFloat(res[3])*2.55);if(res=/rgba\\(\\s*([0-9]+(?:\\.[0-9]+)?)\\%\\s*,\\s*([0-9]+(?:\\.[0-9]+)?)\\%\\s*,\\s*([0-9]+(?:\\.[0-9]+)?)\\%\\s*,\\s*([0-9]+(?:\\.[0-9]+)?)\\s*\\)/.exec(str))return m(parseFloat(res[1])*2.55,parseFloat(res[2])*2.55,parseFloat(res[3])*2.55,parseFloat(res[4]));if(res=/#([a-fA-F0-9]{2})([a-fA-F0-9]{2})([a-fA-F0-9]{2})/.exec(str))return m(parseInt(res[1],16),parseInt(res[2],16),parseInt(res[3],16));if(res=/#([a-fA-F0-9])([a-fA-F0-9])([a-fA-F0-9])/.exec(str))return m(parseInt(res[1]+res[1],16),parseInt(res[2]+res[2],16),parseInt(res[3]+res[3],16));var name=$.trim(str).toLowerCase();if(name==\"transparent\")return m(255,255,255,0);else{res=lookupColors[name]||[0,0,0];return m(res[0],res[1],res[2])}};var lookupColors={aqua:[0,255,255],azure:[240,255,255],beige:[245,245,220],black:[0,0,0],blue:[0,0,255],brown:[165,42,42],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgrey:[169,169,169],darkgreen:[0,100,0],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkviolet:[148,0,211],fuchsia:[255,0,255],gold:[255,215,0],green:[0,128,0],indigo:[75,0,130],khaki:[240,230,140],lightblue:[173,216,230],lightcyan:[224,255,255],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightyellow:[255,255,224],lime:[0,255,0],magenta:[255,0,255],maroon:[128,0,0],navy:[0,0,128],olive:[128,128,0],orange:[255,165,0],pink:[255,192,203],purple:[128,0,128],violet:[128,0,128],red:[255,0,0],silver:[192,192,192],white:[255,255,255],yellow:[255,255,0]}})(jQuery);\r\n\r\n// the actual Flot code\r\n(function($) {\r\n\r\n\t// Cache the prototype hasOwnProperty for faster access\r\n\r\n\tvar hasOwnProperty = Object.prototype.hasOwnProperty;\r\n\r\n    // A shim to provide 'detach' to jQuery versions prior to 1.4.  Using a DOM\r\n    // operation produces the same effect as detach, i.e. removing the element\r\n    // without touching its jQuery data.\r\n\r\n    // Do not merge this into Flot 0.9, since it requires jQuery 1.4.4+.\r\n\r\n    if (!$.fn.detach) {\r\n        $.fn.detach = function() {\r\n            return this.each(function() {\r\n                if (this.parentNode) {\r\n                    this.parentNode.removeChild( this );\r\n                }\r\n            });\r\n        };\r\n    }\r\n\r\n\t///////////////////////////////////////////////////////////////////////////\r\n\t// The Canvas object is a wrapper around an HTML5 <canvas> tag.\r\n\t//\r\n\t// @constructor\r\n\t// @param {string} cls List of classes to apply to the canvas.\r\n\t// @param {element} container Element onto which to append the canvas.\r\n\t//\r\n\t// Requiring a container is a little iffy, but unfortunately canvas\r\n\t// operations don't work unless the canvas is attached to the DOM.\r\n\r\n\tfunction Canvas(cls, container) {\r\n\r\n\t\tvar element = container.children(\".\" + cls)[0];\r\n\r\n\t\tif (element == null) {\r\n\r\n\t\t\telement = document.createElement(\"canvas\");\r\n\t\t\telement.className = cls;\r\n\r\n\t\t\t$(element).css({ direction: \"ltr\", position: \"absolute\", left: 0, top: 0 })\r\n\t\t\t\t.appendTo(container);\r\n\r\n\t\t\t// If HTML5 Canvas isn't available, fall back to [Ex|Flash]canvas\r\n\r\n\t\t\tif (!element.getContext) {\r\n\t\t\t\tif (window.G_vmlCanvasManager) {\r\n\t\t\t\t\telement = window.G_vmlCanvasManager.initElement(element);\r\n\t\t\t\t} else {\r\n\t\t\t\t\tthrow new Error(\"Canvas is not available. If you're using IE with a fall-back such as Excanvas, then there's either a mistake in your conditional include, or the page has no DOCTYPE and is rendering in Quirks Mode.\");\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tthis.element = element;\r\n\r\n\t\tvar context = this.context = element.getContext(\"2d\");\r\n\r\n\t\t// Determine the screen's ratio of physical to device-independent\r\n\t\t// pixels.  This is the ratio between the canvas width that the browser\r\n\t\t// advertises and the number of pixels actually present in that space.\r\n\r\n\t\t// The iPhone 4, for example, has a device-independent width of 320px,\r\n\t\t// but its screen is actually 640px wide.  It therefore has a pixel\r\n\t\t// ratio of 2, while most normal devices have a ratio of 1.\r\n\r\n\t\tvar devicePixelRatio = window.devicePixelRatio || 1,\r\n\t\t\tbackingStoreRatio =\r\n\t\t\t\tcontext.webkitBackingStorePixelRatio ||\r\n\t\t\t\tcontext.mozBackingStorePixelRatio ||\r\n\t\t\t\tcontext.msBackingStorePixelRatio ||\r\n\t\t\t\tcontext.oBackingStorePixelRatio ||\r\n\t\t\t\tcontext.backingStorePixelRatio || 1;\r\n\r\n\t\tthis.pixelRatio = devicePixelRatio / backingStoreRatio;\r\n\r\n\t\t// Size the canvas to match the internal dimensions of its container\r\n\r\n\t\tthis.resize(container.width(), container.height());\r\n\r\n\t\t// Collection of HTML div layers for text overlaid onto the canvas\r\n\r\n\t\tthis.textContainer = null;\r\n\t\tthis.text = {};\r\n\r\n\t\t// Cache of text fragments and metrics, so we can avoid expensively\r\n\t\t// re-calculating them when the plot is re-rendered in a loop.\r\n\r\n\t\tthis._textCache = {};\r\n\t\tthis._textSizeCache = window.flotTextSizeCache = window.flotTextSizeCache || {};\r\n\t}\r\n\r\n\t// Resizes the canvas to the given dimensions.\r\n\t//\r\n\t// @param {number} width New width of the canvas, in pixels.\r\n\t// @param {number} width New height of the canvas, in pixels.\r\n\r\n\tCanvas.prototype.resize = function(width, height) {\r\n\r\n\t\tif (width <= 0 || height <= 0) {\r\n\t\t\tthrow new Error(\"Invalid dimensions for plot, width = \" + width + \", height = \" + height);\r\n\t\t}\r\n\r\n\t\tvar element = this.element,\r\n\t\t\tcontext = this.context,\r\n\t\t\tpixelRatio = this.pixelRatio;\r\n\r\n\t\t// Resize the canvas, increasing its density based on the display's\r\n\t\t// pixel ratio; basically giving it more pixels without increasing the\r\n\t\t// size of its element, to take advantage of the fact that retina\r\n\t\t// displays have that many more pixels in the same advertised space.\r\n\r\n\t\t// Resizing should reset the state (excanvas seems to be buggy though)\r\n\r\n\t\tif (this.width != width) {\r\n\t\t\telement.width = width * pixelRatio;\r\n\t\t\telement.style.width = width + \"px\";\r\n\t\t\tthis.width = width;\r\n\t\t}\r\n\r\n\t\tif (this.height != height) {\r\n\t\t\telement.height = height * pixelRatio;\r\n\t\t\telement.style.height = height + \"px\";\r\n\t\t\tthis.height = height;\r\n\t\t}\r\n\r\n\t\t// Save the context, so we can reset in case we get replotted.  The\r\n\t\t// restore ensure that we're really back at the initial state, and\r\n\t\t// should be safe even if we haven't saved the initial state yet.\r\n\r\n\t\tcontext.restore();\r\n\t\tcontext.save();\r\n\r\n\t\t// Scale the coordinate space to match the display density; so even though we\r\n\t\t// may have twice as many pixels, we still want lines and other drawing to\r\n\t\t// appear at the same size; the extra pixels will just make them crisper.\r\n\r\n\t\tcontext.scale(pixelRatio, pixelRatio);\r\n\t};\r\n\r\n\t// Clears the entire canvas area, not including any overlaid HTML text\r\n\r\n\tCanvas.prototype.clear = function() {\r\n\t\tthis.context.clearRect(0, 0, this.width, this.height);\r\n\t};\r\n\r\n\t// Finishes rendering the canvas, including managing the text overlay.\r\n\r\n\tCanvas.prototype.render = function() {\r\n\r\n\t\tvar cache = this._textCache;\r\n\r\n\t\t// For each text layer, add elements marked as active that haven't\r\n\t\t// already been rendered, and remove those that are no longer active.\r\n\r\n\t\tfor (var layerKey in cache) {\r\n\t\t\tif (hasOwnProperty.call(cache, layerKey)) {\r\n\r\n\t\t\t\tvar layer = this.getTextLayer(layerKey),\r\n\t\t\t\t\tlayerCache = cache[layerKey];\r\n\r\n\t\t\t\tlayer.hide();\r\n\r\n\t\t\t\tfor (var styleKey in layerCache) {\r\n\t\t\t\t\tif (hasOwnProperty.call(layerCache, styleKey)) {\r\n\t\t\t\t\t\tvar styleCache = layerCache[styleKey];\r\n\t\t\t\t\t\tfor (var key in styleCache) {\r\n\t\t\t\t\t\t\tif (hasOwnProperty.call(styleCache, key)) {\r\n\r\n\t\t\t\t\t\t\t\tvar positions = styleCache[key].positions;\r\n\r\n\t\t\t\t\t\t\t\tfor (var i = 0, position; position = positions[i]; i++) {\r\n\t\t\t\t\t\t\t\t\tif (position.active) {\r\n\t\t\t\t\t\t\t\t\t\tif (!position.rendered) {\r\n\t\t\t\t\t\t\t\t\t\t\tlayer.append(position.element);\r\n\t\t\t\t\t\t\t\t\t\t\tposition.rendered = true;\r\n\t\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t\t\t\tpositions.splice(i--, 1);\r\n\t\t\t\t\t\t\t\t\t\tif (position.rendered) {\r\n\t\t\t\t\t\t\t\t\t\t\tposition.element.detach();\r\n\t\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t\t\tif (positions.length == 0) {\r\n\t\t\t\t\t\t\t\t\tdelete styleCache[key];\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\r\n\t\t\t\tlayer.show();\r\n\t\t\t}\r\n\t\t}\r\n\t};\r\n\r\n\t// Creates (if necessary) and returns the text overlay container.\r\n\t//\r\n\t// @param {string} classes String of space-separated CSS classes used to\r\n\t//     uniquely identify the text layer.\r\n\t// @return {object} The jQuery-wrapped text-layer div.\r\n\r\n\tCanvas.prototype.getTextLayer = function(classes) {\r\n\r\n\t\tvar layer = this.text[classes];\r\n\r\n\t\t// Create the text layer if it doesn't exist\r\n\r\n\t\tif (layer == null) {\r\n\r\n\t\t\t// Create the text layer container, if it doesn't exist\r\n\r\n\t\t\tif (this.textContainer == null) {\r\n\t\t\t\tthis.textContainer = $(\"<div class='flot-text flot-temp-elem'></div>\")\r\n\t\t\t\t\t.css({\r\n\t\t\t\t\t\tposition: \"absolute\",\r\n\t\t\t\t\t\ttop: 0,\r\n\t\t\t\t\t\tleft: 0,\r\n\t\t\t\t\t\tbottom: 0,\r\n\t\t\t\t\t\tright: 0,\r\n\t\t\t\t\t\t'font-size': \"smaller\",\r\n\t\t\t\t\t\tcolor: \"#545454\"\r\n\t\t\t\t\t})\r\n\t\t\t\t\t.insertAfter(this.element);\r\n\t\t\t}\r\n\r\n\t\t\tlayer = this.text[classes] = $(\"<div></div>\")\r\n\t\t\t\t.addClass(classes)\r\n\t\t\t\t.css({\r\n\t\t\t\t\tposition: \"absolute\",\r\n\t\t\t\t\ttop: 0,\r\n\t\t\t\t\tleft: 0,\r\n\t\t\t\t\tbottom: 0,\r\n\t\t\t\t\tright: 0\r\n\t\t\t\t})\r\n\t\t\t\t.appendTo(this.textContainer);\r\n\t\t}\r\n\r\n\t\treturn layer;\r\n\t};\r\n\r\n\t// Creates (if necessary) and returns a text info object.\r\n\t//\r\n\t// The object looks like this:\r\n\t//\r\n\t// {\r\n\t//     width: Width of the text's wrapper div.\r\n\t//     height: Height of the text's wrapper div.\r\n\t//     element: The jQuery-wrapped HTML div containing the text.\r\n\t//     positions: Array of positions at which this text is drawn.\r\n\t// }\r\n\t//\r\n\t// The positions array contains objects that look like this:\r\n\t//\r\n\t// {\r\n\t//     active: Flag indicating whether the text should be visible.\r\n\t//     rendered: Flag indicating whether the text is currently visible.\r\n\t//     element: The jQuery-wrapped HTML div containing the text.\r\n\t//     x: X coordinate at which to draw the text.\r\n\t//     y: Y coordinate at which to draw the text.\r\n\t// }\r\n\t//\r\n\t// Each position after the first receives a clone of the original element.\r\n\t//\r\n\t// The idea is that that the width, height, and general 'identity' of the\r\n\t// text is constant no matter where it is placed; the placements are a\r\n\t// secondary property.\r\n\t//\r\n\t// Canvas maintains a cache of recently-used text info objects; getTextInfo\r\n\t// either returns the cached element or creates a new entry.\r\n\t//\r\n\t// @param {string} layer A string of space-separated CSS classes uniquely\r\n\t//     identifying the layer containing this text.\r\n\t// @param {string} text Text string to retrieve info for.\r\n\t// @param {(string|object)=} font Either a string of space-separated CSS\r\n\t//     classes or a font-spec object, defining the text's font and style.\r\n\t// @param {number=} angle Angle at which to rotate the text, in degrees.\r\n\t//     Angle is currently unused, it will be implemented in the future.\r\n\t// @param {number=} width Maximum width of the text before it wraps.\r\n\t// @return {object} a text info object.\r\n\r\n\tCanvas.prototype.getTextInfo = function(layer, text, font, angle, width) {\r\n\r\n\t\tvar textStyle, layerCache, styleCache, info;\r\n\r\n\t\t// Cast the value to a string, in case we were given a number or such\r\n\r\n\t\ttext = \"\" + text;\r\n\r\n\t\t// If the font is a font-spec object, generate a CSS font definition\r\n\r\n\t\tif (typeof font === \"object\") {\r\n\t\t\ttextStyle = font.style + \" \" + font.variant + \" \" + font.weight + \" \" + font.size + \"px/\" + font.lineHeight + \"px \" + font.family;\r\n\t\t} else {\r\n\t\t\ttextStyle = font;\r\n\t\t}\r\n\r\n\t\t// Retrieve (or create) the cache for the text's layer and styles\r\n\r\n\t\tlayerCache = this._textCache[layer];\r\n\r\n\t\tif (layerCache == null) {\r\n\t\t\tlayerCache = this._textCache[layer] = {};\r\n\t\t}\r\n\r\n\t\tstyleCache = layerCache[textStyle];\r\n\r\n\t\tif (styleCache == null) {\r\n\t\t\tstyleCache = layerCache[textStyle] = {};\r\n\t\t}\r\n\r\n\t\tinfo = styleCache[text];\r\n\r\n\t\t// If we can't find a matching element in our cache, create a new one\r\n\r\n\t\tif (info == null) {\r\n\r\n\t\t\tvar element = $(\"<div></div>\").html(text)\r\n\t\t\t\t.css({\r\n\t\t\t\t\tposition: \"absolute\",\r\n\t\t\t\t\t'max-width': width,\r\n\t\t\t\t\ttop: -9999\r\n\t\t\t\t})\r\n\t\t\t\t.appendTo(this.getTextLayer(layer));\r\n\r\n\t\t\tif (typeof font === \"object\") {\r\n\t\t\t\telement.css({\r\n\t\t\t\t\tfont: textStyle,\r\n\t\t\t\t\tcolor: font.color\r\n\t\t\t\t});\r\n\t\t\t} else if (typeof font === \"string\") {\r\n\t\t\t\telement.addClass(font);\r\n\t\t\t}\r\n\r\n      info = styleCache[text] = { element: element, positions: [] };\r\n\r\n      var size = this._textSizeCache[text];\r\n\t\t\tif (size) {\r\n        info.width = size.width;\r\n        info.height = size.height;\r\n\t\t\t} else {\r\n        info.width = element.outerWidth(true);\r\n        info.height = element.outerHeight(true);\r\n        this._textSizeCache[text] = { width: info.width, height: info.height };\r\n\t\t\t}\r\n\t\t\telement.detach();\r\n\t\t}\r\n\r\n\t\treturn info;\r\n\t};\r\n\r\n\t// Adds a text string to the canvas text overlay.\r\n\t//\r\n\t// The text isn't drawn immediately; it is marked as rendering, which will\r\n\t// result in its addition to the canvas on the next render pass.\r\n\t//\r\n\t// @param {string} layer A string of space-separated CSS classes uniquely\r\n\t//     identifying the layer containing this text.\r\n\t// @param {number} x X coordinate at which to draw the text.\r\n\t// @param {number} y Y coordinate at which to draw the text.\r\n\t// @param {string} text Text string to draw.\r\n\t// @param {(string|object)=} font Either a string of space-separated CSS\r\n\t//     classes or a font-spec object, defining the text's font and style.\r\n\t// @param {number=} angle Angle at which to rotate the text, in degrees.\r\n\t//     Angle is currently unused, it will be implemented in the future.\r\n\t// @param {number=} width Maximum width of the text before it wraps.\r\n\t// @param {string=} halign Horizontal alignment of the text; either \"left\",\r\n\t//     \"center\" or \"right\".\r\n\t// @param {string=} valign Vertical alignment of the text; either \"top\",\r\n\t//     \"middle\" or \"bottom\".\r\n\r\n\tCanvas.prototype.addText = function(layer, x, y, text, font, angle, width, halign, valign) {\r\n\r\n\t\tvar info = this.getTextInfo(layer, text, font, angle, width),\r\n\t\t\tpositions = info.positions;\r\n\r\n\t\t// Tweak the div's position to match the text's alignment\r\n\r\n\t\tif (halign == \"center\") {\r\n\t\t\tx -= info.width / 2;\r\n\t\t} else if (halign == \"right\") {\r\n\t\t\tx -= info.width;\r\n\t\t}\r\n\r\n\t\tif (valign == \"middle\") {\r\n\t\t\ty -= info.height / 2;\r\n\t\t} else if (valign == \"bottom\") {\r\n\t\t\ty -= info.height;\r\n\t\t}\r\n\r\n\t\t// Determine whether this text already exists at this position.\r\n\t\t// If so, mark it for inclusion in the next render pass.\r\n\r\n\t\tfor (var i = 0, position; position = positions[i]; i++) {\r\n\t\t\tif (position.x == x && position.y == y) {\r\n\t\t\t\tposition.active = true;\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\t// If the text doesn't exist at this position, create a new entry\r\n\r\n\t\t// For the very first position we'll re-use the original element,\r\n\t\t// while for subsequent ones we'll clone it.\r\n\r\n\t\tposition = {\r\n\t\t\tactive: true,\r\n\t\t\trendered: false,\r\n\t\t\telement: positions.length ? info.element.clone() : info.element,\r\n\t\t\tx: x,\r\n\t\t\ty: y\r\n\t\t};\r\n\r\n\t\tpositions.push(position);\r\n\r\n\t\t// Move the element to its final position within the container\r\n\r\n\t\tposition.element.css({\r\n\t\t\ttop: Math.round(y),\r\n\t\t\tleft: Math.round(x),\r\n\t\t\t'text-align': halign\t// In case the text wraps\r\n\t\t});\r\n\t};\r\n\r\n\t// Removes one or more text strings from the canvas text overlay.\r\n\t//\r\n\t// If no parameters are given, all text within the layer is removed.\r\n\t//\r\n\t// Note that the text is not immediately removed; it is simply marked as\r\n\t// inactive, which will result in its removal on the next render pass.\r\n\t// This avoids the performance penalty for 'clear and redraw' behavior,\r\n\t// where we potentially get rid of all text on a layer, but will likely\r\n\t// add back most or all of it later, as when redrawing axes, for example.\r\n\t//\r\n\t// @param {string} layer A string of space-separated CSS classes uniquely\r\n\t//     identifying the layer containing this text.\r\n\t// @param {number=} x X coordinate of the text.\r\n\t// @param {number=} y Y coordinate of the text.\r\n\t// @param {string=} text Text string to remove.\r\n\t// @param {(string|object)=} font Either a string of space-separated CSS\r\n\t//     classes or a font-spec object, defining the text's font and style.\r\n\t// @param {number=} angle Angle at which the text is rotated, in degrees.\r\n\t//     Angle is currently unused, it will be implemented in the future.\r\n\r\n\tCanvas.prototype.removeText = function(layer, x, y, text, font, angle) {\r\n\t\tif (text == null) {\r\n\t\t\tvar layerCache = this._textCache[layer];\r\n\t\t\tif (layerCache != null) {\r\n\t\t\t\tfor (var styleKey in layerCache) {\r\n\t\t\t\t\tif (hasOwnProperty.call(layerCache, styleKey)) {\r\n\t\t\t\t\t\tvar styleCache = layerCache[styleKey];\r\n\t\t\t\t\t\tfor (var key in styleCache) {\r\n\t\t\t\t\t\t\tif (hasOwnProperty.call(styleCache, key)) {\r\n\t\t\t\t\t\t\t\tvar positions = styleCache[key].positions;\r\n\t\t\t\t\t\t\t\tfor (var i = 0, position; position = positions[i]; i++) {\r\n\t\t\t\t\t\t\t\t\tposition.active = false;\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t} else {\r\n\t\t\tvar positions = this.getTextInfo(layer, text, font, angle).positions;\r\n\t\t\tfor (var i = 0, position; position = positions[i]; i++) {\r\n\t\t\t\tif (position.x == x && position.y == y) {\r\n\t\t\t\t\tposition.active = false;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t};\r\n\r\n\t///////////////////////////////////////////////////////////////////////////\r\n\t// The top-level container for the entire plot.\r\n\r\n    function Plot(placeholder, data_, options_, plugins) {\r\n        // data is on the form:\r\n        //   [ series1, series2 ... ]\r\n        // where series is either just the data as [ [x1, y1], [x2, y2], ... ]\r\n        // or { data: [ [x1, y1], [x2, y2], ... ], label: \"some label\", ... }\r\n\r\n        var series = [],\r\n            options = {\r\n                // the color theme used for graphs\r\n                colors: [\"#edc240\", \"#afd8f8\", \"#cb4b4b\", \"#4da74d\", \"#9440ed\"],\r\n                legend: {\r\n                    show: true,\r\n                    noColumns: 1, // number of colums in legend table\r\n                    labelFormatter: null, // fn: string -> string\r\n                    labelBoxBorderColor: \"#ccc\", // border color for the little label boxes\r\n                    container: null, // container (as jQuery object) to put legend in, null means default on top of graph\r\n                    position: \"ne\", // position of default legend container within plot\r\n                    margin: 5, // distance from grid edge to default legend container within plot\r\n                    backgroundColor: null, // null means auto-detect\r\n                    backgroundOpacity: 0.85, // set to 0 to avoid background\r\n                    sorted: null    // default to no legend sorting\r\n                },\r\n                xaxis: {\r\n                    show: null, // null = auto-detect, true = always, false = never\r\n                    position: \"bottom\", // or \"top\"\r\n                    mode: null, // null or \"time\"\r\n                    font: null, // null (derived from CSS in placeholder) or object like { size: 11, lineHeight: 13, style: \"italic\", weight: \"bold\", family: \"sans-serif\", variant: \"small-caps\" }\r\n                    color: null, // base color, labels, ticks\r\n                    tickColor: null, // possibly different color of ticks, e.g. \"rgba(0,0,0,0.15)\"\r\n                    transform: null, // null or f: number -> number to transform axis\r\n                    inverseTransform: null, // if transform is set, this should be the inverse function\r\n                    min: null, // min. value to show, null means set automatically\r\n                    max: null, // max. value to show, null means set automatically\r\n                    autoscaleMargin: null, // margin in % to add if auto-setting min/max\r\n                    ticks: null, // either [1, 3] or [[1, \"a\"], 3] or (fn: axis info -> ticks) or app. number of ticks for auto-ticks\r\n                    tickFormatter: null, // fn: number -> string\r\n                    labelWidth: null, // size of tick labels in pixels\r\n                    labelHeight: null,\r\n                    reserveSpace: null, // whether to reserve space even if axis isn't shown\r\n                    tickLength: null, // size in pixels of ticks, or \"full\" for whole line\r\n                    alignTicksWithAxis: null, // axis number or null for no sync\r\n                    tickDecimals: null, // no. of decimals, null means auto\r\n                    tickSize: null, // number or [number, \"unit\"]\r\n                    minTickSize: null // number or [number, \"unit\"]\r\n                },\r\n                yaxis: {\r\n                    autoscaleMargin: 0.02,\r\n                    position: \"left\" // or \"right\"\r\n                },\r\n                xaxes: [],\r\n                yaxes: [],\r\n                series: {\r\n                    points: {\r\n                        show: false,\r\n                        radius: 3,\r\n                        lineWidth: 2, // in pixels\r\n                        fill: true,\r\n                        fillColor: \"#ffffff\",\r\n                        symbol: \"circle\" // or callback\r\n                    },\r\n                    lines: {\r\n                        // we don't put in show: false so we can see\r\n                        // whether lines were actively disabled\r\n                        lineWidth: 2, // in pixels\r\n                        fill: false,\r\n                        fillColor: null,\r\n                        steps: false\r\n                        // Omit 'zero', so we can later default its value to\r\n                        // match that of the 'fill' option.\r\n                    },\r\n                    bars: {\r\n                        show: false,\r\n                        lineWidth: 2, // in pixels\r\n                        barWidth: 1, // in units of the x axis\r\n                        fill: true,\r\n                        fillColor: null,\r\n                        align: \"left\", // \"left\", \"right\", or \"center\"\r\n                        horizontal: false,\r\n                        zero: true\r\n                    },\r\n                    shadowSize: 3,\r\n                    highlightColor: null\r\n                },\r\n                grid: {\r\n                    show: true,\r\n                    aboveData: false,\r\n                    color: \"#545454\", // primary color used for outline and labels\r\n                    backgroundColor: null, // null for transparent, else color\r\n                    borderColor: null, // set if different from the grid color\r\n                    tickColor: null, // color for the ticks, e.g. \"rgba(0,0,0,0.15)\"\r\n                    margin: 0, // distance from the canvas edge to the grid\r\n                    labelMargin: 5, // in pixels\r\n                    eventSectionHeight: 0, // space for event section\r\n                    axisMargin: 8, // in pixels\r\n                    borderWidth: 2, // in pixels\r\n                    minBorderMargin: null, // in pixels, null means taken from points radius\r\n                    markings: null, // array of ranges or fn: axes -> array of ranges\r\n                    markingsColor: \"#f4f4f4\",\r\n                    markingsLineWidth: 2,\r\n                    // interactive stuff\r\n                    clickable: false,\r\n                    hoverable: false,\r\n                    autoHighlight: true, // highlight in case mouse is near\r\n                    mouseActiveRadius: 10 // how far the mouse can be away to activate an item\r\n                },\r\n                interaction: {\r\n                    redrawOverlayInterval: 1000/60 // time between updates, -1 means in same flow\r\n                },\r\n                hooks: {}\r\n            },\r\n        surface = null,     // the canvas for the plot itself\r\n        overlay = null,     // canvas for interactive stuff on top of plot\r\n        eventHolder = null, // jQuery object that events should be bound to\r\n        ctx = null, octx = null,\r\n        xaxes = [], yaxes = [],\r\n        plotOffset = { left: 0, right: 0, top: 0, bottom: 0},\r\n        plotWidth = 0, plotHeight = 0,\r\n        hooks = {\r\n            processOptions: [],\r\n            processRawData: [],\r\n            processDatapoints: [],\r\n            processOffset: [],\r\n            processRange: [],\r\n            drawBackground: [],\r\n            drawSeries: [],\r\n            draw: [],\r\n            bindEvents: [],\r\n            drawOverlay: [],\r\n            shutdown: []\r\n        },\r\n        plot = this;\r\n\r\n        // public functions\r\n        plot.setData = setData;\r\n        plot.setupGrid = setupGrid;\r\n        plot.draw = draw;\r\n        plot.getPlaceholder = function() { return placeholder; };\r\n        plot.getCanvas = function() { return surface.element; };\r\n        plot.getPlotOffset = function() { return plotOffset; };\r\n        plot.width = function () { return plotWidth; };\r\n        plot.height = function () { return plotHeight; };\r\n        plot.offset = function () {\r\n            var o = eventHolder.offset();\r\n            o.left += plotOffset.left;\r\n            o.top += plotOffset.top;\r\n            return o;\r\n        };\r\n        plot.getData = function () { return series; };\r\n        plot.getAxes = function () {\r\n            var res = {}, i;\r\n            $.each(xaxes.concat(yaxes), function (_, axis) {\r\n                if (axis)\r\n                    res[axis.direction + (axis.n != 1 ? axis.n : \"\") + \"axis\"] = axis;\r\n            });\r\n            return res;\r\n        };\r\n        plot.getXAxes = function () { return xaxes; };\r\n        plot.getYAxes = function () { return yaxes; };\r\n        plot.c2p = canvasToAxisCoords;\r\n        plot.p2c = axisToCanvasCoords;\r\n        plot.getOptions = function () { return options; };\r\n        plot.highlight = highlight;\r\n        plot.unhighlight = unhighlight;\r\n        plot.triggerRedrawOverlay = triggerRedrawOverlay;\r\n        plot.pointOffset = function(point) {\r\n            return {\r\n                left: parseInt(xaxes[axisNumber(point, \"x\") - 1].p2c(+point.x) + plotOffset.left, 10),\r\n                top: parseInt(yaxes[axisNumber(point, \"y\") - 1].p2c(+point.y) + plotOffset.top, 10)\r\n            };\r\n        };\r\n        plot.shutdown = shutdown;\r\n        plot.destroy = function () {\r\n            shutdown();\r\n            placeholder.removeData(\"plot\").empty();\r\n\r\n            series = [];\r\n            options = null;\r\n            surface = null;\r\n            overlay = null;\r\n            eventHolder = null;\r\n            ctx = null;\r\n            octx = null;\r\n            xaxes = [];\r\n            yaxes = [];\r\n            hooks = null;\r\n            highlights = [];\r\n            plot = null;\r\n        };\r\n        plot.resize = function () {\r\n        \tvar width = placeholder.width(),\r\n        \t\theight = placeholder.height();\r\n            surface.resize(width, height);\r\n            overlay.resize(width, height);\r\n        };\r\n\r\n        // public attributes\r\n        plot.hooks = hooks;\r\n\r\n        // initialize\r\n        initPlugins(plot);\r\n        parseOptions(options_);\r\n        setupCanvases();\r\n        setData(data_);\r\n        setupGrid();\r\n        draw();\r\n        bindEvents();\r\n\r\n\r\n        function executeHooks(hook, args) {\r\n            args = [plot].concat(args);\r\n            for (var i = 0; i < hook.length; ++i)\r\n                hook[i].apply(this, args);\r\n        }\r\n\r\n        function initPlugins() {\r\n\r\n            // References to key classes, allowing plugins to modify them\r\n\r\n            var classes = {\r\n                Canvas: Canvas\r\n            };\r\n\r\n            for (var i = 0; i < plugins.length; ++i) {\r\n                var p = plugins[i];\r\n                p.init(plot, classes);\r\n                if (p.options)\r\n                    $.extend(true, options, p.options);\r\n            }\r\n        }\r\n\r\n        function parseOptions(opts) {\r\n\r\n            $.extend(true, options, opts);\r\n\r\n            // $.extend merges arrays, rather than replacing them.  When less\r\n            // colors are provided than the size of the default palette, we\r\n            // end up with those colors plus the remaining defaults, which is\r\n            // not expected behavior; avoid it by replacing them here.\r\n\r\n            if (opts && opts.colors) {\r\n            \toptions.colors = opts.colors;\r\n            }\r\n\r\n            if (options.xaxis.color == null)\r\n                options.xaxis.color = $.color.parse(options.grid.color).scale('a', 0.22).toString();\r\n            if (options.yaxis.color == null)\r\n                options.yaxis.color = $.color.parse(options.grid.color).scale('a', 0.22).toString();\r\n\r\n            if (options.xaxis.tickColor == null) // grid.tickColor for back-compatibility\r\n                options.xaxis.tickColor = options.grid.tickColor || options.xaxis.color;\r\n            if (options.yaxis.tickColor == null) // grid.tickColor for back-compatibility\r\n                options.yaxis.tickColor = options.grid.tickColor || options.yaxis.color;\r\n\r\n            if (options.grid.borderColor == null)\r\n                options.grid.borderColor = options.grid.color;\r\n            if (options.grid.tickColor == null)\r\n                options.grid.tickColor = $.color.parse(options.grid.color).scale('a', 0.22).toString();\r\n\r\n            // Fill in defaults for axis options, including any unspecified\r\n            // font-spec fields, if a font-spec was provided.\r\n\r\n            // If no x/y axis options were provided, create one of each anyway,\r\n            // since the rest of the code assumes that they exist.\r\n\r\n            var i, axisOptions, axisCount,\r\n                fontSize = placeholder.css(\"font-size\"),\r\n                fontSizeDefault = fontSize ? +fontSize.replace(\"px\", \"\") : 13,\r\n                fontDefaults = {\r\n                    style: placeholder.css(\"font-style\"),\r\n                    size: Math.round(0.8 * fontSizeDefault),\r\n                    variant: placeholder.css(\"font-variant\"),\r\n                    weight: placeholder.css(\"font-weight\"),\r\n                    family: placeholder.css(\"font-family\")\r\n                };\r\n\r\n            axisCount = options.xaxes.length || 1;\r\n            for (i = 0; i < axisCount; ++i) {\r\n\r\n                axisOptions = options.xaxes[i];\r\n                if (axisOptions && !axisOptions.tickColor) {\r\n                    axisOptions.tickColor = axisOptions.color;\r\n                }\r\n\r\n                axisOptions = $.extend(true, {}, options.xaxis, axisOptions);\r\n                options.xaxes[i] = axisOptions;\r\n\r\n                if (axisOptions.font) {\r\n                    axisOptions.font = $.extend({}, fontDefaults, axisOptions.font);\r\n                    if (!axisOptions.font.color) {\r\n                        axisOptions.font.color = axisOptions.color;\r\n                    }\r\n                    if (!axisOptions.font.lineHeight) {\r\n                        axisOptions.font.lineHeight = Math.round(axisOptions.font.size * 1.15);\r\n                    }\r\n                }\r\n            }\r\n\r\n            axisCount = options.yaxes.length || 1;\r\n            for (i = 0; i < axisCount; ++i) {\r\n\r\n                axisOptions = options.yaxes[i];\r\n                if (axisOptions && !axisOptions.tickColor) {\r\n                    axisOptions.tickColor = axisOptions.color;\r\n                }\r\n\r\n                axisOptions = $.extend(true, {}, options.yaxis, axisOptions);\r\n                options.yaxes[i] = axisOptions;\r\n\r\n                if (axisOptions.font) {\r\n                    axisOptions.font = $.extend({}, fontDefaults, axisOptions.font);\r\n                    if (!axisOptions.font.color) {\r\n                        axisOptions.font.color = axisOptions.color;\r\n                    }\r\n                    if (!axisOptions.font.lineHeight) {\r\n                        axisOptions.font.lineHeight = Math.round(axisOptions.font.size * 1.15);\r\n                    }\r\n                }\r\n            }\r\n\r\n            // backwards compatibility, to be removed in future\r\n            if (options.xaxis.noTicks && options.xaxis.ticks == null)\r\n                options.xaxis.ticks = options.xaxis.noTicks;\r\n            if (options.yaxis.noTicks && options.yaxis.ticks == null)\r\n                options.yaxis.ticks = options.yaxis.noTicks;\r\n            if (options.x2axis) {\r\n                options.xaxes[1] = $.extend(true, {}, options.xaxis, options.x2axis);\r\n                options.xaxes[1].position = \"top\";\r\n                // Override the inherit to allow the axis to auto-scale\r\n                if (options.x2axis.min == null) {\r\n                    options.xaxes[1].min = null;\r\n                }\r\n                if (options.x2axis.max == null) {\r\n                    options.xaxes[1].max = null;\r\n                }\r\n            }\r\n            if (options.y2axis) {\r\n                options.yaxes[1] = $.extend(true, {}, options.yaxis, options.y2axis);\r\n                options.yaxes[1].position = \"right\";\r\n                // Override the inherit to allow the axis to auto-scale\r\n                if (options.y2axis.min == null) {\r\n                    options.yaxes[1].min = null;\r\n                }\r\n                if (options.y2axis.max == null) {\r\n                    options.yaxes[1].max = null;\r\n                }\r\n            }\r\n            if (options.grid.coloredAreas)\r\n                options.grid.markings = options.grid.coloredAreas;\r\n            if (options.grid.coloredAreasColor)\r\n                options.grid.markingsColor = options.grid.coloredAreasColor;\r\n            if (options.lines)\r\n                $.extend(true, options.series.lines, options.lines);\r\n            if (options.points)\r\n                $.extend(true, options.series.points, options.points);\r\n            if (options.bars)\r\n                $.extend(true, options.series.bars, options.bars);\r\n            if (options.shadowSize != null)\r\n                options.series.shadowSize = options.shadowSize;\r\n            if (options.highlightColor != null)\r\n                options.series.highlightColor = options.highlightColor;\r\n\r\n            // save options on axes for future reference\r\n            for (i = 0; i < options.xaxes.length; ++i)\r\n                getOrCreateAxis(xaxes, i + 1).options = options.xaxes[i];\r\n            for (i = 0; i < options.yaxes.length; ++i)\r\n                getOrCreateAxis(yaxes, i + 1).options = options.yaxes[i];\r\n\r\n            // add hooks from options\r\n            for (var n in hooks)\r\n                if (options.hooks[n] && options.hooks[n].length)\r\n                    hooks[n] = hooks[n].concat(options.hooks[n]);\r\n\r\n            executeHooks(hooks.processOptions, [options]);\r\n        }\r\n\r\n        function setData(d) {\r\n            series = parseData(d);\r\n            fillInSeriesOptions();\r\n            processData();\r\n        }\r\n\r\n        function parseData(d) {\r\n            var res = [];\r\n            for (var i = 0; i < d.length; ++i) {\r\n                var s = $.extend(true, {}, options.series);\r\n\r\n                if (d[i].data != null) {\r\n                    s.data = d[i].data; // move the data instead of deep-copy\r\n                    delete d[i].data;\r\n\r\n                    $.extend(true, s, d[i]);\r\n\r\n                    d[i].data = s.data;\r\n                }\r\n                else\r\n                    s.data = d[i];\r\n                res.push(s);\r\n            }\r\n\r\n            return res;\r\n        }\r\n\r\n        function axisNumber(obj, coord) {\r\n            var a = obj[coord + \"axis\"];\r\n            if (typeof a == \"object\") // if we got a real axis, extract number\r\n                a = a.n;\r\n            if (typeof a != \"number\")\r\n                a = 1; // default to first axis\r\n            return a;\r\n        }\r\n\r\n        function allAxes() {\r\n            // return flat array without annoying null entries\r\n            return $.grep(xaxes.concat(yaxes), function (a) { return a; });\r\n        }\r\n\r\n        function canvasToAxisCoords(pos) {\r\n            // return an object with x/y corresponding to all used axes\r\n            var res = {}, i, axis;\r\n            for (i = 0; i < xaxes.length; ++i) {\r\n                axis = xaxes[i];\r\n                if (axis)\r\n                    res[\"x\" + axis.n] = axis.c2p(pos.left);\r\n            }\r\n\r\n            for (i = 0; i < yaxes.length; ++i) {\r\n                axis = yaxes[i];\r\n                if (axis)\r\n                    res[\"y\" + axis.n] = axis.c2p(pos.top);\r\n            }\r\n\r\n            if (res.x1 !== undefined)\r\n                res.x = res.x1;\r\n            if (res.y1 !== undefined)\r\n                res.y = res.y1;\r\n\r\n            return res;\r\n        }\r\n\r\n        function axisToCanvasCoords(pos) {\r\n            // get canvas coords from the first pair of x/y found in pos\r\n            var res = {}, i, axis, key;\r\n\r\n            for (i = 0; i < xaxes.length; ++i) {\r\n                axis = xaxes[i];\r\n                if (axis && axis.used) {\r\n                    key = \"x\" + axis.n;\r\n                    if (pos[key] == null && axis.n == 1)\r\n                        key = \"x\";\r\n\r\n                    if (pos[key] != null) {\r\n                        res.left = axis.p2c(pos[key]);\r\n                        break;\r\n                    }\r\n                }\r\n            }\r\n\r\n            for (i = 0; i < yaxes.length; ++i) {\r\n                axis = yaxes[i];\r\n                if (axis && axis.used) {\r\n                    key = \"y\" + axis.n;\r\n                    if (pos[key] == null && axis.n == 1)\r\n                        key = \"y\";\r\n\r\n                    if (pos[key] != null) {\r\n                        res.top = axis.p2c(pos[key]);\r\n                        break;\r\n                    }\r\n                }\r\n            }\r\n\r\n            return res;\r\n        }\r\n\r\n        function getOrCreateAxis(axes, number) {\r\n            if (!axes[number - 1])\r\n                axes[number - 1] = {\r\n                    n: number, // save the number for future reference\r\n                    direction: axes == xaxes ? \"x\" : \"y\",\r\n                    options: $.extend(true, {}, axes == xaxes ? options.xaxis : options.yaxis)\r\n                };\r\n\r\n            return axes[number - 1];\r\n        }\r\n\r\n        function fillInSeriesOptions() {\r\n\r\n            var neededColors = series.length, maxIndex = -1, i;\r\n\r\n            // Subtract the number of series that already have fixed colors or\r\n            // color indexes from the number that we still need to generate.\r\n\r\n            for (i = 0; i < series.length; ++i) {\r\n                var sc = series[i].color;\r\n                if (sc != null) {\r\n                    neededColors--;\r\n                    if (typeof sc == \"number\" && sc > maxIndex) {\r\n                        maxIndex = sc;\r\n                    }\r\n                }\r\n            }\r\n\r\n            // If any of the series have fixed color indexes, then we need to\r\n            // generate at least as many colors as the highest index.\r\n\r\n            if (neededColors <= maxIndex) {\r\n                neededColors = maxIndex + 1;\r\n            }\r\n\r\n            // Generate all the colors, using first the option colors and then\r\n            // variations on those colors once they're exhausted.\r\n\r\n            var c, colors = [], colorPool = options.colors,\r\n                colorPoolSize = colorPool.length, variation = 0;\r\n\r\n            for (i = 0; i < neededColors; i++) {\r\n\r\n                c = $.color.parse(colorPool[i % colorPoolSize] || \"#666\");\r\n\r\n                // Each time we exhaust the colors in the pool we adjust\r\n                // a scaling factor used to produce more variations on\r\n                // those colors. The factor alternates negative/positive\r\n                // to produce lighter/darker colors.\r\n\r\n                // Reset the variation after every few cycles, or else\r\n                // it will end up producing only white or black colors.\r\n\r\n                if (i % colorPoolSize == 0 && i) {\r\n                    if (variation >= 0) {\r\n                        if (variation < 0.5) {\r\n                            variation = -variation - 0.2;\r\n                        } else variation = 0;\r\n                    } else variation = -variation;\r\n                }\r\n\r\n                colors[i] = c.scale('rgb', 1 + variation);\r\n            }\r\n\r\n            // Finalize the series options, filling in their colors\r\n\r\n            var colori = 0, s;\r\n            for (i = 0; i < series.length; ++i) {\r\n                s = series[i];\r\n\r\n                // assign colors\r\n                if (s.color == null) {\r\n                    s.color = colors[colori].toString();\r\n                    ++colori;\r\n                }\r\n                else if (typeof s.color == \"number\")\r\n                    s.color = colors[s.color].toString();\r\n\r\n                // turn on lines automatically in case nothing is set\r\n                if (s.lines.show == null) {\r\n                    var v, show = true;\r\n                    for (v in s)\r\n                        if (s[v] && s[v].show) {\r\n                            show = false;\r\n                            break;\r\n                        }\r\n                    if (show)\r\n                        s.lines.show = true;\r\n                }\r\n\r\n                // If nothing was provided for lines.zero, default it to match\r\n                // lines.fill, since areas by default should extend to zero.\r\n\r\n                if (s.lines.zero == null) {\r\n                    s.lines.zero = !!s.lines.fill;\r\n                }\r\n\r\n                // setup axes\r\n                s.xaxis = getOrCreateAxis(xaxes, axisNumber(s, \"x\"));\r\n                s.yaxis = getOrCreateAxis(yaxes, axisNumber(s, \"y\"));\r\n            }\r\n        }\r\n\r\n        function processData() {\r\n            var topSentry = Number.POSITIVE_INFINITY,\r\n                bottomSentry = Number.NEGATIVE_INFINITY,\r\n                fakeInfinity = Number.MAX_VALUE,\r\n                i, j, k, m, length,\r\n                s, points, ps, x, y, axis, val, f, p,\r\n                data, format;\r\n\r\n            function updateAxis(axis, min, max) {\r\n                if (min < axis.datamin && min != -fakeInfinity)\r\n                    axis.datamin = min;\r\n                if (max > axis.datamax && max != fakeInfinity)\r\n                    axis.datamax = max;\r\n            }\r\n\r\n            $.each(allAxes(), function (_, axis) {\r\n                // init axis\r\n                axis.datamin = topSentry;\r\n                axis.datamax = bottomSentry;\r\n                axis.used = false;\r\n            });\r\n\r\n            for (i = 0; i < series.length; ++i) {\r\n                s = series[i];\r\n                s.datapoints = { points: [] };\r\n\r\n                executeHooks(hooks.processRawData, [ s, s.data, s.datapoints ]);\r\n            }\r\n\r\n            // first pass: clean and copy data\r\n            for (i = 0; i < series.length; ++i) {\r\n                s = series[i];\r\n\r\n                data = s.data;\r\n                format = s.datapoints.format;\r\n\r\n                if (!format) {\r\n                    format = [];\r\n                    // find out how to copy\r\n                    format.push({ x: true, number: true, required: true });\r\n                    format.push({ y: true, number: true, required: true });\r\n\r\n                    if (s.stack || s.bars.show || (s.lines.show && s.lines.fill)) {\r\n                        var autoscale = !!((s.bars.show && s.bars.zero) || (s.lines.show && s.lines.zero));\r\n                        format.push({ y: true, number: true, required: false, defaultValue: 0, autoscale: autoscale });\r\n                        if (s.bars.horizontal) {\r\n                            delete format[format.length - 1].y;\r\n                            format[format.length - 1].x = true;\r\n                        }\r\n                    }\r\n\r\n                    s.datapoints.format = format;\r\n                }\r\n\r\n                if (s.datapoints.pointsize != null)\r\n                    continue; // already filled in\r\n\r\n                s.datapoints.pointsize = format.length;\r\n\r\n                ps = s.datapoints.pointsize;\r\n                points = s.datapoints.points;\r\n\r\n                var insertSteps = s.lines.show && s.lines.steps;\r\n                s.xaxis.used = s.yaxis.used = true;\r\n\r\n                for (j = k = 0; j < data.length; ++j, k += ps) {\r\n                    p = data[j];\r\n\r\n                    var nullify = p == null;\r\n                    if (!nullify) {\r\n                        for (m = 0; m < ps; ++m) {\r\n                            val = p[m];\r\n                            f = format[m];\r\n\r\n                            if (f) {\r\n                                if (f.number && val != null) {\r\n                                    val = +val; // convert to number\r\n                                    if (isNaN(val))\r\n                                        val = null;\r\n                                    else if (val == Infinity)\r\n                                        val = fakeInfinity;\r\n                                    else if (val == -Infinity)\r\n                                        val = -fakeInfinity;\r\n                                }\r\n\r\n                                if (val == null) {\r\n                                    if (f.required)\r\n                                        nullify = true;\r\n\r\n                                    if (f.defaultValue != null)\r\n                                        val = f.defaultValue;\r\n                                }\r\n                            }\r\n\r\n                            points[k + m] = val;\r\n                        }\r\n                    }\r\n\r\n                    if (nullify) {\r\n                        for (m = 0; m < ps; ++m) {\r\n                            val = points[k + m];\r\n                            if (val != null) {\r\n                                f = format[m];\r\n                                // extract min/max info\r\n                                if (f.autoscale !== false) {\r\n                                    if (f.x) {\r\n                                        updateAxis(s.xaxis, val, val);\r\n                                    }\r\n                                    if (f.y) {\r\n                                        updateAxis(s.yaxis, val, val);\r\n                                    }\r\n                                }\r\n                            }\r\n                            points[k + m] = null;\r\n                        }\r\n                    }\r\n\r\n                    if (insertSteps && k > 0 && (!nullify || points[k - ps] != null)) {\r\n                        // copy the point to make room for a middle point\r\n                        for (m = 0; m < ps; ++m)\r\n                            points[k + ps + m] = points[k + m];\r\n\r\n                        // middle point has same y\r\n                        points[k + 1] = points[k - ps + 1] || 0;\r\n\r\n                        // if series has null values, let's give the last !null value a nice step\r\n                        if(nullify)\r\n                        \tpoints[k] = p[0];\r\n\r\n                        // we've added a point, better reflect that\r\n                        k += ps;\r\n                    }\r\n                }\r\n            }\r\n\r\n            // give the hooks a chance to run\r\n            for (i = 0; i < series.length; ++i) {\r\n                s = series[i];\r\n                points = s.datapoints.points;\r\n                ps = s.datapoints.pointsize;\r\n\r\n                // grafana\r\n                if (s.transform === 'negative-Y') {\r\n                  for (j = 0; j < points.length; j += ps) {\r\n                    if (points[j] == null)\r\n                        continue;\r\n\r\n                      val = points[j + 1];\r\n                      points[j + 1] = -val;\r\n                  }\r\n                }\r\n\r\n                executeHooks(hooks.processDatapoints, [ s, s.datapoints]);\r\n            }\r\n\r\n            // second pass: find datamax/datamin for auto-scaling\r\n            for (i = 0; i < series.length; ++i) {\r\n                s = series[i];\r\n                points = s.datapoints.points;\r\n                ps = s.datapoints.pointsize;\r\n                format = s.datapoints.format;\r\n\r\n                var xmin = topSentry, ymin = topSentry,\r\n                    xmax = bottomSentry, ymax = bottomSentry;\r\n\r\n                for (j = 0; j < points.length; j += ps) {\r\n                    if (points[j] == null)\r\n                        continue;\r\n\r\n                    for (m = 0; m < ps; ++m) {\r\n                        val = points[j + m];\r\n                        f = format[m];\r\n                        if (!f || f.autoscale === false || val == fakeInfinity || val == -fakeInfinity)\r\n                            continue;\r\n\r\n                        if (f.x) {\r\n                            if (val < xmin)\r\n                                xmin = val;\r\n                            if (val > xmax)\r\n                                xmax = val;\r\n                        }\r\n                        if (f.y) {\r\n                            if (val < ymin)\r\n                                ymin = val;\r\n                            if (val > ymax)\r\n                                ymax = val;\r\n                        }\r\n                    }\r\n                }\r\n\r\n                if (s.bars.show) {\r\n                    // make sure we got room for the bar on the dancing floor\r\n                    var delta;\r\n\r\n                    switch (s.bars.align) {\r\n                        case \"left\":\r\n                            delta = 0;\r\n                            break;\r\n                        case \"right\":\r\n                            delta = -s.bars.barWidth;\r\n                            break;\r\n                        default:\r\n                            delta = -s.bars.barWidth / 2;\r\n                    }\r\n\r\n                    if (s.bars.horizontal) {\r\n                        ymin += delta;\r\n                        ymax += delta + s.bars.barWidth;\r\n                    }\r\n                    else {\r\n                        xmin += delta;\r\n                        xmax += delta + s.bars.barWidth;\r\n                    }\r\n                }\r\n\r\n                updateAxis(s.xaxis, xmin, xmax);\r\n                updateAxis(s.yaxis, ymin, ymax);\r\n            }\r\n\r\n            $.each(allAxes(), function (_, axis) {\r\n                if (axis.datamin == topSentry)\r\n                    axis.datamin = null;\r\n                if (axis.datamax == bottomSentry)\r\n                    axis.datamax = null;\r\n            });\r\n        }\r\n\r\n        function setupCanvases() {\r\n            // Make sure the placeholder is clear of everything except canvases\r\n            // from a previous plot in this container that we'll try to re-use.\r\n\r\n            placeholder.find(\".flot-temp-elem\").remove();\r\n\r\n            if (placeholder.css(\"position\") == 'static')\r\n                placeholder.css(\"position\", \"relative\"); // for positioning labels and overlay\r\n\r\n            surface = new Canvas(\"flot-base\", placeholder);\r\n            overlay = new Canvas(\"flot-overlay\", placeholder); // overlay canvas for interactive features\r\n\r\n            ctx = surface.context;\r\n            octx = overlay.context;\r\n\r\n            // define which element we're listening for events on\r\n            eventHolder = $(overlay.element).unbind();\r\n\r\n            // If we're re-using a plot object, shut down the old one\r\n\r\n            var existing = placeholder.data(\"plot\");\r\n\r\n            if (existing) {\r\n                existing.shutdown();\r\n                overlay.clear();\r\n            }\r\n\r\n            // save in case we get replotted\r\n            placeholder.data(\"plot\", plot);\r\n        }\r\n\r\n        function bindEvents() {\r\n            // bind events\r\n            if (options.grid.hoverable) {\r\n                eventHolder.mousemove(onMouseMove);\r\n\r\n                // Use bind, rather than .mouseleave, because we officially\r\n                // still support jQuery 1.2.6, which doesn't define a shortcut\r\n                // for mouseenter or mouseleave.  This was a bug/oversight that\r\n                // was fixed somewhere around 1.3.x.  We can return to using\r\n                // .mouseleave when we drop support for 1.2.6.\r\n\r\n                eventHolder.bind(\"mouseleave\", onMouseLeave);\r\n                $(document).bind(\"touchend\", onTouch);\r\n            }\r\n\r\n            if (options.grid.clickable)\r\n                eventHolder.click(onClick);\r\n\r\n            executeHooks(hooks.bindEvents, [eventHolder]);\r\n        }\r\n\r\n        function shutdown() {\r\n            if (redrawTimeout)\r\n                clearTimeout(redrawTimeout);\r\n\r\n            eventHolder.unbind(\"mousemove\", onMouseMove);\r\n            eventHolder.unbind(\"mouseleave\", onMouseLeave);\r\n            eventHolder.unbind(\"click\", onClick);\r\n            $(document).unbind(\"touchend\", onTouch);\r\n\r\n            executeHooks(hooks.shutdown, [eventHolder]);\r\n        }\r\n\r\n        function setTransformationHelpers(axis) {\r\n            // set helper functions on the axis, assumes plot area\r\n            // has been computed already\r\n\r\n            function identity(x) { return x; }\r\n\r\n            var s, m, t = axis.options.transform || identity,\r\n                it = axis.options.inverseTransform;\r\n\r\n            // precompute how much the axis is scaling a point\r\n            // in canvas space\r\n            if (axis.direction == \"x\") {\r\n                s = axis.scale = plotWidth / Math.abs(t(axis.max) - t(axis.min));\r\n                m = Math.min(t(axis.max), t(axis.min));\r\n            }\r\n            else {\r\n                s = axis.scale = plotHeight / Math.abs(t(axis.max) - t(axis.min));\r\n                s = -s;\r\n                m = Math.max(t(axis.max), t(axis.min));\r\n            }\r\n\r\n            // data point to canvas coordinate\r\n            if (t == identity) // slight optimization\r\n                axis.p2c = function (p) { return (p - m) * s; };\r\n            else\r\n                axis.p2c = function (p) { return (t(p) - m) * s; };\r\n            // canvas coordinate to data point\r\n            if (!it)\r\n                axis.c2p = function (c) { return m + c / s; };\r\n            else\r\n                axis.c2p = function (c) { return it(m + c / s); };\r\n        }\r\n\r\n        function measureTickLabels(axis) {\r\n\r\n            var opts = axis.options,\r\n                ticks = axis.ticks || [],\r\n                labelWidth = opts.labelWidth || 0,\r\n                labelHeight = opts.labelHeight || 0,\r\n                maxWidth = labelWidth || (axis.direction == \"x\" ? Math.floor(surface.width / (ticks.length || 1)) : null),\r\n                legacyStyles = axis.direction + \"Axis \" + axis.direction + axis.n + \"Axis\",\r\n                layer = \"flot-\" + axis.direction + \"-axis flot-\" + axis.direction + axis.n + \"-axis \" + legacyStyles,\r\n                font = opts.font || \"flot-tick-label tickLabel\";\r\n\r\n            for (var i = 0; i < ticks.length; ++i) {\r\n\r\n                var t = ticks[i];\r\n\r\n                if (!t.label)\r\n                    continue;\r\n\r\n                var info = surface.getTextInfo(layer, t.label, font, null, maxWidth);\r\n\r\n                /// Grafana fix, add +1 to label width\r\n                labelWidth = Math.max(labelWidth, info.width + 1);\r\n                labelHeight = Math.max(labelHeight, info.height);\r\n            }\r\n\r\n            axis.labelWidth = opts.labelWidth || labelWidth;\r\n            axis.labelHeight = opts.labelHeight || labelHeight;\r\n        }\r\n\r\n        function allocateAxisBoxFirstPhase(axis) {\r\n            // find the bounding box of the axis by looking at label\r\n            // widths/heights and ticks, make room by diminishing the\r\n            // plotOffset; this first phase only looks at one\r\n            // dimension per axis, the other dimension depends on the\r\n            // other axes so will have to wait\r\n\r\n            var lw = axis.labelWidth,\r\n                lh = axis.labelHeight,\r\n                pos = axis.options.position,\r\n                isXAxis = axis.direction === \"x\",\r\n                tickLength = axis.options.tickLength,\r\n                axisMargin = options.grid.axisMargin,\r\n                padding = options.grid.labelMargin,\r\n                eventSectionPadding = options.grid.eventSectionHeight,\r\n                innermost = true,\r\n                outermost = true,\r\n                first = true,\r\n                found = false;\r\n\r\n            // Determine the axis's position in its direction and on its side\r\n\r\n            $.each(isXAxis ? xaxes : yaxes, function(i, a) {\r\n                if (a && (a.show || a.reserveSpace)) {\r\n                    if (a === axis) {\r\n                        found = true;\r\n                    } else if (a.options.position === pos) {\r\n                        if (found) {\r\n                            outermost = false;\r\n                        } else {\r\n                            innermost = false;\r\n                        }\r\n                    }\r\n                    if (!found) {\r\n                        first = false;\r\n                    }\r\n                }\r\n            });\r\n\r\n            // The outermost axis on each side has no margin\r\n\r\n            if (outermost) {\r\n                axisMargin = 0;\r\n            }\r\n\r\n            // The ticks for the first axis in each direction stretch across\r\n\r\n            if (tickLength == null) {\r\n                tickLength = first ? \"full\" : 5;\r\n            }\r\n\r\n            if (!isNaN(+tickLength))\r\n                padding += +tickLength;\r\n\r\n            if (isXAxis) {\r\n                // Add space for event section\r\n                lh += padding;\r\n                lh += eventSectionPadding;\r\n\r\n                if (pos == \"bottom\") {\r\n                    plotOffset.bottom += lh + axisMargin;\r\n                    axis.box = { top: surface.height - plotOffset.bottom, height: lh };\r\n                }\r\n                else {\r\n                    axis.box = { top: plotOffset.top + axisMargin, height: lh };\r\n                    plotOffset.top += lh + axisMargin;\r\n                }\r\n            }\r\n            else {\r\n                lw += padding;\r\n\r\n                if (pos == \"left\") {\r\n                    axis.box = { left: plotOffset.left + axisMargin, width: lw };\r\n                    plotOffset.left += lw + axisMargin;\r\n                }\r\n                else {\r\n                    plotOffset.right += lw + axisMargin;\r\n                    axis.box = { left: surface.width - plotOffset.right, width: lw };\r\n                }\r\n            }\r\n\r\n             // save for future reference\r\n            axis.position = pos;\r\n            axis.tickLength = tickLength;\r\n            axis.box.padding = padding;\r\n            axis.box.eventSectionPadding = eventSectionPadding;\r\n            axis.innermost = innermost;\r\n        }\r\n\r\n        function allocateAxisBoxSecondPhase(axis) {\r\n            // now that all axis boxes have been placed in one\r\n            // dimension, we can set the remaining dimension coordinates\r\n            if (axis.direction == \"x\") {\r\n                axis.box.left = plotOffset.left - axis.labelWidth / 2;\r\n                axis.box.width = surface.width - plotOffset.left - plotOffset.right + axis.labelWidth;\r\n            }\r\n            else {\r\n                axis.box.top = plotOffset.top - axis.labelHeight / 2;\r\n                axis.box.height = surface.height - plotOffset.bottom - plotOffset.top + axis.labelHeight;\r\n            }\r\n        }\r\n\r\n        function adjustLayoutForThingsStickingOut() {\r\n            // possibly adjust plot offset to ensure everything stays\r\n            // inside the canvas and isn't clipped off\r\n\r\n            var minMargin = options.grid.minBorderMargin,\r\n                axis, i;\r\n\r\n            // check stuff from the plot (FIXME: this should just read\r\n            // a value from the series, otherwise it's impossible to\r\n            // customize)\r\n            if (minMargin == null) {\r\n                minMargin = 0;\r\n                for (i = 0; i < series.length; ++i)\r\n                    minMargin = Math.max(minMargin, 2 * (series[i].points.radius + series[i].points.lineWidth/2));\r\n            }\r\n\r\n            var margins = {\r\n                left: minMargin,\r\n                right: minMargin,\r\n                top: minMargin,\r\n                bottom: minMargin\r\n            };\r\n\r\n            // check axis labels, note we don't check the actual\r\n            // labels but instead use the overall width/height to not\r\n            // jump as much around with replots\r\n            $.each(allAxes(), function (_, axis) {\r\n                if (axis.reserveSpace && axis.ticks && axis.ticks.length) {\r\n                    if (axis.direction === \"x\") {\r\n                        margins.left = Math.max(margins.left, axis.labelWidth / 2);\r\n                        margins.right = Math.max(margins.right, axis.labelWidth / 2);\r\n                    } else {\r\n                        margins.bottom = Math.max(margins.bottom, axis.labelHeight / 2);\r\n                        margins.top = Math.max(margins.top, axis.labelHeight / 2);\r\n                    }\r\n                }\r\n            });\r\n\r\n            plotOffset.left = Math.ceil(Math.max(margins.left, plotOffset.left));\r\n            plotOffset.right = Math.ceil(Math.max(margins.right, plotOffset.right));\r\n            plotOffset.top = Math.ceil(Math.max(margins.top, plotOffset.top));\r\n            plotOffset.bottom = Math.ceil(Math.max(margins.bottom, plotOffset.bottom));\r\n        }\r\n\r\n        function setupGrid() {\r\n            var i, axes = allAxes(), showGrid = options.grid.show;\r\n\r\n            // Initialize the plot's offset from the edge of the canvas\r\n\r\n            for (var a in plotOffset) {\r\n                var margin = options.grid.margin || 0;\r\n                plotOffset[a] = typeof margin == \"number\" ? margin : margin[a] || 0;\r\n            }\r\n\r\n            executeHooks(hooks.processOffset, [plotOffset]);\r\n\r\n            // If the grid is visible, add its border width to the offset\r\n\r\n            for (var a in plotOffset) {\r\n                if(typeof(options.grid.borderWidth) == \"object\") {\r\n                    plotOffset[a] += showGrid ? options.grid.borderWidth[a] : 0;\r\n                }\r\n                else {\r\n                    plotOffset[a] += showGrid ? options.grid.borderWidth : 0;\r\n                }\r\n            }\r\n\r\n            $.each(axes, function (_, axis) {\r\n                var axisOpts = axis.options;\r\n                axis.show = axisOpts.show == null ? axis.used : axisOpts.show;\r\n                axis.reserveSpace = axisOpts.reserveSpace == null ? axis.show : axisOpts.reserveSpace;\r\n                setRange(axis);\r\n            });\r\n\r\n            executeHooks(hooks.processRange, []);\r\n\r\n            if (showGrid) {\r\n\r\n                var allocatedAxes = $.grep(axes, function (axis) {\r\n                    return axis.show || axis.reserveSpace;\r\n                });\r\n\r\n                var snaped = false;\r\n                for (var i = 0; i < 2; i++) {\r\n                    $.each(allocatedAxes, function (_, axis) {\r\n                        // make the ticks\r\n                        setupTickGeneration(axis);\r\n                        setTicks(axis);\r\n                        snaped = snapRangeToTicks(axis, axis.ticks) || snaped;\r\n                        // find labelWidth/Height for axis\r\n                        measureTickLabels(axis);\r\n                    });\r\n\r\n                    if (snaped && hooks.processRange.length > 0) {\r\n                        executeHooks(hooks.processRange, []);\r\n                        snaped = false;\r\n                    } else {\r\n                        break;\r\n                    }\r\n                }\r\n\r\n                // with all dimensions calculated, we can compute the\r\n                // axis bounding boxes, start from the outside\r\n                // (reverse order)\r\n                for (i = allocatedAxes.length - 1; i >= 0; --i)\r\n                    allocateAxisBoxFirstPhase(allocatedAxes[i]);\r\n\r\n                // make sure we've got enough space for things that\r\n                // might stick out\r\n                adjustLayoutForThingsStickingOut();\r\n\r\n                $.each(allocatedAxes, function (_, axis) {\r\n                    allocateAxisBoxSecondPhase(axis);\r\n                });\r\n            }\r\n\r\n\r\n            plotWidth = surface.width - plotOffset.left - plotOffset.right;\r\n            plotHeight = surface.height - plotOffset.bottom - plotOffset.top;\r\n\r\n            // now we got the proper plot dimensions, we can compute the scaling\r\n            $.each(axes, function (_, axis) {\r\n                setTransformationHelpers(axis);\r\n            });\r\n\r\n            if (showGrid) {\r\n                drawAxisLabels();\r\n            }\r\n\r\n            insertLegend();\r\n        }\r\n\r\n        function setRange(axis) {\r\n            var opts = axis.options,\r\n                min = +(opts.min != null ? opts.min : axis.datamin),\r\n                max = +(opts.max != null ? opts.max : axis.datamax),\r\n                delta = max - min;\r\n\r\n            if (delta == 0.0) {\r\n                // Grafana fix: wide Y min and max using increased wideFactor\r\n                // when all series values are the same\r\n                var wideFactor = 0.25;\r\n                var widen = Math.abs(max == 0 ? 1 : max * wideFactor);\r\n\r\n                if (opts.min == null) {\r\n                  min -= widen;\r\n                }\r\n                // always widen max if we couldn't widen min to ensure we\r\n                // don't fall into min == max which doesn't work\r\n                if (opts.max == null || opts.min != null) {\r\n                  max += widen;\r\n                }\r\n            }\r\n            else {\r\n                // consider autoscaling\r\n                var margin = opts.autoscaleMargin;\r\n                if (margin != null) {\r\n                    if (opts.min == null) {\r\n                        min -= delta * margin;\r\n                        // make sure we don't go below zero if all values\r\n                        // are positive\r\n                        if (min < 0 && axis.datamin != null && axis.datamin >= 0)\r\n                            min = 0;\r\n                    }\r\n                    if (opts.max == null) {\r\n                        max += delta * margin;\r\n                        if (max > 0 && axis.datamax != null && axis.datamax <= 0)\r\n                            max = 0;\r\n                    }\r\n                }\r\n            }\r\n            axis.min = min;\r\n            axis.max = max;\r\n        }\r\n\r\n        // grafana change\r\n        function getSignificantDigitCount(n) {\r\n          //remove decimal and make positive\r\n          n = Math.abs(String(n).replace(\".\", \"\"));\r\n          if (n == 0) {\r\n            return 0;\r\n          }\r\n\r\n          // kill the 0s at the end of n\r\n          while (n != 0 && n % 10 == 0) {\r\n            n /= 10;\r\n          }\r\n\r\n          // get number of digits\r\n          return Math.floor(Math.log(n) / Math.LN10) + 1;\r\n        }\r\n\r\n        function setupTickGeneration(axis) {\r\n            var opts = axis.options;\r\n\r\n            // estimate number of ticks\r\n            var noTicks;\r\n            if (typeof opts.ticks == \"number\" && opts.ticks > 0)\r\n                noTicks = opts.ticks;\r\n            else\r\n                // heuristic based on the model a*sqrt(x) fitted to\r\n                // some data points that seemed reasonable\r\n                noTicks = 0.3 * Math.sqrt(axis.direction == \"x\" ? surface.width : surface.height);\r\n\r\n            var delta = (axis.max - axis.min) / noTicks,\r\n                dec = -Math.floor(Math.log(delta) / Math.LN10),\r\n                maxDec = opts.tickDecimals;\r\n\r\n            if (maxDec != null && dec > maxDec) {\r\n                dec = maxDec;\r\n            }\r\n\r\n            var magn = Math.pow(10, -dec),\r\n                norm = delta / magn, // norm is between 1.0 and 10.0\r\n                size;\r\n\r\n            if (norm < 1.5) {\r\n                size = 1;\r\n            } else if (norm < 3) {\r\n                size = 2;\r\n                // special case for 2.5, requires an extra decimal\r\n                if (norm > 2.25 && (maxDec == null || dec + 1 <= maxDec)) {\r\n                    size = 2.5;\r\n                    ++dec;\r\n                }\r\n            } else if (norm < 7.5) {\r\n                size = 5;\r\n            } else {\r\n                size = 10;\r\n            }\r\n\r\n            size *= magn;\r\n\r\n            if (opts.minTickSize != null && size < opts.minTickSize) {\r\n                size = opts.minTickSize;\r\n            }\r\n\r\n            axis.delta = delta;\r\n            axis.tickDecimals = Math.max(0, maxDec != null ? maxDec : dec);\r\n            axis.tickSize = opts.tickSize || size;\r\n\r\n            // grafana addition\r\n            if (opts.tickDecimals === null || opts.tickDecimals === undefined) {\r\n              axis.scaledDecimals = axis.tickDecimals + dec;\r\n            }\r\n\r\n            // Time mode was moved to a plug-in in 0.8, and since so many people use it\r\n            // we'll add an especially friendly reminder to make sure they included it.\r\n\r\n            if (opts.mode == \"time\" && !axis.tickGenerator) {\r\n                throw new Error(\"Time mode requires the flot.time plugin.\");\r\n            }\r\n\r\n            // Flot supports base-10 axes; any other mode else is handled by a plug-in,\r\n            // like flot.time.js.\r\n\r\n            if (!axis.tickGenerator) {\r\n\r\n                axis.tickGenerator = function (axis) {\r\n\r\n                    var ticks = [],\r\n                        start = floorInBase(axis.min, axis.tickSize),\r\n                        i = 0,\r\n                        v = Number.NaN,\r\n                        prev;\r\n\r\n                    do {\r\n                        prev = v;\r\n                        v = start + i * axis.tickSize;\r\n                        ticks.push(v);\r\n                        ++i;\r\n                    } while (v < axis.max && v != prev);\r\n                    return ticks;\r\n                };\r\n\r\n\t\t\t\taxis.tickFormatter = function (value, axis) {\r\n\r\n\t\t\t\t\tvar factor = axis.tickDecimals ? Math.pow(10, axis.tickDecimals) : 1;\r\n\t\t\t\t\tvar formatted = \"\" + Math.round(value * factor) / factor;\r\n\r\n\t\t\t\t\t// If tickDecimals was specified, ensure that we have exactly that\r\n\t\t\t\t\t// much precision; otherwise default to the value's own precision.\r\n\r\n\t\t\t\t\tif (axis.tickDecimals != null) {\r\n\t\t\t\t\t\tvar decimal = formatted.indexOf(\".\");\r\n\t\t\t\t\t\tvar precision = decimal == -1 ? 0 : formatted.length - decimal - 1;\r\n\t\t\t\t\t\tif (precision < axis.tickDecimals) {\r\n\t\t\t\t\t\t\treturn (precision ? formatted : formatted + \".\") + (\"\" + factor).substr(1, axis.tickDecimals - precision);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\r\n                    return formatted;\r\n                };\r\n            }\r\n\r\n            if ($.isFunction(opts.tickFormatter))\r\n                axis.tickFormatter = function (v, axis) { return \"\" + opts.tickFormatter(v, axis); };\r\n\r\n            if (opts.alignTicksWithAxis != null) {\r\n                var otherAxis = (axis.direction == \"x\" ? xaxes : yaxes)[opts.alignTicksWithAxis - 1];\r\n                if (otherAxis && otherAxis.used && otherAxis != axis) {\r\n                    // consider snapping min/max to outermost nice ticks\r\n                    var niceTicks = axis.tickGenerator(axis);\r\n                    if (niceTicks.length > 0) {\r\n                        if (opts.min == null)\r\n                            axis.min = Math.min(axis.min, niceTicks[0]);\r\n                        if (opts.max == null && niceTicks.length > 1)\r\n                            axis.max = Math.max(axis.max, niceTicks[niceTicks.length - 1]);\r\n                    }\r\n\r\n                    axis.tickGenerator = function (axis) {\r\n                        // copy ticks, scaled to this axis\r\n                        var ticks = [], v, i;\r\n                        for (i = 0; i < otherAxis.ticks.length; ++i) {\r\n                            v = (otherAxis.ticks[i].v - otherAxis.min) / (otherAxis.max - otherAxis.min);\r\n                            v = axis.min + v * (axis.max - axis.min);\r\n                            ticks.push(v);\r\n                        }\r\n                        return ticks;\r\n                    };\r\n\r\n                    // we might need an extra decimal since forced\r\n                    // ticks don't necessarily fit naturally\r\n                    if (!axis.mode && opts.tickDecimals == null) {\r\n                        var extraDec = Math.max(0, -Math.floor(Math.log(axis.delta) / Math.LN10) + 1),\r\n                            ts = axis.tickGenerator(axis);\r\n\r\n                        // only proceed if the tick interval rounded\r\n                        // with an extra decimal doesn't give us a\r\n                        // zero at end\r\n                        if (!(ts.length > 1 && /\\..*0$/.test((ts[1] - ts[0]).toFixed(extraDec))))\r\n                            axis.tickDecimals = extraDec;\r\n                    }\r\n                }\r\n            }\r\n        }\r\n\r\n        function setTicks(axis) {\r\n            var oticks = axis.options.ticks, ticks = [];\r\n            if (oticks == null || (typeof oticks == \"number\" && oticks > 0))\r\n                ticks = axis.tickGenerator(axis);\r\n            else if (oticks) {\r\n                if ($.isFunction(oticks))\r\n                    // generate the ticks\r\n                    ticks = oticks(axis);\r\n                else\r\n                    ticks = oticks;\r\n            }\r\n\r\n            // clean up/labelify the supplied ticks, copy them over\r\n            var i, v;\r\n            axis.ticks = [];\r\n            for (i = 0; i < ticks.length; ++i) {\r\n                var label = null;\r\n                var t = ticks[i];\r\n                if (typeof t == \"object\") {\r\n                    v = +t[0];\r\n                    if (t.length > 1)\r\n                        label = t[1];\r\n                }\r\n                else\r\n                    v = +t;\r\n                if (label == null)\r\n                    label = axis.tickFormatter(v, axis);\r\n                if (!isNaN(v))\r\n                    axis.ticks.push({ v: v, label: label });\r\n            }\r\n        }\r\n\r\n        function snapRangeToTicks(axis, ticks) {\r\n            var changed = false;\r\n            if (axis.options.autoscaleMargin && ticks.length > 0) {\r\n                // snap to ticks\r\n                if (axis.options.min == null) {\r\n                    axis.min = Math.min(axis.min, ticks[0].v);\r\n                    changed = true;\r\n                }\r\n                if (axis.options.max == null && ticks.length > 1) {\r\n                    axis.max = Math.max(axis.max, ticks[ticks.length - 1].v);\r\n                    changed = true;\r\n                }\r\n            }\r\n            return changed;\r\n        }\r\n\r\n        function draw() {\r\n\r\n            surface.clear();\r\n\r\n            executeHooks(hooks.drawBackground, [ctx]);\r\n\r\n            var grid = options.grid;\r\n\r\n            // draw background, if any\r\n            if (grid.show && grid.backgroundColor)\r\n                drawBackground();\r\n\r\n            if (grid.show && !grid.aboveData) {\r\n                drawGrid();\r\n            }\r\n\r\n            for (var i = 0; i < series.length; ++i) {\r\n                executeHooks(hooks.drawSeries, [ctx, series[i]]);\r\n                drawSeries(series[i]);\r\n            }\r\n\r\n            executeHooks(hooks.draw, [ctx]);\r\n\r\n            if (grid.show && grid.aboveData) {\r\n                drawGrid();\r\n            }\r\n\r\n            surface.render();\r\n\r\n            // A draw implies that either the axes or data have changed, so we\r\n            // should probably update the overlay highlights as well.\r\n\r\n            triggerRedrawOverlay();\r\n        }\r\n\r\n        function extractRange(ranges, coord) {\r\n            var axis, from, to, key, axes = allAxes();\r\n\r\n            for (var i = 0; i < axes.length; ++i) {\r\n                axis = axes[i];\r\n                if (axis.direction == coord) {\r\n                    key = coord + axis.n + \"axis\";\r\n                    if (!ranges[key] && axis.n == 1)\r\n                        key = coord + \"axis\"; // support x1axis as xaxis\r\n                    if (ranges[key]) {\r\n                        from = ranges[key].from;\r\n                        to = ranges[key].to;\r\n                        break;\r\n                    }\r\n                }\r\n            }\r\n\r\n            // backwards-compat stuff - to be removed in future\r\n            if (!ranges[key]) {\r\n                axis = coord == \"x\" ? xaxes[0] : yaxes[0];\r\n                from = ranges[coord + \"1\"];\r\n                to = ranges[coord + \"2\"];\r\n            }\r\n\r\n            // auto-reverse as an added bonus\r\n            if (from != null && to != null && from > to) {\r\n                var tmp = from;\r\n                from = to;\r\n                to = tmp;\r\n            }\r\n\r\n            return { from: from, to: to, axis: axis };\r\n        }\r\n\r\n        function drawBackground() {\r\n            ctx.save();\r\n            ctx.translate(plotOffset.left, plotOffset.top);\r\n\r\n            ctx.fillStyle = getColorOrGradient(options.grid.backgroundColor, plotHeight, 0, \"rgba(255, 255, 255, 0)\");\r\n            ctx.fillRect(0, 0, plotWidth, plotHeight);\r\n            ctx.restore();\r\n        }\r\n\r\n        function drawGrid() {\r\n            var i, axes, bw, bc;\r\n\r\n            ctx.save();\r\n            ctx.translate(plotOffset.left, plotOffset.top);\r\n\r\n            // draw markings\r\n            var markings = options.grid.markings;\r\n            if (markings) {\r\n                if ($.isFunction(markings)) {\r\n                    axes = plot.getAxes();\r\n                    // xmin etc. is backwards compatibility, to be\r\n                    // removed in the future\r\n                    axes.xmin = axes.xaxis.min;\r\n                    axes.xmax = axes.xaxis.max;\r\n                    axes.ymin = axes.yaxis.min;\r\n                    axes.ymax = axes.yaxis.max;\r\n\r\n                    markings = markings(axes);\r\n                }\r\n\r\n                for (i = 0; i < markings.length; ++i) {\r\n                    var m = markings[i],\r\n                        xrange = extractRange(m, \"x\"),\r\n                        yrange = extractRange(m, \"y\");\r\n\r\n                    // fill in missing\r\n                    if (xrange.from == null)\r\n                        xrange.from = xrange.axis.min;\r\n                    if (xrange.to == null)\r\n                        xrange.to = xrange.axis.max;\r\n                    if (yrange.from == null)\r\n                        yrange.from = yrange.axis.min;\r\n                    if (yrange.to == null)\r\n                        yrange.to = yrange.axis.max;\r\n\r\n                    // clip\r\n                    if (xrange.to < xrange.axis.min || xrange.from > xrange.axis.max ||\r\n                        yrange.to < yrange.axis.min || yrange.from > yrange.axis.max)\r\n                        continue;\r\n\r\n                    xrange.from = Math.max(xrange.from, xrange.axis.min);\r\n                    xrange.to = Math.min(xrange.to, xrange.axis.max);\r\n                    yrange.from = Math.max(yrange.from, yrange.axis.min);\r\n                    yrange.to = Math.min(yrange.to, yrange.axis.max);\r\n\r\n                    var xequal = xrange.from === xrange.to,\r\n                        yequal = yrange.from === yrange.to;\r\n\r\n                    if (xequal && yequal) {\r\n                        continue;\r\n                    }\r\n\r\n                    // then draw\r\n                    xrange.from = Math.floor(xrange.axis.p2c(xrange.from));\r\n                    xrange.to = Math.floor(xrange.axis.p2c(xrange.to));\r\n                    yrange.from = Math.floor(yrange.axis.p2c(yrange.from));\r\n                    yrange.to = Math.floor(yrange.axis.p2c(yrange.to));\r\n\r\n                    if (xequal || yequal) {\r\n                        var lineWidth = m.lineWidth || options.grid.markingsLineWidth,\r\n                            subPixel = lineWidth % 2 ? 0.5 : 0;\r\n                        ctx.beginPath();\r\n                        ctx.strokeStyle = m.color || options.grid.markingsColor;\r\n                        ctx.lineWidth = lineWidth;\r\n                        if (xequal) {\r\n                            ctx.moveTo(xrange.to + subPixel, yrange.from);\r\n                            ctx.lineTo(xrange.to + subPixel, yrange.to);\r\n                        } else {\r\n                            ctx.moveTo(xrange.from, yrange.to + subPixel);\r\n                            ctx.lineTo(xrange.to, yrange.to + subPixel);\r\n                        }\r\n                        ctx.stroke();\r\n                    } else {\r\n                        ctx.fillStyle = m.color || options.grid.markingsColor;\r\n                        ctx.fillRect(xrange.from, yrange.to,\r\n                                     xrange.to - xrange.from,\r\n                                     yrange.from - yrange.to);\r\n                    }\r\n                }\r\n            }\r\n\r\n            // draw the ticks\r\n            axes = allAxes();\r\n            bw = options.grid.borderWidth;\r\n\r\n            for (var j = 0; j < axes.length; ++j) {\r\n                var axis = axes[j], box = axis.box,\r\n                    t = axis.tickLength, x, y, xoff, yoff;\r\n                if (!axis.show || axis.ticks.length == 0)\r\n                    continue;\r\n\r\n                ctx.lineWidth = 1;\r\n\r\n                // find the edges\r\n                if (axis.direction == \"x\") {\r\n                    x = 0;\r\n                    if (t == \"full\")\r\n                        y = (axis.position == \"top\" ? 0 : plotHeight);\r\n                    else\r\n                        y = box.top - plotOffset.top + (axis.position == \"top\" ? box.height : 0);\r\n                }\r\n                else {\r\n                    y = 0;\r\n                    if (t == \"full\")\r\n                        x = (axis.position == \"left\" ? 0 : plotWidth);\r\n                    else\r\n                        x = box.left - plotOffset.left + (axis.position == \"left\" ? box.width : 0);\r\n                }\r\n\r\n                // draw tick bar\r\n                if (!axis.innermost) {\r\n                    ctx.strokeStyle = axis.options.color;\r\n                    ctx.beginPath();\r\n                    xoff = yoff = 0;\r\n                    if (axis.direction == \"x\")\r\n                        xoff = plotWidth + 1;\r\n                    else\r\n                        yoff = plotHeight + 1;\r\n\r\n                    if (ctx.lineWidth == 1) {\r\n                        if (axis.direction == \"x\") {\r\n                            y = Math.floor(y) + 0.5;\r\n                        } else {\r\n                            x = Math.floor(x) + 0.5;\r\n                        }\r\n                    }\r\n\r\n                    ctx.moveTo(x, y);\r\n                    ctx.lineTo(x + xoff, y + yoff);\r\n                    ctx.stroke();\r\n                }\r\n\r\n                // draw ticks\r\n\r\n                ctx.strokeStyle = axis.options.tickColor;\r\n\r\n                ctx.beginPath();\r\n                for (i = 0; i < axis.ticks.length; ++i) {\r\n                    var v = axis.ticks[i].v;\r\n\r\n                    xoff = yoff = 0;\r\n\r\n                    if (isNaN(v) || v < axis.min || v > axis.max\r\n                        // skip those lying on the axes if we got a border\r\n                        || (t == \"full\"\r\n                            && ((typeof bw == \"object\" && bw[axis.position] > 0) || bw > 0)\r\n                            && (v == axis.min || v == axis.max)))\r\n                        continue;\r\n\r\n                    if (axis.direction == \"x\") {\r\n                        x = axis.p2c(v);\r\n                        yoff = t == \"full\" ? -plotHeight : t;\r\n\r\n                        if (axis.position == \"top\")\r\n                            yoff = -yoff;\r\n                    }\r\n                    else {\r\n                        y = axis.p2c(v);\r\n                        xoff = t == \"full\" ? -plotWidth : t;\r\n\r\n                        if (axis.position == \"left\")\r\n                            xoff = -xoff;\r\n                    }\r\n\r\n                    if (ctx.lineWidth == 1) {\r\n                        if (axis.direction == \"x\")\r\n                            x = Math.floor(x) + 0.5;\r\n                        else\r\n                            y = Math.floor(y) + 0.5;\r\n                    }\r\n\r\n                    ctx.moveTo(x, y);\r\n                    ctx.lineTo(x + xoff, y + yoff);\r\n                }\r\n\r\n                ctx.stroke();\r\n            }\r\n\r\n\r\n            // draw border\r\n            if (bw) {\r\n                // If either borderWidth or borderColor is an object, then draw the border\r\n                // line by line instead of as one rectangle\r\n                bc = options.grid.borderColor;\r\n                if(typeof bw == \"object\" || typeof bc == \"object\") {\r\n                    if (typeof bw !== \"object\") {\r\n                        bw = {top: bw, right: bw, bottom: bw, left: bw};\r\n                    }\r\n                    if (typeof bc !== \"object\") {\r\n                        bc = {top: bc, right: bc, bottom: bc, left: bc};\r\n                    }\r\n\r\n                    if (bw.top > 0) {\r\n                        ctx.strokeStyle = bc.top;\r\n                        ctx.lineWidth = bw.top;\r\n                        ctx.beginPath();\r\n                        ctx.moveTo(0 - bw.left, 0 - bw.top/2);\r\n                        ctx.lineTo(plotWidth, 0 - bw.top/2);\r\n                        ctx.stroke();\r\n                    }\r\n\r\n                    if (bw.right > 0) {\r\n                        ctx.strokeStyle = bc.right;\r\n                        ctx.lineWidth = bw.right;\r\n                        ctx.beginPath();\r\n                        ctx.moveTo(plotWidth + bw.right / 2, 0 - bw.top);\r\n                        ctx.lineTo(plotWidth + bw.right / 2, plotHeight);\r\n                        ctx.stroke();\r\n                    }\r\n\r\n                    if (bw.bottom > 0) {\r\n                        ctx.strokeStyle = bc.bottom;\r\n                        ctx.lineWidth = bw.bottom;\r\n                        ctx.beginPath();\r\n                        ctx.moveTo(plotWidth + bw.right, plotHeight + bw.bottom / 2);\r\n                        ctx.lineTo(0, plotHeight + bw.bottom / 2);\r\n                        ctx.stroke();\r\n                    }\r\n\r\n                    if (bw.left > 0) {\r\n                        ctx.strokeStyle = bc.left;\r\n                        ctx.lineWidth = bw.left;\r\n                        ctx.beginPath();\r\n                        ctx.moveTo(0 - bw.left/2, plotHeight + bw.bottom);\r\n                        ctx.lineTo(0- bw.left/2, 0);\r\n                        ctx.stroke();\r\n                    }\r\n                }\r\n                else {\r\n                    ctx.lineWidth = bw;\r\n                    ctx.strokeStyle = options.grid.borderColor;\r\n                    ctx.strokeRect(-bw/2, -bw/2, plotWidth + bw, plotHeight + bw);\r\n                }\r\n            }\r\n\r\n            ctx.restore();\r\n        }\r\n\r\n        function drawAxisLabels() {\r\n\r\n            $.each(allAxes(), function (_, axis) {\r\n                var box = axis.box,\r\n                    legacyStyles = axis.direction + \"Axis \" + axis.direction + axis.n + \"Axis\",\r\n                    layer = \"flot-\" + axis.direction + \"-axis flot-\" + axis.direction + axis.n + \"-axis \" + legacyStyles,\r\n                    font = axis.options.font || \"flot-tick-label tickLabel\",\r\n                    tick, x, y, halign, valign;\r\n\r\n                // Remove text before checking for axis.show and ticks.length;\r\n                // otherwise plugins, like flot-tickrotor, that draw their own\r\n                // tick labels will end up with both theirs and the defaults.\r\n\r\n                surface.removeText(layer);\r\n\r\n                if (!axis.show || axis.ticks.length == 0)\r\n                    return;\r\n\r\n                for (var i = 0; i < axis.ticks.length; ++i) {\r\n\r\n                    tick = axis.ticks[i];\r\n                    if (!tick.label || tick.v < axis.min || tick.v > axis.max)\r\n                        continue;\r\n\r\n                    if (axis.direction == \"x\") {\r\n                        halign = \"center\";\r\n                        x = plotOffset.left + axis.p2c(tick.v);\r\n                        if (axis.position == \"bottom\") {\r\n                            y = box.top + box.padding + box.eventSectionPadding;\r\n                        } else {\r\n                            y = box.top + box.height - box.padding;\r\n                            valign = \"bottom\";\r\n                        }\r\n                    } else {\r\n                        valign = \"middle\";\r\n                        y = plotOffset.top + axis.p2c(tick.v);\r\n                        if (axis.position == \"left\") {\r\n                            x = box.left + box.width - box.padding;\r\n                            halign = \"right\";\r\n                        } else {\r\n                            x = box.left + box.padding;\r\n                        }\r\n                    }\r\n\r\n                    surface.addText(layer, x, y, tick.label, font, null, null, halign, valign);\r\n                }\r\n            });\r\n        }\r\n\r\n        function drawOrphanedPoints(series) {\r\n            /* Filters series data for points with no neighbors before or after\r\n             * and plots single 0.5 radius points for them so that they are displayed.\r\n             */\r\n            var abandonedPoints = [];\r\n            var beforeX = null;\r\n            var afterX = null;\r\n            var datapoints = series.datapoints;\r\n            // find any points with no neighbors before or after\r\n            var emptyPoints = [];\r\n            for (var j = 0; j < datapoints.pointsize - 2; j++) {\r\n                emptyPoints.push(0);\r\n            }\r\n            for (var i = 0; i < datapoints.points.length; i += datapoints.pointsize) {\r\n                var x = datapoints.points[i], y = datapoints.points[i + 1];\r\n                if (i === datapoints.points.length - datapoints.pointsize) {\r\n                    afterX = null;\r\n                } else {\r\n                    afterX = datapoints.points[i + datapoints.pointsize];\r\n                }\r\n                if (x !== null && y !== null && beforeX === null && afterX === null) {\r\n                    abandonedPoints.push(x);\r\n                    abandonedPoints.push(y);\r\n                    abandonedPoints.push.apply(abandonedPoints, emptyPoints);\r\n                }\r\n                beforeX = x;\r\n\r\n            }\r\n            var olddatapoints = datapoints.points\r\n            datapoints.points = abandonedPoints;\r\n\r\n            series.points.radius = series.lines.lineWidth/2;\r\n            // plot the orphan points with a radius of lineWidth/2\r\n            drawSeriesPoints(series);\r\n            // reset old info\r\n            datapoints.points = olddatapoints;\r\n        }\r\n\r\n        function drawSeries(series) {\r\n            if (series.lines.show) {\r\n                drawSeriesLines(series);\r\n                if (!series.points.show && !series.bars.show) {\r\n                    // not necessary if user wants points displayed for everything\r\n                    drawOrphanedPoints(series);\r\n                }\r\n            }\r\n            if (series.bars.show)\r\n                drawSeriesBars(series);\r\n            if (series.points.show)\r\n                drawSeriesPoints(series);\r\n        }\r\n\r\n        function drawSeriesLines(series) {\r\n            function plotLine(datapoints, xoffset, yoffset, axisx, axisy) {\r\n                var points = datapoints.points,\r\n                    ps = datapoints.pointsize,\r\n                    prevx = null, prevy = null;\r\n\r\n                ctx.beginPath();\r\n                for (var i = ps; i < points.length; i += ps) {\r\n                    var x1 = points[i - ps], y1 = points[i - ps + 1],\r\n                        x2 = points[i], y2 = points[i + 1];\r\n\r\n                    if (x1 == null || x2 == null)\r\n                        continue;\r\n\r\n                    // clip with ymin\r\n                    if (y1 <= y2 && y1 < axisy.min) {\r\n                        if (y2 < axisy.min)\r\n                            continue;   // line segment is outside\r\n                        // compute new intersection point\r\n                        x1 = (axisy.min - y1) / (y2 - y1) * (x2 - x1) + x1;\r\n                        y1 = axisy.min;\r\n                    }\r\n                    else if (y2 <= y1 && y2 < axisy.min) {\r\n                        if (y1 < axisy.min)\r\n                            continue;\r\n                        x2 = (axisy.min - y1) / (y2 - y1) * (x2 - x1) + x1;\r\n                        y2 = axisy.min;\r\n                    }\r\n\r\n                    // clip with ymax\r\n                    if (y1 >= y2 && y1 > axisy.max) {\r\n                        if (y2 > axisy.max)\r\n                            continue;\r\n                        x1 = (axisy.max - y1) / (y2 - y1) * (x2 - x1) + x1;\r\n                        y1 = axisy.max;\r\n                    }\r\n                    else if (y2 >= y1 && y2 > axisy.max) {\r\n                        if (y1 > axisy.max)\r\n                            continue;\r\n                        x2 = (axisy.max - y1) / (y2 - y1) * (x2 - x1) + x1;\r\n                        y2 = axisy.max;\r\n                    }\r\n\r\n                    // clip with xmin\r\n                    if (x1 <= x2 && x1 < axisx.min) {\r\n                        if (x2 < axisx.min)\r\n                            continue;\r\n                        y1 = (axisx.min - x1) / (x2 - x1) * (y2 - y1) + y1;\r\n                        x1 = axisx.min;\r\n                    }\r\n                    else if (x2 <= x1 && x2 < axisx.min) {\r\n                        if (x1 < axisx.min)\r\n                            continue;\r\n                        y2 = (axisx.min - x1) / (x2 - x1) * (y2 - y1) + y1;\r\n                        x2 = axisx.min;\r\n                    }\r\n\r\n                    // clip with xmax\r\n                    if (x1 >= x2 && x1 > axisx.max) {\r\n                        if (x2 > axisx.max)\r\n                            continue;\r\n                        y1 = (axisx.max - x1) / (x2 - x1) * (y2 - y1) + y1;\r\n                        x1 = axisx.max;\r\n                    }\r\n                    else if (x2 >= x1 && x2 > axisx.max) {\r\n                        if (x1 > axisx.max)\r\n                            continue;\r\n                        y2 = (axisx.max - x1) / (x2 - x1) * (y2 - y1) + y1;\r\n                        x2 = axisx.max;\r\n                    }\r\n\r\n                    if (x1 != prevx || y1 != prevy)\r\n                        ctx.moveTo(axisx.p2c(x1) + xoffset, axisy.p2c(y1) + yoffset);\r\n\r\n                    prevx = x2;\r\n                    prevy = y2;\r\n                    ctx.lineTo(axisx.p2c(x2) + xoffset, axisy.p2c(y2) + yoffset);\r\n                }\r\n                ctx.stroke();\r\n            }\r\n\r\n            function plotLineArea(datapoints, axisx, axisy) {\r\n                var points = datapoints.points,\r\n                    ps = datapoints.pointsize,\r\n                    bottom = Math.min(Math.max(0, axisy.min), axisy.max),\r\n                    i = 0, top, areaOpen = false,\r\n                    ypos = 1, segmentStart = 0, segmentEnd = 0;\r\n\r\n                // we process each segment in two turns, first forward\r\n                // direction to sketch out top, then once we hit the\r\n                // end we go backwards to sketch the bottom\r\n                while (true) {\r\n                    if (ps > 0 && i > points.length + ps)\r\n                        break;\r\n\r\n                    i += ps; // ps is negative if going backwards\r\n\r\n                    var x1 = points[i - ps],\r\n                        y1 = points[i - ps + ypos],\r\n                        x2 = points[i], y2 = points[i + ypos];\r\n\r\n                    if (areaOpen) {\r\n                        if (ps > 0 && x1 != null && x2 == null) {\r\n                            // at turning point\r\n                            segmentEnd = i;\r\n                            ps = -ps;\r\n                            ypos = 2;\r\n                            continue;\r\n                        }\r\n\r\n                        if (ps < 0 && i == segmentStart + ps) {\r\n                            // done with the reverse sweep\r\n                            ctx.fill();\r\n                            areaOpen = false;\r\n                            ps = -ps;\r\n                            ypos = 1;\r\n                            i = segmentStart = segmentEnd + ps;\r\n                            continue;\r\n                        }\r\n                    }\r\n\r\n                    if (x1 == null || x2 == null)\r\n                        continue;\r\n\r\n                    // clip x values\r\n\r\n                    // clip with xmin\r\n                    if (x1 <= x2 && x1 < axisx.min) {\r\n                        if (x2 < axisx.min)\r\n                            continue;\r\n                        y1 = (axisx.min - x1) / (x2 - x1) * (y2 - y1) + y1;\r\n                        x1 = axisx.min;\r\n                    }\r\n                    else if (x2 <= x1 && x2 < axisx.min) {\r\n                        if (x1 < axisx.min)\r\n                            continue;\r\n                        y2 = (axisx.min - x1) / (x2 - x1) * (y2 - y1) + y1;\r\n                        x2 = axisx.min;\r\n                    }\r\n\r\n                    // clip with xmax\r\n                    if (x1 >= x2 && x1 > axisx.max) {\r\n                        if (x2 > axisx.max)\r\n                            continue;\r\n                        y1 = (axisx.max - x1) / (x2 - x1) * (y2 - y1) + y1;\r\n                        x1 = axisx.max;\r\n                    }\r\n                    else if (x2 >= x1 && x2 > axisx.max) {\r\n                        if (x1 > axisx.max)\r\n                            continue;\r\n                        y2 = (axisx.max - x1) / (x2 - x1) * (y2 - y1) + y1;\r\n                        x2 = axisx.max;\r\n                    }\r\n\r\n                    if (!areaOpen) {\r\n                        // open area\r\n                        ctx.beginPath();\r\n                        ctx.moveTo(axisx.p2c(x1), axisy.p2c(bottom));\r\n                        areaOpen = true;\r\n                    }\r\n\r\n                    // now first check the case where both is outside\r\n                    if (y1 >= axisy.max && y2 >= axisy.max) {\r\n                        ctx.lineTo(axisx.p2c(x1), axisy.p2c(axisy.max));\r\n                        ctx.lineTo(axisx.p2c(x2), axisy.p2c(axisy.max));\r\n                        continue;\r\n                    }\r\n                    else if (y1 <= axisy.min && y2 <= axisy.min) {\r\n                        ctx.lineTo(axisx.p2c(x1), axisy.p2c(axisy.min));\r\n                        ctx.lineTo(axisx.p2c(x2), axisy.p2c(axisy.min));\r\n                        continue;\r\n                    }\r\n\r\n                    // else it's a bit more complicated, there might\r\n                    // be a flat maxed out rectangle first, then a\r\n                    // triangular cutout or reverse; to find these\r\n                    // keep track of the current x values\r\n                    var x1old = x1, x2old = x2;\r\n\r\n                    // clip the y values, without shortcutting, we\r\n                    // go through all cases in turn\r\n\r\n                    // clip with ymin\r\n                    if (y1 <= y2 && y1 < axisy.min && y2 >= axisy.min) {\r\n                        x1 = (axisy.min - y1) / (y2 - y1) * (x2 - x1) + x1;\r\n                        y1 = axisy.min;\r\n                    }\r\n                    else if (y2 <= y1 && y2 < axisy.min && y1 >= axisy.min) {\r\n                        x2 = (axisy.min - y1) / (y2 - y1) * (x2 - x1) + x1;\r\n                        y2 = axisy.min;\r\n                    }\r\n\r\n                    // clip with ymax\r\n                    if (y1 >= y2 && y1 > axisy.max && y2 <= axisy.max) {\r\n                        x1 = (axisy.max - y1) / (y2 - y1) * (x2 - x1) + x1;\r\n                        y1 = axisy.max;\r\n                    }\r\n                    else if (y2 >= y1 && y2 > axisy.max && y1 <= axisy.max) {\r\n                        x2 = (axisy.max - y1) / (y2 - y1) * (x2 - x1) + x1;\r\n                        y2 = axisy.max;\r\n                    }\r\n\r\n                    // if the x value was changed we got a rectangle\r\n                    // to fill\r\n                    if (x1 != x1old) {\r\n                        ctx.lineTo(axisx.p2c(x1old), axisy.p2c(y1));\r\n                        // it goes to (x1, y1), but we fill that below\r\n                    }\r\n\r\n                    // fill triangular section, this sometimes result\r\n                    // in redundant points if (x1, y1) hasn't changed\r\n                    // from previous line to, but we just ignore that\r\n                    ctx.lineTo(axisx.p2c(x1), axisy.p2c(y1));\r\n                    ctx.lineTo(axisx.p2c(x2), axisy.p2c(y2));\r\n\r\n                    // fill the other rectangle if it's there\r\n                    if (x2 != x2old) {\r\n                        ctx.lineTo(axisx.p2c(x2), axisy.p2c(y2));\r\n                        ctx.lineTo(axisx.p2c(x2old), axisy.p2c(y2));\r\n                    }\r\n                }\r\n            }\r\n\r\n            ctx.save();\r\n            ctx.translate(plotOffset.left, plotOffset.top);\r\n            ctx.lineJoin = \"round\";\r\n\r\n            var lw = series.lines.lineWidth,\r\n                sw = series.shadowSize;\r\n            // FIXME: consider another form of shadow when filling is turned on\r\n            if (lw > 0 && sw > 0) {\r\n                // draw shadow as a thick and thin line with transparency\r\n                ctx.lineWidth = sw;\r\n                ctx.strokeStyle = \"rgba(0,0,0,0.1)\";\r\n                // position shadow at angle from the mid of line\r\n                var angle = Math.PI/18;\r\n                plotLine(series.datapoints, Math.sin(angle) * (lw/2 + sw/2), Math.cos(angle) * (lw/2 + sw/2), series.xaxis, series.yaxis);\r\n                ctx.lineWidth = sw/2;\r\n                plotLine(series.datapoints, Math.sin(angle) * (lw/2 + sw/4), Math.cos(angle) * (lw/2 + sw/4), series.xaxis, series.yaxis);\r\n            }\r\n\r\n            ctx.lineWidth = lw;\r\n            ctx.strokeStyle = series.color;\r\n            var fillStyle = getFillStyle(series.lines, series.color, 0, plotHeight);\r\n            if (fillStyle) {\r\n                ctx.fillStyle = fillStyle;\r\n                plotLineArea(series.datapoints, series.xaxis, series.yaxis);\r\n            }\r\n\r\n            if (lw > 0)\r\n                plotLine(series.datapoints, 0, 0, series.xaxis, series.yaxis);\r\n            ctx.restore();\r\n        }\r\n\r\n        function drawSeriesPoints(series) {\r\n            function plotPoints(datapoints, radius, fillStyle, offset, shadow, axisx, axisy, symbol) {\r\n                var points = datapoints.points, ps = datapoints.pointsize;\r\n\r\n                for (var i = 0; i < points.length; i += ps) {\r\n                    var x = points[i], y = points[i + 1];\r\n                    if (x == null || x < axisx.min || x > axisx.max || y < axisy.min || y > axisy.max)\r\n                        continue;\r\n\r\n                    ctx.beginPath();\r\n                    x = axisx.p2c(x);\r\n                    y = axisy.p2c(y) + offset;\r\n                    if (symbol == \"circle\")\r\n                        ctx.arc(x, y, radius, 0, shadow ? Math.PI : Math.PI * 2, false);\r\n                    else\r\n                        symbol(ctx, x, y, radius, shadow);\r\n                    ctx.closePath();\r\n\r\n                    if (fillStyle) {\r\n                        ctx.fillStyle = fillStyle;\r\n                        ctx.fill();\r\n                    }\r\n                    ctx.stroke();\r\n                }\r\n            }\r\n\r\n            ctx.save();\r\n            ctx.translate(plotOffset.left, plotOffset.top);\r\n\r\n            var lw = series.points.lineWidth,\r\n                sw = series.shadowSize,\r\n                radius = series.points.radius,\r\n                symbol = series.points.symbol;\r\n\r\n            // If the user sets the line width to 0, we change it to a very\r\n            // small value. A line width of 0 seems to force the default of 1.\r\n            // Doing the conditional here allows the shadow setting to still be\r\n            // optional even with a lineWidth of 0.\r\n\r\n            if( lw == 0 )\r\n                lw = 0.0001;\r\n\r\n            if (lw > 0 && sw > 0) {\r\n                // draw shadow in two steps\r\n                var w = sw / 2;\r\n                ctx.lineWidth = w;\r\n                ctx.strokeStyle = \"rgba(0,0,0,0.1)\";\r\n                plotPoints(series.datapoints, radius, null, w + w/2, true,\r\n                           series.xaxis, series.yaxis, symbol);\r\n\r\n                ctx.strokeStyle = \"rgba(0,0,0,0.2)\";\r\n                plotPoints(series.datapoints, radius, null, w/2, true,\r\n                           series.xaxis, series.yaxis, symbol);\r\n            }\r\n\r\n            ctx.lineWidth = lw;\r\n            ctx.strokeStyle = series.color;\r\n            plotPoints(series.datapoints, radius,\r\n                       getFillStyle(series.points, series.color), 0, false,\r\n                       series.xaxis, series.yaxis, symbol);\r\n            ctx.restore();\r\n        }\r\n\r\n        function drawBar(x, y, b, barLeft, barRight, fillStyleCallback, axisx, axisy, c, horizontal, lineWidth) {\r\n            var left, right, bottom, top,\r\n                drawLeft, drawRight, drawTop, drawBottom,\r\n                tmp;\r\n\r\n            // in horizontal mode, we start the bar from the left\r\n            // instead of from the bottom so it appears to be\r\n            // horizontal rather than vertical\r\n            if (horizontal) {\r\n                drawBottom = drawRight = drawTop = true;\r\n                drawLeft = false;\r\n                left = b;\r\n                right = x;\r\n                top = y + barLeft;\r\n                bottom = y + barRight;\r\n\r\n                // account for negative bars\r\n                if (right < left) {\r\n                    tmp = right;\r\n                    right = left;\r\n                    left = tmp;\r\n                    drawLeft = true;\r\n                    drawRight = false;\r\n                }\r\n            }\r\n            else {\r\n                drawLeft = drawRight = drawTop = true;\r\n                drawBottom = false;\r\n                left = x + barLeft;\r\n                right = x + barRight;\r\n                bottom = b;\r\n                top = y;\r\n\r\n                // account for negative bars\r\n                if (top < bottom) {\r\n                    tmp = top;\r\n                    top = bottom;\r\n                    bottom = tmp;\r\n                    drawBottom = true;\r\n                    drawTop = false;\r\n                }\r\n            }\r\n\r\n            // clip\r\n            if (right < axisx.min || left > axisx.max ||\r\n                top < axisy.min || bottom > axisy.max)\r\n                return;\r\n\r\n            if (left < axisx.min) {\r\n                left = axisx.min;\r\n                drawLeft = false;\r\n            }\r\n\r\n            if (right > axisx.max) {\r\n                right = axisx.max;\r\n                drawRight = false;\r\n            }\r\n\r\n            if (bottom < axisy.min) {\r\n                bottom = axisy.min;\r\n                drawBottom = false;\r\n            }\r\n\r\n            if (top > axisy.max) {\r\n                top = axisy.max;\r\n                drawTop = false;\r\n            }\r\n\r\n            left = axisx.p2c(left);\r\n            bottom = axisy.p2c(bottom);\r\n            right = axisx.p2c(right);\r\n            top = axisy.p2c(top);\r\n\r\n            // fill the bar\r\n            if (fillStyleCallback) {\r\n                c.fillStyle = fillStyleCallback(bottom, top);\r\n                c.fillRect(left, top, right - left, bottom - top)\r\n            }\r\n\r\n            // draw outline\r\n            if (lineWidth > 0 && (drawLeft || drawRight || drawTop || drawBottom)) {\r\n                c.beginPath();\r\n\r\n                // FIXME: inline moveTo is buggy with excanvas\r\n                c.moveTo(left, bottom);\r\n                if (drawLeft)\r\n                    c.lineTo(left, top);\r\n                else\r\n                    c.moveTo(left, top);\r\n                if (drawTop)\r\n                    c.lineTo(right, top);\r\n                else\r\n                    c.moveTo(right, top);\r\n                if (drawRight)\r\n                    c.lineTo(right, bottom);\r\n                else\r\n                    c.moveTo(right, bottom);\r\n                if (drawBottom)\r\n                    c.lineTo(left, bottom);\r\n                else\r\n                    c.moveTo(left, bottom);\r\n                c.stroke();\r\n            }\r\n        }\r\n\r\n        function drawSeriesBars(series) {\r\n            function plotBars(datapoints, barLeft, barRight, fillStyleCallback, axisx, axisy) {\r\n                var points = datapoints.points, ps = datapoints.pointsize;\r\n\r\n                for (var i = 0; i < points.length; i += ps) {\r\n                    if (points[i] == null)\r\n                        continue;\r\n                    drawBar(points[i], points[i + 1], points[i + 2], barLeft, barRight, fillStyleCallback, axisx, axisy, ctx, series.bars.horizontal, series.bars.lineWidth);\r\n                }\r\n            }\r\n\r\n            ctx.save();\r\n            ctx.translate(plotOffset.left, plotOffset.top);\r\n\r\n            // FIXME: figure out a way to add shadows (for instance along the right edge)\r\n            ctx.lineWidth = series.bars.lineWidth;\r\n            ctx.strokeStyle = series.color;\r\n\r\n            var barLeft;\r\n\r\n            switch (series.bars.align) {\r\n                case \"left\":\r\n                    barLeft = 0;\r\n                    break;\r\n                case \"right\":\r\n                    barLeft = -series.bars.barWidth;\r\n                    break;\r\n                default:\r\n                    barLeft = -series.bars.barWidth / 2;\r\n            }\r\n\r\n            var fillStyleCallback = series.bars.fill ? function (bottom, top) { return getFillStyle(series.bars, series.color, bottom, top); } : null;\r\n            plotBars(series.datapoints, barLeft, barLeft + series.bars.barWidth, fillStyleCallback, series.xaxis, series.yaxis);\r\n            ctx.restore();\r\n        }\r\n\r\n        function getFillStyle(filloptions, seriesColor, bottom, top) {\r\n            var fill = filloptions.fill;\r\n            if (!fill)\r\n                return null;\r\n\r\n            if (filloptions.fillColor)\r\n                return getColorOrGradient(filloptions.fillColor, bottom, top, seriesColor);\r\n\r\n            var c = $.color.parse(seriesColor);\r\n            c.a = typeof fill == \"number\" ? fill : 0.4;\r\n            c.normalize();\r\n            return c.toString();\r\n        }\r\n\r\n        function insertLegend() {\r\n\r\n            if (options.legend.container != null) {\r\n                $(options.legend.container).html(\"\");\r\n            } else {\r\n                placeholder.find(\".legend\").remove();\r\n            }\r\n\r\n            if (!options.legend.show) {\r\n                return;\r\n            }\r\n\r\n            var fragments = [], entries = [], rowStarted = false,\r\n                lf = options.legend.labelFormatter, s, label;\r\n\r\n            // Build a list of legend entries, with each having a label and a color\r\n\r\n            for (var i = 0; i < series.length; ++i) {\r\n                s = series[i];\r\n                if (s.label) {\r\n                    label = lf ? lf(s.label, s) : s.label;\r\n                    if (label) {\r\n                        entries.push({\r\n                            label: label,\r\n                            color: s.color\r\n                        });\r\n                    }\r\n                }\r\n            }\r\n\r\n            // Sort the legend using either the default or a custom comparator\r\n\r\n            if (options.legend.sorted) {\r\n                if ($.isFunction(options.legend.sorted)) {\r\n                    entries.sort(options.legend.sorted);\r\n                } else if (options.legend.sorted == \"reverse\") {\r\n                \tentries.reverse();\r\n                } else {\r\n                    var ascending = options.legend.sorted != \"descending\";\r\n                    entries.sort(function(a, b) {\r\n                        return a.label == b.label ? 0 : (\r\n                            (a.label < b.label) != ascending ? 1 : -1   // Logical XOR\r\n                        );\r\n                    });\r\n                }\r\n            }\r\n\r\n            // Generate markup for the list of entries, in their final order\r\n\r\n            for (var i = 0; i < entries.length; ++i) {\r\n\r\n                var entry = entries[i];\r\n\r\n                if (i % options.legend.noColumns == 0) {\r\n                    if (rowStarted)\r\n                        fragments.push('</tr>');\r\n                    fragments.push('<tr>');\r\n                    rowStarted = true;\r\n                }\r\n\r\n                fragments.push(\r\n                    '<td class=\"legendColorBox\"><div style=\"border:1px solid ' + options.legend.labelBoxBorderColor + ';padding:1px\"><div style=\"width:4px;height:0;border:5px solid ' + entry.color + ';overflow:hidden\"></div></div></td>' +\r\n                    '<td class=\"legendLabel\">' + entry.label + '</td>'\r\n                );\r\n            }\r\n\r\n            if (rowStarted)\r\n                fragments.push('</tr>');\r\n\r\n            if (fragments.length == 0)\r\n                return;\r\n\r\n            var table = '<table style=\"font-size:smaller;color:' + options.grid.color + '\">' + fragments.join(\"\") + '</table>';\r\n            if (options.legend.container != null)\r\n                $(options.legend.container).html(table);\r\n            else {\r\n                var pos = \"\",\r\n                    p = options.legend.position,\r\n                    m = options.legend.margin;\r\n                if (m[0] == null)\r\n                    m = [m, m];\r\n                if (p.charAt(0) == \"n\")\r\n                    pos += 'top:' + (m[1] + plotOffset.top) + 'px;';\r\n                else if (p.charAt(0) == \"s\")\r\n                    pos += 'bottom:' + (m[1] + plotOffset.bottom) + 'px;';\r\n                if (p.charAt(1) == \"e\")\r\n                    pos += 'right:' + (m[0] + plotOffset.right) + 'px;';\r\n                else if (p.charAt(1) == \"w\")\r\n                    pos += 'left:' + (m[0] + plotOffset.left) + 'px;';\r\n                var legend = $('<div class=\"legend\">' + table.replace('style=\"', 'style=\"position:absolute;' + pos +';') + '</div>').appendTo(placeholder);\r\n                if (options.legend.backgroundOpacity != 0.0) {\r\n                    // put in the transparent background\r\n                    // separately to avoid blended labels and\r\n                    // label boxes\r\n                    var c = options.legend.backgroundColor;\r\n                    if (c == null) {\r\n                        c = options.grid.backgroundColor;\r\n                        if (c && typeof c == \"string\")\r\n                            c = $.color.parse(c);\r\n                        else\r\n                            c = $.color.extract(legend, 'background-color');\r\n                        c.a = 1;\r\n                        c = c.toString();\r\n                    }\r\n                    var div = legend.children();\r\n                    $('<div style=\"position:absolute;width:' + div.width() + 'px;height:' + div.height() + 'px;' + pos +'background-color:' + c + ';\"> </div>').prependTo(legend).css('opacity', options.legend.backgroundOpacity);\r\n                }\r\n            }\r\n        }\r\n\r\n\r\n        // interactive features\r\n\r\n        var highlights = [],\r\n            redrawTimeout = null;\r\n\r\n        // returns the data item the mouse is over, or null if none is found\r\n        function findNearbyItem(mouseX, mouseY, seriesFilter) {\r\n            var maxDistance = options.grid.mouseActiveRadius,\r\n                smallestDistance = maxDistance * maxDistance + 1,\r\n                item = null, foundPoint = false, i, j, ps;\r\n\r\n            for (i = series.length - 1; i >= 0; --i) {\r\n                if (!seriesFilter(series[i]))\r\n                    continue;\r\n\r\n                var s = series[i],\r\n                    axisx = s.xaxis,\r\n                    axisy = s.yaxis,\r\n                    points = s.datapoints.points,\r\n                    mx = axisx.c2p(mouseX), // precompute some stuff to make the loop faster\r\n                    my = axisy.c2p(mouseY),\r\n                    maxx = maxDistance / axisx.scale,\r\n                    maxy = maxDistance / axisy.scale;\r\n\r\n                ps = s.datapoints.pointsize;\r\n                // with inverse transforms, we can't use the maxx/maxy\r\n                // optimization, sadly\r\n                if (axisx.options.inverseTransform)\r\n                    maxx = Number.MAX_VALUE;\r\n                if (axisy.options.inverseTransform)\r\n                    maxy = Number.MAX_VALUE;\r\n\r\n                if (s.lines.show || s.points.show) {\r\n                    for (j = 0; j < points.length; j += ps) {\r\n                        var x = points[j], y = points[j + 1];\r\n                        if (x == null)\r\n                            continue;\r\n\r\n                        // For points and lines, the cursor must be within a\r\n                        // certain distance to the data point\r\n                        if (x - mx > maxx || x - mx < -maxx ||\r\n                            y - my > maxy || y - my < -maxy)\r\n                            continue;\r\n\r\n                        // We have to calculate distances in pixels, not in\r\n                        // data units, because the scales of the axes may be different\r\n                        var dx = Math.abs(axisx.p2c(x) - mouseX),\r\n                            dy = Math.abs(axisy.p2c(y) - mouseY),\r\n                            dist = dx * dx + dy * dy; // we save the sqrt\r\n\r\n                        // use <= to ensure last point takes precedence\r\n                        // (last generally means on top of)\r\n                        if (dist < smallestDistance) {\r\n                            smallestDistance = dist;\r\n                            item = [i, j / ps];\r\n                        }\r\n                    }\r\n                }\r\n\r\n                if (s.bars.show && !item) { // no other point can be nearby\r\n\r\n                    var barLeft, barRight;\r\n\r\n                    switch (s.bars.align) {\r\n                        case \"left\":\r\n                            barLeft = 0;\r\n                            break;\r\n                        case \"right\":\r\n                            barLeft = -s.bars.barWidth;\r\n                            break;\r\n                        default:\r\n                            barLeft = -s.bars.barWidth / 2;\r\n                    }\r\n\r\n                    barRight = barLeft + s.bars.barWidth;\r\n\r\n                    for (j = 0; j < points.length; j += ps) {\r\n                        var x = points[j], y = points[j + 1], b = points[j + 2];\r\n                        if (x == null)\r\n                            continue;\r\n\r\n                        // for a bar graph, the cursor must be inside the bar\r\n                        if (series[i].bars.horizontal ?\r\n                            (mx <= Math.max(b, x) && mx >= Math.min(b, x) &&\r\n                             my >= y + barLeft && my <= y + barRight) :\r\n                            (mx >= x + barLeft && mx <= x + barRight &&\r\n                             my >= Math.min(b, y) && my <= Math.max(b, y)))\r\n                                item = [i, j / ps];\r\n                    }\r\n                }\r\n            }\r\n\r\n            if (item) {\r\n                i = item[0];\r\n                j = item[1];\r\n                ps = series[i].datapoints.pointsize;\r\n\r\n                return { datapoint: series[i].datapoints.points.slice(j * ps, (j + 1) * ps),\r\n                         dataIndex: j,\r\n                         series: series[i],\r\n                         seriesIndex: i };\r\n            }\r\n\r\n            return null;\r\n        }\r\n\r\n        function onMouseMove(e) {\r\n            if (options.grid.hoverable)\r\n                triggerClickHoverEvent(\"plothover\", e,\r\n                                       function (s) { return s[\"hoverable\"] != false; });\r\n        }\r\n\r\n        function onMouseLeave(e) {\r\n            if (options.grid.hoverable)\r\n                triggerClickHoverEvent(\"plothover\", e,\r\n                                       function (s) { return false; });\r\n        }\r\n\r\n        function onClick(e) {\r\n          if (plot.isSelecting) {\r\n            return;\r\n          }\r\n\r\n          triggerClickHoverEvent(\"plotclick\", e, function (s) { return s[\"clickable\"] != false; });\r\n        }\r\n\r\n        // grafana addon - added to support mobile devices click in plot\r\n        function onTouch(e) {\r\n            if (!e.cancelable) {\r\n                return;\r\n            }\r\n        \r\n            if (!eventHolder.is(e.target) && eventHolder.has(e.target).length === 0) {\r\n                triggerClickHoverEvent(\"plotleave\", e, function (s) { false; });\r\n                return;\r\n            }\r\n\r\n            onMouseMove(mapFromTouchEvent(e));\r\n            e.preventDefault();\r\n        }\r\n\r\n        // grafana addon - added to support mobile devices and mapping touch event to click event structure\r\n        function mapFromTouchEvent(e) {\r\n            if (!e || !e.originalEvent) {\r\n                return e;\r\n            }\r\n\r\n            if (e.pageX && e.pageY) {\r\n                return e;\r\n            }\r\n\r\n            var original = e.originalEvent;\r\n            \r\n            if (original.changedTouches.length === 0) {\r\n                return e;\r\n            }\r\n\r\n            var touch = original.changedTouches[0];\r\n            e.pageX = touch.pageX;\r\n            e.pageY = touch.pageY;\r\n\r\n            return e;\r\n        }\r\n\r\n        // trigger click or hover event (they send the same parameters\r\n        // so we share their code)\r\n        function triggerClickHoverEvent(eventname, event, seriesFilter) {\r\n            var offset = eventHolder.offset(),\r\n                canvasX = event.pageX - offset.left - plotOffset.left,\r\n                canvasY = event.pageY - offset.top - plotOffset.top,\r\n            pos = canvasToAxisCoords({ left: canvasX, top: canvasY });\r\n\r\n            pos.pageX = event.pageX;\r\n            pos.pageY = event.pageY;\r\n\r\n            // Add ctrlKey and metaKey to event\r\n            pos.ctrlKey = event.ctrlKey;\r\n            pos.metaKey = event.metaKey;\r\n\r\n            var item = findNearbyItem(canvasX, canvasY, seriesFilter);\r\n\r\n            if (item) {\r\n                // fill in mouse pos for any listeners out there\r\n                item.pageX = parseInt(item.series.xaxis.p2c(item.datapoint[0]) + offset.left + plotOffset.left, 10);\r\n                item.pageY = parseInt(item.series.yaxis.p2c(item.datapoint[1]) + offset.top + plotOffset.top, 10);\r\n            }\r\n\r\n            if (options.grid.autoHighlight) {\r\n                // clear auto-highlights\r\n                for (var i = 0; i < highlights.length; ++i) {\r\n                    var h = highlights[i];\r\n                    if (h.auto == eventname &&\r\n                        !(item && h.series == item.series &&\r\n                          h.point[0] == item.datapoint[0] &&\r\n                          h.point[1] == item.datapoint[1]))\r\n                        unhighlight(h.series, h.point);\r\n                }\r\n\r\n                if (item)\r\n                    highlight(item.series, item.datapoint, eventname);\r\n            }\r\n\r\n            placeholder.trigger(eventname, [ pos, item ]);\r\n        }\r\n\r\n        function triggerRedrawOverlay() {\r\n            var t = options.interaction.redrawOverlayInterval;\r\n            if (t == -1) {      // skip event queue\r\n                drawOverlay();\r\n                return;\r\n            }\r\n\r\n            if (!redrawTimeout)\r\n                redrawTimeout = setTimeout(drawOverlay, t);\r\n        }\r\n\r\n        function drawOverlay() {\r\n            redrawTimeout = null;\r\n\r\n            // draw highlights\r\n            octx.save();\r\n            overlay.clear();\r\n            octx.translate(plotOffset.left, plotOffset.top);\r\n\r\n            var i, hi;\r\n            for (i = 0; i < highlights.length; ++i) {\r\n                hi = highlights[i];\r\n\r\n                if (hi.series.bars.show)\r\n                    drawBarHighlight(hi.series, hi.point);\r\n                else\r\n                    drawPointHighlight(hi.series, hi.point);\r\n            }\r\n            octx.restore();\r\n\r\n            executeHooks(hooks.drawOverlay, [octx]);\r\n        }\r\n\r\n        function highlight(s, point, auto) {\r\n            if (typeof s == \"number\")\r\n                s = series[s];\r\n\r\n            if (typeof point == \"number\") {\r\n                var ps = s.datapoints.pointsize;\r\n                point = s.datapoints.points.slice(ps * point, ps * (point + 1));\r\n            }\r\n\r\n            var i = indexOfHighlight(s, point);\r\n            if (i == -1) {\r\n                highlights.push({ series: s, point: point, auto: auto });\r\n\r\n                triggerRedrawOverlay();\r\n            }\r\n            else if (!auto)\r\n                highlights[i].auto = false;\r\n        }\r\n\r\n        function unhighlight(s, point) {\r\n            if (s == null && point == null) {\r\n                highlights = [];\r\n                triggerRedrawOverlay();\r\n                return;\r\n            }\r\n\r\n            if (typeof s == \"number\")\r\n                s = series[s];\r\n\r\n            if (typeof point == \"number\") {\r\n                var ps = s.datapoints.pointsize;\r\n                point = s.datapoints.points.slice(ps * point, ps * (point + 1));\r\n            }\r\n\r\n            var i = indexOfHighlight(s, point);\r\n            if (i != -1) {\r\n                highlights.splice(i, 1);\r\n\r\n                triggerRedrawOverlay();\r\n            }\r\n        }\r\n\r\n        function indexOfHighlight(s, p) {\r\n            for (var i = 0; i < highlights.length; ++i) {\r\n                var h = highlights[i];\r\n                if (h.series == s && h.point[0] == p[0]\r\n                    && h.point[1] == p[1])\r\n                    return i;\r\n            }\r\n            return -1;\r\n        }\r\n\r\n        function drawPointHighlight(series, point) {\r\n            var x = point[0], y = point[1],\r\n                axisx = series.xaxis, axisy = series.yaxis,\r\n                highlightColor = (typeof series.highlightColor === \"string\") ? series.highlightColor : $.color.parse(series.color).scale('a', 0.5).toString();\r\n\r\n            if (x < axisx.min || x > axisx.max || y < axisy.min || y > axisy.max)\r\n                return;\r\n\r\n            var pointRadius = series.points.radius + series.points.lineWidth / 2;\r\n            octx.lineWidth = pointRadius;\r\n            octx.strokeStyle = highlightColor;\r\n            var radius = 1.5 * pointRadius;\r\n            x = axisx.p2c(x);\r\n            y = axisy.p2c(y);\r\n\r\n            octx.beginPath();\r\n            if (series.points.symbol == \"circle\")\r\n                octx.arc(x, y, radius, 0, 2 * Math.PI, false);\r\n            else\r\n                series.points.symbol(octx, x, y, radius, false);\r\n            octx.closePath();\r\n            octx.stroke();\r\n        }\r\n\r\n        function drawBarHighlight(series, point) {\r\n            var highlightColor = (typeof series.highlightColor === \"string\") ? series.highlightColor : $.color.parse(series.color).scale('a', 0.5).toString(),\r\n                fillStyle = highlightColor,\r\n                barLeft;\r\n\r\n            switch (series.bars.align) {\r\n                case \"left\":\r\n                    barLeft = 0;\r\n                    break;\r\n                case \"right\":\r\n                    barLeft = -series.bars.barWidth;\r\n                    break;\r\n                default:\r\n                    barLeft = -series.bars.barWidth / 2;\r\n            }\r\n\r\n            octx.lineWidth = series.bars.lineWidth;\r\n            octx.strokeStyle = highlightColor;\r\n\r\n            drawBar(point[0], point[1], point[2] || 0, barLeft, barLeft + series.bars.barWidth,\r\n                    function () { return fillStyle; }, series.xaxis, series.yaxis, octx, series.bars.horizontal, series.bars.lineWidth);\r\n        }\r\n\r\n        function getColorOrGradient(spec, bottom, top, defaultColor) {\r\n            if (typeof spec == \"string\")\r\n                return spec;\r\n            else {\r\n                // assume this is a gradient spec; IE currently only\r\n                // supports a simple vertical gradient properly, so that's\r\n                // what we support too\r\n                var gradient = ctx.createLinearGradient(0, top, 0, bottom);\r\n\r\n                for (var i = 0, l = spec.colors.length; i < l; ++i) {\r\n                    var c = spec.colors[i];\r\n                    if (typeof c != \"string\") {\r\n                        var co = $.color.parse(defaultColor);\r\n                        if (c.brightness != null)\r\n                            co = co.scale('rgb', c.brightness);\r\n                        if (c.opacity != null)\r\n                            co.a *= c.opacity;\r\n                        c = co.toString();\r\n                    }\r\n                    gradient.addColorStop(i / (l - 1), c);\r\n                }\r\n\r\n                return gradient;\r\n            }\r\n        }\r\n    }\r\n\r\n    // Add the plot function to the top level of the jQuery object\r\n\r\n    $.plot = function(placeholder, data, options) {\r\n        //var t0 = new Date();\r\n        var plot = new Plot($(placeholder), data, options, $.plot.plugins);\r\n        //(window.console ? console.log : alert)(\"time used (msecs): \" + ((new Date()).getTime() - t0.getTime()));\r\n        return plot;\r\n    };\r\n\r\n    $.plot.version = \"0.8.3\";\r\n\r\n    $.plot.plugins = [];\r\n\r\n    // Also add the plot function as a chainable property\r\n\r\n    $.fn.plot = function(data, options) {\r\n        return this.each(function() {\r\n            $.plot(this, data, options);\r\n        });\r\n    };\r\n\r\n    // round to nearby lower multiple of base\r\n    function floorInBase(n, base) {\r\n        return base * Math.floor(n / base);\r\n    }\r\n\r\n})(jQuery);\r\n","/* Flot plugin for selecting regions of a plot.\r\n\r\nCopyright (c) 2007-2013 IOLA and Ole Laursen.\r\nLicensed under the MIT license.\r\n\r\nThe plugin supports these options:\r\n\r\nselection: {\r\n\tmode: null or \"x\" or \"y\" or \"xy\",\r\n\tcolor: color,\r\n\tshape: \"round\" or \"miter\" or \"bevel\",\r\n\tminSize: number of pixels\r\n}\r\n\r\nSelection support is enabled by setting the mode to one of \"x\", \"y\" or \"xy\".\r\nIn \"x\" mode, the user will only be able to specify the x range, similarly for\r\n\"y\" mode. For \"xy\", the selection becomes a rectangle where both ranges can be\r\nspecified. \"color\" is color of the selection (if you need to change the color\r\nlater on, you can get to it with plot.getOptions().selection.color). \"shape\"\r\nis the shape of the corners of the selection.\r\n\r\n\"minSize\" is the minimum size a selection can be in pixels. This value can\r\nbe customized to determine the smallest size a selection can be and still\r\nhave the selection rectangle be displayed. When customizing this value, the\r\nfact that it refers to pixels, not axis units must be taken into account.\r\nThus, for example, if there is a bar graph in time mode with BarWidth set to 1\r\nminute, setting \"minSize\" to 1 will not make the minimum selection size 1\r\nminute, but rather 1 pixel. Note also that setting \"minSize\" to 0 will prevent\r\n\"plotunselected\" events from being fired when the user clicks the mouse without\r\ndragging.\r\n\r\nWhen selection support is enabled, a \"plotselected\" event will be emitted on\r\nthe DOM element you passed into the plot function. The event handler gets a\r\nparameter with the ranges selected on the axes, like this:\r\n\r\n\tplaceholder.bind( \"plotselected\", function( event, ranges ) {\r\n\t\talert(\"You selected \" + ranges.xaxis.from + \" to \" + ranges.xaxis.to)\r\n\t\t// similar for yaxis - with multiple axes, the extra ones are in\r\n\t\t// x2axis, x3axis, ...\r\n\t});\r\n\r\nThe \"plotselected\" event is only fired when the user has finished making the\r\nselection. A \"plotselecting\" event is fired during the process with the same\r\nparameters as the \"plotselected\" event, in case you want to know what's\r\nhappening while it's happening,\r\n\r\nA \"plotunselected\" event with no arguments is emitted when the user clicks the\r\nmouse to remove the selection. As stated above, setting \"minSize\" to 0 will\r\ndestroy this behavior.\r\n\r\nThe plugin allso adds the following methods to the plot object:\r\n\r\n- setSelection( ranges, preventEvent )\r\n\r\n  Set the selection rectangle. The passed in ranges is on the same form as\r\n  returned in the \"plotselected\" event. If the selection mode is \"x\", you\r\n  should put in either an xaxis range, if the mode is \"y\" you need to put in\r\n  an yaxis range and both xaxis and yaxis if the selection mode is \"xy\", like\r\n  this:\r\n\r\n\tsetSelection({ xaxis: { from: 0, to: 10 }, yaxis: { from: 40, to: 60 } });\r\n\r\n  setSelection will trigger the \"plotselected\" event when called. If you don't\r\n  want that to happen, e.g. if you're inside a \"plotselected\" handler, pass\r\n  true as the second parameter. If you are using multiple axes, you can\r\n  specify the ranges on any of those, e.g. as x2axis/x3axis/... instead of\r\n  xaxis, the plugin picks the first one it sees.\r\n\r\n- clearSelection( preventEvent )\r\n\r\n  Clear the selection rectangle. Pass in true to avoid getting a\r\n  \"plotunselected\" event.\r\n\r\n- getSelection()\r\n\r\n  Returns the current selection in the same format as the \"plotselected\"\r\n  event. If there's currently no selection, the function returns null.\r\n\r\n*/\r\n\r\n(function ($) {\r\n    function init(plot) {\r\n        var selection = {\r\n                first: { x: -1, y: -1}, second: { x: -1, y: -1},\r\n                show: false,\r\n                active: false\r\n            };\r\n\r\n        // FIXME: The drag handling implemented here should be\r\n        // abstracted out, there's some similar code from a library in\r\n        // the navigation plugin, this should be massaged a bit to fit\r\n        // the Flot cases here better and reused. Doing this would\r\n        // make this plugin much slimmer.\r\n        var savedhandlers = {};\r\n\r\n        var mouseUpHandler = null;\r\n\r\n        function onMouseMove(e) {\r\n            if (selection.active) {\r\n                updateSelection(e);\r\n\r\n                plot.getPlaceholder().trigger(\"plotselecting\", [ getSelection() ]);\r\n            }\r\n        }\r\n\r\n        function onMouseDown(e) {\r\n            if (e.which != 1)  // only accept left-click\r\n                return;\r\n\r\n            // cancel out any text selections\r\n            document.body.focus();\r\n\r\n            // prevent text selection and drag in old-school browsers\r\n            if (document.onselectstart !== undefined && savedhandlers.onselectstart == null) {\r\n                savedhandlers.onselectstart = document.onselectstart;\r\n                document.onselectstart = function () { return false; };\r\n            }\r\n            if (document.ondrag !== undefined && savedhandlers.ondrag == null) {\r\n                savedhandlers.ondrag = document.ondrag;\r\n                document.ondrag = function () { return false; };\r\n            }\r\n\r\n            setSelectionPos(selection.first, e);\r\n\r\n            selection.active = true;\r\n\r\n            // this is a bit silly, but we have to use a closure to be\r\n            // able to whack the same handler again\r\n            mouseUpHandler = function (e) { onMouseUp(e); };\r\n\r\n            $(document).one(\"mouseup\", mouseUpHandler);\r\n        }\r\n\r\n        function onMouseUp(e) {\r\n            mouseUpHandler = null;\r\n\r\n            // revert drag stuff for old-school browsers\r\n            if (document.onselectstart !== undefined)\r\n                document.onselectstart = savedhandlers.onselectstart;\r\n            if (document.ondrag !== undefined)\r\n                document.ondrag = savedhandlers.ondrag;\r\n\r\n            // no more dragging\r\n            selection.active = false;\r\n            updateSelection(e);\r\n\r\n            if (selectionIsSane())\r\n                triggerSelectedEvent(e);\r\n            else {\r\n                // this counts as a clear\r\n                plot.getPlaceholder().trigger(\"plotunselected\", [ ]);\r\n                plot.getPlaceholder().trigger(\"plotselecting\", [ null ]);\r\n            }\r\n\r\n            setTimeout(function() {\r\n              plot.isSelecting = false;\r\n            }, 10);\r\n\r\n            return false;\r\n        }\r\n\r\n        function getSelection() {\r\n            if (!selectionIsSane())\r\n                return null;\r\n\r\n            if (!selection.show) return null;\r\n\r\n            var r = {}, c1 = selection.first, c2 = selection.second;\r\n            var axes = plot.getAxes();\r\n            // look if no axis is used\r\n            var noAxisInUse = true;\r\n            $.each(axes, function (name, axis) {\r\n              if (axis.used) {\r\n                anyUsed = false;\r\n              }\r\n            })\r\n\r\n            $.each(axes, function (name, axis) {\r\n                if (axis.used || noAxisInUse) {\r\n                    var p1 = axis.c2p(c1[axis.direction]), p2 = axis.c2p(c2[axis.direction]);\r\n                    r[name] = { from: Math.min(p1, p2), to: Math.max(p1, p2) };\r\n                }\r\n            });\r\n            return r;\r\n        }\r\n\r\n        function triggerSelectedEvent(event) {\r\n            var r = getSelection();\r\n\r\n            // Add ctrlKey and metaKey to event\r\n            r.ctrlKey = event.ctrlKey;\r\n            r.metaKey = event.metaKey;\r\n\r\n            plot.getPlaceholder().trigger(\"plotselected\", [ r ]);\r\n\r\n            // backwards-compat stuff, to be removed in future\r\n            if (r.xaxis && r.yaxis)\r\n                plot.getPlaceholder().trigger(\"selected\", [ { x1: r.xaxis.from, y1: r.yaxis.from, x2: r.xaxis.to, y2: r.yaxis.to } ]);\r\n        }\r\n\r\n        function clamp(min, value, max) {\r\n            return value < min ? min: (value > max ? max: value);\r\n        }\r\n\r\n        function setSelectionPos(pos, e) {\r\n            var o = plot.getOptions();\r\n            var offset = plot.getPlaceholder().offset();\r\n            var plotOffset = plot.getPlotOffset();\r\n            pos.x = clamp(0, e.pageX - offset.left - plotOffset.left, plot.width());\r\n            pos.y = clamp(0, e.pageY - offset.top - plotOffset.top, plot.height());\r\n\r\n            if (o.selection.mode == \"y\")\r\n                pos.x = pos == selection.first ? 0 : plot.width();\r\n\r\n            if (o.selection.mode == \"x\")\r\n                pos.y = pos == selection.first ? 0 : plot.height();\r\n        }\r\n\r\n        function updateSelection(pos) {\r\n            if (pos.pageX == null)\r\n                return;\r\n\r\n            setSelectionPos(selection.second, pos);\r\n            if (selectionIsSane()) {\r\n                plot.isSelecting = true;\r\n                selection.show = true;\r\n                plot.triggerRedrawOverlay();\r\n            }\r\n            else\r\n                clearSelection(true);\r\n        }\r\n\r\n        function clearSelection(preventEvent) {\r\n            if (selection.show) {\r\n                selection.show = false;\r\n                plot.triggerRedrawOverlay();\r\n                if (!preventEvent)\r\n                    plot.getPlaceholder().trigger(\"plotunselected\", [ ]);\r\n            }\r\n        }\r\n\r\n        // function taken from markings support in Flot\r\n        function extractRange(ranges, coord) {\r\n            var axis, from, to, key, axes = plot.getAxes();\r\n\r\n            for (var k in axes) {\r\n                axis = axes[k];\r\n                if (axis.direction == coord) {\r\n                    key = coord + axis.n + \"axis\";\r\n                    if (!ranges[key] && axis.n == 1)\r\n                        key = coord + \"axis\"; // support x1axis as xaxis\r\n                    if (ranges[key]) {\r\n                        from = ranges[key].from;\r\n                        to = ranges[key].to;\r\n                        break;\r\n                    }\r\n                }\r\n            }\r\n\r\n            // backwards-compat stuff - to be removed in future\r\n            if (!ranges[key]) {\r\n                axis = coord == \"x\" ? plot.getXAxes()[0] : plot.getYAxes()[0];\r\n                from = ranges[coord + \"1\"];\r\n                to = ranges[coord + \"2\"];\r\n            }\r\n\r\n            // auto-reverse as an added bonus\r\n            if (from != null && to != null && from > to) {\r\n                var tmp = from;\r\n                from = to;\r\n                to = tmp;\r\n            }\r\n\r\n            return { from: from, to: to, axis: axis };\r\n        }\r\n\r\n        function setSelection(ranges, preventEvent) {\r\n            var axis, range, o = plot.getOptions();\r\n\r\n            if (o.selection.mode == \"y\") {\r\n                selection.first.x = 0;\r\n                selection.second.x = plot.width();\r\n            }\r\n            else {\r\n                range = extractRange(ranges, \"x\");\r\n\r\n                selection.first.x = range.axis.p2c(range.from);\r\n                selection.second.x = range.axis.p2c(range.to);\r\n            }\r\n\r\n            if (o.selection.mode == \"x\") {\r\n                selection.first.y = 0;\r\n                selection.second.y = plot.height();\r\n            }\r\n            else {\r\n                range = extractRange(ranges, \"y\");\r\n\r\n                selection.first.y = range.axis.p2c(range.from);\r\n                selection.second.y = range.axis.p2c(range.to);\r\n            }\r\n\r\n            selection.show = true;\r\n            plot.triggerRedrawOverlay();\r\n            if (!preventEvent && selectionIsSane())\r\n                triggerSelectedEvent();\r\n        }\r\n\r\n        function selectionIsSane() {\r\n            var minSize = plot.getOptions().selection.minSize;\r\n            return Math.abs(selection.second.x - selection.first.x) >= minSize &&\r\n                Math.abs(selection.second.y - selection.first.y) >= minSize;\r\n        }\r\n\r\n        plot.clearSelection = clearSelection;\r\n        plot.setSelection = setSelection;\r\n        plot.getSelection = getSelection;\r\n\r\n        plot.hooks.bindEvents.push(function(plot, eventHolder) {\r\n            var o = plot.getOptions();\r\n            if (o.selection.mode != null) {\r\n                eventHolder.mousemove(onMouseMove);\r\n                eventHolder.mousedown(onMouseDown);\r\n            }\r\n        });\r\n\r\n        plot.hooks.drawOverlay.push(function (plot, ctx) {\r\n            // draw selection\r\n            if (selection.show && selectionIsSane()) {\r\n                var plotOffset = plot.getPlotOffset();\r\n                var o = plot.getOptions();\r\n\r\n                ctx.save();\r\n                ctx.translate(plotOffset.left, plotOffset.top);\r\n\r\n                var c = $.color.parse(o.selection.color);\r\n\r\n                ctx.strokeStyle = c.scale('a', 0.8).toString();\r\n                ctx.lineWidth = 1;\r\n                ctx.lineJoin = o.selection.shape;\r\n                ctx.fillStyle = c.scale('a', 0.4).toString();\r\n\r\n                var x = Math.min(selection.first.x, selection.second.x) + 0.5,\r\n                    y = Math.min(selection.first.y, selection.second.y) + 0.5,\r\n                    w = Math.abs(selection.second.x - selection.first.x) - 1,\r\n                    h = Math.abs(selection.second.y - selection.first.y) - 1;\r\n\r\n                ctx.fillRect(x, y, w, h);\r\n                ctx.strokeRect(x, y, w, h);\r\n\r\n                ctx.restore();\r\n            }\r\n        });\r\n\r\n        plot.hooks.shutdown.push(function (plot, eventHolder) {\r\n            eventHolder.unbind(\"mousemove\", onMouseMove);\r\n            eventHolder.unbind(\"mousedown\", onMouseDown);\r\n\r\n            if (mouseUpHandler) {\r\n                $(document).unbind(\"mouseup\", mouseUpHandler);\r\n                // grafana addition\r\n                // In L114 this plugin is overrinding document.onselectstart handler to prevent default or custom behaviour\r\n                // Then this patch is being restored during mouseup event. But, mouseup handler is unbound when this plugin is destroyed\r\n                // and the overriden onselectstart handler is not restored.  The problematic behaviour surfaces when flot is re-rendered\r\n                // as a consequence of panel's model update. When i.e. options are applied via onBlur\r\n                // event on some input which results in flot re-render. The mouseup handler should be called to resture the original handlers\r\n                //  but by the time the document mouseup event occurs, the event handler is no longer there, so onselectstart is permanently overriden.\r\n                // To fix that we are making sure that the overrides are reverted when this plugin is destroyed, the same way as they would\r\n                // via mouseup event handler (L138)\r\n\r\n                if (document.onselectstart !== undefined)\r\n                    document.onselectstart = savedhandlers.onselectstart;\r\n                if (document.ondrag !== undefined)\r\n                    document.ondrag = savedhandlers.ondrag;\r\n            }\r\n        });\r\n\r\n    }\r\n\r\n    $.plot.plugins.push({\r\n        init: init,\r\n        options: {\r\n            selection: {\r\n                mode: null, // one of null, \"x\", \"y\" or \"xy\"\r\n                color: \"#e8cfac\",\r\n                shape: \"round\", // one of \"round\", \"miter\", or \"bevel\"\r\n                minSize: 5 // minimum number of pixels\r\n            }\r\n        },\r\n        name: 'selection',\r\n        version: '1.1'\r\n    });\r\n})(jQuery);\r\n","/* Flot plugin for stacking data sets rather than overlyaing them.\r\n\r\nCopyright (c) 2007-2014 IOLA and Ole Laursen.\r\nLicensed under the MIT license.\r\n\r\nThe plugin assumes the data is sorted on x (or y if stacking horizontally).\r\nFor line charts, it is assumed that if a line has an undefined gap (from a\r\nnull point), then the line above it should have the same gap - insert zeros\r\ninstead of \"null\" if you want another behaviour. This also holds for the start\r\nand end of the chart. Note that stacking a mix of positive and negative values\r\nin most instances doesn't make sense (so it looks weird).\r\n\r\nTwo or more series are stacked when their \"stack\" attribute is set to the same\r\nkey (which can be any number or string or just \"true\"). To specify the default\r\nstack, you can set the stack option like this:\r\n\r\n    series: {\r\n        stack: null/false, true, or a key (number/string)\r\n    }\r\n\r\nYou can also specify it for a single series, like this:\r\n\r\n    $.plot( $(\"#placeholder\"), [{\r\n        data: [ ... ],\r\n        stack: true\r\n    }])\r\n\r\nThe stacking order is determined by the order of the data series in the array\r\n(later series end up on top of the previous).\r\n\r\nInternally, the plugin modifies the datapoints in each series, adding an\r\noffset to the y value. For line series, extra data points are inserted through\r\ninterpolation. If there's a second y value, it's also adjusted (e.g for bar\r\ncharts or filled areas).\r\n\r\n*/\r\n\r\n(function ($) {\r\n    var options = {\r\n        series: { stack: null } // or number/string\r\n    };\r\n\r\n    function init(plot) {\r\n        function findMatchingSeries(s, allseries) {\r\n            var res = null;\r\n            for (var i = 0; i < allseries.length; ++i) {\r\n                if (s == allseries[i])\r\n                    break;\r\n\r\n                if (allseries[i].stack == s.stack)\r\n                    res = allseries[i];\r\n            }\r\n\r\n            return res;\r\n        }\r\n\r\n        function stackData(plot, s, datapoints) {\r\n            if (s.stack == null || s.stack === false)\r\n                return;\r\n\r\n            var other = findMatchingSeries(s, plot.getData());\r\n            if (!other)\r\n                return;\r\n\r\n            var ps = datapoints.pointsize,\r\n                points = datapoints.points,\r\n                otherps = other.datapoints.pointsize,\r\n                otherpoints = other.datapoints.points,\r\n                newpoints = [],\r\n                px, py, intery, qx, qy, bottom,\r\n                withlines = s.lines.show,\r\n                horizontal = s.bars.horizontal,\r\n                withbottom = ps > 2 && (horizontal ? datapoints.format[2].x : datapoints.format[2].y),\r\n                withsteps = withlines && s.lines.steps,\r\n                keyOffset = horizontal ? 1 : 0,\r\n                accumulateOffset = horizontal ? 0 : 1,\r\n                i = 0, j = 0, l, m;\r\n\r\n            while (true) {\r\n                if (i >= points.length && j >= otherpoints.length)\r\n                    break;\r\n\r\n                l = newpoints.length;\r\n\r\n                if (i < points.length && points[i] == null) {\r\n                    // copy gaps\r\n                    for (m = 0; m < ps; ++m)\r\n                        newpoints.push(points[i + m]);\r\n                    i += ps;\r\n                }\r\n                else if (i >= points.length) {\r\n                    // take the remaining points from the previous series\r\n                    for (m = 0; m < ps; ++m)\r\n                        newpoints.push(otherpoints[j + m]);\r\n                    if (withbottom)\r\n                        newpoints[l + 2] = otherpoints[j + accumulateOffset];\r\n                    j += otherps;\r\n                }\r\n                else if (j >= otherpoints.length) {\r\n                    // take the remaining points from the current series\r\n                    for (m = 0; m < ps; ++m)\r\n                        newpoints.push(points[i + m]);\r\n                    i += ps;\r\n                }\r\n                else if (j < otherpoints.length && otherpoints[j] == null) {\r\n                    // ignore point\r\n                    j += otherps;\r\n                }\r\n                else {\r\n                    // cases where we actually got two points\r\n                    px = points[i + keyOffset];\r\n                    py = points[i + accumulateOffset];\r\n                    qx = otherpoints[j + keyOffset];\r\n                    qy = otherpoints[j + accumulateOffset];\r\n                    bottom = 0;\r\n\r\n                    if (px == qx) {\r\n                        for (m = 0; m < ps; ++m)\r\n                            newpoints.push(points[i + m]);\r\n\r\n                        newpoints[l + accumulateOffset] += qy;\r\n                        bottom = qy;\r\n\r\n                        i += ps;\r\n                        j += otherps;\r\n                    }\r\n                    else if (px > qx) {\r\n                        // take the point from the previous series so that next series will correctly stack\r\n                        if (i == 0) {\r\n                            for (m = 0; m < ps; ++m)\r\n                                newpoints.push(otherpoints[j + m]);\r\n                            bottom = qy;\r\n                        }\r\n                        // we got past point below, might need to\r\n                        // insert interpolated extra point\r\n                        if (i > 0 && points[i - ps] != null) {\r\n                            intery = py + (points[i - ps + accumulateOffset] - py) * (qx - px) / (points[i - ps + keyOffset] - px);\r\n                            newpoints.push(qx);\r\n                            newpoints.push(intery + qy);\r\n                            for (m = 2; m < ps; ++m)\r\n                                newpoints.push(points[i + m]);\r\n                            bottom = qy;\r\n                        }\r\n\r\n                        j += otherps;\r\n                    }\r\n                    else { // px < qx\r\n                        for (m = 0; m < ps; ++m)\r\n                            newpoints.push(points[i + m]);\r\n\r\n                        // we might be able to interpolate a point below,\r\n                        // this can give us a better y\r\n                        if (j > 0 && otherpoints[j - otherps] != null)\r\n                            bottom = qy + (otherpoints[j - otherps + accumulateOffset] - qy) * (px - qx) / (otherpoints[j - otherps + keyOffset] - qx);\r\n\r\n                        newpoints[l + accumulateOffset] += bottom;\r\n\r\n                        i += ps;\r\n                    }\r\n\r\n                    fromgap = false;\r\n\r\n                    if (l != newpoints.length && withbottom)\r\n                        newpoints[l + 2] = bottom;\r\n                }\r\n\r\n                // maintain the line steps invariant\r\n                if (withsteps && l != newpoints.length && l > 0\r\n                    && newpoints[l] != null\r\n                    && newpoints[l] != newpoints[l - ps]\r\n                    && newpoints[l + 1] != newpoints[l - ps + 1]) {\r\n                    for (m = 0; m < ps; ++m)\r\n                        newpoints[l + ps + m] = newpoints[l + m];\r\n                    newpoints[l + 1] = newpoints[l - ps + 1];\r\n                }\r\n            }\r\n\r\n            datapoints.points = newpoints;\r\n        }\r\n\r\n        plot.hooks.processDatapoints.push(stackData);\r\n    }\r\n\r\n    $.plot.plugins.push({\r\n        init: init,\r\n        options: options,\r\n        name: 'stack',\r\n        version: '1.2'\r\n    });\r\n})(jQuery);\r\n","(function ($) {\n    var options = {\n        series: {\n            stackpercent: null\n        } // or number/string\n    };\n\n    function init(plot) {\n\n        // will be built up dynamically as a hash from x-value, or y-value if horizontal\n        var stackBases = {};\n        var processed = false;\n        var stackSums = {};\n\n        //set percentage for stacked chart\n        function processRawData(plot, series, data, datapoints) {\n            if (!processed) {\n                processed = true;\n                stackSums = getStackSums(plot.getData());\n            }\n\t\t\tif (series.stackpercent == true) {\n\t\t\t\tvar num = data.length;\n\t\t\t\tseries.percents = [];\n\t\t\t\tvar key_idx = 0;\n\t\t\t\tvar value_idx = 1;\n\t\t\t\tif (series.bars && series.bars.horizontal && series.bars.horizontal === true) {\n\t\t\t\t\tkey_idx = 1;\n\t\t\t\t\tvalue_idx = 0;\n\t\t\t\t}\n\t\t\t\tfor (var j = 0; j < num; j++) {\n\t\t\t\t\tvar sum = stackSums[data[j][key_idx] + \"\"];\n\t\t\t\t\tif (sum > 0) {\n\t\t\t\t\t\tseries.percents.push(data[j][value_idx] * 100 / sum);\n\t\t\t\t\t} else {\n\t\t\t\t\t\tseries.percents.push(0);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n        }\n\n        //calculate summary\n        function getStackSums(_data) {\n            var data_len = _data.length;\n            var sums = {};\n            if (data_len > 0) {\n                //caculate summary\n                for (var i = 0; i < data_len; i++) {\n                    if (_data[i].stackpercent) {\n\t\t\t\t\t\tvar key_idx = 0;\n\t\t\t\t\t\tvar value_idx = 1;\n\t\t\t\t\t\tif (_data[i].bars && _data[i].bars.horizontal && _data[i].bars.horizontal === true) {\n\t\t\t\t\t\t\tkey_idx = 1;\n\t\t\t\t\t\t\tvalue_idx = 0;\n\t\t\t\t\t\t}\n                        var num = _data[i].data.length;\n                        for (var j = 0; j < num; j++) {\n                            var value = 0;\n                            if (_data[i].data[j][1] != null) {\n                                value = _data[i].data[j][value_idx];\n                            }\n                            if (sums[_data[i].data[j][key_idx] + \"\"]) {\n                                sums[_data[i].data[j][key_idx] + \"\"] += value;\n                            } else {\n                                sums[_data[i].data[j][key_idx] + \"\"] = value;\n                            }\n\n                        }\n                    }\n                }\n            }\n            return sums;\n        }\n\n        function stackData(plot, s, datapoints) {\n            if (!s.stackpercent) return;\n            if (!processed) {\n                stackSums = getStackSums(plot.getData());\n            }\n            var newPoints = [];\n\n\n\t\t\tvar key_idx = 0;\n\t\t\tvar value_idx = 1;\n\t\t\tif (s.bars && s.bars.horizontal && s.bars.horizontal === true) {\n\t\t\t\tkey_idx = 1;\n\t\t\t\tvalue_idx = 0;\n\t\t\t}\n\n\t\t\tfor (var i = 0; i < datapoints.points.length; i += 3) {\n\t\t\t\t// note that the values need to be turned into absolute y-values.\n\t\t\t\t// in other words, if you were to stack (x, y1), (x, y2), and (x, y3),\n\t\t\t\t// (each from different series, which is where stackBases comes in),\n\t\t\t\t// you'd want the new points to be (x, y1, 0), (x, y1+y2, y1), (x, y1+y2+y3, y1+y2)\n\t\t\t\t// generally, (x, thisValue + (base up to this point), + (base up to this point))\n\t\t\t\tif (!stackBases[datapoints.points[i + key_idx]]) {\n\t\t\t\t\tstackBases[datapoints.points[i + key_idx]] = 0;\n\t\t\t\t}\n\t\t\t\tnewPoints[i + key_idx] = datapoints.points[i + key_idx];\n\t\t\t\tnewPoints[i + value_idx] = datapoints.points[i + value_idx] + stackBases[datapoints.points[i + key_idx]];\n\t\t\t\tnewPoints[i + 2] = stackBases[datapoints.points[i + key_idx]];\n\t\t\t\tstackBases[datapoints.points[i + key_idx]] += datapoints.points[i + value_idx];\n\t\t\t\t// change points to percentage values\n\t\t\t\t// you may need to set yaxis:{ max = 100 }\n\t\t\t\tif ( stackSums[newPoints[i+key_idx]+\"\"] > 0 ){\n\t\t\t\t\tnewPoints[i + value_idx] = newPoints[i + value_idx] * 100 / stackSums[newPoints[i + key_idx] + \"\"];\n\t\t\t\t\tnewPoints[i + 2] = newPoints[i + 2] * 100 / stackSums[newPoints[i + key_idx] + \"\"];\n\t\t\t\t} else {\n\t\t\t\t\tnewPoints[i + value_idx] = 0;\n\t\t\t\t\tnewPoints[i + 2] = 0;\n\t\t\t\t}\n\t\t\t}\n\n            datapoints.points = newPoints;\n        }\n\n\t\tplot.hooks.processRawData.push(processRawData);\n        plot.hooks.processDatapoints.push(stackData);\n    }\n\n    $.plot.plugins.push({\n        init: init,\n        options: options,\n        name: 'stackpercent',\n        version: '0.1'\n    });\n})(jQuery);\n","/* Pretty handling of time axes.\n\nCopyright (c) 2007-2013 IOLA and Ole Laursen.\nLicensed under the MIT license.\n\nSet axis.mode to \"time\" to enable. See the section \"Time series data\" in\nAPI.txt for details.\n\n*/\n\n(function($) {\n\n\tvar options = {\n\t\txaxis: {\n\t\t\ttimezone: null,\t\t// \"browser\" for local to the client or timezone for timezone-js\n\t\t\ttimeformat: null,\t// format string to use\n\t\t\ttwelveHourClock: false,\t// 12 or 24 time in time mode\n\t\t\tmonthNames: null\t// list of names of months\n\t\t}\n\t};\n\n\t// round to nearby lower multiple of base\n\n\tfunction floorInBase(n, base) {\n\t\treturn base * Math.floor(n / base);\n\t}\n\n\t// Returns a string with the date d formatted according to fmt.\n\t// A subset of the Open Group's strftime format is supported.\n\n\tfunction formatDate(d, fmt, monthNames, dayNames) {\n\n\t\tif (typeof d.strftime == \"function\") {\n\t\t\treturn d.strftime(fmt);\n\t\t}\n\n\t\tvar leftPad = function(n, pad) {\n\t\t\tn = \"\" + n;\n\t\t\tpad = \"\" + (pad == null ? \"0\" : pad);\n\t\t\treturn n.length == 1 ? pad + n : n;\n\t\t};\n\n\t\tvar r = [];\n\t\tvar escape = false;\n\t\tvar hours = d.getHours();\n\t\tvar isAM = hours < 12;\n\n\t\tif (monthNames == null) {\n\t\t\tmonthNames = [\"Jan\", \"Feb\", \"Mar\", \"Apr\", \"May\", \"Jun\", \"Jul\", \"Aug\", \"Sep\", \"Oct\", \"Nov\", \"Dec\"];\n\t\t}\n\n\t\tif (dayNames == null) {\n\t\t\tdayNames = [\"Sun\", \"Mon\", \"Tue\", \"Wed\", \"Thu\", \"Fri\", \"Sat\"];\n\t\t}\n\n\t\tvar hours12;\n\n\t\tif (hours > 12) {\n\t\t\thours12 = hours - 12;\n\t\t} else if (hours == 0) {\n\t\t\thours12 = 12;\n\t\t} else {\n\t\t\thours12 = hours;\n\t\t}\n\n\t\tfor (var i = 0; i < fmt.length; ++i) {\n\n\t\t\tvar c = fmt.charAt(i);\n\n\t\t\tif (escape) {\n\t\t\t\tswitch (c) {\n\t\t\t\t\tcase 'a': c = \"\" + dayNames[d.getDay()]; break;\n\t\t\t\t\tcase 'b': c = \"\" + monthNames[d.getMonth()]; break;\n\t\t\t\t\tcase 'd': c = leftPad(d.getDate(), \"\"); break;\n\t\t\t\t\tcase 'e': c = leftPad(d.getDate(), \" \"); break;\n\t\t\t\t\tcase 'h':\t// For back-compat with 0.7; remove in 1.0\n\t\t\t\t\tcase 'H': c = leftPad(hours); break;\n\t\t\t\t\tcase 'I': c = leftPad(hours12); break;\n\t\t\t\t\tcase 'l': c = leftPad(hours12, \" \"); break;\n\t\t\t\t\tcase 'm': c = leftPad(d.getMonth() + 1, \"\"); break;\n\t\t\t\t\tcase 'M': c = leftPad(d.getMinutes()); break;\n\t\t\t\t\t// quarters not in Open Group's strftime specification\n\t\t\t\t\tcase 'q':\n\t\t\t\t\t\tc = \"\" + (Math.floor(d.getMonth() / 3) + 1); break;\n\t\t\t\t\tcase 'S': c = leftPad(d.getSeconds()); break;\n\t\t\t\t\tcase 'y': c = leftPad(d.getFullYear() % 100); break;\n\t\t\t\t\tcase 'Y': c = \"\" + d.getFullYear(); break;\n\t\t\t\t\tcase 'p': c = (isAM) ? (\"\" + \"am\") : (\"\" + \"pm\"); break;\n\t\t\t\t\tcase 'P': c = (isAM) ? (\"\" + \"AM\") : (\"\" + \"PM\"); break;\n\t\t\t\t\tcase 'w': c = \"\" + d.getDay(); break;\n\t\t\t\t}\n\t\t\t\tr.push(c);\n\t\t\t\tescape = false;\n\t\t\t} else {\n\t\t\t\tif (c == \"%\") {\n\t\t\t\t\tescape = true;\n\t\t\t\t} else {\n\t\t\t\t\tr.push(c);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\treturn r.join(\"\");\n\t}\n\n\t// To have a consistent view of time-based data independent of which time\n\t// zone the client happens to be in we need a date-like object independent\n\t// of time zones.  This is done through a wrapper that only calls the UTC\n\t// versions of the accessor methods.\n\n\tfunction makeUtcWrapper(d) {\n\n\t\tfunction addProxyMethod(sourceObj, sourceMethod, targetObj, targetMethod) {\n\t\t\tsourceObj[sourceMethod] = function() {\n\t\t\t\treturn targetObj[targetMethod].apply(targetObj, arguments);\n\t\t\t};\n\t\t};\n\n\t\tvar utc = {\n\t\t\tdate: d\n\t\t};\n\n\t\t// support strftime, if found\n\n\t\tif (d.strftime != undefined) {\n\t\t\taddProxyMethod(utc, \"strftime\", d, \"strftime\");\n\t\t}\n\n\t\taddProxyMethod(utc, \"getTime\", d, \"getTime\");\n\t\taddProxyMethod(utc, \"setTime\", d, \"setTime\");\n\n\t\tvar props = [\"Date\", \"Day\", \"FullYear\", \"Hours\", \"Milliseconds\", \"Minutes\", \"Month\", \"Seconds\"];\n\n\t\tfor (var p = 0; p < props.length; p++) {\n\t\t\taddProxyMethod(utc, \"get\" + props[p], d, \"getUTC\" + props[p]);\n\t\t\taddProxyMethod(utc, \"set\" + props[p], d, \"setUTC\" + props[p]);\n\t\t}\n\n\t\treturn utc;\n\t};\n\n\t// select time zone strategy.  This returns a date-like object tied to the\n\t// desired timezone\n\n\tfunction dateGenerator(ts, opts) {\n\t\tif (opts.timezone == \"browser\") {\n\t\t\treturn new Date(ts);\n\t\t} else if (!opts.timezone || opts.timezone == \"utc\") {\n\t\t\treturn makeUtcWrapper(new Date(ts));\n\t\t} else if (typeof timezoneJS != \"undefined\" && typeof timezoneJS.Date != \"undefined\") {\n\t\t\tvar d = new timezoneJS.Date();\n\t\t\t// timezone-js is fickle, so be sure to set the time zone before\n\t\t\t// setting the time.\n\t\t\td.setTimezone(opts.timezone);\n\t\t\td.setTime(ts);\n\t\t\treturn d;\n\t\t} else {\n\t\t\treturn makeUtcWrapper(new Date(ts));\n\t\t}\n\t}\n\n\t// map of app. size of time units in milliseconds\n\n\tvar timeUnitSize = {\n\t\t\"second\": 1000,\n\t\t\"minute\": 60 * 1000,\n\t\t\"hour\": 60 * 60 * 1000,\n\t\t\"day\": 24 * 60 * 60 * 1000,\n\t\t\"month\": 30 * 24 * 60 * 60 * 1000,\n\t\t\"quarter\": 3 * 30 * 24 * 60 * 60 * 1000,\n\t\t\"year\": 365.2425 * 24 * 60 * 60 * 1000\n\t};\n\n\t// the allowed tick sizes, after 1 year we use\n\t// an integer algorithm\n\n\tvar baseSpec = [\n\t\t[1, \"second\"], [2, \"second\"], [5, \"second\"], [10, \"second\"],\n\t\t[30, \"second\"],\n\t\t[1, \"minute\"], [2, \"minute\"], [5, \"minute\"], [10, \"minute\"],\n\t\t[30, \"minute\"],\n\t\t[1, \"hour\"], [2, \"hour\"], [4, \"hour\"],\n\t\t[8, \"hour\"], [12, \"hour\"],\n\t\t[1, \"day\"], [2, \"day\"], [3, \"day\"],\n\t\t[0.25, \"month\"], [0.5, \"month\"], [1, \"month\"],\n\t\t[2, \"month\"]\n\t];\n\n\t// we don't know which variant(s) we'll need yet, but generating both is\n\t// cheap\n\n\tvar specMonths = baseSpec.concat([[3, \"month\"], [6, \"month\"],\n\t\t[1, \"year\"]]);\n\tvar specQuarters = baseSpec.concat([[1, \"quarter\"], [2, \"quarter\"],\n\t\t[1, \"year\"]]);\n\n\tfunction init(plot) {\n\t\tplot.hooks.processOptions.push(function (plot, options) {\n\t\t\t$.each(plot.getAxes(), function(axisName, axis) {\n\n\t\t\t\tvar opts = axis.options;\n\n\t\t\t\tif (opts.mode == \"time\") {\n\t\t\t\t\taxis.tickGenerator = function(axis) {\n\n\t\t\t\t\t\tvar ticks = [];\n\t\t\t\t\t\tvar d = dateGenerator(axis.min, opts);\n\t\t\t\t\t\tvar minSize = 0;\n\n\t\t\t\t\t\t// make quarter use a possibility if quarters are\n\t\t\t\t\t\t// mentioned in either of these options\n\n\t\t\t\t\t\tvar spec = (opts.tickSize && opts.tickSize[1] ===\n\t\t\t\t\t\t\t\"quarter\") ||\n\t\t\t\t\t\t\t(opts.minTickSize && opts.minTickSize[1] ===\n\t\t\t\t\t\t\t\"quarter\") ? specQuarters : specMonths;\n\n\t\t\t\t\t\tif (opts.minTickSize != null) {\n\t\t\t\t\t\t\tif (typeof opts.tickSize == \"number\") {\n\t\t\t\t\t\t\t\tminSize = opts.tickSize;\n\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\tminSize = opts.minTickSize[0] * timeUnitSize[opts.minTickSize[1]];\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tfor (var i = 0; i < spec.length - 1; ++i) {\n\t\t\t\t\t\t\tif (axis.delta < (spec[i][0] * timeUnitSize[spec[i][1]]\n\t\t\t\t\t\t\t\t\t\t\t  + spec[i + 1][0] * timeUnitSize[spec[i + 1][1]]) / 2\n\t\t\t\t\t\t\t\t&& spec[i][0] * timeUnitSize[spec[i][1]] >= minSize) {\n\t\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tvar size = spec[i][0];\n\t\t\t\t\t\tvar unit = spec[i][1];\n\n\t\t\t\t\t\t// special-case the possibility of several years\n\n\t\t\t\t\t\tif (unit == \"year\") {\n\n\t\t\t\t\t\t\t// if given a minTickSize in years, just use it,\n\t\t\t\t\t\t\t// ensuring that it's an integer\n\n\t\t\t\t\t\t\tif (opts.minTickSize != null && opts.minTickSize[1] == \"year\") {\n\t\t\t\t\t\t\t\tsize = Math.floor(opts.minTickSize[0]);\n\t\t\t\t\t\t\t} else {\n\n\t\t\t\t\t\t\t\tvar magn = Math.pow(10, Math.floor(Math.log(axis.delta / timeUnitSize.year) / Math.LN10));\n\t\t\t\t\t\t\t\tvar norm = (axis.delta / timeUnitSize.year) / magn;\n\n\t\t\t\t\t\t\t\tif (norm < 1.5) {\n\t\t\t\t\t\t\t\t\tsize = 1;\n\t\t\t\t\t\t\t\t} else if (norm < 3) {\n\t\t\t\t\t\t\t\t\tsize = 2;\n\t\t\t\t\t\t\t\t} else if (norm < 7.5) {\n\t\t\t\t\t\t\t\t\tsize = 5;\n\t\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t\tsize = 10;\n\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\tsize *= magn;\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t// minimum size for years is 1\n\n\t\t\t\t\t\t\tif (size < 1) {\n\t\t\t\t\t\t\t\tsize = 1;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\taxis.tickSize = opts.tickSize || [size, unit];\n\t\t\t\t\t\tvar tickSize = axis.tickSize[0];\n\t\t\t\t\t\tunit = axis.tickSize[1];\n\n\t\t\t\t\t\tvar step = tickSize * timeUnitSize[unit];\n\n\t\t\t\t\t\tif (unit == \"second\") {\n\t\t\t\t\t\t\td.setSeconds(floorInBase(d.getSeconds(), tickSize));\n\t\t\t\t\t\t} else if (unit == \"minute\") {\n\t\t\t\t\t\t\td.setMinutes(floorInBase(d.getMinutes(), tickSize));\n\t\t\t\t\t\t} else if (unit == \"hour\") {\n\t\t\t\t\t\t\td.setHours(floorInBase(d.getHours(), tickSize));\n\t\t\t\t\t\t} else if (unit == \"month\") {\n\t\t\t\t\t\t\td.setMonth(floorInBase(d.getMonth(), tickSize));\n\t\t\t\t\t\t} else if (unit == \"quarter\") {\n\t\t\t\t\t\t\td.setMonth(3 * floorInBase(d.getMonth() / 3,\n\t\t\t\t\t\t\t\ttickSize));\n\t\t\t\t\t\t} else if (unit == \"year\") {\n\t\t\t\t\t\t\td.setFullYear(floorInBase(d.getFullYear(), tickSize));\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\t// reset smaller components\n\n\t\t\t\t\t\td.setMilliseconds(0);\n\n\t\t\t\t\t\tif (step >= timeUnitSize.minute) {\n\t\t\t\t\t\t\td.setSeconds(0);\n\t\t\t\t\t\t}\n\t\t\t\t\t\tif (step >= timeUnitSize.hour) {\n\t\t\t\t\t\t\td.setMinutes(0);\n\t\t\t\t\t\t}\n\t\t\t\t\t\tif (step >= timeUnitSize.day) {\n\t\t\t\t\t\t\td.setHours(0);\n\t\t\t\t\t\t}\n\t\t\t\t\t\tif (step >= timeUnitSize.day * 4) {\n\t\t\t\t\t\t\td.setDate(1);\n\t\t\t\t\t\t}\n\t\t\t\t\t\tif (step >= timeUnitSize.month * 2) {\n\t\t\t\t\t\t\td.setMonth(floorInBase(d.getMonth(), 3));\n\t\t\t\t\t\t}\n\t\t\t\t\t\tif (step >= timeUnitSize.quarter * 2) {\n\t\t\t\t\t\t\td.setMonth(floorInBase(d.getMonth(), 6));\n\t\t\t\t\t\t}\n\t\t\t\t\t\tif (step >= timeUnitSize.year) {\n\t\t\t\t\t\t\td.setMonth(0);\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tvar carry = 0;\n\t\t\t\t\t\tvar v = Number.NaN;\n\t\t\t\t\t\tvar prev;\n\n\t\t\t\t\t\tdo {\n\n\t\t\t\t\t\t\tprev = v;\n\t\t\t\t\t\t\tv = d.getTime();\n\t\t\t\t\t\t\tticks.push(v);\n\n\t\t\t\t\t\t\tif (unit == \"month\" || unit == \"quarter\") {\n\t\t\t\t\t\t\t\tif (tickSize < 1) {\n\n\t\t\t\t\t\t\t\t\t// a bit complicated - we'll divide the\n\t\t\t\t\t\t\t\t\t// month/quarter up but we need to take\n\t\t\t\t\t\t\t\t\t// care of fractions so we don't end up in\n\t\t\t\t\t\t\t\t\t// the middle of a day\n\n\t\t\t\t\t\t\t\t\td.setDate(1);\n\t\t\t\t\t\t\t\t\tvar start = d.getTime();\n\t\t\t\t\t\t\t\t\td.setMonth(d.getMonth() +\n\t\t\t\t\t\t\t\t\t\t(unit == \"quarter\" ? 3 : 1));\n\t\t\t\t\t\t\t\t\tvar end = d.getTime();\n\t\t\t\t\t\t\t\t\td.setTime(v + carry * timeUnitSize.hour + (end - start) * tickSize);\n\t\t\t\t\t\t\t\t\tcarry = d.getHours();\n\t\t\t\t\t\t\t\t\td.setHours(0);\n\t\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t\td.setMonth(d.getMonth() +\n\t\t\t\t\t\t\t\t\t\ttickSize * (unit == \"quarter\" ? 3 : 1));\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t} else if (unit == \"year\") {\n\t\t\t\t\t\t\t\td.setFullYear(d.getFullYear() + tickSize);\n\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\td.setTime(v + step);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t} while (v < axis.max && v != prev);\n\n\t\t\t\t\t\treturn ticks;\n\t\t\t\t\t};\n\n\t\t\t\t\taxis.tickFormatter = function (v, axis) {\n\n\t\t\t\t\t\tvar d = dateGenerator(v, axis.options);\n\n\t\t\t\t\t\t// first check global format\n\n\t\t\t\t\t\tif (opts.timeformat != null) {\n\t\t\t\t\t\t\treturn formatDate(d, opts.timeformat, opts.monthNames, opts.dayNames);\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\t// possibly use quarters if quarters are mentioned in\n\t\t\t\t\t\t// any of these places\n\n\t\t\t\t\t\tvar useQuarters = (axis.options.tickSize &&\n\t\t\t\t\t\t\t\taxis.options.tickSize[1] == \"quarter\") ||\n\t\t\t\t\t\t\t(axis.options.minTickSize &&\n\t\t\t\t\t\t\t\taxis.options.minTickSize[1] == \"quarter\");\n\n\t\t\t\t\t\tvar t = axis.tickSize[0] * timeUnitSize[axis.tickSize[1]];\n\t\t\t\t\t\tvar span = axis.max - axis.min;\n\t\t\t\t\t\tvar suffix = (opts.twelveHourClock) ? \" %p\" : \"\";\n\t\t\t\t\t\tvar hourCode = (opts.twelveHourClock) ? \"%I\" : \"%H\";\n\t\t\t\t\t\tvar fmt;\n\n\t\t\t\t\t\tif (t < timeUnitSize.minute) {\n\t\t\t\t\t\t\tfmt = hourCode + \":%M:%S\" + suffix;\n\t\t\t\t\t\t} else if (t < timeUnitSize.day) {\n\t\t\t\t\t\t\tif (span < 2 * timeUnitSize.day) {\n\t\t\t\t\t\t\t\tfmt = hourCode + \":%M\" + suffix;\n\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\tfmt = \"%b %d \" + hourCode + \":%M\" + suffix;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t} else if (t < timeUnitSize.month) {\n\t\t\t\t\t\t\tfmt = \"%b %d\";\n\t\t\t\t\t\t} else if ((useQuarters && t < timeUnitSize.quarter) ||\n\t\t\t\t\t\t\t(!useQuarters && t < timeUnitSize.year)) {\n\t\t\t\t\t\t\tif (span < timeUnitSize.year) {\n\t\t\t\t\t\t\t\tfmt = \"%b\";\n\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\tfmt = \"%b %Y\";\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t} else if (useQuarters && t < timeUnitSize.year) {\n\t\t\t\t\t\t\tif (span < timeUnitSize.year) {\n\t\t\t\t\t\t\t\tfmt = \"Q%q\";\n\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\tfmt = \"Q%q %Y\";\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tfmt = \"%Y\";\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tvar rt = formatDate(d, fmt, opts.monthNames, opts.dayNames);\n\n\t\t\t\t\t\treturn rt;\n\t\t\t\t\t};\n\t\t\t\t}\n\t\t\t});\n\t\t});\n\t}\n\n\t$.plot.plugins.push({\n\t\tinit: init,\n\t\toptions: options,\n\t\tname: 'time',\n\t\tversion: '1.0'\n\t});\n\n\t// Time-axis support used to be in Flot core, which exposed the\n\t// formatDate function on the plot object.  Various plugins depend\n\t// on the function, so we need to re-expose it here.\n\n\t$.plot.formatDate = formatDate;\n\n})(jQuery);\n","(function ($) {\r\n  \"use strict\";\r\n\r\n  var defaultOptions = {\r\n    tagClass: function(item) {\r\n      return 'label label-info';\r\n    },\r\n    itemValue: function(item) {\r\n      return item ? item.toString() : item;\r\n    },\r\n    itemText: function(item) {\r\n      return this.itemValue(item);\r\n    },\r\n    freeInput: true,\r\n    maxTags: undefined,\r\n    confirmKeys: [13],\r\n    onTagExists: function(item, $tag) {\r\n      $tag.hide().fadeIn();\r\n    }\r\n  };\r\n\r\n  /**\r\n   * Constructor function\r\n   */\r\n  function TagsInput(element, options) {\r\n    this.itemsArray = [];\r\n\r\n    this.$element = $(element);\r\n    this.$element.hide();\r\n\r\n    this.widthClass = options.widthClass || 'width-9';\r\n    this.isSelect = (element.tagName === 'SELECT');\r\n    this.multiple = (this.isSelect && element.hasAttribute('multiple'));\r\n    this.objectItems = options && options.itemValue;\r\n    this.placeholderText = element.hasAttribute('placeholder') ? this.$element.attr('placeholder') : '';\r\n\r\n    this.$container = $('<div class=\"bootstrap-tagsinput\"></div>');\r\n    this.$input = $('<input class=\"gf-form-input ' + this.widthClass + '\" type=\"text\" placeholder=\"' + this.placeholderText + '\"/>').appendTo(this.$container);\r\n\r\n    this.$element.after(this.$container);\r\n\r\n    this.build(options);\r\n  }\r\n\r\n  TagsInput.prototype = {\r\n    constructor: TagsInput,\r\n\r\n    /**\r\n     * Adds the given item as a new tag. Pass true to dontPushVal to prevent\r\n     * updating the elements val()\r\n     */\r\n    add: function(item, dontPushVal) {\r\n      var self = this;\r\n\r\n      if (self.options.maxTags && self.itemsArray.length >= self.options.maxTags)\r\n        return;\r\n\r\n      // Ignore falsey values, except false\r\n      if (item !== false && !item)\r\n        return;\r\n\r\n      // Throw an error when trying to add an object while the itemValue option was not set\r\n      if (typeof item === \"object\" && !self.objectItems)\r\n        throw(\"Can't add objects when itemValue option is not set\");\r\n\r\n      // Ignore strings only containg whitespace\r\n      if (item.toString().match(/^\\s*$/))\r\n        return;\r\n\r\n      // If SELECT but not multiple, remove current tag\r\n      if (self.isSelect && !self.multiple && self.itemsArray.length > 0)\r\n        self.remove(self.itemsArray[0]);\r\n\r\n      if (typeof item === \"string\" && this.$element[0].tagName === 'INPUT') {\r\n        var items = item.split(',');\r\n        if (items.length > 1) {\r\n          for (var i = 0; i < items.length; i++) {\r\n            this.add(items[i], true);\r\n          }\r\n\r\n          if (!dontPushVal)\r\n            self.pushVal();\r\n          return;\r\n        }\r\n      }\r\n\r\n      var itemValue = self.options.itemValue(item),\r\n          itemText = self.options.itemText(item),\r\n          tagClass = self.options.tagClass(item);\r\n\r\n      // Ignore items allready added\r\n      var existing = $.grep(self.itemsArray, function(item) { return self.options.itemValue(item) === itemValue; } )[0];\r\n      if (existing) {\r\n        // Invoke onTagExists\r\n        if (self.options.onTagExists) {\r\n          var $existingTag = $(\".tag\", self.$container).filter(function() { return $(this).data(\"item\") === existing; });\r\n          self.options.onTagExists(item, $existingTag);\r\n        }\r\n        return;\r\n      }\r\n\r\n      // register item in internal array and map\r\n      self.itemsArray.push(item);\r\n\r\n      // add a tag element\r\n      var $tag = $('<span class=\"tag ' + htmlEncode(tagClass) + '\">' + htmlEncode(itemText) + '<span data-role=\"remove\"></span></span>');\r\n      $tag.data('item', item);\r\n      self.findInputWrapper().before($tag);\r\n      $tag.after(' ');\r\n\r\n      // add <option /> if item represents a value not present in one of the <select />'s options\r\n      if (self.isSelect && !$('option[value=\"' + escape(itemValue) + '\"]',self.$element)[0]) {\r\n        var $option = $('<option selected>' + htmlEncode(itemText) + '</option>');\r\n        $option.data('item', item);\r\n        $option.attr('value', itemValue);\r\n        self.$element.append($option);\r\n      }\r\n\r\n      if (!dontPushVal)\r\n        self.pushVal();\r\n\r\n      // Add class when reached maxTags\r\n      if (self.options.maxTags === self.itemsArray.length)\r\n        self.$container.addClass('bootstrap-tagsinput-max');\r\n\r\n      self.$element.trigger($.Event('itemAdded', { item: item }));\r\n    },\r\n\r\n    /**\r\n     * Removes the given item. Pass true to dontPushVal to prevent updating the\r\n     * elements val()\r\n     */\r\n    remove: function(item, dontPushVal) {\r\n      var self = this;\r\n\r\n      if (self.objectItems) {\r\n        if (typeof item === \"object\")\r\n          item = $.grep(self.itemsArray, function(other) { return self.options.itemValue(other) ==  self.options.itemValue(item); } )[0];\r\n        else\r\n          item = $.grep(self.itemsArray, function(other) { return self.options.itemValue(other) ==  item; } )[0];\r\n      }\r\n\r\n      if (item) {\r\n        $('.tag', self.$container).filter(function() { return $(this).data('item') === item; }).remove();\r\n        $('option', self.$element).filter(function() { return $(this).data('item') === item; }).remove();\r\n        self.itemsArray.splice($.inArray(item, self.itemsArray), 1);\r\n      }\r\n\r\n      if (!dontPushVal)\r\n        self.pushVal();\r\n\r\n      // Remove class when reached maxTags\r\n      if (self.options.maxTags > self.itemsArray.length)\r\n        self.$container.removeClass('bootstrap-tagsinput-max');\r\n\r\n      self.$element.trigger($.Event('itemRemoved',  { item: item }));\r\n    },\r\n\r\n    /**\r\n     * Removes all items\r\n     */\r\n    removeAll: function() {\r\n      var self = this;\r\n\r\n      $('.tag', self.$container).remove();\r\n      $('option', self.$element).remove();\r\n\r\n      while(self.itemsArray.length > 0)\r\n        self.itemsArray.pop();\r\n\r\n      self.pushVal();\r\n\r\n      if (self.options.maxTags && !this.isEnabled())\r\n        this.enable();\r\n    },\r\n\r\n    /**\r\n     * Refreshes the tags so they match the text/value of their corresponding\r\n     * item.\r\n     */\r\n    refresh: function() {\r\n      var self = this;\r\n      $('.tag', self.$container).each(function() {\r\n        var $tag = $(this),\r\n            item = $tag.data('item'),\r\n            itemValue = self.options.itemValue(item),\r\n            itemText = self.options.itemText(item),\r\n            tagClass = self.options.tagClass(item);\r\n\r\n          // Update tag's class and inner text\r\n          $tag.attr('class', null);\r\n          $tag.addClass('tag ' + htmlEncode(tagClass));\r\n          $tag.contents().filter(function() {\r\n            return this.nodeType == 3;\r\n          })[0].nodeValue = htmlEncode(itemText);\r\n\r\n          if (self.isSelect) {\r\n            var option = $('option', self.$element).filter(function() { return $(this).data('item') === item; });\r\n            option.attr('value', itemValue);\r\n          }\r\n      });\r\n    },\r\n\r\n    /**\r\n     * Returns the items added as tags\r\n     */\r\n    items: function() {\r\n      return this.itemsArray;\r\n    },\r\n\r\n    /**\r\n     * Assembly value by retrieving the value of each item, and set it on the\r\n     * element.\r\n     */\r\n    pushVal: function() {\r\n      var self = this,\r\n          val = $.map(self.items(), function(item) {\r\n            return self.options.itemValue(item).toString();\r\n          });\r\n\r\n      self.$element.val(val, true).trigger('change');\r\n    },\r\n\r\n    /**\r\n     * Initializes the tags input behaviour on the element\r\n     */\r\n    build: function(options) {\r\n      var self = this;\r\n\r\n      self.options = $.extend({}, defaultOptions, options);\r\n      var typeahead = self.options.typeahead || {};\r\n\r\n      // When itemValue is set, freeInput should always be false\r\n      if (self.objectItems)\r\n        self.options.freeInput = false;\r\n\r\n      makeOptionItemFunction(self.options, 'itemValue');\r\n      makeOptionItemFunction(self.options, 'itemText');\r\n      makeOptionItemFunction(self.options, 'tagClass');\r\n\r\n      // for backwards compatibility, self.options.source is deprecated\r\n      if (self.options.source)\r\n        typeahead.source = self.options.source;\r\n\r\n      if (typeahead.source && $.fn.typeahead) {\r\n        makeOptionFunction(typeahead, 'source');\r\n\r\n        self.$input.typeahead({\r\n          source: function (query, process) {\r\n            function processItems(items) {\r\n              var texts = [];\r\n\r\n              for (var i = 0; i < items.length; i++) {\r\n                var text = self.options.itemText(items[i]);\r\n                map[text] = items[i];\r\n                texts.push(text);\r\n              }\r\n              process(texts);\r\n            }\r\n\r\n            this.map = {};\r\n            var map = this.map,\r\n                data = typeahead.source(query);\r\n\r\n            if ($.isFunction(data.success)) {\r\n              // support for Angular promises\r\n              data.success(processItems);\r\n            } else {\r\n              // support for functions and jquery promises\r\n              $.when(data)\r\n               .then(processItems);\r\n            }\r\n          },\r\n          updater: function (text) {\r\n            self.add(this.map[text]);\r\n          },\r\n          matcher: function (text) {\r\n            return (text.toLowerCase().indexOf(this.query.trim().toLowerCase()) !== -1);\r\n          },\r\n          sorter: function (texts) {\r\n            return texts.sort();\r\n          },\r\n          highlighter: function (text) {\r\n            var regex = new RegExp( '(' + this.query + ')', 'gi' );\r\n            return text.replace( regex, \"<strong>$1</strong>\" );\r\n          }\r\n        });\r\n      }\r\n\r\n      self.$container.on('click', $.proxy(function(event) {\r\n        self.$input.focus();\r\n      }, self));\r\n\r\n      self.$container.on('blur', 'input', $.proxy(function(event) {\r\n        var $input = $(event.target);\r\n        self.add($input.val());\r\n        $input.val('');\r\n        event.preventDefault();\r\n      }, self));\r\n\r\n      self.$container.on('keydown', 'input', $.proxy(function(event) {\r\n        var $input = $(event.target),\r\n            $inputWrapper = self.findInputWrapper();\r\n\r\n        switch (event.which) {\r\n          // BACKSPACE\r\n          case 8:\r\n            if (doGetCaretPosition($input[0]) === 0) {\r\n              var prev = $inputWrapper.prev();\r\n              if (prev) {\r\n                self.remove(prev.data('item'));\r\n              }\r\n            }\r\n            break;\r\n\r\n          // DELETE\r\n          case 46:\r\n            if (doGetCaretPosition($input[0]) === 0) {\r\n              var next = $inputWrapper.next();\r\n              if (next) {\r\n                self.remove(next.data('item'));\r\n              }\r\n            }\r\n            break;\r\n\r\n          // LEFT ARROW\r\n          case 37:\r\n            // Try to move the input before the previous tag\r\n            var $prevTag = $inputWrapper.prev();\r\n            if ($input.val().length === 0 && $prevTag[0]) {\r\n              $prevTag.before($inputWrapper);\r\n              $input.focus();\r\n            }\r\n            break;\r\n          // RIGHT ARROW\r\n          case 39:\r\n            // Try to move the input after the next tag\r\n            var $nextTag = $inputWrapper.next();\r\n            if ($input.val().length === 0 && $nextTag[0]) {\r\n              $nextTag.after($inputWrapper);\r\n              $input.focus();\r\n            }\r\n            break;\r\n         default:\r\n            // When key corresponds one of the confirmKeys, add current input\r\n            // as a new tag\r\n            if (self.options.freeInput && $.inArray(event.which, self.options.confirmKeys) >= 0) {\r\n              self.add($input.val());\r\n              $input.val('');\r\n              event.preventDefault();\r\n            }\r\n        }\r\n\r\n        // Reset internal input's size\r\n        $input.attr('size', Math.max(this.inputSize, $input.val().length));\r\n      }, self));\r\n\r\n      // Remove icon clicked\r\n      self.$container.on('click', '[data-role=remove]', $.proxy(function(event) {\r\n        self.remove($(event.target).closest('.tag').data('item'));\r\n        // Grafana mod, if tags input used in popover the click event will bubble up and hide popover\r\n        event.stopPropagation();\r\n      }, self));\r\n\r\n      // Only add existing value as tags when using strings as tags\r\n      if (self.options.itemValue === defaultOptions.itemValue) {\r\n        if (self.$element[0].tagName === 'INPUT') {\r\n            self.add(self.$element.val());\r\n        } else {\r\n          $('option', self.$element).each(function() {\r\n            self.add($(this).attr('value'), true);\r\n          });\r\n        }\r\n      }\r\n    },\r\n\r\n    /**\r\n     * Removes all tagsinput behaviour and unregsiter all event handlers\r\n     */\r\n    destroy: function() {\r\n      var self = this;\r\n\r\n      // Unbind events\r\n      self.$container.off('keypress', 'input');\r\n      self.$container.off('click', '[role=remove]');\r\n\r\n      self.$container.remove();\r\n      self.$element.removeData('tagsinput');\r\n      self.$element.show();\r\n    },\r\n\r\n    /**\r\n     * Sets focus on the tagsinput\r\n     */\r\n    focus: function() {\r\n      this.$input.focus();\r\n    },\r\n\r\n    /**\r\n     * Returns the internal input element\r\n     */\r\n    input: function() {\r\n      return this.$input;\r\n    },\r\n\r\n    /**\r\n     * Returns the element which is wrapped around the internal input. This\r\n     * is normally the $container, but typeahead.js moves the $input element.\r\n     */\r\n    findInputWrapper: function() {\r\n      var elt = this.$input[0],\r\n          container = this.$container[0];\r\n      while(elt && elt.parentNode !== container)\r\n        elt = elt.parentNode;\r\n\r\n      return $(elt);\r\n    }\r\n  };\r\n\r\n  /**\r\n   * Register JQuery plugin\r\n   */\r\n  $.fn.tagsinput = function(arg1, arg2) {\r\n    var results = [];\r\n\r\n    this.each(function() {\r\n      var tagsinput = $(this).data('tagsinput');\r\n\r\n      // Initialize a new tags input\r\n      if (!tagsinput) {\r\n        tagsinput = new TagsInput(this, arg1);\r\n        $(this).data('tagsinput', tagsinput);\r\n        results.push(tagsinput);\r\n\r\n        if (this.tagName === 'SELECT') {\r\n          $('option', $(this)).attr('selected', 'selected');\r\n        }\r\n\r\n        // Init tags from $(this).val()\r\n        $(this).val($(this).val());\r\n      } else {\r\n        // Invoke function on existing tags input\r\n        var retVal = tagsinput[arg1](arg2);\r\n        if (retVal !== undefined)\r\n          results.push(retVal);\r\n      }\r\n    });\r\n\r\n    if ( typeof arg1 == 'string') {\r\n      // Return the results from the invoked function calls\r\n      return results.length > 1 ? results : results[0];\r\n    } else {\r\n      return results;\r\n    }\r\n  };\r\n\r\n  $.fn.tagsinput.Constructor = TagsInput;\r\n\r\n  /**\r\n   * Most options support both a string or number as well as a function as\r\n   * option value. This function makes sure that the option with the given\r\n   * key in the given options is wrapped in a function\r\n   */\r\n  function makeOptionItemFunction(options, key) {\r\n    if (typeof options[key] !== 'function') {\r\n      var propertyName = options[key];\r\n      options[key] = function(item) { return item[propertyName]; };\r\n    }\r\n  }\r\n  function makeOptionFunction(options, key) {\r\n    if (typeof options[key] !== 'function') {\r\n      var value = options[key];\r\n      options[key] = function() { return value; };\r\n    }\r\n  }\r\n  /**\r\n   * HtmlEncodes the given value\r\n   */\r\n  var htmlEncodeContainer = $('<div />');\r\n  function htmlEncode(value) {\r\n    if (value) {\r\n      return htmlEncodeContainer.text(value).html();\r\n    } else {\r\n      return '';\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Returns the position of the caret in the given input field\r\n   * http://flightschool.acylt.com/devnotes/caret-position-woes/\r\n   */\r\n  function doGetCaretPosition(oField) {\r\n    var iCaretPos = 0;\r\n    if (document.selection) {\r\n      oField.focus ();\r\n      var oSel = document.selection.createRange();\r\n      oSel.moveStart ('character', -oField.value.length);\r\n      iCaretPos = oSel.text.length;\r\n    } else if (oField.selectionStart || oField.selectionStart == '0') {\r\n      iCaretPos = oField.selectionStart;\r\n    }\r\n    return (iCaretPos);\r\n  }\r\n\r\n  /**\r\n   * Initialize tagsinput behaviour on inputs and selects which have\r\n   * data-role=tagsinput\r\n   */\r\n  $(function() {\r\n    $(\"input[data-role=tagsinput], select[multiple][data-role=tagsinput]\").tagsinput();\r\n  });\r\n})(window.jQuery);\r\n"],"mappings":";;;;;;;;;;;;;;;;AAAA;AACA;AAOA;;;AAGA;AACA;AAAA;AACA;AACA;AACA;AAIA;AACA;AACA;AAAA;;;;;;;;;;;;;;;;;;AClBA;;;;;;;;;;;;;;;;;;AAkBA;AACA;AAIA;AAAA;AAAA;AAHA;AAIA;AAEA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;;AAdA;AAAA;AAeA;AAEA;AACA;AAEA;AAAA;AACA;AACA;;;AAAA;AAEA;AAAA;AACA;AACA;;;AAAA;AAEA;AACA;AACA;AACA;AAEA;AAAA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;;;;;;;;;;;;;;;;;;;ACnFA;AAMA;AAMA;AALA;AAEA;AACA;AAGA;AAKA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAKA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AAEA;;AAEA;AACA;AACA;AACA;AACA;AAAA;;;;;;;;;;;;;;;;;;;;;;;;;;;;AC7EA;AAEA;AACA;AACA;AACA;AAEA;AACA;AAMA;AAEA;AAWA;;AAAA;AANA;AACA;AAEA;AAIA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AACA;AAAA;AACA;AACA;;;;;;;;;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAGA;AADA;AACA;AACA;AACA;;;AAAA;AAEA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AAEA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AAEA;AAEA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AAEA;AACA;AACA;AACA;AAAA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AAEA;AACA;AAEA;;AACA;AACA;AACA;AACA;;AAEA;AACA;AAAA;AACA;AACA;AACA;AACA;;;;;;;;;AACA;AAEA;;;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;AACA;AAEA;;AAEA;AACA;;;AACA;AAAA;AACA;AACA;;;;;;;;;AACA;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;;AAEA;AACA;;AACA;AACA;AACA;AAEA;AACA;;AACA;AAAA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;;;;;;;;;AACA;AAEA;;AACA;AACA;AACA;AAEA;AACA;AACA;AAEA;;AACA;AAAA;AACA;AACA;;;;;;;;;AACA;AAEA;;AAEA;AACA;;AACA;;AACA;AAAA;AACA;AACA;;;;;;;;;AACA;AACA;AAEA;AACA;AACA;AAEA;;AAEA;AACA;AACA;AACA;AACA;AAAA;;;;;;;;;;;;;;ACvQA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AAEA;;;;;;;;;;;;;ACtCA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;ACRA;AACA;AAEA;AACA;AAaA;AACA;AACA;AACA;AACA;AAEA;;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;;AAEA;AAAA;AACA;AACA;AACA;AACA;;;;;;;;;;AAEA;AAAA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;;AACA;AACA;;AACA;AAAA;AACA;AACA;AACA;;;;;;;;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;;;AAGA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AAAA;AACA;AACA;;;;;;;;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AAEA;;;;AAIA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AAEA;;;AAGA;AACA;AACA;AACA;AACA;AACA;AAGA;AACA;AACA;AACA;AACA;AAIA;AAEA;AACA;AACA;AACA;AACA;AAEA;AAEA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AAEA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AAAA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AAEA;AACA;AAGA;AAIA;AAEA;AAEA;;AAEA;AACA;AACA;AAGA;AACA;AACA;AAIA;AAEA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;;AAEA;AACA;;AACA;;AACA;AAAA;AACA;AACA;;;;;;;;;AACA;AACA;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;;ACtdA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AAGA;AAEA;AACA;AACA;AACA;AAEA;AACA;AACA;AAAA;AACA;AACA;AACA;AAEA;;;;;;AAMA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AAEA;;;;AAIA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AAEA;;;;;AAKA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AAAA;AACA;AACA;AAAA;AACA;AACA;AAAA;AACA;AACA;AAEA;AACA;AACA;AAAA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AAAA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;;AC7JA;AAAA;AAAA;AAAA;AACA;;;;;;;;;;;;;ACDA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;;ACLA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AAIA;AAsEA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AAEA;AAKA;AACA;AACA;AAEA;AACA;;;;;;;;;;;;;AClHA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AAIA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AAEA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AAEA;AACA;AACA;AAAA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AAEA;AACA;AAEA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AAEA;AACA;AAEA;AACA;AACA;AACA;AAEA;AACA;AACA;;;;;;;;;;;;;ACzKA;AAAA;AAAA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;;;;;;;;;;;;;;ACrYA;AACA;AAEA;AACA;AAGA;AACA;AACA;AAEA;AAUA;AACA;AACA;AACA;AACA;AACA;AAEA;;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AAAA;AACA;AACA;AAAA;AACA;AACA;AACA;AAEA;AACA;AAEA;AACA;AAEA;AACA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AAEA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AAAA;AACA;AACA;AAEA;AAEA;AACA;AACA;AACA;AAEA;AACA;AAEA;AACA;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;ACjKA;AACA;AAEA;AACA;AACA;AASA;AAGA;AAEA;AACA;AAQA;AACA;AACA;AACA;AACA;AAEA;;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;;AACA;AAAA;AACA;AACA;AACA;AACA;;;;;;;;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAuBA;AAEA;;;AACA;AACA;AAEA;AAEA;AACA;AAEA;AACA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AAEA;AACA;AAEA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AAEA;AAEA;AAGA;AACA;AACA;AAEA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AAAA;AACA;AACA;AACA;AAEA;AACA;AAEA;AACA;AACA;AACA;AACA;AAEA;AACA;AAEA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AAEA;AACA;AACA;AAGA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;ACjRA;AACA;AAcA;AAEA;AACA;AACA;AACA;AAqBA;;AACA;AACA;AAEA;;AACA;AAAA;;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;AACA;;;;;;;;;AAEA;AACA;AAEA;;AAEA;AACA;;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AAEA;AAEA;AACA;AACA;;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;AACA;AAEA;AACA;AACA;AACA;AACA;AAEA;;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AAAA;AACA;;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;AACA;AACA;;;;;;;;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AAGA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AAGA;AAEA;AACA;AAUA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AAEA;;;AAGA;AACA;;AACA;AACA;;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;AACA;AAEA;AACA;AAEA;;;AAGA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;;ACjSA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AAEA;;;;;;;;;;;;;;;;;;;;;;;;;ACJA;AACA;AACA;AACA;AACA;AAeA;AACA;AACA;AACA;AAEA;AAEA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AAEA;;AACA;;AACA;AAAA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;;;;;;;;;AACA;AACA;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;;ACzHA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;;ACRA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;;;;;;;;;;;;;;;;;;;;ACFA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;;;;;;;;;;;;;ACnBA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAEA;AACA;AACA;AACA;AAEA;AACA;AAEA;AACA;AACA;AACA;AAEA;AACA;AAEA;AACA;AACA;AACA;AAEA;AACA;AAEA;AACA;AACA;AACA;AAEA;AAEA;AACA;AACA;AAEA;AACA;AAEA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;;;;;;;;ACnFA;;;AAGA;AACA;AACA;AAMA;AACA;AAEA;AACA;AACA;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AAAA;AAAA;AAAA;;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AAEA;;AAEA;AACA;AACA;AAEA;AACA;AAEA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;;;;;;;;;;;;;;;;;;;;;;;ACnFA;AACA;AAEA;AACA;AAEA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AAEA;AACA;AAEA;AACA;AACA;AAqBA;;AAEA;AACA;;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;;AACA;AAAA;AACA;AACA;AACA;AACA;;;;;;;;;AACA;AACA;AAGA;AACA;AAEA;AAEA;AACA;AACA;AACA;AACA;;AACA;AAAA;AACA;AACA;;;;;;;;;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AACA;AAIA;AACA;AAEA;AACA;;AAEA;AAAA;AACA;AACA;AAIA;AACA;;;;;;;;;AAEA;AAKA;AACA;AAEA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AAEA;AACA;AAEA;AACA;AACA;AAEA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;;ACjbA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;;;;;;;;;;;;;;ACPA;AACA;AACA;AACA;AACA;AAQA;AAEA;AACA;AAKA;AAEA;AACA;AAKA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;;AC5CA;AAAA;AAAA;AAAA;AAAA;AACA;AAGA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AACA;AAEA;;AAEA;AACA;AACA;AACA;;;;;;;;;;;;;AC1DA;AAAA;AAAA;AAAA;AAAA;AAEA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AAAA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AAEA;;AAEA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;;AC/BA;AAAA;AAAA;AAAA;AAAA;AAAA;AAEA;AAEA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AAEA;;AAEA;AACA;AACA;AACA;AAEA;AACA;AACA;;;;;;;;;;;;;;;;;;;;;;;;ACnDA;AACA;AAGA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;;;AACA;AAAA;AACA;AACA;AACA;AACA;;;;;;;;;AACA;AACA;AACA;AAEA;;AACA;;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;;;AACA;AAAA;AACA;AACA;AACA;AACA;;;;;;;;;AACA;AACA;AACA;AAEA;;AACA;;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;;;AACA;AAAA;AACA;AACA;AACA;AACA;;;;;;;;;AACA;AACA;AACA;AAEA;;AACA;;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;;;AACA;AAAA;AACA;AACA;AACA;AACA;;;;;;;;;AACA;AACA;AACA;AAEA;;AACA;;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;;;;;;;;;;;;;ACnQA;AAAA;AAAA;AAAA;AAAA;AAEA;AAEA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AAEA;AACA;AACA;;;;;;;;;;;;;;;;;;;;;;;;;;;;;ACzBA;AACA;AAEA;AACA;AACA;AACA;AACA;AAEA;AAEA;;AAEA;AACA;;AACA;;AACA;AAAA;AACA;AACA;AACA;AAEA;AACA;;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;;;;;;;;;AACA;AACA;AACA;;;;;;;;;AACA;AACA;AAEA;;;AAGA;AACA;AAAA;AAAA;;AAgBA;AAfA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AACA;AAAA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;;;;;;;;;;;;;;;;;;;ACvEA;AACA;AAKA;AACA;AACA;AACA;AACA;AAEA;;;AAGA;AACA;AACA;;AACA;AACA;AACA;AAEA;AACA;;AACA;AAAA;AACA;AAIA;;;;;;;;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAOA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;;;;;;;;;;;AC1DA;AAEA;AAEA;AACA;AAOA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;;;AAGA;AACA;AACA;AACA;AACA;AAEA;AACA;AAEA;;AACA;;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AAEA;AAEA;AACA;;;;;;;;;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AAEA;;;AAGA;AACA;AACA;AACA;AACA;AAEA;AACA;AAEA;;AACA;;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;AACA;AACA;AACA;AACA;;;;;;;;;;;;;ACtGA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AAEA;AAOA;AACA;AACA;AACA;AACA;AAEA;;;AAGA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;;;;;;;;;;;;;ACrCA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AAEA;AAOA;AACA;AACA;AACA;AACA;AAEA;;;AAGA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;;;;;;;;;;;;;ACrCA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;;ACXA;AAAA;AAAA;AAAA;AASA;AACA;AACA;AACA;AACA;AAEA;;;AAGA;AACA;AACA;AACA;AACA;;;;;;;;;;;;;;;;;;;;;;;;ACtBA;AAEA;AACA;AACA;AACA;AAEA;AACA;AAOA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;;;AAGA;AACA;AACA;AACA;AACA;AAEA;;AACA;;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;;;;;;;;;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AACA;AAAA;AACA;AACA;AACA;;;;;;;;;AACA;AACA;;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;AACA;AAEA;AAGA;;;;;;;;;AACA;AACA;AACA;AACA;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;ACtFA;AAEA;AAAA;AACA;AACA;AACA;AAkBA;AAAA;AAAA;;AAiDA;AAzCA;;;;AAIA;AACA;AAEA;;;AAGA;AACA;AACA;AACA;AACA;AACA;AAEA;;AACA;AACA;AACA;AAEA;;AACA;AAAA;AACA;AACA;AAEA;AACA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;;;;;;;;;AACA;AACA;AACA;AAAA;;;;;;;;;;;;;;AC3EA;AAAA;AAAA;AAAA;AAAA;AAAA;AASA;AACA;AACA;;;;;;;;;;;;;ACTA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AA8DA;AAAA;AACA;AACA;AACA;AACA;;;;;;;;;;;;;ACjEA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;ACbA;AA8BA;AAIA;AAGA;AAAA;AAAA;AAFA;;AAIA;AAEA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AAEA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;;AAgDA;;;;;AAKA;AACA;AAmBA;AACA;AACA;AACA;AA+FA;AAAA;;AA4BA;AAAA;AACA;AACA;AACA;AA4NA;AAAA;AAUA;AAAA;AAAA;;;;;;;;;;;;;;;;;;;;;;;;;AC5hBA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA;AAQA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;ACnDA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;;;;;;;;;;;;;AC3BA;AAAA;AAAA;AAAA;AAAA;AAAA;;;AAGA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AAAA;AACA;AACA;AACA;AACA;AAwDA;AAAA;AACA;AACA;AACA;AACA;AACA;AA8BA;AAAA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;;;;;;;;;;;;;ACxHA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA;;;;;;;;;;;;;;;;;;;ACRA;AAqEA;AAAA;AAaA;AAAA;AAEA;;AACA;AAEA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AAEA;;;;;AAKA;AACA;AACA;AACA;AACA;AAEA;;;AAGA;AACA;AACA;AACA;AACA;AACA;AAAA;;AA0BA;AAAA;AACA;AACA;AACA;AACA;;;;;;;;;;;;;ACzJA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAkBA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;;AC7BA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AAEA;AAAA;AACA;AACA;AACA;AACA;AACA;AAuCA;AAAA;AACA;AACA;AAEA;AACA;AACA;AACA;AAgEA;AAAA;AAqBA;AARA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;;;;;;;;;;;;;;;;;;;;;;;;;AChJA;AAAA;AAAA;AAAA;AACA;AACA;AACA;;;;;;;;;;;;;ACGA;AAAA;AAAA;AAAA;AACA;AACA;AACA;;;;;;;;;;;;;ACkBA;AAAA;AAAA;AAAA;AAAA;AAeA;AAEA;AACA;AACA;AACA;AACA;;;;;;;;;;;;;;;;;;;;;;;;AC3CA;AAAA;AAAA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;;;;;;;;;;;;;ACbA;AAAA;AAAA;AAAA;AACA;AACA;AACA;;;;;;;;;;;;;;;;;;;;;;;;;;;;AC6BA;AAKA;AAAA;AAJA;AACA;AACA;AAEA;AAEA;;AACA;AACA;;AACA;AAAA;AACA;AACA;;;;;;;;;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AAEA;AACA;;AACA;AAAA;AACA;AACA;;;;;;;;;AACA;;AAEA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;;;;;;;;;AACA;AACA;AAEA;;AAEA;AACA;;AACA;AACA;;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;;AACA;AACA;AACA;AACA;AACA;AAEA;;AACA;AAAA;AACA;AACA;AACA;AACA;;;;;;;;;AACA;AAEA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AAAA;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;ACjJA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AAEA;AAAA;AACA;AACA;AACA;AACA;AA4BA;AACA;AACA;AAEA;AAAA;AACA;AACA;AACA;AACA;AAEA;AAQA;AAAA;AAYA;AACA;;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;;AACA;AAAA;AACA;AACA;;;;;;;;;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AAEA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AA9GA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AAuGA;AACA;AACA;AAEA;AAQA;AAEA;AACA;AACA;AAAA;;AAIA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AAEA;;AACA;AACA;;AAEA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AAAA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;AACA;AACA;AAEA;;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AAAA;AACA;AAEA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;AAEA;AACA;;;;;;;;;;;;;;;;;;;;;;;;;;AC5TA;AAGA;AACA;AAEA;AAIA;AACA;AAEA;AAIA;AACA;AAEA;AAIA;AACA;AAEA;AAIA;AACA;AAEA;AAGA;AACA;AAEA;;AAKA;AAEA;AAIA;AAEA;;AAKA;AAEA;AAOA;AAEA;;AAKA;AAEA;AAOA;AAEA;;AACA;AAEA;AAWA;;;;;;;;;;;;;ACnGA;AAAA;AAAA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;;AChBA;AAAA;AAAA;AAAA;AAAA;AACA;AAEA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;;;;;;;;;;;;;AC1BA;AAAA;AAAA;AAAA;AAAA;AAYA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AAEA;AAEA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AAEA;;;;AAIA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;;AClEA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;;;;;;;;;;;;;;;;;;;;ACVA;;AAEA;AACA;AAEA;;;;AAIA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;;AAEA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;;;;;;;;;;;;;;;;;;ACvEA;AAEA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AAEA;;;;;AAKA;AACA;;AACA;AACA;AACA;;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AAEA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AAIA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AAEA;AACA;AACA;AAEA;AACA;;;;;;;;;;;;;;;;;;;;;;;;;;;;AC1JA;AACA;AACA;AAgDA;AAEA;AAGA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AARA;AAUA;AACA;AACA;AAEA;AACA;AAGA;AAEA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AAEA;AACA;AAGA;AACA;AAEA;AACA;AACA;AACA;AAEA;AAEA;AACA;AACA;AAEA;AACA;AAEA;AACA;AACA;AAEA;AACA;AAEA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AAEA;AACA;AACA;AACA;AAEA;AACA;AACA;;;;;;;;;;;;;AC1LA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;;ACLA;AAAA;AAAA;AAAA;;;AAGA;AACA;AACA;AACA;AAEA;AACA;AAEA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;;;AAGA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;;AC5CA;AAAA;AAAA;AAAA;AAIA;AAKA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AAEA;AAKA;AACA;AACA;AAEA;AAEA;AACA;AACA;AACA;AAEA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AAEA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AAEA;AACA;AAEA;AACA;AACA;AAEA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;;AC5FA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAGA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;;AC9CA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AAkBA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;ACxWA;AAEA;AAQA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AAEA;AACA;AACA;AAAA;AACA;AACA;AAAA;AACA;AACA;AAAA;AACA;AACA;AAAA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AAEA;AACA;AACA;AAAA;AACA;AACA;AAAA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AAEA;AACA;AACA;AAAA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AAEA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AAAA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AAEA;AACA;AAEA;AACA;AACA;AACA;AAEA;AACA;AACA;AAAA;AACA;AACA;AAAA;AACA;AACA;AAAA;AACA;AACA;AAAA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AAEA;AACA;AACA;AAAA;AACA;AACA;AAAA;AACA;AACA;AAAA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AAEA;AACA;AACA;AAAA;AACA;AACA;AAAA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AAEA;AAEA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AAEA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AAEA;AAEA;AAEA;AACA;AACA;AAAA;AACA;AACA;AAAA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AAEA;AAMA;AACA;AACA;AACA;;;;;;;;;;;;;AC/VA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;;;;;;;;;;;;;ACAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAGA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;;;;;;;;;;;;;;;;;;ACtEA;AAEA;AACA;AASA;;AACA;AACA;AAwBA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AAEA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AAEA;AAOA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;;AACA;;AAEA;AAAA;;AACA;AAAA;AACA;AACA;;;;;;;;;AACA;;;;;;;;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AAEA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AAEA;AACA;AAEA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;;;;;;;AC3OA;AAQA;;;;AAIA;AACA;AAIA;AAAA;AAHA;AACA;AAGA;AACA;AAEA;;AAEA;AACA;;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AACA;AAAA;;;;;;;;;;;;;;ACtEA;AAAA;AAAA;AAGA;AACA;AACA;AAEA;AAAA;AACA;AACA;;;AAAA;AAEA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AACA;AAAA;;;;;;;;;;;;;;ACnCA;AAAA;AAAA;AAAA;AAQA;;;;;;AAMA;AACA;AAMA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AAEA;;;;AAIA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AAOA;AACA;AACA;AAEA;AACA;AACA;AAEA;AAAA;AACA;AACA;;;AAAA;AAEA;AACA;AACA;AAEA;AACA;AACA;AACA;AAAA;;;;;;;;;;;;;;ACvIA;AAAA;AAAA;AACA;AAAA;AAAA;AAAA;AAEA;AAAA;AACA;AACA;;;AAAA;AAEA;AACA;AACA;AAEA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AAAA;;;;;;;;;;;;;;ACpBA;AAAA;AAAA;AAAA;AAEA;AACA;AAAA;AAAA;AAAA;AAEA;AAAA;AACA;AACA;;;AAAA;AAEA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AACA;AAAA;;;;;;;;;;;;;;ACpBA;AAAA;AAAA;AAAA;AAEA;;AAEA;AACA;AACA;AAAA;AAAA;AAAA;AAEA;AAAA;AACA;AACA;;;AAAA;AAEA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AACA;AAAA;;;;;;;;;;;;;;ACxBA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;;ACHA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;;ACRA;AAAA;AAAA;AAAA;AAAA;AACA;AAEA;AACA;AACA;AAEA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;;AChBA;AAAA;AAAA;AAAA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;;;;;;;;;;;;;ACrBA;AAAA;AAAA;AAAA;AAEA;AACA;AACA;AACA;AACA;;;;;;;;;;;;;ACNA;AAAA;AAAA;AAAA;AAAA;AACA;AAEA;AACA;AACA;AAEA;;;;;;;;;;;;;;;;;;;AAmBA;AACA;;;;;;;;;;;;;AC3BA;AAAA;AAAA;AAAA;AAAA;AACA;AAEA;AACA;AACA;AAEA;;;;;;;;;;;;;;;AAeA;AACA;;;;;;;;;;;;;ACvBA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;;ACpBA;AAAA;AAAA;AAAA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;;ACjBA;AAAA;AAAA;AAAA;AAEA;AACA;AACA;;;;;;;;;;;;;ACJA;AAAA;AAAA;AAAA;AAEA;AACA;AAEA;AAEA;AACA;;;;;;;;;;;;;ACRA;AAAA;AAAA;AAAA;AAEA;AACA;AAEA;AACA;AACA;AACA;AAEA;AAEA;AACA;;;;;;;;;;;;;ACbA;AAAA;AAAA;AAAA;AAAA;AAEA;;;;;;;;;;;;;ACFA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAQA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;;;;;;;;;;;;;AC3BA;AAAA;AAAA;AAAA;AAEA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;;ACPA;AAAA;AAAA;AAAA;AAEA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;;ACPA;AAAA;AAAA;AAAA;AAEA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;;ACPA;AAAA;AAAA;AAAA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;;ACTA;AAAA;AAAA;AAAA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;;ACVA;AAAA;AAAA;AAAA;AAEA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;;ACPA;AAAA;AAAA;AAAA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;;ACXA;AAAA;AAAA;AAAA;AAEA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;;ACPA;AAAA;AAAA;AAAA;AAEA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;;ACPA;AAAA;AAAA;AAAA;AAEA;AACA;AACA;;;;;;;;;;;;;ACJA;AAAA;AAAA;AAAA;AAEA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;;ACPA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;;ACvDA;AAAA;AAAA;AAAA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;;ACVA;AAAA;AAAA;AAAA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;;ACRA;AAAA;AAAA;AAAA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;;ACRA;AAAA;AAAA;AAAA;AAEA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;;ACPA;AAAA;AAAA;AAAA;AAEA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;;ACPA;AAAA;AAAA;AAAA;AAEA;AACA;AACA;;;;;;;;;;;;;ACJA;AAAA;AAAA;AAAA;AAEA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;;ACPA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AAAA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;;ACpEA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;;;;;;;;;;;;;ACFA;AAAA;AAAA;AAAA;AAWA;AACA;AAOA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;;;;;;;;;;;;;AC5CA;AAAA;AAAA;AACA;AACA;AACA;AACA;AAOA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;;;;;;;;;;;;;ACvBA;AAAA;AAAA;AACA;AACA;AACA;;;;;;;;;;;;;;;;;;;;ACRA;AACA;AACA;AAWA;AAAA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AAKA;;;;;;;;;;;;;AC/DA;AAAA;AAAA;AAAA;AAOA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;;;;;;;;;;;;;ACxBA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AA0BA;AAwCA;AAvCA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AAIA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAGA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AAAA;;AAEA;AACA;AACA;AACA;AAEA;AACA;AAEA;;;;;;;;;;;;;ACtGA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA;AAEA;;;;;;;;;;;;;ACIA;AAAA;AAAA;AAAA;AAEA;AACA;AACA;AAEA;AACA;AACA;;;;;;;;;;;;;ACsBA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AAQA;AAEA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;;;;;;;;;;;;;ACpCA;AAAA;AAAA;AAAA;AAEA;AACA;AACA;AAEA;AACA;AACA;;;;;;;;;;;;;ACQA;AAAA;AAAA;AAAA;AAEA;AACA;AACA;AAEA;AACA;AACA;;;;;;;;;;;;;AC7CA;AAAA;AAAA;AAAA;AAEA;AACA;AACA;AAEA;AACA;AACA;;;;;;;;;;;;;ACdA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA;;;;;;;;;;;;;;;;;;;;;;;;ACJA;AAAA;AAAA;AAAA;AAAA;;;;;;;;;;;;;;;;;;;;;ACAA;AAQA;AACA;AACA;AAEA;AACA;AAEA;AAGA;AACA;AACA;AACA;AAEA;;AAEA;AACA;AAAA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AAKA;AACA;AACA;AACA;AACA;AACA;AACA;AAIA;AACA;AAEA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;;AAEA;AACA;AAAA;;;;AACA,iRACA;;AADA;AAGA;;;;AACA;AAEA;AACA;AACA;AACA;AACA;AAAA;;;;;;;;;;;;;;ACtFA;AAAA;AAAA;AAAA;AAGA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;;ACRA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAEA;AACA;AAOA;AAEA;AACA;AACA;AACA;;;;;;;;;;;;;ACfA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AAaA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AAAA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AAGA;AAEA;AAGA;AAQA;;;;;;;;;;;;;;;;;;;;;AC3DA;AACA;AACA;AASA;AAAA;AACA;AACA;AAEA;AAeA;AAEA;;AAAA;AAGA;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;ACnCA;AACA;AACA;AACA;AACA;AAYA;AACA;AAEA;AACA;AACA;AAEA;AACA;AAGA;AACA;AACA;AACA;AACA;AACA;AACA;AAkBA;AAAA;AACA;AACA;AACA;AACA;AAEA;AAAA;AAAA;;AAuLA;AAlKA;AACA;AACA;AACA;AAEA;AACA;AAKA;AAEA;AAEA;AACA;AAGA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AAEA;AAEA;AAEA;AACA;AACA;AAGA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AAQA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AAEA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AAEA;AAEA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AAAA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AAEA;AACA;AAEA;AAEA;AACA;AAGA;AArLA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAoKA;AAAA;AAvLA;AAuMA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AAEA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AAAA;AACA;AAEA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AAkBA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AAEA;;AAEA;AACA;AACA;AACA;AAEA;AACA;AAEA;AACA;AAEA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AAEA;AACA;AACA;AACA;AACA;AAEA;AACA;AAAA;AACA;AACA;AACA;AACA;AAAA;AACA;AAEA;AACA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AAAA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AAOA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AACA;AAAA;AACA;AAMA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;;;;;;;;;;;;;;;;;;;;;;;;ACpmBA;AACA;AAKA;AACA;AAWA;AAAA;AACA;AACA;AACA;AAEA;AAAA;AACA;AACA;AACA;AACA;AAEA;AAAA;AACA;AACA;AACA;AAeA;AAAA;AAAA;;AAwBA;AAnBA;AACA;AAEA;AACA;AACA;AACA;AACA;AAEA;AAEA;AACA;AACA;AAEA;AAGA;AAtBA;AACA;AACA;AAqBA;AAAA;AAxBA;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AC/CA;AACA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AAEA;AACA;AAEA;AAaA;AAAA;AACA;AAEA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AAEA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AAEA;AACA;AAEA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AAEA;AACA;AAEA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AAEA;AAaA;AAEA;AACA;AAEA;AACA;AACA;AACA;AACA;AAEA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AAEA;AAEA;AACA;AAGA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;;AAEA;AAAA;AACA;AAAA;AAGA;AAEA;AACA;AACA;AAOA;AACA;AAQA;AACA;AACA;AAAA;AACA;AACA;AACA;;AACA;AAEA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AAAA;;AAEA;AAAA;AACA;AAAA;AAGA;AACA;AACA;AACA;AACA;AAEA;AACA;AAEA;AACA;AAOA;AAEA;;AAMA;AAEA;AACA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;;AAEA;AAAA;AACA;AAAA;AAGA;AACA;AACA;AACA;AAEA;AACA;AAEA;AACA;AAQA;AACA;AAEA;AAOA;AACA;AAEA;AACA;;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AAAA;;AAEA;AAAA;AACA;AAAA;AAGA;AACA;AACA;AAEA;AACA;AAQA;AACA;AAEA;AAOA;AACA;;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AAAA;;AAEA;AACA;AACA;AAEA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AAEA;;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;;;;;;;;;;;;ACvcA;AACA;AACA;AACA;AAgBA;AACA;AACA;AAEA;AACA;AAEA;AAEA;AACA;AACA;AACA;AACA;AACA;AAEA;AAEA;AAGA;AAEA;AASA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AAEA;AAEA;AAGA;AACA;;;;;;;;;;;;;;;;;;;;;ACrEA;AACA;AACA;AAIA;AACA;AAQA;AAKA;AASA;AACA;AACA;AACA;AAEA;AACA;AAEA;AAGA;AAEA;AAEA;AAIA;AAEA;AACA;AAGA;;;;;;;;;;;;;;;;;;;;;;ACtDA;AACA;AACA;AAIA;AAIA;AACA;AACA;AAAA;AAeA;AAAA;AACA;AACA;AAEA;AAEA;AACA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AAIA;AACA;AAEA;AACA;AAIA;AAEA;AACA;AAIA;AACA;AAEA;AACA;AAuBA;AAMA;AACA;AASA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;;;;;;;;;;;AClKA;AACA;AAEA;AACA;AAeA;AAEA;AACA;;AAAA;;;;;;;;;;;;;;;;;;;;;;ACtBA;AAGA;AACA;AACA;AASA;AACA;AAUA;AAIA;AAGA;AAEA;AACA;AAMA;AAEA;AAEA;AACA;AACA;AAGA;;;;;;;;;;;;;;;;;;;;;;;;;AClDA;AACA;AACA;AACA;AAEA;AAEA;AAEA;AA4BA;AAMA;AAAA;AACA;AAAA;AAaA;;AAAA;AACA;;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;;;;;;;;;AACA;AACA;AAmBA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AAEA;AACA;AAEA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AAnHA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AACA;AAmBA;;AACA;AACA;AACA;;AACA;AAAA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;AACA;AACA;AA0EA;AACA;AACA;AAEA;AAwBA;AACA;AAYA;AACA;AAAA;;;;;;;;;;;;;;;;;;;;;;;AC7MA;AACA;AACA;AAGA;AA0CA;AAAA;AACA;AACA;AAWA;AAKA;AACA;AACA;AAEA;;;;;;;;;;;;;;;;;;;;;;;;;;ACrEA;AACA;AACA;AACA;AACA;AACA;AASA;AACA;AACA;AACA;AASA;AACA;AAEA;AAAA;AACA;AACA;AACA;AACA;;;AAGA;AAEA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AAEA;AAEA;AAIA;AACA;AACA;AACA;AACA;AAMA;AAEA;;;;;;;;;;;;;;AC/EA;AAAA;AAAA;AAEA;AACA;AACA;AAEA;;;;;;;;;;;;;;;;;;;;;ACNA;AACA;AAUA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AAUA;AACA;AAEA;AACA;AACA;AACA;;AAKA;AAnBA;AACA;AACA;AAEA;AACA;AACA;AAUA;AACA;AACA;AACA;AAAA;;;;;;;;;;;;;;;;;;;;;;;;ACnCA;AACA;AAGA;AACA;AACA;AAEA;AACA;AAIA;AAIA;AAQA;AA0BA;AAQA;AAKA;AAOA;AAIA;AAOA;AAUA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AAEA;AAEA;AACA;AACA;AAEA;AAEA;AAEA;AACA;AAKA;AAEA;;;;;;;;;;;;;;;;;;;;;;;;AC7HA;AACA;AACA;AAGA;AAWA;AAAA;AACA;AAAA;AAsBA;AACA;AACA;AAEA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AACA;AAEA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AA5CA;AACA;AACA;AACA;AAEA;;AACA;AAEA;AACA;AACA;AACA;AAKA;AAEA;AACA;AA2BA;AACA;AACA;AAOA;AAEA;AACA;AACA;AACA;AACA;AACA;AAEA;AAEA;AACA;AAEA;AAIA;AACA;AAAA;AAEA;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AC/FA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AAgBA;AAEA;;AAEA;AAAA;AAAA;AAAA;AAEA;AAEA;AACA;AACA;AAEA;AACA;;AA+CA;AA7CA;AAAA;AACA;AACA;AAKA;AAGA;AAEA;AAUA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAWA;AAGA;AACA;AAAA;AAvDA;AAuDA;AACA;AAEA;AACA;;;;;;;;;;;;;;;;;;;;;;;ACzFA;AACA;AAEA;AAEA;AACA;AAgCA;AAAA;AACA;AAAA;AAQA;AACA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AAGA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AAEA;AACA;AACA;AAEA;AAGA;AAKA;AAGA;AAxEA;AACA;AACA;AACA;;AACA;AAsEA;AACA;AACA;AACA;AAEA;AACA;AAGA;AAGA;AAGA;AAGA;AACA;AAAA;;;;;;;;;;;;;;ACtIA;AAAA;AAAA;AAAA;AAAA;AAQA;AAIA;AAMA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAKA;;;;;;;;;;;;;;;;;;;;;;;;;;ACvDA;AAEA;AAEA;AACA;AACA;AAIA;AAAA;AACA;AACA;AACA;AASA;AACA;AAOA;AACA;AAEA;AAEA;AACA;AACA;AAIA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AAGA;AACA;AACA;AACA;AAGA;AACA;AAGA;AASA;AACA;AAMA;AAEA;AAEA;AAWA;AAEA;AACA;AACA;AAIA;AAEA;AAFA;AAeA;AAEA;;;;;;;;;;;;;ACvHA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AAEA;AAOA;AAAA;AACA;AACA;AACA;AAOA;AACA;AAGA;AAEA;AAGA;AACA;AACA;AACA;AACA;AAKA;;;;;;;;;;;;;;;;;;;;;;;;ACtCA;AAEA;AAEA;AACA;AAOA;AACA;AACA;AAKA;AACA;AACA;AAQA;AACA;AACA;AACA;AAGA;AACA;AAGA;AAWA;AAAA;AACA;AAAA;AAEA;AACA;AACA;AACA;;AACA;AAEA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AAEA;AACA;AACA;AAEA;AAEA;AACA;AAGA;AAKA;AACA;AAAA;;AAEA;AACA;;;;;;;;;;;;;;;;;;;;;;;;;;;ACxFA;AACA;AAEA;AACA;AACA;AAEA;AACA;AAOA;AAIA;AACA;AAAA;AACA;AAGA;AACA;AACA;AACA;AAEA;AAEA;AACA;AAEA;AAEA;AACA;AACA;AACA;AAEA;AAEA;AACA;AACA;AACA;AAIA;AAEA;AAEA;AACA;AACA;AACA;AACA;AACA;AAIA;AAIA;AAEA;AACA;AACA;AACA;AACA;AAIA;AAKA;AAEA;AAAA;AACA;AAEA;AAGA;AACA;AAGA;AAGA;AAEA;;;;;;;;;;;;;;;;;;;ACnGA;AAEA;AAMA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AAEA;AACA;AACA;AAIA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AAEA;AACA;AAIA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AAEA;AAMA;AAQA;AAEA;;;;;;;;;;;;;ACnFA;AAAA;AAAA;AAAA;AAGA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;;;;;;;;;;;;ACRA;AACA;AACA;AAGA;AACA;AAGA;AACA;AACA;AAKA;AAOA;AAKA;AAKA;AAKA;AAIA;AAKA;AAKA;AACA;AAkBA;AAAA;AAAA;AAAA;AAQA;AACA;AACA;AAEA;AACA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAmDA;AAjDA;AACA;AAUA;AACA;AAKA;AAIA;AAEA;AAEA;AAEA;AASA;AACA;AACA;AAGA;AAOA;AArFA;AACA;AACA;AACA;AACA;AACA;AAiFA;AAAA;AAEA;AACA;;;;;;;;;;;;;;ACjKA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AASA;AAAA;AACA;AAQA;AAGA;;;;;;;;;;;;;;;;;;;;;;;ACvBA;AACA;AACA;AAEA;AACA;AAGA;AACA;AAGA;AAGA;AAMA;AAOA;AAEA;AAaA;AAAA;AACA;AACA;AAEA;AAEA;AACA;AACA;AACA;AAGA;AAOA;;;;;;;;;;;;;;;;;;;;;;;;;;AC9DA;AACA;AACA;AACA;AAEA;AACA;AAwBA;AACA;AAEA;AACA;AACA;AAGA;AAEA;AACA;AACA;AAGA;AAEA;AACA;AACA;AAGA;AAEA;AACA;AACA;AAGA;AAEA;AACA;AACA;AAIA;AAEA;AACA;AACA;AAIA;AAEA;AACA;AACA;AAGA;AAEA;AACA;AACA;AAGA;AAEA;AACA;AACA;AAIA;AACA;AAOA;AAQA;AASA;AAYA;AAMA;AAUA;AACA;AAEA;AAAA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AAGA;AAEA;AAGA;AAKA;AAWA;AACA;AACA;AACA;AACA;AAEA;AAKA;AACA;AACA;AACA;AAEA;;AAAA;AAIA;AAQA;AAAA;AACA;AACA;AAEA;AACA;AACA;AAEA;AAEA;AACA;AAGA;AAOA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AAGA;AAIA;AACA;;;;;;;;;;;;;;;;;;;;;ACrRA;AACA;AAOA;AAAA;AACA;AACA;AAEA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AAUA;;;;;;;;;;;;;;;;;;;;;;;;;;AClCA;AACA;AACA;AACA;AACA;AAiBA;;AAEA;AACA;AAAA;AAaA;AAAA;AAoCA;AACA;AAWA;AAEA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AAtEA;;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AACA;AAEA;AAAA;AACA;AAEA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AAwCA;AACA;AAWA;AASA;AACA;AACA;AAWA;AAxHA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAiHA;AAAA;AA1HA;AA4HA;;;;;;;;;;;;;;;;;;;;;;;;ACpJA;AAEA;AAEA;AACA;AACA;AAYA;AACA;AAGA;AAKA;AAEA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AAEA;AAEA;AACA;AASA;AACA;AACA;AAGA;AAQA;AAQA;AAGA;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;ACrFA;AACA;AACA;AACA;AACA;AACA;AAEA;AAEA;AACA;AACA;AAEA;AACA;AACA;AAGA;AASA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AAQA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AAAA;AACA;AACA;AAEA;AAAA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AAEA;AACA;AAEA;AACA;AACA;AAEA;AAUA;AACA;AAEA;AAIA;AACA;AACA;AACA;AAEA;AACA;AAEA;AAQA;AAIA;AAaA;AAGA;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AC7KA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAgBA;AACA;AAEA;AACA;AACA;AAIA;AAEA;AACA;AACA;AAIA;AAEA;AACA;AACA;AAIA;AAEA;AACA;AACA;AAIA;AAEA;AACA;AACA;AAIA;AAEA;AACA;AACA;AAIA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AAIA;AACA;AAMA;AAMA;AASA;AAGA;AAMA;AAIA;AAIA;AACA;AAEA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AAGA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AAUA;AAGA;AAEA;AAOA;AACA;AACA;AACA;AAEA;AAEA;AAIA;AAIA;AACA;AAGA;AACA;;AAAA;AAIA;AAIA;AAGA;;;;;;;;;;;;;;;;;;;;;;;ACxNA;AACA;AAEA;AACA;AAOA;AAAA;AACA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AAIA;AAEA;AACA;AACA;AAGA;;;;;;;;;;;;;;;;;;;;;;;;;;;AChCA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AAEA;AASA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AAAA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AAEA;AACA;AACA;AACA;AACA;AAGA;AAEA;AACA;AACA;AAEA;AAEA;AAoBA;AAOA;AAEA;;;;;;;;;;;;;;AClFA;AAAA;AAAA;AAAA;AA2BA;AA1BA;AACA;AACA;AAEA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AAAA;AACA;AACA;;;AAAA;AAEA;AAAA;AACA;AACA;;;AAAA;AACA;AAAA;;;;;;;;;;;;;;;;;;;;;;AC3BA;AAEA;AACA;AAEA;AAAA;AACA;AAEA;AACA;AAYA;AAEA;AACA;AAOA;AAEA;AAEA;AACA;AASA;AACA;AAGA;AAWA;;;;;;;;;;;;;AC5DA;AAAA;AAAA;AAAA;AAAA;AAWA;AAAA;AACA;AAEA;AACA;AAEA;AAEA;AAUA;AAEA;AACA;AAOA;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;ACvCA;AAEA;AACA;AACA;AACA;AACA;AAGA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AAEA;AAEA;;AAEA;AACA;AACA;AAEA;AACA;AACA;AAKA;AACA;AAOA;;AACA;AACA;AACA;AACA;AAEA;AAEA;AAIA;AAIA;AACA;AACA;;AAEA;AACA;AAEA;AACA;AACA;;AAEA;AAEA;AAEA;AACA;AACA;AACA;AAEA;AASA;AAIA;AAIA;AAEA;AASA;AAEA;AACA;AACA;AACA;AACA;AAGA;AAEA;AACA;AACA;AAEA;AACA;;AAKA;AAIA;AAGA;AAEA;AAMA;AAGA;AAAA;AASA;AACA;AACA;AACA;AACA;AAKA;AACA;AAEA;AAKA;AACA;AAKA;AAOA;AAEA;AACA;AACA;AAKA;AAMA;;;;;;;;;;;;;;;;;;;;;ACpNA;AAEA;AAEA;AAAA;AACA;AAEA;AACA;AAOA;AAKA;AAAA;AAKA;AACA;AAOA;AACA;AAUA;;;;;;;;;;;;;;;;;;;;;;AC5CA;AAEA;AACA;AACA;AAGA;AAAA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AAIA;AAEA;AACA;AACA;AAEA;AAIA;AAEA;AAEA;AAQA;AACA;AAKA;AACA;AAIA;AACA;AAUA;AAEA;AAQA;AAYA;;;;;;;;;;;;;;;;;;;;;;;ACtFA;AAEA;AACA;AACA;AAgBA;AACA;AACA;AAEA;AACA;AACA;AAGA;AACA;AAKA;AAWA;AAQA;AAIA;AACA;AAEA;AACA;AAOA;AACA;AAEA;AAaA;AACA;AACA;AACA;AAGA;AAGA;;;;;;;;;;;;;;AC9FA;AAAA;AAAA;AAAA;AAAA;AAMA;AAAA;AACA;AACA;AAEA;;;;;;;;;;;;;;;;;;;;;;ACVA;AACA;AACA;AAoBA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA;;AAkBA;AAhBA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AAAA;;AAQA;AAAA;AAAA;;AAiCA;AA3BA;AACA;AAEA;AAEA;AACA;AACA;AACA;AAEA;AACA;AAEA;AACA;AACA;AACA;AAIA;AAEA;AACA;AAGA;AA/BA;AACA;AACA;AACA;AA6BA;AAAA;AAjCA;;;;;;;;;;;;;;;;;;;;;ACpDA;AAEA;AACA;AAEA;AACA;AAIA;AAMA;AAAA;AAAA;AAEA;AACA;AACA;AACA;AACA;AANA;AAWA;;;;;;;;;;;;;;;;;;;;;;AC3BA;AACA;AAEA;AAUA;AACA;AACA;AACA;AAEA;;;AAGA;AACA;AACA;AAQA;AAEA;AAGA;AAKA;AAEA;AACA;;;;;;;;;;;;;;;;;;;;;;AC5CA;AACA;AACA;AAYA;AACA;AASA;AACA;AACA;AACA;AAEA;AAEA;AACA;AAEA;AACA;AAMA;;;;;;;;;;;;;ACzCA;AAAA;AAAA;AAAA;AAAA;AASA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AAAA;;AACA;AACA;AACA;AACA;AAEA;AAEA;AACA;AACA;AACA;AAIA;AAEA;;;;;;;;;;;;;;;;;;;;;;;;;;;ACpCA;AACA;AACA;AACA;AACA;AACA;AAIA;AAcA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AAIA;AACA;AACA;AAKA;AAEA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AAMA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAKA;AAAA;AACA;AACA;AAEA;AACA;AA6BA;AAGA;AACA;AAGA;AAMA;AACA;AAeA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAGA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;;;;;;;;;;;;;;AChKA;AAEA;AACA;AACA;AACA;AASA;AACA;AACA;AACA;AACA;AAMA;AAMA;AAIA;AAoCA;AAgBA;AACA;AAEA;AACA;AAQA;AACA;AAEA;AAEA;AAOA;AACA;AACA;AACA;AAGA;AACA;AACA;AAEA;AACA;AAKA;AAEA;;;;;;;;;;;;;;;;;;;;;;;;;AChIA;AACA;AACA;AACA;AAEA;AAsBA;AACA;AACA;AAKA;AAKA;AAGA;AAGA;AACA;AAEA;AACA;AAUA;AACA;AACA;AAEA;AACA;AAEA;AACA;AACA;AACA;AAEA;AAEA;AAKA;AACA;AACA;AAEA;AAKA;AAEA;AAKA;;;;;;;;;;;;;;;;;;;;;;;AC9FA;AACA;AAEA;AAOA;AACA;AACA;AAuBA;AAGA;AACA;AAEA;AAAA;AACA;AACA;AAEA;AAEA;AACA;AAGA;;;;;;;;;;;;;;ACnDA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;;AAEA;;AAEA;AACA;AAEA;AAEA;AACA;AACA;AAGA;AACA;AAEA;AAAA;AACA;AACA;AACA;AACA;;;;;;;;;;;;;;;;;;;;;;;;;;ACrBA;AAEA;AACA;AACA;AACA;AACA;AAwBA;AAAA;AACA;AACA;AACA;AAEA;AACA;AAeA;AACA;AACA;AAgBA;AACA;AAkDA;AA4BA;AAIA;AAgCA;AAWA;AAYA;AAKA;AACA;AAEA;AACA;AACA;;;;AAIA;AACA;AACA;AAEA;AACA;AAEA;AAEA;AAEA;AACA;AAMA;AAKA;AACA;AACA;AAGA;AAEA;AACA;AAKA;AAGA;;;;;;;;;;;;;;;;;;;;;;;ACpQA;AACA;AAEA;AAOA;AACA;AACA;AASA;AAMA;AACA;AAEA;AAAA;AACA;AACA;AAEA;AAEA;AACA;AACA;AAIA;;;;;;;;;;;;;;;;;;;;;;;AC1CA;AACA;AAEA;AAOA;AACA;AACA;AAMA;AACA;AAEA;AAAA;AACA;AACA;AAEA;AAKA;;;;;;;;;;;;;;AC9BA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AAMA;AAAA;AACA;AACA;AACA;;;;;;;;;;;;;;;;;;;;;;ACVA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AAEA;AAcA;;;;;;;;;;;;;;;;;;;;;;;;;ACxBA;AACA;AACA;AACA;AACA;AACA;AAYA;AAEA;AAEA;AACA;AA2BA;AAMA;AACA;AAGA;AACA;AACA;AACA;AACA;AAEA;AACA;AAGA;;;;;;;;;;;;;;;;;;;;;;;;ACrEA;AACA;AACA;AACA;AAMA;AAAA;AACA;AACA;AAEA;AAKA;AAMA;AAAA;AACA;AACA;AACA;AAEA;AAGA;;;;;;;;;;;;;;;;;;;;;;;AChCA;AAEA;AAEA;AACA;AACA;AAEA;AACA;AACA;AACA;AAOA;AACA;AACA;AAOA;AACA;AACA;AACA;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AC9BA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AA0EA;AAEA;AAQA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AAYA;AAEA;AACA;AAqCA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AAWA;AACA;AAIA;AACA;AACA;AACA;AAGA;AAEA;AACA;AAEA;AACA;AAEA;AAKA;AAUA;AAGA;AAEA;AAIA;AAEA;AASA;AAQA;;;;;;;;;;;;;;;;;;;;;;;;;;ACnUA;AACA;AACA;AACA;AAEA;AACA;AAMA;AACA;AACA;AACA;AAEA;AAEA;AAKA;AAEA;AAWA;AAEA;AACA;AACA;AACA;AAOA;AACA;AAEA;AAKA;;;;;;;;;;;;;;;;;;;;;ACzDA;AACA;AAGA;AAeA;AACA;AAEA;AACA;AACA;AAGA;AACA;AAWA;AAGA;AAGA;AACA;AAEA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AAoBA;AACA;AACA;AACA;AACA;;AAiBA;AAvCA;AACA;AACA;AACA;AAAA;AACA;AAEA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AAQA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AAAA;AAEA;AAGA;AACA;AAAA;AAEA;;;;;;;;;;;;;;;;;;;;;;;;;;;AC9FA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAGA;AACA;AAUA;AAUA;AAMA;AACA;AAWA;AACA;AACA;AACA;AAEA;AAEA;AAEA;AACA;AAIA;AACA;AAIA;AAIA;AAEA;AACA;AACA;AAEA;AAEA;AACA;AAEA;AACA;AAIA;;;;;;;;;;;;;;AC3FA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;;;;;;;;;ACVA;AACA;AACA;AAGA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AAMA;AAYA;AAUA;AAQA;AASA;AAGA;AAKA;AAUA;AAGA;AACA;;;;;;;;;;;;;;AChFA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AAAA;AACA;AACA;AAFA;AAGA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;;;;;;;;;;;;AC1BA;AACA;AAEA;AACA;AAQA;AACA;AACA;AAmCA;AASA;AACA;AACA;AAAA;AACA;AACA;AAEA;AAQA;AACA;AACA;AACA;AAGA;;;;;;;;;;;;;;;;;;;;;;;AC9EA;AAIA;AAOA;AAMA;AAAA;AACA;AACA;AAEA;AAqBA;AAEA;AACA;AACA;AAGA;AAGA;AAGA;AAGA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;;;AC3FA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAEA;AACA;AACA;AACA;AAEA;AACA;AACA;AAEA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;;AC1BA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;;;;;;;;;;;;;;;;;;;;;;;ACnBA;AACA;AACA;AAUA;AAaA;AAEA;AAAA;AAAA;AAAA;AAwJA;AACA;AACA;AAEA;AAEA;AAKA;AAGA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAOA;;AAmBA;AAtLA;AACA;AACA;AAEA;AACA;AACA;AAEA;;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AAEA;;AACA;AAEA;AACA;AAEA;AAEA;AACA;AACA;AAIA;AACA;AACA;AACA;AACA;AAEA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AAEA;AACA;AACA;AAAA;AACA;AACA;AACA;AAkCA;AACA;AAGA;AACA;AACA;AACA;AACA;AACA;AACA;AAMA;AArMA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAwLA;AAAA;AAzMA;AAiNA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;;;;;;;;;;;;;;;;ACxPA;AACA;AACA;AACA;AACA;AACA;AAWA;AACA;AACA;AA2BA;AAAA;AAAA;AAAA;AASA;AACA;AACA;AACA;AAEA;AAuBA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAuBA;AACA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AAEA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AAIA;AAIA;AACA;AACA;AACA;AACA;AAEA;AAEA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AAIA;AAIA;AAEA;;AACA;AACA;AAEA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AAEA;AACA;AACA;AACA;;AAyHA;AAxUA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AA0BA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAGA;AAkJA;AACA;AACA;AACA;AAEA;AAaA;AACA;AACA;AAEA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AAKA;AAAA;AACA;AACA;AACA;AACA;AAEA;AAAA;AACA;AACA;AACA;AACA;AACA;AAEA;AAKA;AACA;AAEA;AACA;AACA;AAGA;AAvVA;AACA;AACA;AACA;AACA;AACA;AACA;AAkVA;AAAA;AAzVA;AA2VA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AAEA;;;;;;;;;;;;;;;;;;;;;;;;AClaA;AACA;AACA;AACA;AAEA;AAUA;AAWA;AACA;AAOA;AACA;AAEA;AACA;AACA;AAIA;AAEA;;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AAKA;AACA;AACA;AAEA;AACA;AAQA;AACA;AACA;AACA;AAQA;AAaA;AAEA;AACA;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AClGA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AAYA;AACA;AAUA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AAIA;AAIA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AAEA;AACA;AACA;AAIA;AAkBA;AACA;AACA;AACA;AAUA;AACA;AAQA;AACA;AACA;AACA;AAMA;AAEA;;;;;;;;;;;;;;;;;;;;;;;;;;;AC1HA;AACA;AACA;AAGA;AACA;AACA;AACA;AAWA;AACA;AAKA;AAEA;AAEA;AAIA;AACA;AACA;AACA;AAIA;AAEA;AACA;AACA;AACA;AAUA;AAGA;AAEA;AACA;AACA;AAOA;AAIA;AAIA;AAGA;AAGA;AACA;AAEA;AACA;AAMA;AACA;AACA;AAEA;AACA;AACA;AAIA;AACA;AACA;AACA;AAIA;AAEA;AACA;AACA;AACA;AAGA;;AAAA;AAIA;AACA;AACA;AAKA;AAGA;;;;;;;;;;;;;;;;;;;;;;;;ACpIA;AAEA;AACA;AAkBA;AAAA;AACA;AAAA;AAGA;AAEA;AACA;AACA;AACA;;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AAEA;AAIA;AACA;AAAA;AAEA;AACA;AAEA;AACA;AACA;AAEA;AAKA;AACA;AAAA;AAEA;AAEA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AAAA;;;;;;;;;;;;;;ACpFA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAEA;AACA;AAGA;AACA;AAKA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AAAA;AACA;AACA;AACA;AAEA;;;;;;;;;;;;;AC3BA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AAEA;AAEA;AAEA;AAGA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AACA;AAEA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AAEA;;;;;;;;;;;;;;;;;;;;;;;ACzCA;AACA;AAEA;AACA;AACA;AASA;AACA;AACA;AAGA;AAGA;AAIA;AAGA;AAGA;AAGA;AAGA;AAIA;AACA;AAEA;AAAA;AACA;AACA;AACA;AAEA;AAEA;AAGA;AACA;AAGA;AAOA;AAAA;AACA;AACA;AACA;AAEA;AAKA;AACA;AACA;AAGA;;;;;;;;;;;;;;ACjFA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AAMA;AAGA;AAAA;;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AAEA;AAGA;AACA;AACA;AACA;AACA;AACA;AAIA;AAEA;;;;;;;;;;;;;;;;;;;;;;;;AC3CA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;;AAEA;AACA;AAGA;AAEA;AACA;AACA;AAiBA;AAAA;AAAA;AACA;AAKA;AAIA;AAIA;AAdA;AAgBA;AAAA;AAAA;AACA;AACA;AAEA;AACA;AAEA;AAEA;AAwBA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AAEA;AACA;AAkBA;AAEA;AACA;AAOA;AACA;AACA;AACA;AAUA;;;;;;;;;;;;;;ACxIA;AAAA;AAAA;AAAA;AAAA;AAEA;;;;;AAKA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AAAA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AAWA;;;;;AAKA;AACA;AACA;AACA;AAEA;AACA;;AAKA;AAEA;AAEA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AAEA;AACA;AACA;AAEA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;;;;;;;;;;;;;;;;;;;;;AC9FA;AACA;AACA;AAUA;AACA;AACA;AAUA;AACA;AAEA;AAAA;AACA;AACA;AACA;AAEA;;;;;;;;;;;;;;;;;;;;;;;;AChCA;AACA;AACA;AAGA;AAAA;AACA;AACA;AACA;AAiBA;AAAA;AAAA;AAAA;AAKA;AACA;AACA;AAUA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;AACA;AACA;AACA;;AAAA;;;AAEA;AACA;AACA;;;;AACA;AACA;AACA;AACA;AACA;;AAeA;AAnDA;AAAA;AACA;AACA;;;AAAA;AAEA;AAAA;AACA;AACA;;;AAAA;AAgCA;AACA;AACA;AACA;AACA;AAEA;AAEA;AACA;AAGA;AA1DA;AACA;AACA;AAyDA;AAAA;AA5DA;;;;;;;;;;;;;;;;;;;;ACzBA;AACA;AAUA;AAAA;AAAA;AAAA;AACA;AAiBA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;;AAMA;AA/BA;AACA;AACA;AAEA;AACA;AACA;AAqBA;AACA;AACA;AACA;AArCA;AACA;AACA;AACA;AACA;AACA;AAiCA;AAAA;AAzCA;;;;;;;;;;;;;ACXA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AAEA;;AAEA;AACA;AACA;AACA;AAEA;;AAEA;AACA;AACA;AACA;AACA;AAEA;;;;AAIA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;;AAEA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AAEA;;AAEA;AACA;AACA;AACA;AAEA;;;AAGA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;;ACtHA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AAEA;AAEA;AAEA;AACA;AACA;AAEA;AACA;AAEA;AAEA;AACA;AACA;AACA;AAQA;AACA;AACA;AACA;AAEA;;;;;AAKA;AACA;AASA;;;;;;;;;;;;;;;;;;;;;;;;;;;AA2BA;AACA;AAEA;AACA;AAFA;AACA;AACA;AACA;AAxCA;AACA;AAEA;AACA;AAEA;AAmCA;AAKA;AAHA;;AAEA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AAEA;;AAEA;AACA;AACA;AACA;;;AAPA;AAYA;AAHA;;AAEA;AACA;AACA;AAEA;AAEA;;;AAAA;AAKA;AAHA;;AAEA;AACA;AACA;AACA;;;AAAA;AAKA;AAHA;;AAEA;AACA;AACA;AACA;;;AAAA;AAMA;AAJA;;;AAGA;AACA;AACA;AACA;;;AAAA;AAKA;AAHA;;AAEA;AACA;AACA;AACA;;;AAAA;AAKA;AAHA;;AAEA;AACA;AACA;AACA;;;AAAA;AAMA;AAJA;;;AAGA;AACA;AACA;AACA;;;AAAA;AAKA;AAHA;;AAEA;AACA;AACA;AACA;;;AAAA;AAMA;AAJA;;;AAGA;AACA;AACA;AACA;;;AAAA;AAMA;AAJA;;;AAGA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;;;AAAA;AAEA;;;AAGA;AACA;AACA;AAEA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AAEA;;;;AAIA;AACA;AAAA;AACA;AACA;AACA;AAEA;AACA;AAEA;AACA;AAEA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AAEA;AACA;AACA;AAEA;;;;AAIA;AACA;AAAA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AAEA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AAEA;AACA;AACA;AAAA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AAEA;AACA;AAEA;;;AAGA;AACA;AAAA;AAAA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AAEA;AAEA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AAEA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;;;AAGA;AACA;AAAA;AACA;AAGA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;;;;;;;;;;;;;;AC1aA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AAEA;AAAA;AACA;AACA;AACA;AAkCA;;;;;;;;;;;;;;;;;;;;;;;;AC1CA;AAEA;AACA;AACA;AACA;AACA;AAGA;AACA;AAMA;AAMA;AAGA;AAIA;AAEA;AACA;AAKA;AACA;AAEA;AACA;AACA;AAEA;AAEA;AAEA;AACA;AAEA;AACA;AAMA;AAEA;;;;;;;;;;;;;;;;;;;;;;;AC5DA;AACA;AACA;AACA;AAUA;AACA;AAMA;AACA;AACA;AAEA;AACA;AAIA;AAEA;AAUA;AAUA;AAAA;AAEA;AAFA;AAOA;AAEA;;;;;;;;;;;;;;;;;;;;;;;;;AC5DA;AACA;AACA;AACA;AACA;AAEA;AAAA;AACA;AAMA;;AAAA;AAGA;AAEA;AAEA;AAAA;AACA;AACA;AACA;AACA;AACA;AAEA;;;;;;;;;;;;;;;;;;;;;;AC3BA;AACA;AAEA;AASA;AACA;AAQA;AAEA;AAYA;AACA;AAEA;AAUA;AACA;AACA;AACA;AAEA;AACA;AAYA;AAGA;AAEA;AAIA;AAGA;AAIA;;;;;;;;;;;;;;AClFA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AAOA;AAAA;AACA;AACA;AAEA;;;;;;;;;;;;;;;;;;;;;ACZA;AACA;AACA;AAaA;AAAA;AAAA;AACA;AAMA;AAGA;AAVA;AAYA;AAAA;AACA;AACA;AACA;AAEA;AACA;AACA;AAEA;AAGA;AAKA;AAGA;AACA;AAAA;;;;;;;;;;;;;;;;;;;;;;AChDA;AACA;AAEA;AAAA;AAAA;;AAIA;AAHA;AACA;AACA;AACA;AAAA;;;;;;;;;;;;;;;;;;;;;ACPA;AACA;AAEA;AAAA;AAAA;;AAIA;AAHA;AACA;AACA;AACA;AAAA;;;;;;;;;;;;;;ACPA;AAAA;AAAA;AAAA;AAAA;AAMA;AAAA;AAAA;AAEA;;AAAA;AAFA;;;;;;;;;;;;;;;;;;;;;;;;;;;ACNA;AACA;AACA;AACA;AAYA;AACA;AACA;AACA;AAEA;AACA;AAqBA;AACA;AACA;AACA;AAIA;AAMA;AAIA;AACA;AAEA;AAAA;AAAA;AAAA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AAEA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;;AA4FA;AA1FA;AAAA;AACA;AAWA;AACA;AACA;AACA;AACA;AACA;AAEA;AAMA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AAKA;AACA;AACA;AAWA;AAEA;AAEA;AAKA;AACA;AACA;AAOA;AACA;AACA;AAFA;AAMA;AACA;AAEA;AAWA;AACA;AAAA;AAEA;AACA;;;;;;;;;;;;;;;;;;;;;;;;;AChOA;AACA;AAIA;AACA;AACA;AAEA;AACA;AAkBA;AACA;AACA;AAMA;AAIA;AAIA;AACA;AAEA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAqEA;AAnEA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;;AACA;AACA;AACA;AACA;AACA;AAGA;AACA;AAGA;AAEA;AACA;AAMA;AACA;AAUA;AACA;AACA;AACA;AACA;AACA;;AAGA;AACA;AAIA;AACA;AAYA;AACA;AAAA;AAEA;AACA;;;;;;;;;;;;;;;;;;;;;;;;ACpJA;AACA;AAIA;AACA;AACA;AAEA;AACA;AAEA;AAEA;AACA;AAEA;AACA;AACA;AAGA;AACA;AAOA;AAKA;AASA;AAIA;AAIA;AACA;AAUA;AAAA;AAAA;;AAuCA;AAtCA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AAEA;AAEA;AACA;AACA;;AAAA;;AAAA;;AAAA;AAGA;AACA;AAGA;AACA;AAMA;AACA;AAAA;AAEA;AACA;;;;;;;;;;;;;;;;;;;;;;ACzGA;AACA;AAEA;AAGA;AACA;AAIA;AAKA;AAKA;AAMA;AAKA;AAMA;AAMA;AAOA;AASA;AAAA;AACA;AACA;AACA;AACA;AACA;AAEA;AAEA;AACA;AAGA;AACA;AAEA;AACA;AAIA;AAEA;;;;;;;;;;;;;;;;;;;;;;;;;ACnFA;AACA;AAGA;AAGA;AACA;AAEA;AACA;AAEA;AACA;AACA;AAKA;AAWA;AAOA;AACA;AAMA;AAAA;AACA;AACA;AAEA;AACA;AAEA;AAGA;AAEA;AAGA;AACA;AACA;AAEA;AAKA;AAGA;AAEA;AACA;;;;;;;;;;;;;;;;;;;;;AC3EA;AACA;AAWA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AAWA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA;;AAmCA;AAjCA;AACA;AACA;AACA;AAEA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AAEA;AACA;AAAA;AAQA;AACA;AAAA;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AC1EA;AAEA;AAEA;AAOA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AAyBA;AACA;AACA;AACA;AAIA;AAIA;AACA;AACA;;;;;;AAMA;AACA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;;;AAGA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAiHA;AA/GA;;AAMA;AAeA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AAEA;AAMA;AAKA;AACA;AAEA;AAGA;AAKA;AAKA;AAEA;AAGA;AAaA;AAeA;AAEA;AAAA;AACA;AAEA;AACA;AAEA;AACA;AACA;AACA;AAIA;AAEA;AACA;AACA;AAAA;AAEA;AACA;;;;;;;;;;;;;;;;;;;;;;;;;;;AC5NA;AAEA;AAEA;AAGA;AAEA;AACA;AACA;AACA;AAWA;AACA;AAEA;AACA;AACA;AAGA;AAEA;AACA;AACA;AAIA;AAEA;AACA;AACA;AAGA;AAEA;AACA;AACA;AAIA;AACA;AAaA;AAOA;AAIA;AACA;AAeA;AACA;AAKA;AACA;AAEA;AAEA;;AAKA;AACA;AACA;AAgBA;AAEA;AACA;AAQA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AAEA;AAGA;AACA;AACA;AACA;AACA;AAIA;AASA;AAGA;AAKA;AAGA;AAEA;AACA;AAOA;AAEA;AACA;AAcA;AAeA;;;;;;;;;;;;;;;;;;;;;;;;;;ACvOA;AACA;AACA;AACA;AAkCA;;;;;AAKA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;;AAAA;AAEA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AAEA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;;;AACA;AAEA;AACA;AAIA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;;;AAGA;AAEA;AACA;AACA;AACA;;;;;;;AAAA;AAIA;AACA;AACA;AACA;AACA;AACA;AACA;AAGA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AC3LA;AACA;AACA;AACA;AACA;AAEA;AACA;AAEA;AAEA;AACA;AACA;AAEA;AACA;AACA;AAeA;AACA;AAEA;AACA;AACA;AAIA;AACA;AAIA;AAMA;AADA;AACA;AAEA;AAIA;AAIA;AACA;AAEA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA;;AAmEA;AAjEA;;AACA;AAaA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AAQA;AACA;AACA;AACA;AAGA;AAeA;AAEA;AACA;AAKA;AACA;AAAA;AAEA;AACA;;;;;;;;;;;;;;;;;;;;;;;;;;;AC3IA;AACA;AACA;AAGA;AACA;AAEA;AACA;AAEA;AACA;AAwBA;AAAA;AAAA;AAAA;AACA;AAOA;AACA;AACA;AAqBA;AACA;AACA;;AA4FA;AAjHA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AAMA;AACA;AAiBA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AAEA;AAEA;AACA;AACA;AACA;AAkBA;AACA;AACA;AAiBA;AAEA;;AAAA;AAAA;AAOA;AAzHA;AACA;AACA;AACA;AAuHA;AAAA;AAEA;AACA;;;;;;;;;;;;;;;;;;;;;ACpKA;AACA;AAGA;AACA;AAEA;AACA;AACA;AACA;AACA;AAOA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AAOA;AAKA;AAMA;AAIA;AACA;AA+BA;AAMA;AAeA;AAOA;AAKA;AAKA;AAIA;AACA;AAQA;AAQA;AAMA;AAOA;AAKA;AASA;AACA;;;;;;;;;;;;;;;;;;;;;;;;;ACxLA;AACA;AACA;AACA;AAEA;AAGA;AACA;AAeA;AAWA;AAMA;AAKA;AAOA;AAIA;AAMA;AAeA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;;AAqCA;AAnCA;AACA;AACA;AAEA;AAEA;AACA;AAGA;AAEA;AACA;AACA;AAEA;AACA;AACA;AAEA;AAEA;AACA;AACA;AACA;AACA;AAGA;AAEA;AAGA;AACA;AAAA;;AAEA;;;;;;;;;;;;;;AC9HA;AAAA;AAAA;AAAA;AAAA;AAOA;AAAA;AACA;AACA;;;;;;;;;;;;;ACTA;AAAA;AAAA;AAAA;AAAA;AACA;AASA;AACA;AAEA;AAEA;AACA;AACA;AAEA;AAMA;AACA;AAEA;AAMA;AAGA;;;;;;;;;;;;;;;;;;;;;;;;;ACrCA;AACA;AACA;AACA;AAEA;AAEA;AAAA;AACA;AACA;AACA;AAWA;AAAA;AAAA;;AA2HA;AA7GA;AACA;AACA;AAEA;AACA;AACA;AAEA;AAAA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AAEA;AACA;AACA;AAEA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AAEA;AAEA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AAAA;AACA;AAEA;AACA;AAEA;AAIA;AACA;AACA;AAEA;AAEA;AACA;AACA;AASA;AAAA;AACA;AAEA;AACA;AAIA;AACA;AApHA;AACA;AACA;AACA;AACA;AACA;AACA;AA+GA;AAAA;AA3HA;;;;;;;;;;;;;;;;;;;;;ACrBA;AACA;AAOA;AAAA;AAIA;AAAA;AAHA;AAKA;AAEA;AACA;AACA;AAEA;AACA;;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AACA;AAAA;;;;;;;;;;;;;;;;;;;;;;;;;;;;AC/BA;AACA;AAGA;AACA;AACA;AAEA;AAUA;AA6BA;;;;;AAKA;AACA;AAAA;AAOA;AAAA;AAJA;AACA;AACA;AAgEA;;AAEA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AAEA;AACA;AACA;AACA;AAEA;AACA;AAEA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AA5HA;AAEA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAGA;AACA;AACA;AACA;AACA;AACA;AACA;;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AAqEA;AAAA;AACA;AACA;AACA;AACA;AAEA;AAEA;AACA;AAMA;AACA;AACA;AACA;AASA;AACA;AAAA;;AAEA;;;;;;;;;;;;;;;;;;;;;;;;;;;AC3NA;AACA;AAEA;AACA;AACA;AACA;AAEA;AAEA;AAEA;AACA;AACA;AAMA;AACA;AAeA;AAAA;AAKA;AAAA;AAIA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAtBA;AAwBA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AAEA;AAEA;AACA;AAIA;AAIA;AAIA;AAWA;AArEA;AACA;AACA;AAoEA;AAAA;AAvEA;AAyEA;;;;;;;;;;;;;;;;;;;;;;;AC7GA;AACA;AACA;AAeA;AACA;AACA;AACA;AACA;AAEA;;;;;AAKA;AACA;AACA;AAQA;AAOA;AAOA;AAeA;AAEA;AACA;;;;;;;;;;;;;;;;;;;;;;;ACtEA;AACA;AACA;AAEA;AAQA;AACA;AAQA;AAEA;AACA;AACA;AAWA;AAEA;AAQA;AACA;AACA;AAGA;;;;;;;;;;;;;;;;;;;;;;;;ACnDA;AACA;AACA;AACA;AAEA;AAQA;AAAA;AACA;AAQA;AACA;AACA;AAEA;AACA;AACA;;;;;AAGA;AACA;;AAAA;AACA;AACA;;;;AACA;AAUA;AAEA;AAQA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AAGA;;;;;;;;;;;;;;;;;;;;;;;;ACnEA;AACA;AACA;AACA;AACA;AAQA;AAEA;AACA;AAOA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AAEA;AACA;AAWA;AAEA;AAIA;AAOA;AACA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AAGA;;;;;;;;;;;;;;;;;;;;;;;;ACzEA;AACA;AACA;AAEA;AAYA;AACA;AAQA;AAEA;AACA;AACA;AAEA;AAEA;AAiBA;;;;;;;;;;;;;;AClDA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;ACLA;AAEA;AACA;AACA;AACA;AACA;AAAA;AAAA;AAKA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAZA;AAkBA;AACA;;;;;;;;;;;;;;;;;;;;ACzBA;AACA;AAUA;AACA;AAEA;AAQA;AACA;AACA;AACA;AACA;AAIA;AAmBA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA;;AA2CA;AAzCA;AACA;AAeA;AAKA;AAmBA;AACA;AAAA;;;;;;;;;;;;;;;;;;;;;AChGA;AAEA;AACA;AACA;AAEA;AACA;AACA;AAEA;AAKA;AAEA;;;;;;;;;;;;;;;;;;;;ACjBA;AAEA;AACA;AACA;AAQA;AACA;AACA;AAEA;AACA;AAIA;AAEA;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;ACvBA;AACA;AACA;AAEA;AACA;AACA;AAGA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AAEA;AAyBA;AACA;AAEA;AAKA;AACA;AAAA;AAAA;;AA6GA;AAtFA;AACA;AA+BA;AACA;AACA;AACA;AAEA;AACA;AAEA;AACA;AACA;AACA;AAEA;AACA;AACA;AAGA;AAgCA;AAGA;AA3GA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAwFA;AAAA;AA7GA;AA+GA;AAAA;AAAA;;AA6FA;AA9EA;AACA;AA6BA;AACA;AACA;AACA;AAEA;AAEA;AAGA;AAKA;AACA;AACA;AACA;AACA;AAyBA;AAGA;AA3FA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAgFA;AAAA;AA7FA;AA2GA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAyBA;AAvBA;AACA;AACA;AAEA;AAEA;AACA;AACA;AAEA;AACA;AAEA;AAMA;AAAA;AACA;AACA;AACA;AACA;AAAA;;AAEA;;;;;;;;;;;;;;;;;;;;AClUA;AAEA;AACA;AACA;AAWA;AACA;AAEA;AAEA;AACA;AACA;AACA;AACA;AAEA;AAIA;AAEA;;;;;;;;;;;;;;;;;;;;;;;;;;AChCA;AACA;AACA;AACA;AAEA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AAQA;AAAA;AAIA;AAAA;AAEA;AACA;;AACA;AAEA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AAEA;AACA;AACA;AAEA;AACA;AAEA;AAEA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AAEA;AACA;AAEA;AACA;AACA;AACA;AAAA;;;;;;;;;;;;;;;;;;;;;;;;;ACpFA;AACA;AAEA;AACA;AACA;AACA;AAEA;AACA;AACA;AAUA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAQA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AAIA;;AA2CA;AAzCA;AACA;AACA;AAEA;AAEA;AAEA;AACA;AACA;AAMA;AAWA;AACA;AAYA;AACA;AAAA;;;;;;;;;;;;;;;;;;;;;;;;ACrGA;AACA;AAEA;AACA;AACA;AACA;AAEA;AACA;AAWA;AASA;AAAA;AACA;AAEA;AAGA;AACA;AAEA;AACA;AACA;AAEA;AAEA;AACA;AAIA;AAEA;AACA;AAIA;AAEA;AACA;AAIA;AACA;AACA;AAEA;AACA;AAMA;AAEA;;AAGA;AACA;AACA;AACA;AACA;AACA;;AAAA;AAIA;AAEA;AAWA;AACA;AACA;AAEA;AAEA;AASA;AAWA;AAWA;;;;;;;;;;;;;;;;;;;;;;;;;;;AC1IA;AACA;AAEA;AAuBA;AAEA;;AAKA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AAEA;AACA;;AACA;AAAA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;;;;;;;;;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AAAA;AACA;AACA;AACA;AACA;;;;;;;;;AACA;AACA;AAEA;;AACA;AACA;AACA;AACA;AAEA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AAEA;AACA;AACA;AACA;AAOA;AAEA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AAEA;AACA;AAEA;AACA;AAEA;AACA;AACA;AAEA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AAOA;AAIA;AAEA;;;AAGA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AAEA;AACA;AACA;AAEA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AAEA;AAKA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;;AAEA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AAKA;AACA;AAAA;AACA;AACA;AACA;AAKA;AACA;AAEA;AACA;;;;;;;;;;;;;ACjSA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AAEA;;;;;;;;;;;;;;;;;;;;;ACHA;AACA;AACA;AAEA;AACA;AACA;AAMA;AAHA;AAKA;AACA;AASA;AACA;AACA;AACA;AAEA;AAGA;;;;;;;;;;;;;;;;;;;;;;;;;;AChCA;AAEA;AACA;AAEA;AAEA;AAWA;AAAA;AAAA;AAAA;AAcA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;;AAmBA;AAzDA;AACA;AACA;AAEA;AACA;AACA;AAkCA;AACA;AAEA;AACA;AAYA;AA7DA;AACA;AACA;AACA;AA2DA;AAAA;AA/DA;;;;;;;;;;;;;;;;;;;;;;AClBA;AACA;AACA;AAmBA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;;AAyCA;AAvCA;AACA;AAWA;AACA;AACA;AAEA;AAEA;AACA;AAEA;AACA;AAEA;AACA;AAMA;AACA;AACA;AAKA;AACA;AAAA;;;;;;;;;;;;;;ACtEA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAEA;AACA;AAEA;AACA;AAEA;AACA;AACA;AAEA;AACA;AAEA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;;;;;;;;;;;;;;;;;;;;;;AC7BA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AAIA;AAEA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AACA;AAAA;AACA;AACA;AAEA;AAEA;AAaA;;;;;;;;;;;;;AC/DA;AAAA;AAAA;AAAA;AAAA;AAAA;AAEA;AAEA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;;;;;;;;;;;;;;;;;;;;;;;;;ACbA;AAEA;AACA;AACA;AACA;AAEA;AACA;AASA;AAAA;AACA;AACA;AAEA;;;AAOA;AAEA;AACA;AACA;AACA;AACA;AAaA;AAIA;AAEA;AAOA;AAKA;AAEA;AACA;AAEA;AACA;AACA;AAEA;AAEA;AACA;AAGA;;;;;;;;;;;;;;;;;;;;AChFA;AAGA;AAWA;AAAA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AAEA;AAKA;;;;;;;;;;;;;;;;;;;ACpCA;AAEA;AAeA;AAEA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AAIA;AAKA;AAMA;AAGA;AAMA;AACA;;;;;;;;;;;;;;AC/CA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;;;;;;;;;;;;;ACfA;AAEA;AACA;AACA;AACA;AAEA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AAEA;;AACA;AACA;;AAEA;AAAA;AACA;AACA;AACA;AACA;AACA;AAEA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;AAEA;AACA;;AACA;AAAA;AACA;AACA;AACA;AACA;;;;;;;;;AAEA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;;;;;;;;;;;ACtFA;AACA;AACA;AAeA;;AAEA;AACA;AAAA;AACA;AAAA;AAUA;AACA;AACA;AAEA;AACA;AAmBA;AACA;AACA;AAjCA;AACA;AACA;AACA;AACA;;AACA;AASA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AAMA;AACA;AACA;AACA;AAEA;AAOA;AAGA;;AAEA;;AAAA;;AACA;AAGA;AAKA;AACA;AAAA;;AAEA;;;;;;;;;;;;;;;;;;;;;ACxFA;AACA;AAEA;AASA;AACA;AACA;AAEA;AACA;AA0BA;AAkBA;AACA;AAEA;AAAA;AACA;AACA;AAEA;AAEA;AACA;AAGA;;;;;;;;;;;;;;;;;;;;;;AC1EA;AACA;AACA;AAOA;AACA;AACA;AAKA;AACA;AAEA;AAAA;AACA;AACA;AAEA;AACA;;;;;;;;;;;;;;;;;;;;;;ACxBA;AACA;AAEA;AAUA;AAAA;AACA;AAEA;AACA;AAKA;AAKA;AACA;AAEA;AAAA;AACA;AACA;AAEA;AAEA;AAGA;;;;;;;;;;;;;;;;;;;;;;;ACvCA;AACA;AACA;AACA;AASA;AAAA;AACA;AAEA;AACA;AAeA;AAIA;AACA;AACA;AAGA;AACA;AACA;AAEA;AAAA;AACA;AACA;AAEA;AAEA;AACA;AAGA;;;;;;;;;;;;;;;;;;;;;;;;;ACtDA;AACA;AACA;AACA;AACA;AACA;AAcA;AAAA;AACA;AAAA;AASA;AACA;AACA;AACA;AACA;AAEA;AACA;AAOA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AAQA;AAAA;AACA;AACA;AACA;AAEA;AACA;AACA;AAxDA;AACA;AACA;AACA;;AACA;AAsDA;AAAA;AACA;AAEA;AACA;AAMA;AAIA;AAEA;AAEA;AAQA;AACA;AAIA;AAEA;AACA;AACA;AAIA;AACA;AAAA;;;;;;;;;;;;;;;;;;;;;;;;;;;;;ACzHA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAgBA;AAEA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AAAA;AACA;AAAA;AASA;;AACA;AAEA;AACA;AAEA;AACA;;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;AAEA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AAEA;AACA;AAGA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AAGA;AAEA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AAEA;AACA;AACA;AACA;AAEA;AACA;AAEA;AAEA;AACA;AAGA;AAEA;AACA;AACA;AACA;AAEA;AACA;AAGA;AAEA;AACA;AACA;AAEA;AACA;AACA;AAIA;AACA;AAEA;AACA;AACA;AAEA;AACA;AAGA;AAQA;AAEA;AAIA;AACA;AAQA;AAEA;AAGA;AACA;AAMA;AAlKA;AACA;AAEA;;AACA;AAgKA;AAAA;AACA;AACA;AACA;AACA;AAEA;AACA;AAEA;AACA;AACA;AACA;AAEA;AACA;AAEA;AAIA;AAGA;AAGA;AAEA;AAMA;AACA;AAAA;;AAEA;;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;;ACzQA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AASA;AAAA;AACA;AAEA;AAWA;;;;;;;;;;;;;;;;;;;;;;;;;;;ACzBA;AACA;AACA;AAEA;AACA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AAGA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AAKA;AAGA;AAOA;AAaA;AAIA;AACA;AAEA;AACA;AACA;AAGA;AAMA;AACA;AAmBA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;;AA0EA;AAxEA;;AACA;AAYA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AAEA;AACA;AAEA;AAGA;AACA;AACA;AACA;AACA;AACA;AAKA;AAEA;AAYA;AAEA;AAEA;AAIA;AACA;AACA;AAMA;AACA;AAAA;;AAEA;;AAEA;AACA;AAGA;AAAA;AAAA;AAEA;AACA;AACA;AAJA;AAQA;AACA;AACA;AACA;AAEA;AACA;AACA;AAEA;AAEA;AACA;AAGA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AAEA;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;ACtQA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AAEA;AACA;AAoBA;AAMA;AAIA;AAWA;AACA;AAEA;AACA;AAEA;AACA;AAOA;AAKA;AACA;AAEA;AACA;AAEA;AACA;AAWA;AAgFA;AACA;AAEA;AACA;AAEA;AACA;AAMA;AAIA;AACA;AAYA;AACA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AAEA;AACA;AAIA;AAEA;AAEA;AACA;AACA;AACA;AACA;AAGA;AAGA;AAEA;AAAA;AACA;AACA;AAEA;AAEA;AACA;AAGA;AAEA;AACA;AACA;AACA;AAEA;AAcA;AAEA;AAAA;AACA;AACA;AAEA;AAEA;AAGA;AAKA;AAEA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AAEA;AACA;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AChTA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AAEA;AACA;AAqBA;AAWA;AAOA;AAGA;AACA;AAEA;AACA;AAEA;AACA;AAQA;AAKA;AAGA;AACA;AAEA;AACA;AACA;AAKA;AAGA;AAMA;AACA;AAEA;AACA;AAEA;AACA;AAUA;AAGA;AACA;AAoBA;AACA;AACA;AACA;AACA;AAEA;AAEA;AACA;AAEA;AACA;AACA;AAOA;AACA;AAUA;AAEA;AACA;AACA;AAEA;AACA;AAEA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AAEA;AAEA;AACA;AACA;AAEA;AAEA;AACA;AAOA;AAYA;AAEA;AACA;AACA;AACA;AAEA;AACA;AAEA;AAEA;AACA;AACA;AAEA;AAEA;AACA;AAWA;AAEA;AACA;AACA;AAEA;AAEA;AACA;AAKA;AACA;AAGA;AAIA;AAEA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;;;;;;;;;;;ACtRA;AACA;AAEA;AAEA;AACA;AACA;AAKA;AACA;AAEA;AAAA;AACA;AACA;AAEA;AACA;;;;;;;;;;;;;;;;;;;;;;;;;ACpBA;AACA;AACA;AACA;AACA;AACA;AAeA;AAEA;AACA;AAEA;AACA;AACA;AAEA;AAEA;AACA;AACA;AAIA;AAEA;AACA;AACA;AACA;AACA;AAIA;AACA;AACA;AACA;AACA;AACA;AAEA;AAEA;AACA;AACA;AAIA;AAEA;AAEA;AACA;AAQA;AACA;AAQA;AAEA;AAWA;AAEA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AAEA;AACA;AACA;;;;;;;;;;;;;;;;;;;;;;;;AC3HA;AACA;AAGA;AACA;AACA;AACA;AAEA;AACA;AACA;AAMA;AACA;AAEA;AACA;AACA;AAIA;AACA;AAWA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AAEA;AAEA;AACA;AAEA;AAGA;AAEA;AAAA;AACA;AAEA;AAEA;AAUA;AAGA;AAEA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;;;;;;;;;;;ACzFA;AACA;AAEA;AAEA;AACA;AAEA;AACA;AACA;AAIA;AACA;AAmBA;AACA;AAQA;AAAA;AACA;AACA;AAEA;AAEA;AACA;AAGA;;;;;;;;;;;;;;ACpDA;AAAA;AAAA;AAAA;AAEA;AACA;AACA;AAEA;AACA;AACA;AAGA;AAEA;AACA;AACA;AAGA;AAEA;AACA;AACA;AAGA;AAEA;AACA;AACA;AAGA;AACA;;;;;;;;;;;;;AClCA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAWA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AAEA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AAEA;AACA;;;;;;;;;;;;;AC9FA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAaA;AACA;AACA;AAEA;AACA;AAEA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AAEA;AACA;AACA;AAEA;;;;;;;;;;;;;;;;;;;;;ACzCA;AACA;AAQA;AAAA;AAAA;;AAWA;AAVA;AACA;AAEA;AAEA;AACA;AAGA;AACA;AAAA;;AAWA;AACA;AAOA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AAEA;AAIA;AACA;AAKA;AAAA;AACA;AACA;AACA;;;;;;;;;;;;;;;;;;;;;;;AC9DA;AAEA;AACA;AACA;AAGA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AAcA;AAAA;AAAA;;AAsEA;AAjEA;AACA;AAaA;AAEA;AAEA;AAEA;AAIA;AACA;AAEA;AACA;AAaA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAIA;AAIA;AAIA;AApEA;AACA;AACA;AAmEA;AAAA;AAEA;;;;;;;;;;;;;;;;;;;ACvGA;AAqCA;AAAA;AAGA;AAAA;AAoBA;AACA;AACA;AACA;AAEA;AAIA;AAEA;AACA;AACA;AACA;AAIA;AACA;AACA;AACA;AAIA;AA1CA;AACA;AACA;AACA;;AACA;AAEA;AACA;AACA;AACA;AAIA;AACA;AACA;AA6BA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AAEA;;;;;;;;;;;;;;;;;;;;;ACnGA;AAEA;AACA;AAYA;AAAA;AACA;AACA;AAEA;AAGA;AACA;AACA;AACA;AAIA;AAEA;AAQA;AAAA;AAAA;AAKA;AACA;AACA;AACA;AACA;AAGA;AAGA;;;;;;;;;;;;;;;;;;;;;;;;ACtDA;AACA;AAEA;AACA;AACA;AAcA;AAAA;AAIA;AAAA;AAoDA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AAEA;AACA;AACA;AAIA;AAjEA;AACA;AACA;AACA;AACA;;AACA;AAEA;AACA;AACA;AAEA;;AACA;AACA;AAEA;AACA;;AACA;AAAA;;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;AACA;;;;;;;;;AAEA;AACA;AACA;;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;AAEA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AAmBA;AAAA;AACA;AACA;AAEA;AAGA;AACA;AAMA;AAEA;AACA;AAMA;AAIA;AACA;AAAA;;AAOA;AAAA;AACA;AACA;AAYA;AAUA;AAGA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;;;;;;;;;;;;;;AClKA;AACA;AAOA;AACA;AACA;AAcA;AAAA;AAIA;AAAA;AAoDA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AAEA;AACA;AACA;AAIA;AAjEA;AACA;AACA;AACA;AACA;;AACA;AAEA;AACA;AACA;AAEA;;AACA;AACA;AAEA;AACA;;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;AAEA;AACA;AACA;;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;AAEA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AAmBA;AAAA;AACA;AACA;AAEA;AAGA;AACA;AAMA;AAEA;AACA;AAMA;AAIA;AACA;AAAA;;AAOA;AAAA;AACA;AACA;AAYA;AAUA;AAGA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;;;;;;;;;;;;ACvKA;AACA;AACA;AAGA;AACA;AACA;AAIA;AAOA;AAIA;AAGA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;;;;;;;;;;;ACjCA;AACA;AACA;AAEA;AAWA;AACA;AAWA;AAIA;AAGA;AAWA;AAMA;AAEA;AAAA;AACA;AACA;AACA;AACA;AAMA;AACA;AACA;AACA;AACA;AAEA;AACA;AAIA;AACA;AACA;AAEA;AAMA;;;;;;;;;;;;;;;;;;;;;;;;;;ACpFA;AACA;AACA;AACA;AACA;AACA;AACA;AAYA;AAAA;AAAA;AAAA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AAEA;AAGA;AACA;AACA;AASA;AACA;AACA;AACA;AACA;AAGA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AAUA;AAGA;;AAYA;AAVA;AACA;AAEA;AACA;AAKA;AACA;AAAA;;;;;;;;;;;;;;;AC9HA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AAGA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;;;;;;;;;;;;;;;;;;ACZA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AAEA;AAoBA;AAAA;AAAA;AAAA;AAGA;AAEA;AAEA;AACA;AACA;AACA;AAEA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;;AA0EA;AAxEA;AAAA;AACA;AACA;AACA;AACA;AAEA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AAEA;AACA;;;AAAA;AAEA;AAAA;AACA;AACA;AAEA;AAEA;AAEA;AACA;AAKA;AACA;AACA;AACA;AAIA;AACA;AACA;AACA;AACA;AAEA;AAWA;AAIA;AAKA;AA5JA;AA6JA;AAAA;AA9JA;AAuKA;AAAA;AAGA;AAAA;AAEA;AACA;AACA;AACA;AACA;;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AAEA;AACA;AACA;AAAA;;;;;;;;;;;;;;;;;;;;;ACjOA;AACA;AAEA;AAGA;AACA;AACA;AAOA;AASA;AAMA;AACA;AAOA;AAAA;AACA;AACA;AACA;AACA;AACA;AAEA;AAEA;AACA;AACA;AAGA;;;;;;;;;;;;;;;;;;;;;;;;;;ACpDA;AAEA;AACA;AACA;AAEA;AACA;AACA;AAaA;AACA;AAgBA;AAKA;AAQA;AAOA;AAEA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AAEA;AACA;AAEA;AAGA;AAEA;AAQA;AAGA;;;;;;;;;;;;;;;;;;;;;;ACzFA;AAEA;AAEA;AAQA;AACA;AACA;AAEA;AAAA;AAAA;AAAA;AAKA;AACA;AACA;;AAgDA;AA9CA;AACA;AAEA;AACA;AAEA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AAEA;AAYA;AArDA;AACA;AACA;AAoDA;AAAA;AAvDA;;;;;;;;;;;;;;;;;;;;;;;AChBA;AAEA;AACA;AACA;AACA;AAEA;AAkBA;AACA;AACA;AACA;AAEA;AAAA;AACA;AAAA;AAMA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AAzBA;;AACA;AA0BA;AACA;AAEA;AACA;AAEA;AAQA;AAQA;AACA;AACA;AASA;AAEA;AAEA;AAQA;AACA;AACA;AASA;AAEA;AAAA;AACA;AAEA;AAEA;AACA;AACA;AAKA;AACA;AAIA;AACA;AACA;AACA;AAKA;AACA;AAAA;;;;;;;;;;;;;;;;;;;;;;;;ACjJA;AAEA;AACA;AACA;AACA;AAYA;AAAA;AACA;AAAA;AAoBA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAdA;AAgBA;AACA;AAEA;AACA;AACA;AACA;AAEA;AACA;AAEA;AAEA;AACA;AAEA;AACA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AAEA;AA9DA;AAEA;AACA;AACA;AACA;;AACA;AAEA;AACA;AAMA;AAiDA;AAAA;AACA;AAEA;AAEA;AACA;AACA;AAQA;AAMA;AACA;AAAA;;;;;;;;;;;;;;;;;;;;;AC3GA;AACA;AAkCA;AAAA;AAKA;AAAA;AAGA;AACA;AACA;;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AAEA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AAEA;AACA;AAEA;AACA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AAEA;AACA;AAGA;AAKA;AAGA;AA7EA;AACA;AACA;AA4EA;AAAA;AA/EA;AAiFA;;AAEA;AACA;AACA;AACA;AAKA;AACA;AACA;;;;;;;;;;;;;AChIA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AAEA;AACA;AACA;AACA;AACA;AAEA;AACA;AAQA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AAWA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;;;;;;;;;;;;;;;;;;;;;;;ACxHA;AACA;AACA;AACA;AAEA;AACA;AACA;AAIA;AAKA;AAIA;AAKA;AACA;AAQA;AACA;AACA;AACA;AAKA;;;;;;;;;;;;;;;;;;;;;;;;AC1CA;AACA;AACA;AACA;AAEA;AACA;AACA;AAKA;AAMA;AAKA;AAMA;AACA;AAWA;AACA;AACA;AACA;AAKA;;;;;;;;;;;;;;ACjDA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA;;;;;;;;;;;;;ACDA;AAAA;AAAA;AACA;AACA;AACA;AACA;AAEA;AAEA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AAKA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAGA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;;;;;;;;;;;;;AClHA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;;;;;;;;;;;;;;;;;ACxBA;AACA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AAEA;AAEA;AAGA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AAEA;AACA;AAEA;;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;;AACA;AAAA;AACA;AACA;;;;;;;;;AACA;AACA;AAEA;AACA;AACA;AAEA;AAGA;AACA;AACA;AAEA;AACA;AAEA;;;;;;;;;;;;;;;;;;;;ACjEA;AAEA;AAEA;AACA;AACA;AAEA;AAEA;AACA;AASA;AAEA;AAGA;AACA;AACA;AAAA;AACA;AACA;AACA;AAEA;;AACA;AACA;AAEA;;AACA;AAAA;AACA;AAEA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;;;;;;;;;AACA;AAAA;AACA;AACA;AACA;;AAEA;AAAA;AACA;AACA;;;;;;;;;AAEA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AAAA;AACA;AACA;AAEA;AACA;AACA;AACA;;;;;;;;;;;;;AC7FA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;;ACLA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;;;;;;;;;;;;;ACtCA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;;;;;;;;;;;;;AChBA;AAAA;AAAA;AAAA;AAAA;AAEA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AAEA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AAAA;AACA;AACA;AAEA;AACA;AACA;AACA;;;;;;;;;;;;;AC/BA;AAAA;AAEA;;;;;;;;;;;;;ACFA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AAEA;AACA;AAEA;;AAEA;AACA;AAAA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AAEA;AACA;AACA;AAJA;AAQA;AACA;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AAEA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AAEA;;AAEA;AACA;AACA;AAgBA;AACA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;;;;;;;;;;;;;;;;;;;;;AC/JA;AAGA;AAEA;AAWA;;AAEA;AACA;AACA;AACA;AAEA;;AAEA;AACA;AACA;AACA;AAEA;;AAEA;AACA;AAKA;AACA;AACA;AACA;AAEA;AACA;AACA;AAEA;;AAEA;AACA;AACA;AAoBA;AACA;AACA;AACA;AAAA;AAtBA;AACA;AACA;AACA;AAqBA;;;;;;;;;;;;;;;;;;;;;;;;;;;AC5EA;AACA;AACA;AAKA;AACA;AAEA;AAEA;AAQA;AACA;AAUA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AAIA;AAEA;AACA;AACA;AAKA;AACA;AAEA;AACA;AAKA;AACA;AAEA;AACA;AACA;AAEA;AAEA;AACA;AACA;AACA;AAEA;AAKA;AACA;AACA;AAEA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AAEA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AAEA;AACA;AACA;AACA;AACA;AAEA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AAEA;AACA;AAEA;AACA;AAEA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AAKA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AAEA;AAEA;AAEA;AACA;AAUA;AACA;AACA;AAEA;;;;;AAMA;AACA;AACA;AAEA;AACA;AAGA;AACA;AACA;AAEA;AACA;AACA;AAEA;AAAA;AAEA;AACA;AAGA;AAEA;AACA;AAEA;AACA;AACA;AAFA;AAIA;AAEA;AAEA;AACA;AACA;AACA;AACA;AAEA;AACA;AAEA;AACA;AACA;AACA;AAIA;AACA;AACA;AACA;AAAA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AANA;AAQA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;;;;AACA;;;;;;;;;;;;;;;;;;;;;;;;;;AC1TA;AACA;AAEA;AAEA;AAKA;;AAEA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;;;AAGA;AACA;AACA;AACA;AACA;AAEA;AACA;AAEA;AACA;AAEA;AACA;AACA;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;;;;;;;AChDA;AACA;AAEA;AAuCA;AAqCA;AACA;AA4BA;AACA;AACA;AACA;AACA;AAEA;AACA;AAGA;;;;;;;;;;;;;ACpHA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AAEA;AACA;AACA;AAEA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;;;;;;;;;;;;;AClIA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AAGA;AAEA;AACA;AAAA;AAEA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;;ACdA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA;AAEA;AACA;;;;;;;;;;;;;;;;;;ACPA;AACA;AAEA;AAuCA;AAyBA;AACA;AAOA;AACA;AAOA;AACA;AAEA;AACA;AA4BA;AACA;AACA;AACA;AACA;AAEA;AACA;AAGA;;;;;;;;;;;;;AC3HA;AAAA;AAAA;AAAA;AACA;AACA;AAQA;AAEA;AAQA;AAEA;AACA;AACA;AAQA;AAEA;AAQA;;;;;;;;;;;;;AC5CA;AAAA;AAAA;AAAA;AAIA;AACA;AACA;;;;;;;;;;;;;ACNA;AAAA;AAAA;AAAA;AACA;AAEA;;;AAGA;AACA;AAGA;AACA;;;;;;;;;;;;;ACmBA;AAAA;AAAA;AAAA;AACA;AACA;;;;;;;;;;;;;AChCA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;ACFA;AAAA;AAAA;AACA;;AAEA;AAEA;AACA;AAEA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAGA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AAEA;AAKA;AACA;AACA;AACA;AACA;AAEA;AAAA;AACA;AACA;;;AAAA;AAEA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;;;AAAA;AAEA;AACA;AACA;AAEA;AACA;AAEA;AACA;AAEA;AAEA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AAEA;AAEA;AAcA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AAEA;AAAA;AACA;AACA;AACA;;;AAAA;AAEA;AAAA;AACA;AACA;AACA;;;AAAA;AAEA;AAAA;AACA;AACA;;;AAAA;AAEA;AACA;AACA;AAEA;AAAA;AACA;AACA;;;AAAA;AAzCA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAiCA;AAAA;AAEA;AAEA;AAEA;;;AAGA;AAEA;AACA;AAEA;AACA;AACA;AAGA;AACA;AACA;AACA;AACA;AAEA;AAEA;AAEA;AACA;AAEA;AACA;AACA;AACA;AAEA;AACA;AACA;AAPA;AAWA;AACA;AACA;AACA;AAEA;AACA;AACA;AAPA;AAaA;AAAA;AAIA;AACA;AACA;AACA;AAEA;AACA;AANA;AA9BA;AAwCA;AAEA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AAHA;AAFA;AAUA;AAEA;AAIA;;AACA;AAKA;AAEA;AACA;AAEA;AAEA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AAAA;AACA;;AACA;AAAA;AACA;AACA;AACA;;;;;;;;;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AAEA;AAEA;;AAEA;AACA;AA4BA;;AAEA;AACA;AACA;AACA;AAEA;AAAA;AACA;AACA;;;AAAA;AAEA;AAAA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AAEA;AAEA;AACA;AACA;;AACA;AAEA;AAKA;AAEA;;AAMA;AAAA;AACA;AACA;;;;;;;;;AAEA;AACA;AACA;AAAA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;;;AAAA;AAIA;AAFA;AAEA;AACA;AAEA;AACA;;;AAAA;AAEA;AAAA;AACA;AACA;;;AAAA;AAQA;AANA;;;;;AAKA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;;;AAAA;AAEA;;;AAGA;AACA;AACA;AACA;AAEA;;;;AAIA;AACA;AACA;AACA;AAEA;;;AAGA;AACA;AACA;AACA;AAnKA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AAEA;AACA;AAEA;AACA;AAEA;AACA;AAEA;AACA;AAEA;AACA;AACA;AA4IA;AAAA;AAtKA;AAwKA;AAEA;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;ACneA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AAEA;;;;;;;;;;;;;AC5FA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;;AChCA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AAAA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;;;;;;;;;;;;;ACxCA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;;;;;;;;;;;;;ACVA;AAAA;AAAA;AAAA;AACA;AAEA;AACA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AACA;AAEA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;;;;;;;;;;;;;ACtCA;AAAA;AAAA;AAAA;AAAA;AAAA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AAHA;AAMA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AAEA;AACA;AAEA;AACA;AACA;AACA;;;;;;;;;;;;;ACxCA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;;;AAGA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;;;;;;;;;;;;;ACrFA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AAGA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AAEA;AACA;AACA;AACA;AAEA;AACA;AAEA;AACA;AACA;AACA;AACA;AAEA;AACA;;;;;;;;;;;;;;;;;;;AC5DA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;;;;;;;;ACVA;AASA;;;;;;;AAOA;AACA;AAAA;AACA;AAEA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;;;;;;;;;;;;;ACpDA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AC7BA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AAEA;AACA;AACA;AACA;AACA;AAEA;AAKA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AAEA;;AAAA;AACA;AAEA;AAEA;AAEA;AASA;AACA;AAEA;AACA;AACA;AAEA;AAEA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAGA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AAEA;AACA;AACA;AACA;AACA;AAEA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AAAA;AACA;AACA;;;;;;;;;AACA;AAEA;AACA;AAEA;;AACA;AACA;;AAEA;AAAA;AACA;AACA;;;;;;;;;AACA;AACA;AAEA;AAEA;AACA;AACA;AACA;AACA;AAAA;;AAEA;;;;;;;;;;;;;AClMA;AAAA;AAAA;AAAA;AAUA;;;;;;;;;;;;;ACVA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AAEA;;;;;;;;;;;;;ACJA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AASA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;;AC1IA;AAAA;AAAA;AAAA;AAEA;AAEA;;;;;;;;;;;;;;;;;;;;;;ACJA;AACA;AAOA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AASA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AAcA;;;;;;;;;;;;;;;;;;;AClDA;AAEA;AAOA;AAAA;AAAA;;AAwBA;AAvBA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AAEA;AAQA;AACA;AAAA;;;;;;;;;;;;;;;;;;;;;;;;;;ACjCA;AACA;AACA;AACA;AACA;AAGA;AAKA;AAQA;AAAA;AAAA;AAAA;AASA;AACA;AACA;;AAmBA;AA7BA;AACA;AAEA;AACA;AACA;AACA;AAMA;AAAA;AACA;AAEA;AAGA;AAOA;AAGA;AACA;AAAA;;AAEA;AACA;AACA;AAEA;AACA;AACA;AACA;AAEA;;;;;;;;;;;;;;;;;;;;;;;AC7DA;AACA;AAOA;AAAA;AACA;AAIA;AAEA;AACA;AAGA;AAEA;AAAA;AACA;AAKA;AACA;AAEA;AAAA;AACA;AACA;AAEA;AAAA;AAIA;AAHA;AACA;AACA;AACA;AAAA;AAJA;;;;;;;;;;;;;;;;;;;;;;AClCA;AACA;AACA;AAEA;AACA;AAIA;AAMA;AAAA;AAAA;AAEA;AACA;AACA;AACA;AACA;AACA;AAIA;AACA;AACA;AACA;AAdA;AAmBA;;;;;;;;;;;;;;AClCA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AAEA;AAEA;AAIA;;;;;;;;;;;;;;;;;;;;;;;;ACTA;AACA;AACA;AACA;AAEA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AAEA;AAAA;AACA;AACA;AACA;AACA;AAEA;AACA;;;;;;;;;;;;;;;;;;;;AC1BA;AACA;AACA;AAgBA;AAIA;AAKA;AACA;AAYA;AAEA;AACA;AAEA;AAEA;AACA;;AAAA;AAAA;AACA;AAOA;AAEA;AACA;AAOA;AAEA;AACA;AAKA;AAaA;AASA;AAEA;;;;;;;;;;;;;;AClGA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AASA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AAEA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AAEA;AAEA;AACA;AAGA;AACA;;AAAA;AAQA;;;;;;;;;;;;;AC/EA;AAAA;AAAA;AAAA;AAAA;AAIA;AAAA;AACA;AACA;AACA;AAOA;AACA;AACA;AAEA;AAEA;AACA;AAGA;AAEA;AAEA;AACA;AAGA;AAIA;AAEA;;;;;;;;;;;;;;;;;;;;ACtCA;AACA;AAYA;AAAA;AACA;AAAA;AAUA;AACA;AACA;AACA;AACA;AAXA;AAEA;AACA;AACA;;AACA;AAQA;AACA;AACA;AAEA;AACA;AACA;AAAA;;;;;;;;;;;;;;ACpCA;AAAA;AAAA;AAAA;AAAA;;;;;;;;;;;;;;;;;;;;;;;ACAA;AACA;AACA;AACA;AAEA;AAcA;AAAA;AAEA;AAAA;AAmBA;AACA;AAEA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AA5CA;AACA;AACA;AACA;AACA;;AACA;AAEA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AA+BA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AAEA;AAAA;AACA;AAEA;AACA;;AAGA;AAEA;AACA;AACA;AACA;AASA;AACA;AAGA;AACA;AAUA;AACA;AAIA;AAKA;AAYA;AACA;AAAA;;;;;;;;;;;;;;;;;;;;;;;;;;;;;ACzIA;AACA;AAEA;AACA;AAEA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AA+BA;AAAA;AAEA;AAAA;AADA;AAaA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AAAA;AACA;AACA;AACA;AA/DA;AACA;AACA;AACA;AAEA;AACA;AACA;;AACA;AAyDA;AACA;AACA;AACA;AACA;AAEA;AAGA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAGA;AACA;AAAA;;AAEA;AACA;AACA;AAEA;AAEA;;;;;;;;;;;;;;;;;;;;;ACnJA;AACA;AAoBA;AAAA;AAEA;AAAA;AAaA;AACA;AAEA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AAhCA;AACA;AACA;AACA;AACA;AACA;;AACA;AAEA;AACA;AACA;AAwBA;AACA;AACA;AAEA;AAAA;AACA;AAEA;AACA;AAEA;AACA;AAUA;AACA;AAYA;AACA;;AAYA;AACA;AACA;AAIA;AAEA;AAMA;AACA;AAAA;;;;;;;;;;;;;;ACzHA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AAEA;AACA;AACA;AAEA;AAEA;AAYA;AAEA;AACA;AAUA;AACA;AAEA;AAOA;AAvBA;AA6BA;AAEA;AAGA;;;;;;;;;;;;;ACpEA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AAEA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAcA;AACA;AAEA;AACA;AACA;AAEA;AACA;AAEA;AACA;AAGA;AAGA;AAEA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AAOA;;AACA;AAGA;AAAA;AACA;AACA;AACA;AACA;AAEA;AACA;AAEA;AACA;AAGA;;;;;;;;;;;;;AC/GA;AAAA;AAAA;AAAA;AAAA;AAEA;AACA;AAEA;AACA;AAKA;;;;;;;;;;;;;;;;;;;;;;;ACXA;AAEA;AAEA;AAEA;AACA;AAUA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AAMA;;;;AACA;;AAAA;AACA;AACA;AACA;;;;AACA;AAEA;;;AACA;;AAAA;AACA;;;;AACA;;AA2CA;AAzDA;AACA;AACA;AAcA;AACA;AACA;AAEA;AAAA;AACA;AACA;AAEA;AAEA;AAEA;AACA;AACA;AACA;AACA;AACA;AAGA;AAGA;AACA;AACA;AAeA;AACA;AAAA;;;;;;;;;;;;;;;;;;;;;;;;;;AC/EA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AAEA;AAOA;AAAA;AAAA;AAAA;AAcA;AACA;AACA;AACA;;AAwBA;AArCA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AAOA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;;;AAAA;AAEA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AAKA;AAvCA;AACA;AAuCA;AAAA;AAEA;;;;;;;;;;;;;;;;;;;AC5DA;AACA;AAEA;AACA;AAOA;AAAA;AAAA;;AAMA;AALA;AACA;AAEA;AACA;AACA;AAAA;AAEA;;;;;;;;;;;;;;;;;;;;;ACnBA;AACA;AACA;AAEA;AAMA;AAAA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AAEA;AAEA;AAEA;AAOA;AACA;AACA;AACA;AACA;AAKA;AAIA;AAEA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AAEA;AACA;AAEA;AASA;AAIA;AAEA;AAAA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AAEA;;AACA;AACA;AACA;AAEA;AACA;AACA;AAEA;;AACA;AAAA;AACA;AACA;AAKA;AAAA;AACA;;AAAA;AACA;AACA;;;;;;;;;AACA;;AAAA;AAEA;AACA;AAEA;AACA;AAEA;AACA;AACA;AAGA;AACA;AACA;AAIA;AAEA;AACA;AAEA;AACA;AACA;AAEA;AAEA;AAEA;AACA;AACA;AACA;AAKA;AACA;AAAA;;;;;;;;;;;;;;ACpJA;AAAA;AAAA;AAAA;AAAA;AACA;AAMA;AAAA;AACA;AACA;AAEA;AAGA;AAEA;;;;;;;;;;;;;;;;;;;;;;AChBA;AACA;AACA;AACA;AAGA;AAcA;AAAA;AAKA;AAAA;AAcA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AAEA;;;;AACA;AACA;;AAAA;AACA;;;;AACA;AA7CA;;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAqCA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AAEA;AAKA;AAKA;AAEA;AAIA;AAEA;AAIA;AACA;AAQA;AACA;AAQA;AAxHA;AACA;AACA;AAuHA;AAAA;AAEA;;;;;;;;;;;;;;;;;;;;AChJA;AACA;AACA;AAMA;AAAA;AAAA;;AAmCA;AAlCA;AACA;AACA;AAEA;AAEA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AASA;AACA;AACA;AAKA;AACA;AAAA;;;;;;;;;;;;;;;;;;;;;AC3CA;AACA;AACA;AAYA;AAAA;AAAA;;AA6CA;AA5CA;AACA;AAEA;AAEA;AACA;AAGA;AACA;AACA;AACA;AAEA;AACA;AASA;AACA;AAEA;AACA;AAKA;AAEA;AACA;AAOA;AACA;AAAA;AAEA;;;;;;;;;;;;;;;;;;;;AC7DA;AACA;AAEA;AAGA;AACA;AACA;AAEA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AAEA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AASA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AAEA;AACA;AACA;;AAqDA;AAnDA;AACA;AACA;AACA;AAEA;AAEA;AACA;AAEA;AACA;;AAAA;AAEA;AACA;;AAEA;AACA;AAEA;AAGA;AAEA;AACA;AACA;AACA;AAUA;AAGA;AAIA;AAMA;AACA;AAAA;;;;;;;;;;;;;;ACrGA;AAAA;AAAA;AAAA;AAEA;AACA;AAEA;AACA;AAMA;;;;;;;;;;;;;;;;;;;;;;ACZA;AACA;AAEA;AAkBA;AAAA;AAOA;AAAA;AAEA;;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AAEA;AAAA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AAAA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AAEA;AAeA;AAlEA;AACA;AACA;AACA;AACA;AA+DA;AAAA;AApEA;;;;;;;;;;;;;;;;;;;;;ACrBA;AACA;AACA;AAoBA;AAAA;AAAA;AAAA;AAGA;AACA;AACA;AAUA;;;;AACA;AACA;;AAAA;;AAEA;AAEA;AACA;AACA;AACA;AACA;;;AAEA;;AAqBA;AAzCA;;;;;;AACA;AACA;;AAAA;AACA;AACA;AACA;;;;AACA;AAgBA;AACA;AACA;AAEA;AAEA;AAYA;AACA;AAAA;;;;;;;;;;;;;;;;;;;;;;;;ACtEA;AACA;AACA;AACA;AACA;AAkBA;AAAA;AAGA;AAAA;AAEA;AACA;AAEA;AACA;AACA;AACA;;AACA;AAEA;AAAA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AAEA;AAWA;AACA;AAAA;;;;;;;;;;;;;;;;;;;;;;;;AC7EA;AACA;AACA;AAEA;AACA;AAEA;AACA;AACA;AAcA;AAAA;AAGA;AAAA;AAEA;AACA;AAEA;AACA;AACA;AACA;;AACA;AAEA;AAAA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AAEA;AAEA;AAWA;AACA;AAAA;;;;;;;;;;;;;;;;;;;;;;AC/EA;AAEA;AAGA;AAaA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AAEA;AAAA;AAGA;AAAA;AAFA;AA+CA;;;;;AACA;AAEA;AAEA;AACA;AACA;AACA;AACA;;AAJA;AAKA;;;;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AAxEA;AACA;AACA;AACA;AACA;AACA;;AACA;AAEA;;;;;AACA;;AAAA;AACA;;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;;AAAA;AACA;AACA;AACA;;;AAGA;AACA;AACA;AACA;AACA;AACA;;;;;AACA;AAkCA;AAAA;AACA;AAEA;AAEA;AACA;AACA;AACA;AAQA;AACA;AAMA;AAUA;AACA;AACA;AAQA;AACA;AAMA;AACA;AAAA;;AAEA;;;;;;;;;;;;;;;;;;;;ACnKA;AACA;AASA;AAAA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AAEA;AACA;;AAAA;AAGA;AACA;AAAA;;;;;;;;;;;;;;;;;;;;;;;;;;;AC/BA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAaA;AAAA;AAGA;AAAA;AAIA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;;AAdA;AAgBA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AAEA;AAGA;AACA;AACA;AAEA;AAEA;AACA;AAEA;AAGA;AACA;AAAA;;;;;;;;;;;;;;;;;;;;;;AC7FA;AACA;AACA;AACA;AAEA;AAOA;AACA;AACA;AAEA;AACA;AAIA;AAEA;;;;;;;;;;;;;;;;;;;;;;ACvBA;AACA;AACA;AACA;AAEA;AAIA;AACA;AAGA;AAKA;AACA;AACA;AAGA;AAGA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;;;;;;;;;;;;;ACzCA;AAAA;AAAA;AAAA;AAAA;AAAA;;;;;;;;;;;;;;;;;;;;;;;;;;;;AA4BA;;AAEA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AAEA;;AAwGA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AAEA;AACA;AAEA;AACA;AACA;AACA;;;;;AArIA;AACA;AACA;AACA;AACA;AACA;AAGA;AACA;;AAAA;AACA;;AAAA;AACA;;AAAA;AACA;;AAAA;AACA;;AAAA;AACA;;AAAA;AACA;;AAAA;AACA;;AAAA;AACA;;AAAA;AACA;;AAAA;AACA;;AAAA;AACA;;AAAA;AACA;;AAAA;AAEA;AACA;;AADA;AACA;AAEA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;AAkCA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;;;;;;;;;;;;;ACpMA;AAAA;AAAA;AAAA;;;;AAIA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;;ACvBA;AAAA;AAAA;AAAA;AAAA;AAGA;AAIA;AAIA;AACA;AAAA;AAAA;AAEA;AAAA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;;;;;;;;;;;;;ACtCA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AAGA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AAqBA;AACA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA;AAEA;AACA;AAEA;AACA;AACA;AAAA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AAEA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AAEA;AACA;AACA;AAEA;AAAA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AAEA;AAAA;AACA;AACA;AAEA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AAEA;AAAA;AACA;AAEA;AACA;AACA;AAEA;AACA;AAEA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AAEA;AACA;AAEA;AACA;AAEA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;;AAEA;AAeA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;;;;;;;;;;;;;;;;;;;;ACjRA;AACA;AAEA;AAAA;AAAA;;AAgGA;AAtDA;AACA;AACA;AAEA;AACA;AAEA;AACA;AACA;AACA;AAEA;AACA;AAIA;AACA;AACA;;AACA;AAGA;AAAA;AAAA;AAEA;AACA;AACA;AACA;AAIA;AAEA;AAOA;AAlBA;AA0BA;AAIA;AA9FA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAwDA;AAAA;AAhGA;;;;;;;;;;;;;ACHA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AAEA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;;;;;;;;;;;;;ACnEA;AAAA;AAAA;AAAA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;;AC5BA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AAEA;AAEA;AAWA;AAGA;AACA;AAAA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AAAA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AAGA;AACA;AACA;AACA;AAGA;AACA;AACA;AAEA;AACA;;;;;;;;;;;;;;;;;;;;;;;ACxEA;AACA;AACA;AAIA;AAsBA;AAAA;AAQA;AAAA;AAAA;AAEA;AA+BA;AACA;AAAA;AACA;AACA;AACA;AACA;AA9BA;AAEA;AACA;AACA;AAEA;AACA;AAGA;AAOA;AACA;AAcA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AAEA;AAEA;AACA;AACA;AACA;AAEA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AAEA;;AAEA;AAAA;AACA;;AAEA;AAAA;AACA;AACA;;;;;;;;;AACA;;;;;;;;;AAEA;AACA;AACA;AACA;AAEA;;AACA;;AAEA;AAAA;AACA;AACA;;;;;;;;;AAEA;AACA;AACA;AACA;AAEA;;AACA;AACA;AACA;AACA;;AAEA;AAAA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;;;;;;;;;AAEA;AACA;AAEA;;AACA;;AACA;AAAA;AACA;AACA;AACA;AACA;;;;;;;;;AACA;AACA;AAEA;AAAA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AAAA;AACA;AACA;AAAA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AAAA;AACA;AACA;AACA;AACA;AAEA;;AACA;;AAEA;AAAA;AACA;AACA;AACA;;;;;;;;;AAEA;AACA;AAEA;AACA;AAEA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AAAA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AAEA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AAEA;;AAAA;;AACA;AAAA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;;;;;;;;;AAEA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AAEA;AACA;AACA;AAEA;AACA;AAEA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AAAA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;;;;;;;;;;;;;ACjWA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAEA;AAQA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;;AAEA;AAMA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AACA;AAEA;AACA;AAEA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AAAA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AAAA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AAEA;AACA;AAEA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;;;;;;;;;;;;;ACrHA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AAEA;AAWA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AAEA;AACA;AACA;AACA;AAEA;AACA;AAEA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AAEA;AACA;AAEA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AAEA;AACA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AAEA;;;;;;;;;;;;;ACzLA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AAEA;AAMA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AAEA;AACA;AACA;AACA;AACA;AACA;AAEA;;;;;;;;;;;;;;;;;;;;;;;ACjDA;AACA;AACA;AAEA;AACA;AAWA;AACA;AAUA;AAJA;AACA;AACA;AAKA;AAYA;AASA;AAbA;AACA;AACA;AAKA;AACA;AACA;AACA;AACA;AAKA;AAGA;AAOA;AAEA;AAAA;AACA;AACA;AAEA;AAIA;AACA;AACA;AAGA;AAKA;AACA;AAOA;AAIA;;;;;;;;;;;;;;;;;;;;;;;;;;;;AChGA;AACA;AAEA;AAEA;AACA;AACA;AACA;AASA;AAEA;AACA;AACA;AAEA;AACA;AAEA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AAAA;AAWA;AAgBA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AAwNA;AACA;AACA;AAEA;AACA;AACA;AACA;AA9NA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AAKA;AAAA;AACA;AACA;AACA;AACA;AAEA;AAAA;AAAA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AAEA;AAAA;AACA;AAEA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AAEA;AACA;AAEA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AACA;AAEA;AACA;AAEA;AAAA;AACA;AACA;AACA;AAEA;AAEA;AACA;AACA;AAEA;AAOA;AACA;AAGA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AAWA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AAEA;AACA;AAEA;AACA;AACA;AAEA;AAEA;AAEA;AACA;AACA;AACA;AACA;AAGA;AACA;AACA;AACA;AACA;AAAA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;;;;;;;;;;;;;AC3VA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AAEA;AACA;AACA;AAEA;AAQA;AACA;AAAA;AACA;AACA;AAEA;AAAA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AAEA;AACA;AACA;AACA;AACA;AAEA;AACA;AAEA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AAAA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;;;;;;;;;;;;;;;;;;;;;;AC1GA;AACA;AAGA;AACA;AACA;AAWA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;;AAqEA;AAnEA;AAAA;AACA;AACA;AAEA;AAEA;AACA;AACA;AAEA;AAEA;AACA;AACA;AACA;AAGA;AACA;AAEA;AAGA;AAEA;AACA;AACA;AACA;AAEA;AACA;AAEA;AAKA;AAEA;AACA;AAEA;AACA;AACA;AAIA;AAEA;AAEA;AACA;AACA;AAIA;AACA;AAKA;AACA;AAAA;AAEA;;;;;;;;;;;;;ACvGA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AAGA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AAEA;AAEA;AACA;AACA;AACA;AAGA;;;;;;;;;;;;;AC7BA;AAAA;AAAA;AAAA;AAMA;AACA;AACA;AAEA;AAEA;AACA;AACA;AAIA;AAEA;;;;;;;;;;;;;;;;;;;;;;;;;ACpBA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AAEA;AAAA;AAAA;AAAA;AACA;AACA;AACA;;AAkBA;AAhBA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AAEA;AAEA;AACA;AACA;AACA;AACA;AAAA;;;;;;;;;;;;;;AC/BA;AAAA;AAAA;AAAA;AAAA;AACA;AAOA;AACA;AACA;AAEA;AACA;AACA;AAGA;AACA;AACA;AACA;AAGA;AAEA;;;;;;;;;;;;;ACzBA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AAGA;AAAA;AACA;AACA;AAEA;AACA;AACA;AAGA;AACA;AACA;AACA;AAMA;AAEA;AACA;AACA;AAEA;;;;;;;;;;;;;AC5BA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AAEA;AACA;AACA;AAEA;AAGA;AACA;AAGA;AAEA;;;;;;;;;;;;;AClBA;AAAA;AAAA;AAAA;AAAA;AACA;AAMA;AACA;AACA;AAEA;AACA;AACA;AACA;AAGA;AAGA;AAEA;;;;;;;;;;;;;ACtBA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AAEA;AAWA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AAEA;AACA;AACA;AACA;AAEA;AACA;AAEA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AAEA;AACA;AAEA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AAEA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AAEA;AACA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AAEA;;;;;;;;;;;;;ACvMA;AAAA;AAAA;AAAA;AAAA;AAAA;AAEA;AAeA;AAeA;AAOA;AACA;AAAA;AACA;AACA;AACA;AAEA;AAAA;AACA;AACA;AACA;AACA;AACA;AAAA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;;;;;;;;;;;;;;;;;;;;;;;ACzFA;AACA;AACA;AAEA;AAEA;AAEA;AACA;AACA;AAEA;AACA;AAIA;;;;;;;;;;;;;ACjBA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AAEA;AACA;AACA;AAEA;AAEA;;;;;;;;;;;;;ACXA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA;;;;;;;;;;;;;ACJA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;;AAEA;;;;;;;;;;;;;ACvBA;AAAA;AAAA;AAAA;AAAA;AACA;AAEA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AAEA;AACA;AACA;AAAA;;AAEA;;;;;;;;;;;;;AC5CA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AAEA;AACA;AACA;AAAA;;AAEA;;;;;;;;;;;;;ACnBA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AAEA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AAAA;;AAEA;;;;;;;;;;;;;ACvDA;AAAA;AAAA;AAAA;AAAA;AACA;AAEA;AACA;AACA;AAAA;AAAA;AACA;AACA;AAEA;AAEA;AAEA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AAEA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AAAA;;AAEA;;;;;;;;;;;;;;;;;;;;;ACzDA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AAAA;AAAA;AAAA;AAOA;AAAA;AACA;AAOA;AAEA;AAAA;AAAA;AAAA;;;;;;;;;;;;;AC5CA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;;;;;;;;;;;;;ACjDA;AAAA;AAAA;AAAA;AAAA;AAAA;AAEA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AAEA;;;;;;;;;;;;;ACjBA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AAEA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AAEA;;;;;;;;;;;;;AC5BA;AAAA;AAAA;AAAA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AAEA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;;;;;;;;;;;;;AClCA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AAEA;AAEA;AAGA;AACA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AAEA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AAEA;AACA;AACA;AACA;AAAA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AAAA;AAAA;AAAA;AAAA;AAEA;AAAA;AACA;AAEA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AAAA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;;AC5EA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AAEA;AAEA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AAGA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAIA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AAEA;AACA;AACA;AAGA;AAEA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AAGA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAIA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AAEA;AACA;;;;;;;;;;;;;ACjRA;AAAA;AAAA;AAEA;AACA;AACA;AACA;AACA;AAEA;AAGA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAGA;AACA;AAEA;;;;;;;;;;;;;AC5BA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AAGA;AACA;AACA;AAEA;AACA;AAEA;AAEA;AAEA;AAEA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AAEA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AAEA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AAEA;AAEA;AACA;AACA;AACA;AACA;AACA;AAEA;AAEA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AAEA;AACA;AACA;AACA;AAEA;AACA;AAEA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AAAA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AAEA;AACA;;;;;;;;;;;;;ACzQA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AAEA;AACA;AAEA;AACA;AACA;AACA;AAEA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AAEA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;;ACvNA;AAAA;AAAA;AAAA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;;;;;;;;;;;;;AC1DA;AAAA;AAAA;AAAA;AAAA;AACA;AAEA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;;;;;;;;;;;;;ACvEA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AAEA;AAEA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AAGA;AACA;AACA;AAEA;AAEA;AACA;AACA;AACA;AAGA;AACA;AACA;AAEA;AACA;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;ACrHA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AAEA;AAEA;AAkBA;AACA;AAAA;AACA;AACA;AACA;AACA;AAEA;AAAA;AACA;AACA;AAEA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AACA;AAEA;AACA;AAEA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AAEA;AACA;AAEA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AAAA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AAEA;AAAA;AACA;AACA;AACA;AAEA;AAEA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AAEA;AACA;AAEA;AAAA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AAEA;;;;;;;AACA;AACA;;AAAA;AACA;;AAGA;AACA;AACA;AAEA;;;;;AACA;AAEA;AACA;AACA;AACA;AAEA;;;;;;AACA;AAAA;;AAAA;AACA;;;;;AACA;AAEA;AAAA;;;AACA;;AAAA;AACA;;;;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AAAA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AAEA;AACA;AAEA;AACA;AAEA;AACA;AAIA;AAEA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AAEA;AAGA;AACA;AAIA;AACA;AACA;AACA;AAEA;AACA;;;;;;;;;;;;;ACnWA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AAEA;AAEA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AAEA;AACA;AAEA;AACA;AACA;AAEA;AACA;;;;;;;;;;;;;AC3DA;AAAA;AAAA;AAAA;AAAA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;;ACXA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AAEA;AAEA;AACA;AACA;AACA;AAEA;AAAA;AACA;AAEA;AACA;AACA;AAEA;AAEA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AAEA;AACA;AAEA;AACA;AACA;AACA;AACA;;;;;;;;;;;;;ACnDA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AAEA;AAEA;AAKA;AACA;AACA;AAEA;AACA;AACA;AACA;AAEA;AAAA;AACA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AAEA;AACA;AAEA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AAEA;AACA;AAEA;AAAA;AACA;AACA;AACA;AACA;AAEA;AAEA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AAEA;AAAA;AACA;AAEA;AACA;AACA;AACA;AAEA;AAAA;AACA;AACA;AAEA;AACA;AACA;AACA;AAEA;AAAA;AACA;AAEA;AACA;AAEA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AAAA;;AAEA;AACA;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;ACnIA;AACA;AAEA;AAyBA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AAEA;AACA;AAEA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AAEA;;AACA;AAAA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;;AAEA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;AACA;;;;;;;;;AAEA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AAEA;AACA;AAKA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AAEA;;;;;AAKA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AAMA;AACA;AACA;AACA;AAEA;AAEA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;;AACA;AACA;;AAEA;AAAA;AACA;AACA;AACA;AACA;AAEA;AACA;;;;;;;;;AAEA;AACA;AAEA;AAWA;;;AAGA;AACA;;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AAEA;AACA;;AAEA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AAEA;AACA;AACA;AACA;AAAA;AACA;AACA;AAAA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;AAEA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AAEA;;AACA;;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;AACA;AACA;;;;;;;;;;;;;ACzXA;AAAA;AAAA;AAAA;AAEA;AACA;AACA;AACA;AACA;AAEA;AAEA;AAEA;AAEA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;;;;;;;;;;;;;;;;;;;;;;;AC1BA;AACA;AACA;AAGA;AAGA;AACA;AACA;AACA;AAEA;AACA;AACA;AAEA;;AAAA;AAAA;AAAA;;AACA;AACA;AACA;AACA;;AAEA;AAAA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;AAEA;;AACA;AAAA;AACA;AAEA;AACA;AACA;AACA;;;;;;;;;AACA;AAEA;AACA;AAEA;AACA;AACA;AACA;AAAA;;AAEA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;;;;;;;;;;;;ACxEA;AACA;AACA;AACA;;;;;;;;;;;;;ACDA;AAAA;AAAA;AAAA;AAAA;AAwBA;AAlBA;AACA;AACA;AAEA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AAAA;;AAEA;AACA;;;;;;;;;;;;;;;;;;;;;;AC7BA;AAGA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AAIA;AAIA;AACA;AAEA;AAEA;;;;;;;;;;;;;;;;;;;;ACxBA;AAGA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;;;;;;;;;;;;;AChBA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;;;;;;;;;;;;ACVA;AACA;AAIA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AAEA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;;;;;;;;;;;;;;;;;;;;;;AC7CA;AAGA;AAEA;AACA;AACA;AACA;AACA;AACA;AAEA;;;AACA;AAAA;AACA;AAKA;AACA;AACA;AACA;;;;;;;;;AACA;AAEA;AAEA;AAEA;AACA;AACA;AACA;AACA;AACA;;AAAA;AACA;AACA;AACA;;AAEA;AAAA;AACA;AAIA;;;;;;;;;AAEA;AACA;AAEA;AACA;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AClDA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AAgBA;AAEA;AACA;AACA;AAEA;AACA;AAKA;AACA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;;;;;;;;;;;;;AC5EA;AAAA;AAAA;AAAA;AACA;;;;;;;;;;;;;;;;;;ACDA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AAIA;AACA;AAIA;AAEA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AAEA;AACA;AACA;;;;;;;;;;;;;AC9CA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AAEA;AAOA;AACA;AACA;AAAA;AAAA;AAAA;AAEA;AACA;AAEA;AAEA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;;AAEA;AACA;AACA;AAEA;;;;;;;;;;;;;AC7CA;AAAA;AAAA;AAAA;AAEA;AACA;AAAA;AAEA;AACA;AACA;AACA;AAAA;;AAEA;AACA;;;;;;;;;;;;;ACXA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;;ACTA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AAGA;AACA;AACA;AAAA;AAAA;AAAA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;;AAEA;AACA;AACA;AACA;AACA;AACA;AAEA;;;;;;;;;;;;;;;;;;;;;;;;;;;AC5CA;AAEA;AACA;AACA;AACA;AAGA;AACA;AACA;AAaA;AAKA;AACA;AACA;AACA;AACA;AACA;AATA;AACA;AASA;AAEA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AAEA;AAAA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AAEA;AACA;AAEA;AAAA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AAEA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AAEA;AAEA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AAEA;AAAA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AAEA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AAEA;AAEA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;;AACA;;AAEA;AAAA;AACA;AACA;;;;;;;;;;AAEA;AAAA;AACA;AACA;;;;;;;;;AAEA;AACA;AAEA;;AACA;;AAEA;AAAA;AACA;AACA;;;;;;;;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AAAA;AACA;AAEA;AACA;AAEA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AAEA;AACA;AAEA;AAAA;AAAA;AAAA;;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AAAA;;AAEA;AAEA;AACA;AACA;AACA;;;;;;;;;;;;;AC/YA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA;AAEA;AAGA;AAGA;AACA;AAKA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAVA;AACA;AAWA;AACA;AAEA;AAAA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AAEA;AACA;AAEA;AACA;AAEA;AACA;AACA;AACA;AAEA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;;;;;;;;;;;;;AC9HA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AAEA;AAcA;AACA;AACA;AACA;AACA;AACA;AAAA;;AAEA;AAUA;AAHA;AAIA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AACA;AAAA;;AAEA;AACA;AAEA;AACA;AACA;;;;;;;;;;;;;ACjEA;AAAA;AAAA;AAAA;AAAA;AACA;AAEA;AACA;AACA;AAAA;AAAA;AAEA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AAEA;AACA;AAEA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AAAA;AAEA;;;;;;;;;;;;;;;;;;ACrDA;AASA;;;;AAIA;AACA;AAOA;AAEA;AAAA;AARA;AACA;AACA;AACA;AAEA;AAWA;AAAA;AAAA;AAAA;;AACA;AACA;AACA;AACA;AACA;AAEA;;;AACA;AAAA;AACA;AACA;;;;;;;;;AACA;AAEA;AACA;AACA;AACA;AAEA;;AACA;AACA;;AAQA;AAAA;AACA;AACA;AACA;AACA;;;;;;;;;AAEA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AA/DA;AAIA;AACA;AA2DA;AAAA;;;;;;;;;;;;;;ACzFA;AAAA;AAAA;AAAA;AAGA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;;ACXA;AAAA;AAAA;AAAA;AAaA;;;AAGA;AACA;AAIA;AAAA;AAAA;AAHA;AACA;AAIA;AACA;AACA;AAEA;AACA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AACA;AAEA;AAEA;AACA;AACA;AACA;AACA;AA1BA;AA2BA;AAAA;;;;;;;;;;;;;;AChDA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AAEA;AACA;AAAA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AAEA;AAEA;AACA;AACA;AACA;AACA;AAEA;AACA;AAEA;AAEA;AACA;AACA;AAEA;AACA;AAEA;AACA;AACA;AACA;AAAA;;AAEA;AACA;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AC/CA;AAEA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AAIA;AAGA;AAKA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AAVA;AACA;AAWA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AAEA;AACA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AAEA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AAEA;AAAA;AACA;AAGA;AACA;AACA;AACA;AACA;AAGA;AAEA;AAAA;AACA;AAGA;AACA;AACA;AACA;AACA;AAGA;AAEA;AACA;AACA;AAEA;AACA;AACA;AACA;AAEA;AAAA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;;;;;;AACA;AACA;AACA;;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AANA;AAOA;AAEA;AACA;AACA;;;;;AAEA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;;AAEA;AAEA;;AAEA;AAEA;AAEA;AACA;AACA;AAEA;AACA;AACA;;;;;;;;;;;;;ACtWA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AAAA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AAEA;AACA;AACA;AAEA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;;;;;;;;;;;AAWA;AACA;AACA;AACA;AACA;AACA;;;;AAIA;AACA;AACA;AAEA;AACA;AACA;AAEA;;;;;;;AAOA;AACA;;AACA;AACA;AAEA;;AAEA;AAAA;AACA;AACA;AAEA;AACA;AACA;AACA;AAEA;AACA;AACA;AAAA;AACA;AACA;AAAA;AACA;AACA;AACA;;;;;;;;;AAEA;AACA;AACA;AAEA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AAEA;;;;;;AAMA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AAEA;AACA;AACA;AAEA;AACA;AAEA;AACA;AAEA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AAEA;AACA;AAEA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AAEA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;;;;;;;;;;;;;AC3TA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AAGA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AAEA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AACA;AAEA;AACA;AAEA;AACA;AACA;AAEA;AACA;AAEA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;;;;;;;;;;;;;;;;;;;;;;;AChFA;AAEA;AACA;AACA;AACA;AASA;AAIA;AACA;AAAA;AACA;AACA;AACA;AAEA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AAEA;AAAA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AAAA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AACA;AAEA;AAEA;AACA;AAGA;AACA;AACA;AACA;AAEA;;AACA;AACA;AACA;;AAEA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;AAEA;AAAA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;;;;;;;;;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AAAA;;AAEA;;;;;;;;;;;;;AClNA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AAEA;AACA;AACA;AAEA;AAWA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AAEA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AAEA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;;;;;;;;;;;;;AC1HA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AAGA;AACA;AACA;AAGA;AACA;AAAA;AAHA;AAGA;AAEA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AAEA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;;AAEA;;;;;;;;;;;;;AC9BA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAEA;AACA;AACA;AAGA;AAGA;AACA;AAAA;AAAA;AAAA;AAEA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AAEA;AAEA;AACA;AACA;AACA;AAAA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AAEA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;;AAEA;;;;;;;;;;;;;ACnFA;AAAA;AAAA;AAAA;AAuDA;AAtDA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AACA;AAAA;;AAEA;AACA;;;;;;;;;;;;;;;;;;;AC5DA;AAcA;AAOA;;AACA;AACA;AACA;AACA;AAEA;AACA;;AACA;AAAA;AACA;AACA;;;;;;;;;AACA;AACA;;AACA;AAAA;AACA;AACA;;;;;;;;;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AAAA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AAEA;AAAA;AAAA;AAAA;;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AAEA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;;;;;;;;;;;;;;;;;;;;;;AC/KA;AACA;AACA;AAEA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AAEA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AAEA;;;;;AAKA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AAAA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;;AACA;AACA;;AAEA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;AAEA;AACA;AAEA;;;;AAIA;AACA;AAoCA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AACA;AAEA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AAEA;AACA;AAEA;AACA;AACA;AACA;AACA;AAAA;;;;;;;;;;;;;;;;;;;;;;;;;;;;;ACtYA;AACA;AACA;AACA;AAEA;AACA;AAEA;AACA;AAIA;AACA;AAEA;AACA;AAAA;AAEA;AAEA;AAAA;AACA;AAGA;AACA;AAGA;AAEA;AACA;AACA;;;;;;;;;;;;;;;;;;;;;ACjCA;AACA;AAEA;AAkDA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAQA;;;;AACA;AACA;;AAAA;AACA;;;;AACA;AAEA;;;;;AACA;AACA;AACA;AACA;;AAAA;AACA;;;;AACA;AAEA;;;;;AACA;AACA;AACA;AACA;;AAAA;AACA;;;;AACA;AAEA;;;;;AACA;AACA;AACA;AACA;;AAAA;AACA;;;;AACA;AAEA;;;;;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAPA;;;;AAQA;AAEA;;;;;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AARA;;;;AASA;;AAiBA;AA9EA;AACA;AACA;AACA;AACA;AA2DA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AAAA;;AAEA;;;;;;;;;;;;;ACjJA;AAAA;AAAA;AACA;AACA;AAEA;AACA;AAEA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;;;;;;;;;;;;;AC9BA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AAEA;;;;;AAKA;AACA;AAEA;AACA;AACA;AAAA;AAEA;AACA;AAEA;AACA;AAAA;AACA;AACA;AAAA;AACA;AACA;AAEA;AACA;;;;;;;;;;;;;AC9BA;AAAA;AAAA;AAAA;AAEA;AACA;AACA;;;;;;;;;;;;;;;;;;;;;ACJA;AACA;AACA;AAEA;AAAA;AAAA;AAAA;;AACA;AAEA;AACA;AACA;AACA;;;;;;;;;;;;;ACVA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAkEA;AA9DA;AACA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AAEA;AACA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AAAA;;AAEA;AAMA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AAEA;AACA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AAEA;AAAA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AAAA;;AAEA;AAGA;AAFA;AAEA;AAEA;AACA;AACA;AACA;AACA;AAEA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AAAA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AAAA;AACA;AACA;AAEA;AACA;AACA;AAAA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AACA;AAAA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;;ACxNA;AAAA;AAAA;AAAA;AAAA;AAGA;AAGA;AACA;AACA;AAaA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AAaA;AAAA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AAUA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AACA;AAAA;;;;;;;;;;;;;;AC1FA;AAAA;AAAA;AAAA;AAAA;AAEA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AAAA;AACA;AACA;AAAA;AACA;AACA;AACA;AAEA;AACA;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AChBA;AACA;AAEA;AACA;AAoBA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAIA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AAEA;AAEA;AACA;AAiBA;;;;;;;AACA;AACA;AACA;AAIA;AAEA;;;;AACA;;AAAA;AACA;AACA;AACA;;AAEA;;;;;;;;AANA;;;;AAAA;AAAA;;;;;;;;;;;;;;;;;;;;;AAUA;AACA;AACA;AACA;AACA;AACA;AAMA;AAAA;AACA;AAMA;AAEA;AACA;AACA;AACA;AACA;;;;AACA;AAEA;AAMA;AACA;AACA;AACA;AACA;AAEA;AAEA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AAAA;AAAA;AAAA;AAEA;AAAA;AAAA;AAAA;;AACA;AAAA;AAEA;AAAA;AACA;AACA;AACA;AACA;AACA;AAEA;AAAA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AAEA;AACA;AACA;AAAA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AAEA;AACA;AACA;AAAA;AACA;AACA;AAEA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AAAA;AACA;AACA;AAEA;AAAA;AACA;AACA;AAEA;AAAA;AACA;AACA;AAEA;AACA;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AAGA;AAEA;AACA;AACA;AACA;AACA;AAEA;;AAEA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AAEA;;AAEA;AACA;AAKA;AACA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AAEA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AAEA;AACA;AAEA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AAEA;AACA;AACA;AACA;AAEA;AACA;AAEA;AACA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AAEA;AACA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AAEA;AACA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AAEA;AAAA;AACA;AACA;AACA;AAEA;AACA;AAAA;AAEA;AACA;AACA;AACA;AAEA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AAEA;AACA;AAEA;AACA;AACA;;;;;;;;;;;;;AC5hBA;AAAA;AAAA;AACA;AACA;AACA;AACA;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;ACJA;AACA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AACA;AAaA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AAEA;AAAA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAGA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AAEA;AAGA;AACA;AAGA;AACA;AAGA;AACA;AAEA;AACA;AACA;AACA;AAEA;AAGA;AACA;;AAbA;AACA;AAAA;AAgBA;AAEA;AACA;AAEA;;;AAGA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AAEA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AAAA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;;;;;;;;;;;;;ACtMA;AAAA;AAAA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AAEA;AAEA;AACA;AACA;AAEA;AACA;AACA;AACA;AAEA;AACA;AACA;AAEA;AAEA;AACA;;;;;;;;;;;;;ACpCA;AAAA;AAAA;AAAA;AAAA;AACA;AAWA;AAEA;AAEA;AACA;AACA;AAEA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AAEA;AACA;AAEA;AACA;AAEA;AAEA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AAEA;AACA;AAEA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AAEA;AAOA;AACA;AACA;AAAA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AAEA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AAEA;;;;;;;;;;;;;ACtUA;AAAA;AAAA;AAAA;AAEA;AACA;AACA;AACA;AAGA;AACA;AAEA;;;;;;;;;;;;;ACXA;AAAA;AAAA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;;;;;;;;;;;;ACRA;AACA;AACA;AAEA;AACA;AAEA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AAEA;AAEA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AAEA;;;;;;;;;;;;;AC/BA;AAAA;AAAA;;;;;;;;;;;;;;;;;;;;ACFA;AAGA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;;;;;;;;;;;;;ACjBA;AAAA;AAAA;AAAA;AAAA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;;ACVA;AAAA;AAAA;AAAA;AACA;AACA;AAEA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AAEA;AAEA;AAAA;AACA;AACA;AACA;AACA;;;;;;;;;;;;;;;;;;;ACxCA;AAEA;;AACA;AACA;AACA;AAEA;AACA;;AACA;AAAA;AACA;AACA;;;;;;;;;AACA;AACA;AAEA;AACA;;;;;;;;;;;;;AChBA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AAEA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AAEA;;;;;;AAMA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;;AC3CA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;;;;;;;AAOA;AACA;AACA;AAIA;AACA;AACA;AAEA;AACA;AACA;AAAA;AACA;AACA;AAAA;AACA;AACA;AAEA;AACA;AAEA;AACA;AACA;AAEA;;;;;;;AAOA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AAAA;AACA;AACA;AAEA;AAEA;AACA;AAEA;;;AAGA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;;;AAGA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AAEA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AAAA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AAEA;;;;;AAKA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AAEA;;AAEA;AACA;AACA;AACA;AAEA;;AAEA;AACA;AACA;AACA;AACA;AAEA;;AAEA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;;;;;;;;;;;;;ACrNA;AAAA;AAAA;AAAA;AAAA;AAEA;AACA;AACA;AACA;AACA;AAEA;AACA;AAEA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AAEA;AACA;AAEA;AACA;AACA;AAEA;AACA;AAEA;AACA;;;;;;;;;;;;;ACrCA;AAAA;AAAA;AAAA;AAAA;AAAA;;AAEA;AAIA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AAEA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AAEA;AACA;;;;;;;;;;;;;ACrFA;AAAA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AAAA;;;;;;;;;;;;;;ACjDA;AAAA;AAAA;AAAA;AAAA;AAAA;AAIA;AACA;AAEA;AACA;AACA;AAOA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AAEA;AACA;AAEA;AACA;AAEA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AAEA;AAEA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AAEA;AAEA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AAAA;;;;;;;;;;;;;;ACvMA;AAAA;AAAA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AAAA;;;;;;;;;;;;;;;;;;ACnCA;AAIA;AAUA;AACA;AAAA;AATA;AACA;AACA;AAEA;AAMA;AACA;AACA;AACA;AAEA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AACA;AAEA;;;AACA;AAAA;AACA;AACA;AACA;;;;;;;;;AACA;AACA;AAAA;;AAEA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;ACtEA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AAeA;AA+BA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AAOA;AACA;AACA;AAEA;AACA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;;AA+CA;AA1GA;;;;AACA;AACA;;;;AACA;AA0DA;AACA;AACA;AACA;AAEA;AAEA;AACA;AAEA;AAQA;AAGA;AAIA;AASA;AAUA;AACA;AAAA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;;;;;;;;;;;;;;;;;;;;;;ACvMA;AACA;AAEA;AAUA;AACA;AAEA;AAAA;AAAA;AAAA;AACA;AACA;AACA;;AA8DA;AA5DA;AACA;AACA;AACA;AACA;AACA;AAEA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAGA;AAGA;AACA;AAIA;AACA;AAIA;AAGA;AACA;AACA;AASA;AACA;AAGA;AAOA;AACA;AAAA;;;;;;;;;;;;;;;;;;;;;;;;ACjFA;AACA;AACA;AAGA;AAcA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AAEA;AACA;AACA;;AAqCA;AAnCA;AACA;AACA;AACA;AAIA;AAEA;AACA;AACA;AACA;AACA;AAYA;AACA;AAIA;AAIA;AACA;AAAA;;AAEA;AAEA;AACA;AACA;AAKA;AAGA;AACA;AAcA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;;AA4DA;AA1DA;AACA;AACA;AACA;AACA;AAEA;AAEA;AACA;AAEA;AACA;AAEA;AAKA;AAOA;AAEA;AACA;AAWA;AAEA;AACA;AAcA;AACA;AAAA;AAEA;AAEA;AACA;AAGA;AAGA;AAaA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AAEA;AACA;AACA;;AAuCA;AArCA;AACA;AACA;AACA;AACA;AAEA;AAEA;AACA;AACA;AAEA;AACA;AACA;AACA;AAEA;AAKA;AAIA;AACA;AAGA;AAMA;AACA;AAAA;;;;;;;;;;;;;;;;;;;;;;;AC9QA;AACA;AACA;AAaA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;;AAkEA;AAhEA;AACA;AACA;AACA;AAEA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AAMA;AAKA;AAQA;AACA;AAMA;AACA;AACA;AAkBA;AACA;AAAA;;;;;;;;;;;;;;;;;;;;;;;;;AC1GA;AAEA;AACA;AAEA;AAkBA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AAEA;AACA;AACA;AAIA;AAEA;AACA;AACA;AAIA;AAEA;AACA;AACA;AAIA;AAEA;AACA;AACA;;AAiFA;AA/EA;AACA;AACA;AACA;AACA;AAEA;AAEA;AACA;AACA;AACA;AACA;AACA;AAOA;AAOA;AAOA;AAWA;AACA;AAGA;AAQA;AASA;AAYA;AACA;AAAA;;AAEA;AACA;AACA;AAMA;AACA;AAgBA;AAAA;AAAA;AAAA;AAUA;AACA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AACA;AAEA;AACA;AAEA;AACA;AACA;AACA;AAEA;AACA;AAEA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;;AAiDA;AA/CA;AACA;AACA;AACA;AAMA;AAEA;AACA;AACA;AAEA;AAEA;AACA;AAcA;AACA;AACA;AAYA;AAvGA;AACA;AACA;AACA;AACA;AACA;AAmGA;AAAA;AA3GA;AAmHA;AAAA;AACA;AAOA;AAOA;AAEA;AACA;AAGA;AACA;AAIA;;;;;;;;;;;;;;;;;;;;;;ACxUA;AACA;AACA;AAcA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;;AAmEA;AAjEA;AAAA;AACA;AACA;AAEA;AAIA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAGA;AAEA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AAcA;AACA;AAKA;AAYA;AACA;AAAA;;;;;;;;;;;;;;;ACrGA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AAEA;AAGA;AAGA;AACA;AACA;AACA;AACA;AAAA;AAEA;AACA;AACA;AACA;AACA;;;;;;;;;;;;;ACrBA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AAMA;AAAA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAGA;AAEA;AAEA;AACA;AACA;AAYA;AACA;AAKA;AAMA;AAAA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AAEA;AAEA;AACA;;AAAA;AACA;AAEA;AACA;AAEA;AACA;AAMA;AACA;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;ACjFA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AA4BA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AAsBA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;;AAqDA;AAnFA;;;;;;AACA;AACA;;AAAA;AACA;;AAAA;AACA;AACA;;AAAA;;;AAEA;;;;;AACA;AAEA;;;;AACA;AACA;;;AACA;AAEA;;;;;;AACA;AACA;AAAA;;;;AACA;AAcA;AACA;AACA;AAEA;AAEA;AACA;AACA;AAEA;AAIA;AAEA;AAEA;AACA;AACA;AACA;AASA;AAKA;AAEA;AAQA;AAKA;AACA;AAAA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;;;;;;;;;;;;;;;;;;;;;ACpJA;AACA;AAWA;AAEA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;;AAkDA;AAhDA;AACA;AACA;AACA;AACA;AACA;AAEA;AAEA;;AAEA;AACA;AACA;AAGA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AAUA;AACA;AAAA;;;;;;;;;;;;;;ACxEA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AAQA;AAAA;AACA;AAEA;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AAIA;AAGA;AAEA;AAEA;AAEA;AACA;AAEA;AACA;AACA;;AAEA;AACA;AACA;AASA;AAEA;AACA;AAKA;AAMA;;;;;;;;;;;;;ACpEA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA;AAQA;AAAA;AACA;AAEA;AACA;AACA;AAIA;AAIA;AACA;AACA;AACA;AACA;AASA;;;;;;;;;;;;;ACtCA;AAAA;AAAA;AAAA;AAAA;AAQA;AAAA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AAGA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AAOA;;;;;;;;;;;;;AC7CA;AAAA;AAAA;AAAA;AAAA;AAOA;AAAA;AACA;AAEA;AACA;AACA;AACA;AACA;AAGA;AACA;AACA;AACA;AAGA;AACA;AAMA;AACA;AACA;AAGA;AACA;AAGA;AACA;AASA;;;;;;;;;;;;;ACjDA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AAQA;AAAA;AACA;AAEA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AAGA;AAEA;AAEA;AAEA;AACA;AAEA;AACA;AACA;;AAEA;AACA;AACA;AASA;AAEA;AACA;AAKA;AAMA;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AC7DA;AACA;AACA;AACA;AAGA;AAeA;AAEA;AAAA;AACA;;;;;;AAEA;AACA;;AAAA;AACA;;AAAA;AACA;;AAAA;AACA;AACA;;AAAA;;;AAEA;;;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;AAEA;AACA;AAEA;AAAA;AACA;;;;AACA;;AAAA;AACA;;;;AACA;AACA;AAEA;AAAA;AACA;;;AACA;;AAAA;AACA;;;;AACA;AACA;AAEA;AAAA;AACA;;;;;AACA;AACA;;AAAA;AACA;;;;AACA;AACA;AAEA;AAAA;AACA;;;AACA;;AAAA;AACA;AACA;;;;AACA;AACA;AAEA;AAAA;AACA;;;AACA;;AAAA;AACA;;;;AACA;AACA;AAEA;AAAA;AACA;;;AACA;;AAAA;AACA;;;;AACA;AACA;AAEA;AAAA;AACA;;;;;AACA;AACA;;AAAA;AACA;;;;AACA;AACA;AAEA;AAAA;AACA;;;;AACA;;AAAA;AACA;;;;AACA;AACA;AAEA;AAAA;AACA;;;;;AACA;AACA;AACA;AACA;AACA;;AAAA;AACA;;;;AACA;AACA;AAEA;AAAA;AACA;;;;;AACA;AACA;;AAAA;AACA;;;;AACA;AACA;AAEA;AAAA;AACA;;;AACA;;AAAA;AACA;;;;AACA;AACA;AAEA;AAAA;AACA;;;;AACA;;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;AACA;AACA;AAEA;AAAA;AACA;;;;;AACA;AACA;;AAAA;AACA;;;;AACA;AACA;AAEA;AAAA;AACA;;;AACA;;AAAA;AACA;;;;AACA;AACA;AAEA;AAEA;AAAA;AACA;;;;;AAEA;AACA;;AAAA;AACA;;;;;AAEA;AACA;AAEA;AAAA;AACA;;;AACA;;AAAA;AACA;;;;AACA;AACA;AAEA;AAEA;AAAA;AACA;;;;;;AAEA;;AAAA;AACA;;;;AAEA;AACA;AACA;AACA;AACA;AACA;;;;;AAEA;AACA;AAEA;AAAA;AACA;;;;;;AAEA;;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;AAEA;AACA;AAEA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AChPA;AAcA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AAKA;AAIA;AAIA;AAKA;AAKA;AAIA;AAIA;AACA;AAEA;AAUA;AAEA;AAEA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AAIA;AAIA;AAIA;AAIA;AAKA;AACA;AAEA;AAQA;AAEA;AACA;AACA;AACA;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AC1HA;AACA;AACA;AACA;AACA;AACA;AACA;AAMA;AACA;AACA;AAEA;AAsBA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AA0XA;AACA;AACA;AACA;AACA;AA5XA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AAAA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AAEA;AACA;AAEA;AACA;AACA;AACA;AAEA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AAAA;AACA;AAEA;AACA;AAEA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AAEA;;AAAA;AACA;AACA;AACA;AACA;AAEA;AAEA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AAEA;AAGA;AACA;AACA;AAIA;;AAEA;AAAA;AACA;AACA;AAEA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;;;;;;;;;;AAEA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;AAEA;AACA;AACA;AAEA;AACA;AACA;AACA;AAEA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AAEA;;;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;AACA;AAEA;;AAAA;AACA;AACA;AACA;AAEA;AACA;AAEA;;AACA;AAAA;AACA;AACA;AACA;;AAEA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;AAEA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AAEA;AACA;AAGA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AAGA;;;;;;;;;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AAEA;AAEA;AACA;AAEA;AACA;AACA;AACA;AAEA;AACA;AAEA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AAEA;;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AACA;AAAA;AACA;AACA;AACA;AACA;;;;;;;;;AACA;AACA;AACA;AAEA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AAEA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAQA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AAEA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;;;;;;;;;;;;;;;;;;;;;ACteA;AACA;AAEA;AAEA;AAuBA;AACA;AAAA;AACA;AACA;AACA;AACA;AAzBA;AAKA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAWA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;;AACA;;AAEA;AACA;AAAA;AACA;AACA;;;;;;;;;AAEA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AAAA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AAAA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AAAA;;AAEA;;;;;;;;;;;;;ACxIA;AAAA;AAAA;AAAA;AAGA;AAIA;AACA;AAAA;AACA;AACA;AACA;AAEA;AAAA;AACA;AACA;AACA;AACA;AAEA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;;AAEA;;;;;;;;;;;;;;;;;;ACxBA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;;;;;;AAMA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;;;;AAEA;;;;AAAA;AACA;AACA;;AAAA;AACA;AACA;AACA;AAAA;AACA;AACA;;;;;;;;;;;;;;;;;AAGA;AACA;AACA;AAEA;AACA;AACA;AAEA;;;AACA;;;;;;;;;;;;;;;;;AC9CA;AAAA;AA8DA;AA7DA;;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AAAA;AACA;AACA;AACA;AACA;;;;;;;;;AAEA;AACA;AACA;AACA;AAAA;;;;;;;;;;;;;;AChEA;AAAA;AAAA;AAAA;AAAA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AAEA;AACA;AAGA;AACA;AACA;AAEA;AACA;AACA;AACA;AAEA;AACA;AAGA;AAEA;AACA;AACA;AACA;AAEA;AACA;AACA;AAAA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;;;;;;;;;;;;;;ACvKA;AACA;AACA;AAEA;AAEA;AACA;AAEA;AAQA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AAEA;AAEA;AACA;AACA;;;;;;;;;;;;;AC1DA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;;ACbA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA;;;;;;;;;;;;;ACJA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AAIA;AACA;AAMA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AAKA;AACA;AACA;AAKA;AAEA;AACA;AACA;AAEA;AACA;AACA;AAEA;AAEA;AACA;AACA;AACA;AACA;AAEA;AACA;AAEA;AACA;AAEA;AACA;AACA;AACA;AAEA;;;;;;;;;;;;;;;;;;;;;;;;;AChGA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AAOA;AAGA;AAKA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AAEA;AAAA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AAEA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AAEA;;AAAA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;;AAEA;AAEA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;AA5BA;AAAA;AAAA;;;AA8BA;;;;;;;;;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AAEA;;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AAAA;AACA;AACA;AACA;;;;;;;;;AAEA;AACA;AACA;AAAA;;AAEA;;;;;;;;;;;;;;;;;;;;;;;;;;ACzLA;AACA;AACA;AACA;AAGA;AACA;AAEA;AA0CA;AACA;AAAA;AAAA;AAAA;AAlCA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AAUA;AACA;AACA;AAEA;AACA;AACA;AACA;AA2CA;AACA;AACA;AACA;AA1CA;AAEA;AACA;AACA;AACA;AACA;AAEA;AACA;AAEA;;;;;;AACA;;AAAA;AACA;AACA;AACA;;;;;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AAOA;AACA;AACA;AAEA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AAAA;;AAEA;;;;;;;;;;;;;ACjIA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AAGA;AAGA;AAQA;AACA;AAAA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AAEA;AACA;AAEA;AAAA;AACA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AAEA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;;AAEA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;;;;;;;;;;;;;AC9GA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AAYA;AAIA;AAAA;AAAA;AAEA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AACA;AAEA;AACA;AAEA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AAEA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;;AAEA;AACA;AACA;AAEA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AAAA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;;;;;;;;;;;;;ACvLA;AAAA;AAAA;AAAA;AAAA;AAEA;AACA;AAEA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;;;;;;;;;;;;;;;;;;;;;;AC1BA;AAIA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AAEA;AAEA;AACA;AACA;;;;;;;;;;;;;;;;;;;;;;;;AC9BA;AACA;AACA;AAIA;AAEA;AAMA;AACA;AACA;AACA;AACA;AAGA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;;AACA;AAEA;AACA;;AAEA;AAAA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;AAEA;AACA;AAEA;AAAA;AACA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AAAA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AAEA;AACA;AAEA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AACA;AAAA;;AAEA;AASA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;;;;;;;;;;;;;ACrLA;AAAA;AAAA;AAAA;AAAA;;;;;;;;;;;;;ACAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AAEA;AACA;AAIA;AAEA;AAMA;AACA;AACA;AAEA;AACA;AAEA;AAEA;AACA;AAEA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AAEA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AAEA;AACA;AACA;AAAA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;;;;;;;;;;;;;;;;;;;;ACrFA;AAEA;AAkCA;AACA;AAAA;AAAA;AAEA;;AAAA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AAEA;AACA;AAEA;AACA;AACA;AACA;AACA;;AAEA;AAAA;AACA;AACA;;;;;;;;;AAEA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AAEA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AAEA;AAEA;;AACA;AACA;AACA;AAEA;;AACA;AAAA;AACA;AACA;AACA;AACA;;;;;;;;;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AAAA;AACA;AAEA;AACA;;AACA;AAAA;AACA;AACA;;;;;;;;;AACA;AACA;;;;;;;;;;AAEA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;AAEA;AACA;AAAA;AACA;AACA;;;;;;;;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;;AACA;AACA;AACA;;AAEA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;AAEA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;;;;;;;;;;;;;;AChNA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;;;;;;;;;;;;;ACDA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AAIA;AACA;AAKA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AAEA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AAEA;AACA;AAEA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AAEA;AACA;AAEA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AAOA;AAEA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AAEA;AACA;AAEA;AACA;AACA;AACA;AAEA;AACA;AACA;AAGA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAGA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AAAA;;AAEA;AACA;AACA;;;;;;;;;;;;;AClMA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AAGA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AAmBA;AACA;AAAA;AAdA;AACA;AACA;AACA;AACA;AACA;AAIA;AACA;AACA;AAiBA;AACA;AACA;AACA;AAhBA;AACA;AACA;AAEA;AACA;AACA;AACA;AAEA;AACA;AACA;AAOA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AAAA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;;;;;;;;;;;;;AC/FA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;;;;;;;;;;;;;;;;;;;;;;;;;;;ACDA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AAGA;AAkBA;AAAA;AAGA;AAAA;AAKA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AA7EA;;AACA;AA8EA;AACA;AAEA;AACA;AAEA;AAEA;AACA;AACA;AACA;AAEA;AAGA;AAGA;AACA;;AAAA;AAIA;AACA;AAGA;AAEA;AAAA;AACA;AACA;;;AAAA;AAEA;AAAA;AACA;AACA;;;AAAA;AAEA;AACA;AAEA;AACA;AAKA;AAKA;AAEA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AAEA;AAEA;AAMA;AAMA;AASA;AACA;AASA;AASA;AASA;AAIA;AASA;AAUA;AACA;AAQA;AAEA;AAUA;AACA;AAAA;;AAEA;AACA;AACA;AAEA;AACA;AACA;AAEA;;;;;;;;;;;;;AC/RA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA;AAUA;AAAA;AACA;AACA;AAEA;AAKA;AAIA;AAEA;AAEA;AACA;AAIA;;;;;;;;;;;;;;;;;;;;;;;;;ACpCA;AACA;AACA;AACA;AAIA;AAMA;AACA;AACA;AAEA;AACA;AAEA;AACA;AACA;AAKA;AACA;AAQA;AAAA;AAAA;AAAA;AACA;AACA;AAaA;AACA;AACA;AAMA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AAEA;AACA;AACA;;AA6BA;AAlFA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AAMA;AAAA;AACA;AACA;;;AAAA;AAsCA;AACA;AACA;AACA;AACA;AACA;AAEA;AAEA;AAQA;AASA;AACA;AAAA;AAEA;;;;;;;;;;;;;;AC5HA;AAAA;AAAA;AAAA;AAAA;AACA;;;;;;;;;;;;;;;;;;;;;;;;;;ACDA;AACA;AACA;AAGA;AAMA;AACA;AACA;AACA;AAgBA;AAAA;AACA;AAAA;AAYA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AA3BA;AACA;AACA;;AACA;AAEA;AACA;AACA;AAsBA;AACA;AACA;AAEA;AAEA;AACA;AACA;AACA;AACA;AACA;AAGA;AACA;AAKA;AACA;AAEA;AASA;AACA;AAAA;;AAEA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AAEA;;;;;;;;;;;;;;;;;;;;AC7GA;AACA;AAEA;AACA;AASA;AAAA;AAAA;;AAsBA;AAlBA;AACA;AAEA;AACA;AAEA;AACA;AAEA;AACA;AACA;AACA;AACA;AAEA;AAAA;AACA;AACA;AACA;AAAA;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;ACnCA;AAEA;AACA;AACA;AACA;AAGA;AAEA;AACA;AAEA;AAaA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AAEA;AACA;AACA;AACA;AACA;AAEA;;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AAEA;AACA;;AAEA;AAAA;AACA;AACA;AACA;;;;;;;;;AACA;AAEA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AAEA;AAAA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AAEA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AAEA;AAAA;AACA;AACA;AAEA;AACA;AACA;AACA;AAIA;AAMA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AAAA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;;;;;;;;;;;;;AC7QA;AAAA;AAAA;AAAA;AAAA;AAGA;AAIA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;;AAEA;AAiCA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;;;;;;;;;;;;;ACtEA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;;;;;;;;;;;;;ACFA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AAEA;AAEA;AAOA;AACA;AAAA;AALA;AACA;AACA;AAGA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AAEA;AACA;AAEA;AACA;AACA;AACA;AAAA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;;;;;;;;;;;;;ACvDA;AAAA;AAAA;AAAA;AAAA;;;;;;;;;;;;;ACAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AAIA;AAEA;AAqBA;AACA;AAAA;AAAA;AAAA;AAXA;AAYA;AAEA;AACA;AACA;AAEA;AACA;AAEA;AAAA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AAAA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AAAA;AACA;AACA;AACA;AACA;AAEA;AACA;AAEA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AAAA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AAEA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AAEA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;;;;;;;;;;;;;ACnMA;AAAA;AAAA;AAAA;AAAA;;;;;;;;;;;;;ACAA;AAAA;AAAA;AAAA;AAAA;AAEA;AAOA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;;;;;;;;;;;;;ACtCA;AAAA;AAAA;AAAA;AAAA;;;;;;;;;;;;;ACAA;AAAA;AAAA;AAAA;AAAA;AAIA;AAgDA;AAOA;AACA;AAAA;AAJA;AAKA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AAEA;AACA;AACA;AACA;AAEA;AACA;AAEA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AACA;AAAA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;;;;;;;;;;;;;AC3HA;AAAA;AAAA;AAAA;AAAA;AAAA;AAEA;AAIA;AAkEA;AAgBA;AACA;AAAA;AAfA;AACA;AAGA;AACA;AAKA;AACA;AAKA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AAEA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AAAA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;;;;;;;;;;;;;AC5IA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AAIA;AAwCA;AAMA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AAAA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;;;;;;;;;;;;;ACnFA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;;;;;;;;;;;;;ACFA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AAEA;AACA;AAMA;AACA;AASA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AAEA;AAEA;AACA;AACA;AACA;AAAA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AAEA;AAEA;AACA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AAEA;AAEA;AACA;AACA;AACA;AACA;AAEA;AAEA;AAIA;AACA;AACA;AAEA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AAEA;AACA;AAEA;AACA;AACA;AACA;AAEA;;;;;;;;;;;;;ACxIA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AAOA;AACA;AACA;AAQA;AACA;AACA;AACA;AACA;AAEA;AAEA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AAEA;AAEA;AACA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AAEA;AAEA;AACA;AACA;AACA;AACA;AAEA;AACA;AAEA;AAEA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;;AAEA;;;;;;;;;;;;;ACjKA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;;;;;;;;;;;;;;;;;;;;ACDA;AACA;AAEA;AACA;AASA;AAAA;AAAA;;AAsBA;AAlBA;AACA;AAEA;AACA;AAEA;AACA;AAEA;AACA;AACA;AACA;AACA;AAEA;AAAA;AACA;AACA;AACA;AAAA;;;;;;;;;;;;;;ACnCA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AAEA;AAEA;AAOA;AACA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AAAA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;;;;;;;;;;;;;ACnDA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;;;;;;;;;;;;;ACDA;AAAA;AAAA;AAAA;AAAA;AAEA;AA4BA;AAIA;AACA;AAAA;AAAA;AAEA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AAAA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;;;;;;;;;;;;;AC3DA;AAAA;AAAA;AAAA;AAAA;;;;;;;;;;;;;;;;;;;;;;;;;ACAA;AACA;AAEA;AAGA;AAEA;AAEA;AAgBA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AAEA;AAAA;AACA;AACA;AAEA;AACA;AACA;AACA;AAEA;AAEA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;;;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;;;;;;;;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;;;;;;;;;;;;;ACpNA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AAgCA;AACA;AACA;AAAA;AAAA;AAEA;AACA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AAAA;;AAEA;;;;;;;;;;;;;ACtDA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;;;;;;;;;;;;;;;;;;;;;;;ACCA;AAEA;AACA;AACA;AACA;AAOA;AAAA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AAEA;AAGA;AACA;AAAA;AAEA;AACA;AAAA;AAAA;;AAUA;AATA;AACA;;AAEA;AAEA;AAEA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AAAA;AAAA;;AAIA;AAHA;AACA;AACA;AACA;AAAA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;;ACpFA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AAEA;AACA;AAEA;;;;;;;;;;;;;;;;;;;;;;;;;;;;;ACzBA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AAGA;AACA;AAgCA;AAAA;AAAA;AAAA;AACA;AAEA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AA6EA;AACA;AACA;AAEA;AACA;AACA;AA2BA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;;AA+EA;AAnNA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;;;;;;AACA;AACA;AACA;;AAAA;AAEA;AACA;AACA;AACA;AACA;;;;;AACA;AAEA;AACA;AACA;AAEA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AAUA;AAAA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AAEA;AASA;AAEA;AACA;AA4BA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AAEA;AAAA;AACA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AACA;AAEA;AACA;AACA;AAEA;AAEA;AACA;AACA;AACA;AACA;AACA;;AAAA;AAAA;AACA;AAEA;AAGA;AACA;AAMA;AAGA;AACA;AAEA;AACA;AAEA;AACA;AAEA;AACA;AACA;AAEA;AACA;AAIA;AACA;AAIA;AACA;AAAA;;AAEA;AACA;AACA;AAEA;AACA;AACA;AACA;AAEA;AAEA;AACA;AACA;AACA;AAAA;AACA;AACA;AAEA;AACA;AACA;AACA;AAeA;;AAEA;AACA;AACA;AAEA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AAEA;AAEA;AAGA;AACA;AACA;AAEA;;;;;;;;;;;;;;;;;;;;;;;;;AC7UA;AAYA;AAAA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AAOA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AAGA;AAEA;AACA;AACA;AACA;AAEA;AAEA;;;;;;;;;;;;;AC7DA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AAGA;AAEA;AAQA;AACA;AAAA;AAIA;AAEA;AACA;AACA;AAEA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AACA;AAEA;AACA;AACA;AAEA;AAEA;AACA;AACA;AACA;AAEA;AACA;AAEA;AACA;AACA;AACA;AAEA;AACA;AAEA;AACA;AACA;AACA;AACA;AAEA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AAEA;AACA;AACA;AAEA;AACA;AAEA;AACA;AACA;AAEA;AACA;AAEA;AACA;AAEA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AAEA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AAAA;;;;;;;;;;;;;;AC5LA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAOA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AAAA;AACA;AAEA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AAEA;AACA;AAEA;AACA;AAEA;AAAA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AAEA;AAAA;AACA;AACA;AACA;AACA;AAEA;AACA;AAaA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AAAA;;AAEA;;;;;;;;;;;;;;;;;;;;;;;;;;AC9IA;AACA;AACA;AACA;AACA;AACA;AAIA;AACA;AASA;AAGA;AACA;AAAA;AACA;AACA;AACA;AAmBA;AACA;AACA;AACA;AAEA;;AACA;AAQA;AAEA;AACA;AACA;AACA;AACA;AACA;;AACA;AAAA;AACA;AACA;;;;;;;;;AAEA;AACA;AACA;AAEA;AAQA;AACA;AACA;AACA;AACA;AAEA;AACA;AA9DA;AACA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AAiDA;AAAA;AAKA;AAEA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AAEA;AACA;AACA;AAEA;AACA;AAEA;AACA;AACA;AAEA;AACA;AAEA;AAAA;AACA;AAEA;AACA;AACA;AACA;AACA;AAEA;AAEA;AAEA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AAEA;AAAA;AACA;AAEA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;;AAEA;AAEA;AACA;AACA;AAEA;AAEA;AACA;AACA;AAEA;AACA;AACA;;;;;;;;;;;;;ACtQA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AAcA;AAEA;AASA;AACA;AAAA;AAEA;AACA;AACA;AACA;AAEA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AAEA;AACA;AACA;AAEA;AACA;AAEA;AACA;AAEA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AAEA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AACA;AAAA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AAEA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AAEA;AACA;AACA;AAEA;AAAA;AACA;AACA;AAEA;AACA;AAEA;AAEA;AACA;AACA;AAEA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AAEA;AAAA;AACA;AACA;AAEA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AAEA;AAEA;AACA;AACA;AAEA;AACA;AAEA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AAEA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AAEA;AAEA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AAAA;;AAEA;AAEA;AACA;AACA;AAEA;AACA;AACA;AAEA;;;;;;;;;;;;;ACxSA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AAKA;AACA;AASA;AACA;AACA;AACA;AACA;AAEA;;;;;;;;;;;;;;;;;;;;;;;;;ACtBA;AACA;AAEA;AACA;AACA;AACA;AAEA;AACA;AAIA;AACA;AAQA;AAEA;AAGA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AAGA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AAEA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AAIA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AAGA;AACA;AACA;AACA;AAEA;AACA;AACA;AAIA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;;AACA;AACA;AAEA;AAGA;AACA;AAGA;AAEA;AACA;AACA;AAEA;AACA;;AAEA;AAAA;AACA;AACA;AACA;AAEA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;;AAEA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AAEA;AACA;AACA;AAAA;AACA;AACA;AACA;;;;;;;;;AAEA;AACA;AACA;AAEA;AACA;AACA;AACA;;;;;;;;;AACA;AACA;AAAA;;AAEA;AACA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AAEA;;;;;;;;;AASA;AACA;AAKA;AAAA;AAAA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;;AAEA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AAEA;AACA;AACA;AAAA;AAEA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;;;;;;;;;;;;;;;;;ACjvBA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AAQA;AA4CA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AAEA;AACA;AAEA;AACA;AACA;AAEA;;AACA;;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;AAEA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AAEA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AAEA;AACA;AACA;AACA;AAAA;AAEA;AAEA;AACA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AAEA;AACA;AAEA;AACA;AAEA;AACA;AACA;AAEA;AAEA;AACA;AAEA;AACA;AACA;AAEA;;AACA;;AAEA;AAAA;AACA;AACA;AACA;AACA;;;;;;;;;AACA;AAEA;;AACA;;AAEA;AAAA;AACA;AACA;;;;;;;;;AACA;AAEA;AACA;AAEA;AACA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;;AACA;;AAEA;AAAA;AACA;AACA;AACA;AAEA;;AACA;AAAA;AACA;AACA;AACA;AACA;;;;;;;;;AACA;AACA;;;;;;;;;AAEA;AACA;AAEA;AACA;AACA;AACA;AACA;AAEA;;;AACA;AAAA;AACA;AACA;AACA;AACA;;;;;;;;;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AAEA;AAEA;AAEA;AAEA;AACA;AAEA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AAEA;;AACA;AACA;AACA;AAEA;AACA;;AAEA;AACA;AAAA;AACA;AACA;;;;;;;;;AAEA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AAEA;AAEA;AAEA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AAEA;AAEA;AACA;AACA;AACA;AACA;AACA;;;AALA;AAAA;AAMA;AACA;AAEA;AACA;AACA;AACA;AACA;AAEA;AACA;AAEA;AACA;AAEA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AAEA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AAAA;AACA;AACA;AAEA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;;;AA1CA;AAAA;AA2CA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AAEA;AACA;AAEA;AACA;AACA;AAEA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AAEA;AAAA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AACA;AAEA;AACA;AAEA;;AACA;;AACA;AAAA;AACA;AACA;;;;;;;;;AACA;AAEA;;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;;AAEA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;AAEA;AAEA;AACA;AACA;AACA;AAEA;AAEA;AACA;AACA;AACA;AAEA;AACA;AAEA;AACA;AACA;AACA;AAEA;AAEA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AAEA;;AAEA;AACA;AACA;AAEA;AACA;AAEA;AACA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AAEA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AAEA;AACA;AAEA;AACA;AAGA;AACA;AACA;AAEA;AAEA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AAEA;AACA;AAEA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AAEA;;;AACA;AAAA;AACA;;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;AACA;AACA;;;;;;;;;AACA;AAEA;;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;;AAEA;AAAA;AACA;AACA;AACA;;;;;;;;;AACA;AA33BA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAq3BA;AAAA;AA/5BA;;;;;;;;;;;;;;;;;;;;;;;;;;ACtBA;AACA;AACA;AACA;AACA;AACA;AACA;AAUA;AAEA;AACA;AAEA;AACA;AAUA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AAEA;AAiDA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AACA;AAEA;AACA;AAEA;AACA;AACA;AAEA;;AACA;;AACA;AAAA;AACA;AACA;AACA;AACA;;;;;;;;;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AAEA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AAEA;AACA;AACA;AAEA;AAAA;AACA;;AACA;AACA;AACA;AACA;AAIA;AACA;AAEA;AAAA;AACA;AAEA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AAEA;;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;;AAEA;AACA;AAAA;AACA;AACA;AACA;AAEA;AACA;;;;;;;;;AAEA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AAAA;;AAEA;AACA;AACA;;;;;;;;;;;;;;;;;;;;;;;;;;;;AC3XA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AAiCA;AACA;AACA;AACA;AAEA;AAMA;AACA;AACA;AAEA;;AAEA;AACA;AAAA;AAAA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AAEA;AAEA;AACA;AACA;AAEA;AACA;AACA;AAEA;;;;;;AAEA;AAeA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;;;;AAGA;;AAAA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AAEA;;;;AAEA;;;;;;AAEA;AAEA;AAAA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AAAA;;AAEA;AAGA;;;;AACA;AACA;AACA;AACA;AAAA;;;;AACA;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;ACtMA;AACA;AACA;AACA;AACA;AACA;AACA;AAcA;AAEA;AAEA;AAEA;AAEA;AAEA;;AAEA;AACA;AAEA;;AAEA;AACA;AAEA;AAAA;AACA;;;;AACA;;AAAA;AACA;;;;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAOA;AACA;AAGA;AACA;;;AACA;;AAAA;;;;AACA;AACA;AAEA;AAAA;AAKA;;;;;;AACA;AACA;;AAEA;AAAA;AACA;AACA;AACA;AAEA;AAEA;AACA;AACA;AACA;AAEA;AACA;;;;;;;;;AAEA;;AAAA;AACA;;AAAA;;;;AACA;AACA;AAEA;AAAA;AACA;;;;;;AACA;AACA;;AAEA;AAAA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;AAEA;;AAAA;AACA;;AAAA;;;;AACA;AACA;AAEA;AAAA;AACA;;;;;;AACA;AACA;;AAEA;AAAA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;AAEA;AACA;AACA;AACA;AACA;AACA;AAEA;;AAAA;AACA;;AAAA;;;;AACA;AACA;AAEA;AAAA;AACA;;;AACA;;AAAA;AACA;AACA;;;;AACA;AACA;AAEA;AAAA;AACA;;;AACA;;AAAA;AACA;;;;AACA;AACA;;;;;;;;;;;;;AC1JA;AAAA;AAAA;AAAA;AAAA;AAAA;AAEA;AAEA;AAEA;AACA;AAEA;AACA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AAEA;AACA;AACA;AAEA;AAEA;AACA;AACA;AACA;AACA;;;;;;;;;;;;;;;;;;;;;;;ACrDA;AACA;AAWA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AAIA;AAEA;AACA;AAIA;AAEA;AACA;AAIA;AAEA;AACA;AAIA;AAEA;AACA;AAOA;AAEA;AACA;AAMA;AAEA;AACA;AACA;AACA;AAEA;AAOA;AAEA;AACA;AAEA;AAGA;AACA;AACA;AAEA;AAEA;AACA;AAGA;AACA;AACA;AAEA;AAEA;AACA;AAEA;AACA;AACA;AACA;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AC3HA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAaA;AACA;AASA;;AAEA;AACA;AACA;AACA;AAIA;AAEA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AAEA;AACA;AACA;AACA;AACA;AACA;AAGA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AAEA;;;;;;;AAOA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AAEA;AAEA;AAEA;AACA;AACA;AACA;AACA;AAAA;AAOA;AACA;AACA;AACA;AACA;AAGA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AAEA;;;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;;;;;;;;;AAEA;AACA;AACA;AACA;AAEA;AACA;AAEA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AAAA;AACA;AACA;AAAA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AAEA;AACA;AAEA;;;;AAIA;AACA;;AACA;AACA;AACA;AAEA;;AAEA;AAAA;AACA;;AAEA;AACA;AAAA;AACA;AACA;;;;;;;;;AAEA;AACA;;;;;;;;;AAEA;AACA;AAEA;AACA;AAEA;AACA;AACA;AACA;AACA;AAEA;AACA;AAEA;AACA;AAIA;;;;;;;;;;;;;AC9NA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AAIA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AAEA;AACA;AAEA;AACA;AAEA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AAOA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AAEA;AACA;AACA;AAEA;AACA;AAEA;AACA;AACA;AACA;AACA;;;;;;;;;;;;;AClLA;AAAA;AAAA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;;ACpBA;AAAA;AAAA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;ACTA;AAIA;AAGA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AAGA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AAMA;AAEA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AAMA;AAEA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AAIA;AAEA;AACA;AAEA;AACA;AACA;;;;;;;;;;;;;AChGA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAwLA;;AAEA;AACA;AAEA;;AAEA;AACA;AAEA;;;AAGA;AACA;AAEA;;;AAGA;AACA;AAEA;;AAEA;AACA;AAEA;;AAEA;AACA;AAEA;;AAEA;AACA;AAIA;;;AAGA;AACA;AAEA;;AAEA;AACA;AAEA;;AAEA;AACA;AAEA;;AAEA;AACA;AAEA;;;;;;AAMA;AACA;AAEA;AAEA;AAIA;;AAEA;AACA;AAEA;;;;AAIA;AACA;AAEA;;AAEA;AACA;AAEA;;;AAGA;AACA;AAEA;;AAEA;AACA;AAEA;;;;AAIA;AACA;AAEA;AACA;;AAEA;AACA;AAEA;;AAEA;AACA;AAEA;;AAEA;AACA;AAEA;;AAEA;AACA;AAIA;AAEA;;AAEA;AACA;AACA;AAEA;AAEA;AAEA;AAEA;AAEA;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AC/UA;AAGA;AAWA;AAGA;AAUA;AACA;AAsCA;AACA;AAEA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AAEA;AACA;AAEA;AAMA;AAEA;AACA;AACA;AAEA;AACA;AACA;AACA;AAEA;AAKA;AAEA;AACA;AACA;AACA;AAEA;AACA;AASA;AAEA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AAEA;AAYA;AAEA;AACA;AACA;AACA;AAUA;AAEA;AACA;AACA;AACA;AAEA;AACA;AACA;AAGA;AACA;AACA;AACA;AAOA;AAEA;AACA;AAEA;AACA;AAEA;AAEA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AAEA;AAcA;AAEA;AACA;AAMA;AAEA;AACA;AAKA;AAEA;AACA;AACA;AAQA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AAKA;AAEA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AAEA;AAMA;AAEA;AACA;AACA;AAEA;AACA;AAMA;AAEA;AACA;AACA;AAKA;AAEA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AAEA;AACA;AAEA;AACA;AACA;AACA;AACA;AAEA;AACA;AAEA;AACA;AACA;AAKA;AAEA;AACA;AACA;AAIA;AAEA;AACA;AAIA;AAEA;AACA;AAIA;AAEA;AACA;AACA;AAGA;AAGA;AAEA;AACA;AACA;AAQA;AAEA;AACA;AACA;AAIA;AAEA;AACA;AACA;AAIA;AAEA;AACA;AACA;AAEA;AACA;AAEA;AAIA;AACA;AAEA;AACA;AACA;AACA;AAEA;AACA;AAEA;AASA;AAEA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AAEA;AAKA;AACA;AAIA;AAEA;AAKA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AAKA;AAEA;AACA;AACA;AACA;AACA;AAEA;AAMA;AACA;AACA;AACA;AAGA;AAEA;AACA;AACA;AAEA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AAEA;AACA;AAEA;;;AAGA;AACA;;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAKA;AAEA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AAEA;AAQA;AAEA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AAEA;AAMA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AAEA;AACA;AACA;;;;;;;;;;;;;;;;;;;;;;;;;ACtrBA;AASA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AAEA;AAEA;AACA;AACA;AAEA;AAOA;AAEA;;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;;AAEA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;AAEA;AACA;AAEA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;;AAEA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;;;;;;;;;;;;;;;;;;;;;;ACxHA;AACA;AACA;AAEA;;AAEA;AACA;AAAA;AACA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;;AAEA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;;;;;;;;;;;AC5CA;AACA;AAEA;AACA;AAEA;AACA;AAOA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AAEA;AAAA;AAAA;AAAA;AACA;AAEA;AACA;AACA;AAKA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AAEA;AACA;AAEA;AACA;AACA;AAIA;AAEA;AACA;AACA;AAIA;AAEA;AACA;AACA;AAIA;AAEA;AACA;AACA;AAIA;AAEA;AACA;AACA;AAIA;AAEA;AACA;AACA;AAIA;;AAyCA;AAvCA;AACA;AACA;AACA;AACA;AACA;AAEA;AAEA;AACA;AACA;AAEA;AACA;AACA;AAIA;AAGA;AAEA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AAMA;AACA;AAAA;;;;;;;;;;;;;;AC5JA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA;;;;;;;;;;;;;ACNA;AAAA;AAAA;AAAA;AAAA;AACA;AAKA;AAEA;AAOA;AACA;AACA;AACA;AACA;AAVA;AAEA;AAWA;AACA;AAEA;AAAA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AAEA;AAAA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;;;;;;;;;;;;;;ACjDA;AAAA;AAAA;AAAA;AACA;AAIA;AAKA;AACA;AACA;AAEA;AAGA;AACA;AAEA;AAEA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;;;;;;;;;;;;;;AC7BA;AAAA;AAAA;AACA;AAAA;AAAA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AAEA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AAAA;AACA;AACA;AAEA;AACA;AACA;AACA;AAAA;;;;;;;;;;;;;;;;;;;;;;;;;AC9DA;AAGA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AAKA;AACA;AACA;AAKA;AACA;AACA;AAIA;AACA;AACA;AAEA;AAEA;AAEA;AACA;AACA;;;;;;;;;;;;;;;;;;;;;ACjDA;AACA;AACA;AAMA;AAwBA;AACA;AACA;AACA;AAEA;AAGA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AAEA;;AACA;AACA;AACA;AACA;AAEA;;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AAAA;AACA;AACA;AAEA;AACA;;;;;;;;;AACA;AAEA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AAEA;AACA;AACA;AAAA;AACA;AACA;AAEA;AACA;AACA;AACA;AAEA;;AACA;;AACA;AAAA;AACA;AACA;AACA;AACA;;;;;;;;;AACA;AAEA;AAAA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AAEA;AAAA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AAEA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AAEA;AAAA;AACA;AAEA;AACA;AAEA;AACA;AACA;AAAA;AACA;AACA;AAAA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;;AAEA;;;;;;;;;;;;;ACtPA;AAAA;AAAA;AAGA;AACA;AACA;AACA;AACA;AAAA;;;;;;;;;;;;;;;;;;;;;ACTA;AAKA;AAEA;AAIA;AACA;AAAA;AACA;AACA;AAEA;AAEA;AACA;AACA;AACA;AAIA;AACA;AAEA;AAAA;AACA;AACA;AAGA;AACA;AAEA;AAEA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;;;;;;;;;;;;;;ACjDA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AAEA;AAEA;AAOA;AACA;AAAA;AAHA;AAGA;AAEA;AACA;AACA;AAEA;AAAA;AACA;AACA;AACA;AACA;AAGA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AACA;AAAA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;;;;;;;;;;;;;AC9DA;AAAA;AAAA;AAAA;AAAA;;;;;;;;;;;;;ACAA;AAAA;AAAA;AAAA;AAAA;;;;;;;;;;;;;ACAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AAEA;AAOA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AAEA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AAEA;;;;;;;;;;;;;ACtEA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AAEA;AAEA;AACA;;;;;;;;;;;;;;;;;;ACdA;AAGA;AACA;AACA;AACA;AAEA;AAGA;AACA;AAAA;AAHA;AAGA;AAEA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AAEA;;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;;AAEA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;AAEA;AACA;AACA;AACA;AAAA;;AAEA;;;;;;;;;;;;;ACrEA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AAIA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;;AAEA;;;;;;;;;;;;;ACrBA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AAGA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AAAA;;AAEA;;;;;;;;;;;;;ACrCA;AAAA;AAAA;AAAA;AAKA;AAKA;AACA;AAAA;AAAA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AAAA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AAAA;;AAEA;;;;;;;;;;;;;ACjCA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;;;;;;;;;;;;;;;;;;;;;;ACFA;AAIA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AAEA;AAEA;AACA;AACA;;;;;;;;;;;;;AC3BA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;;;;;;;;;;;;;;ACNA;AAEA;AAEA;AACA;AACA;AAEA;AAcA;AAEA;AAAA;AAkBA;AAAA;AAFA;AAqFA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AApHA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AAEA;AAAA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AAEA;AAEA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AAEA;AACA;AAEA;AACA;AACA;AACA;AACA;AAwCA;AACA;AACA;AACA;AAEA;AACA;AACA;AAEA;AAEA;AACA;AAEA;AACA;AAEA;AACA;AACA;AACA;AAAA;AACA;AACA;AAEA;AACA;AACA;AACA;AAEA;AACA;AAEA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AAAA;AACA;AACA;AACA;AAEA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AACA;AAEA;AACA;AACA;AAAA;AACA;AACA;AACA;AAEA;;;;;;AACA;AACA;AACA;;AACA;AACA;AACA;;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAVA;AAWA;;AAEA;;;;AACA;AACA;AAAA;AAEA;;;;;;;;;;;;;;;;;;;;;;;;;;;;AC/QA;AACA;AAEA;AACA;AACA;AACA;AAQA;AAGA;AACA;AACA;AAGA;AAmBA;AAAA;AAqQA;AACA;AArQA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AAEA;AACA;AAEA;AACA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AAEA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AAAA;AACA;AACA;AACA;AAEA;;;;;;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AADA;AACA;AAAA;;AADA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;;;;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AAAA;;AACA;;;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AAEA;AACA;AACA;;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;AACA;AACA;AAEA;AAEA;AACA;AAIA;AAAA;;;;;;;;;;;;;;AChTA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AAEA;AAsBA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AAMA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AAEA;AACA;AACA;AACA;AAEA;AAEA;AACA;AAEA;AACA;AAEA;AACA;AAAA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AAEA;AACA;AAEA;AAEA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AAOA;AACA;AACA;;;;;;;;;;;;;ACjPA;AAAA;AAAA;AAAA;AAEA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AAEA;AACA;AACA;AACA;AAEA;AAEA;AACA;AACA;AACA;AAEA;;;;;;;;;;;;;;;;;;ACzCA;AAEA;AAEA;AAYA;;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AAEA;AAEA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AAIA;AACA;AACA;AAEA;AAEA;AACA;;AACA;AAAA;AACA;AACA;;;;;;;;;AACA;AACA;AAEA;AACA;AACA;AAEA;;;;;;;AACA;;;;AAEA;;AAAA;;;;AAAA;AACA;;;;;;;;;;;;;;;;AAGA;;;;AACA;AAEA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;;;;;AACA;AAEA;AACA;AACA;AACA;AAEA;AACA;;AAAA;AACA;AACA;AAEA;AACA;AACA;;;;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;;;;;;;;;;;;;AC1HA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;;ACjCA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAYA;AACA;AAiCA;;AAEA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AC7JA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AAWA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AAEA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAGA;;AACA;;AACA;AAAA;;AACA;AAAA;AACA;;AACA;AAAA;AACA;AACA;;;;;;;;;AACA;AACA;;;;;;;;;AACA;;;;;;;;;AAEA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AAEA;;AACA;AACA;AACA;AACA;;AACA;AAAA;;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;AACA;;;;;;;;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAIA;AACA;AAGA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAMA;AACA;AACA;AAAA;AAAA;AAAA;AA0BA;;AAEA;AACA;;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AAGA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AA3EA;AAEA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AAqDA;;;;AAIA;AACA;AACA;AACA;AACA;AACA;AAAA;;AAEA;AAEA;AACA;AACA;AAEA;AACA;AACA;AAEA;;;;;;;;;;;;;ACzTA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AAGA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AAAA;;AAEA;AACA;AACA;AACA;;;;;;;;;;;;;AC9DA;AAAA;AAAA;AAAA;AAAA;AAGA;AASA;AAAA;AAAA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AAAA;;;;;;;;;;;;;;ACpBA;AAAA;AAAA;AAAA;AAAA;AAEA;AAEA;AAOA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AAAA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;;;;;;;;;;;;;AC7CA;AAAA;AAAA;AAEA;AAOA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AAEA;AAEA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;;;;;;;;;;;;;AC/CA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA;;;;;;;;;;;;;ACJA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AAKA;AAQA;AAeA;AACA;AAAA;AACA;AACA;AACA;AAlBA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AAYA;AACA;AAEA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AAEA;AAAA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AAEA;AAAA;AACA;AAEA;AAEA;AACA;AACA;AAEA;AAEA;AACA;AACA;AAEA;AACA;AAEA;AAEA;AACA;AACA;AAEA;AACA;AACA;AAEA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AACA;AAAA;;AAEA;;;;;;;;;;;;;ACtJA;AAAA;AAAA;AAAA;AAGA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;;;;;;;;;;;;;AChCA;AAAA;AAAA;AAAA;AAAA;AAGA;AAMA;AACA;AAAA;AAAA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AAEA;AACA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AAAA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;;;;;;;;;;;;;AC9EA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AAEA;AAWA;AACA;AAAA;AAAA;AAAA;AANA;AAMA;AAEA;AAAA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AACA;AAEA;AAAA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AAEA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AAAA;;AAEA;;;;;;;;;;;;;AC3HA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AAGA;AACA;AAEA;AAIA;AACA;AAAA;AAAA;AAAA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AAAA;AACA;AAEA;AAEA;AACA;AAEA;AACA;AACA;AAEA;AAEA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;;AAEA;;;;;;;;;;;;;AClDA;AAAA;AAAA;AAAA;AAOA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;;ACxBA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AACA;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;ACHA;;AACA;AAAA;;AAAA;AACA;;AACA;AAAA;;AAAA;AACA;;AACA;AAAA;;AAAA;AACA;;AACA;AAAA;;AAAA;AACA;;AACA;AAAA;;AAAA;AACA;;AACA;AAAA;;AAAA;AACA;;AACA;AAAA;;AAAA;AACA;;AAAA;AAAA;;AAAA;AACA;;AACA;AAAA;;AAAA;AACA;;AACA;AAAA;;AAAA;AACA;;AACA;AAAA;;AAAA;AACA;;AACA;AAAA;;AAAA;AACA;;AACA;AAAA;;AAAA;AACA;;AACA;AAAA;;AAAA;AACA;;AACA;AAAA;;AAAA;AACA;;AACA;AAAA;;AAAA;AACA;;;AACA,mTACA;AADA;;;AAEA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;;;;;;;;;;;;;AClGA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AAEA;AACA;AACA;AACA;AAEA;AACA;AAKA;AACA;AAEA;AAGA;AACA;AACA;AACA;AACA;AAEA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AAEA;AAAA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AAEA;AACA;AAEA;AAEA;AACA;AACA;AACA;AACA;AAEA;AACA;AAEA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AACA;AAAA;AACA;AACA;AAAA;AACA;AACA;AAEA;AAEA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AAEA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;;AAEA;AACA;AACA;AAEA;AACA;;;;;;;;;;;;;ACrMA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AAEA;AACA;AAGA;AAIA;AACA;AAQA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAGA;AACA;AAIA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AAEA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;ACrQA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AAWA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AAEA;;;;AAIA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AAAA;AACA;AACA;;;;;;;;;AAEA;AAAA;;;;;AACA;AACA;AAEA;AACA;AAAA;AAEA;AAGA;;;;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AAKA;AACA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AAMA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;;ACtQA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AAEA;AAIA;AAEA;AAMA;AACA;AAAA;AAAA;AAAA;AAAA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;;AAEA;;;;;;;;;;;;;;;;;;;;AC1DA;AAGA;AAEA;AAAA;AACA;;;;AACA;;AAAA;AACA;;;;AACA;AACA;AAEA;AAAA;AACA;;;;;AACA;AACA;AACA;;AAAA;AACA;;;;AACA;AACA;;;;;;;;;;;;;;;;;;;;;;;;;;ACnBA;AAGA;AAGA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AAQA;AAEA;AACA;AACA;;;;;;;;;;;;;;;;;;;;;;;ACjDA;AACA;AACA;AACA;AACA;AAIA;;;;;AACA;;AAAA;AACA;AACA;AACA;AAAA;AACA;AACA;;;;;AACA;AAEA;AACA;AAAA;AACA;AACA;AACA;;;;AACA;;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;AACA;AACA;AACA;AAEA;;;;;;;;;;;;;ACrCA;AAAA;AAAA;AAAA;AAAA;AACA;AAIA;AAIA;AACA;AAAA;AAJA;AAKA;AACA;AACA;AAEA;AAAA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;;AAEA;;;;;;;;;;;;;AC9DA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AAGA;AAEA;AASA;AACA;AACA;AAWA;AAIA;;;;;;;;;;;;;;;;;;;;ACxCA;AAGA;AAUA;AAAA;AAAA;;AA0DA;AAzDA;AACA;AACA;AAEA;AAAA;AACA;AAEA;AACA;AACA;AAEA;AAIA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAGA;AAEA;AAEA;AACA;AACA;AAQA;AACA;AAQA;AAQA;AACA;AAAA;;AAEA;;;;;;;;;;;;;;;;;;;;;ACzEA;AACA;AAEA;AAeA;AAAA;AACA;AAAA;AAcA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AACA;AAzBA;AAGA;AACA;AACA;AACA;AACA;;AACA;AAmBA;AACA;AACA;AACA;AAEA;AAEA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AAOA;AAEA;AAIA;AACA;AACA;AAOA;AAEA;AAIA;AACA;AAOA;AACA;AAAA;;AAEA;;;;;;;;;;;;;;;;;;;;ACxGA;AAEA;AAQA;AAAA;AAAA;;AAgDA;AA/CA;AACA;AACA;AAEA;AACA;AAEA;AACA;AACA;AAEA;AAIA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAGA;AAEA;AAEA;AACA;AAEA;AACA;AACA;AAGA;AAQA;AACA;AAAA;;AAEA;;;;;;;;;;;;;AC5DA;AAAA;AAAA;;;;;;;;;;;;;ACCA;AAAA;AAAA;AAAA;AAAA;AAEA;AACA;AACA;AACA;AAEA;AAAA;AACA;AACA;AAEA;AACA;AACA;;;;;;;;;;;;;;;;;;;;;;;;;;;;ACdA;AAIA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AAEA;AAEA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AAEA;AAEA;AACA;AACA;AACA;;;;;;;;;;;;;;;;;;;ACxDA;AAEA;AAEA;AAAA;AACA;AAAA;AAKA;AACA;AACA;AAEA;AACA;AACA;AATA;;AACA;AAUA;AACA;AAEA;AACA;AACA;AAEA;AACA;AAEA;AACA;AAEA;AACA;AAYA;AACA;AAAA;;;;;;;;;;;;;;AC7CA;AAAA;AAAA;AAAA;AAWA;AAqBA;AACA;AAAA;AAAA;AAZA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAIA;AACA;AAEA;AACA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AAAA;;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;;ACtEA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AAUA;AAmBA;AACA;AAAA;AAXA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAIA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AAEA;AAAA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AAEA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AACA;AAAA;;AAEA;AACA;AACA;AACA;AACA;;;;;;;;;;;;;ACnGA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AAEA;;;;;;;;;;;;;ACjBA;AAAA;AAAA;AAAA;AAWA;AAqBA;AACA;AAAA;AAAA;AAZA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAIA;AACA;AAEA;AACA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AACA;AAAA;;AAEA;AACA;AACA;AACA;AACA;;;;;;;;;;;;;ACrEA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AAWA;AA2BA;AACA;AAAA;AAAA;AAfA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAIA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;;AAEA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;;AC5FA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AAIA;AAEA;AAyBA;AACA;AACA;AACA;AACA;AACA;AApBA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AASA;AACA;AACA;AAEA;AACA;AAEA;AACA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;;AAEA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;;;;;;;;;;;;;;ACvHA;AACA;AACA;AAEA;AACA;AACA;AAIA;AAEA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAUA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AAEA;AAOA;AACA;AAEA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AAEA;AAEA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AAEA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AAEA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AAEA;AAEA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AACA;AAEA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AAEA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AAEA;;AACA;AAEA;AACA;AACA;;;AAEA;AACA;AACA;AAAA;;AAEA;;;;;;;;;;;;;ACtPA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AAcA;AA6BA;AACA;AACA;AACA;AACA;AACA;AApBA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AASA;AACA;AACA;AAEA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AAAA;;AAEA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;;ACpHA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AAaA;AAMA;AACA;AACA;AAEA;AA6CA;AACA;AACA;AACA;AACA;AACA;AACA;AA7BA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAUA;AACA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AACA;AAEA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AAEA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AAEA;AACA;AAEA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AAEA;AACA;AACA;AAEA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AAEA;AAEA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AACA;AAEA;AACA;AAEA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AAEA;AACA;AACA;AACA;AAAA;;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;;;;;;;;;;;AC5PA;AACA;AACA;AACA;AAGA;AACA;AACA;AAMA;AAUA;AAPA;AACA;AACA;AACA;AACA;AACA;AAGA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AAEA;;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AAEA;AAGA;AACA;AAEA;AACA;AAEA;AACA;AAEA;AACA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AAEA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AAEA;;AACA;AAGA;AACA;AAEA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AAEA;AAAA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AAEA;AACA;AAEA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AAEA;AAAA;AACA;AACA;AACA;AAEA;AAEA;;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AAEA;AACA;AACA;AAEA;AAAA;AACA;AACA;AACA;AAEA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AAEA;AAEA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;;AAEA;;;;;;;;;;;;;AC3XA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AAGA;;;;;AAKA;AACA;AAEA;AACA;AACA;AACA;AACA;AAEA;AAEA;AACA;AAAA;AAEA;AAKA;AACA;AACA;AACA;AAEA;AAEA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AAAA;AACA;AACA;AACA;AACA;AAEA;AAAA;AACA;AACA;AACA;AACA;AAEA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAoGA;AACA;AAEA;AAAA;AAAA;AAAA;;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AAEA;AACA;;;;;;;;;;;;;;;;;;;;;;;;;;;ACvLA;AACA;AACA;AAEA;AACA;AACA;AACA;AAKA;AACA;AACA;AAEA;AAEA;AAIA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;;AAAA;AACA;AACA;AACA;AAKA;AACA;AACA;;AAEA;AACA;AAAA;AACA;AACA;;;;;;;;;AAEA;AACA;AACA;AAEA;AACA;AAEA;AACA;AACA;AACA;AAEA;AAAA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;;AAAA;AACA;;AAEA;AAAA;AACA;AACA;AACA;AACA;;;;;;;;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AAEA;AAAA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AAEA;AACA;AAEA;AACA;AACA;AACA;AAEA;AACA;AAEA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AAAA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AAEA;;;;;;AAMA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AAEA;AACA;AACA;AAAA;AACA;AACA;AAEA;AACA;AACA;AAEA;;AAAA;AACA;;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AAEA;AACA;AACA;AACA;AAEA;AACA;AACA;AAEA;AAAA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AAAA;;AAEA;;;;;;;;;;;;;;;;;;;;;;;;ACzYA;AAGA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AAEA;AAEA;AACA;AACA;;;;;;;;;;;;;ACtCA;AAAA;AAAA;AAEA;AACA;;;;;;;;;;;;;;;;;;;;;;ACHA;AACA;AACA;AAOA;AAAA;AACA;AAEA;AAEA;AACA;AACA;AACA;AAEA;AACA;;;;;;;;;;;;;;;;;;;;;ACpBA;AACA;AAIA;AASA;AACA;AACA;AAEA;AAKA;AACA;AAOA;AACA;AACA;AAKA;AAAA;AAIA;AACA;AAKA;AAAA;AAIA;AACA;AAMA;;;;;;;;;;;;;;;;;;;;;;AC3DA;AACA;AAEA;AAUA;AACA;AAEA;AACA;AACA;AACA;AAAA;AACA;AAEA;AACA;;AACA;AAAA;AAAA;AAGA;AACA;AACA;AACA;AAEA;AACA;AAAA;AAAA;AAAA;AACA;AAEA;AAEA;AAAA;AAAA;AAEA;;AAIA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AAEA;AACA;;AAKA;AAAA;AAAA;AAEA;AAvBA;AA4BA;AAKA;;AAIA;AAAA;AAAA;AAKA;;;;;;;;;;;;;;;;;;;;;AChFA;AACA;AAQA;AAAA;AAAA;AAEA;AAGA;AALA;AASA;AAAA;AACA;AAEA;AACA;AACA;AAIA;;;;;;;;;;;;;;;;;;;;;AC3BA;AAEA;AAGA;AAkBA;AAAA;AACA;AAMA;;;;;;AAMA;AAEA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AAMA;AAEA;AAEA;;;AACA;AACA;;AACA;AAEA;AAEA;AAFA;AAKA;AAEA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;;AACA;AAAA;AAAA;AAGA;AACA;AACA;AACA;AACA;AAEA;AACA;AAEA;AACA;AAKA;AAAA;AAAA;AAIA;AAEA;AACA;AAKA;AAAA;AAAA;AAIA;AACA;AAKA;AAAA;AAAA;AAIA;AACA;AAQA;AACA;AAWA;;;;;;;;;;;;;;;;;;;;AC/IA;AAGA;AASA;AACA;AAEA;AAAA;AAAA;AAEA;AACA;AAMA;AACA;AAEA;AACA;AAHA;AAQA;AAGA;AAIA;AAAA;AAAA;AACA;AAAA;AAAA;AA1BA;;;;;;;;;;;;;ACfA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA;;;;;;;;;;;;;;;;;;;;;;;;;;ACJA;AACA;AAEA;AACA;AAGA;AACA;AACA;AAEA;AACA;AACA;AAUA;AACA;AACA;AAaA;AAAA;AACA;AAAA;AAsDA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AA4BA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AAjGA;AACA;AACA;AACA;;AACA;AAEA;AACA;AACA;AACA;AAEA;;;AACA;;;;AACA;AAEA;;;;;;;AACA;AAEA;AACA;AACA;;AAAA;AACA;AACA;AAEA;AACA;AACA;AACA;AAEA;;AAAA;AACA;;;;AAEA;;;;AAAA;AACA;AAAA;;AAAA;;;AAAA;;;AAAA;AACA;AAEA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;;;;;;AAGA;;;;;;AAEA;AAYA;AACA;AAEA;AAGA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AAKA;AAGA;AAaA;;AAAA;AACA;AACA;AAEA;AACA;;AAEA;AAAA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AAEA;AACA;AACA;AACA;AACA;;;;;;;;;AAEA;AACA;AAKA;AAEA;AACA;AAEA;AAEA;AACA;AACA;AAQA;AAGA;AACA;AAAA;;;;;;;;;;;;;;ACpMA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;;;;;;;;;;;;;;;;;;;;;;ACFA;AAEA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AAEA;AACA;AAEA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AAMA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;;AC3EA;AAAA;AAAA;;;;;;;;;;;;;;;;;;;;;ACFA;AACA;AACA;AASA;;;;AAEA;;AAAA;AACA;AACA;AAGA;;;AACA;AAEA;AAAA;AAGA;AAAA;AAFA;AAUA;AAAA;AACA;AAOA;AAEA;AACA;AAEA;;AAAA;AAAA;AACA;AACA;AAIA;AAEA;AAIA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AACA;AAGA;AA5CA;AACA;AACA;;AACA;AA2CA;AAAA;AACA;AAGA;AAEA;AAOA;AACA;AACA;AAEA;AAAA;AAAA;AAMA;AAIA;AACA;AACA;AAOA;AAGA;AACA;AAAA;AAEA;;;;;;;;;;;;;ACnHA;AAAA;AAAA;AAAA;AAAA;AAqBA;AACA;AACA;AACA;AAEA;AAIA;AAIA;AAGA;AAEA;AAMA;AACA;AAGA;AACA;AACA;AACA;AAEA;AACA;AAKA;AACA;AAGA;;;;;;;;;;;;;;;;;;;;;AChEA;AACA;AAIA;AACA;AASA;AACA;AAEA;AACA;AACA;AACA;AACA;AAEA;AAKA;AACA;AACA;AACA;AAEA;AAEA;AAeA;;;;;;;;;;;;;;;;;;;;ACnDA;AACA;AAEA;AAeA;AACA;AAOA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AAYA;AAAA;AAKA;AAAA;AAYA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AAEA;;;;;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AAEA;;AAAA;AAKA;AAEA;;;AACA;AAtDA;AACA;AACA;AACA;AACA;AACA;AACA;;AACA;AAiDA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AAEA;AACA;AACA;AAUA;AACA;AAeA;AAGA;AACA;AAAA;;;;;;;;;;;;;;;;;;;;;ACpLA;AAKA;AAEA;;;;;;;AAOA;AACA;AAMA;AAEA;AACA;AACA;AACA;AAEA;AACA;;;AACA;;AAAA;AACA;AACA;AACA;;;;AACA;AAEA;;;AACA;;AAAA;AAEA;AACA;AACA;AACA;AACA;;;;AACA;AAEA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAIA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;;;;;;;;;;;;ACpFA;AACA;AAIA;AACA;AAEA;AAEA;;;;AAIA;AACA;AACA;AACA;AACA;AACA;AAEA;;;;AAIA;AACA;AAEA;AAOA;AACA;;;;AACA;AACA;;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;;;;AACA;AAEA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;;;;;;;;;;AC3DA;AAIA;AACA;AAoBA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA;AAwBA;AACA;AACA;AACA;AACA;;AAwCA;AAlEA;AACA;AACA;AAEA;AACA;AACA;AAEA;AAAA;AACA;AACA;AACA;AAOA;AACA;AACA;AAQA;AACA;AACA;AAEA;AAEA;AACA;AACA;AACA;AAAA;AAAA;AAGA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAGA;AACA;AACA;AACA;AACA;AACA;AAKA;AAGA;AACA;AAAA;;;;;;;;;;;;;;;;;;;;;;;ACjGA;AACA;AACA;AAWA;AAAA;AAGA;AAAA;AAgBA;AACA;AACA;AACA;AAjBA;AACA;;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AAOA;AACA;AAEA;AACA;AACA;AACA;AAEA;AACA;AAKA;AACA;AAAA;;;;;;;;;;;;;;;;;;;;;;;ACpDA;AAIA;AAEA;AACA;AAWA;AACA;AAOA;AACA;AACA;AAKA;AAEA;AACA;AACA;AACA;AAAA;AAAA;AAGA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAGA;AAMA;;;;;;;;;;;;;;;;;;;;AC3DA;AAGA;AASA;AAAA;AACA;AAEA;AACA;AACA;AACA;AACA;AAAA;AAAA;AAGA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAOA;;;;;;;;;;;;;;;;;;;;;;ACtCA;AACA;AAMA;AACA;AAiBA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AAAA;AAAA;AAAA;AACA;AAkBA;AAAA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AAEA;AACA;AAEA;AACA;;AAsEA;AApGA;AAAA;AACA;AACA;AACA;AACA;AACA;AAEA;AAMA;AACA;AAkBA;;AAAA;AACA;AACA;AACA;AACA;AAEA;AAAA;AACA;AAUA;AAEA;AAEA;AAUA;AASA;AACA;AACA;AACA;AAOA;AACA;AACA;AAOA;AACA;AAIA;AAGA;AACA;AAAA;;;;;;;;;;;;;;AC9IA;AAAA;AAAA;AAAA;AAAA;AAEA;AACA;AAEA;AACA;AACA;;AAEA;AAEA;AAIA;AACA;AAEA;;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAIA;;;;;;;;;;;;;;;;;;;;;;;AC3CA;AACA;AAEA;AACA;AAUA;AACA;AACA;AACA;AACA;AAAA;AAAA;AAAA;AAAA;AAEA;AACA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AALA;AAAA;AAOA;AACA;AAKA;AAEA;AAEA;AAEA;AACA;AAAA;AAAA;AAEA;AAIA;AACA;AACA;AACA;AAAA;AACA;AAKA;AACA;AAEA;AAIA;AACA;AAAA;AAGA;AAOA;AACA;AAAA;AAGA;AArCA;AA0CA;AAAA;AAAA;AAAA;AAKA;AAIA;AACA;AAAA;AAIA;AACA;AAIA;;;;;;;;;;;;;;;;;;;;;;ACtGA;AAEA;AACA;AACA;AASA;AACA;AAEA;AAAA;AACA;AACA;AAEA;AACA;AACA;AAMA;AACA;AAEA;AACA;AAHA;AAQA;AAIA;AAIA;AAAA;AAAA;AAEA;AACA;AAIA;AACA;AAIA;;;;;;;;;;;;;;;;;;;;ACzDA;AACA;AAgBA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;;AA+FA;AA7FA;AACA;AACA;AAEA;AACA;AACA;AAEA;AAEA;AACA;AACA;AACA;;AACA;AAIA;AAEA;;AACA;AAKA;AACA;AAGA;AAEA;AAIA;AAEA;AACA;;AAEA;;AAAA;;AAEA;AACA;;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AAEA;AAMA;AAEA;AAKA;AACA;AAAA;;;;;;;;;;;;;;;;;;;;;;;;;AC5HA;AACA;AAKA;AACA;AAEA;AAsBA;AAAA;AAWA;AAAA;AAVA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAoEA;AAAA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AAEA;AACA;AACA;AACA;AAEA;AAAA;AACA;AACA;AACA;AACA;;AAxFA;AAEA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;;;;AACA;;;;;;AAEA;AACA;;AAAA;AACA;;;AAEA;;;;AAEA;AACA;;;;;AAEA;;;AACA;AAEA;;;;;;AACA;AACA;;AAAA;AACA;AACA;AAEA;;;;AAEA;AAEA;;;;AACA;AACA;AACA;AACA;AACA;AACA;;;;AACA;AAEA;AAAA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AA4BA;AACA;AACA;AACA;AACA;AAEA;AACA;AAEA;AACA;AACA;AAEA;AAEA;AACA;AACA;AAIA;AACA;AACA;AACA;AACA;AAIA;AACA;AAGA;AACA;AAEA;AAKA;AACA;AACA;AACA;AACA;AAIA;AACA;AAGA;AAGA;AACA;AAAA;;;;;;;;;;;;;;;;;;;;;AC/LA;AACA;AAWA;AAAA;AAAA;AAAA;AACA;AACA;AACA;;AAgBA;AAdA;;;;;AACA;;AAAA;AACA;;;;;AACA;AAEA;AACA;AACA;AAEA;AACA;AAGA;AACA;AAAA;;;;;;;;;;;;;;;;;;;;;;;;AC/BA;AAKA;AAEA;AAGA;AAqBA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AAAA;AAAA;AAAA;AACA;AA0DA;AAAA;;;;;;;AACA;AACA;AAIA;;AAAA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;;;;;AAEA;;AAgGA;AA9KA;;;;;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAGA;AACA;AAIA;;;;AACA;AAEA;AACA;AACA;AACA;AAEA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AA0BA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;;AAAA;AACA;AACA;AACA;AACA;AACA;AAEA;AAAA;AACA;AAiBA;AAEA;AAEA;AAUA;AAMA;AAMA;AAQA;AAAA;AAUA;AAQA;AACA;AAMA;AACA;AAAA;;;;;;;;;;;;;;ACxOA;AAAA;AAAA;AAAA;AAAA;AASA;AACA;AACA;AAEA;AACA;AACA;AACA;AAAA;AAAA;AASA;;;;;;;;;;;;;ACzBA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;;ACVA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AAEA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;;;;;;;;;;;;;;;;;AClRA;AACA;AAKA;AAEA;AACA;AAAA;AAEA;AAMA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;;;;;AACA;AACA;;AAAA;AACA;;;AACA;AAEA;AACA;AAGA;AAIA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AAAA;AAAA;AAAA;AACA;AAEA;;;;;;;;;;;;;;;;;;;;;;;ACnFA;AACA;AACA;AAEA;AACA;AAIA;AAAA;AAiCA;AACA;AAAA;AAAA;AA9BA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AAIA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAKA;AAEA;AACA;AACA;AAEA;AACA;AACA;;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AAEA;AACA;AAEA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AAEA;AAAA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AAEA;AAAA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AAEA;AACA;AACA;AAEA;AAAA;AACA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AA5KA;AACA;AA4KA;AAAA;AAEA;;;;;;;;;;;;;;;;;;;;;;ACzLA;AACA;AAEA;AACA;AAEA;AAIA;AAMA;AAAA;AACA;AAAA;AAQA;AACA;AAEA;AACA;AAAA;AAEA;AACA;AAAA;AAEA;AACA;AAAA;AAEA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AAAA;AAEA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AAAA;AAKA;AACA;AAAA;AAEA;AACA;AAEA;AACA;AACA;AAEA;AACA;AAEA;AACA;AAIA;AAEA;AACA;AACA;AACA;AACA;AAGA;AAEA;AAGA;AAGA;AA/EA;AACA;AACA;;AACA;AA8EA;AAAA;AACA;AACA;AAEA;AAEA;AACA;AAMA;AAMA;AAOA;AACA;AAMA;AAMA;AAOA;AACA;AAMA;AAMA;AACA;AACA;AACA;AAMA;AACA;AACA;AAIA;AACA;AACA;AACA;AAIA;AAUA;AACA;AAAA;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;ACjMA;AACA;AAIA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AAiBA;AAAA;AACA;AAAA;AA2EA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AAEA;AACA;AAEA;AACA;AACA;AAEA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AAkBA;AACA;AACA;AAEA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AAGA;AAEA;AAGA;AAGA;AAEA;AACA;AACA;AACA;AAEA;AAEA;AAGA;AACA;AAEA;AAEA;AACA;AAGA;AAKA;AACA;AAEA;;AAIA;;AAAA;AAMA;AACA;AAKA;AAGA;AAIA;AA9NA;AACA;AACA;AACA;AACA;AACA;;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AACA;AAEA;;;;;;AAKA;AACA;AAEA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AAEA;;AAAA;AACA;AACA;AACA;AACA;AACA;;;;;AACA;AA6CA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AA+FA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AAEA;AAEA;AAEA;AAEA;AACA;AAKA;AAIA;AAEA;AAIA;AACA;AAKA;AACA;AAAA;;;;;;;;;;;;;;;AC/SA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;;ACAA;AAAA;AAAA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AACA;;;;;;;;;;;;;AC3BA;AAAA;AAAA;AAAA;AAGA;AACA;AACA;;;;;;;;;;;;;;;;;;;;;;;ACNA;AACA;AAEA;AACA;AAEA;AAEA;AAOA;AAEA;AAAA;AAAA;AAAA;AACA;AAMA;AACA;AACA;AAEA;AAEA;AACA;AAiBA;AAGA;AAEA;AACA;AACA;AAOA;;AA2BA;AAzBA;AACA;AACA;AACA;AAEA;AACA;AAEA;AACA;AAEA;AAaA;AACA;AAAA;;;;;;;;;;;;;;;;;;;;;;;;;ACzFA;AACA;AAEA;AAoBA;AACA;AACA;AAIA;AAEA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AAIA;AAEA;AACA;AACA;AAIA;AAEA;AACA;AAAA;AAKA;AACA;AAIA;AAEA;AAAA;AAAA;AAAA;AACA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AAEA;AACA;AAIA;;AA2EA;AA1EA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AAEA;AAEA;AACA;AACA;AACA;AACA;AACA;AAQA;AACA;AACA;AAQA;AASA;AACA;AAQA;AAQA;AAEA;AACA;AASA;AACA;AAAA;;;;;;;;;;;;;;ACnJA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;;;;;;;;;;;;;ACXA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AAOA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;;;;;;;;;;;;ACpBA;AACA;AACA;AAIA;AAEA;AAAA;AAkBA;AACA;AAAA;AAGA;AACA;AAhBA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAUA;AAEA;AACA;AACA;AACA;AAEA;AACA;AAEA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AACA;AAEA;AACA;AACA;AACA;AAEA;AACA;AAEA;AACA;AACA;AAEA;AACA;AAEA;AAAA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AAEA;AAAA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AAEA;AAAA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AA7IA;AACA;AA6IA;AAAA;AAEA;;;;;;;;;;;;;ACzJA;AAAA;AAAA;AAAA;AAAA;AAIA;AACA;AACA;AACA;AAEA;AACA;AAKA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;;;;;;;;;;;;AC3BA;AACA;AAEA;AACA;AAEA;AACA;AAIA;AACA;AACA;AAEA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AAEA;AAEA;AACA;AAaA;AAGA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAgBA;AAdA;AACA;AACA;AAWA;AACA;AAAA;;;;;;;;;;;;;;;;;;;;;;;AClEA;AACA;AACA;AAoBA;AAIA;AAEA;AAAA;AAAA;AAAA;AACA;AAEA;AACA;AAAA;AAEA;AACA;AAAA;AAKA;AACA;AACA;AAIA;AAEA;AACA;AACA;AAIA;AAEA;AAKA;AAAA;AAQA;AACA;AAQA;AAEA;AACA;AAQA;;AAgEA;AA9DA;AACA;AACA;AACA;AAEA;AACA;AACA;AAEA;AAEA;AACA;AACA;AAKA;AAMA;AAQA;AACA;AAQA;AAQA;AAEA;AACA;AASA;AACA;AAAA;;;;;;;;;;;;;;ACzJA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;;;;;;;;;;;;;;;;;;;;;ACVA;AAEA;AAOA;AAIA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;;;;;;;;;;;;ACxBA;AACA;AAGA;AACA;AACA;AACA;AAiBA;AAAA;AAIA;AAAA;AAHA;AAsGA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AA9GA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AACA;AAEA;AAAA;AACA;AACA;AACA;AACA;AACA;AAEA;AAAA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAkBA;AACA;AACA;AACA;AACA;AAEA;AAEA;AACA;AAEA;AAEA;AAEA;AACA;AACA;AAEA;AAEA;AAKA;AAIA;AACA;AAAA;;;;;;;;;;;;;;AC9KA;AAAA;AAAA;AAAA;AAAA;AACA;AAEA;AACA;;;;;;;;;;;;;ACDA;AAAA;AAAA;AAYA;AAAA;AAKA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AAjDA;AACA;AACA;AAgDA;AAAA;;;;;;;;;;;;;;;;;;;;;;;;;AClEA;AACA;AAEA;AACA;AA4DA;AAAA;AAmBA;AAAA;AAwBA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AAnCA;AACA;AACA;;AACA;AAEA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAiBA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AAEA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AAEA;AACA;AAeA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AAWA;AAKA;AA5IA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AA6HA;AAAA;AA9IA;AAgJA;AAAA;AAAA;;AAkBA;AAjBA;AAAA;AACA;AACA;AACA;AAEA;AACA;;AADA;AACA;AACA;AASA;AACA;AAAA;AAEA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;;AA6CA;AA3CA;AAAA;AACA;AACA;AACA;AACA;AAEA;AACA;AAEA;AACA;AACA;AACA;AAEA;AAAA;AAYA;AAgBA;AACA;AAAA;AAOA;AAAA;AAAA;AAAA;AACA;;AAWA;AATA;AACA;AACA;AAEA;AACA;AAGA;AACA;AAAA;AAEA;AAAA;AAAA;;AAQA;AAPA;AACA;AAEA;AAGA;AACA;AAAA;;AAEA;;;;;;;;;;;;;;;;;;;;;;;ACjUA;AACA;AAEA;AAEA;AA0BA;AAAA;AASA;AAAA;AAOA;AAEA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AApBA;AACA;AACA;;AACA;AAmBA;;AACA;AACA;;AACA;AAAA;AACA;AACA;AACA;AACA;AAGA;AACA;;;;;;;;;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAWA;AACA;AAEA;AACA;AAGA;AAAA;AACA;AAEA;AACA;AAGA;AACA;AAhFA;AACA;AACA;AACA;AACA;AACA;AACA;AA2EA;AAAA;AAlFA;AA2FA;AAAA;AAAA;;AAsBA;AAhBA;AAAA;AACA;AACA;AACA;AACA;AAOA;AAGA;AACA;AApBA;AACA;AACA;AACA;AAkBA;AAAA;AAaA;AAAA;AACA;AACA;AAEA;AAAA;AAAA;;AAwBA;AAjBA;AAAA;AACA;AAQA;AAAA;AAEA;AAFA;AAOA;AAtBA;AACA;AACA;AACA;AACA;AAmBA;AAAA;AAQA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;;;;;;;;ACxMA;AAEA;;;;AAIA;AACA;AACA;AACA;AACA;AAEA;AACA;AAEA;AAEA;AACA;AAEA;AAEA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AAAA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AAKA;AACA;AACA;AACA;AACA;AACA;AACA;AAOA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AAEA;AAEA;AACA;;;;;;;;;;;;;AClKA;AAAA;AAAA;AAAA;AAAA;AAGA;AASA;AACA;AAAA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AAEA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AAAA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AAAA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;;AChFA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA;AAOA;AACA;AAAA;AAAA;AAEA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AAEA;AAEA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AAEA;AASA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AC9KA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAIA;AACA;AAeA;AACA;AAEA;AAEA;AAgBA;AAAA;AAAA;AAAA;AAAA;AA6HA;AAIA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AAlKA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AAEA;AAAA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AAWA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AAEA;AACA;AAEA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AAEA;AACA;AACA;AACA;AACA;AAEA;AAAA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AA0CA;AAAA;AACA;AACA;AAEA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AAEA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AAEA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AAAA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;;AACA;AACA;AACA;AAEA;AAEA;AACA;;AAEA;AAAA;;AACA;AAAA;AACA;AACA;;;;;;;;;AACA;;;;;;;;;AAEA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AAIA;AACA;AACA;AAIA;AAEA;AACA;AACA;AACA;AAEA;AACA;AAEA;AACA;AACA;AACA;AAEA;AAEA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AAGA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AAAA;AACA;AACA;AAAA;AACA;AACA;AAEA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AAEA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AAEA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AAAA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;;;;;;;;;;;;;AC94BA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AAEA;AAEA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AAEA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AAEA;AACA;AAEA;AAEA;AACA;AAEA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AAEA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AACA;AAAA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AAEA;AACA;AAEA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AAEA;AACA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AAAA;AACA;AACA;AAEA;AACA;AAEA;AAEA;AAEA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AAEA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AACA;AAEA;AACA;AAEA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AAAA;AACA;AACA;AAEA;AACA;AAEA;AAEA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;;ACnTA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAGA;;;AAGA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AAEA;;;;;AAKA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AAEA;;;;AAIA;AACA;AAOA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;;;;;;;;;;;;;ACxFA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA;AAGA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AAEA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AAEA;;;;;;;;;;;;;AAaA;AAEA;;AAEA;AACA;AASA;AACA;AAUA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;;AAEA;;AAEA;AACA;AAMA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;;AAEA;;AAEA;AACA;AAMA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AAEA;;AAEA;AACA;AAAA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AAEA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;;AAEA;AACA;AACA;AADA;AAGA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;;AAEA;AACA;AAAA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;;AAEA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AAEA;AACA;AAEA;AACA;AACA;AAAA;AACA;AACA;AAEA;AACA;AACA;AAAA;AACA;AACA;AAEA;AACA;AACA;AAAA;AACA;AACA;AAEA;AACA;AACA;AAAA;AACA;AACA;AAEA;AACA;AACA;AAAA;AACA;AACA;AAEA;AACA;AACA;AAAA;AACA;AACA;AAEA;AACA;AAEA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AAEA;AAEA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AAEA;AAGA;AACA;AAEA;AACA;AAEA;AACA;AACA;AACA;AACA;AAOA;AACA;AAEA;;AAEA;AACA;AAAA;AACA;AAEA;AACA;AACA;AACA;AAQA;AACA;AAEA;AACA;AACA;AAAA;AACA;AACA;AAEA;AACA;AACA;AAAA;AACA;AACA;AAEA;AACA;AACA;AAAA;AACA;AACA;AAEA;AACA;AACA;AAAA;AACA;AACA;AAEA;AACA;AAEA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AACA;AAEA;AAGA;AACA;AAEA;AACA;AAEA;AACA;AACA;AACA;AACA;AAOA;AACA;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;;AAEA;;AAEA;AAEA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AAEA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;ACjrBA;AACA;AACA;AACA;AAEA;AACA;AAEA;AACA;AACA;AACA;AAGA;AACA;AAEA;AACA;AAIA;AAEA;AAAA;AAmHA;AACA;AAAA;AAAA;AAhHA;AACA;AACA;AACA;AACA;AAKA;AAIA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAuIA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAyCA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AA9MA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AAEA;;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AAEA;AAAA;AACA;AACA;AACA;AACA;AACA;AAEA;;;;;AAKA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AAEA;;AAAA;AACA;AACA;AACA;AACA;AACA;AAEA;AAEA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AAAA;;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;AACA;AAEA;AAEA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AAEA;AAEA;;AACA;AACA;AACA;;AAEA;AAAA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;AACA;AA8BA;AACA;AAIA;AAEA;AACA;AACA;AAEA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AAEA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAxTA;AAqUA;AAAA;AAEA;;;;;;;;;;;;;AChWA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AAEA;AAEA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;;;;;;;;;;;;;ACtKA;AAAA;AAqBA;;;;;;;;;;;;;ACrBA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA;AAGA;AAQA;AAAA;AAAA;AAEA;AACA;AACA;AACA;AACA;AAEA;AASA;AAEA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AAEA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AAEA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AAEA;AAEA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;;;;;;;;;;;;;;AC9PA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AAKA;AACA;AAAA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AAEA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AAEA;AACA;AACA;AAEA;AAAA;AACA;AACA;AACA;AACA;AACA;AAEA;AAAA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;;;;;;;;;;;;;ACrFA;AACA;AACA;AAOA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AAEA;AAEA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AAEA;AAIA;AAAA;AAAA;AAAA;AAAA;AAEA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AAEA;AAQA;AAEA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AAEA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AAEA;AACA;AACA;AAEA;AAEA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AAAA;AACA;AAEA;AACA;AACA;AACA;AAEA;AACA;AAEA;AACA;AACA;AAEA;AAEA;AAEA;AACA;AACA;AAEA;AACA;AAEA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AACA;AAEA;AACA;AACA;AAAA;;;;;;;;;;;;;;ACjQA;AAAA;AAAA;AAAA;AAAA;AACA;AAEA;AAMA;AACA;AAAA;AACA;AAEA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AAEA;AAAA;AACA;AACA;AACA;AACA;AACA;AAEA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;;;;;;;;;AC3EA;AACA;AAcA;AACA;AAEA;AACA;AAIA;AAEA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AAAA;AACA;AACA;AAEA;AAIA;AAEA;AACA;AAEA;AACA;AACA;AAMA;AAMA;AAQA;AACA;AACA;AACA;AAQA;AACA;AACA;AAMA;AAIA;AAKA;AACA;AAEA;AAIA;;;;;;;;;;;;;;;;;;;;;;ACvGA;AACA;AAGA;AACA;AAIA;AACA;AASA;AACA;AAEA;AAGA;AAGA;AAKA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAQA;AACA;AAgBA;AAGA;AAGA;;;;;;;;;;;;;;;;;;;;;ACvEA;AACA;AAGA;AA0BA;AAAA;AACA;AAAA;AAGA;AACA;AACA;AACA;AAEA;AACA;AAQA;;AACA;AAEA;AACA;AAWA;AAEA;AACA;AACA;AACA;AACA;AAIA;AAEA;AAEA;AAEA;AACA;AAQA;AACA;AACA;AACA;AACA;AACA;AAEA;AAEA;AAEA;AACA;AAKA;AACA;AAEA;AACA;AAEA;AACA;AACA;AAQA;AAEA;AACA;AACA;AACA;AAEA;AAAA;AACA;AACA;AAEA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAGA;AACA;AAAA;;;;;;;;;;;;;;;;;;;;;;ACjJA;AAIA;AAUA;AAEA;AAAA;AAAA;AAAA;AACA;AACA;AAOA;AAEA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AAOA;;AAyCA;AAvCA;AAAA;AACA;AAKA;AAEA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AAMA;AACA;AAGA;AACA;AAEA;AACA;AACA;AAGA;AAIA;AACA;AAAA;;;;;;;;;;;;;;;;;;;;AClGA;AACA;AAuBA;;;AAQA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;;AACA;AAAA;AACA;AACA;AACA;AACA;AAEA;AACA;;AAEA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AAEA;AAIA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AAQA;AAEA;AACA;AACA;AAEA;AACA;AACA;AAIA;AACA;AAEA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;AAvFA;AAAA;AAAA;AAwFA;;;;;;;;;AACA;;;;;;;;;AAEA;AACA;;;;;;;;;;;;;AC9IA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AAEA;;;;;;;;;;;;;;;;;;ACDA;AACA;AAuBA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;;AC1CA;AAAA;AAAA;AAAA;AAAA;AACA;AAQA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AAAA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;;ACpDA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AAEA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AAQA;AACA;AACA;AAEA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AAEA;AAQA;AACA;AACA;AAEA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AAEA;AASA;AACA;AAEA;AACA;AACA;AAEA,yEACA;AACA;AACA;AAEA;AACA,6DACA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AAEA;AACA;AACA;AACA;AAEA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AACA,iFACA;AACA;AACA;AACA;AAAA;AACA,8EACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAOA;AACA;AACA;AAEA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;;AC9VA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AAEA;AAAA;AACA;AACA;AACA;AAEA;AACA;AAEA;AACA;AAEA;AAGA;AAEA;AACA;AACA,2EACA;AACA;AACA;AACA;AAAA;AACA,wEACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;;ACjCA;AAAA;AAAA;AAAA;AAIA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AAAA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;;;;;;;;;;;;;;;;;;ACvBA;AACA;AACA;AAEA;AACA;AACA;AACA;AAQA;AACA;AACA;AACA;AAEA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AAEA;AAAA;AAgBA;AACA;AAAA;AAdA;AACA;AACA;AAcA;AAEA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AAEA;;AACA;AAEA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AACA;AAEA;AACA;AACA;AAAA;AACA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AAEA;AACA;AACA;AACA;AACA;AAAA;AAEA;AACA;AAEA;AACA;AAAA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AAEA;AAEA;AACA;AACA;AACA;AACA;AAEA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AAEA;AAEA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AAEA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AAEA;AACA;;AAAA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AAGA;AACA;AAIA;AACA;AACA;AACA;AACA;AACA;AAAA;;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;AACA;AAEA;AACA;AAEA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AAlQA;AAmQA;AAAA;AApQA;;;;;;;;;;;;;;;;;;;;;;;;;;AC9GA;AAIA;AACA;AAEA;;;AAGA;AACA;;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AAAA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;AACA;AAEA;AACA;AAEA;;AAEA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;;;;AAIA;AACA;AAAA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AAEA;AACA;AACA;AAEA;;;;;;;;;;;;;;;;AAgBA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AAEA;;;;;;;;;;;;;;;;;;;;;;;;;;;;AA4BA;AACA;;AAAA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;AAbA;AAAA;AAAA;AAcA;;;;;;;;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AAEA;AACA;AAEA;AACA;AACA;AACA;AACA;AAEA;AACA;AAEA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AAOA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AAEA;;AAEA;AACA;AACA;AACA;AACA;AAEA;AACA;AAEA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AAEA;AACA;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AAEA;AACA;AACA;AACA;AAEA;AAKA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AAEA;;;;AAIA;AACA;AACA;AACA;AAEA;;;;AAIA;AACA;AAAA;AACA;AAEA;AACA;AACA;AAAA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AAEA;;;;;AAKA;AACA;AAAA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AAEA;;;;AAIA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AAAA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AAEA;AACA;AAEA;AACA;AACA;AAEA;;;;;;;;;;;;;AC/dA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AAEA;AAUA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AACA;AAEA;AACA;AAEA;AACA,gEACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AAEA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AAEA;AACA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AAGA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAIA;AAAA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AAEA;AACA;AACA;AAEA;AACA;AAEA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AAEA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AAEA;AACA;AAKA,uEACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AAEA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;;;;;;;;;;;;;;ACxRA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AAEA;;;;;;;;;;;;;ACHA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAQA;AAEA;AAUA;AACA;AACA;AACA;AA6BA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AAEA;AAEA;AAEA;AACA;AACA;AAEA;AACA;AAEA;AAEA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AAEA;AAEA;AAEA;AACA;AAAA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AAGA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AAEA;AACA,sFACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AAEA,iEACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AAEA,wFACA;AACA;AACA;AAEA,+DACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AAEA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AAEA,qFACA;AACA;AACA;AACA;AAEA;AACA;AAEA;AACA;AAEA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AAEA,+DACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AAEA,wFACA;AACA;AACA;AAEA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AAEA,+DACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AAEA;AACA;AAEA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AAEA;AACA;AAEA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AAEA;AACA;AAEA;AACA;AAEA;AACA;AACA;AAEA,gEACA;AACA;AACA;AACA;AACA;AAEA;AAAA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AAEA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AAEA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AACA;AAAA;AACA;AACA;AAAA;AACA;AACA;AAEA;AACA;AACA;AACA;AAEA;AACA;AAEA;AACA;AACA;AAIA;AAAA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AAEA;AAAA;AACA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AAEA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AAEA;AACA;AAEA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;;;;;;;;;;;;;;;;;;;;;;;;;;;;ACz2BA;AACA;AACA;AAEA;AACA;AACA;AACA;AAOA;AAAA;AAAA;;AAoCA;AAnCA;AACA;AAEA;AAEA;AACA;AAMA;AAMA;AAMA;AAOA;AAGA;AACA;AAAA;;AASA;AAAA;AACA;AAEA;AAEA;AACA;AAGA;AAEA;AACA;AACA;AAEA;;AAEA;;AAAA;AACA;AAEA;AAEA;AACA;AAEA;AACA;AAKA;AAGA;AAWA;AAOA;AACA;AAEA;;;;;;;;;;;;;;AClHA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AAEA;AACA;AAIA;AACA;AAKA;AACA;AAEA;AAGA;AAEA;AACA;AAEA;AAEA;AAYA;;;;;;;;;;;;;;;;;;;;;ACxCA;AACA;AACA;AAIA;AAGA;AACA;AACA;AACA;AAEA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AAEA;AACA;AAEA;AACA;AACA;AAEA;AACA;AAEA;AACA;AACA;AAEA;AACA;AAEA;AACA;AACA;AACA;;AA2BA;AAzBA;AACA;AACA;AAEA;AAEA;AACA;AACA;AACA;AACA;AAMA;AACA;AACA;AAMA;AACA;AAAA;;;;;;;;;;;;;;AClEA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AAEA;;;;;;;;;;;;;ACLA;AAAA;AAAA;AAAA;AASA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;;;;;;;;;;;;;;;;ACdA;AACA;AACA;AAIA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AASA;AAAA;AACA;AAAA;AAGA;;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AAEA;;;;;;;AACA;;;;AAEA;AACA;;AAAA;AACA;AACA;AACA;AACA;AACA;;;;AAEA;AACA;AACA;AACA;AACA;;;;;;AAEA;AAEA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AAEA;AAEA;AAEA;AAEA;AACA;AACA;AAAA;AAAA;AACA;AAIA;AAIA;AACA;AAAA;;AAEA;AACA;AAGA;AAOA;AAMA;AAKA;AAYA;;;;;;;;;;;;;;;;;;;;;;AC5HA;AACA;AAEA;AAEA;AAMA;AAAA;AACA;AAAA;AAQA;AACA;AAAA;AAKA;AAAA;AAAA;AAAA;AAEA;AACA;AACA;AACA;AAIA;AApBA;AACA;AACA;;AACA;AAmBA;AACA;AACA;AACA;AAEA;AACA;AACA;AAUA;AAEA;AACA;AACA;AAQA;AACA;AAAA;;;;;;;;;;;;;;ACnEA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AAEA;;;;;;;;;;;;;;;;;ACHA;AAAA;;;;AACA;;AAAA;AACA;;AAAA;AACA;AACA;AACA;AACA;AACA;AAEA;;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AAEA;;;;AACA;;;;;;;;;;;;;AC/BA;AAAA;AAAA;AAAA;AAMA;AACA;AACA;;;;;;;;;;;;;;;;;;ACPA;AAEA;;AACA;AACA;AACA;AACA;;AAEA;AAAA;AACA;AAEA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;;;;;;;;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;;;;;;;;;ACnCA;AACA;AAEA;AACA;AAIA;AAGA;AAEA;AACA;AACA;AACA;AAEA;AAAA;AAAA;AAAA;AACA;AACA;AAAA;AACA;AAAA;;AA4BA;AA1BA;AACA;AACA;AAEA;AAEA;AACA;AACA;AAOA;AACA;AASA;AACA;AAAA;;;;;;;;;;;;;;;;;;;;;;;ACjDA;AACA;AAEA;AACA;AAEA;AACA;AACA;AAQA;AAAA;AAAA;;AAsBA;AArBA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AAEA;AAUA;AACA;AAAA;;;;;;;;;;;;;;;;;;;;;;ACtCA;AACA;AASA;AAGA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AAIA;AAEA;AACA;AAAA;AAKA;AACA;AAIA;;AAyBA;AAvBA;AACA;AACA;AACA;AAEA;AAEA;AACA;AACA;AAGA;AACA;AAGA;AAGA;AAGA;AACA;AAAA;;;;;;;;;;;;;;AC1DA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AAEA;AACA;AACA;;;;;;;;;;;;;;;;;;;;ACPA;AACA;AACA;AAOA;AACA;AACA;AACA;AACA;AAIA;AACA;AAEA;;;;;;;;;;;;;;;;;;;;;;;ACpBA;AACA;AAGA;AAEA;AAEA;AAAA;AAWA;AACA;AAAA;AAAA;AAJA;AACA;AAMA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AAEA;AACA;AACA;AACA;AACA;AAEA;AAAA;AACA;;AACA;AACA;AACA;AACA;;AAEA;AAAA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;;;;;;;;;AACA;AACA;AAnEA;AACA;AAmEA;AAAA;AAEA;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AC/EA;AAEA;AACA;AACA;AACA;AAEA;AAmBA;AAEA;AACA;AACA;AAEA;AAEA;AAcA;AAAA;AAuEA;AACA;AAAA;AAAA;AAAA;AArEA;AAGA;AAKA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAKA;AAEA;AACA;AACA;AAEA;AAEA;AACA;;AACA;AAEA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AAEA;AAAA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AAEA;AACA;AAEA;AACA;AAEA;AACA;AACA;AACA;AAEA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AASA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AAEA;AAAA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AAEA;AAOA;AACA;AACA;AAEA;AAEA;AACA;AAEA;AACA;AACA;AACA;AACA;AAEA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AAEA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AAEA;AACA;AACA;AAEA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AAEA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AAEA;AACA;AACA;AACA;AAEA;AACA;AAEA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AAEA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AAEA;AAEA;AACA;AACA;AAEA;AACA;AACA;AAEA;AAEA;AACA;AACA;AAAA;AACA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AAEA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AAEA;AACA;AAEA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AAEA;AAEA;AACA;AACA;AACA;AACA;AArnBA;AAsnBA;AAAA;AAEA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AAEA;AACA;AAwBA;;AACA;AACA;AACA;AACA;;AACA;AAAA;AACA;;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;AACA;;;;;;;;;AACA;AACA;AAEA;;;;;;;;;;;;;;;;;;;;;;;AC9uBA;AACA;AAEA;AACA;AAIA;AAEA;AAUA;AAEA;AAAA;AAAA;AAAA;AACA;AAMA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AAEA;AAEA;AACA;AAeA;AAGA;AAEA;AACA;AAEA;AAQA;;AAkBA;AAhBA;AACA;AAEA;AAYA;AACA;AAAA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AAAA;AACA;AACA;AACA;;;;;;;;;;;;;;;;;;;;;;;;AClHA;AACA;AAEA;AAqBA;AACA;AAEA;AAIA;AAEA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AAIA;AAEA;AACA;AACA;AAIA;AAEA;AACA;AAAA;AAKA;AAAA;AAAA;AAAA;AACA;AAAA;AAAA;AAAA;AACA;AAAA;AAAA;AAAA;AACA;AAAA;AAAA;AAAA;AAEA;AACA;AAIA;AAEA;AACA;AAIA;;AAuFA;AArFA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AAEA;AACA;AACA;AACA;AACA;AACA;AAQA;AACA;AACA;AAQA;AACA;AACA;AAQA;AACA;AACA;AAUA;AACA;AAQA;AAQA;AAEA;AACA;AASA;AACA;AAAA;;;;;;;;;;;;;;AChKA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;;ACXA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AASA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;;AC/CA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AAEA;AAsBA;AACA;AAAA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AAAA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AAxIA;AACA;AACA;AACA;AACA;AACA;AAoIA;AAAA;AAxJA;AA0JA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;;ACrKA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AAGA;AAUA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AAAA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AC/FA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AAEA;AAAA;AAuCA;AACA;AAAA;AAIA;AACA;AACA;AAtCA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AAaA;AAEA;AACA;AACA;AACA;AACA;AACA;AAEA;AAEA;AACA;AACA;AACA;;AACA;AAEA;AACA;AACA;AACA;AAEA;AACA;AACA;AAEA;AAAA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AAEA;AACA;AACA;AAEA;AASA;AACA;AAEA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AAEA;AACA;AAEA;AACA;AACA;AAEA;AACA;AAEA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AAEA;AACA;AAEA;AACA;AACA;AACA;AACA;AAEA;AACA;AAEA;AAEA;AACA;AACA;AAGA;AACA;AAEA;AACA;AAEA;AACA;AACA;AACA;AACA;AAEA;AACA;AAEA;AACA;AAEA;AACA;AAEA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AAEA;AACA;AAEA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAzQA;AA0QA;AAAA;AAEA;;;;;;;;;;;;;AC1RA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AAcA;AACA;AAEA;AAIA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AAEA;AACA;AAEA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AAAA;AACA;AACA;AACA;AAEA;AAAA;AACA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AACA;AAEA;AAEA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AAEA;AAEA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AACA;AAEA;AACA;AAEA;AACA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AACA;AAEA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AAAA;AACA;AAEA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AAAA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AACA;AAEA;AACA;AAEA;AACA;AAEA;AAEA;AAKA;AAAA;AACA;AACA;AAEA;AACA;AACA;AASA;AAEA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AAEA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;;;;;;;;;;;;;;;;;;;;;;;;;;ACpYA;AACA;AACA;AACA;AAIA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AAEA;AAEA;AACA;AACA;AACA;AACA;AAEA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AAEA;AAEA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAGA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;;AACA;;AAEA;AAAA;AACA;AAEA;AACA;AACA;AACA;AAEA;AACA;;;;;;;;;AAEA;AACA;AACA;AAEA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AAEA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AACA;AAEA;AACA;AACA;AAEA;;;;;;;;;;;;;;;;;;;;;;ACtSA;AACA;AAEA;AACA;AACA;AAEA;AAIA;AAEA;AAAA;AACA;AACA;AACA;AAEA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AAAA;;;;;;;;;;;;;;;;;;;;;AChCA;AAIA;AAGA;AAAA;AAAA;AAAA;AACA;AACA;AACA;;AAcA;AAZA;AACA;AAEA;AAEA;AACA;AACA;AAIA;AACA;AAAA;;;;;;;;;;;;;;AC1BA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAEA;AACA;AACA;AAEA;AACA;AACA;AACA;;;;;;;;;;;;;ACFA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;;;;;;;;;;;;;ACbA;AACA;AAEA;AACA;AAGA;AACA;AAEA;AASA;AAAA;AAWA;AACA;AAAA;AAGA;AACA;AAXA;AACA;AACA;AACA;AACA;AAWA;AAEA;AACA;AACA;AAEA;AACA;AACA;AACA;AAEA;AAGA;AACA;;AAEA;AAEA;AACA;AAEA;AACA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AAEA;AAAA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AAAA;AACA;AACA;AAEA;AACA;AA9EA;AACA;AA8EA;AAAA;AAhFA;AAkFA;;;;;;;;;;;;;;;;;;;;;;;;ACrGA;AACA;AACA;AACA;AAEA;AACA;AACA;AAWA;AAAA;AACA;AAAA;AAQA;AACA;AACA;AACA;AACA;AACA;AAVA;AACA;AACA;;AACA;AASA;AACA;AACA;AACA;AACA;AAEA;AACA;AAEA;AAEA;AACA;AAEA;AACA;AAEA;AACA;AACA;AACA;AAEA;AAEA;AACA;AACA;AAEA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AAEA;AACA;AAEA;AACA;AACA;AAAA;;;;;;;;;;;;;;;;;;;;;ACpFA;AACA;AAEA;AACA;AAMA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AAAA;AAEA;AACA;AACA;;AAiBA;AAfA;AACA;AAEA;AAEA;AACA;AACA;AACA;AAGA;AAGA;AACA;AAAA;;;;;;;;;;;;;;ACvCA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAEA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;;ACRA;AAAA;AAAA;AACA;AACA;AAMA;;;;;;;;;;;;;ACdA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA;AAEA;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;ACNA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AAEA;AACA;AACA;AAKA;AAEA;AAIA;AACA;AACA;AAcA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AAEA;AAEA;AAKA;AACA;AACA;AACA;AAAA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AAAA;;AAEA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AAOA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AAEA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AAEA;AAEA;AACA;;AAEA;AACA;AAAA;AACA;AACA;;;;;;;;;AAEA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AAEA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;;;;;;;;;;;;;;;;;;;;;;;;;;AC5TA;AACA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AAGA;AACA;AAEA;AACA;AAIA;AAEA;AACA;AAOA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AAEA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;;;;;;;;;;;;;ACrEA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AAKA;AAEA;AACA;AACA;AAQA;AAEA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AAEA;AACA;AACA;AACA;AAAA;;AAEA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAGA;AACA;AAAA;;AAEA;AACA;;;;;;;;;;;;;;;;;;ACtFA;AAEA;;;AACA;AAAA;AACA;AACA;;;;;;;;;AACA;AAEA;AACA;AACA;;;;;;;;;;;;;AChBA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AAEA;AACA;AAAA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AAGA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AAGA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AAGA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AAGA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,2gBAEA;AAFA;AAKA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AAGA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AAGA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AAGA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AAGA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AAGA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;;;;;;;;;;;;;ACzaA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AAEA;AAEA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AAEA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;;;;;;;;;;;;;AClCA;AAAA;AAAA;AAAA;AAEA;AACA;AACA;;;;;;;;;;;;;ACPA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA;AAuDA;AAAA;AACA;AACA;AACA;AACA;AAEA;AAAA;AACA;AACA;AACA;AAEA;AAAA;AACA;AACA;AACA;AACA;AACA;AAOA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AAAA;AACA;AACA;AACA;AAQA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AC/GA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AAEA;AAAA;AACA;AACA;AACA;AACA;;;;;;;;;;;;;ACwBA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AAEA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AAOA;;;;;;;;;;;;;;;;;;;;;;;;ACjEA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AA4EA;;AAEA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AAEA;AAEA;AACA;AAEA;AACA;AACA;AAEA;AACA;AAEA;AACA;AAEA;AACA;AAEA;AACA;AAEA;AACA;AAEA;AAEA;AACA;AACA;AACA;AACA;AAEA;AAEA;AAEA;AAEA;AAEA;AAEA;AAEA;AAEA;AAEA;AAEA;;;;;;;;;;;;;AC1HA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AAEA;AAAA;AACA;AACA;AACA;;;;;;;;;;;;;;;;;;;;;;;;AC5BA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;ACpBA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;ACJA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;ACrMA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;ACl+CA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;AC/KA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;AC3OA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;AC/RA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;AC37BA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;ACxvGA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;ACvYA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;AC7LA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;AC7HA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;AC9aA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;A","sourceRoot":""}